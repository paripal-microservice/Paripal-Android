<div style="background-color:#FFF;padding: 15px"><div class="pageTitle"><span>{{'AMBULANCE_REQUEST'|translate}}</span><help-directive help-id="AMBULANCE_REQUEST" class="divContainer"></help-directive></div><div class="filterPanel filter" ng-hide="mapVisibility=='show-map'"><uib-accordion><uib-accordion-group is-open="status.open"><uib-accordion-heading><i class="fa fa-filter"></i> <span>{{'FILTER'|translate}}</span> <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': status.open, 'glyphicon-chevron-right': !status.open}"></i></uib-accordion-heading><form name="listForm" class="form-horizontal panel-body-top" id="listForm" autocomplete="off"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><div class="row"><organization-location-autocomplete adhoc-url="GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD" label="LOCATION" required="false" disabled="disableLoc" selected="filterCriteria.orgLoc" org-loc-permission="featurePrivilegeConstants.AMBULANCE_VIEW"></organization-location-autocomplete><pick-list-dropdown pick-list-value="picklistData.ambulanceType" type="AMBULANCE_TYPE" label="AMBULANCE_TYPE"></pick-list-dropdown><ws-name-value-combo label-name="RECEIVED_FROM" required="false" name-value-list="filterCriteria.requesterId" query-search-key="keyword" min-length="userMinLength" query-url="requester.queryUrl" query-parameter="requester.queryParameter" json-parameter="requester.jsonParameter"></ws-name-value-combo></div><div class="row"><custom-valid-from-valid-till from-date-label="REQUEST_FROM" type="any" valid-from="filterCriteria.requestDateFrom" require-valid-from="false" to-date-label="REQUEST_TILL" valid-till="filterCriteria.requestDateTill" require-valid-till="false"></custom-valid-from-valid-till><pick-list-dropdown pick-list-value="picklistData.requestStatus" type="AMBULANCE_REQUEST_STATUS" label="REQUEST_STATUS"></pick-list-dropdown></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 padding-0 textAlign-R wizardFooter"><div class="textAlign-R"><md-button type="button" ng-click="cancelFilter()" class="md-raised">{{"CANCEL"|translate}}</md-button><md-button class="md-raised md-warn" ng-click="fetchRecords()" ng-disabled="!listForm.$valid">{{"APPLY"|translate}}</md-button></div></div></div></div></form></uib-accordion-group></uib-accordion></div><div class="row padding-b-10 padding-t-20"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><md-button type="button" class="md-raised md-warn" ng-click="toggleMap()">{{buttonText}}</md-button><md-button type="button" class="md-raised md-warn" ng-click="newRequest()" check-permission feature-privilege="{{featurePrivilegeConstants.AMBULANCEREQUEST_ADD}}">{{'ADD_NEW' | translate}}</md-button><div class="pull-right" ng-hide="mapVisibility=='show-map'"><md-menu><md-button type="button" class="md-raised" ng-click="$mdOpenMenu($event)">{{'SHOW'|translate}} {{itemPerPage}}</md-button><md-menu-content width="3" ng-init="maxRecordsAr = [10,25,50,100]"><md-menu-item ng-repeat="item in maxRecordsAr"><md-button ng-click="setMaxRecords(item)"><span md-menu-align-target>{{'SHOW'|translate}} {{item}} </span></md-button></md-menu-item></md-menu-content></md-menu></div></div><div class="col-sm-12 col-md-12 col-lg-12 padding-t-10 float-full" ng-hide="mapVisibility=='hide-map'"><md-slider-container flex><label><b>{{'RADIUS' | translate}}</b> :</label>{{filter.slider}} ({{'KM' | translate}})<md-slider flex="" md-discrete="" ng-model="filter.slider" min="{{commonConstants.minMapRadius}}" max="{{commonConstants.maxMapRadius}}" step="{{commonConstants.radiusStep}}" ng-change="changeRadius()" aria-label="bass" class="md-warn"></md-slider></md-slider-container></div></div><div class="table-responsive foo" ng-class="{'posRelative':ambulanceSpinner}" ng-hide="mapVisibility=='show-map'"><spinner name="ambulanceSpinner" img-src="{{pageLoaderImg}}" show="ambulanceSpinner"></spinner><table datatable="ng" dt-options="options" dt-column-defs="dtColumnDefs" class="table table-striped table-hover rwd-table" width="100%"><thead><tr><th data-priority="1">{{'RECEIVED_FROM' | translate}}</th><th>{{'EMAIL' | translate}}</th><th>{{'CELL_NO' | translate}}</th><th>{{'DATE_TIME' | translate}}</th><th>{{'REQUEST_LOCATION' | translate}}</th><th>{{'AMBULANCE_TYPE' | translate}}</th><th>{{'STATUS' | translate}}</th><th>{{'NO_OF_PATIENTS' | translate}}</th><th>{{'NO_OF_PICKEDUP_PATIENTS' | translate}}</th></tr></thead><tbody><tr ng-repeat="row in ambulanceList"><td><div class="btn-group"><a class="dropdown-toggle dropDownBtnLink" ng-if="row.requester" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{row.requester.value}} <a class="dropdown-toggle dropDownBtnLink" ng-if="!row.requester" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{row.requesterName}}</a><ul class="dropdown-menu" ng-if="driver"><li ng-if="row.requestStatus.code == 'NEW/OPEN'"><a href="" ng-click="fulFillRequest($event, row, 'fulfillRequest')" check-permission feature-privilege="{{featurePrivilegeConstants.AMBULANCEREQUEST_FULFILLREQUEST}}"><i class="fa fa-pencil"></i> {{"FULFILL_REQUEST" | translate}}</a></li><li><a href="" ng-click="showDetailsOfRequests(row)"><i class="fa fa-pencil"></i> {{"SHOW_DETAILS" | translate}}</a></li></ul><ul class="dropdown-menu" ng-if="admin"><li ng-if="row.requestStatus.code == 'NEW/OPEN'"><a href="" ng-click="fulFillRequest($event, row, 'assignTo')" check-permission feature-privilege="{{featurePrivilegeConstants.AMBULANCEREQUEST_ADD}}"><i class="fa fa-pencil"></i> {{"ASSIGN_TO" | translate}}</a></li><li><a href="" ng-click="showDetailsOfRequests(row)"><i class="fa fa-pencil"></i> {{"SHOW_DETAILS" | translate}}</a></li></ul><ul class="dropdown-menu" ng-if="adminDriver"><li ng-if="row.requestStatus.code == 'NEW/OPEN'"><a href="" ng-click="fulFillRequest($event, row, 'fulfillRequest')" check-permission feature-privilege="{{featurePrivilegeConstants.AMBULANCEREQUEST_FULFILLREQUEST}}"><i class="fa fa-pencil"></i> {{"FULFILL_REQUEST" | translate}}</a></li><li ng-if="row.requestStatus.code == 'NEW/OPEN'"><a href="" ng-click="fulFillRequest($event, row, 'assignTo')" check-permission feature-privilege="{{featurePrivilegeConstants.AMBULANCEREQUEST_ADD}}"><i class="fa fa-pencil"></i> {{"ASSIGN_TO" | translate}}</a></li><li><a href="" ng-click="showDetailsOfRequests(row)"><i class="fa fa-pencil"></i> {{"SHOW_DETAILS" | translate}}</a></li></ul></a></div></td><td>{{row.requesterEmail}}</td><td>{{row.requesterContact}}</td><td>{{row.requestDate | longToTimestamp}}</td><td>{{row.city}}</td><td>{{row.ambulanceType.value}}</td><td>{{row.requestStatus.value}}</td><td>{{row.noOfPatients}}</td><td>{{row.noOfPatientsAllocated}}</td></tr></tbody></table><div ng-show="totalItems > 0"><div class="pageRecord"><span>{{'SHOWING' | translate}} {{pagingInfo.startRecord + '-' + pagingInfo.endRecord + ' '+("OF"|translate) + ' '+ totalItems + ' '+("ITEMS"|translate)}}</span></div><div class="text-center"><uib-pagination max-size="4" total-items="totalItems" ng-model="currentPage" items-per-page="itemPerPage" ng-change="pageChanged()" boundary-links="true" class="pagination-md" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination></div></div></div><div class="row padding-t-10"><div class="col-sm-12" ng-class="{'col-md-12 col-lg-12' :!isOnTheWay,'col-md-9 col-lg-9':isOnTheWay}" ng-if="isMapVisible"><spinner name="searchHospSpinner" img-src="{{pageLoaderImg}}" show="searchHospSpinner"></spinner><ng-map default-style="false" id="map" center="{{currentLocation}}" zoom="12" style="height:550px;width:100%"><marker id="id_{{ambulance.id}}" position="{{ambulance.location}}" on-click="selectAmbulance(ambulance)" ng-repeat="ambulance in ambulanceMapList" draggable="{{ambulance.isDraggable}}" icon="{{ambulance.ambulanceIcon}}"></marker><shape id="circle" name="circle" centered="false" stroke-color="#ffad33" stroke-opacity="0.7" stroke-weight="2.5" center="{{currentLocation}}" radius="{{filter.radius}}" on-dragend="changeLocation($event)" editable="false"></shape><info-window id="requesterDetails"><div ng-non-bindable="" class="location-details"><div class="head"><h3>{{"REQUESTER" | translate}}</h3></div><div class="table-holder table-black"><table class="table"><tr><td width="50px" class="graytext" rowspan="2"><span style="float: left; margin: 10px 5px"><img ng-src="app/images/user.jpg" ng-if="!requesterDetails.requesterPhoto" class="img-circle special-img profileImg"> <img ng-if="requesterDetails.requesterPhoto" ng-src="data:image/png;base64,{{requesterDetails.requesterPhoto}}" class="img-circle special-img profileImg"></span></td></tr><tr><td><b>{{requesterDetails.fulfillAssignObject.requesterName}}</b><br><br><md-button type="button" class="md-raised md-warn blue-btn"><i class="fa fa-phone" aria-hidden="true"></i> {{requesterDetails.fulfillAssignObject.requesterContact}}</md-button></td></tr></table></div><div class="table-holder"><table class="table"><tr><td width="25px" class="icon"><i class="fa fa-plane" aria-hidden="true"></i></td><td><b>{{"DISTANCE_FROM_MY_LOCATION" | translate}}</b><br>{{map.directionsRenderers[0].directions.routes[0].legs[0].distance.text}}</td></tr><tr><td width="25px" class="icon"><i class="fa fa-ambulance" aria-hidden="true"></i></td><td><b>{{"AMBULANCE_TYPE" | translate}}</b><br>{{mapAmbulanceType}}</td></tr><tr><td class="icon"><i class="fa fa-map-marker" aria-hidden="true"></i></td><td><b>{{"LOCATION_ADDRESS" | translate}}</b><br>{{requesterDetailsAddress}}</td></tr></table></div><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 textAlign-C padding-r-0"><md-button type="button" ng-if="driver || adminDriver" class="md-raised md-warn textAlign-C" ng-click="fulFillRequest($event, requesterDetails.fulfillAssignObject, 'fulfillRequest')" check-permission feature-privilege="{{featurePrivilegeConstants.AMBULANCEREQUEST_FULFILLREQUEST}}">{{"FULFILL_REQUEST"|translate}}</md-button><md-button type="button" ng-if="admin || adminDriver" class="md-raised md-warn textAlign-C" ng-click="fulFillRequest($event, requesterDetails.fulfillAssignObject, 'assignTo')" check-permission feature-privilege="{{featurePrivilegeConstants.AMBULANCEREQUEST_ADD}}">{{"ASSIGN_TO"|translate}}</md-button></div></div></info-window><directions draggable="true" suppress-markers="true" panel="direction" travel-mode="{{data.travelMode.value}}" origin="{{source}}" destination="{{destination}}" suppressmarkers="true"></directions></ng-map></div><div class="col-sm-12 col-md-3 col-lg-3 map-right" ng-if="isOnTheWay && isMapVisible"><div><md-button type="button" class="md-raised md-warn fullWidth" style="margin-bottom: 10px" ng-click="driverMapBackToLocation()">{{"BACK_TO_MY_PREVIOUS_LOCATION"|translate}}</md-button></div></div></div></div>