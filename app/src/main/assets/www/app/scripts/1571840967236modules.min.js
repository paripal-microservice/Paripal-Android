/*! paripal - v1.0.0 - 2019-10-23 */angular.module("paripal.advanceSharing",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("advancesharinglist",{url:"/advancesharinglist/:type/:id/:orgLocId",params:{type:null,id:null,orgLocId:null},controller:"AdvanceSharingCtrl",templateUrl:"app/modules/advance-sharing/views/treeMenu.html",ncyBreadcrumb:{label:"ADVANCE_SHARING"}})}]),angular.module("paripal.appointmentModule",[]).config(["$stateProvider",function(a){"use strict";a.state("equipmentList",{url:"/equipmentList",controller:"EquipmentListCtrl",templateUrl:"app/modules/appointment/views/equipment-list.html",params:{type:null},ncyBreadcrumb:{label:"SEARCH_EQUIPMENT_MAPPING_WITH_PROFESSIONAL"}}).state("manageEquipment",{url:"/manageEquipment/:type/:id",controller:"ManageEquipmentCtrl",templateUrl:"app/modules/appointment/views/manage-equipment.html",params:{type:null,id:null},ncyBreadcrumb:{label:"MANAGE_EQUIPMENT_MAPPING_WITH_PROFESSIONAL",actionType:"add"}}).state("manageAppointmentMedication",{url:"/manageAppointmentMedication",controller:"ManageAppointmentMedicationCtrl",templateUrl:"app/modules/appointment/views/manage-appointment-medication.html",params:{type:null,userId:null,medicationObj:null,fromState:null,appointmentId:null},ncyBreadcrumb:{label:"APPOINTMENT_MEDICATION_DETAILS",actionType:"add"}}).state("processAssociationList",{url:"/processAssociationList",controller:"ProcessAssociationListCtrl",templateUrl:"app/modules/appointment/views/process-associate-user-list.html",params:{type:null},ncyBreadcrumb:{label:"PROCESS-ASSOCIATED_ORG_USER-ACCESS_RIGHTS"}}).state("manageProcessAccessRight",{url:"/manageProcessAccessRight/:type/:id",controller:"ManageProcessAssociationCtrl",templateUrl:"app/modules/appointment/views/manage-process-access-right.html",params:{type:null,id:null},ncyBreadcrumb:{label:"MANAGE_ACCESS_RIGHT",actionType:"add"}}).state("appointmentsList",{url:"/appointmentsList",controller:"AppointmentsListCtrl",templateUrl:"app/modules/appointment/views/appointments-list.html",params:{type:null,event:null,apptDate:null,entityName:null,loadFilter:null,menuName:null},ncyBreadcrumb:{label:"APPOINTMENTS_LIST"}}).state("appointmentsListCardView",{url:"/appointmentsListCardView",controller:"AppointmentCardViewCtrl",templateUrl:"app/modules/appointment/views/appointment-card-view.html",params:{type:null,event:null,apptDate:null,entityName:null,loadFilter:null,keepLocalStorage:null},ncyBreadcrumb:{label:"APPOINTMENTS_LIST"}}).state("individualAppointmentsList",{url:"/individualAppointmentsList",controller:"IndividualAppointmentListCtrl",templateUrl:"app/modules/appointment/views/individual-appointment-list.html",params:{type:null,event:null,apptDate:null,entityName:null,fromHomeView:null,orgLoc:null,onBehalfOf:null},ncyBreadcrumb:{label:"APPOINTMENTS_LIST"}}).state("equipmentAppointmentsList",{url:"/equipmentAppointmentsList",controller:"EquipmentAppointmentListCtrl",templateUrl:"app/modules/appointment/views/equipment-appointment-list.html",params:{type:null,event:null,apptDate:null,entityName:null,fromHomeView:null},ncyBreadcrumb:{label:"APPOINTMENTS_LIST"}}).state("doctorsAppointmentsList",{url:"/doctorsAppointmentsList",controller:"DoctorsAppointmentListCtrl",templateUrl:"app/modules/appointment/views/doctors-appointment-list.html",params:{type:null,event:null,apptDate:null,entityName:null},ncyBreadcrumb:{label:"APPOINTMENTS_LIST"}}).state("cancelAppointmentList",{url:"/cancelAppointmentList/:type/:eventId",controller:"CancelPostponeAppointmentListCtrl",templateUrl:"app/modules/appointment/views/cancel-postpone-appointment-list.html",params:{type:"cancel",eventId:null,date:null},ncyBreadcrumb:{label:"CANCEL_APPOINTMENTS_LIST"}}).state("postponeAppointmentList",{url:"/postponeAppointmentList/:type/:eventId",controller:"CancelPostponeAppointmentListCtrl",templateUrl:"app/modules/appointment/views/cancel-postpone-appointment-list.html",params:{type:"postpone",eventId:null},ncyBreadcrumb:{label:"POSTPONE_APPOINTMENTS_LIST"}}).state("manageFixAppointment",{url:"/manageFixAppointment/:type/:appointmentId",controller:"ManageFixAppointmentCtrl",templateUrl:"app/modules/appointment/views/manage-fix-appointment.html",params:{type:null,appointmentId:null,entityType:null,entityName:null,eventType:null,eventName:null,apptDate:null,apptStartTime:null,apptEndTime:null,slotId:null,fromState:null,orgLocation:null,otp:null,accessKeyId:null,isEventException:null,eventExceptionId:null,typeOfService:null,probDescription:null,onBehalfOf:null,onBehalfOfAddress:null,startTime:null,endTime:null,contactNo:null,onBehalfOfUHID:null,dprUserId:null},ncyBreadcrumb:{label:"MANAGE_FIX_APPOINTMENT",actionType:"add"}}).state("userAppointmentStatus",{url:"/userAppointmentStatus/:appoinmentId/:eventId/:eventDate",controller:"UserAppointmentStatusCtrl",templateUrl:"app/modules/appointment/views/user-view-appointment-status.html",params:{type:null,appoinmentId:null,eventId:null,eventDate:null,calendarState:null,callingPage:null},ncyBreadcrumb:{label:"USER_VIEW_APPOINTMENT_STATUS",actionType:"add"}}).state("patientActivityList",{url:"/patientActivityList/:apptId",controller:"PatientActivityListCtrl",templateUrl:"app/modules/appointment/views/patient-activity-list.html",params:{type:null,apptId:null},ncyBreadcrumb:{label:"PATIENT_ACTIVITY_CHECK_IN_CHECK_OUT"}}).state("manageAppointmentCheckIn",{url:"/manageAppointmentCheckIn/:appointmentType/:appointmentId",controller:"ManageCheckInOutAllotCtrl",templateUrl:"app/modules/appointment/views/manage-check-in-out.html",params:{appointmentType:"CHECKEDIN",urlState:null,clientId:null,appointmentId:null,entityType:null,entityName:null,eventType:null,eventName:null,apptDate:null,apptEndTime:null,apptStartTime:null,orgLocation:null,locationName:null},ncyBreadcrumb:{label:"MANAGE_CHECKEDIN"}}).state("manageAppointmentCheckOut",{url:"/manageAppointmentCheckOut/:appointmentType/:appointmentId",controller:"ManageCheckInOutAllotCtrl",templateUrl:"app/modules/appointment/views/manage-check-in-out.html",params:{appointmentType:"CHECKEDOUT",urlState:null,clientId:null,appointmentId:null,entityType:null,entityName:null,eventType:null,eventName:null,apptDate:null,apptEndTime:null,apptStartTime:null,orgLocation:null,locationName:null},ncyBreadcrumb:{label:"MANAGE_CHECKEDOUT"}}).state("manageAppointmentAllot",{url:"/manageAppointmentAllot/:appointmentType/:appointmentId",controller:"ManageCheckInOutAllotCtrl",templateUrl:"app/modules/appointment/views/manage-check-in-out.html",params:{appointmentType:"ALLOCATED",urlState:null,clientId:null,appointmentId:null,entityType:null,entityName:null,eventType:null,eventName:null,apptDate:null,apptEndTime:null,apptStartTime:null,orgLocation:null},ncyBreadcrumb:{label:"MANAGE_ALLOCATED"}}).state("manageAppointmentForward",{url:"/manageAppointmentForward/:appointmentType/:appointmentId",controller:"ManageCheckInOutAllotCtrl",templateUrl:"app/modules/appointment/views/manage-check-in-out.html",params:{appointmentType:"FORWARDED",urlState:null,clientId:null,appointmentId:null,entityType:null,entityName:null,eventType:null,eventName:null,apptDate:null,apptEndTime:null,apptStartTime:null,orgLocation:null},ncyBreadcrumb:{label:"MANAGE_FORWARDED"}}).state("manageAppointmentWalkIn",{url:"/manageAppointmentWalkIn/:appointmentType/:appointmentId",controller:"ManageCheckInOutAllotCtrl",templateUrl:"app/modules/appointment/views/manage-check-in-out.html",params:{appointmentType:"RECORDWALKIN",urlState:null,appointmentId:null,entityType:null,entityName:null,eventType:null,eventName:null,apptDate:null,apptEndTime:null,apptStartTime:null,clientId:null,orgLocation:null,calendarState:null,callingPage:null,locationName:null,requestId:null},ncyBreadcrumb:{label:"MANAGE_RECORDWALKIN"}}).state("appointmentsuploadlist",{url:"/appointmentsuploadlist",controller:"AppointmentUploadDownloadCtrl",templateUrl:"app/modules/appointment/views/appointments-upload-download.html",params:{type:null,data:null},ncyBreadcrumb:{label:"APPOINTMENTS_UPLOAD_DOWNLOAD"}}).state("appointmentnotes",{url:"/appointmentnotes/:appointmentId",controller:"AppointmentNotesCtrl",templateUrl:"app/modules/appointment/views/appointment-notes.html",params:{type:null,data:null,appointmentId:null,otp:null,accessKeyId:null,callingUrl:null,isCustomAppointment:null},ncyBreadcrumb:{label:"APPOINTMENT_NOTES"}}).state("requestsuploadlist",{url:"/requestsuploadlist",controller:"RequestUploadDownloadCtrl",templateUrl:"app/modules/appointment/views/requests-upload-download.html",params:{type:null,data:null},ncyBreadcrumb:{label:"REQUESTS_UPLOAD_DOWNLOAD"}}).state("appointmentmanagement",{url:"/appointmentmanagement",controller:"AppointmentsManagementCtrl",templateUrl:"app/modules/appointment/views/appointment-management.html",ncyBreadcrumb:{label:"APPOINTMENT_MANAGEMENT"}}).state("managedefineschedule",{url:"/managedefineschedule/:type/:scheduleId",controller:"ManageAppointmentScheduleCtrl",templateUrl:"app/modules/appointment/views/manage-appointment-schedule.html",params:{type:null,parentState:null,scheduleId:null,entityType:null,eventType:null,serviceType:null,onBehalfOf:null,doctor:null,problemDescription:null,loggedInUserId:null,onBehalfOfCellPhone:null,onBehalfOfAddress:null,parentType:null,parentId:null,requestId:null,fromDate:null,tillDate:null},ncyBreadcrumb:{label:"DEFINE_SCHEDULE"}}).state("summarydata",{url:"/summarydata",controller:"SummaryDataCtrl",templateUrl:"app/modules/appointment/views/system-summary.html",params:{rowObject:null,selectedCat:null},ncyBreadcrumb:{label:"SUMMARY_DATA"}}).state("allergylist",{url:"/allergylist",controller:"AllergyListCtrl",templateUrl:"app/modules/appointment/views/allergy-list.html",params:{rowObject:null},ncyBreadcrumb:{label:"ALLERGY_LIST"}}).state("followupactions",{url:"/followupactions",controller:"FollowUpActionsCtrl",templateUrl:"app/modules/appointment/views/follow-up-actions.html",params:{rowObject:null},ncyBreadcrumb:{label:"FOLLOW_UP_ACTIONS"}})}]),angular.module("paripal.articlesModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("articles",{url:"/articles",controller:"ArticleListCtrl",templateUrl:"app/modules/article/views/article-list.html",ncyBreadcrumb:{label:"ARTICLES"},params:{callingUrl:null,userData:null,type:null}})}]),angular.module("paripal.auditReportModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("userUsageList",{url:"/userUsageList",controller:"UserUsageListCtrl",templateUrl:"app/modules/audit/views/user_usage_list.html",ncyBreadcrumb:{label:"USER_USAGE_LIST"}}).state("systemUsageList",{url:"/systemUsageList",controller:"SystemUsageListCtrl",templateUrl:"app/modules/audit/views/system_usage_list.html",ncyBreadcrumb:{label:"SYSTEM_USAGE_LIST"}}).state("securedAPIUsageList",{url:"/securedAPIUsageList",controller:"SecuredApiUsageListCtrl",templateUrl:"app/modules/audit/views/secured_api_usage.html",ncyBreadcrumb:{label:"SECURED_API_USAGE_LIST"}}).state("loginHistoryList",{url:"/loginHistoryList",controller:"LoginHistoryListCtrl",templateUrl:"app/modules/audit/views/login_history_list.html",ncyBreadcrumb:{label:"LOGIN_HISTORY"}})}]),/**
 * Creating authentication module for authenticate user,register user etc.
 *
 */
angular.module("paripal.autheticationModule",[]),angular.module("paripal.autheticationModule").config(["$stateProvider","$authProvider",function(a,b){a.state("login",{url:"/login?token",templateUrl:"app/modules/authentication/views/login.html",resolve:{user:["$auth","$q",function(a,b){if(a.isAuthenticated())return b.reject({authorized:!0})}]},params:{callbackState:null,callbackUrl:null,username:null},controller:"AuthenticationCtrl"}).state("logout",{url:"/logout",controller:"AuthenticationCtrl"}).state("forgotId",{url:"/forgotid",templateUrl:"app/modules/authentication/views/forgot-id.html",controller:"AuthenticationCtrl"}).state("forgotPassword",{url:"/forgotpassword",templateUrl:"app/modules/authentication/views/forgot-password.html",controller:"AuthenticationCtrl"}).state("changePassword",{url:"/changepassword/:userId",templateUrl:"app/modules/authentication/views/change-password.html",controller:"AuthenticationCtrl",params:{userId:null}}).state("resetPassword",{url:"/resetpassword",templateUrl:"app/modules/authentication/views/reset-password.html",controller:"AuthenticationCtrl"}).state("newUserSignIn",{url:"/newusersignin",templateUrl:"app/modules/authentication/views/new-user-sign-in.html",controller:"RegisterCtrl"}).state("individualUserSignUp",{url:"/individualusersignup",templateUrl:"app/modules/authentication/views/individual-user-sign-up.html",controller:"RegisterCtrl",params:{fromIndividualUserSignUp:!0}}).state("trustedUserSignIn",{url:"/trustedusersignin/:accessToken/:paripalClientId/:stateName",templateUrl:"app/modules/authentication/views/trusted-user-sign-in.html",controller:"TrustedUserCtrl",params:{accessToken:null,paripalClientId:null,stateName:null}}),b.httpInterceptor=function(){return!0},b.withCredentials=!0,b.tokenRoot=null,b.signupUrl="/auth/signup",b.unlinkUrl="/auth/unlink/",b.tokenName="token",b.tokenPrefix="paripal",b.authHeader="Authorization",b.authToken="Bearer",b.storageType="localStorage"}]),/**
 * Creating base module   
 * 
 */
angular.module("baseModule",[]),angular.module("baseModule").config(function(){}),angular.module("paripal.benchmarkChartDataModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("benchmarkchartdatalist",{url:"/benchmarkchartdatalist",controller:"ManageBenchmarkChartDataCtrl",params:{recordId:null,fromPage:null,clientId:null},templateUrl:"app/modules/benchmark-chart-data/views/benchmark-chart-data-list.html",ncyBreadcrumb:{label:"BENCHMARK_LIST"}}).state("managebenchmarkchartdata",{url:"/managebenchmarkchartdata",controller:"ManageBenchmarkChartDataCtrl",templateUrl:"app/modules/benchmark-chart-data/views/manage-benchmark-chart-data.html",ncyBreadcrumb:{label:"MANAGE_BENCHMARK_CHART",actionType:"add",parent:"benchmarkchartdatalist"}}).state("addbenchmarkparameterdata",{url:"/addbenchmarkparameterdata",controller:"ManageBenchmarkChartDataCtrl",templateUrl:"app/modules/benchmark-chart-data/views/manage-benchmark-parameters-data.html",ncyBreadcrumb:{label:"MANAGE_BENCHMARK_PARAMETER_CHART",actionType:"add",parent:"managebenchmarkchartdata"}}).state("addparameterdata",{url:"/addparameterdata",controller:"ManageBenchmarkChartDataCtrl",templateUrl:"app/modules/benchmark-chart-data/views/manage-parameters-data.html",ncyBreadcrumb:{label:"ADD_PARAMETER",actionType:"add",parent:"addbenchmarkparameterdata"}}).state("chartParameterList",{url:"/chartParameterList",controller:"BenchmarkChartParameterListCtrl",templateUrl:"app/modules/benchmark-chart-data/views/benchmark-chart-parameter-list.html",ncyBreadcrumb:{label:"BENCHMARK_PARAM_LIST"}}).state("indicatorBenchmarkChartList",{url:"/indicatorBenchmarkChartList",params:{indicator:null},controller:"IndicatorBenchmarkChartListCtrl",templateUrl:"app/modules/benchmark-chart-data/views/indicator-benchmark-chart-list.html",ncyBreadcrumb:{label:"BENCHMARK_CHART_LIST"}}).state("testBenchmarkChartList",{url:"/testBenchmarkChartList",params:{test:null},controller:"TestBenchmarkChartListCtrl",templateUrl:"app/modules/benchmark-chart-data/views/test-benchmark-chart-list.html",ncyBreadcrumb:{label:"BENCHMARK_CHART_LIST"}}).state("manageBenchmarkConditions",{url:"/manageBenchmarkConditions",params:{test:null,data:null},controller:"ManageBenchmarkConditionsCtrl",templateUrl:"app/modules/benchmark-chart-data/views/benchmark-conditions.html",ncyBreadcrumb:{label:"BENCHMARK_CONDITIONS"}})}]),angular.module("paripal.benchmarkChartModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("benchmarkimageitem",{url:"/benchmarklist",controller:"BenchmarkImageListCtrl",templateUrl:"app/modules/benchmark-chart/views/benchmark-image-list.html",ncyBreadcrumb:{label:"BENCHMARK_CHART_LIST"}})}]),angular.module("paripal.billingSetupModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("feeheadlist",{url:"/feeheadlist",controller:"FeeHeadListCtrl",templateUrl:"app/modules/billing-setup/views/fee-head-list.html",ncyBreadcrumb:{label:"FEE_HEAD_LIST"}}).state("managefeehead",{url:"/managefeehead",controller:"ManageFeeHeadCtrl",templateUrl:"app/modules/billing-setup/views/manage-fee-head.html",ncyBreadcrumb:{parent:"feeheadlist",label:"MANAGE_FEE_HEAD",actionType:"add"},params:{data:null,type:null}}).state("feetypelist",{url:"/feetypelist",controller:"FeeTypeListCtrl",templateUrl:"app/modules/billing-setup/views/fee-type-list.html",ncyBreadcrumb:{label:"FEE_TYPE_LIST"}}).state("managefeetype",{url:"/managefeetype",controller:"ManageFeeTypeCtrl",templateUrl:"app/modules/billing-setup/views/manage-fee-type.html",ncyBreadcrumb:{parent:"feetypelist",label:"MANAGE_FEE_TYPE",actionType:"add"},params:{data:null,type:null}}).state("feetypefeeschedule",{url:"/feetypefeeschedule",controller:"FeeTypeFeeScheduleCtrl",templateUrl:"app/modules/billing-setup/views/fee-type-fee-schedule.html",ncyBreadcrumb:{parent:"feetypelist",label:"VIEW_FEE_SCHEDULES"},params:{data:null,type:null}}).state("currencyexchangelist",{url:"/currencyexchangelist",controller:"CurrencyExchangeListCtrl",templateUrl:"app/modules/billing-setup/views/currency-exchange-list.html",ncyBreadcrumb:{label:"CURRENCY_EXCHANGE_LIST"},params:{data:null,type:null}}).state("orgsubscriptionlist",{url:"/orgsubscriptionlist",controller:"OrgSubscriptionListCtrl",templateUrl:"app/modules/billing-setup/views/org-subscription-list.html",ncyBreadcrumb:{label:"ORGANIZATION_SUBSCRIPTION_LIST"},params:{data:null,type:null}}).state("individualsubscriptionlist",{url:"/individualsubscriptionlist",controller:"IndividualSubscriptionListCtrl",templateUrl:"app/modules/billing-setup/views/individual-subscription-list.html",ncyBreadcrumb:{label:"INDIVIDUAL_SUBSCRIPTION_LIST"},params:{data:null,type:null}}).state("createUserSubscription",{url:"/createUserSubscription",controller:"CreateUserSubscriptionCtrl",templateUrl:"app/modules/billing-setup/views/create-user-subscription.html",ncyBreadcrumb:{label:"CREATE_USER_SUBSCRIPTION"},params:{data:null,type:null,subscriptionId:null}}).state("managesponsoreduser",{url:"/managesponsoreduser",controller:"ManageSponsoredUserListCtrl",templateUrl:"app/modules/billing-setup/views/manage-sponsored-user.html",ncyBreadcrumb:{label:"MANAGE_SPONSORED_USER_LIST"},params:{data:null,type:null}}).state("manageorgsubscription",{url:"/manageorgsubscription",controller:"ManageOrgSubscriptionCtrl",templateUrl:"app/modules/billing-setup/views/manage-org-subscription.html",ncyBreadcrumb:{parent:"orgsubscriptionlist",label:"MANAGE_ORGANIZATION_SUBSCRIPTION",actionType:"add"},params:{data:null,type:null}}).state("locationsubscriptionlist",{url:"/locationsubscriptionlist",controller:"OrgLocSubscriptionListCtrl",templateUrl:"app/modules/billing-setup/views/org-loc-subscription-list.html",ncyBreadcrumb:{label:"ORGANIZATION_LOCATION_SUBSCRIPTION_LIST"},params:{data:null,type:null}}).state("managelocationsubscription",{url:"/managelocationsubscription",controller:"ManageOrgLocSubscriptionCtrl",templateUrl:"app/modules/billing-setup/views/manage-org-loc-subscription.html",ncyBreadcrumb:{parent:"locationsubscriptionlist",label:"MANAGE_ORGANIZATION_LOCATION_SUBSCRIPTION",actionType:"add"},params:{data:null,type:null}}).state("subscriptiontypelist",{url:"/subscriptiontypelist",controller:"SubscriptionTypeListCtrl",templateUrl:"app/modules/billing-setup/views/subscription-type-list.html",ncyBreadcrumb:{label:"SUBSCRIPTION_TYPE_LIST"},params:{data:null,type:null}}).state("managesubscriptiontype",{url:"/managesubscriptiontype",controller:"ManageSubscriptionTypeCtrl",templateUrl:"app/modules/billing-setup/views/manage-subscription-type.html",ncyBreadcrumb:{parent:"subscriptiontypelist",label:"MANAGE_SUBSCRIPTION_TYPE",actionType:"add"},params:{data:null,type:null}})}]),angular.module("paripal.billingModule",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("searchbill",{url:"/searchbill",params:{type:null,data:null,searchType:null},controller:"SearchBillCtrl",templateUrl:"app/modules/billing/views/search-bill-view.html",ncyBreadcrumb:{label:"SEARCH_BILL"}}).state("mybills",{url:"/mybills",params:{type:null,data:null,searchType:"mybills"},controller:"SearchMyBillCtrl",templateUrl:"app/modules/billing/views/search-my-bill.html",ncyBreadcrumb:{label:"BILL_LIST"}}).state("mypaymentrefunds",{url:"/mypaymentrefunds",params:{type:null,data:null,searchType:"myReceipts"},controller:"SearchMyReceiptCtrl",templateUrl:"app/modules/billing/views/search-my-receipt.html",ncyBreadcrumb:{label:"MY_PAYMENTS_AND_REFUNDS"}}).state("searchreceipt",{url:"/searchreceipt",params:{type:null,data:null},controller:"SearchReceiptCtrl",templateUrl:"app/modules/billing/views/search-receipt-view.html",ncyBreadcrumb:{label:"RECEIPT_PAYMENT_LIST"}}).state("managereceiptpayment",{url:"/managereceiptpayment/:receiptId/:type",params:{type:null,data:null},controller:"AddPaymentReceiptCtrl",templateUrl:"app/modules/billing/views/add-payment-receipt.html",ncyBreadcrumb:{label:"MANAGE_RECEIPT_PAYMENT",parent:"searchreceipt",actionType:""}}).state("billsettlementview",{url:"/billsettlementview/:billId/:billTypeCode/:pageFrom",params:{type:null,billId:null,billTypeCode:null,pageFrom:null},controller:"BillSettlementViewCtrl",templateUrl:"app/modules/billing/views/bill-settlement-view.html",ncyBreadcrumb:{label:"BILL_SETTLEMENT",parent:"searchbill"}}).state("receiptsettlementview",{url:"/receiptsettlementview/:id/:receiptType",params:{type:null,data:null,receiptData:null,pageFrom:null},controller:"ReceiptPaymentSettlementViewCtrl",templateUrl:"app/modules/billing/views/receipt-payment-settlement-view.html",ncyBreadcrumb:{label:"RECEIPT_PAYMENT_SETTLEMENT",parent:"searchreceipt"}}).state("managebill",{url:"/managebill/:type/:billId",params:{type:null,data:null,parentState:null,parentParams:null,createReceipt:null,appointmentDetails:null,showAutoPDF:null},controller:"ManageBillCtrl",templateUrl:"app/modules/billing/views/manage-bill.html",ncyBreadcrumb:{label:"MANAGE_BILL",parent:"searchbill",actionType:""}}).state("createbill",{url:"/createbill/:billId",params:{type:null,data:null,feeHeadAmnt:null,parentState:null,parentParams:null,pageState:null,isCreateReceipt:null,isFromBillList:null,serviceTypeList:null,transactionList:null},controller:"CreateBillCtrl",templateUrl:"app/modules/billing/views/create-bill.html",ncyBreadcrumb:{label:"CREATE_BILL",parent:"searchbill"}}).state("managebillsettlement",{url:"/managebillsettlement/:id/:type/:billType/:targetTypeCode/:settlementId",params:{type:null,billObject:null,billAdjustmentObject:null},controller:"ManageBillSettlementCtrl",templateUrl:"app/modules/billing/views/manage-bill-settlement.html",ncyBreadcrumb:{label:"MANAGE_BILL_SETTLEMENT",parent:"billsettlementview",actionType:"add"}}).state("managereceiptsettlement",{url:"/managereceiptsettlement/:id/:type/:sourceTypeCode/:targetTypeCode/:settlementId",params:{type:null,data:null,receiptObject:null},controller:"ManageReceiptPaymentSettlementCtrl",templateUrl:"app/modules/billing/views/manage-receipt-payment-settlement.html",ncyBreadcrumb:{label:"MANAGE_RECEIPT_SETTLEMENT",parent:"receiptsettlementview",actionType:"add"}}).state("searchclientbill",{url:"/searchclientbill",params:{type:"clientSearch",data:null,searchType:"searchClientBill"},controller:"SearchClientBillCtrl",templateUrl:"app/modules/billing/views/search-client-bill.html",ncyBreadcrumb:{label:"SEARCH_CLIENT_BILL"}}).state("searchprofessionalbill",{url:"/searchprofessionalbill",params:{type:"professionalSearch",data:null,searchType:"searchProfessionalBill"},controller:"SearchProfessionalBillCtrl",templateUrl:"app/modules/billing/views/search-professional-bill.html",ncyBreadcrumb:{label:"SEARCH_PROFESSIONAL_BILL"}}).state("searchclientreceipt",{url:"/searchclientreceipt",params:{type:"clientSearch",data:null,searchType:"searchClientReceipt"},controller:"SearchClientReceiptCtrl",templateUrl:"app/modules/billing/views/search-client-receipt.html",ncyBreadcrumb:{label:"SEARCH_CLIENT_RECEIPT_PAYMENT"}}).state("searchprofessionalreceipt",{url:"/searchprofessionalreceipt",params:{type:"professionalSearch",data:null,searchType:"searchProfessionalReceipt"},controller:"SearchProfessionalReceiptCtrl",templateUrl:"app/modules/billing/views/search-professional-receipt.html",ncyBreadcrumb:{label:"PROFESSIONAL_RECEIPT_PAYMENT_LIST"}}).state("billsummaryview",{url:"/billsummaryview/:transactionId/:status",params:{type:null,data:null,searchType:null},controller:"BillSummaryViewCtrl",templateUrl:"app/modules/billing/views/bill-summary-view.html",ncyBreadcrumb:{label:"BILL_DETAILS"}}).state("accountstatement",{url:"/accountstatement",params:{type:"professionalSearch",data:null,searchType:"searchProfessionalReceipt",wallData:null},controller:"AccountStatementCtrl",templateUrl:"app/modules/billing/views/account-statement-view.html",ncyBreadcrumb:{label:"ACCOUNT_STATEMENT"}}).state("receiptsummary",{url:"/receiptsummary/:receiptId",params:{type:"professionalSearch",data:null,searchType:"searchReceiptSummary"},controller:"ReceiptSummaryViewCtrl",templateUrl:"app/modules/billing/views/receipt-summary-view.html",ncyBreadcrumb:{label:"RECEIPT_SUMMARY",actionType:"add"}}).state("consolidatedbill",{url:"/consolidatedbill/:consolidatedbillId",params:{type:"view",data:null,billId:null},controller:"ConsolidatedBillCtrl",templateUrl:"app/modules/billing/views/consolidated-bill-view.html",ncyBreadcrumb:{label:"CONSOLIDATED_BILL"}})}]),angular.module("paripal.callAmbulance",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("callambulance",{url:"/callambulance",params:{type:null,id:null,callBackURL:null,callingScreen:null,data:null},controller:"CallAmbulanceCtrl",templateUrl:"app/modules/call-ambulance/views/call-ambulance.html",ncyBreadcrumb:{label:"CALL_AMBULANCE"}}).state("callambulancedriver",{url:"/callambulancedriver",params:{type:null,id:null},controller:"CallAmbulanceDriverCtrl",templateUrl:"app/modules/call-ambulance/views/call-ambulance-driver.html",ncyBreadcrumb:{label:"CALL_AMBULANCE_DRIVER"}}).state("ambulancerequest",{url:"/ambulancerequest",params:{driverId:null,ambulanceId:null},controller:"AmbulanceRequestCtrl",templateUrl:"app/modules/call-ambulance/views/ambulance-request.html",ncyBreadcrumb:{label:"AMBULANCE_REQUEST"}}).state("ambulancerequestallocation",{url:"/ambulancerequestallocation/:ambulanceReqId",params:{ambulanceReqId:null,userData:null},controller:"AmbulanceRequestAllocationCtrl",templateUrl:"app/modules/call-ambulance/views/ambulance-request-allocation.html",ncyBreadcrumb:{label:"AMBULANCE_REQUEST_ALLOCATION"}})}]),angular.module("paripal.complaintsModule",[]).config(["$stateProvider",function(a){"use strict";a.state("complaintsList",{url:"/complaintsList",controller:"ComplaintsListCtrl",templateUrl:"app/modules/complaints/views/complaints-list.html",params:{type:null,complaintId:null,complaintCode:null,orgLocId:null,fromState:null},ncyBreadcrumb:{label:"COMPLAINT_LIST"}}).state("addComplaints",{url:"/addComplaints/:type",controller:"ManageComplaintsCtrl",templateUrl:"app/modules/complaints/views/add-complaints.html",params:{type:"add",navigateFrom:null,complaintId:null,complaintCode:null},ncyBreadcrumb:{label:"MANAGE_COMPLAINTS",actionType:"add"}}).state("manageComplaints",{url:"/manageComplaints/:type/:complaintId",controller:"ManageComplaintsCtrl",templateUrl:"app/modules/complaints/views/manage-complaints.html",params:{type:null,navigateFrom:null,complaintId:null,complaintCode:null},ncyBreadcrumb:{label:"MANAGE_COMPLAINTS",actionType:"add"}}).state("serviceLevelList",{url:"/serviceLevelList",controller:"ServiceLevelListCtrl",templateUrl:"app/modules/complaints/views/service-level-list.html",params:{type:null,complaintType:null,organizationLocation:null,complaintServiceLevelId:null},ncyBreadcrumb:{label:"SERVICE_LEVEL_LIST"}}).state("manageServiceLevel",{url:"/manageServiceLevel/:type/:complaintServiceLevelId",controller:"ManageServiceLevelCtrl",templateUrl:"app/modules/complaints/views/manage-service-level.html",params:{type:null,complaintServiceLevelId:null,organizationLocation:null},ncyBreadcrumb:{label:"MANAGE_COMPLAINT_SERVICE_LEVELS",actionType:"add"}}).state("followUpList",{url:"/followupList",controller:"FollowUpListCtrl",templateUrl:"app/modules/complaints/views/followup-list.html",params:{type:null,complaintId:null,complaintCode:null},ncyBreadcrumb:{label:"VIEW_FOLLOW_UP_LIST"}}).state("manageFollowUp",{url:"/manageFollowUp/:type/:complaintFollowUpId",controller:"ManageFollowUpCtrl",templateUrl:"app/modules/complaints/views/manage-followup.html",params:{type:null,complaintId:null,complaintCode:null,complaintFollowUpId:null},ncyBreadcrumb:{label:"MANAGE_FOLLOW_UP",actionType:"add"}}).state("complaintAttachmentList",{url:"/complaintAttachmentList",controller:"AttachmentListCtrl",templateUrl:"app/modules/complaints/views/attachment-list.html",params:{type:null,complaintId:null,complaintCode:null},ncyBreadcrumb:{label:"COMPLAINT_ATTACHMENT_LIST"}}).state("manageComplaintAttachment",{url:"/manageComplaintAttachment/:type/:complaintId/:complaintAttachmentId",controller:"ManageAttachmentCtrl",templateUrl:"app/modules/complaints/views/manage-complaint-attachment.html",params:{type:null,complaintId:null,complaintCode:null,complaintAttachmentId:null},ncyBreadcrumb:{label:"MANAGE_COMPLAINT_ATTACHMENT",actionType:"add"}})}]),angular.module("paripal.dataSettingsModule",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("servicetypesearch",{url:"/servicetypesearch",params:{type:null,data:null},controller:"ViewServiceTypeListCtrl",templateUrl:"app/modules/data-settings/views/service-type-list.html",ncyBreadcrumb:{label:"SERVICE_TYPE_SEARCH"}}).state("manageServiceType",{url:"/manageServiceType",params:{type:null,data:null},controller:"ManageServiceTypeCtrl",templateUrl:"app/modules/data-settings/views/manage-service-type.html",ncyBreadcrumb:{label:"MANAGE_SERVICE_TYPE",parent:"servicetypesearch",actionType:"add"}}).state("feeschedulesearch",{url:"/feeschedulesearch",params:{type:null,data:null,callingUrl:null},controller:"ViewFeeScheduleListCtrl",templateUrl:"app/modules/data-settings/views/fee-schedule-list.html",ncyBreadcrumb:{label:"SEARCH_FEE_SCHEDULE"}}).state("manageFeeSchedule",{url:"/manageFeeSchedule",params:{type:null,data:null},controller:"ManageFeeScheduleCtrl",templateUrl:"app/modules/data-settings/views/manage-fee-schedule.html",ncyBreadcrumb:{label:"MANAGE_FEE_SCHEDULE",parent:"feeschedulesearch",actionType:"add"}}).state("feeSchedulefeehead",{url:"/feeSchedulefeehead",params:{type:null,data:null,callingUrl:null},controller:"feeScheduleFeeHeadListCtrl",templateUrl:"app/modules/data-settings/views/fee-schedule-fee-head-list.html",ncyBreadcrumb:{label:"FEE_HEAD_LIST",parent:"feeschedulesearch"}}).state("associatefeehead",{url:"/associatefeehead",params:{type:null,data:null},controller:"AssociateFeeHeadCtrl",templateUrl:"app/modules/data-settings/views/associate-fee-head.html",ncyBreadcrumb:{label:"ASSOCIATE_FEE_HEAD",parent:"feeSchedulefeehead",actionType:"add"}}).state("pricelistsearch",{url:"/pricelistsearch",params:{type:null,data:null},controller:"PriceListSearchCtrl",templateUrl:"app/modules/data-settings/views/price-list-search.html",ncyBreadcrumb:{label:"PRICE_LIST"}})}]),angular.module("paripal.userTestDocumentModule",[]).config(["$stateProvider",function(a){"use strict";a.state("usertestdocumentlist",{url:"/usertestdocumentlist",params:{data:null,type:null},templateUrl:"app/modules/diagnostic-test-user-documents/views/user-test-documents-list.html",controller:"UserTestDocumentsListCtrl",ncyBreadcrumb:{label:"USER_TEST_REPORT_LIST",parent:"usertestlist"}})}]),angular.module("paripal.diseaseManagementModule",[]).config(["$stateProvider",function(a){a.state("searchDiseases",{url:"/searchDiseases",controller:"searchDiseaseReqCtrl",templateUrl:"app/modules/disease-management/views/search-diseases.html",ncyBreadcrumb:{label:"SEARCH_DISEASE"}}).state("manageDiseases",{url:"/manageDiseases/:id/:type",params:{fromState:"manageDiseases",type:"add",data:null},controller:"manageDiseaseReqCtrl",templateUrl:"app/modules/disease-management/views/manage-diseases.html",ncyBreadcrumb:{label:"MANAGE_DISEASE",actionType:"add"}}).state("searchDiseaseVariants",{url:"/searchDiseaseVariants/:diseaseId",controller:"searchDiseaseVariantsReqCtrl",templateUrl:"app/modules/disease-management/views/search-disease-variants.html",ncyBreadcrumb:{label:"SEARCH_DISEASE_VARIANTS"}}).state("manageDiseaseVariants",{url:"/manageDiseaseVariants/:id/:type",controller:"manageDiseaseVariantsReqCtrl",templateUrl:"app/modules/disease-management/views/manage-disease-variants.html",params:{fromState:"manageDiseaseVariants",type:"add",data:null},ncyBreadcrumb:{label:"MANAGE_DISEASE_VARIANTS",actionType:"add"}}).state("searchDiseaseMedication",{url:"/searchDiseaseMedication/:diseaseVariantId/:diseaseVariant/:disease",controller:"searchDiseaseMedicationCtrl",templateUrl:"app/modules/disease-management/views/search-disease-medication.html",ncyBreadcrumb:{label:"SEARCH_DISEASE_MEDICATION"}}).state("manageDiseaseMedication",{url:"/manageDiseaseMedication/:id/:type",params:{fromState:"manageDiseaseMedication",type:"add",data:null},controller:"manageDiseaseMedicationCtrl",templateUrl:"app/modules/disease-management/views/manage-disease-medication.html",ncyBreadcrumb:{label:"MANAGE_DISEASE_MEDICATION",parent:"searchDiseaseMedication",actionType:"add"}}).state("searchDiseaseIncidents",{url:"/searchDiseaseIncidents/:incidentTypeId/:incidentTypeName/:diseaseId/:diseaseName/:diseaseVariantId/:diseaseVariantName/:from",controller:"searchDiseaseIncidentsCtrl",templateUrl:"app/modules/disease-management/views/search-disease-incidents.html",ncyBreadcrumb:{label:"SEARCH_DISEASE_INCIDENTS",parent:"userincident"}}).state("manageDiseaseIncidents",{url:"/manageDiseaseIncidents/:id/:type",params:{fromState:"manageDiseaseIncidents",type:"add",data:null},controller:"manageDiseaseIncidentsCtrl",templateUrl:"app/modules/disease-management/views/manage-disease-incidents.html",ncyBreadcrumb:{label:"MANAGE_DISEASE_INCIDENTS",actionType:"add"}}).state("searchDiseaseSymptoms",{url:"/searchDiseaseSymptoms/:diseaseVariantId/:diseaseVariant/:disease/:symptomId",controller:"searchDiseaseSymptomsCtrl",templateUrl:"app/modules/disease-management/views/search-disease-symptoms.html",ncyBreadcrumb:{label:"SEARCH_DISEASE_SYMPTOMS"},params:{fromState:"searchDiseaseSymptoms",type:"add",data:null}}).state("manageDiseaseSymptoms",{url:"/manageDiseaseSymptoms/:id/:type",controller:"manageDiseaseSymptomCtrl",templateUrl:"app/modules/disease-management/views/manage-disease-symptoms.html",ncyBreadcrumb:{label:"MANAGE_DISEASE_SYMPTOMS",actionType:"add"},params:{fromState:"manageDiseaseSymptoms",type:"add",data:null}}).state("manageDiseaseSymptomsIncidents",{url:"/manageDiseaseSymptomsIncidents",controller:"manageDiseaseSymptomsIncidentsCtrl",templateUrl:"app/modules/disease-management/views/manage-disease-symptoms-incidents-link.html",ncyBreadcrumb:{label:"MANAGE_DISEASE_SYMPTOMS_INCIDENTS",actionType:"add"},params:{fromState:"manageDiseaseSymptomsIncidents",type:"add",data:null}}).state("searchDiseaseSymptomsIncidents",{url:"/searchDiseaseSymptomsIncidents/:incidentOrSymptomId/:value",controller:"searchDiseaseSymptomsIncidentsCtrl",templateUrl:"app/modules/disease-management/views/search-symptoms-incidents-disease-link.html",ncyBreadcrumb:{label:"SEARCH_DISEASE_SYMPTOMS_INCIDENTS"},params:{fromState:"searchDiseaseSymptomsIncidents",type:"add",data:null}}).state("searchDiseaseProtocols",{url:"/searchDiseaseProtocols",controller:"searchDiseaseProtocolCtrl",templateUrl:"app/modules/disease-management/views/search-disease-protocols.html",ncyBreadcrumb:{label:"SEARCH_DISEASE_PROTOCOLS"},params:{fromState:"searchDiseaseProtocols",type:"add",data:null}}).state("manageDiseaseProtocols",{url:"/manageDiseaseProtocols/:id/:type",controller:"manageDiseaseProtocolCtrl",templateUrl:"app/modules/disease-management/views/manage-disease-protocols.html",params:{fromState:"manageDiseaseProtocols",type:"add",data:null},ncyBreadcrumb:{label:"MANAGE_DISEASE_PROTOCOLS",actionType:"add"}}).state("viewDiseaseStatistics",{url:"/viewDiseaseStatistics/:diseaseId/:diseaseName/:diseaseVariantId/:diseaseVariantName/:from",controller:"viewDiseaseStatisticsCtrl",templateUrl:"app/modules/disease-management/views/view-disease-statistics.html",ncyBreadcrumb:{label:"VIEW_DISEASE_STATISTICS"}}).state("viewMedicationStatistics",{url:"/viewMedicationStatistics/:medicationId/:medicationName/:medicationVariantId/:medicationVariantName/:diseaseId/:diseaseName/:diseaseVariantId/:diseaseVariantName/:from",controller:"medicationStatisticsCtrl",templateUrl:"app/modules/disease-management/views/view-medication-statistics.html",params:{fromState:"viewMedicationStatistics",type:"new",data:null},ncyBreadcrumb:{label:"MEDICATION_STATISTICS",parent:"searchDiseaseMedication"}}).state("viewIncidentStatistics",{url:"/viewIncidentStatistics/:incidentTypeId/:incidentTypeName/:diseaseId/:diseaseName/:diseaseVariantId/:diseaseVariantName/:from",controller:"incidentStatisticsCtrl",templateUrl:"app/modules/disease-management/views/view-incident-statistics.html",ncyBreadcrumb:{label:"INCIDENT_STATISTICS",parent:"userincident"},params:{fromState:"viewMedicationStatistics",type:"new",data:null}}).state("viewSymptomsStatistics",{url:"/viewSymptomsStatistics/:symptomId/:symptomName/:diseaseId/:diseaseName/:diseaseVariantId/:diseaseVariantName/:from",controller:"symptomsStatisticsCtrl",templateUrl:"app/modules/disease-management/views/view-symptoms-statistics.html",ncyBreadcrumb:{label:"SYMPTOM_STATISTICS",parent:"searchDiseaseSymptoms"},params:{fromState:"viewSymptomsStatistics",type:"new",data:null}}).state("diseaseManagement",{url:"/diseaseManagement",templateUrl:"app/modules/disease-management/views/disease-management.html",ncyBreadcrumb:{label:"DISEASE_MANAGEMENT"},controller:"diseaseManagementCtrl"}).state("diagnosticListOnDisease",{url:"/diagnosticListOnDisease/:diseaseId/:diseaseName/:diseaseVariantId/:diseaseVariantName/:from",controller:"diseaseBasedDiagnosticListCtrl",templateUrl:"app/modules/disease-management/views/disease-based-diagnostic-list.html",ncyBreadcrumb:{label:"DISEASE_MANAGEMENT"},params:{fromState:"diagnosticListOnDisease",type:"new",data:null}})}]),angular.module("paripal.diseaseTreatmentModule",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("searchDiseaseTreatmentType",{url:"/searchDiseaseTreatmentType",templateUrl:"app/modules/disease-treatment/views/search-disease-treatment-types.html",controller:"searchDiseaseTreatmentType",ncyBreadcrumb:{label:"SEARCH_DISEASE_TREATMENT_TYPE"}}).state("manageDiseaseTreatmentType",{url:"/manageDiseaseTreatmentType/:id/:type",params:{fromState:"manageDiseaseTreatmentType",type:"add",data:null},controller:"manageDiseaseTreatmentTypeCtrl",templateUrl:"app/modules/disease-treatment/views/manage-diseases-treatment-types.html",ncyBreadcrumb:{label:"MANAGE_DISEASE_TREATMENT_TYPE",actionType:"add"}}).state("viewUserTreatment",{url:"/viewUserTreatment/:userId/:userName/:diseaseVariantId/:diseaseVariantName/:diseaseId/:diseaseName/:locationId/:locationName",params:{fromState:null},controller:"viewUserTreatmentCtrl",templateUrl:"app/modules/disease-treatment/views/view-user-treatment.html",ncyBreadcrumb:{label:"VIEW_USER_TREATMENT"}}).state("manageUserTreatment",{url:"/manageUserTreatment/:id/:type/:treatmentRecId/:recId",params:{fromState:"manageUserTreatment",type:"add",data:null,stateFlag:null},controller:"manageUserTreatmentCtrl",templateUrl:"app/modules/disease-treatment/views/manage-user-treatment.html",ncyBreadcrumb:{label:"MANAGE_USER_TREATMENT",actionType:"add"}}).state("manageUserTreatmentImages1",{url:"/manageUserTreatmentImages1",controller:"manageUserTreatmentImagesCtrl",templateUrl:"app/modules/disease-treatment/views/manage-user-treatment-images.html"})}]),angular.module("paripal.documentManagementModule",[]).config(["$stateProvider",function(a){a.state("documentManagement",{url:"/documentManagement",params:{type:"list"},controller:"DocumentManagementCtrl",templateUrl:"app/modules/document-management/views/document-template-list.html",ncyBreadcrumb:{label:"LIST_DYNAMIC_FORM_TEMPLATES"}}),a.state("addDocTemplate",{url:"/addDocTemplate",params:{type:"add"},controller:"DocumentManagementCtrl",templateUrl:"app/modules/document-management/views/add-doc-template.html",ncyBreadcrumb:{label:"ADD_NEW_DOCUMENT_TEMPLATE",actionType:"add"}}),a.state("editDocTemplate",{url:"/editDocTemplate/:documentTemplateId/:type",params:{type:"edit",documentTemplateId:null,data:null},controller:"DocumentManagementCtrl",templateUrl:"app/modules/document-management/views/view-edit-doc-template.html",ncyBreadcrumb:{label:"EDIT_DOCUMENT_TEMPLATE"}}),a.state("viewDocTemplate",{url:"/viewDocTemplate/:documentTemplateId/:type",params:{type:"view",documentTemplateId:null,data:null},controller:"DocumentManagementCtrl",templateUrl:"app/modules/document-management/views/view-edit-doc-template.html",ncyBreadcrumb:{label:"VIEW_DOCUMENT_TEMPLATE"}}),a.state("formBuilder",{url:"/formBuilder/:savedRecordId",params:{type:"iframe",url:"",readonly:"false"},controller:"DocumentManagementCtrl",templateUrl:"app/modules/document-management/views/form-builder.html",ncyBreadcrumb:{label:"ADD_NEW_DOCUMENT_TEMPLATE"}}),a.state("formRunner",{url:"/formRunner/:savedRecordId",params:{type:"iframe",prevStateParam:null,url:"",readonly:!1},controller:"DocumentManagementCtrl",templateUrl:"app/modules/document-management/views/form-runner.html",ncyBreadcrumb:{label:"MORE_DETAIL_FORM"}}),a.state("newformRunner",{url:"/formRunner/:savedRecordId/:url/:prevStateParam/:readonly",params:{type:"iframe"},controller:"DocumentManagementCtrl",templateUrl:"app/modules/document-management/views/form-runner.html",ncyBreadcrumb:{label:"MORE_DETAIL_FORM"}}),a.state("availableformlist",{url:"/availableformlist/:recordId/:recordUserId",params:{type:"iframe",url:"",referenceEntityType:"",recordUserOrgLocIds:null},controller:"ManageFormCtrl",templateUrl:"app/modules/document-management/views/available-orbeon-form-list.html",ncyBreadcrumb:{label:"SELECT_FORM"}}),a.state("documentInstances",{url:"/documentInstances",params:{data:null},controller:"DocumentInstancesListCtrl",templateUrl:"app/modules/document-management/views/document-instances-list.html",ncyBreadcrumb:{label:"DOCUMENT_INSTANCES_LIST"}}).state("managedocument",{url:"/managedocument",templateUrl:"app/modules/document-management/views/manage-document.html",ncyBreadcrumb:{label:"MANAGE_DOCUMENT"},controller:"ManageDoucumentCtrl"}).state("helpdocument",{url:"/helpdocument",templateUrl:"app/modules/document-management/views/help-document-list.html",ncyBreadcrumb:{label:"HELP_DOCUMENT_LIST"},controller:"HelpDocumentListCtrl"})}]),angular.module("paripal.emergencyAutomateModule",[]).config(["$stateProvider",function(a){a.state("emergencyautomate",{url:"/emergencyautomate",controller:"EmergencyAutomateCtrl",templateUrl:"app/modules/emergency-automate/views/emergency-automate.html",ncyBreadcrumb:{label:"AUTOMATE_EMERGENCY",parent:"emergencymanagement"},params:{}}).state("emergencyrequeststatus",{url:"/emergencyrequeststatus",controller:"EmergencyAutomateStatusCtrl",templateUrl:"app/modules/emergency-automate/views/emergency-request-status.html",ncyBreadcrumb:{label:"VIEW_EMERGENCY_REQUEST_STATUS_AND_CONTROL_PAGE",parent:"emergencyautomate"},params:{data:null,type:null,callingUrl:null,callbackUrl:null,sequenceId:null}})}]),angular.module("paripal.emergencyTransactionModule",[]).config(["$stateProvider",function(a){a.state("emergencytransaction",{url:"/emergencytransaction",controller:"EmergencyTransactionCtrl",templateUrl:"app/modules/emergency-transaction-management/views/emergency-transaction.html",ncyBreadcrumb:{label:"EMERGENCY_TRANSACTION",parent:"emergencymanagement"},params:{data:null,type:null,callingUrl:null,callbackUrl:null}}).state("emergencymanagement",{url:"/emergencymanagement",controller:"EmergencyManagementCtrl",templateUrl:"app/modules/emergency-transaction-management/views/emergency-management.html",ncyBreadcrumb:{label:"EMERGENCY_MANAGEMENT"},params:{data:null,type:null}}).state("emergencycallmanagementlist",{url:"/emergencycallmanagementlist",controller:"EmergencyCallManagementListCtrl",templateUrl:"app/modules/emergency-transaction-management/views/emergency-call-management-list.html",ncyBreadcrumb:{label:"EMERGENCY_CALL_MANAGEMENT_LIST"},params:{data:null,type:null}}).state("intimatestakeholders",{url:"/intimatestakeholders/:mode",controller:"IntimateStakeholderCtrl",templateUrl:"app/modules/emergency-transaction-management/views/intimate-stakeholder.html",ncyBreadcrumb:{label:"INTIMATE_STAKEHOLDERS"},params:{id:null,transactionId:null,mode:null,data:null,type:null,callingUrl:null,callbackUrl:null}}).state("intimationlist",{url:"/intimationlist",controller:"IntimationListCtrl",templateUrl:"app/modules/emergency-transaction-management/views/intimation-list.html",
ncyBreadcrumb:{label:"INTIMATION_LIST"},params:{}}).state("shareotherdocument",{url:"/shareotherdocument",controller:"ShareOtherDocCtrl",templateUrl:"app/modules/emergency-transaction-management/views/share-other-doc.html",ncyBreadcrumb:{label:"SHARE_OTHER_DOC"},params:{documentType:null,onBehalfOf:null,userWhoSent:null,canBeShared:null}}).state("emergencyrequests",{url:"/emergencyrequests",controller:"EmergencyRequestsCtrl",templateUrl:"app/modules/emergency-transaction-management/views/emergency-requests.html",ncyBreadcrumb:{label:"EMERGENCY_REQUESTS"},params:{}}).state("acceptedhospitals",{url:"/acceptedhospitals",controller:"AcceptedHospitalsCtrl",templateUrl:"app/modules/emergency-transaction-management/views/accepted-hospitals.html",ncyBreadcrumb:{label:"PATIENT_ACCEPTED_HOSPITALS"},params:{emergencyId:null,whetherAccepted:null,callBackURL:null,callingScreen:null}}).state("emergencyNotes",{url:"/emergencyNotes",controller:"EmergencyNotesCtrl",templateUrl:"app/modules/emergency-transaction-management/views/emergency-notes.html",ncyBreadcrumb:{label:"EMERGENCY_NOTES"},params:{type:null,data:null,transactionId:null,emergencyId:null}})}]),angular.module("paripal.emergencyUploadModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("emergencyuploadlist",{url:"/emergencyuploadlist",controller:"EmergencyUploadListCtrl",params:{transactionId:null,previousState:null,affectedPerson:null,accompanyingPerson:null},templateUrl:"app/modules/emergency-upload-download/views/emergency-upload-download-list.html",ncyBreadcrumb:{label:"EMERGENCY_UPLOAD_LIST"}})}]),angular.module("paripal.eventModule",[]).config(["$stateProvider",function(a){"use strict";a.state("eventList",{url:"/eventList",controller:"EventListCtrl",templateUrl:"app/modules/events/views/event-list.html",params:{type:null,user:null},ncyBreadcrumb:{label:"EVENT_LIST"}}).state("manageEvents",{url:"/manageEvents/:type/:eventId",controller:"ManageEventCtrl",templateUrl:"app/modules/events/views/manage-events.html",params:{type:null,eventId:null},ncyBreadcrumb:{label:"MANAGE_EVENTS",parent:"eventList",actionType:"add"}}).state("sessionList",{url:"/sessionList/:eventId",controller:"SessionListCtrl",templateUrl:"app/modules/events/views/session-list.html",params:{type:null,eventId:null,orgId:null},ncyBreadcrumb:{label:"SESSION_LIST",parent:"eventList"}}).state("manageSessions",{url:"/manageSessions/:type/:eventId/:sessionId/:orgLocId",controller:"ManageSessionCtrl",templateUrl:"app/modules/events/views/manage-sessions.html",params:{type:null,sessionId:null,eventId:null,orgLocId:null,data:null},ncyBreadcrumb:{label:"MANAGE_SESSION",parent:"sessionList",actionType:"add"}}).state("viewBookingCounts",{url:"/viewBookingCounts/:eventId",controller:"ViewBookingCountCtrl",templateUrl:"app/modules/events/views/view-booking-count.html",params:{eventId:null},ncyBreadcrumb:{label:"VIEW_BOOKINGS"}}).state("viewBookingDetails",{url:"/viewBookingDetails/:eventId/:sessionId",controller:"ViewBookingsCtrl",templateUrl:"app/modules/events/views/view-bookings.html",params:{sessionId:null,eventId:null,whetherAttended:null},ncyBreadcrumb:{label:"VIEW_BOOKING_DETAILS"}}).state("manageBooking",{url:"/manageBooking/:type/:eventId/:sessionId/:bookingId",controller:"ManageBookingCtrl",templateUrl:"app/modules/events/views/manage-booking.html",params:{type:null,bookingId:null,parentState:null},ncyBreadcrumb:{label:"MANAGE_BOOKING",actionType:"add"}}).state("viewFeedback",{url:"/viewFeedback",controller:"ViewFeedbackCtrl",templateUrl:"app/modules/events/views/view-feedback.html",params:{data:null},ncyBreadcrumb:{label:"FEEDBACK",parent:"eventList"}}).state("showEvents",{url:"/showEvents",controller:"ShowEventsCtrl",templateUrl:"app/modules/events/views/show-events.html",params:{eventId:null},ncyBreadcrumb:{label:"EVENTS"}}).state("showSessions",{url:"/showSessions/:eventId",controller:"ShowSessionsCtrl",templateUrl:"app/modules/events/views/show-sessions.html",params:{eventId:null},ncyBreadcrumb:{label:"SESSIONS"}}).state("showSessionDetails",{url:"/showSessionDetails/:eventId/:sessionId",controller:"ShowSessionDetailsCtrl",templateUrl:"app/modules/events/views/show-session-details.html",params:{eventId:null,sessionId:null},ncyBreadcrumb:{label:"SESSIONS_DETAILS"}}).state("showeventdetails",{url:"/showeventdetails/:eventId",controller:"ShowEventDetailCtrl",templateUrl:"app/modules/events/views/show-event-details.html",params:{eventId:null},ncyBreadcrumb:{label:"EVENT_DETAILS",parent:"eventList"}}).state("showeventbooking",{url:"/showeventbooking/:eventId",controller:"ShowEventBookingCtrl",templateUrl:"app/modules/events/views/show-event-booking.html",params:{eventId:null},ncyBreadcrumb:{label:"EVENT_BOOKING",parent:"viewBookingDetails"}}).state("showsessionbooking",{url:"/showsessionbooking/:eventId/:sessionId",controller:"ShowSessionBookingCtrl",templateUrl:"app/modules/events/views/show-session-booking.html",params:{sessionId:null,eventId:null},ncyBreadcrumb:{label:"SESSION_BOOKINGS"}}).state("showLinkedProfessionals",{url:"/showLinkedProfessionals/:eventId",controller:"ShowLinkedProfessionalsCtrl",templateUrl:"app/modules/events/views/show-linked-professionals.html",params:{eventId:null},ncyBreadcrumb:{label:"VIEW_LINKED_PROFESSIONALS",parent:"showEvents"}}).state("myEvents",{url:"/myEvents",controller:"MyEventsCtrl",templateUrl:"app/modules/events/views/my-events.html",params:{eventId:null},ncyBreadcrumb:{label:"EVENTS"}}).state("myBookings",{url:"/myBookings",controller:"MyBookingCtrl",templateUrl:"app/modules/events/views/my-booking.html",params:{eventId:null},ncyBreadcrumb:{label:"MY_BOOKINGS"}}).state("eventmanagement",{url:"/eventmanagement",controller:"EventManagementCtrl",templateUrl:"app/modules/events/views/event-management.html",ncyBreadcrumb:{label:"EVENT_MANAGEMENT"}})}]),angular.module("paripal.expressionOfInterest",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("expressionlist",{url:"/expressionlist",controller:"ExpressionListCtrl",templateUrl:"app/modules/expression-of-interest/views/expression-interest-list.html",ncyBreadcrumb:{label:"EXPRESSION_OF_INTEREST_LIST"}}).state("manageexpression",{url:"/manageexpression/:expressionId/:type",params:{fromState:"expressionfollowup",type:null,data:null},controller:"ManageExpressionCtrl",templateUrl:"app/modules/expression-of-interest/views/manage-expression-interest.html",ncyBreadcrumb:{label:"EXPRESSION_OF_INTEREST",actionType:"add"}}).state("publicmanageexpression",{url:"/publicmanageexpression",controller:"ManageExpressionCtrl",templateUrl:"app/modules/expression-of-interest/views/manage-expression-interest.html",ncyBreadcrumb:{label:"EXPRESSION_OF_INTEREST"}}).state("expressionfollowup",{url:"/expressionfollowup/:expressionId/:type",params:{fromState:"expressionfollowup",type:null,data:null},controller:"ExpressionFollowUpCtrl",templateUrl:"app/modules/expression-of-interest/views/expression-follow-up.html",ncyBreadcrumb:{label:"EXPRESSION_FOLLOW_UP",parent:"expressionlist"}})}]),angular.module("paripal.firstAidModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("firstaidlist",{url:"/firstaidlist",controller:"FirstAidListCtrl",templateUrl:"app/modules/first-aid/views/first-aid-list.html",ncyBreadcrumb:{label:"FIRST_AID_LIST"}})}]),angular.module("paripal.forumModule",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("addforum",{url:"/addforum",templateUrl:"app/modules/forum/views/addforum.html",controller:"addForumController",ncyBreadcrumb:{label:"Add Forum",parent:"listofForums"}}).state("editforum",{url:"/addforum/:forumId",templateUrl:"app/modules/forum/views/addforum.html",controller:"editForumCtrl",ncyBreadcrumb:{label:"Edit Forum",parent:"listofForums"}}).state("viewforum",{url:"/viewforum/:forumId",templateUrl:"app/modules/forum/views/viewforum.html",controller:"viewForumCtrl",ncyBreadcrumb:{label:"View Forum",parent:"listofForums"}}).state("listofForums",{url:"/listofForums",templateUrl:"app/modules/forum/views/listofForums.html",controller:"forumlistController",params:{type:null},ncyBreadcrumb:{label:"Forum List"}}).state("forumRequests",{url:"/ForumRequests/:forumId",templateUrl:"app/modules/forum/views/forumRequests.html",controller:"requestCtrl",ncyBreadcrumb:{label:"Forum List",parent:"listofForums"}}).state("categories",{url:"/categories/",templateUrl:"app/modules/forum/views/categories.html",controller:"categoryCtrl",ncyBreadcrumb:{label:"Categories"}})}]),angular.module("paripal.fullCalendarModule",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("usercalendarview",{url:"/usercalendarview/:type",params:{type:null,data:null,samePageCall:null},controller:"UserCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/full-calendar.html",ncyBreadcrumb:{label:"USER_CALENDAR_VIEW",parent:"calendarlistview",actionType:"view"}}).state("locationcalendarview",{url:"/locationcalendarview/:type",params:{type:null,data:null},controller:"LocationCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/full-calendar.html",ncyBreadcrumb:{label:"LOCATION_CALENDAR_VIEW",parent:"calendarlistview",actionType:"view"}}).state("processcalendarview",{url:"/processcalendarview/:type",params:{type:null,data:null},controller:"ProcessCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/full-calendar.html",ncyBreadcrumb:{label:"PROCESS_CALENDAR_VIEW",parent:"calendarlistview",actionType:"view"}}).state("equipmentcalendarview",{url:"/equipmentcalendarview/:type",params:{type:null,data:null},controller:"EquipmentCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/full-calendar.html",ncyBreadcrumb:{label:"EQUIPMENT_CALENDAR_VIEW",parent:"calendarlistview",actionType:"view"}}).state("mycalendarview",{url:"/mycalendarview/:type",params:{type:"regular",data:null},controller:"IndividualCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/my-calendar.html",ncyBreadcrumb:{label:"MY_CALENDAR",parent:"calendarlistview",actionType:"view"}}).state("calendarlistview",{url:"/calendarlistview",params:{type:null,data:null},controller:"ViewCalendarListCtrl",templateUrl:"app/modules/fullCalendar/views/calendar-list-view.html",ncyBreadcrumb:{label:"CALENDAR_LIST"}}).state("individualcalendarlist",{url:"/individualcalendarlist",params:{type:null,data:null},controller:"IndividualCalendarListCtrl",templateUrl:"app/modules/fullCalendar/views/individual-calendar-list.html",ncyBreadcrumb:{label:"VIEW_CALENDAR_LIST"}}).state("editcalendarview",{url:"/editcalendarview/:calendarId/:type",params:{type:null,entityId:null,entityData:null,data:null,fromLocWall:null},controller:"EditCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/createCalendar.html",ncyBreadcrumb:{label:"EDIT_CALENDAR",parent:"calendarlistview",actionType:"add"}}).state("createcalendarview",{url:"/createcalendarview",params:{type:null,data:null},controller:"CreateCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/createCalendar.html",ncyBreadcrumb:{label:"CREATE_CALENDAR",parent:"calendarlistview"}}).state("linkCalendar",{url:"/linkCalendar/:calendarId/:type",params:{type:null,entityId:null,entityData:null,data:null},controller:"LinkCalendarCtrl",templateUrl:"app/modules/fullCalendar/views/createCalendar.html",ncyBreadcrumb:{label:"LINK_CALENDAR",parent:"calendarlistview"}}).state("manageEventCalendar",{url:"/manageEventCalendar/:type/:eventId",params:{type:null,eventId:null,calendarData:null,calendarState:null,callingPage:null},controller:"ManageCalendarEventCtrl",templateUrl:"app/modules/fullCalendar/views/manage-calendar-event.html",ncyBreadcrumb:{label:"DEFINE_EVENT",actionType:"add"}}).state("manageEventCalendarException",{url:"/manageEventCalendarException/:type/:eventExceptionId",params:{type:null,eventId:null,entityType:null,eventExceptionId:null,calendarState:null,callingPage:null},controller:"ManageEventExceptionCtrl",templateUrl:"app/modules/fullCalendar/views/manage-event-exception.html",ncyBreadcrumb:{label:"MANAGE_CALENDAR_EVENT_EXCEPTION",actionType:"add"}}).state("dayExceptionList",{url:"/dayExceptionList",params:{calendarId:null,entityId:null,organizationLocationId:null,entityTypeCode:null,entityType:null},controller:"DayExceptionListCtrl",templateUrl:"app/modules/fullCalendar/views/day-exception-list.html",ncyBreadcrumb:{label:"DAY_EXCEPTION_LIST"}})}]),angular.module("paripal.userIdentify",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("userIdentifyList",{url:"/userIdentifyList",controller:"UserIdentifyListCtrl",templateUrl:"app/modules/identify-user/views/user-identify-list.html",ncyBreadcrumb:{label:"IDENTIFY_USER_LIST"},params:{type:null,data:null,callBackURL:null,callingScreen:null}})}]),angular.module("paripal.importDataModule",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("importData",{url:"/importData",controller:"ImportDataCtrl",templateUrl:"app/modules/import-data/views/import-data.html",ncyBreadcrumb:{label:"IMPORT_DATA"},params:{type:null,data:null,callBackURL:null}})}]),angular.module("paripal.jobManagement",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("jobList",{url:"/jobList",controller:"JobListViewCtrl",templateUrl:"app/modules/job-management/views/job-list-view.html",ncyBreadcrumb:{label:"JOB_MANAGEMENT"},params:{type:null,data:null,callBackURL:null}}).state("jobHistory",{url:"/jobHistory",controller:"JobListHistoryCtrl",templateUrl:"app/modules/job-management/views/job-history-list.html",ncyBreadcrumb:{label:"JOB_HISTORY",parent:"jobList"},params:{type:null,data:null,callBackURL:null}}).state("jobError",{url:"/jobError",controller:"JobListHistoryCtrl",templateUrl:"app/modules/job-management/views/job-error-log.html",ncyBreadcrumb:{label:"JOB_ERROR_MESSAGE",parent:"jobHistory"},params:{errormessage:null,data:null,callBackURL:null}})}]),angular.module("paripal.labCRM",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider","ChartJsProvider",function(a,b,c,d){a.state("indicator",{url:"/indicator",params:{type:null,data:null},controller:"IndicatorCtrl",templateUrl:"app/modules/labCRM/views/indicator.html",ncyBreadcrumb:{label:"MANAGE_INDICATOR",parent:"indicatorlist",actionType:"add"}}).state("indicatorlist",{url:"/indicatorlist",controller:"IndicatorListCtrl",templateUrl:"app/modules/labCRM/views/indicator-list.html",ncyBreadcrumb:{label:"MEASUREMENT_INDICATOR_LIST"}}).state("grouplist",{url:"/grouplist",controller:"GroupListCtrl",templateUrl:"app/modules/labCRM/views/group-list.html",ncyBreadcrumb:{label:"MEASUREMENT_GROUP_LIST"}}).state("manageindicatorconditions",{url:"/manageindicatorconditions",params:{type:null,data:null},controller:"ManageIndicatorConditionsCtrl",templateUrl:"app/modules/labCRM/views/manage-indicator-conditions.html",ncyBreadcrumb:{label:"MANAGE_INDICATOR_CONDITION",parent:"indicatorconditionlist",actionType:"add"}}).state("indicatorconditionlist",{url:"/indicatorconditionlist",params:{type:null,data:null},controller:"IndicatorConditionListCtrl",templateUrl:"app/modules/labCRM/views/indicator-condition-list.html",ncyBreadcrumb:{label:"MEASUREMENT_INDICATOR_CONDITION_LIST",parent:"indicatorlist"}}).state("diagnostictests",{url:"/diagnostictests",params:{type:null,data:null},controller:"DiagnosticTestsCtrl",templateUrl:"app/modules/labCRM/views/diagnostic-tests.html",ncyBreadcrumb:{label:"DIAGNOSTIC_TESTS",parent:"diagnostictestslist",actionType:"add"}}).state("diagnostictestslist",{url:"/diagnostictestslist",controller:"DiagnosticTestsListCtrl",templateUrl:"app/modules/labCRM/views/diagnostic-tests-list.html",ncyBreadcrumb:{label:"DIAGNOSTIC_TESTS_LIST"}}).state("groupindicatorlinklist",{url:"/groupindicatorlinklist",params:{type:null,data:null},controller:"GroupIndicatorLinkListCtrl",templateUrl:"app/modules/labCRM/views/group-indicator-link-list.html",ncyBreadcrumb:{label:"MEASUREMENT_GROUP_INDICATOR_LINK_LIST",parent:"grouplist"}}).state("diagnosistestindicatorlink",{url:"/diagnosistestindicatorlink",params:{type:null,data:null},controller:"DiagnosisTestIndicatorLinkCtrl",templateUrl:"app/modules/labCRM/views/diagnosis-test-indicator-link.html",ncyBreadcrumb:{label:"DIAGNOSTIC_TEST_INDICATOR_LINK"}}).state("testgrouplist",{url:"/testgrouplist",params:{type:null,data:null},controller:"TestGroupListCtrl",templateUrl:"app/modules/labCRM/views/test-group-list.html",ncyBreadcrumb:{label:"DIAGNOSTIC_TEST_MEASUREMENT_GROUP_LINK",parent:"diagnostictestslist"}}).state("testgroupconditionlist",{url:"/testgroupconditionlist",params:{type:null,data:null},controller:"TestGroupConditionListCtrl",templateUrl:"app/modules/labCRM/views/test-group-condition-list.html",ncyBreadcrumb:{label:"DIAGNOSTIC_TEST_MEASUREMENT_GROUP_CONDITION_LIST",parent:"testgrouplist"}}).state("managetestgroupcondition",{url:"/managetestgroupcondition",controller:"ManageTestGroupConditionCtrl",templateUrl:"app/modules/labCRM/views/manage-test-group-condition.html",params:{data:null,type:null},ncyBreadcrumb:{label:"MANAGE_DIAGNOSTIC_TEST_MEASUREMENT_GROUP_CONDITION",parent:"testgroupconditionlist",actionType:"add"}}).state("usermeasurementlist",{url:"/usermeasurementlist",params:{type:null,data:null,fromState:null},controller:"UserMeasurementListCtrl",templateUrl:"app/modules/labCRM/views/user-measurement-list.html",ncyBreadcrumb:{label:"USER_MEASUREMENT_LIST",parent:"usertestlist"}}).state("testdiseaselist",{url:"/testdiseaselist",controller:"TestDiseaseListCtrl",templateUrl:"app/modules/labCRM/views/diagnostic-test-disease-list.html",ncyBreadcrumb:{label:"DIAGNOSTIC_TEST_DISEASE_LINK",parent:"diagnostictestslist"}}).state("addusermeasurement",{url:"/addusermeasurement",controller:"AddUserMeasurementCtrl",templateUrl:"app/modules/labCRM/views/add-user-measurement.html",params:{type:null,data:null},ncyBreadcrumb:{label:"MANAGE_USER_MEASUREMENT",parent:"usermeasurementlist"}}).state("testorglocationlist",{url:"/testorglocationlist",controller:"TestOrgLocationListCtrl",templateUrl:"app/modules/labCRM/views/test-org-location-list.html",ncyBreadcrumb:{label:"DIAGNOSTIC_TEST_ORGANIZATION-LOCATION_LIST",parent:"diagnostictestslist"},params:{data:null,type:null}}).state("managetestorglocation",{url:"/managetestorglocation",controller:"ManageTestOrgLocationCtrl",templateUrl:"app/modules/labCRM/views/manage-test-org-location.html",ncyBreadcrumb:{label:"MANAGE_DIAGNOSTIC_TEST_ORGANIZATION-LOCATION",parent:"testorglocationlist",actionType:"add"},params:{data:null,type:null}}).state("managetestcomment",{url:"/managetestcomment",controller:"ManageTestCommentCtrl",templateUrl:"app/modules/labCRM/views/manage-test-comment.html",ncyBreadcrumb:{label:"MANAGE_TEST_COMMENT",parent:"testcommentlist",actionType:"add"}}).state("testcommentlist",{url:"/testcommentlist",controller:"TestCommentListCtrl",templateUrl:"app/modules/labCRM/views/test-comment-list.html",ncyBreadcrumb:{label:"TEST_COMMENT_LIST"}}).state("searchlab",{url:"/searchlab",controller:"SearchLabCtrl",templateUrl:"app/modules/labCRM/views/search-lab.html",ncyBreadcrumb:{label:"LAB_SEARCH"}}).state("measurementsymptoms",{url:"/measurementsymptoms",controller:"MeasurementSymptomsListCtrl",templateUrl:"app/modules/labCRM/views/measurement-symptoms-list.html",ncyBreadcrumb:{label:"MEASUREMENT_SYMPTOM_LIST"},params:{data:null,callBackURL:null}}).state("usermeasurementmanagement",{url:"/usermeasurementmanagement",controller:"UserMeasurementManagementCtrl",templateUrl:"app/modules/labCRM/views/user - measurement - management.html",ncyBreadcrumb:{label:"USER_MEASUREMENT_MANAGEMENT"}})}]),angular.module("paripal.landingPageModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("landingPage",{url:"/landingPage",controller:"landingPageCtrl",templateUrl:"app/modules/landingPage/views/landingPage.html",ncyBreadcrumb:{label:"LANDING_PAGE"}})}]),angular.module("paripal.locationTreatmentModule",[]).config(["$stateProvider",function(a){"use strict";a.state("locationTreatmentList",{url:"/locationTreatmentList",controller:"LocationTreatmentListCtrl",templateUrl:"app/modules/location-treatment/views/location-treatment-list.html",params:{type:null,user:null,wallData:null,organization:null,organizationLoc:null},ncyBreadcrumb:{label:"VIEW_LOCATION_TREATMENT_TYPES"}})}]),angular.module("paripal.manageAmbulance",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("ambulancelist",{url:"/ambulancelist",controller:"AmbulanceListCtrl",templateUrl:"app/modules/manage-ambulance/views/ambulance-list.html",ncyBreadcrumb:{label:"AMBULANCE_LIST"}}).state("ambulancestafflist",{url:"/ambulancestafflist/:ambulanceId",controller:"AmbulanceStaffListCtrl",templateUrl:"app/modules/manage-ambulance/views/ambulance-staff-list.html",params:{ambulanceId:null,orgLocId:null},ncyBreadcrumb:{label:"AMBULANCE_STAFF_LIST"}})}]),angular.module("paripal.followUpSettingsModule",[]).config(["$stateProvider",function(a){a.state("followUpSettingsList",{url:"/followUpSettingsList",controller:"FollowUpSettingsListCtrl",templateUrl:"app/modules/manage-followup-settings/views/followup-settings-list.html",params:{type:null,organization:null,organizationLocation:null,transactionType:null},ncyBreadcrumb:{label:"FOLLOW_UP_VISIT_CONFIGURATION"}}).state("manageFollowUpSettings",{params:{type:null,organization:null,organizationLocation:null,transactionType:null,followupVisitConfigurationId:null},url:"/manageFollowUpSettings",controller:"ManageFollowUpSettingsCtrl",templateUrl:"app/modules/manage-followup-settings/views/manage-followup-settings.html",ncyBreadcrumb:{label:"MANAGE_FOLLOW_UP_VISIT_CONFIGURATION",actionType:"add"}}).state("followUpExceptionList",{url:"/followUpExceptionList",controller:"FollowUpExceptionListCtrl",templateUrl:"app/modules/manage-followup-settings/views/followup-exception-list.html",params:{type:null,organization:null,organizationLocation:null,transactionType:null,followupVisitConfigurationId:null,validFrom:null,validTill:null,noOfFreeVisits:null,noOfFreeClarifications:null},ncyBreadcrumb:{label:"FOLLOW_UP_SPECIAL_CONFIGURATION"}}).state("manageFollowUpException",{url:"/manageFollowUpException",params:{type:null,followupVisitConfigurationId:null,followupSpecialConfigurationId:null,organization:null,organizationLocation:null,transactionType:null,validFrom:null,validTill:null,noOfFreeVisits:null,noOfFreeClarifications:null},controller:"ManageFollowUpExceptionCtrl",templateUrl:"app/modules/manage-followup-settings/views/manage-followup-exception.html",ncyBreadcrumb:{label:"MANAGE_FOLLOW_UP_SPECIAL_CONFIGURATION",actionType:"add"}})}]),$(document).ready(function(){var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide(),a.click(function(c){c.preventDefault();var d=$($(this).attr("href")),e=$(this);e.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),e.addClass("btn-primary"),b.hide(),d.show(),d.find("input:eq(0)").focus())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a"),d=a.find("input[type='text'],input[type='url']"),e=!0;$(".form-group").removeClass("has-error");for(var f=0;f<d.length;f++)d[f].validity.valid||(e=!1,$(d[f]).closest(".form-group").addClass("has-error"));e&&c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.manageOrganisationLocationClient",[]).config(["$stateProvider",function(a){a.state("orglocclientlist",{url:"/orglocclientlist",controller:"OrgLocClientListCtrl",templateUrl:"app/modules/manage-organisation-location-client/views/org-loc-client-list.html",ncyBreadcrumb:{label:"ORGANIZATION_LOCATION_CLIENT"}}).state("addorglocclient",{url:"/addorglocclient/:clientId/:type",params:{fromState:"addorglocclient",type:null,appointmentId:null,appointmentType:null,entityType:null,entityName:null,eventType:null,eventName:null,urlState:null,data:null,user:null},controller:"AddOrgLocClientCtrl",templateUrl:"app/modules/manage-organisation-location-client/views/add-org-loc-client.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION_LOCATION_CLIENT",parent:"orglocclientlist",actionType:"add"}}).state("addorglocclientfromcontacts",{url:"/addorglocclientfromcontacts/",params:{data:null},controller:"AddOrgLocClientFromContactsCtrl",templateUrl:"app/modules/manage-organisation-location-client/views/add-org-loc-client-from-contacts.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION_LOCATION_CLIENT",
// parent: "orglocclientlist",
actionType:"add"}})}]),angular.module("paripal.manageOrganisationLocationUser",[]).config(["$stateProvider",function(a){a.state("orglocuserlist",{url:"/orglocuserlist",controller:"OrgUserListCtrl",templateUrl:"app/modules/manage-organisation-location-users/views/user-list.html",ncyBreadcrumb:{label:"ORGANIZATION_USERS"},params:{wallData:null,fromHomeView:null,organization:null,orgLocation:null}}).state("manageorglocuser",{url:"/manageorglocuser/:orgUserId/:type",params:{fromState:"manageorglocuser",type:null,data:null},controller:"ManageOrgUserCtrl",templateUrl:"app/modules/manage-organisation-location-users/views/manage-user.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION_USER",parent:"orglocuserlist",actionType:"add"}}).state("orglocusercard",{url:"/orglocusercard",params:{wallData:null,fromHomeView:null,organization:null,orgLocation:null},controller:"OrgUserCardCtrl",templateUrl:"app/modules/manage-organisation-location-users/views/user-cards.html",ncyBreadcrumb:{label:"ORGANIZATION_USERS"}})}]),$(document).ready(function(){var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide(),a.click(function(c){c.preventDefault();var d=$($(this).attr("href")),e=$(this);e.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),e.addClass("btn-primary"),b.hide(),d.show())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a"),d=a.find("input[type='text'],input[type='url']"),e=!0;$(".form-group").removeClass("has-error");for(var f=0;f<d.length;f++)d[f].validity.valid||(e=!1,$(d[f]).closest(".form-group").addClass("has-error"));e&&c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.manageOrganisationLocation",[]).config(["$stateProvider",function(a){a.state("orgloclist",{url:"/orgloclist",controller:"OrgLocListCtrl",templateUrl:"app/modules/manage-organisation-locations/views/orgLoc-list.html",ncyBreadcrumb:{label:"LIST_ORG_LOC"},params:{org:null,wallData:null,searchType:null}}).state("orgloccard",{url:"/orgloccard",controller:"OrgLocCardCtrl",templateUrl:"app/modules/manage-organisation-locations/views/orgLoc-card.html",ncyBreadcrumb:{label:"LIST_ORG_LOC"},params:{org:null,wallData:null,searchType:null}}).state("manageorgloc",{url:"/editorgloc/:orgLocId/:type",params:{fromState:"manageorgloc",type:null,data:null},controller:"ManageOrgLocCtrl",templateUrl:"app/modules/manage-organisation-locations/views/manage-orgLoc.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION_LOCATION",parent:"orgloclist",actionType:"add"}}).state("manageorglocView",{url:"/vieworgloc/:orgLocId/:type",params:{fromState:"manageorgloc",type:null,data:null},controller:"ManageOrgLocCtrl",templateUrl:"app/modules/manage-organisation-locations/views/view-org-loc.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION_LOCATION",parent:"orgloclist",actionType:"add"}}).state("addorgloc",{url:"/addorgloc",params:{fromState:"addorgloc",type:"new",data:null},controller:"AddOrgLocCtrl",templateUrl:"app/modules/manage-organisation-locations/views/add-orgLoc.html",ncyBreadcrumb:{label:"ADD_ORGANIZATION_LOCATION",parent:"orgloclist",actionType:"add"}}).state("mapsystemsummary",{url:"/mapsystemsummary",params:{type:null,data:null},controller:"MapSystemSummaryCtrl",templateUrl:"app/modules/manage-organisation-locations/views/map-system-summary.html",ncyBreadcrumb:{label:"MAP_SYSTEM_SUMMARY",parent:"orgloclist"}}).state("locationwiseuploadcount",{url:"/locationwiseuploadcount",params:{type:null,data:null},controller:"LocWiseUploadCountCtrl",templateUrl:"app/modules/manage-organisation-locations/views/loc-wise-upload-count.html",ncyBreadcrumb:{label:"LOC_WISE_UPLOAD_COUNT"}}).state("locationwiseclientcount",{url:"/locationwiseclientcount",params:{type:null,data:null},controller:"LocWiseClientCountCtrl",templateUrl:"app/modules/manage-organisation-locations/views/loc-wise-client-count.html",ncyBreadcrumb:{label:"LOC_WISE_CLIENT_COUNT"}}).state("datewiseclientcount",{url:"/datewiseclientcount",params:{type:null,data:null},controller:"DateWiseClientCountCtrl",templateUrl:"app/modules/manage-organisation-locations/views/date-wise-client-count.html",ncyBreadcrumb:{label:"DATE_WISE_CLIENT_COUNT"}}).state("locwisetransactioncount",{url:"/locwisetransactioncount",params:{type:null,data:null},controller:"LocWiseTransactionCountCtrl",templateUrl:"app/modules/manage-organisation-locations/views/loc-wise-transaction-count.html",ncyBreadcrumb:{label:"LOC_WISE_TRANSACTION_COUNT"}}).state("datewisetransactioncount",{url:"/datewisetransactioncount",params:{type:null,data:null},controller:"DateWiseTransactionCountCtrl",templateUrl:"app/modules/manage-organisation-locations/views/date-wise-transaction-count.html",ncyBreadcrumb:{label:"DATE_WISE_TRANSACTION_COUNT"}})}]),$(document).ready(function(){$("ul li").click(function(){$("ul li.current").removeClass("current"),$(this).closest("li").addClass("current")}),$(function(){function a(a,b){$(a).find(":selected").appendTo(b)}function b(a,b){$(a).children().appendTo(b)}$("#left").click(function(){a("#sbTwo","#sbOne")}),$("#right").on("click",function(){a("#sbOne","#sbTwo")}),$("#leftall").on("click",function(){b("#sbTwo","#sbOne")}),$("#rightall").on("click",function(){b("#sbOne","#sbTwo")})});var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide(),a.click(function(c){c.preventDefault();var d=$($(this).attr("href")),e=$(this);e.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),e.addClass("btn-primary"),b.hide(),d.show())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a"),d=a.find("input[type='text'],input[type='url']"),e=!0;$(".form-group").removeClass("has-error");for(var f=0;f<d.length;f++)d[f].validity.valid||(e=!1,$(d[f]).closest(".form-group").addClass("has-error"));e&&c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.manageOrganisation",[]).config(["$stateProvider",function(a){a.state("orglist",{url:"/orglist",controller:"OrgListCtrl",templateUrl:"app/modules/manage-organisations/views/org-list.html",ncyBreadcrumb:{label:"LIST_ORG"},params:{orgLoc:null,searchType:null}}).state("manageorgView",{url:"/vieworg/:orgId/:type",params:{fromState:"manageorg",type:null,data:null,orgLoc:null},controller:"ManageOrgCtrl",templateUrl:"app/modules/manage-organisations/views/view-org.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION_VIEW",parent:"orglist",actionType:"add"}}).state("manageorg",{url:"/editorg/:orgId/:type",params:{fromState:"manageorg",orgId:null,type:null,data:null,orgLoc:null},controller:"ManageOrgCtrl",templateUrl:"app/modules/manage-organisations/views/manage-org.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION",parent:"orglist",actionType:"add"}}).state("addorg",{url:"/addorg",params:{fromState:"addorg"},controller:"AddOrgCtrl",templateUrl:"app/modules/manage-organisations/views/add-org.html",ncyBreadcrumb:{label:"ADD_ORGANIZATION",parent:"orglist"}})}]),$(document).ready(function(){var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide(),a.click(function(c){c.preventDefault();var d=$($(this).attr("href")),e=$(this);e.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),e.addClass("btn-primary"),b.hide(),d.show())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a"),d=a.find("input[type='text'],input[type='url']"),e=!0;$(".form-group").removeClass("has-error");for(var f=0;f<d.length;f++)d[f].validity.valid||(e=!1,$(d[f]).closest(".form-group").addClass("has-error"));e&&c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.manageProfessionalSummary",[]).config(["$stateProvider",function(a){a.state("manageProfessionalSummary",{url:"/manageProfessionalSummary/:orgUserId/:type/:mode",params:{fromState:"manageProfessionalSummary",type:null,data:null,mode:null},controller:"manageProfessionalSummaryCtrl",templateUrl:"app/modules/manage-professional-summary/views/manage-professional-summary.html",ncyBreadcrumb:{label:"PROFESSIONALS_SUMMARY"}})}]),angular.module("paripal.professionalTreatmentModule",[]).config(["$stateProvider",function(a){"use strict";a.state("professionalTreatmentList",{url:"/professionalTreatmentList",controller:"ProfessionalTreatmentListCtrl",templateUrl:"app/modules/manage-professional-treatment/views/professional-treatment-list.html",params:{type:null,user:null},ncyBreadcrumb:{label:"VIEW_PROFESSIONAL_TREATMENT_TYPES"}}).state("diseaseVariantLinkedList",{url:"/diseaseVariantLinkedList",controller:"DiseaseVariantLinkedListCtrl",templateUrl:"app/modules/manage-professional-treatment/views/disease-variant-professional-list.html",params:{type:null,professional:null},ncyBreadcrumb:{label:"VIEW_PROFESSIONALS_DISEASE_VARIANT"}}).state("monthlyDiseaseVariantLinkedStatastics",{url:"/monthlyDiseaseVariantLinkedStatastics",controller:"MonthlyDiseaseVariantLinkedListCtrl",templateUrl:"app/modules/manage-professional-treatment/views/monthly-disease-variant-professional-list.html",params:{type:null,professional:null},ncyBreadcrumb:{label:"MONTHLY_DISEASE_VARIANT_STATASTICS"}})}]),angular.module("paripal.manageRole",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider","ChartJsProvider",function(a,b,c,d){a.state("rolelist",{url:"/rolelist",controller:"RoleListCtrl",templateUrl:"app/modules/manage-roles/views/role-list.html",ncyBreadcrumb:{label:"USER_ROLE_LIST"}}).state("managerole",{url:"/managerole",params:{fromState:"managerole",type:null,data:null},controller:"ManageRoleCtrl",templateUrl:"app/modules/manage-roles/views/manage-role.html",ncyBreadcrumb:{label:"MANAGE_ROLE",parent:"rolelist",actionType:"add"}}).state("manageroleprivilege",{url:"/manageroleprivilege",params:{type:null,data:null},controller:"ManageRolePrivilegeCtrl",templateUrl:"app/modules/manage-roles/views/manage-role-privilege.html",ncyBreadcrumb:{label:"MANAGE_ROLE_PRIVILEGE",parent:"roleprivilegelist",actionType:"add"}}).state("userrolehistorylist",{url:"/userrolehistorylist",controller:"UserRoleHistoryListCtrl",params:{type:null,data:null},templateUrl:"app/modules/manage-roles/views/userrolehistory-list.html",ncyBreadcrumb:{label:"USER_ROLE_HISTORY"}}).state("roleprivilegelist",{url:"/roleprivilegelist",params:{type:null,data:null},controller:"RolePrivilegeListCtrl",templateUrl:"app/modules/manage-roles/views/roleprivilege-list.html",ncyBreadcrumb:{label:"ROLE_PRIVILEGE_LIST"}}).state("linkuserrole",{url:"/linkuserrole",params:{type:null,data:null},controller:"LinkUserRoleCtrl",templateUrl:"app/modules/manage-roles/views/link-user-role.html",ncyBreadcrumb:{label:"MANAGE_LINK_USER_ROLE",parent:"userrolehistorylist"}}).state("rolestatistics",{url:"/rolestatistics",params:{type:null,data:null},controller:"RoleStatisticsCtrl",templateUrl:"app/modules/manage-roles/views/role-statistics.html",ncyBreadcrumb:{label:"ROLE_STATICTICS"}}),d.setOptions({colours:["#A7ACBA","#F6B667","#3FDFF6","#4D5360","#FDB45C","#46BFBD","#F7464A"],responsive:!0})}]),angular.module("paripal.manageUserAddress",[]).config(["$stateProvider",function(a){"use strict";a.state("userAddressList",{url:"/userAddressList/:navigateFrom/:userId",controller:"UserAddressListCtrl",templateUrl:"app/modules/manage-user-address/views/user-address-list.html",params:{navigateFrom:null,userAddressId:null,userId:null,userCode:null,userName:null},ncyBreadcrumb:{label:"USER_ADDRESS"}}).state("manageUserAddress",{params:{type:null,navigateFrom:null,userAddressId:null,userId:null,userCode:null,userName:null,isFirstLoggedIn:null},url:"/manageUserAddress/:navigateFrom/:type/:userAddressId",controller:"ManageUserAddressCtrl",templateUrl:"app/modules/manage-user-address/views/manage-user-address.html",ncyBreadcrumb:{label:"MANAGE_USER_ADDRESS",actionType:"add"}})}]),angular.module("paripal.manageUserDocuments",[]).config(["$stateProvider",function(a){"use strict";a.state("myDocuments",{url:"/myDocuments/:parentState/:userType",controller:"ManageUserDocumentCtrl",templateUrl:"app/modules/manage-user-documents/views/manage-user-documents.html",ncyBreadcrumb:{label:"MY_DOCUMENTS"},params:{type:null,data:null,fromMobileFooter:null,fromIndDashboard:null}}).state("userIdDocument",{url:"/userIdDocument",params:{type:null,data:null},controller:"UserIdDocumentCtrl",templateUrl:"app/modules/manage-user-documents/views/user-id-document-manage.html",ncyBreadcrumb:{label:"MANAGE_USER_ID_DOCUMENT",parent:"myDocuments",actionType:"add"}}).state("otherDocument",{url:"/otherDocument",params:{type:null,data:null,id:null},controller:"OtherDocumentCtrl",templateUrl:"app/modules/manage-user-documents/views/other-document-manage.html",ncyBreadcrumb:{label:"MANAGE_OTHER_DOCUMENT",parent:"myDocuments",actionType:"add"}}).state("confirmsharedocument",{url:"/confirmsharedocument/:accessKeyId",controller:"ShareWithMeListCtrl",templateUrl:"app/modules/manage-user-documents/views/confirm-share-document.html",ncyBreadcrumb:{label:"CONFIRM_SHARE_DOCUMENT",parent:"myDocuments",actionType:"add"}}).state("otherDocumentList",{url:"/otherDocumentList",controller:"OtherDocumentListCtrl",templateUrl:"app/modules/manage-user-documents/views/other-documents-tab.html",ncyBreadcrumb:{label:"MY_DOCUMENTS"}})}]),angular.module("paripal.manageUserProfile",[]).config(["$stateProvider",function(a){"use strict";a.state("myProfile",{url:"/myProfile",controller:"ManageUserProfileCtrl",templateUrl:"app/modules/manage-user-profile/views/manage-user-profile.html",ncyBreadcrumb:{label:"USER_PROFILE"}})}]),angular.module("paripal.medicationEquivalenceModule",[]).config(["$stateProvider",function(a){a.state("equlist",{url:"/equlist/:medicationId/:diseaseVariantId/:medicationVariantId/:medication/:medicationVariant/:diseaseVariant",controller:"equivalenceCtrl",templateUrl:"app/modules/medication-equivalence/views/view-equivalence.html",ncyBreadcrumb:{label:"MEDICATION_EQUIVALENCE"},params:{org:null}}).state("manageequivalence",{url:"/manageequivalence/:id/:type",controller:"manageequivalenceCtrl",templateUrl:"app/modules/medication-equivalence/views/manage-equivalence.html",params:{fromState:"manageequivalence",type:"add",data:null},ncyBreadcrumb:{label:"MANAGE_EQUIVALENCE",parent:"equlist",actionType:"add"}})}]),angular.module("paripal.medicationSideEffectModule",[]).config(["$stateProvider",function(a){a.state("usersideeffectlist",{url:"/usersideeffectlist/:medicationId/:variantId/:medication/:medicationVariant",controller:"userSideEffectListCtrl",templateUrl:"app/modules/medication-side-effect/views/view-user-medication-side-effect.html",ncyBreadcrumb:{label:"USER_MEDICATION_SIDE_EFFECT"},params:{org:null}}).state("sideeffectlist",{url:"/sideeffectlist",controller:"SideEffectListCtrl",templateUrl:"app/modules/medication-side-effect/views/view-medication-side-effect.html",ncyBreadcrumb:{label:"MEDICATION_SIDE_EFFECT"},params:{org:null}}).state("managesideeffect",{url:"/managesideeffect/:id/:type",controller:"manageSideEffectCtrl",templateUrl:"app/modules/medication-side-effect/views/manage-side-effect.html",params:{fromState:"managesideeffect",type:"add",data:null},ncyBreadcrumb:{label:"MANAGE_SIDE_EFFECT",parent:"usersideeffectlist",actionType:"add"}})}]),/**
 * Creating dynamic menu in the application
 * 
 */
angular.module("paripal.menuModule",[]),angular.module("paripal.menuModule").config(function(){}),angular.module("paripal.messagingModule",[]).config(["$stateProvider",function(a){"use strict";a.state("messageCategorySubCategory",{url:"/messageCategorySubCategory",controller:"MessagingListCtrl",templateUrl:"app/modules/messaging/views/message_category_sub_category.html",ncyBreadcrumb:{label:"MESSAGE_CATEGORY"},params:{cat:null}}).state("messageSubCategory",{url:"/messageSubCategory",controller:"MessagingSubCatListCtrl",templateUrl:"app/modules/messaging/views/message_sub_category.html",ncyBreadcrumb:{label:"MESSAGE_SUBCATEGORY"},params:{cat:null}}).state("messageEvents",{url:"/messageEvents",controller:"EventConfCtrl",templateUrl:"app/modules/messaging/views/message_events_configuration.html",ncyBreadcrumb:{label:"MESSAGE_EVENTS"}}).state("manageTemplate",{url:"/manageTemplate/:msgEventConfigId/:cat/:subCat/:event",controller:"ManageTemplateCtrl",templateUrl:"app/modules/messaging/views/manage_templates.html",params:{templateList:null},ncyBreadcrumb:{label:"MANAGE_TEMPLATE"}}).state("configureTemplate",{url:"/configureTemplate/:templateId/:cat/:subCat/:event/:recipientTypeId/:type/:eventConfigId",controller:"TemplateConfigureCtrl",templateUrl:"app/modules/messaging/views/configure_template.html",params:{template:null},ncyBreadcrumb:{label:"CONFIGURE_TEMPLATE"}}).state("manageEventSubscription",{url:"/manageEventSubscription",controller:"MessageEvtSubCtrl",templateUrl:"app/modules/messaging/views/message_event_subscriber_settings.html",ncyBreadcrumb:{label:"MANAGE_USER_MESSAGE_EVENTS_SUBSCRIPTION"},params:{user:null}}).state("overridenMessageEvents",{url:"/overridenMessageEvents",controller:"EventOverrideConfCtrl",templateUrl:"app/modules/messaging/views/overriden_message_events.html",ncyBreadcrumb:{label:"MESSAGE_EVENT_CONFIGURATION"}}).state("manageTemplateOverride",{url:"/manageTemplateOverride/:msgEventConfigId/:cat/:subCat/:event/:orgLocId",controller:"ManageTemplateOverrideCtrl",templateUrl:"app/modules/messaging/views/manage_templates_override.html",params:{templateList:null,orgLoc:null},ncyBreadcrumb:{label:"MANAGE_TEMPLATE"}}).state("configureTemplateOverride",{url:"/configureTemplateOverride/:templateId/:cat/:subCat/:event/:overriden/:orgLocId/:recipientTypeId/:templateConfigId/:type/:eventConfigId",controller:"TemplateOverrideConfigureCtrl",templateUrl:"app/modules/messaging/views/configure_template_override.html",params:{template:null},ncyBreadcrumb:{label:"CONFIGURE_TEMPLATE"}}).state("messagingGroup",{url:"/messagingGroup",controller:"MessagingGroupListCtrl",templateUrl:"app/modules/messaging/views/messaging_group.html",ncyBreadcrumb:{label:"MESSAGE_GROUP_LIST"}}).state("messagingGroupUser",{url:"/messagingGroupUser/:type",controller:"MessagingGroupUserListCtrl",templateUrl:"app/modules/messaging/views/msg-group-user-list.html",params:{type:null,msgGroup:null,organizationLocation:null},ncyBreadcrumb:{label:"MESSAGING_GROUP_DETAILS"}}).state("messagingGroupDefinition",{url:"/messagingGroupDefinition/:groupId",controller:"MessagingGroupDefinitionCtrl",templateUrl:"app/modules/messaging/views/msg-group-definition.html",params:{groupId:null,msgGroup:null,organizationLocation:null},ncyBreadcrumb:{label:"MESSAGING_GROUP_DETAILS"}}).state("messagingOrgGroupUser",{url:"/messagingOrgGroupUser/:menuNevigate/:type",controller:"MessageOrgUserListCtrl",templateUrl:"app/modules/messaging/views/msg-org-user-list.html",params:{type:null,organizationLocation:null,menuNevigate:null,msgGroup:null,groupUserType:null,whetherAdmin:null,adhocMsgEventConfigId:null,displayCode:null,userIds:[],isIndividualUserMode:null},ncyBreadcrumb:{label:"LIST_ORG_USER"}}).state("messagingClientGroupUser",{url:"/messagingClientGroupUser/:menuNevigate/:type",controller:"MsgOrgLocClientListCtrl",templateUrl:"app/modules/messaging/views/msg-org-loc-client-list.html",params:{type:null,organizationLocation:null,menuNevigate:null,msgGroup:null,groupUserType:null,adhocMsgEventConfigId:null,displayCode:null,userIds:[]},ncyBreadcrumb:{label:"ORGANIZATION_CLIENT_LIST"}}).state("adhocMessages",{url:"/adhocMessages",controller:"AdhocMessagingListCtrl",templateUrl:"app/modules/messaging/views/adhoc-message-list.html",ncyBreadcrumb:{label:"ADHOC_MESSAGE_LIST"},params:{user:null,type:null}}).state("manageAdhocMessage",{url:"/manageAdhocMessage/:type/:adhocMsgEventConfigId",controller:"ManageAdhocMessageCtrl",params:{type:null,adhocMsgEventConfigId:null,displayCode:null,msgCategory:null,msgSubCategory:null,isIndividualUser:null},templateUrl:"app/modules/messaging/views/manage-adhoc-message.html",ncyBreadcrumb:{label:"MANAGE_ADHOC_MESSAGE"}}).state("showAdhocMessageRecipient",{url:"/showAdhocMessageRecipient/:type/:adhocMsgEventConfigId",controller:"AdhocMessageRecipientCtrl",params:{type:null,organizationLocation:null,adhocMsgEventConfigId:null,displayCode:null,isIndividualUserMode:null},templateUrl:"app/modules/messaging/views/show-adhoc-msg-recipient.html",ncyBreadcrumb:{label:"MANAGE_ADHOC_MESSAGE_RECIPIENT"}}).state("addAdhocMessageGroup",{url:"/addAdhocMessageGroup/:type/:adhocMsgEventConfigId",controller:"AdhocMsgGroupListCtrl",params:{type:null,organizationLocation:null,adhocMsgEventConfigId:null,displayCode:null},templateUrl:"app/modules/messaging/views/adhoc-messaging-group.html",ncyBreadcrumb:{label:"MESSAGE_GROUP_LIST"}}).state("customizeMsgGroupUser",{url:"/customizeMsgGroupUser/:type/:adhocMsgEventConfigId/:adhocMsgGroupId/:msgGroupId",controller:"CustomizeMsgGroupUserCtrl",params:{type:null,organizationLocation:null,msgGroupId:null,groupName:null,adhocMsgGroupId:null,adhocMsgEventConfigId:null,displayCode:null},templateUrl:"app/modules/messaging/views/customize-messaging-group.html",ncyBreadcrumb:{label:"CUSTOMIZE_MESSAGE_GROUP_MEMBERS"}}).state("viewMessageFailures",{url:"/viewMessageFailures",controller:"MessagingListCtrl",templateUrl:"app/modules/messaging/views/view_message_failures.html",ncyBreadcrumb:{label:"VIEW_MESSAGE_FAILURES"}}).state("notification",{url:"/notification/:msgId",params:{fromState:"notification",msgId:null,data:null},controller:"MsgNotificationListCtrl",templateUrl:"app/modules/messaging/views/notification.html",ncyBreadcrumb:{label:"NOTIFICATION",parent:"notificationlist"}}).state("notificationlist",{url:"/notificationlist",controller:"MsgNotificationListCtrl",templateUrl:"app/modules/messaging/views/msg-notification-list.html",ncyBreadcrumb:{label:"NOTIFICATION_LIST"},params:{user:null,type:null}}).state("messagestatus",{url:"/messagestatus",controller:"MessagingFailuresListCtrl",templateUrl:"app/modules/messaging/views/message-failures-list.html",ncyBreadcrumb:{label:"MESSAGE_STATUS"}}).state("messagingstatistics",{url:"/messagingstatistics",controller:"AdhocMessagingListCtrl",templateUrl:"app/modules/messaging/views/adhoc-message-list.html",ncyBreadcrumb:{label:"ADHOC_MESSAGE_LIST"}}).state("msgconversation",{url:"/msgconversation",controller:"MessageConversationListCtrl",templateUrl:"app/modules/messaging/views/message-conversation-list.html",ncyBreadcrumb:{label:"MESSAGE_CONVERSATIONS"},params:{data:null}}).state("msgconversationview",{url:"/msgconversationview/:fromState/:msgId",controller:"MessageConversationViewCtrl",templateUrl:"app/modules/messaging/views/message-conversation-view.html",ncyBreadcrumb:{label:"MESSAGE_CONVERSATION_VIEW"},params:{data:null,msgId:null,fromState:null}}).state("msgconversationadd",{url:"/msgconversationadd/:type",controller:"MessageConversationAddCtrl",templateUrl:"app/modules/messaging/views/message-conversation-add.html",ncyBreadcrumb:{label:"NEW_MESSAGE"},params:{type:null,data:null}}).state("searchsms",{url:"/searchsms",controller:"SearchSmsCtrl",templateUrl:"app/modules/messaging/views/search-sms.html",ncyBreadcrumb:{label:"SEARCH_SMS"},params:{user:null}}).state("messagingmanagement",{url:"/messagingmanagement",templateUrl:"app/modules/messaging/views/messaging-management.html",ncyBreadcrumb:{label:"MESSAGING_MANAGEMENT"},controller:"MessagingManagementCtrl"}).state("quickClientMsg",{url:"/quickClientMsg",templateUrl:"app/modules/messaging/views/manage-quick-adhoc-msg.html",ncyBreadcrumb:{label:"MESSAGING_MANAGEMENT"},params:{type:"client",message:null,sms:null},controller:"ManageQuickAdhocMsgCtrl"}).state("quickMsgClientList",{url:"/quickMsgClientList/:menuNevigate/:type",templateUrl:"app/modules/messaging/views/client-quick-list.html",ncyBreadcrumb:{label:"MESSAGING_MANAGEMENT"},controller:"ClientQuickListCtrl",params:{type:null,organizationLocation:null,menuNevigate:null,msgGroup:null,groupUserType:null,adhocMsgEventConfigId:null,displayCode:null,userCatagory:null}}).state("quickInternalUserMsg",{url:"/quickInternalUserMsg",templateUrl:"app/modules/messaging/views/manage-quick-adhoc-msg.html",ncyBreadcrumb:{label:"MESSAGING_MANAGEMENT"},params:{type:"org_user"},controller:"ManageQuickAdhocMsgCtrl"}).state("quickMsgOrgUserList",{url:"/quickMsgOrgUserList/:menuNevigate/:type",templateUrl:"app/modules/messaging/views/org_user_quick_list.html",ncyBreadcrumb:{label:"MESSAGING_MANAGEMENT"},controller:"ClientQuickListCtrl",params:{type:null,organizationLocation:null,menuNevigate:null,msgGroup:null,groupUserType:null,adhocMsgEventConfigId:null,displayCode:null,userCatagory:null}}).state("messagingReportList",{url:"/messagingReportList",controller:"MessagingReportListCtrl",templateUrl:"app/modules/messaging/views/messaging-report-list.html",ncyBreadcrumb:{label:"MESSAGE_REPORT_LIST"}})}]),angular.module("numbering",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("numbering",{url:"/numbering",controller:"NumberingCtrl",templateUrl:"app/modules/numbering/views/numbering.html",ncyBreadcrumb:{label:"ID_GENERATOR",actionType:"add"}})}]).directive("numbersOnly",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(void 0==a)return"";var b=a.replace(/[^0-9]/g,"");return b!=a&&(d.$setViewValue(b),d.$render()),b})}}}),$(document).ready(function(){var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide(),a.click(function(c){c.preventDefault();var d=$($(this).attr("href")),e=$(this);e.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),e.addClass("btn-primary"),b.hide(),d.show(),d.find("input:eq(0)").focus())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a"),d=a.find("input[type='text'],input[type='url']"),e=!0;$(".form-group").removeClass("has-error");for(var f=0;f<d.length;f++)d[f].validity.valid||(e=!1,$(d[f]).closest(".form-group").addClass("has-error"));e&&c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.orgHealthProfessionalSpecialization",[]).config(["$stateProvider",function(a){a.state("orghealthprofessionallist",{url:"/orghealthprofessionallist",controller:"orgHealthProfessionalListCtrl",templateUrl:"app/modules/org-health-professional-specializations/views/org-health-professional-list.html",params:{type:null,professional:null},ncyBreadcrumb:{label:"HEALTH_PROFESSIONALS"}})}]),angular.module("paripal.organizationLocationAddress",[]).config(["$stateProvider",function(a){"use strict";a.state("orgLocationAddressList",{params:{type:null,organization:null,organizationLocation:null,wallData:null},url:"/orglocationaddresslist",controller:"OrgLocationAddressListCtrl",templateUrl:"app/modules/organization-location-address/views/org-loc-address-list.html",ncyBreadcrumb:{label:"ORGANIZATION_LOCATION_ADDRESS"}}).state("manageOrgLocationAddress",{params:{type:null,organization:null,organizationLocation:null,organizationLocationAddressId:null},url:"/manageOrgLocationAddress/:type/:organizationLocationAddressId",controller:"ManageOrgLocationAddressCtrl",templateUrl:"app/modules/organization-location-address/views/manage-org-loc-address.html",ncyBreadcrumb:{label:"MANAGE_ORGANIZATION_LOCATION_ADDRESS",actionType:"add"}})}]),angular.module("paripal.managePackages",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider","ChartJsProvider",function(a,b,c,d){a.state("searchpackages",{url:"/searchpackages",params:{type:null,data:null},controller:"SearchPackagesCtrl",templateUrl:"app/modules/packages-management/views/search-packages.html",ncyBreadcrumb:{label:"MEDICAL_TEST_PACKAGE_LIST"}}).state("managepackage",{url:"/managepackage",params:{type:null,data:null},controller:"ManagePackagesCtrl",templateUrl:"app/modules/packages-management/views/manage-packages.html",ncyBreadcrumb:{label:"MANAGE_MEDICAL_TEST_PACKAGE",parent:"searchpackages",actionType:"add"}}).state("managepackageinclusions",{url:"/managepackageinclusions",params:{type:null,data:null},controller:"ManagePackageInclusionsCtrl",templateUrl:"app/modules/packages-management/views/manage-package-inclusions.html",ncyBreadcrumb:{label:"MANAGE_PACKAGE_CONSTITUENT",parent:"packageinclusionlist",actionType:"add"}}).state("packageinclusionlist",{url:"/packageinclusionlist",params:{type:null,data:null},controller:"PackageInclusionListCtrl",templateUrl:"app/modules/packages-management/views/package-inclusion-list.html",ncyBreadcrumb:{label:"PACKAGE_INCLUSION_LIST",parent:"searchpackages"}})}]),angular.module("paripal.patientRecordModule",[]).config(["$stateProvider",function(a){a.state("patientRecord",{url:"/patientrecord/:id/:displayName/:locationId/:locationValue",templateUrl:"app/modules/patient-record/view/patientrecord.html",controller:"vpr_ctrl",ncyBreadcrumb:{label:"PATIENT_RECORD"},params:{data:null,id:null,displayName:null,locationId:null,locationValue:null,transactionType:null,otp:null,accessKeyId:null}})}]),angular.module("paripal.pharmacyInteractionModule",[]).config(["$stateProvider",function(a){a.state("pharmacyorderlist",{url:"/pharmacyorderlist",controller:"pharmacyOrderListCtrl",templateUrl:"app/modules/pharmacy-interaction/views/pharmacy-order.html",ncyBreadcrumb:{label:"PHARMACY_ORDER"},params:{org:null}}).state("manageorderpharmacy",{url:"/manageorderpharmacy/:id/:type/:requestId",params:{fromState:"manageorderpharmacy",type:"add",data:null},controller:"managePharmacyOrderCtrl",templateUrl:"app/modules/pharmacy-interaction/views/manageOrderPharmacy.html",ncyBreadcrumb:{label:"MANAGE_PHARMACY_ORDER",parent:"pharmacyorderlist",actionType:"add"}}).state("fulfillmentlist",{url:"/fulfillmentlist",params:{fromState:"fulfillmentlist",type:"add",data:null},controller:"pharmacyOrderFulfillmentListCtrl",templateUrl:"app/modules/pharmacy-interaction/views/pharmacy-order-fulfillment-list.html",ncyBreadcrumb:{label:"PHARMACY_ORDER_FULFILLMENT"}}).state("managepharmacyorderfulfillment",{url:"/managepharmacyorderfulfillment/:id/:type",params:{fromState:"managepharmacyorderfulfillment",type:"add",data:null},resolve:{id:function(){return localStorage.getItem("id")}},controller:"managePharmacyOrderFulfillmentCtrl",templateUrl:"app/modules/pharmacy-interaction/views/manage-pharmacy-order-fulfillment.html",ncyBreadcrumb:{label:" MANAGE_PHARMACY_ORDER_FULFILLMENT",parent:"pharmacyorderlist",actionType:"add"}}).state("fulfillmentandalternatives",{url:"/fulfillmentandalternatives/:id/:type",params:{fromState:"fulfillmentandalternatives",type:"add",data:null},controller:"fulfillmentAndAlternativeCtrl",templateUrl:"app/modules/pharmacy-interaction/views/medication-fulfilment-and-alternatives.html",ncyBreadcrumb:{label:"FULFILLMENT_AND_ALTERNATIVES",parent:"managepharmacyorderfulfillment",actionType:"add"}}).state("locationmedication",{url:"/locationmedication",params:{pageState:null,type:null,data:null},controller:"LocationMedicationCtrl",templateUrl:"app/modules/pharmacy-interaction/views/location-medication.html",ncyBreadcrumb:{label:"LOCATION_MEDICATION"}}).state("locationmedicationlist",{url:"/locationmedicationlist",params:{fromState:null,type:null,data:null},controller:"LocationMedicationListCtrl",templateUrl:"app/modules/pharmacy-interaction/views/location-medication-list.html",ncyBreadcrumb:{label:"LOCATION_MEDICATION_LIST"}})}]),angular.module("paripal.professionalWallModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("manageprofessionalwall",{url:"/manageprofessionalwall",controller:"ManageProfessionalWallCtrl",templateUrl:"app/modules/professional-wall/views/manage-professional-wall.html",ncyBreadcrumb:{label:"MANAGE_PROFESSIONAL_WALL"},params:{callingUrl:null,userData:null}}).state("professionalwall",{url:"/professionalwall",controller:"ViewProfessionalWallCtrl",templateUrl:"app/modules/professional-wall/views/view-professional-wall.html",ncyBreadcrumb:{label:"PROFESSIONAL_WALL"},params:{callingUrl:null,userData:null}})}]),angular.module("paripal.reportsModule",[]).config(["$stateProvider","$translateProvider",function(a,b){/*Closed complaint report*/
a.state("complaintreports",{url:"/complaintreports",controller:"complaintClosedCtrl",templateUrl:"app/modules/reports/views/complaint-closed.html",ncyBreadcrumb:{label:"COMPLAINTS_REPORTS"},params:{org:null}}).state("locationtreatmenttypereports",{url:"/locationtreatmenttypereports",controller:"locTreatTypeMonthlyClientCountChartCtrl",templateUrl:"app/modules/reports/views/loc-treat-type-monthly-client-count-chart.html",ncyBreadcrumb:{label:"LOC_TREAT_TYPE_REPORTS"},params:{orgLocation:null,treatmentType:null,data:null,wallData:null}}).state("orgLocTreatmentTypeFeeStatistics",{url:"/orgLocTreatmentTypeFeeStatistics",controller:"orgLocTreatmentTypeFeeStatisticsCtrl",templateUrl:"app/modules/reports/views/org-loc-treatment-type-fee-statistics.html",ncyBreadcrumb:{label:"ORG_LOC_TREATMENT_TYPE_FEE_STATISTICS"},params:{orgLocation:null,treatmentType:null,data:null}}).state("orgLocServiceTypeFeeStatistics",{url:"/orgLocServiceTypeFeeStatistics",controller:"orgLocServiceTypeFeeStatisticsCtrl",templateUrl:"app/modules/reports/views/org-loc-service-type-fee-statistics.html",ncyBreadcrumb:{label:"ORG_LOC_SUPPORT_SERVICE_TYPE_FEE_STATISTICS"},params:{orgLocation:null,treatmentType:null,data:null}}).state("orgLocTransactionTypeFeeStatistics",{url:"/orgLocTransactionTypeFeeStatistics",controller:"orgLocTransactionTypeFeeStatisticsCtrl",templateUrl:"app/modules/reports/views/org-loc-transaction-type-fee-statistics.html",ncyBreadcrumb:{label:"ORG_LOC_TRANSACTION_TYPE_FEE_STATISTICS"},params:{orgLocation:null,treatmentType:null,data:null}}).state("proftreatmenttypetransactioncount",{url:"/proftreatmenttypetransactioncount",controller:"monthlyProfTreatmentTransChartCtrl",templateUrl:"app/modules/reports/views/monthly-prof-treatment-trans-chart.html",params:{professional:null},ncyBreadcrumb:{label:"PROF_TREATMENT_TRANS_CHART"}}).state("monthlyusercountbydiseaseforprof",{url:"/monthlyusercountbydiseaseforprof",controller:"monthlyUserCountByDiseaseForProfChartCtrl",templateUrl:"app/modules/reports/views/monthly-user-count-by-disease-for-prof-chart.html",params:{professional:null},ncyBreadcrumb:{label:"MONTHLY_USER_COUNT_BY_DISEASE_FOR_PROF"}}).state("monthlyusercountbydisvarfordisease",{url:"/monthlyusercountbydisvarfordisease",controller:"monthlyUserCountByDisVarForDiseaseChartCtrl",templateUrl:"app/modules/reports/views/monthly-user-count-by-dis-var-for-disease-chart.html",params:{professional:null},ncyBreadcrumb:{label:"MONTHLY_USER_COUNT_BY_DISEASE_VARIANT_FOR_DISEASE_CHART"}}).state("usercountbydiseaseforperiod",{url:"/usercountbydiseaseforperiod",controller:"userCountByDiseaseForPeriodChartCtrl",templateUrl:"app/modules/reports/views/user-count-by-disease-for-period-chart.html",params:{professional:null},ncyBreadcrumb:{label:"USER_COUNT_BY_DISEASE_FOR_PERIOD"}}).state("supportprofessionalreports",{url:"/supportprofessionalreports",controller:"supportProfPositiveNegativeRatingCtrl",templateUrl:"app/modules/reports/views/support-porf-positive-negaive-rating.html",ncyBreadcrumb:{label:"SUPPORT_PROFESSIONAL_REPORTS"},params:{professional:null}}).state("eventsreports",{url:"/eventsreports",controller:"eventWiseRatingCtrl",templateUrl:"app/modules/reports/views/event-wise-rating.html",ncyBreadcrumb:{label:"EVENT_REPORTS"}}).state("healthprofessionalreports",{url:"/healthprofessionalreports",controller:"porfReviewAverageRatingCtrl",templateUrl:"app/modules/reports/views/prof-review-average-rating.html",ncyBreadcrumb:{label:"HEALTH_PROF_REPORTS"},params:{professional:null}}).state("packagereports",{url:"/packagereports",controller:"packagewiseUserCountCtrl",templateUrl:"app/modules/reports/views/package-wise-user-count.html",ncyBreadcrumb:{label:"PACKAGE_STATISTICS"},params:{data:null}}).state("monthlymsgrcpntcount",{url:"/monthlymsgrcpntcount",controller:"monthlyMsgRcpntCountCtrl",templateUrl:"app/modules/reports/views/monthly-msg-rcpnt-count.html",ncyBreadcrumb:{label:"MESSAGE_STATISTICS"},params:{data:null}}).state("monthlyfailedmsgcount",{url:"/monthlyfailedmsgcount",controller:"monthlyFailedMsgCountCtrl",templateUrl:"app/modules/reports/views/monthly-falid-msg-count.html",ncyBreadcrumb:{label:"MONTHLY_FAILED_MSG_COUNT_CHART"},params:{data:null}}).state("msgsubtypewisereport",{url:"/msgsubtypewisereport",controller:"msgSubtypeWiseReportCtrl",templateUrl:"app/modules/reports/views/msg-subtype-report.html",ncyBreadcrumb:{label:"MESSAGE_SUBTYPE_REPORT_CHART"},params:{data:null}}).state("labstatisticsreports",{url:"/labstatisticsreports",controller:"labStatisticsReportsCtrl",templateUrl:"app/modules/reports/views/lab-statistics-reports.html",ncyBreadcrumb:{label:"LAB_STATISTICS_REPORTS"},params:{data:null}}).state("orgreviewreport",{url:"/orgreviewreport",controller:"orgReviewReportCtrl",templateUrl:"app/modules/reports/views/organization-review-statistics.html",ncyBreadcrumb:{label:"ORGANIZATION_REVIEW_REPORT"},params:{data:null,wallData:null}}).state("loctransactiontypereport",{url:"/loctransactiontypereport",controller:"locTransactionTypeReportCtrl",templateUrl:"app/modules/reports/views/loc-transaction-type-report.html",ncyBreadcrumb:{label:"LOCATION_TRANSACTION_TYPE_REPORT"},params:{data:null}}).state("locservicetypereport",{url:"/locservicetypereport",controller:"locServiceTypeReportCtrl",templateUrl:"app/modules/reports/views/loc-service-type-report.html",ncyBreadcrumb:{label:"LOCATION_SUPPORT_SERVICE_TYPE_REPORT"},params:{data:null}})}]),angular.module("paripal.reportsModule").service("reportsService",["httpService","$filter","urlService","dateconvertor","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f){"use strict";this.getComplaintClosedReport=function(b,d,e){a.postData(c.getUrl("GET_CLOSED_COMPLAINTS"),b,function(a){d(a.data)},function(a){e(a)})},this.getComplaintWiseServiceLevelReport=function(b,d,e){a.postData(c.getUrl("GET_COMPLAINT_COUNT_BY_SERVICE_LEVEL"),b,function(a){d(a.data)},function(a){e(a)})},this.getAllComplaintCountReport=function(b,d,e){a.postData(c.getUrl("GET_ALL_COMPLAINTS"),b,function(a){d(a.data)},function(a){e(a)})},this.getStatusWiseComplaintCountReport=function(b,d,e){a.postData(c.getUrl("GET_COMPLAINT_COUNT_BY_STATUS"),b,function(a){d(a.data)},function(a){e(a)})},this.getMonthlyUserCountByDiseaseForProfReport=function(b,d,e){a.postData(c.getUrl("GET_MONTHLY_USER_COUNT_BY_DISEASE_FOR_PROF"),b,function(a){d(a.data)},function(a){e(a)})},this.getMonthlyUserCountByDisVarForDiseaseReport=function(b,d,e){a.postData(c.getUrl("GET_USER_COUNT_BY_DISEASE_VARIANT"),b,function(a){d(a.data)},function(a){e(a)})},this.getUserCountByDiseaseForPeriodReport=function(b,d,e){a.postData(c.getUrl("GET_USER_COUNT_BY_DISEASE_VARIANT_FOR_PERIOD"),b,function(a){d(a.data)},function(a){e(a)})},this.getMonthlyProfTreatmentTransReport=function(b,d,e){a.postData(c.getUrl("GET_PROF_TREATMENT_TYPE_TRANS_COUNT"),b,function(a){d(a.data)},function(a){e(a)})},this.getMonthlyClientCountForProfTreatmentTypeReport=function(b,d,e){a.postData(c.getUrl("GET_PROF_TREATMENT_TYPE_CLIENT_COUNT"),b,function(a){d(a.data)},function(a){e(a)})},this.getTransCountOfTreatmentTypeByDisVarReport=function(b,d,e){a.postData(c.getUrl("GET_PROF_TREATMENT_TYPE_TRANS_COUNT_DIS_VAR"),b,function(a){d(a.data)},function(a){e(a)})},this.getLocTreatTypeMonthlyTransCountReport=function(b,d,e){a.postData(c.getUrl("GET_ORG_LOC_TREATMENT_TYPE_MONTHLY_TRANS_COUNT"),b,function(a){d(a.data)},function(a){e(a)})},this.getLocTreatTypeMonthlyClientCountReport=function(b,d,e){a.postData(c.getUrl("GET_ORG_LOC_TREATMENT_TYPE_USER_COUNT"),b,function(a){d(a.data)},function(a){e(a)})},this.getLocTreatTypeCountByOrgLocReport=function(b,d,e){a.postData(c.getUrl("GET_TREATMENT_COUNT_BY_ORGLOC"),b,function(a){d(a.data)},function(a){e(a)})},this.getLocTreatTypeTransCountByOrgLocReport=function(b,d,e){a.postData(c.getUrl("GET_TREAT_TRANS_COUNT_BY_LOC"),b,function(a){d(a.data)},function(a){e(a)})},this.getTreatmentTypeUserCountForPeriod=function(b,d,e){a.postData(c.getUrl("GET_ORG_LOC_TREATMENT_TYPE_USER_COUNT_FOR_PERIOD"),b,function(a){d(a.data)},function(a){e(a)})},this.getTreatmentTypeFeeStats=function(b,d,e){a.postData(c.getUrl("GET_ORG_LOC_TREATMENT_TYPE_FEE_STATISTICS"),b,function(a){d(a.data)},function(a){e(a)})},this.getLocTreatTypeCountReport=function(b,d,e){a.postData(c.getUrl("GET_PROF_TREATMENT_TYPE_CLIENT_COUNT"),b,function(a){d(a.data)},function(a){e(a)})},this.getEventWiseRatingReport=function(b,d,e){a.postData(c.getUrl("GET_EVENT_WISE_RATING"),b,function(a){d(a.data)},function(a){e(a)})},this.getProfWiseRatingReport=function(b,d,e){a.postData(c.getUrl("GET_PROFESSIONAL_WISE_RATING"),b,function(a){d(a.data)},function(a){e(a)})},this.getEventRatingDistReport=function(b,d,e){a.postData(c.getUrl("GET_EVENT_RATING_DIST"),b,function(a){d(a)},function(a){e(a)})},this.getProfDisStatsReport=function(b,d,e){a.postData(c.getUrl("GET_PROFESSIONAL_DISEASE_REPORT"),b,function(a){d(a.data)},function(a){e(a)})},this.getLabStatisticsReports=function(b,d,e){a.postData(c.getUrl("LAB_STAT_FIND_BY_CRITERIA"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule",[]).config(["$stateProvider",function(a){a.state("requestmgntlist",{url:"/requestmgntlist/:requestType/:scheduleId",controller:"searchReqManagementCtrl",templateUrl:"app/modules/request-management/views/search-request-management.html",ncyBreadcrumb:{label:"CREATE_REQUEST_LIST"},params:{requestType:null,userId:null,userName:null,id:null,type:null,fromState:null}}).state("createrequest",{url:"/createrequest/:id/:type/:scheduleId",params:{fromState:"createrequest",type:"add",data:null,callingUrl:null,callingUrlData:null,userData:null,stateFlag:null},controller:"manageRequestCtrl",templateUrl:"app/modules/request-management/views/create-request.html",ncyBreadcrumb:{
// parent: "requestmgntlist",
label:"MANAGE_REQUEST_LIST"}}).state("respondtoReq",{url:"/respondtoReq/:requestId/:id/:type",params:{fromState:"respondtoReq",type:"",data:null},controller:"respondToReqCtrl",templateUrl:"app/modules/request-management/views/respondToRequest.html",ncyBreadcrumb:{
//parent: "requestmgntlist",
label:"RESPOND_TO_REQUEST"}}).state("visitSceduleExp",{url:"/visitSceduleExp",controller:"visitScheduleExpCtrl",templateUrl:"app/modules/request-management/views/visitScheduleException.html",ncyBreadcrumb:{label:"VISIT_SCHEDULE_EXCEPTION"},params:{org:null}}).state("manageReqAttach",{url:"/manageReqAttach",templateUrl:"app/modules/request-management/views/manageRequestAttachments.html",ncyBreadcrumb:{label:"MANAGE_ENTITY_ATTACHMENTS",actionType:"add"},params:{org:null}}).state("reqFulfilLst",{url:"/reqFulfilLst/:requestId/:requestsType",controller:"reqFulfilLstCtrl",templateUrl:"app/modules/request-management/views/requestFulfilmentListing.html",ncyBreadcrumb:{
// parent: "requestmgntlist",
label:"REQUEST_FULLFILMENT_LIST"},params:{org:null}}).state("adviceTransactionView",{url:"/adviceTransactionView/:id/:type",controller:"adviceTransactionViewCtrl",templateUrl:"app/modules/request-management/views/adviceTransactionView.html",ncyBreadcrumb:{label:"ADVICE_TRANSACTION_VIEW"},params:{org:null}}).state("pageEntitySharingLst",{url:"/pageEntitySharingLst",controller:"pageEntityShareLstCtrl",templateUrl:"app/modules/request-management/views/pageEntityListing.html",ncyBreadcrumb:{label:"PAGE_ENTITY_SHARE_LIST"}}).state("myReq",{url:"/myReq/:prevReq/:requestType",controller:"myReqctrl",templateUrl:"app/modules/request-management/views/myRequest.html",ncyBreadcrumb:{label:"MY_REQUEST_LIST"},params:{requestType:null,fromState:null}}).state("Nonuserdetails",{url:"/Nonuserdetails/:id/:type",controller:"nonuserCtrl",templateUrl:"app/modules/request-management/views/Non-user-details.html",ncyBreadcrumb:{label:"NON_USER_DETAILS"},params:{org:null}}).state("requestDetails",{url:"/requestDetails",controller:"requestDetailsCtrl",templateUrl:"app/modules/request-management/views/request-details.html",ncyBreadcrumb:{label:"Request details"},params:{org:null}}).state("definevisitschedule",{url:"/definevisitschedule",controller:"visitscheduleCtrl",templateUrl:"app/modules/request-management/views/define-visit-schedule.html",ncyBreadcrumb:{label:"DEFINE_VISIT_SCHEDULE"},params:{org:null}}).state("responsetorequest",{url:"/responsetorequest/:id/",controller:"responseToRequestCtrl",templateUrl:"app/modules/request-management/views/response-to-request.html",ncyBreadcrumb:{label:"RESPONSE_TO_REQUEST"},params:{org:null,userData:null}}).state("healthprofessional",{url:"/healthprofessional",controller:"healthProfessionalCtrl",templateUrl:"app/modules/request-management/views/health-professional-popup.html",ncyBreadcrumb:{label:"Health Professional"},params:{org:null}}).state("requeststatus",{url:"/requeststatus/:type/:requestId/:id/:scheduleId",params:{fromState:"requeststatus",type:"add",data:null,stateFlag:null,appointmentId:null},controller:"requestStatusCtrl",templateUrl:"app/modules/request-management/views/request-status.html",ncyBreadcrumb:{label:"REQUEST_STATUS"}}).state("manageentitymsg",{url:"/manageentitymsg",controller:"mngEntityMsgCtrl",templateUrl:"app/modules/request-management/views/manage -entity-messages.html",ncyBreadcrumb:{label:"MANAGE_ENTITY_MESSAGES",actionType:"add"},params:{org:null}}).state("requestmanagement",{url:"/requestmanagement",controller:"RequestManagementCtrl",templateUrl:"app/modules/request-management/views/request-management.html",params:{requestType:null},ncyBreadcrumb:{label:"REQUEST_MANAGEMENT"}}).state("organizationRequestStatistics",{url:"/organizationRequestStatistics",controller:"OrganizationRequestStatisticsCtrl",templateUrl:"app/modules/request-management/views/organization-request-statistics.html",params:{requestType:null},ncyBreadcrumb:{label:"CREATE_REQUEST_LIST"}})}]),angular.module("paripal.manageResources",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("resourcelist",{/*********  additional param added by Anbu mitosis team ********/
url:"/resourcelist/:checklistTypeId/:resourceNameContains",controller:"ResourceListCtrl",templateUrl:"app/modules/resource-management/views/resource-list.html",params:{type:null,user:null},ncyBreadcrumb:{label:"HEALTH_LIBRARY_LIST"}}).state("manageresource",{url:"/manageresource",params:{type:null,data:null},controller:"ManageResourceCtrl",templateUrl:"app/modules/resource-management/views/manage-resource.html",ncyBreadcrumb:{label:"MANAGE_HEALTH_LIBRARY",parent:"resourcelist",actionType:"add"}})}]),angular.module("paripal.manageReviews",[]).config(["$stateProvider",function(a){a.state("healthproreviewlist",{url:"/healthproreviewlist",controller:"HealthProReviewListCtrl",templateUrl:"app/modules/reviews/views/healthpro-review-list.html",params:{professional:null,type:null},ncyBreadcrumb:{label:"HEALTH_PROFESSIONAL_REVIEW_LIST"}}).state("managehealthproreview",{url:"/managehealthproreview/:reviewId/:type/:professionalId/:transactionId/:username",params:{fromState:"managehealthproreview",type:null,data:null,professional:null,professionalId:null,transactionId:null,username:null},controller:"ManageHealthProReviewCtrl",templateUrl:"app/modules/reviews/views/healthpro-manage-review.html",ncyBreadcrumb:{label:"MANAGE_HEALTH_PROFESSIONAL_REVIEW",actionType:"add"}}).state("supportproreviewlist",{url:"/supportproreviewlist",controller:"SupportProReviewListCtrl",templateUrl:"app/modules/reviews/views/supportpro-review-list.html",ncyBreadcrumb:{label:"SUPPORT_PROFESSIONAL_REVIEW_LIST"},params:{professional:null,type:null}}).state("managesupportproreview",{url:"/managesupportproreview/:reviewId/:type",params:{fromState:"managesupportproreview",type:null,data:null},controller:"ManageSupportProReviewCtrl",templateUrl:"app/modules/reviews/views/supportpro-manage-review.html",ncyBreadcrumb:{label:"MANAGE_SUPPORT_PROFESSIONAL_REVIEW",actionType:"add"}}).state("orglocreviewslist",{url:"/orglocreviewslist",controller:"OrgLocUserReviewsListCtrl",templateUrl:"app/modules/reviews/views/org-loc-user-reviews-list.html",ncyBreadcrumb:{label:"USER_REVIEWS_ON_ORGANIZATION_LIST"},params:{wallData:{}}}).state("manageorglocreviews",{url:"/manageorglocreviews",params:{type:null,data:null},controller:"ManageOrgLocUserReviewsCtrl",templateUrl:"app/modules/reviews/views/manage-org-loc-user-reviews.html",ncyBreadcrumb:{label:"MANAGE_USER_REVIEWS_ON_ORGANIZATION",parent:"orglocclientlist",actionType:"add"}})}]),$(document).ready(function(){var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide(),a.click(function(c){c.preventDefault();var d=$($(this).attr("href")),e=$(this);e.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),e.addClass("btn-primary"),b.hide(),d.show())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a"),d=a.find("input[type='text'],input[type='url']"),e=!0;$(".form-group").removeClass("has-error");for(var f=0;f<d.length;f++)d[f].validity.valid||(e=!1,$(d[f]).closest(".form-group").addClass("has-error"));e&&c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.searchHospitalModule",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("search-hospitals",{url:"/searchhospitals",params:{type:null,data:null,caller:null,callBackURL:null,emergencyType:null},controller:"SearchHospitalCtrl",templateUrl:"app/modules/search-hospital/views/search-hospital.html",ncyBreadcrumb:{label:"SEARCH_HOSPITALS"}})}]),angular.module("paripal.settingsModule",[]).config(["$stateProvider",function(a){a.state("settings",{url:"/settings",templateUrl:"app/modules/settings/views/settings-management.html",ncyBreadcrumb:{label:"SETTINGS_MANAGEMENT"},controller:"SettingsManagementCtrl"})}]),angular.module("paripal.skypeIntegrationModule",[]).config(["$stateProvider",function(a){a.state("agoraHome",{url:"/agora/:userId/:convId/:convType/:userName",templateUrl:"app/modules/skype-integration/views/agora.html",controller:"agoraCtrl",ncyBreadcrumb:{label:"Agora Home"},params:{org:null}}),a.state("directCallAgora",{url:"/directCallAgora/:userId/:convId/:convType/:userName/:orgLocId",templateUrl:"app/modules/skype-integration/views/directCallAgora.html",controller:"directCallAgoraCtrl",params:{org:null,orgLocId:null,data:null},ncyBreadcrumb:{label:"Agora Home"}}),a.state("doctorDirectCallQueueList",{url:"/doctorDirectCallQueueList",templateUrl:"app/modules/skype-integration/views/doctorDirectCallQueueList.html",controller:"doctorDirectCallQueueListCtrl",ncyBreadcrumb:{label:"Agora Home"},params:{org:null}}),a.state("redirectPatientToAgora",{url:"/redirectPatientToAgora",templateUrl:"app/modules/skype-integration/views/redirectPatientToAgora.html",controller:"redirectPatientToAgoraCtrl",params:{data:null}}),a.state("skypeHome",{url:"/skypeHome/:userId/:convId/:convType/:userName",templateUrl:"app/modules/skype-integration/views/skypeHome.html",controller:"skypeCtrl",ncyBreadcrumb:{label:"Skype Home"},params:{org:null}})}]),angular.module("paripal.manageStandardMaster",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("standardmasterlist",{url:"/standardmasterlist",params:{type:null,data:null,searchType:null},controller:"StandardMasterListCtrl",templateUrl:"app/modules/standard-master/views/standard-master-list.html",ncyBreadcrumb:{label:"STANDARD_MASTER"}}).state("managestandardmaster",{url:"/managestandardmaster",params:{type:null,data:null},controller:"ManageStandardMasterCtrl",templateUrl:"app/modules/standard-master/views/manage-standard-master.html",ncyBreadcrumb:{label:"MANAGE_STANDARD_MASTER",parent:"standardmasterlist",actionType:"add"}}).state("standardmasterlanguagetranslation",{url:"/standardmasterlanguagetranslation",params:{type:null,data:null},controller:"StandardMasterLanguageTranslationCtrl",templateUrl:"app/modules/standard-master/views/standard-master-language-translation.html",ncyBreadcrumb:{label:"STANDARD_MASTER_LANGUAGE_TRANSLATION",parent:"standardmasterlist",actionType:"add"}})}]),$(document).ready(function(){var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide(),a.click(function(c){c.preventDefault();var d=$($(this).attr("href")),e=$(this);e.hasClass("disabled")||(a.removeClass("btn-primary").addClass("btn-default"),e.addClass("btn-primary"),b.hide(),d.show(),d.find("input:eq(0)").focus())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a"),d=a.find("input[type='text'],input[type='url']"),e=!0;$(".form-group").removeClass("has-error");for(var f=0;f<d.length;f++)d[f].validity.valid||(e=!1,$(d[f]).closest(".form-group").addClass("has-error"));e&&c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.orgSupportServiceProfessionalServiceCategories",[]).config(["$stateProvider",function(a){a.state("orgsupportprofcategorieslist",{url:"/orgsupportprofcategorieslist",controller:"supportServiceProfessionalCategoriesCtrl",templateUrl:"app/modules/support-service-professional-service-categories/views/support-service-professional-service-categories-list.html",params:{type:null,professional:null},ncyBreadcrumb:{label:"SUPPORT_PROFESSIONAL_LIST"}})}]),angular.module("paripal.transactionModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("subscribertransaction",{url:"/subscribertransaction",controller:"SubscriberTransactionListCtrl",templateUrl:"app/modules/transaction/views/subscriber-transaction-list.html",ncyBreadcrumb:{label:"SUBSCRIBER_TRANSACTION_LIST"},params:{type:null,professional:null,wallData:null}}).state("viewtransaction",{url:"/viewtransaction/:id",controller:"ViewTransactionCtrl",templateUrl:"app/modules/transaction/views/view-transaction.html",ncyBreadcrumb:{label:"VIEW_TRANSACTIONS"},params:{type:null,data:null}})}]),angular.module("paripal.transactionBloodDonation",[]).config(["$stateProvider",function(a){a.state("blooddonations",{url:"/blooddonations",controller:"blooddonationsCtrl",templateUrl:"app/modules/transactions-blood-donation/views/search-blood-donation.html",ncyBreadcrumb:{label:"BLOOD_DONATION"},params:{org:null,orgLoc:null,user:null,fromState:null}}).state("manageblooddonation",{url:"/manageblooddonation/:id/:type",params:{fromState:"manageblooddonation",type:"add",data:null},controller:"manageblooddonationsCtrl",templateUrl:"app/modules/transactions-blood-donation/views/manage-blood-donation.html",ncyBreadcrumb:{label:"MANAGE_BLOOD_DONATION",parent:"blooddonations",actionType:"add"}}).state("bloodrequestanalysis",{url:"/bloodrequestanalysis",params:{fromState:"requestanalysis",type:"new",data:null},controller:"requestanalysisCtrl",templateUrl:"app/modules/transactions-blood-donation/views/request-analysis.html",ncyBreadcrumb:{label:"REQUEST_ANALYSIS",parent:"blooddonations",actionType:"add"}})}]),angular.module("paripal.transactionBloodRequests",[]).config(["$stateProvider",function(a){a.state("bloodreqlist",{url:"/bloodreqlist",controller:"bloodreqlistCtrl",templateUrl:"app/modules/transactions-blood-request/views/search-blood-request.html",ncyBreadcrumb:{label:"BLOOD_REQUIRED_REQUEST"},params:{org:null,fromState:null}}).state("managebloodreq",{url:"/managebloodreq/:id/:type",controller:"managebloodreqCtrl",templateUrl:"app/modules/transactions-blood-request/views/manage-blood-request.html",ncyBreadcrumb:{label:"MANAGE_BLOOD_REQUIRED_REQUEST",parent:"bloodreqlist",actionType:"add"},params:{fromState:"managebloodreq",type:"add",data:null}})}]),angular.module("paripal.diseaseTreatmentIssueModule",[]).config(["$stateProvider",function(a){a.state("searchTreatmentIssue",{url:"/searchTreatmentIssue/:treatmentTypeId/:treatmentType",controller:"searchTreatmentIssueCtrl",templateUrl:"app/modules/treament-issue/views/search-treatment-issues.html",ncyBreadcrumb:{label:"SEARCH_TREATMENT_ISSUE"}}).state("manageTreatmentIssue",{url:"/manageTreatmentIssue/:id/:type",params:{fromState:"manageTreatmentIssue",type:"add",data:null},controller:"manageTreatmentIssueCtrl",templateUrl:"app/modules/treament-issue/views/manage-treatment-issues.html",ncyBreadcrumb:{label:"MANAGE_TREATMENT_ISSUE",actionType:"add"}}).state("manageUserTreatmentIssue",{url:"/manageUserTreatmentIssue/:id/:type/:treatmentRecId",params:{fromState:"manageUserTreatmentIssue",type:"add",data:null},controller:"manageUserTreatmentIssueCtrl",templateUrl:"app/modules/treament-issue/views/manage-user-treatment-issues.html",ncyBreadcrumb:{label:"MANAGE_USER_TREATMENT_ISSUE",actionType:"add"}}).state("viewUserTreatmentIssue",{url:"/viewUserTreatmentIssue/:treatmentRecId",controller:"viewUserTreatmentIssueCtrl",templateUrl:"app/modules/treament-issue/views/view-user-treatment-issues.html",ncyBreadcrumb:{label:"SEARCH_USER_TREATMENT_ISSUE",parent:"viewUserTreatment"}})}]),angular.module("paripal.userTreatmentImageModule",[]).config(["$stateProvider",function(a){a.state("viewUserTreatmentImages",{url:"/viewUserTreatmentImages/:treatmentRecId",controller:"viewUserTreatmentImagesCtrl",templateUrl:"app/modules/treatment-images/views/view-user-treatment-images.html",ncyBreadcrumb:{label:"SEARCH_TREATMENT_IMAGES",parent:"viewUserTreatment"}}).state("manageUserTreatmentImages",{url:"/manageUserTreatmentImages/:id/:type/:treatmentRecId",params:{fromState:"manageUserTreatmentImages",type:"add",data:null},controller:"manageUserTreatmentImagesCtrl",templateUrl:"app/modules/treatment-images/views/manage-user-treatment-images.html",ncyBreadcrumb:{label:"MANAGE_TREATMENT_IMAGES",actionType:"add"}})}]),angular.module("paripal.treatmentRecordModule",[]).config(["$stateProvider",function(a){a.state("treatmentrecord",{url:"/treatmentrecord",templateUrl:"app/modules/treatment-record/views/treatment-record.html",ncyBreadcrumb:{label:"TREATMENT_RECORD"},controller:"TreatmentRecordCtrl"})}]),angular.module("paripal.familyHistoryModule",[]).config(["$stateProvider",function(a){a.state("searchUserFamilyHistory",{url:"/searchUserFamilyHistory/:userId/:userName",params:{orgLoc:null,fromState:null},controller:"searchUserFamilyHistoryCtrl",templateUrl:"app/modules/user-family-history/views/search-user-family-history.html",ncyBreadcrumb:{label:"SEARCH_USER_FAMILY_HISTORY"}}).state("manageUserFamilyHistory",{url:"/manageUserFamilyHistory/:id/:type",params:{fromState:"Manage User Family History",type:"add",data:null},controller:"manageUserFamilyHistoryCtrl",templateUrl:"app/modules/user-family-history/views/manage-user-family-history.html",ncyBreadcrumb:{label:"MNGE_USR_FAMILY_HISTORY",actionType:"add"}})}]),angular.module("paripal.userIncidentModule",[]).config(["$stateProvider",function(a){a.state("userincident",{url:"/userincident",controller:"viewUserIncidentCtrl",templateUrl:"app/modules/user-incident/views/view-user-incident.html",ncyBreadcrumb:{label:"USER_INCIDENT"},params:{user:null,orgLocId:null,fromState:null}}).state("manageuserincident",{url:"/manageuserincident/:id/:type",params:{fromState:"manageuserincident",type:"add",data:null},controller:"manageUserIncidentCtrl",templateUrl:"app/modules/user-incident/views/manage-user-incident.html",ncyBreadcrumb:{label:"MNGE_USR_INC",parent:"userIncidentModule",actionType:"add"}})}]),angular.module("paripal.userIssueModule",[]).config(["$stateProvider",function(a){a.state("searchUserIssue",{url:"/searchUserIssue",controller:"searchUserIssueCtrl",templateUrl:"app/modules/user-issue/views/search-user-issues.html",params:{user:null,orgLocId:null,fromState:null},ncyBreadcrumb:{label:"SEARCH_USER_ISSUES"}}).state("manageUserIssue",{url:"/manageUserIssue/:id/:type",params:{fromState:"Manage User Issue",type:"add",data:null},controller:"manageUserIssueCtrl",templateUrl:"app/modules/user-issue/views/manage-user-issues.html",ncyBreadcrumb:{label:"MNGE_USR_ISSUES"}}).state("manageLastFeedback",{url:"/manageLastFeedback/:id/:type",params:{fromState:"Manage Last Feedback",type:"add",data:null},ncyBreadcrumb:{label:"MNGE_LAST_FEEDBACK"},controller:"manageLastFeedbackCtrl",templateUrl:"app/modules/user-issue/views/manage-last-feedback-received.html"}).state("viewUserIssueRemarks",{url:"/viewUserIssueRemarks/:id/:type",controller:"viewUserIssueRemarksCtrl",templateUrl:"app/modules/user-issue/views/view-user-issue-remarks.html"}).state("searchPrescriptionList",{url:"/searchPrescriptionList/:appointmentId/:userId/:userName/:organizationLocationId/:organizationLocationName",controller:"searchPrescriptionListCtrl",templateUrl:"app/modules/user-issue/views/searchPrescriptionList.html",
// params: {
//     user:null,
//     orgLocId:null,
//     fromState:null
// },
ncyBreadcrumb:{label:"SEARCH_PRESCRIPTION_LIST"}})}]),angular.module("paripal.userMedicationModule",[]).config(["$stateProvider",function(a){a.state("usermedication",{url:"/usermedication",controller:"viewUserMedicationCtrl",templateUrl:"app/modules/user-medication/views/view-user-medication.html",ncyBreadcrumb:{label:"USER_MEDICATION"},params:{user:null,orgLocId:null,isCurrent:null,fromState:null}}).state("manageusermedication",{url:"/manageusermedication/:id/:type",controller:"manageUserMedicationCtrl",templateUrl:"app/modules/user-medication/views/manage-user-medication.html",params:{fromState:"manageusermedication",type:"add",data:null},ncyBreadcrumb:{label:"MANAGE_USER_MEDICATION",parent:"userMedicationModule",actionType:"add"}}).state("medicationmanagement",{url:"/medicationmanagement",controller:"MedicationManagementCtrl",templateUrl:"app/modules/user-medication/views/medication-management.html",ncyBreadcrumb:{label:"MEDICATION_MANAGEMENT"}})}]),angular.module("paripal.userOrganizationLinkModule",[]).config(["$stateProvider","$translateProvider","$urlRouterProvider",function(a,b,c){a.state("userorganizationlist",{url:"/userorganizationlist",params:{type:null,data:null},controller:"UserOrganizationListCtrl",templateUrl:"app/modules/user-organization-link/views/user-organization-list.html",ncyBreadcrumb:{label:"USER_ORGANIZATION_LIST"}}).state("manageuserorganization",{url:"/manageuserorganization",params:{type:null,data:null},controller:"ManageUserOrganizationCtrl",templateUrl:"app/modules/user-organization-link/views/manage-user-organization.html",ncyBreadcrumb:{label:"MANAGE_USER_ORGANIZATION",parent:"userorganizationlist",actionType:"add"}})}]),angular.module("paripal.userStackholderModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("userstackholderlist",{url:"/userstackholderlist",controller:"UserStackholderListCtrl",templateUrl:"app/modules/user-stackholder/views/user-stackholder-list.html",ncyBreadcrumb:{label:"USER_STACKHOLDER_LIST"}}).state("userstackholderrequestlist",{url:"/userstackholderrequestlist",controller:"UserStackholderRequestListCtrl",templateUrl:"app/modules/user-stackholder/views/user-stackholder-request-list.html",ncyBreadcrumb:{label:"USER_STACKHOLDER_REQUEST_LIST"}})}]),angular.module("paripal.userSymptomModule",[]).config(["$stateProvider",function(a){a.state("viewUserSymptoms",{url:"/viewUserSymptoms/:userId/:userName/:diseaseVariantId/:diseaseVariantName/:diseaseId/:diseaseName/:locationId/:locationName",controller:"viewUserSymptomsCtrl",templateUrl:"app/modules/user-symptom/view/view-user-symptoms.html",ncyBreadcrumb:{label:"USER_SYMPTOMS"},params:{orgLocId:null,fromState:null}}).state("manageUserSymptoms",{url:"/manageUserSymptoms/:id/:type/:symptomId",params:{fromState:"manageUserSymptoms",type:"add",data:null},ncyBreadcrumb:{label:"MNG_USR_SYM",parent:"viewUserSymptoms",actionType:"add"},controller:"manageUserSymptomsCtrl",templateUrl:"app/modules/user-symptom/view/manage-user-symptoms.html"}).state("viewUserSymptomDetail",{url:"/viewUserSymptomDetail/:userSymptomId/:id/:type/:userName/:diseaseName/:diseaseVariantName/:symptomName/:userId/:diseaseVariantId/:diseaseId",params:{fromState:"viewUserSymptomDetail",type:"detail",data:null},controller:"viewUserSymptomDetailCtrl",templateUrl:"app/modules/user-symptom/view/view-user-symptom-detail.html",ncyBreadcrumb:{label:"VIEW_USR_SYMPTOM_DETAIL",parent:"viewUserSymptoms"}}).state("manageUserSymptomDetail",{url:"/manageUserSymptomDetail/:parentId/:id/:type",params:{fromState:"manageUserSymptomDetail",type:"add",data:null},ncyBreadcrumb:{label:"MNG_USR_SYM_DETAIL",parent:"viewUserSymptomDetail",actionType:"add"},controller:"manageUserSymptomDetailCtrl",templateUrl:"app/modules/user-symptom/view/manage-user-symptom-detail.html"})}]),angular.module("paripal.userTestModule",[]).config(["$stateProvider","$translateProvider",function(a,b){a.state("usertestlist",{url:"/usertestlist/:userName/:userId",params:{orgLocId:null,user:null,fromClientsPage:null,whetherLocationSubscribed:null,fromState:null,orderId:null},controller:"UserTestListCtrl",templateUrl:"app/modules/user-tests/views/user-tests-list.html",ncyBreadcrumb:{label:"USER_TEST_LIST"}}).state("addEditUserTests",{url:"/addEditUserTests/:userTestId/:type",params:{fromState:"addEditUserTests",type:null,data:null,previousState:null},controller:"addEditUserTestCtrl",templateUrl:"app/modules/user-tests/views/addEdit-user-tests.html",ncyBreadcrumb:{label:"MANAGE_USER_TEST",parent:"usertestlist"}}).state("addUserTests",{url:"/addUserTests",params:{fromState:"addUserTests",type:null,data:null,previousState:null,user:null,fromClientsPage:null},controller:"addEditUserTestCtrl",templateUrl:"app/modules/user-tests/views/addEdit-user-tests.html",ncyBreadcrumb:{label:"ADD_USER_TESTS",parent:"usertestlist",actionType:"add"}}).state("sharedusertest",{url:"/sharedusertest",controller:"SharedUserTestListCtrl",templateUrl:"app/modules/user-tests/views/share-user-test.html",ncyBreadcrumb:{label:"SHARED_USER_TEST",parent:"usertestlist"},params:{type:null,data:null}}).state("shareusertest",{url:"/shareusertest",controller:"AddShareUserTestCtrl",templateUrl:"app/modules/user-tests/views/add-shared-user-test.html",ncyBreadcrumb:{label:"SHARE_USER_TEST",parent:"sharedusertest",actionType:"add"},params:{type:null,data:null}}).state("testorder",{url:"/testorder",controller:"TestOrderCtrl",templateUrl:"app/modules/user-tests/views/test-order.html",ncyBreadcrumb:{label:"TEST_ORDER"},params:{type:null,data:null,pageState:null,isPrescription:null,appointmentId:null,patientDetails:null,fromState:null}}).state("testorderlist",{url:"/testorderlist",controller:"TestOrderListCtrl",templateUrl:"app/modules/user-tests/views/test-order-list.html",ncyBreadcrumb:{label:"TEST_ORDER_LIST"},params:{type:null,data:null}})}]),angular.module("paripal.treatmentQueriesModule",[]).config(["$stateProvider",function(a){a.state("viewUserTreatmentQueries",{url:"/viewUserTreatmentQueries/:treatmentRecId",controller:"viewUserTreatmentQueriesCtrl",templateUrl:"app/modules/user-treatment-queries/views/view-user-treatment-queries.html",ncyBreadcrumb:{label:"VIEW_USER_TREATMENT_QUERIES",parent:"viewUserTreatment"}}).state("manageUserTreatmentQueries",{url:"/manageUserTreatmentQueries/:id/:type",params:{fromState:"Manage User Treatment Queries",type:"add",data:null},controller:"manageUserTreatmentQueriesCtrl",templateUrl:"app/modules/user-treatment-queries/views/manage-user-treatment-queries.html",ncyBreadcrumb:{label:"MANAGE_USER_TREATMENT_QUERIES",actionType:"add"}})}]),angular.module("paripal.userVaccinationsModule",[]).config(["$stateProvider",function(a){a.state("uservaccinations",{url:"/uservaccinations",controller:"uservaccinationCtrl",templateUrl:"app/modules/user-vaccinations/views/view-user-vaccinations.html",ncyBreadcrumb:{label:"USER_VACCINATIONS"},params:{user:null,org:null,orgLocId:null,fromState:null}}).state("manageuservaccinations",{url:"/manageuservaccinations/:id/:type",controller:"manageUserVaccinationCtrl",templateUrl:"app/modules/user-vaccinations/views/manage-user-vaccinations.html",params:{fromState:"manageuservaccinations",type:"add",data:null},ncyBreadcrumb:{label:"MANAGE_USER_VACCINATIONS",parent:"uservaccinations",actionType:"add"}}).state("vaccinationsstatistics",{url:"/vaccinationsstatistics",controller:"vaccinationStatisticsCtrl",templateUrl:"app/modules/user-vaccinations/views/vaccinations-Statistics.html",params:{fromState:"vaccinationsstatistics",type:"new",data:null},ncyBreadcrumb:{label:"VACCINATIONS_STATISTICS",parent:"uservaccinations"}})}]),angular.module("paripal.users_list",[]).config(["$stateProvider",function(a){a.state("users_list",{url:"/usersList",params:{type:"list"},controller:"UsersListCtrl",templateUrl:"app/modules/users-list/views/users-list.html",ncyBreadcrumb:{label:"List of users"}})}]),/**
 * Creating utility module
 * 
 */
angular.module("utilityModule",[]),angular.module("utilityModule").config(function(){}),angular.module("paripal.advanceSharing").controller("AdvanceSharingCtrl",["$scope","$rootScope","$stateParams","$state","advanceSharingService","httpService","urlService","baseService","utilService","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k){a.WSAdvanceSharing={},a.minDateValidFrom=new Date,a.infoClick=function(a,b,c){b.isInfo=!b.isInfo,a.stopPropagation()},i.isEmpty(h.getLoggedInUser())||(a.loggedInUser=h.getLoggedInUser().displayName,a.loggedInUserId=h.getLoggedInUser().id),a.getUsers=function(b){var c={};return c.userName=b,f.getData(g.getParameterizedUrl("GET_ORG_USERS_FOR_SHARING",c),null,function(b){return a.referredDataValues=angular.fromJson(b.data),a.referredDataValues},function(a){})},a.onUserSelect=function(b){a.WSAdvanceSharing.sharedWithId=b.id},a.init=function(){var b={};b.type=c.type,b.id=c.id,b.orgLocId=c.orgLocId,a.advanceSharingList=[],e.getAdvanceSharingList(b,function(b){b.length>1?angular.forEach(b,function(b,c){a.advanceSharingList.push(b)}):b[0]?a.advanceSharingList.push(b[0]):a.advanceSharingList.push(b)},function(a){console.log(a)})},a.init(),a.diseaseVarientChecked=function(b,c){a.diseaseVarientList=b,a.diseaseVarientLoop(a.advanceSharingList,c,!0,!1,!1,!1,!1,!1)},a.diseaseVarientLoop=function(b,c,d,e,f,g,h,i){angular.forEach(b,function(b,j){JSON.stringify(a.diseaseVarientList)===JSON.stringify(b)&&(a.diseaseVarientData=b,d&&i&&(b.isFolder=!b.isFolder),a.treatmentTypeLoop(b,c,d,e,f,g,h,i))})},a.treatmentTypeLoop=function(b,c,d,e,f,g,h,i){angular.forEach(b.children,function(b,j){a.treatmentTypeData=b,d&&!i&&(b.isSelected=!c,a.treatmentRecordLoop(b,c,d,e,f,g,h,i)),i&&(d&&(b.isCollapsible=!b.isCollapsible,b.isFolder=!b.isFolder,a.treatmentRecordLoop(b,c,d,e,f,g,h,i)),(f||g)&&a.treatmentRecordLoop(b,c,d,e,f,g,h,i)),(f||g||h)&&!i&&a.treatmentRecordLoop(b,c,d,e,f,g,h,i),JSON.stringify(a.treatmentTypeList)===JSON.stringify(b)&&e&&(a.treatmentRecordLoop(b,c,d,e,f,g,h,i),i?b.isFolder=!b.isFolder:a.diseaseVarientData.isSelected||c||(a.diseaseVarientData.isSelected=!0))})},a.treatmentRecordLoop=function(b,c,d,e,f,g,h,i){angular.forEach(b.children,function(b,j){a.treatmentRecordData=b,!d&&!e||i||(b.isSelected=!c,a.appointmentLoop(b,c,d,e,f,g,h,i)),i&&((d||e)&&(b.isCollapsible=!b.isCollapsible,b.isFolder=!b.isFolder,a.appointmentLoop(b,c,d,e,f,g,h,i)),g&&a.appointmentLoop(b,c,d,e,f,g,h,i)),!g&&!h||i||a.appointmentLoop(b,c,d,e,f,g,h,i),JSON.stringify(a.treatmentRecordList)===JSON.stringify(b)&&f&&(a.appointmentLoop(b,c,d,e,f,g,h,i),i?b.isFolder=!b.isFolder:(a.diseaseVarientData.isSelected||c||(a.diseaseVarientData.isSelected=!0),a.treatmentTypeData.isSelected||c||(a.treatmentTypeData.isSelected=!0)))})},a.appointmentLoop=function(b,c,d,e,f,g,h,i){angular.forEach(b.children,function(b,j){a.appointmentData=b,(d||e||f)&&!i&&(b.isSelected=!c,a.appointmentDetailsLoop(b,c,d,e,f,g,h,i)),i&&(d||e||f)&&(b.isCollapsible=!b.isCollapsible,b.isFolder=!b.isFolder,a.appointmentDetailsLoop(b,c,d,e,f,g,h,i)),h&&!i&&a.appointmentDetailsLoop(b,c,d,e,f,g,h,i),JSON.stringify(a.appointmentList)===JSON.stringify(b)&&g&&(a.appointmentDetailsLoop(b,c,d,e,f,g,h,i),i?b.isFolder=!b.isFolder:(a.diseaseVarientData.isSelected||c||(a.diseaseVarientData.isSelected=!0),a.treatmentTypeData.isSelected||c||(a.treatmentTypeData.isSelected=!0),a.treatmentRecordData.isSelected||c||(a.treatmentRecordData.isSelected=!0)))})},a.appointmentDetailsLoop=function(b,c,d,e,f,g,h,i){angular.forEach(b.children,function(b,j){a.appointmentDetailsData=b,(d||e||f||g)&&!i&&(b.isSelected=!c),i&&(d||e||f||g)&&(b.isCollapsible=!b.isCollapsible,b.isFolder=!b.isFolder),JSON.stringify(a.appointmentDetail)===JSON.stringify(b)&&h&&!i&&(a.diseaseVarientData.isSelected||c||(a.diseaseVarientData.isSelected=!0),a.treatmentTypeData.isSelected||c||(a.treatmentTypeData.isSelected=!0),a.treatmentRecordData.isSelected||c||(a.treatmentRecordData.isSelected=!0),a.appointmentData.isSelected||c||(a.appointmentData.isSelected=!0))})},a.treatmentTypeChecked=function(b,c){a.treatmentTypeList=b,a.diseaseVarientLoop(a.advanceSharingList,c,!1,!0,!1,!1,!1,!1)},a.treatmentRecordChecked=function(b,c){a.treatmentRecordList=b,a.diseaseVarientLoop(a.advanceSharingList,c,!1,!1,!0,!1,!1,!1)},a.appointmentChecked=function(b,c){a.appointmentList=b,a.diseaseVarientLoop(a.advanceSharingList,c,!1,!1,!1,!0,!1,!1)},a.appointmentDetailChecked=function(b,c){a.appointmentDetail=b,a.diseaseVarientLoop(a.advanceSharingList,c,!1,!1,!1,!1,!0,!1)},a.diseaseVarientPanel=function(b){a.diseaseVarientList=b,a.diseaseVarientLoop(a.advanceSharingList,!0,!0,!1,!1,!1,!1,!0)},a.treatmentTypePanel=function(b){a.treatmentTypeList=b,a.diseaseVarientLoop(a.advanceSharingList,!0,!1,!0,!1,!1,!1,!0)},a.treatmentRecordPanel=function(b){a.treatmentRecordList=b,a.diseaseVarientLoop(a.advanceSharingList,!0,!1,!1,!0,!1,!1,!0)},a.appointmentPanel=function(b){a.appointmentList=b,a.diseaseVarientLoop(a.advanceSharingList,!0,!1,!1,!1,!0,!1,!0)},a.expandAll=function(){e.expandCollapseAll(a.advanceSharingList,!0,!0)},a.collapseAll=function(){e.expandCollapseAll(a.advanceSharingList,!1,!0)},a.selectAll=function(){a.advanceSharingList[0].isSelected=!0,
//$scope.diseaseVarientChecked(null,false);
e.expandCollapseAll(a.advanceSharingList,!0,!1)},a.saveSharedDetails=function(){var b=!0;"diseasevarient"==c.type?(a.WSAdvanceSharing.sharedEntity="USER_ISSUE",a.WSAdvanceSharing.sharedEntityName=a.advanceSharingList[0].entityName):"treatment"==c.type?(b=!1,a.WSAdvanceSharing.sharedEntity="TREATMENT",a.WSAdvanceSharing.sharedEntityName=a.advanceSharingList[0].children[0].children[0].entityName):"mydocvpr"!=c.type&&"vpr"!=c.type||(a.WSAdvanceSharing.sharedEntity="DPR",a.WSAdvanceSharing.sharedEntityName="DPR"),e.createWSChildren(a.advanceSharingList,b,function(b){a.wsChildren=b}),a.wsChildren.length>0?(a.WSAdvanceSharing.sharedById=a.loggedInUserId,a.WSAdvanceSharing.wsChildren=a.wsChildren,a.WSAdvanceSharing.entityInstanceId=c.id,e.saveSharedDetails(a.WSAdvanceSharing,function(a){j("success",k.instant("ADDED_SUCCESS")),i.goBackToPrevState()},function(a){console.log(a)})):j("Error",k.instant("SELECT_SHARING"))},a.cancel=function(){i.goBackToPrevState()}}]),angular.module("paripal.advanceSharing").service("advanceSharingService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.getAdvanceSharingList=function(c,d,e){var f={};f.userIssueId=c.id,f.orgLocId=c.orgLocId;var g;"diseasevarient"==c.type?g=b.getParameterizedUrl("GET_DISEASE_VARIENT_SHARING_LIST",f):"treatment"==c.type?g=b.getParameterizedUrl("GET_TREATMENT_RECORD_SHARING_LIST",f):"mydocvpr"==c.type?g=b.getParameterizedUrl("GET_MY_DOC_VPR_SHARING_LIST",f):"vpr"==c.type&&(g=b.getParameterizedUrl("GET_VPR_SHARING_LIST",f)),a.getData(g,null,function(a){a&&a.data?d(a.data):errorCallBack(a)},function(a){errorCallBack(a)})},this.createWSChildren=function(a,b,c){var d=[];angular.forEach(a,function(a,c){a.isSelected&&b&&d.push({entityId:a.entityId,entityType:a.entityType}),angular.forEach(a.children,function(a,c){a.isSelected&&b&&d.push({entityId:a.entityId,entityType:a.entityType,parentId:a.parentId}),angular.forEach(a.children,function(a,c){a.isSelected&&b?d.push({entityId:a.entityId,entityType:a.entityType,parentId:a.parentId}):a.isSelected&&d.push({entityId:a.entityId,entityType:a.entityType}),angular.forEach(a.children,function(a,b){a.isSelected&&d.push({entityId:a.entityId,entityType:a.entityType,parentId:a.parentId}),angular.forEach(a.children,function(a,b){a.isSelected&&d.push({entityId:a.entityId,entityType:a.entityType,parentId:a.parentId})})})})})}),c(d)},this.expandCollapseAll=function(a,b,c){angular.forEach(a,function(a,d){c?a.isFolder=b:a.isSelected=!0,angular.forEach(a.children,function(a,d){c?(a.isCollapsible=b,a.isFolder=b):a.isSelected=!0,angular.forEach(a.children,function(a,d){c?(a.isCollapsible=b,a.isFolder=b):a.isSelected=!0,angular.forEach(a.children,function(a,d){c?(a.isCollapsible=b,a.isFolder=b):a.isSelected=!0,angular.forEach(a.children,function(a,d){c?(a.isCollapsible=b,a.isFolder=b):a.isSelected=!0})})})})})},this.saveSharedDetails=function(d,e,f){var g={};g.shareType="ADVANCED",g.sharedBy={},g.sharedWith={},g.sharedBy.id=d.sharedById,g.sharedWith.id=d.sharedWithId,g.sharedByComments=d.sharedByComments,g.sharedEntity=d.sharedEntity,g.sharedEntityName=d.sharedEntityName,g.entityInstanceId=d.entityInstanceId,d.shareValidTill&&(g.shareValidTill=c.convertToServerDate(d.shareValidTill)),g.wsChildren=d.wsChildren,a.postData(b.getUrl("SAVE_ADVANCE_SHARING"),g,function(a){a&&a.data&&e(a.data)},function(a){f(a)})}}]),angular.module("paripal.appointmentModule").controller("AddCommentsDetailsPopupCtrl",["$scope","$rootScope","$mdDialog","$filter","baseService","orbeonFormRunner","httpService","urlService","utilService","notify","$translate","manageUserTreatmentService","appointmentData","treatmentData","medicationData","diseaseVariantData","diagnosticTestData","fromState","pageState",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.searchCriteria={},a.fromState=r,a.appointmentData=m,a.treatmentData=n,a.medicationData=o,a.diseaseVariantData=p,a.diagnosticTestData=q,a.pageState=s,a.popupHeader="Notes",a.medClinicalNote=[],a.clinical={},"treatment"==a.fromState&&(a.popupHeader="Treatment"),a.getCommentsDetails=function(b){a.searchWord={},
// if(typeof (viewValue) == 'undefined'){
//     $scope.searchWord.searchKeyword = null;
// }else{
//   $scope.searchWord.searchKeyword = viewValue;  
// }
"diagnostic test"==r&&a.diagnosticTestData?a.searchWord.testId=a.diagnosticTestData.diagnosticTestId:a.searchWord.testId=0,"disease variant"==r&&a.diseaseVariantData?a.searchWord.diseaseVariantId=a.diseaseVariantData.diseaseVariant.id:a.searchWord.diseaseVariantId=0,"medication"==r&&a.medicationData?(a.searchWord.medicationId=a.medicationData.medication.id,a.searchWord.clinicalTypeId=a.clinical.clinicalType.id):a.searchWord.medicationId=0,a.clinicalNoteType&&a.clinicalNoteType.id&&(a.searchWord.clinicalTypeId=a.clinicalNoteType.id);var c=e.getDefaultOrgLocation();
//$scope.searchKeyWord.diseaseId = $scope.treatment.disease.id;
return a.searchWord.locationId=c.orgLoc.id,g.getData(h.getParameterizedUrl("SEARCH_COMMENTS_BY_KEYWORD",a.searchWord),null,function(b){return a.commentsDetails=[],a.commentsDetails=angular.fromJson(b.data)},function(a){i.isEmpty(a.data)||i.isEmpty(a.data.messages[0])?j("error",k.instant("RECORD_SEARCH_FAILURE")):j("Alert",k.instant(a.data.messages[0]))})},a.getCliniclList=function(){var b={};a.treatmentData&&(b.treatmentRecordId={id:a.treatmentData.id}),a.appointmentData&&(b.appointment={id:a.appointmentData.id}),a.medicationData&&(b.medication={id:a.medicationData.id}),a.diseaseVariantData&&(b.diseaseVariant={id:a.diseaseVariantData.diseaseVariant.id}),a.diagnosticTestData&&(b.diagnosticTest={id:a.diagnosticTestData.id});var c=h.getUrl("COMMENTS_CLINICAL_NOTE_BY_REC_ID",b);if(c)return g.postData(c,b,function(b){if(b&&b.data)return a.clinicalcommentsNotes=b.data,a.clinicalcommentsNotes},function(a){})},a.getCliniclList(),a.deleteNote=function(b,d){var e=c.confirm().title(k.instant("DELETE")).textContent(k.instant("REMOVE_RECORD")).ok(k.instant("YES")).cancel(k.instant("NO"));c.show(e).then(function(){a["delete"](b,d)},function(){var b={};"medication"==a.fromState?b={appointmentData:a.appointmentData,treatmentData:null,medicationData:a.medicationData,diseaseVariantData:null,diagnosticTestData:null,fromState:a.fromState}:"diagnostic test"==a.fromState?b={appointmentData:a.appointmentData,treatmentData:null,medicationData:null,diseaseVariantData:null,diagnosticTestData:a.diagnosticTestData,fromState:a.fromState}:"disease variant"==a.fromState&&(b={appointmentData:a.appointmentData,treatmentData:null,medicationData:null,diseaseVariantData:a.diseaseVariantData,diagnosticTestData:null,fromState:a.fromState}),
// else {
//     localObj = {
//         appointmentData: data,
//         treatmentData: null,
//         medicationData: null,
//         diseaseVariantData: null,
//         diagnosticTestData: null,
//         fromState: $scope.fromState
//     };
// }
c.show({controller:"AddCommentsDetailsPopupCtrl",templateUrl:"app/modules/appointment/views/addComments-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:b}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})})},a["delete"]=function(b,d){b?l.deleteTreatmentClinical(b,function(b){if(!i.isNullOrEmpty(b.successMessage)){a.getCliniclList(),j("success",k.instant(b.successMessage)),console.log(a.appointmentData);var d={};"medication"==a.fromState?d={appointmentData:a.appointmentData,treatmentData:null,medicationData:a.medicationData,diseaseVariantData:null,diagnosticTestData:null,fromState:a.fromState}:"diagnostic test"==a.fromState?d={appointmentData:a.appointmentData,treatmentData:null,medicationData:null,diseaseVariantData:null,diagnosticTestData:a.diagnosticTestData,fromState:a.fromState}:"disease variant"==a.fromState&&(d={appointmentData:a.appointmentData,treatmentData:null,medicationData:null,diseaseVariantData:a.diseaseVariantData,diagnosticTestData:null,fromState:a.fromState}),
// else {
//     localObj = {
//         appointmentData: data,
//         treatmentData: null,
//         medicationData: null,
//         diseaseVariantData: null,
//         diagnosticTestData: null,
//         fromState: $scope.fromState
//     };
// }
c.show({controller:"AddCommentsDetailsPopupCtrl",templateUrl:"app/modules/appointment/views/addComments-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:d}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})}},function(a){i.isNullOrEmpty(a.data.message[0])||j("alert",k.instant(a.data.message[0]))}):txt||b||a.clinicalcommentsNotes.splice(d)},a.updateReusable=function(a,c){a.reusable=c,l.updateTreatmentClinical(a,function(a){a&&!i.isNullOrEmpty(a.successMessage)&&(j("success",k.instant(a.successMessage)),b.showSpinner=!1)},function(a){i.isNullOrEmpty(a.data.message[0])||j("alert",k.instant(a.data.message[0]))})},a.updateGlobaluse=function(a,c){a.globaluse=c,l.updateTreatmentClinical(a,function(a){a&&!i.isNullOrEmpty(a.successMessage)&&(j("success",k.instant(a.successMessage)),b.showSpinner=!1)},function(a){i.isNullOrEmpty(a.data.message[0])||j("alert",k.instant(a.data.message[0]))})},a.saveClinicalNote=function(c){b.showSpinner=!0;var d=angular.copy(c);d.clinicalNote&&d.clinicalNote.value&&(d.clinicalNote=d.clinicalNote.value),"treatment"==a.fromState?a.treatmentData&&(d.treatmentRecord={},d.treatmentRecord.id=a.treatmentData.id,d.clinicalNoteType={},d.clinicalNoteType.id=a.clinicalNoteType.id,d.clinicalNoteType.value=a.clinicalNoteType.value,a.appointmentData&&a.appointmentData.id&&(d.appointment={id:a.appointmentData.id})):"appointment"==a.fromState?a.appointmentData&&(d.appointment={id:a.appointmentData.id},d.clinicalNoteType={},d.clinicalNoteType.id=a.clinicalNoteType.id,d.clinicalNoteType.value=a.clinicalNoteType.value):"medication"==a.fromState?a.medicationData&&(d.medication={id:a.medicationData.id},d.clinicalNoteType={},d.clinicalNoteType.id=d.clinicalType.id,d.clinicalNoteType.value=d.clinicalType.value,delete d.clinicalType,a.appointmentData&&a.appointmentData.id&&(d.appointment={id:a.appointmentData.id})):"disease variant"==a.fromState?a.diseaseVariantData&&(d.diseaseVariant={id:a.diseaseVariantData.diseaseVariant.id},d.clinicalNoteType={},d.clinicalNoteType.id=a.clinicalNoteType.id,d.clinicalNoteType.value=a.clinicalNoteType.value,a.appointmentData&&a.appointmentData.id&&(d.appointment={id:a.appointmentData.id})):"diagnostic test"==a.fromState&&a.diagnosticTestData&&(d.diagnosticTest={id:a.diagnosticTestData.id},d.clinicalNoteType={},d.clinicalNoteType.id=a.clinicalNoteType.id,d.clinicalNoteType.value=a.clinicalNoteType.value,a.appointmentData&&a.appointmentData.id&&(d.appointment={id:a.appointmentData.id})),d.reusable=!1,d.globaluse=!1,l.saveTreatmentClinical(d,function(c){c&&!i.isNullOrEmpty(c.successMessage)&&(j("success",k.instant(c.successMessage)),a.getCliniclList(),a.clinical={},b.showSpinner=!1)},function(a){i.isNullOrEmpty(a.data.message[0])||j("alert",k.instant(a.data.message[0]))})},a.getClinicalNotesType=function(){a.clinicalNoteLoad=!0,g.getData(h.getUrl("GET_CLINICAL_NOTE_TYPE_LIST"),null,function(b){a.clinicalNoteLoad=!1,a.clinicalNotesTypes=angular.fromJson(b.data),a.clinicalNotesTypes.forEach(function(b){"Medication Instruction"!=b.value&&"Medication Direction"!=b.value&&"Medication Note"!=b.value||"medication"!=r||(a.medClinicalNote.push(b),a.reqTooltip1="Add to Reusable List for this Medication",a.reqTooltip2="Add to Reusable List across all Medications"),"Impression"==b.value&&"appointment"==r?(a.clinicalNoteType=b,a.popupHeader=a.clinicalNoteType.value+"-"+a.appointmentData.apptId,a.reqTooltip1="Add to Reusable List for this Appointment",a.reqTooltip2="Add to Reusable List across all Appointments"):"Investigations"==b.value&&"medication"==r||("Lab Instruction"==b.value&&"diagnostic test"==r?(a.clinicalNoteType=b,a.popupHeader=a.clinicalNoteType.value+"-"+a.diagnosticTestData.diagnosticTestName,a.reqTooltip1="Add to Reusable List for this Diagnostic test",a.reqTooltip2="Add to Reusable List across all Diagnostic tests"):"Diagnosis"==b.value&&"disease variant"==r&&(a.clinicalNoteType=b,a.popupHeader=a.clinicalNoteType.value+"-"+a.diseaseVariantData.diseaseVariant.value,a.reqTooltip1="Add to Reusable List for this Problem",a.reqTooltip2="Add to Reusable List across all Problems"))})},function(b){a.clinicalNoteLoad=!1,i.isEmpty(b.data)||i.isEmpty(b.data.messages[0])?j("error",k.instant("RECORD_SEARCH_FAILURE")):j("Alert",k.instant(b.data.messages[0]))})},a.getClinicalNotesType(),a.cancel=function(){c.cancel()}}]),angular.module("paripal.appointmentModule").controller("AddUserMeasurementPopupCtrl",["$scope","$rootScope","$state","$stateParams","httpService","urlService","utilService","notify","dateconvertor","datatableconfig","commonConstants","userStatusService","$filter","userDetails","diagnosticTestObj","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.userMeasurementObject={},a.commonConstants=k,/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=k.defaultPageNo,a.itemPerPage=k.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.today=new Date,a.userMeasurementObject.measurementDate=i.convertToViewDate(a.today),a.init=function(){a.pageState="add",l.isUserLoggedIn()&&(a.userMeasurementObject.user=l.userStatus().userData),a.userMeasurementObject.user=n,a.isUserDisable=!l.isOrgUser(),g.isFieldEmpty(o)||(a.userMeasurementObject.diagnosticTestUser=o,a.loadMeasurementList("",a.userMeasurementObject.diagnosticTestUser.id))},/**
         * Get users list
         * @param   {string} viewValue Name of the user being searched.
         * @returns {Array} [[Description]]
         */
a.getUsersList=function(b){a.userNameAutoCmp=!0;var c={};return c.searchString=b,e.getData(f.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,a.userList=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.getUserTestList=function(b,c){var d={};return d.userId=b.id,d.userTestTrName=c,a.userTestNameAutoCmp=!0,e.getData(f.getParameterizedUrl("FIND_USERTESTBYUSERID",d),null,function(b){return a.userTestNameAutoCmp=!1,a.diagnosticTestUserList=angular.fromJson(b.data)},function(b){a.userTestNameAutoCmp=!1})},a.getIndicator=function(b){a.indicatorAutoCmp=!0;var c=f.getUrl("GET_INDICATOR");return c=c+b+"&whetherActive=true",e.getData(c,null,function(b){return a.indicatorAutoCmp=!1,a.indicatorList=angular.fromJson(b.data),a.indicatorList},function(b){a.indicatorAutoCmp=!1})},a.loadMeasurementList=function(b,c){a.userMeasurementObject.userTestCode=b,a.userMeasurementObject.measurementList=[];var d={};d.userTestCode=b,d.userTestId=c,e.getData(f.getParameterizedUrl("GET_INDICATORBYUSERTESTIDANDCODE",d),null,function(b){var c=b.data;g.isNullOrEmpty(c.measurementDate)||(c.measurementDate=i.convertToViewDate(c.measurementDate)),g.isEmpty(c.diagnosticTestUser)||(c.userTestCode=c.diagnosticTestUser.code),a.measurementListLength=c.wsUserMeasurements.length,angular.copy(c,a.userMeasurementObject)},function(a){})},/*Function to search symptoms*/
a.viewMeasurementSymptoms=function(a){a.ifUserMeasurement=!0,c.go("measurementsymptoms",{data:a,callBackURL:c.current.name})},/*Check type of value*/
a.checkNumber=function(a){var b=parseInt(a);if(angular.isNumber(b)&&NaN!=b)return b},a.cancel=function(){p.cancel()},a.createUserMeasurement=function(b,d){if(d&&0==b.wsUserMeasurements.length)return void h("warning",m("translate")("PLEASE_FILL_ALL_THE_FIELD"));var j={};a.isRequestSent=!0,g.isNullOrEmpty(b)||g.isNullOrEmpty(b.wsUserMeasurements)||angular.forEach(b.wsUserMeasurements,function(a,c){g.isNullOrEmpty(a.measurementIndicatorName.id)||(b.wsUserMeasurements[c].measurementIndicatorId=a.measurementIndicatorName.id,b.wsUserMeasurements[c].measurementIndicatorName=a.measurementIndicatorName.value)}),angular.copy(b,j),g.isNullOrEmpty(j.measurementDate)||(j.measurementDate=i.convertToServerDate(j.measurementDate)),delete j.userTestCode,e.postData(f.getUrl("CREATE_USERMEASUREMENT"),j,function(b){a.isRequestSent=!1,h("success",b.data.successMessage),p.cancel(),c.reload()},function(b){a.isRequestSent=!1})},a.clearUserTestFields=function(){a.userMeasurementObject.wsUserMeasurements=[],a.userMeasurementObject.userTestCode=null,a.userMeasurementObject.diagnosticTestUser=null,a.userMeasurementObject.measurementDate=i.convertToViewDate(a.today),a.measurementListLength=0},a.back=function(){g.goBackToPrevState()};/**
         *datatble config json
         */
var q=k.gridConfigurations;q.setDeafultColSortingOrder="asc",a.options=j.setOptionProperties(q),a.addRow=function(){a.userMeasurementObject.wsUserMeasurements.push({chartingValue:null,id:null,measurementDate:null,measurementIndicatorId:null,measurementIndicatorName:null,organizationLocationId:null,unitOfMeasurement:null,value:null,version:null})},a.removeRow=function(b){a.userMeasurementObject.wsUserMeasurements.splice(b,1),a.addUserMeasurementForm.value.$valid=!0},a.init()}]),angular.module("paripal.appointmentModule").controller("AllergyListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(a,b,c,d,e,g,i,j,m,n){if(b.addAllergyObj={},b.maxDate=new Date,d.isUserLoggedIn()){var o=d.userStatus();b.isOrgUser=o.isOrgUser,b.isOrgUser?b.addAllergyObj.patientUser=j:b.addAllergyObj.patientUser={id:angular.fromJson(g.getLoggedInUser()).id,value:angular.fromJson(g.getLoggedInUser()).displayName}}var p=g.getDefaultOrgLocation();e.isFieldEmpty(p)||(b.addAllergyObj.location=p.orgLoc),e.isNullOrEmpty(n)||(b.addAllergyObj=angular.copy(n)),b.pageState=m,b.cancel=function(){a.hide()},b.findUserByName=function(a){b.userNameAutoCmp=!0;var c={},d=[];return c.searchString=a,k.getData(l.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(a){return b.userNameAutoCmp=!1,d=angular.fromJson(a.data)},function(a){b.userNameAutoCmp=!1})},b.addUpdateAllergyRecord=function(){c.showSpinner=!0,e.isNullOrEmpty(b.location)||(b.addAllergyObj.location=b.location),c.loggedInUserDetails.isOrganizationUser||c.loggedInUserDetails.isOrganizationUserMode||e.isNullOrEmpty(j)||(b.addAllergyObj.patientUser=j),b.addAllergyObj.allergyRecordDate=new Date,e.isNullOrEmpty(b.addAllergyObj.allergyStartedDate)&&(b.addAllergyObj.allergyStartedDate=new Date),c.loggedInUserDetails.isOrganizationUser&&c.loggedInUserDetails.isOrganizationUserMode?b.addAllergyObj.whetherSystemOrg=!1:b.addAllergyObj.whetherSystemOrg=!0,"add"==b.pageState?k.postData(l.getUrl("ALLERGY_ADD"),b.addAllergyObj,function(b){c.showSpinner=!1;var d=!0;a.hide(d),f("success",h.instant("ALLERGY_RECORD_ADDED"))},function(a){c.showSpinner=!1}):k.putData(l.getUrl("ALLERGY_EDIT"),b.addAllergyObj,function(b){c.showSpinner=!1;var d=!0;a.hide(d),f("success",h.instant("ALLERGY_RECORD_UPDATED"))},function(a){c.showSpinner=!1})}}s.$inject=["$mdDialog","$scope","$rootScope","userStatusService","utilService","baseService","location","patientUser","pageState","rowObject"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.maxDateValidFrom=new Date,a.listView=!0,a.cardView=!1,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1):(a.cardView=!1,a.listView=!0),"Card view"===c?"List View":"Card view"})}),a.manageAllergy=function(b,c){var d=null,e=null;m.isNullOrEmpty(a.location)||(d=a.location),m.isNullOrEmpty(a.searchCriteria)||m.isNullOrEmpty(a.searchCriteria.patientUser)||(e=a.searchCriteria.patientUser),g.show({controller:s,templateUrl:"app/modules/appointment/views/add-edit-allergy-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{location:d,patientUser:e,pageState:b,rowObject:c}}).then(function(b){1==b&&a.getAllergies()},function(b){1==b&&a.getAllergies()})},a.deleteAllergyRecord=function(c){b.showSpinner=!0;var d={id:c.id};k.postData(l.getParameterizedUrl("ALLERGY_DELETE",d),null,function(c){b.showSpinner=!1,a.getAllergies(),f("success",h.instant("ALLERGY_RECORD_DELETED"))},function(a){b.showSpinner=!1})},a.getAllergies=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,m.isNullOrEmpty(a.searchCriteria.location)&&(m.isNullOrEmpty(a.location)?a.searchCriteria.location=null:(a.searchCriteria.location=a.location,a.searchCriteria.orgId=null)),b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.searchCriteria.whetherSystemOrg=!1:a.searchCriteria.whetherSystemOrg=!0,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("ALLERGY_LIST"),c,function(c){c&&c.data&&(b.showSpinner=!1,a.allergyList=angular.fromJson(c.data),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode&&m.isNullOrEmpty(a.apptId)?a.searchCriteria={}:(delete a.searchCriteria.allergy,delete a.searchCriteria.allergyReaction,delete a.searchCriteria.location,delete a.searchCriteria.allergyStartedFromDate,delete a.searchCriteria.allergyStartedToDate,delete a.searchCriteria.allergyRecordFromDate,delete a.searchCriteria.allergyRecordToDate),a.getAllergies()},a.findUserByName=function(b){a.userNameAutoCmp=!0;var c={},d=[];return c.searchString=b,k.getData(l.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",k.getData(l.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getAllergies()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getAllergies()};
//datatble config json
var t={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(t),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){if(!m.isNullOrEmpty(c)&&!m.isNullOrEmpty(c.rowObject))if(a.apptId=c.rowObject.id,a.searchCriteria.patientUser={id:c.rowObject.patientId,value:c.rowObject.patientName},m.isNullOrEmpty(c.rowObject.organizationLocationId)||m.isNullOrEmpty(c.rowObject.locationName)){var d=j.getDefaultOrgLocation();m.isFieldEmpty(d)||(a.location=d.orgLoc)}else a.location={id:c.rowObject.organizationLocationId,value:c.rowObject.locationName};if(m.isNullOrEmpty(a.location)){var d=j.getDefaultOrgLocation();m.isFieldEmpty(d)||(a.location=d.orgLoc)}b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherInd=!1:(a.whetherInd=!0,m.isNullOrEmpty(a.searchCriteria.patientUser)&&(a.searchCriteria.patientUser={id:angular.fromJson(j.getLoggedInUser()).id,value:angular.fromJson(j.getLoggedInUser()).displayName})),a.getAllergies()},a.init()}]),angular.module("paripal.appointmentModule").controller("AppointmentCardViewCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","$filter","serverSidePagination","baseService","httpService","urlService","utilService","appointmentsListService","featurePrivilegeConstants","manageCalendarEventService","commonCalendarService","MakePrescriptionFactory","$timeout","manageRequestService","manageFixAppointmentService","manageCheckInOutAllotService","viewUserMedicationService","userStatusService","userTestListService","fileOperations","emergencyUploadListService","searchUserFamilyHistoryService","manageUserFamilyHistoryService","viewUserIncidentService","viewUserSymptomsService","manageUserSymptomsService","commonConstants","commonBillingService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){"use strict";function J(a,b,d,e,f,g,i,j,k,o,p,q,r,s){function t(a,b,c,d,e,f,g,h){a.transactionList=f,a.selectedTransaction=[],a.currentTransaction=h,a.addRemoveTransaction=function(b){var c=!1;angular.forEach(a.selectedTransaction,function(d,e){d.transactionId==b.transactionId&&(a.selectedTransaction.splice(e,1),c=!0)}),0==c&&a.selectedTransaction.push(b)},a.createBill=function(){angular.forEach(a.transactionList,function(b,c){b.transactionId==a.currentTransaction&&a.selectedTransaction.push(b)}),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),b.cancel(),d.go("createbill",{type:"DEBIT",data:g,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})},a.cancel=function(){b.cancel()}}t.$inject=["$scope","$mdDialog","notify","$state","$rootScope","transactionList","paramData","currentTransaction"],a.cancel=function(){g.reload(),b.cancel()},a.later=function(){g.reload(),b.cancel()},a.prepareAdhocBill=function(){b.cancel();var c={};n.isNullOrEmpty(j)||(c.transactionId=j),n.isNullOrEmpty(k)||(c.appointmentId=k),n.isNullOrEmpty(o)||(o.id?c.serviceTypeId=o.id:c.serviceTypeId=o),n.isNullOrEmpty(p)||(c.locationId=p),c.whetherWalkinAppointment=!0,l.postData(m.getUrl("GET_ADHOC_BILL_SETUP"),c,function(d){if(n.isFieldEmpty(d.data))b.cancel();else{b.cancel();/* SERVER params to be sent */
var e=angular.copy(d.data);/* UI params to be sent */
e.fromCheckIn=!0,e.raisedOnDetails={raisedOnUserId:e.raisedOnUserId.id,raisedOnName:e.raisedOnUserId.value},e.transaction={id:c.transactionId};/*$state.go("createbill", {
                            type: "DEBIT",
                            data: paramData,
                            feeHeadAmnt: "YES",
                            pageState: 'CREATE',
                            isCreateReceipt: true
                        });*/
var f={};f.onBehalfofUser={id:e.raisedOnUserId.id,value:e.raisedOnUserId.value},f.organizationLocation={id:c.locationId},l.postData(m.getUrl("GET_ALL_UNBUILD_TRANSACTIONS"),f,function(d){if(d.data&&d.data.length>1)b.show({controller:t,templateUrl:"app/modules/billing/views/unbilled-transaction-list.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{transactionList:d.data,paramData:e,currentTransaction:c.transactionId}});else if(d.data&&1==d.data.length){var f=d.data[0];a.selectedTransaction=[],a.selectedTransaction.push(f),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),g.go("createbill",{type:"DEBIT",data:e,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})}},function(a){})}},function(a){})},a.generateBill=function(){b.cancel();var a={};a.transactionId=[],n.isNullOrEmpty(j)||a.transactionId.push(j),d.generateBill(a.transactionId,function(a){var c=null;c=n.isNullOrEmpty(k)?null:k,c&&e.setIsBilledOfAppointment(c,function(c){b.cancel();var d={};d.entityName=s,d.apptDate=q,d.event=r,g.go("managebill",{parentState:"APPOINTMENT",billId:a.response,type:"view",createReceipt:!0,appointmentDetails:d})},function(a){})},function(a){var d=b.confirm().title(h.instant("FEE_TYPE_NOT_FOUND_TITLE")).textContent(h.instant("APPOINTMENT_FEE_NOT_FOUND_BODY")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));b.show(d).then(function(){},function(){g.go("appointmentsList",c)})},{handleError:!1})}}function K(a,b,d,e,f,g){console.log(angular.fromJson(d)),a.prescriptionList=d,a.cancel=function(){b.cancel()},a.viewPrescriptionCall=function(a){var d="PRESCRIPTION_REFERENCE_FORM",e=c;/*prevStateParam.stateName = "appointmentsList";*/
//         prevStateParam.data = {
//         };
b.cancel(),g.loadNewFormRunner(a.id,d,a.organizationLocation.id,1,e,null,0,null)}}function L(a,b,c,d,e,f,g,i,j){a.fwdObj={},n.isNullOrEmpty(f.id)||g.getCheckInOutAllotment(f.id,function(b){e.showSpinner=!1,a.fwdDetails=b}),a.cancel=function(){b.hide()};var k=angular.fromJson(localStorage.getItem("defaultOrg")),l=angular.fromJson(localStorage.getItem("defaultOrgLoc")),m=angular.fromJson(localStorage.getItem("loggedInUser"));a.forwardToSelected=function(b){var c={};return a.fwdObj.selectPerson="","whetherSelf"==b?c.whetherSelf=!0:c.whetherSelf=!1,"whetherHealthProfessional"==b?c.whetherHealthProfessional=!0:c.whetherHealthProfessional=!1,"whetherSupportProfessional"==b?c.whetherSupportProfessional=!0:c.whetherSupportProfessional=!1,"whetherChiefDoctor"==b?c.whetherChiefDoctor=!0:c.whetherChiefDoctor=!1,"whetherOther"==b?c.whetherOther=!0:c.whetherOther=!1,n.isNullOrEmpty(k)||(c.organizationId=k.id),n.isNullOrEmpty(l)||(c.organizationLocationId=l.id),n.isNullOrEmpty(m)||(c.userId=m.id),i.postData(j.getParameterizedUrl("FORWARD_USER_LIST"),c,function(b){return a.personList=angular.fromJson(b.data)},function(a){})},a.updateForwardTo=function(){var d={};n.isNullOrEmpty(f.organizationLocationId)||(d.organizationLocationId=f.organizationLocationId),d.actionTaken="FORWARDED",n.isNullOrEmpty(f.transactionId)||(d.transactionId=f.transactionId),n.isNullOrEmpty(f.startTime)||(d.checkInTime=f.startTime),n.isNullOrEmpty(f.patientId)||(d.onBehalfOfId=f.patientId),n.isNullOrEmpty(f.patientName)||(d.displayName=f.patientName),n.isNullOrEmpty(a.fwdDetails.patientPhoneNumber)||(d.cell1=a.fwdDetails.patientPhoneNumber),n.isNullOrEmpty(a.fwdDetails.patientAddress)||(d.onBehalfOfAddress=a.fwdDetails.patientAddress),n.isNullOrEmpty(a.fwdDetails.billPaid)||(d.whetherPaid=a.fwdDetails.billPaid),n.isNullOrEmpty(a.fwdDetails.walkin)||(d.isWalkIn=a.fwdDetails.walkin),n.isNullOrEmpty(a.fwdDetails.followUp)||(d.isFollowUp=a.fwdDetails.followUp),n.isNullOrEmpty(a.fwdDetails.isBillable)||(d.isBillable=a.fwdDetails.isBillable),/*if (!utilService.isNullOrEmpty($scope.fwdDetails.isBillable)) {
                    requestObj.isForwarded = rowObject.isBillable;
                }*/
n.isNullOrEmpty(a.fwdDetails.newUhid)||(d.isNewUHID=a.fwdDetails.newUhid),n.isNullOrEmpty(a.fwdDetails.freeVisit)||(d.isFreeVisit=a.fwdDetails.freeVisit),/*if (!utilService.isNullOrEmpty($scope.fwdDetails.tokenIssuedBy)) {
                    requestObj.tokenIssuedById = rowObject.tokenIssuedBy;
                }*/
n.isNullOrEmpty(a.fwdDetails.allocatedTo)||(d.allocatedToId=a.fwdDetails.allocatedTo.id),n.isNullOrEmpty(a.fwdObj.selectPerson)||(d.forwardedToId=a.fwdObj.selectPerson.userId),n.isNullOrEmpty(a.fwdObj.status)||(d.actionStatus=a.fwdObj.status),n.isNullOrEmpty(a.fwdDetails.forwardedBy)||(d.forwardedById=a.fwdDetails.forwardedBy.id),n.isNullOrEmpty(a.fwdDetails.forwardedOn)||(d.forwardedTime=a.fwdDetails.forwardedOn),n.isNullOrEmpty(a.fwdDetails.serviceType)||(d.serviceType=a.fwdDetails.serviceType),n.isNullOrEmpty(a.fwdDetails.wetherUserExist)||(d.whetherExistingUser=a.fwdDetails.wetherUserExist),i.putData(j.getParameterizedUrl("UPDATE_CHECK_IN_OUT_DETAILS",{appointmentId:f.id}),d,function(a){a&&a.data&&(c("success",h.instant("PATIENT_FORWARDED")),b.hide("SUCCESS"))},function(a){})}}function M(a,b,c,d,e,f,g,h){a.transactionList=f,a.selectedTransaction=[],a.currentTransaction=h,a.addRemoveTransaction=function(b){var c=!1;angular.forEach(a.selectedTransaction,function(d,e){d.transactionId==b.transactionId&&(a.selectedTransaction.splice(e,1),c=!0)}),0==c&&a.selectedTransaction.push(b)},a.createBill=function(){angular.forEach(a.transactionList,function(b,c){b.transactionId==a.currentTransaction&&a.selectedTransaction.push(b)}),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),b.cancel(),d.go("createbill",{type:"DEBIT",data:g,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})},a.cancel=function(){b.cancel()}}J.$inject=["$scope","$mdDialog","commonBillingService","manageCheckInOutAllotService","notify","$state","$rootScope","transactionId","appointmentId","serviceTypeId","locationId","apptDate","event","entityName"],K.$inject=["$scope","$mdDialog","prescriptionList","$filter","baseService","orbeonFormRunner"],L.$inject=["$scope","$mdDialog","notify","$state","$rootScope","rowObject","manageCheckInOutAllotService","httpService","urlService"],M.$inject=["$scope","$mdDialog","notify","$state","$rootScope","transactionList","paramData","currentTransaction"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.showViewAppointmentMenu=!1,a.commonConstants=H,b.showSpinner=!1,a.WSAppoinrmentList=[],
//$scope.orgLocPermission = featurePrivilegeConstants.PROCESS_VIEW;
a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.postHeader={},a.generatePharmacyBill=function(b){var c=[b.pharmacyOrderTransactionId];I.generateBill(c,function(b){f("success",b.successMessage),a.billId=b.response,d.go("managebill",{type:"view",billId:a.billId})},function(a){})},a.viewFamilyHistoryById=function(b){D.getUserFamilyById(b.id,function(b){g.show({controller:"manageUserFamilyHistoryPopupCtrl",templateUrl:"app/modules/user-family-history/views/manage-user-family-history-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,familyHistory:b,mode:{mode:"view"},appointmentRef:null}}).then(function(b){a.WSHealthProfessionalsValues={}},function(b){b&&b.diseaseVariantList&&b.recordDetails&&b.diseaseVariantList.length>=0&&(b.recordDetails.currentDiseaseVariants=b.diseaseVariantList),a.WSHealthProfessionalsValues={}})},function(a){})},a.editFamilyHistoryById=function(b,c){D.getUserFamilyById(b.id,function(b){g.show({controller:"manageUserFamilyHistoryPopupCtrl",templateUrl:"app/modules/user-family-history/views/manage-user-family-history-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,familyHistory:b,mode:{mode:"edit"},appointmentRef:null}}).then(function(b){a.WSHealthProfessionalsValues={}},function(b){var d={};d.userId=c.patientId,d.pageNumber=1,d.recordsPerPage=1e3,C.getuserHistoryList(d,function(b){b&&(a.familyHistoryList=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})})},function(a){})},a.addMeasurementFunction=function(b){g.show({controller:"AddUserMeasurementPopupCtrl",templateUrl:"app/modules/appointment/views/add-user-measurement-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{userDetails:{id:b.userId,value:b.userName},diagnosticTestObj:{id:b.id,value:b.diagnosticTestName}}}).then(function(b){a.WSHealthProfessionalsValues={}},function(b){b&&b.diseaseVariantList&&b.recordDetails&&b.diseaseVariantList.length>=0&&(b.recordDetails.currentDiseaseVariants=b.diseaseVariantList),a.WSHealthProfessionalsValues={}})},a.createPharmacyOrder=function(b){var c={appointmentId:b.id};o.createPharmacyOrder(c,function(c){f("success",h.instant("PHARMACY_ORDER_GENERATED_SUCCESSFULLY")),a.createPrescription(b),d.reload()},function(a){})},a.updateMedicationAppointmentDetails=function(b,c,d){g.show({controller:"UpdateMedicationAppointmentDetailsCtrl",templateUrl:"app/modules/appointment/views/update-medication-appointment-details.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{medicationObj:b,usedFor:c}}).then(function(b){if(1==b){var c={};a.apptPatientId=d.patientId,/*filterVaccine.current = 'current';*/
c.pageNumber=1,c.recordsPerPage=1e3,c.user=d.patientId,c.appointmentId=d.id,c.excludeAppointment=!1,x.fetchRecords(c,function(b){b&&t(function(){a.medicationList=b.data},100)},function(a){})}},function(b){if(1==b){var c={};a.apptPatientId=d.patientId,/*filterVaccine.current = 'current';*/
c.pageNumber=1,c.recordsPerPage=1e3,c.user=d.patientId,c.appointmentId=d.id,c.excludeAppointment=!1,x.fetchRecords(c,function(b){b&&t(function(){a.medicationList=b.data},100)},function(a){})}})},a.deleteIssueById=function(a){a.userTreatment&&
//appointmentsListService.deleteIssueById(issueObj.userTreatment.id, function (successResp) {
o.deleteTreatmentById(a.userTreatment.id,function(a){console.log(a)},function(a){})},a.viewMeasurementFunction=function(b){g.show({controller:"ViewMeasurementIndicatorPopupCtrl",templateUrl:"app/modules/labCRM/views/view-measurement-indicator-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{patient:{id:b.userId,value:b.userName},diagnosticTest:{id:b.id,value:b.diagnosticTestName}}}).then(function(b){a.WSHealthProfessionalsValues={}},function(b){b&&b.diseaseVariantList&&b.recordDetails&&b.diseaseVariantList.length>=0&&(b.recordDetails.currentDiseaseVariants=b.diseaseVariantList),a.WSHealthProfessionalsValues={}})},a.loadMeasurementList=function(b){a.userMeasurementObject={},a.userMeasurementObject.measurementList=[];var c={};c.userTestId=b,l.getData(m.getParameterizedUrl("GET_INDICATORBYUSERTESTIDANDCODE",c),null,function(b){var c=b.data;n.isNullOrEmpty(c.measurementDate)||(c.measurementDate=dateconvertor.convertToViewDate(c.measurementDate)),n.isEmpty(c.diagnosticTestUser)||(c.userTestCode=c.diagnosticTestUser.code),a.measurementListLength=c.wsUserMeasurements.length,angular.copy(c,a.userMeasurementObject)},function(a){})},a.entityType={queryUrl:"GET_ENTITY_TYPES_EXCEPT_ORG_LOC",queryParameter:{}},a.viewUserMedication=function(a,b,c){var e={},f="apptCardView";e="add"==b?{value:a.patientName,id:a.patientId}:a.user,d.go("manageAppointmentMedication",{type:b,userId:e,medicationObj:a,fromState:f,appointmentId:c})},a.eventType={queryUrl:"GET_APPOINTMENT_EVENT_TYPE",queryParameter:{}},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.serviceType={queryUrl:"GET_ALL_TREATMENT_TYPE",queryParameter:{}},a.apptStatus={queryUrl:"GET_APPOINTMENT_STATUS",queryParameter:{}},a.allocatedForwarded={queryUrl:"GET_EQUIPMENT_USERS",queryParameter:{orgLocationId:0}},a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:0}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}})):(a.searchCriteria.entityName=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.eventType",function(b,c){b&&b.id?(a.isEventNameDisabled=!1,a.searchCriteria.entityName&&a.searchCriteria.entityName.id?a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:a.searchCriteria.entityName.id}}:a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:0}}):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityName",function(b,c){b&&b.id?(a.isProcessSelected=!1,"CAL_PROCESS"===a.searchCriteria.entityType.code?(a.isProcessSelected=!0,a.specificProfessional={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.searchCriteria.specificProfessional={},a.searchCriteria.eventType&&(a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:a.searchCriteria.eventType.id,entityId:a.searchCriteria.entityName.id}})):(a.searchCriteria.specificProfessional={},a.isProcessSelected=!1)}),a.searchFixAppointment=function(c){a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.apptDate&&(localStorage.setItem("appointmentListFilter",angular.toJson(a.searchCriteria)),a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0,a.currentDate=i("timestampToDate")(new Date,"yyyy/MM/dd"),a.searchCriteria.apptDate=i("timestampToDate")(a.searchCriteria.apptDate,"yyyy/MM/dd"),a.searchCriteria.apptDate==a.currentDate?a.isCurrentDate=!0:a.isCurrentDate=!1,1!=a.searchByPatient&&(a.searchCriteria.patientUserId=null),o.searchFixAppointment(a.searchCriteria,a.postHeader,function(c){b.showSpinner=!1,a.WSAppoinrmentList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),t(function(){$("*[class*=familyHistory]").hide(),$("*[class*=userAllergy]").hide(),$("*[class*=followupActions]").hide(),$("*[class*=userIncident]").hide(),$("*[class*=userSymptoms]").hide(),$("*[class*=diagnosticTest]").hide(),$("*[class*=showMedication]").hide(),$("*[class*=showUpload]").hide(),$("*[class*=showDisease]").hide(),$("*[class*=showCheckin]").hide(),$("*[class*=showCheckout]").hide()},1e3)},function(a){b.showSpinner=!1}))},a.viewTreatmentHistory=function(a){d.go("patientRecord",{type:"view",id:a.patientId,locationId:a.organizationLocationId,displayName:a.patientName,locationValue:a.locationName})},a.viewPatientActivity=function(a){d.go("patientActivityList",{apptId:a.id})},a.viewAppointment=function(a){d.go("manageFixAppointment",{type:"view",appointmentId:a.id})},a.viewUserAllergyById=function(){},a.showHistoricalNotes=function(a,b){g.show({templateUrl:"app/modules/appointment/views/historic-clinical-notes-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{diseaseVariantId:a.diseaseVariant.id,userId:b.patientId,locationId:b.organizationLocationId},controller:["$scope","$mdDialog","locals","manageUserIssueService",function(a,b,c,d){a.getNotes=function(){return console.log(c),a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=c.diseaseVariantId,a.searchKeyWord.userId=c.userId,a.searchKeyWord.locationId=c.locationId,l.getData(m.getParameterizedUrl("APPT_HISTORIC_NOTES",a.searchKeyWord),null,function(b){if(b&&b.data)return a.historicNotesData=b.data,a.historicNotesData},function(a){})},a.getNotes(),a.cancel=function(){b.cancel()}}]})},a.viewDocumentPopup=function(b){a.viewDocument(b,b.documentTypeCode,b.documentSubTypeCode)},a.createPrescription=function(b){var c={};c.prescriptionRef=b.patientName+b.entityName+b.apptDate,c.datePrescriptionCreated=new Date,c.user={id:b.patientId,value:b.patientName},c.organizationLocation={id:b.organizationLocationId,value:b.locationName},c.appointment={id:b.id},o.createPrescriptionForMedication(c,function(c){console.log(c),f("success",h.instant("PRESCRIPTION_ADDED_SUCCESSFULLY")),a.viewDocument(c.response,c.response.documentType.type,c.response.documentType.subType,b.id)},function(a){f("error",h.instant("ERROR_WHILE_ADDING_PRESCRIPTION"))})},a.addUserAllergy=function(b){g.show({controller:"AddUpdateAllergyCtrl",templateUrl:"app/modules/appointment/views/add-edit-allergy-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{locationId:b.organizationLocationId,userId:b.patientId,pageState:"add",rowObject:null,appointmentObj:b}}).then(function(c){1==c&&a.getAllergyList(b)},function(c){1==c&&a.getAllergyList(b)})},a.viewUserAllergyById=function(b,c,d){g.show({controller:"AddUpdateAllergyCtrl",templateUrl:"app/modules/appointment/views/add-edit-allergy-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{locationId:b.organizationLocationId,userId:b.patientId,pageState:c,rowObject:b,appointmentObj:null}}).then(function(b){1==b&&a.getAllergyList(d)},function(b){1==b&&a.getAllergyList(d)})},a.inActivate=function(a,b){F.deleteUserSymptomRecordById(a,function(a){a&&f("success",h.instant("RECORD_DELETED_SUCCESSFULLY"))},function(a){})},a.getFollowupActions=function(c){var d={};d.pageNumber=1,d.recordsPerPage=1e3,d.appointment={id:c.id},b.showSpinner=!0,l.postData(m.getUrl("FOLLOWUP_ACTIONS_LIST"),d,function(c){c&&c.data&&(b.showSpinner=!1,a.followupActionList=angular.fromJson(c.data).data)},function(a){b.showSpinner=!1})},a.viewFollowupActions=function(b){a.followUpActions?(a.followUpActions=!a.followUpActions,$("*[class*=followupActions]").hide()):(a.followUpActions=!0,$(".followupActions"+b.id).show(),a.getFollowupActions(b))},a.addFollowupAction=function(b){g.show({controller:"ManageFollowupActionPopupCtrl",templateUrl:"app/modules/appointment/views/add-follow-up-actions-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{userId:b.patientId,pageState:"add",rowObject:null,apptId:b.id,patientName:b.patientName}}).then(function(c){1==c&&a.getFollowupActions(b)},function(c){1==c&&a.getFollowupActions(b)})},a.getAllergyList=function(b){o.getAllergyListForAppointment(b,function(b){a.userAllergyList=b.data})},a.viewUserAllergys=function(b){a.showUserAllergy?(a.showUserAllergy=!a.showUserAllergy,$("*[class*=userAllergy]").hide()):(a.showUserAllergy=!0,$(".userAllergy"+b.id).show(),a.getAllergyList(b))},a.goToAppointmentNotes=function(a){d.go("appointmentnotes",{appointmentId:a.id,type:"edit"})},a.showAppointmentNotes=function(a){g.show({controller:"AppointmentNotesPopupCtrl",templateUrl:"app/modules/appointment/views/appointment-notes-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{appointmentId:{id:a.id},pageType:"edit",diseaseVariant:null}})},a.goToUploadDownload=function(a){o.goToUploadDownload(a)},a.showUploadDownload=function(b){if(a.showUpload)a.showUpload=!a.showUpload,$("*[class*=showUpload]").hide();else{a.showUpload=!0,localStorage.setItem("apptOpenTab","showUpload"),localStorage.setItem("apptOpenTabRow",JSON.stringify(b)),$(".showUpload"+b.id).show();var c={};c.appointmentId=b.id,a.recordId=b.id,c.userId=0,c.pageNo=1,o.getUploadDownloadListForAppointment(c,function(b){a.uploadList=b})}},a.viewDocument=function(b,c,d,e){var f=new Object;f.fileName=b.fileName,b.documentId?f.resourceId=b.documentId:b.id&&(f.resourceId=b.id),b.appointmentId&&(f.recordId=b.appointmentId),e&&(f.recordId=e),c?f.docType=c:f.docType="TRANSACTION",d?f.docSubType=d:f.docSubType="APPOINTMENT_TRANSACTION",a.fileResource=f,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0},a.addToCurrentFuntion=function(a,b){console.log(a);var c=a;c.appointmentId=b.id,l.putData(m.getUrl("UPDATE_APPT_DISEASE_VARIANT"),c,function(a){f("success",h.instant("DISEASE_DETAILS_UPDATED_SUCCESSFULLY")),d.reload()},function(a){})},a.searchUserTest=function(c,d){if(a.showDiagnosticTest)a.showDiagnosticTest=!a.showDiagnosticTest,$("*[class*=diagnosticTest]").hide();else{a.showDiagnosticTest=!0,a.diagnosticTestList=[],localStorage.setItem("apptOpenTab","diagnosticTest"),localStorage.setItem("apptOpenTabRow",JSON.stringify(c)),$(".diagnosticTest"+c.id).show(),b.showSpinner=!0;var e={};e.pageNumber=1,e.recordsPerPage=1e3,e.userId=c.patientId,e.appointmentId=c.id,e.organizationLocationId=c.organizationLocationId,z.searchAllUserTests(e,function(c){console.log(c),a.diagnosticTestList=c.data,b.showSpinner=!1},function(c){b.showSpinner=!1,a.error=c});var f={};a.oldDiagnosticTestList=[],f.pageNumber=1,f.recordsPerPage=1e3,f.userId=c.patientId,f.organizationLocationId=c.organizationLocationId,f.appointmentId=c.id,f.whetherExcludeAppointment=!0,z.searchAllUserTests(f,function(c){a.oldDiagnosticTestList=c.data,b.showSpinner=!1},function(c){b.showSpinner=!1,a.error=c})}},a.addUserTest=function(a){var b="apptCardView",c={};c.id=a.patientId,c.value=a.patientName,d.go("testorder",{pageState:"prescription",isPrescription:!0,appointmentId:a.id,patientDetails:c,fromState:b})},a.goToAddComments=function(b,c,d,e){var f={};f="medication"==c?{appointmentData:d,treatmentData:null,medicationData:b,diseaseVariantData:null,diagnosticTestData:null,fromState:c,pageState:null}:"diagnostic test"==c?{appointmentData:d,treatmentData:null,medicationData:null,diseaseVariantData:null,diagnosticTestData:b,fromState:c,pageState:null}:"disease variant"==c?n.isNullOrEmpty(e)||"view"!=e?{appointmentData:d,treatmentData:null,medicationData:null,diseaseVariantData:b,diagnosticTestData:null,fromState:c,pageState:null}:{appointmentData:d,treatmentData:null,medicationData:null,diseaseVariantData:b,diagnosticTestData:null,fromState:c,pageState:e}:{appointmentData:b,treatmentData:null,medicationData:null,diseaseVariantData:null,diagnosticTestData:null,fromState:c,pageState:null},g.show({controller:"AddCommentsDetailsPopupCtrl",templateUrl:"app/modules/appointment/views/addComments-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:f}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.fileChange=function(b){a.files=[];var b=angular.element(b);if(null===b){var c=angular.element(document.querySelector("input#fileInput")),d=c[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)}),c.val(null)}else{var d=b[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)})}a.files&&a.files.length>0&&N(a.files)};var N=function(b){var c={};c.documentType={},c.documentType.type="TRANSACTION",c.documentType.subType="APPOINTMENT_TRANSACTION",c.documentType.id=24,a.fileUploadSpinner=!0,A.saveAllDocuments(c,!1,b,function(a){b&&b.length>0&&a&&O(b,c,a)},function(b){a.fileUploadSpinner=!1})},O=function(b,c,d){var e={};n.isFieldEmpty(a.transactionId)||(e.transactionId=a.transactionId),e.documentIds=[];for(var f=0;f<d.response.length;f++)e.documentIds.push(d.response[f].id);n.isFieldEmpty(a.idFieldName)||(e[a.idFieldName]=a.recordId),n.isFieldEmpty(a.recordId)||(e.appointmentId=a.recordId),B.saveTransactionAttachment(e,function(a){b&&b.length>0&&d&&P(b,c,d,e)},function(b){a.fileUploadSpinner=!1,B.deleteAllDocument(e.documentIds,function(a){},function(a){})})},P=function(c,d,e,g){var i=new Object;i.docType=d.documentType.type,i.docSubType=d.documentType.subType,i.recordId=a.recordId,e.response&&(i.resourceDetails=JSON.stringify(e.response)),A.uploadMultipleFiles(i,c,function(c){a.fileUploadSpinner=!1,b.$broadcast("getAttachmentList");var d={};d.appointmentId=a.recordId,d.userId=y.userData().userId,d.pageNo=1,o.getUploadDownloadListForAppointment(d,function(b){a.uploadList=b})},function(b){a.fileUploadSpinner=!1,f("Error",h.instant("ERROR_WHILE_UPLOADING")),B.deleteByTransactionIdAndDocIds(g,function(a){B.deleteAllDocument(g.documentIds,function(a){},function(a){})},function(a){})})};a.editUserTest=function(a){d.go("addEditUserTests",{type:"edit",userTestId:a.id,previousState:d.current.name})},a.viewUserTest=function(a){d.go("addEditUserTests",{type:"view",userTestId:a.id,previousState:d.current.name})},a.manageRecordWalkInForm=function(b,c,d,e){if("RECORDWALKIN"===d&&a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.apptDate)a.manageAppointmentForm(b,c,d,e);else{
//notify("warning", $translate.instant("FILTER_FILL_MANDATORY_FIELDS_RECORDWALKIN"));
var f=g.alert().title(h.instant("MANDETORY_FIELDS_NEEDED")).textContent(h.instant("FILTER_FILL_MANDATORY_FIELDS_RECORDWALKIN")).ariaLabel("Lucky day").ok(h.instant("OK"));g.show(f).then(function(){},function(){})}},a.showDiagnosticTests=function(a){var b={};a.patientId&&(b.userName=a.patientName,b.userId=a.patientId,d.go("usertestlist",b))},a.viewMedication=function(b){if(a.showMedication)a.showMedication=!a.showMedication,$("*[class*=showMedication]").hide();else{a.showMedication=!0,localStorage.setItem("apptOpenTab","showMedication"),localStorage.setItem("apptOpenTabRow",JSON.stringify(b)),$(".showMedication"+b.id).show();var c={};a.apptPatientId=b.patientId,/*filterVaccine.current = 'current';*/
c.pageNumber=1,c.recordsPerPage=1e3,c.user=b.patientId,c.appointmentId=b.id,c.excludeAppointment=!1,x.fetchRecords(c,function(b){b&&t(function(){a.medicationList=b.data},100)},function(a){});var d={};a.apptPatientId=b.patientId,/*filterOldVaccine.current = 'stopped';*/
d.pageNumber=1,d.recordsPerPage=1e3,d.user=b.patientId,d.appointmentId=b.id,d.excludeAppointment=!0,x.fetchRecords(d,function(b){b&&t(function(){a.oldMedicationList=b.data},100)},function(a){})}},a.createViewBill=function(a){if(1==a.whetherTransactionBilled){var b={};/* raisedOn OR PARTY_TYPE value */
b.raisedOn="INDIVIDUAL",/* partyNameId.id OR RAISED_ON object */
b.partyNameId={id:a.patientId,value:a.patientName},/* type OR SELECT_BILL_TYPE value */
b.type="DEBIT",/* locationId OR SELECT_ORG_LOCATION object */
b.inFavorOfOrgList={id:a.organizationLocationId,value:a.locationName},/* dateFromString OR DATE_FROM */
b.dateFromString=a.apptDate,b.dateTillString=new Date,b.fromApptList=!0,b.transactionId=a.transactionId,d.go("searchbill",{data:b})}else{var c=a.transactionId,e=a.id,f=a.serviceTypeId,h=a.organizationLocationId,i=a.apptDate,j=a.event.value,k=a.entityName;g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{transactionId:c,appointmentId:e,serviceTypeId:f,locationId:h,apptDate:i,event:j,entityName:k}})}},a.calculateDateOfBirth=function(){
//changes done to calculate birthDate by age and month
var b,c;b=a.WSClientExtraData.age?(new Date).getFullYear()-a.WSClientExtraData.age:(new Date).getFullYear(),c=a.WSClientExtraData.month?(new Date).getMonth()-a.WSClientExtraData.month:(new Date).getMonth(),a.guardianData.birthDate=new Date(b,c,(new Date).getDate()),a.dobChanged(a.WSClientExtraData.age)},a.setDirectiveFn=function(b){a.dobChanged=b},a.viewPrescription=function(b){o.getPrescriptionByAppId(b.id,function(b){g.show({controller:K,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){})},a.viewPrescriptionForTreatment=function(b){o.getPrescriptionByTreatmentId(b.id,function(b){g.show({controller:K,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){})},a.viewPrescriptionForRequest=function(b){b.appointmentId?o.getPrescriptionByAppId(b.appointmentId,function(b){g.show({controller:K,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){}):o.getPrescriptionByRequestFulId(b.id,function(b){g.show({controller:K,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){})},a.makePrescription1=s.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="usermedication",a.makePrescription1(b,c,d,e,g,f)},a.treatmentRecordDetails=function(b){1!=a.showDisease?(a.showDisease=!0,localStorage.setItem("apptOpenTab","showDisease"),localStorage.setItem("apptOpenTabRow",JSON.stringify(b)),$(".showDisease"+b.id).show()):(a.showDisease=!1,$("*[class*=showDisease]").hide())},a.showDiseaseVariant=function(a){console.log(a)},a.addDiseaseVariant=function(b){g.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:b,isCurrentDate:a.isCurrentDate,baseService:k,diseaseVariantObj:null,mode:"add"}}).then(function(b){a.WSHealthProfessionalsValues={}},function(b){b&&b.diseaseVariantList&&b.recordDetails&&b.diseaseVariantList.length>=0&&(b.recordDetails.currentDiseaseVariants=b.diseaseVariantList),a.WSHealthProfessionalsValues={}})},a.viewDiseaseVariant=function(b){g.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,diseaseVariantObj:b,mode:"view"}}).then(function(b){a.WSHealthProfessionalsValues={}},function(b){b&&b.diseaseVariantList&&b.recordDetails&&b.diseaseVariantList.length>=0&&(b.recordDetails.currentDiseaseVariants=b.diseaseVariantList),a.WSHealthProfessionalsValues={}})},a.editDiseaseVariant=function(b){console.log(b),g.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,diseaseVariantObj:b,mode:"edit"}}).then(function(b){a.WSHealthProfessionalsValues={}},function(b){b&&b.diseaseVariantList&&b.recordDetails&&b.diseaseVariantList.length>=0&&(b.recordDetails.currentDiseaseVariants=b.diseaseVariantList),a.WSHealthProfessionalsValues={}})},a.viewNote=function(a){g.show({controller:"AppointmentNotesPopupCtrl",templateUrl:"app/modules/appointment/views/appointment-notes-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{appointmentId:{id:a.appointmentId},pageType:"edit",diseaseVariant:a}})},a.manageAppointmentForm=function(b,c,e,f){var g={appointmentType:e};b&&b.id&&(g.appointmentId=b.id),g.urlState=c,a.searchCriteria.entityType?g.entityType=a.searchCriteria.entityType:b.entityType&&b.entityTypeId&&(g.entityType={id:b.entityTypeId,code:b.entityType}),a.searchCriteria.entityName?g.entityName=a.searchCriteria.entityName:b.entityId&&b.entityName&&(g.entityName={id:b.entityId,value:b.entityName}),a.searchCriteria.eventType?g.eventType=a.searchCriteria.eventType:b&&b.eventType&&(g.eventType=b.eventType),a.searchCriteria.eventName&&a.searchCriteria.eventName.id?g.eventName=a.searchCriteria.eventName:b&&b.event&&(g.eventName=b.event),g.appDate=a.searchCriteria.apptDate,n.isNullOrEmpty(b)||n.isNullOrEmpty(b.organizationLocationId)?a.WSAppoinrmentList[0]&&(g.orgLocation=a.WSAppoinrmentList[0].organizationLocationId,g.locationName=a.WSAppoinrmentList[0].locationName):(g.orgLocation=b.organizationLocationId,g.locationName=b.locationName),d.go(c,g)},a.setAppDataToAppointmentForm=function(b){a.WSAppointment={},b.id&&(a.WSAppointment.id=b.id),b.eventId&&(/*$scope.getCalendarEventDetails(responseData.eventId);*/
a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:b.eventId}}),b.apptDate?(a.WSAppointment.apptDate=i("timestampToDate")(b.apptDate,"MM/dd/yyyy"),a.isAppoinmentDateDisabled=!0):a.isAppoinmentDateDisabled=!1,b.apptStartTime?(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+b.apptStartTime),a.isStartTimeDisabled=!0):a.isStartTimeDisabled=!1,b.apptEndTime?(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+b.apptEndTime),a.isEndTimeDisabled=!0):a.isEndTimeDisabled=!1,b.slotId?(a.WSAppointment.slotId=b.slotId,a.displayId=b.slotId,a.isSlotBased=!0):a.isSlotBased=!1,b.isFollowUp&&(a.WSAppointment.isFollowUp=b.isFollowUp),b.isRecurring&&(a.WSAppointment.isRecurring=b.isRecurring,a.isRecurring=b.isRecurring),b.serviceType&&b.serviceType.id&&(a.WSAppointment.serviceType=b.serviceType),b.problemDescription&&(a.WSAppointment.problemDescription=b.problemDescription),b.specificDoctor&&b.specificDoctor.id&&(a.WSAppointment.specificDoctor=b.specificDoctor),b.user&&b.user.id&&(a.WSAppointment.userName=b.user),b.onBehalfOf&&b.onBehalfOf.id?a.WSAppointment.onBehalfOf=b.onBehalfOf:b.onBehalfOfName&&(a.WSAppointment.onBehalfOf={value:b.onBehalfOfName}),b.onBehalfOfCellPhone&&(a.WSAppointment.onBehalfOfCellPhone=b.onBehalfOfCellPhone),b.onBehalfOfAddress&&(a.WSAppointment.onBehalfOfAddress=b.onBehalfOfAddress),b.isNewUHID&&(a.WSAppointment.isNewUHID=b.isNewUHID),b.UHID&&($scopeWSAppointment.UHID=b.UHID),b.isFreeVisit?(a.WSAppointment.isFreeVisit=b.isFreeVisit,a.isFreeVisitDisabled=!0):a.isFreeVisitDisabled=!1,b.orgLoc&&b.orgLoc.id&&(a.WSAppointment.orgLocId=b.orgLoc.id)},a.getCheckInOutAllotment=function(c,d){n.isNullOrEmpty(c)||(b.showSpinner=!0,w.getCheckInOutAllotment(c,function(c){b.showSpinner=!1,n.isNullOrEmpty(c.status)||(a.checkInOutInfo=c.status.code,"CHECKEDOUT"==d&&"CHECKED_OUT"!=a.checkInOutInfo||"CHECKEDIN"==d&&"NEW"==a.checkInOutInfo||"CHECKEDOUT"!=d&&"CHECKEDIN"!=d?a.isSaveHide=!1:a.isSaveHide=!0),a.setDataToCheckInOutAllotment(c,d)}))},a.setDataToCheckInOutAllotment=function(b,c){n.isEmpty(b)||(a.WSAppointment.billIdWithResidualFS=b.billIdWithResidualFS,a.wetherUserExist=b.wetherUserExist,/*if (!$scope.wetherUserExist) {
    $scope.checkUsersMobileNo(responseData.patientPhoneNumber);
}*/
//$scope.WSAppointment = angular.copy(responseData);
b.entityType&&b.entityType.id&&(a.WSAppointment.entityType=b.entityType,"CAL_ORGANIZATION_USER"==b.entityType.code?a.isOrgUser=!0:a.isOrgUser=!1,"CAL_PROCESS"==b.entityType.code?a.isProcessEntity=!0:a.isProcessEntity=!1),b.entityName&&b.entityName.id&&(a.WSAppointment.entityName=b.entityName,"CAL_PROCESS"==b.entityType.code&&(a.forwardedTo={queryUrl:"GET_PROFESSIONAL_FORWARDED_TO",queryParameter:{processId:b.entityName.id}})),b.eventType&&b.eventType.id&&(a.WSAppointment.eventType=b.eventType),b.eventName&&b.eventName.id&&(a.WSAppointment.eventName=b.eventName),b.apptDate&&(a.WSAppointment.apptDate=i("timestampToDate")(b.apptDate,"MM/dd/yyyy")),b.apptStartTime&&(a.WSAppointment.apptStartTime=b.apptStartTime),b.checkInTime?a.WSAppointment.checkInTime=new Date(a.WSAppointment.apptDate+" "+b.checkInTime):a.WSAppointment.checkInTime=new Date,b.checkOutTime&&(a.WSAppointment.checkOutTime=new Date(a.WSAppointment.apptDate+" "+b.checkOutTime)),"CHECKEDOUT"!==c||b.checkOutTime||(a.WSAppointment.checkOutTime=new Date),b.uhidNumber&&(a.WSAppointment.uhidNumber=b.uhidNumber),b.patientPhoneNumber&&(a.WSAppointment.patientPhoneNumber=b.patientPhoneNumber),b.patientAddress&&(a.WSAppointment.patientAddress=b.patientAddress),b.patient&&b.patient.id&&(a.WSAppointment.patient=b.patient),b.patientId&&(a.patientId=b.patientId,a.WSAppointment.uhidNumber=a.patientId),b.serviceType&&b.serviceType.id?(a.WSAppointment.serviceType=b.serviceType,a.showServiceSearch=!1):a.showServiceSearch=!0,b.tokenNumber&&(a.WSAppointment.tokenNumber=b.tokenNumber,a.isToken=!0),b.tokenIssuedBy&&b.tokenIssuedBy.id&&(a.WSAppointment.tokenIssuedBy=b.tokenIssuedBy),b.allocatedTo&&b.allocatedTo.id&&(a.WSAppointment.allocatedTo=b.allocatedTo),b.allocatedBy&&b.allocatedBy.id,b.forwardedTo&&b.forwardedTo.id&&(a.WSAppointment.forwardedTo=b.forwardedTo),b.forwardedBy&&b.forwardedBy.id&&(a.WSAppointment.forwardedBy=b.forwardedBy),b.allocatedOn,b.forwardedOn&&("FORWARDED"===c?a.WSAppointment.forwardedOn=i("date")(new Date,"HH:mm:ss"):a.WSAppointment.forwardedOn=b.forwardedOn),b.tokenIssuedAt&&(a.WSAppointment.tokenIssuedAt=i("timestampToDate")(b.tokenIssuedAt,"MM/dd/yyyy")),b.transactionId&&(a.WSAppointment.transactionId=b.transactionId),b.tokenGenerated&&(a.WSAppointment.tokenGenerated=b.tokenGenerated),b.paymentToBeTaken&&(a.WSAppointment.paymentToBeTaken=b.paymentToBeTaken,"CHECKEDIN"===c&&"AT_CHECKIN"==a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"===c&&"AT_CHECKOUT"==a.WSAppointment.paymentToBeTaken?a.isServiceRequired=!0:a.isServiceRequired=!1),b.billPaid?a.WSAppointment.billPaid=b.billPaid:a.WSAppointment.billPaid=!1,b.isBillable?a.WSAppointment.isBillable=b.isBillable:a.WSAppointment.isBillable=!1,b.followUp?a.WSAppointment.isFollowUp=b.followUp:a.WSAppointment.isFollowUp=!1,b.freeVisit?a.WSAppointment.isFreeVisit=b.freeVisit:a.WSAppointment.isFreeVisit=!1,b.newUhid?a.WSAppointment.isNewUHID=b.newUhid:a.WSAppointment.isNewUHID=!1,b.walkin?a.WSAppointment.isWalkIn=b.walkin:a.WSAppointment.isWalkIn=!1,b.wetherUserExist?a.WSAppointment.wetherUserExist=b.wetherUserExist:a.WSAppointment.wetherUserExist=!1,b.location&&(a.location=b.location),b.organization&&(a.organization=b.organization),b.disease&&b.diseaseVariant&&(a.WSAppointment.wsTreatmentHistoryRelatedToAppointment.disease=b.disease,a.diseaseVariantList.push(b.diseaseVariant)),b.addressInfo&&(a.WSAppointment.addressInfo=b.addressInfo),"CHECKEDOUT"==c&&b.allocatedTo&&b.allocatedTo.id&&(a.WSAppointment.wsTreatmentHistoryRelatedToAppointment.doctor=b.allocatedTo,a.WSAppointment.wsTreatmentHistoryRelatedToAppointment.actionTaken=c),!a.WSAppointment.isFreeVisit&&("AT_CHECKIN"==a.WSAppointment.paymentToBeTaken||"AT_CHECKOUT"==a.WSAppointment.paymentToBeTaken),a.isRecordWalkIn?a.WSAppointment.isWalkIn=!0:a.isCheckIn&&(a.WSAppointment.isWalkIn=!1))},a.getAppointmentDetailsById=function(c,d){n.isNullOrEmpty(c)||(b.showSpinner=!0,v.getAppointmentDetailsById(c,function(e){b.showSpinner=!1,a.currentAppointmentData=e,a.setAppDataToAppointmentForm(e),a.getCheckInOutAllotment(c,d),"CHECKEDIN"==d?a.showCheckIn?a.showCheckIn=!a.showCheckIn:(a.showCheckIn=!0,a.showCheckOut=!1):"CHECKEDOUT"==d&&(a.showCheckOut?a.showCheckOut=!a.showCheckOut:(a.showCheckOut=!0,a.showCheckIn=!1))}))},a.manageCheckIn=function(b){a.showCheckInDiv?(a.showCheckInDiv=!a.showCheckInDiv,$("*[class*=showCheckin]").hide()):(a.showCheckInDiv=!0,$(".showCheckin"+b.id).show(),a.getAppointmentDetailsById(b.id,"CHECKEDIN"))},a.manageCheckout=function(b){a.isCheckout?(a.isCheckout=!1,$("*[class*=showCheckout]").hide()):(a.isCheckout=!0,$(".showCheckout"+b.id).show(),a.getAppointmentDetailsById(b.id,"CHECKEDOUT"))},a.startCall=function(b){localStorage.setItem("appmentData",angular.toJson(b));var c={};c.conversationLogId=b.conversationLogId,n.isFieldEmpty(a.searchCriteria.entityName)?f("info",h.instant("ENTITY_NOT_SELECTED")):(c.userId=a.searchCriteria.entityName.id,r.getConversationIdForAppointmentForDoc(c,function(a){
// $state.go("skypeHome", {
//     userId: angular.fromJson(baseService.getLoggedInUser()).id,
//     convId: successResp.response.convId.id,
//     convType: "APPOINTMENT",
//     userName: angular.fromJson(baseService.getLoggedInUser()).displayName
//     //apptData :row
// });
var b=d.href("skypeHome",{userId:angular.fromJson(k.getLoggedInUser()).id,convId:a.response.convId.id,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName});window.open(b,"_blank")},function(a){}))},a.validateCallMenu=function(a){return"CAL_PROCESS"==a.entityType&&"ALLOCATED"==a.apptStatusCode&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum||"CAL_ORGANIZATION_USER"==a.entityType&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum},a.getCityNameData=function(b){return a.requestData={},a.requestData.searchString=b,a.requestData.noOfSuggestions=H.smartSearchRecordLimit,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("GET_CITY_DISTRICT_BY_STRING",a.requestData),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.manageIssueToken=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageIssueToken(c.id,function(c){b.showSpinner=!1,f("success",h.instant("TOKEN_ISSUE_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageConsultationStarted=function(c,d){c&&(b.showSpinner=!0,o.validateStartConsultation(c,function(d){if(b.showSpinner=!1,""==d.successMessage)o.manageConsultationStarted(c.id,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_START_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1});else{var e=g.confirm().title(h.instant("CONFIRM_START_CUNSULTATION")).textContent(d.successMessage).ok(h.instant("OK")).cancel(h.instant("CANCEL"));g.show(e).then(function(){b.showSpinner=!0,o.confirmStartConsultation(c,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_START_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1})},function(){b.showSpinner=!1})}},function(a){b.showSpinner=!1}))},a.manageConsultationFinished=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageConsultationCompleted(c.id,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_FINISHED_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageFixAppointment=function(c){/*if ($scope.searchCriteria.entityType && $scope.searchCriteria.entityType.id &&
                $scope.searchCriteria.entityName && $scope.searchCriteria.entityName.id &&
                $scope.searchCriteria.eventType && $scope.searchCriteria.eventType.id &&
                $scope.searchCriteria.eventName && $scope.searchCriteria.eventName.id &&
                $scope.searchCriteria.apptDate) {

                $state.go('manageFixAppointment', {
                    type: 'add',
                    entityType: $scope.searchCriteria.entityType,
                    entityName: $scope.searchCriteria.entityName,
                    eventType: $scope.searchCriteria.eventType,
                    eventName: $scope.searchCriteria.eventName,
                    apptDate: $scope.searchCriteria.apptDate
                });
} else*/
a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.orgLocation&&a.searchCriteria.orgLocation.id?o.getCalendarByEntityId(a.searchCriteria.entityType.id,a.searchCriteria.entityName.id,a.searchCriteria.orgLocation.id,function(c){if(c.id&&null!=c.id){b.showSpinner=!0;var e={calendarId:c.id,entityTypeCode:a.searchCriteria.entityType.code,entityId:a.searchCriteria.entityName.id};r.getCalendarDetailsById(e,function(c){b.showSpinner=!1,"CAL_ORGANIZATION_USER"==a.searchCriteria.entityType.code?d.go("usercalendarview",{type:"regular",data:c}):"CAL_PROCESS"==a.searchCriteria.entityType.code?d.go("processcalendarview",{type:"regular",data:c}):"CAL_EQUIPMENT"==a.searchCriteria.entityType.code?d.go("equipmentcalendarview",{type:"regular",data:c}):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},function(a){b.showSpinner=!1})}},function(a){}):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},a.clear=function(){a.searchCriteria={},a.WSAppoinrmentList=[],a.totalItems=0,localStorage.removeItem("appointmentListFilter")},a.clearQuickSearch=function(){a.searchCriteria.entityName=null,a.searchCriteria.apptStatus=null,a.searchCriteria.eventName=null},a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchFixAppointment()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFixAppointment()};
//datatble config json
var Q={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(Q),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(b){a.canAllot=!0,a.canConsultationStart=!0,a.canIssueToken=!0,a.canForword=!0,a.canRecordDignosis=!0,a.loggedInUserDetails=k.getLoggedInUser(),a.locationCategory=angular.fromJson(localStorage.getItem("locationCategory")),a.WSClientExtraData={},a.guardianData={},t(function(){$(".appt-add-mn-btn").parent("div").addClass("appt-add-btn")},1e3);var d={};localStorage.getItem("appointmentListFilter")&&0!=c.loadFilter&&(d=angular.fromJson(localStorage.getItem("appointmentListFilter")),a.searchCriteria=d,a.searchFixAppointment());var e=k.getDefaultOrgLocation();if(n.isFieldEmpty(e)||(a.searchCriteria.orgLocation=e.orgLoc),c.event)q.getCalendarEventDetails(c.event.id,function(b){if(
//$scope.eventData = angular.fromJson(resp);
a.apptDetails=b,b.entityTypeDetails&&b.entityTypeDetails.id&&(0==c.loadFilter&&(a.searchCriteria.entityType=b.entityTypeDetails),"CAL_PROCESS"==a.searchCriteria.entityType.code)){var d={};d.eventId=c.event.id,d.userId=k.getLoggedInUser().id,o.getAccessRightsForProcess(d,function(b){a.processAccessRights=b.data,a.processAccessRights.canAllot||(a.canAllot=!1),a.processAccessRights.canExaminePatient||(a.canConsultationStart=!1),a.processAccessRights.canIssueToken||(a.canIssueToken=!1),a.processAccessRights.canForwardForOpinion||(a.canForword=!1),a.processAccessRights.canPrepareSummary||(a.canRecordDignosis=!1)},function(a){})}b.eventType&&b.eventType.id&&0==c.loadFilter&&(a.searchCriteria.eventType=b.eventType),b.id&&b.eventName&&0==c.loadFilter&&(a.searchCriteria.eventName={id:b.id,value:b.eventName}),a.appointmentType=b.appointmentType,c.apptDate&&0==c.loadFilter&&(a.searchCriteria.apptDate=i("timestampToDate")(c.apptDate,"MM/dd/yyyy")),c.entityName&&b.entityId&&0==c.loadFilter&&(a.searchCriteria.entityName={id:b.entityId,value:c.entityName}),a.searchFixAppointment()});else if(!localStorage.getItem("appointmentListFilter")&&0!=c.loadFilter){var f={};f.pickListCode="calendarEntityType",f.pickListItemCode="CAL_ORGANIZATION_USER",u.getPicklistWSByCode(f,function(b){a.searchCriteria.entityType=b.data;var c=k.getLoggedInUser();c&&c.userAccountStatusDTO&&1==c.userAccountStatusDTO.whetherDoctor&&(a.searchCriteria.entityName={id:c.id,value:c.displayName},a.searchFixAppointment())},function(a){}),a.searchCriteria.apptDate=i("timestampToDate")(new Date,"MM/dd/yyyy")}var g=k.getLocationCategory();n.isFieldEmpty(g)||("SERVICE_PROVIDER_HO"==g.code?a.showFwdTo=!0:a.showFwdTo=!1),a.currentLoggedInUserId=k.getLoggedInUser().id,$("*[class*=familyHistory]").hide(),$("*[class*=userAllergy]").hide(),$("*[class*=followupActions]").hide(),$("*[class*=userIncident]").hide(),$("*[class*=userSymptoms]").hide(),$("*[class*=diagnosticTest]").hide(),$("*[class*=showMedication]").hide(),$("*[class*=showUpload]").hide(),$("*[class*=showDisease]").hide(),$("*[class*=showCheckin]").hide(),$("*[class*=showCheckout]").hide(),t(function(){a.apptOpenTab=localStorage.getItem("apptOpenTab"),a.apptOpenTabRow=angular.fromJson(localStorage.getItem("apptOpenTabRow")),n.isNullOrEmpty(a.apptOpenTab)||n.isNullOrEmpty(a.apptOpenTabRow)||("diagnosticTest"==a.apptOpenTab?a.searchUserTest(a.apptOpenTabRow):"showDisease"==a.apptOpenTab?a.treatmentRecordDetails(a.apptOpenTabRow):"showMedication"==a.apptOpenTab?a.viewMedication(a.apptOpenTabRow):"showUpload"==a.apptOpenTab&&a.showUploadDownload(a.apptOpenTabRow),n.isNullOrEmpty(c)||n.isNullOrEmpty(c.keepLocalStorage)?(localStorage.removeItem("apptOpenTab"),localStorage.removeItem("apptOpenTabRow")):1!=c.keepLocalStorage&&(localStorage.removeItem("apptOpenTab"),localStorage.removeItem("apptOpenTabRow")))},4900)},a.viewFamilyHistory=function(b){if(a.showFamilyHistory)a.showFamilyHistory=!a.showFamilyHistory,$("*[class*=familyHistory]").hide();else{a.showFamilyHistory=!0,$(".familyHistory"+b.id).show();var c={};c.userId=b.patientId,c.pageNumber=1,c.recordsPerPage=1e3,C.getuserHistoryList(c,function(b){b&&(a.familyHistoryList=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}},a.addFamilyHistory=function(b){g.show({controller:"manageUserFamilyHistoryPopupCtrl",templateUrl:"app/modules/user-family-history/views/manage-user-family-history-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,familyHistory:null,mode:{mode:"add"},appointmentRef:b}}).then(function(b){a.WSHealthProfessionalsValues={}},function(c){var d={};d.userId=b.patientId,d.pageNumber=1,d.recordsPerPage=1e3,C.getuserHistoryList(d,function(b){b&&(a.familyHistoryList=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})})},a.generateBillForOrder=function(a){g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{WSAppointment:a,serviceTypeId:null,transactionId:a.pharmacyOrderTransactionId,appointmentId:a.id,locationId:a.organizationLocationId,apptDate:a.apptDate,event:a.event,entityName:null}})},a.saveCheckInOutAllotment=function(e,i,j,l){e.$valid&&(n.isFieldEmpty(j)||(a.WSAppointment.organizationLocationId=j,n.isFieldEmpty(c.locationName)||(a.locationName=c.locationName)),n.isFieldEmpty(a.WSAppointment.noOfPeriod)||n.isFieldEmpty(a.WSAppointment.periodType)||("Month"==a.WSAppointment.periodType?a.daysEquivalent=30*a.WSAppointment.noOfPeriod:"Week"==a.WSAppointment.periodType?a.daysEquivalent=7*a.WSAppointment.noOfPeriod:"Days"==a.WSAppointment.periodType&&(a.daysEquivalent=a.WSAppointment.noOfPeriod),n.isFieldEmpty(a.daysEquivalent)||(a.followUpDate=new Date(a.WSAppointment.apptDate),a.followUpDate.setDate(a.followUpDate.getDate()+parseInt(a.daysEquivalent)))),b.showSpinner=!0,n.isFieldEmpty(a.followUpDate)||(a.WSAppointment.followUpDate=a.followUpDate),n.isFieldEmpty(c.clientId)||(a.WSAppointment.clientId=c.clientId),n.isFieldEmpty(a.wetherUserExist)||(a.WSAppointment.whetherExistingUser=a.wetherUserExist,1==a.WSAppointment.wetherUserExist&&a.WSAppointment.patient&&a.WSAppointment.patient.id&&(a.WSAppointment.existingUserId=a.WSAppointment.patient.id)),n.isFieldEmpty(a.guardianData)||n.isFieldEmpty(a.guardianData.birthDate)||(a.WSAppointment.birthDate=a.guardianData.birthDate),n.isFieldEmpty(a.WSClientExtraData)||n.isFieldEmpty(a.WSClientExtraData.age)||(a.WSAppointment.age=a.WSClientExtraData.age),n.isFieldEmpty(a.guardianData)||n.isFieldEmpty(a.guardianData.guardianCheck)||(a.WSAppointment.hasGuardian=a.guardianData.guardianCheck),n.isNullOrEmpty(a.guardianData)||n.isNullOrEmpty(a.guardianData.guardian)||(a.WSAppointment.guardianId=a.guardianData.guardian.id,a.WSAppointment.guardianName=a.guardianData.guardian.value),n.isNullOrEmpty(a.isForwarded)?a.WSAppointment.isForwarded=!1:a.WSAppointment.isForwarded=a.isForwarded,a.WSAppointment.actionTaken=l,w.saveCheckInOutAllotment(a.WSAppointment,i,c.appointmentType,function(e){if(b.showSpinner=!1,a.disabledFormFields=!0,a.isSaveHide=!0,a.WSAppointment.id||(a.WSAppointment.id=e.response.appointmentId),!a.requestObject){var i=k.getLoggedInUser();a.requestObject={},a.requestObject.module="appointmentId",a.requestObject.moduleNameAndUser="findAttachmentByAppointmentAndUser",a.requestObject.moduleName="deleteAttachmentsByAppointmentIdAndDocId",a.requestObject.forId=a.WSAppointment.id,a.requestObject.userId=i.id}if(("CHECKEDIN"==l&&"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"==l&&"AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken||"CHECKEDIN"==l&&"AT_BOOKING"===a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"==l&&"AT_BOOKING"===a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"==l&&"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1==a.WSAppointment.isBillable)if(0==a.WSAppointment.billPaid){if(e.transactionId)if("CHECKEDOUT"==l)if(n.isFieldEmpty(a.WSAppointment.billId)){if(b.showSpinner=!1,!n.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!n.isNullOrEmpty(a.locationName))var j={id:a.WSAppointment.organizationLocationId,value:a.locationName};if(!n.isNullOrEmpty(a.WSAppointment.isFreeVisit)&&1==a.WSAppointment.isFreeVisit)var m=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==l||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:j,disableGenerateBill:m,transactionId:e.transactionId,appointmentId:e.appointmentId,serviceTypeId:a.WSAppointment.serviceType,locationId:a.WSAppointment.organizationLocationId,apptDate:a.WSAppointment.apptDate,event:a.WSAppointment.eventName,entityName:a.WSAppointment.entityName}})}else{var o=null;o=e.response?e.response.appointmentId:e.appointmentId?e.appointmentId:null,o&&w.setIsBilledOfAppointment(o,function(b){var c={};c.entityName=a.WSAppointment.entityName,c.apptDate=a.WSAppointment.apptDate,c.event=a.WSAppointment.eventName,d.go("managebill",{parentState:"APPOINTMENT",billId:successResponseObj.response,type:"view",createReceipt:!0,appointmentDetails:c})},function(a){}),b.showSpinner=!1}else{if(b.showSpinner=!1,f("success",h.instant("ADDED_SUCCESS")),!n.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!n.isNullOrEmpty(a.locationName))var j={id:a.WSAppointment.organizationLocationId,value:a.locationName};if(!n.isNullOrEmpty(a.WSAppointment.isFreeVisit)&&1==a.WSAppointment.isFreeVisit)var m=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:j,disableGenerateBill:m,transactionId:e.transactionId,appointmentId:e.appointmentId,serviceTypeId:a.WSAppointment.serviceType,locationId:a.WSAppointment.organizationLocationId,apptDate:a.WSAppointment.apptDate,event:a.WSAppointment.eventName,entityName:a.WSAppointment.entityName}})}}else{if(!n.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!n.isNullOrEmpty(a.locationName))var j={id:a.WSAppointment.organizationLocationId,value:a.locationName};var m=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:j,disableGenerateBill:m,transactionId:e.transactionId,appointmentId:e.appointmentId,serviceTypeId:a.WSAppointment.serviceType,locationId:a.WSAppointment.organizationLocationId,apptDate:a.WSAppointment.apptDate,event:a.WSAppointment.eventName,entityName:a.WSAppointment.entityName}})}else{if(1==a.WSAppointment.isBillable&&"RECORDWALKIN"==c.appointmentType&&("RECORDWALKIN"==c.appointmentType&&"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken||"RECORDWALKIN"==c.appointmentType&&"AT_BOOKING"===a.WSAppointment.paymentToBeTaken)&&1==a.WSAppointment.isBillable)if(0==a.WSAppointment.billPaid||n.isFieldEmpty(a.WSAppointment.billPaid)){if(b.showSpinner=!1,f("success",h.instant("ADDED_SUCCESS")),!n.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!n.isNullOrEmpty(a.locationName))var j={id:a.WSAppointment.organizationLocationId,value:a.locationName};a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e.response,WSAppointment:a.WSAppointment,organizationObj:j,disableGenerateBill:null,transactionId:e.transactionId,appointmentId:e.appointmentId,serviceTypeId:a.WSAppointment.serviceType,locationId:a.WSAppointment.organizationLocationId,apptDate:a.WSAppointment.apptDate,event:a.WSAppointment.eventName,entityName:a.WSAppointment.entityName}})}else{if(!n.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!n.isNullOrEmpty(a.locationName))var j={id:a.WSAppointment.organizationLocationId,value:a.locationName};var m=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e.response,WSAppointment:a.WSAppointment,organizationObj:j,disableGenerateBill:m,transactionId:e.transactionId,appointmentId:e.appointmentId,serviceTypeId:a.WSAppointment.serviceType,locationId:a.WSAppointment.organizationLocationId,apptDate:a.WSAppointment.apptDate,event:a.WSAppointment.eventName,entityName:a.WSAppointment.entityName}})}if(f("success",h.instant("RECORD_UPDATED_SUCCESSFULLY")),!n.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!n.isNullOrEmpty(a.locationName))var j={id:a.WSAppointment.organizationLocationId,value:a.locationName};if(!n.isNullOrEmpty(a.WSAppointment.isFreeVisit)&&1==a.WSAppointment.isFreeVisit)var m=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&g.show({controller:J,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:j,disableGenerateBill:m,transactionId:e.transactionId,appointmentId:e.appointmentId,serviceTypeId:a.WSAppointment.serviceType,locationId:a.WSAppointment.organizationLocationId,apptDate:a.WSAppointment.apptDate,event:a.WSAppointment.eventName,entityName:a.WSAppointment.entityName}})}("CHECKEDIN"!=l||"AT_BOOKING"!==a.WSAppointment.paymentToBeTaken||a.WSAppointment.billPaid&&1!=a.WSAppointment.billPaid)&&("CHECKEDIN"!=l||"AT_CHECKOUT"!==a.WSAppointment.paymentToBeTaken||a.WSAppointment.billPaid&&0!=a.WSAppointment.billPaid)&&("CHECKEDOUT"!=l||"AT_CHECKIN"!==a.WSAppointment.paymentToBeTaken||a.WSAppointment.billPaid&&1!=a.WSAppointment.billPaid)||d.reload()},function(a){b.showSpinner=!1,a.data&&a.data.messages&&a.data.messages.length>0?f("error",h.instant(a.data.messages[0])):f("error",h.instant("FAILED_TO_SAVE_RECORD"))},a.patientString))},a.forwardTo=function(a){var b=a;g.show({controller:L,templateUrl:"app/modules/appointment/views/forward-to-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{rowObject:b}}).then(function(a){a&&null!=a&&d.reload()},function(a){})},a.forwardedApptChecked=function(b){if(1==b){a.isOrgUser&&(a.searchCriteria.entityName=null);var c={};c.code="APPOINTMENT_STATUS",l.getData(m.getParameterizedUrl("GET_APPOINTMENT_STATUS",c),null,function(b){a.getStatus=angular.fromJson(b.data),angular.forEach(a.getStatus,function(b,c){"FORWARDED"==b.code&&(a.searchCriteria.apptStatus=b)})},function(a){})}else a.searchCriteria.apptStatus=null,a.isOrgUser&&(a.loggedInUserDetails.userAccountStatusDTO.whetherDoctor||a.loggedInUserDetails.userAccountStatusDTO.whetherSupportServiceProfessional)&&(a.searchCriteria.entityName={id:a.loggedInUserDetails.id,value:a.loggedInUserDetails.displayName})},a.forwardedToMeChanged=function(b){a.forwardedApptChecked(b),1==b?(a.isOrgUser&&(a.searchCriteria.entityName=null),n.isNullOrEmpty(a.loggedInUserDetails)||n.isNullOrEmpty(a.loggedInUserDetails.userAccountStatusDTO)||(a.loggedInUserDetails.userAccountStatusDTO.whetherDoctor||a.loggedInUserDetails.userAccountStatusDTO.whetherSupportServiceProfessional||a.loggedInUserDetails.userAccountStatusDTO.whetherLabTechnician||a.loggedInUserDetails.userAccountStatusDTO.whetherPharmacyUser)&&(a.searchCriteria.allocatedForwarded={id:a.loggedInUserDetails.id,value:a.loggedInUserDetails.displayName}),a.searchFixAppointment()):(a.searchCriteria.apptStatus=null,a.searchCriteria.allocatedForwarded=null,a.isOrgUser&&(a.loggedInUserDetails.userAccountStatusDTO.whetherDoctor||a.loggedInUserDetails.userAccountStatusDTO.whetherSupportServiceProfessional||a.loggedInUserDetails.userAccountStatusDTO.whetherLabTechnician||a.loggedInUserDetails.userAccountStatusDTO.whetherPharmacyUser)&&(a.searchCriteria.entityName={id:a.loggedInUserDetails.id,value:a.loggedInUserDetails.displayName}),a.searchFixAppointment())},a.showSystemSummary=function(a){d.go("systemsummary",{rowObject:a})},a.viewUserIncident=function(b){if(a.showUserIncident)a.showUserIncident=!a.showUserIncident,$("*[class*=userIncident]").hide();else{a.showUserIncident=!0,$(".userIncident"+b.id).show();var c={};c.userId=b.patientId,c.pageNumber=1,c.recordsPerPage=1e3,E.fetchRecords(c,function(b){b&&(a.userIncidentList=b.data)},function(a){})}},a.addUserIncident=function(b){g.show({controller:"manageUserIncidentPopupCtrl",templateUrl:"app/modules/user-incident/views/manage-user-incident-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,userIncident:null,mode:{mode:"add"},appointmentRef:b}}).then(function(b){a.WSHealthProfessionalsValues={}},function(c){var d={};d.userId=b.patientId,d.pageNumber=1,d.recordsPerPage=1e3,E.fetchRecords(d,function(b){b&&(a.userIncidentList=b.data)},function(a){})})},a.viewUserIncidentById=function(b){E.getUserIncidentById(b.id,function(b){g.show({controller:"manageUserIncidentPopupCtrl",templateUrl:"app/modules/user-incident/views/manage-user-incident-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,userIncident:b,mode:{mode:"view"},appointmentRef:null}}).then(function(a){},function(a){})},function(a){})},a.editUserIncidentById=function(b){E.getUserIncidentById(b.id,function(b){g.show({controller:"manageUserIncidentPopupCtrl",templateUrl:"app/modules/user-incident/views/manage-user-incident-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,userIncident:b,mode:{mode:"edit"},appointmentRef:null}}).then(function(a){},function(a){})},function(a){})},a.deleteUserIncidentById=function(a){a.id&&E.deleteUserIncidentById(a.id,function(a){f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")),d.reload()},function(a){})},a.viewUserSymptoms=function(b){a.showUserSymptoms?(a.showUserSymptoms=!a.showUserSymptoms,$("*[class*=userSymptoms]").hide()):(a.showUserSymptoms=!0,$(".userSymptoms"+b.id).show(),a.getUserSymptomList(b))},a.getUserSymptomList=function(b){var c={};c.userId=b.patientId,c.pageNumber=1,c.recordsPerPage=1e3,F.getUserSymptomList(c,function(b){b&&(a.userSymptomList=b.data)},function(a){})},a.addUserSymptom=function(b){g.show({controller:"manageUserSymptomsPopupCtrl",templateUrl:"app/modules/user-symptom/view/manage-user-symptoms-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,userSymptom:null,mode:{mode:"add"},appointmentRef:b}}).then(function(a){},function(c){a.getUserSymptomList(b)})},a.viewUserSymptomById=function(b){G.getSymptomById(b.id,function(b){b&&g.show({controller:"manageUserSymptomsPopupCtrl",templateUrl:"app/modules/user-symptom/view/manage-user-symptoms-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,userSymptom:b,mode:{mode:"view"},appointmentRef:null}}).then(function(a){},function(a){})},function(a){})},a.editUserSymptomById=function(b){G.getSymptomById(b.id,function(b){b&&g.show({controller:"manageUserSymptomsPopupCtrl",templateUrl:"app/modules/user-symptom/view/manage-user-symptoms-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:null,isCurrentDate:a.isCurrentDate,baseService:k,userSymptom:b,mode:{mode:"edit"},appointmentRef:null}}).then(function(a){},function(a){})},function(a){})},a.createTestOrder=function(b){var c={};c.appointmentId=b.id,l.postData(m.getParameterizedUrl("CREATE_TEST_FROM_PRESCRIPTION",c),null,function(c){f("success",h.instant("DIAGNOSTIC_TEST_ORDER_ADDED_SUCCESSFULLY"));var d=b.id;a.viewDocument(c.data.response,c.data.response.documentType.type,c.data.response.documentType.subType,d)},function(a){f("error",h.instant("ERROR_WHILE_ADDING_DIAGNOSTIC_TEST_ORDER"))})},a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")},a.showSummary=function(a,b){var c={};c.rowObject=a,c.selectedCat=b,/*$state.go('summarydata', {
                rowObject: row,
                selectedCat: selectedCat
            });*/
g.show({controller:"SummaryDataCtrl",templateUrl:"app/modules/appointment/views/clinical-data-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{stateObj:c}})},a.addEditAppointmentSummary=function(b){if(b.appointmentSummary){var c={};c=b.appointmentSummary,o.getSummaryById(c,function(c){a.summarydata1=c.data,g.show({controller:"AppointmentSummaryCtrl",templateUrl:"app/modules/appointment/views/appointment-summary.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{summaryObj:c.data,appointmentId:{id:b.id}}}).then(function(a){},function(a){a&&d.reload()})},function(a){})}else g.show({controller:"AppointmentSummaryCtrl",templateUrl:"app/modules/appointment/views/appointment-summary.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{summaryObj:null,appointmentId:{id:b.id}}}).then(function(a){},function(a){a&&d.reload()})},a.refillMedication=function(c,d){var e={};e.medication={id:d.id},e.appointment={id:c.id},e.isRefill=!0,l.postData(m.getUrl("REFILL_MEDICATION"),e,function(d){if(d&&d.data){b.showSpinner=!1;
// $state.reload();
var e={};a.apptPatientId=c.patientId,/*filterVaccine.current = 'current';*/
e.pageNumber=1,e.recordsPerPage=1e3,e.user=c.patientId,e.appointmentId=c.id,e.excludeAppointment=!1,x.fetchRecords(e,function(b){b&&t(function(){a.medicationList=b.data},100)},function(a){})}},function(a){b.showSpinner=!1})},a.getSummaryPDF=function(c){var d={};d.id=c.id,d.locId=c.organizationLocationId,l.getData(m.getParameterizedUrl("GET_APPOINTMENT_SOAP_PDF",d),null,function(d){if(d&&d.data){b.showSpinner=!1;var e=c.id;a.viewDocument(d.data,d.data.documentType.type,d.data.documentType.subType,e)}},function(a){b.showSpinner=!1})},a.getPatientList=function(b){return n.isEmpty(a.searchCriteria.orgLocation)||n.isNullOrEmpty(a.searchCriteria.orgLocation.id)?void f("warning",h.instant("SELECT_ORG_LOC_FIRST")):o.getRegisteredOnBehalfOfList(b,a.searchCriteria.orgLocation.id,{orgLocPermission:p.COMPLAINT_ATTCH_ADD})},a.generateBill=function(b){var c={};c.raisedOn="INDIVIDUAL",c.whetherRefundAllowed=!0,c.fromCheckIn=!0;var e={};e.transactionId=b.pharmacyOrderTransactionId,l.postData(m.getUrl("GET_ADHOC_BILL_SETUP"),e,function(c){if(!n.isFieldEmpty(c.data)){/* SERVER params to be sent */
var e=angular.copy(c.data);/*UI params to be sent*/
e.fromCheckIn=!0,e.raisedOn="INDIVIDUAL",e.whetherRefundAllowed=!0,e.transaction={id:b.pharmacyOrderTransactionId},n.isNullOrEmpty(b.organizationLocationId)||n.isNullOrEmpty(b.locationName)||(e.ownerLocationId={id:b.organizationLocationId,value:b.locationName}),n.isNullOrEmpty(b.patientId)||n.isNullOrEmpty(b.patientName)||(e.raisedOnDetails={raisedOnUserId:b.patientId,raisedOnName:b.patientName},e.raisedOnUserId={id:b.patientId,value:b.patientName});var f={};f.onBehalfofUser={id:b.patientId,value:b.patientName},f.organizationLocation={id:b.organizationLocationId},l.postData(m.getUrl("GET_ALL_UNBUILD_TRANSACTIONS"),f,function(c){if(c.data&&c.data.length>1)g.show({controller:M,templateUrl:"app/modules/billing/views/unbilled-transaction-list.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{transactionList:c.data,paramData:e,currentTransaction:b.pharmacyOrderTransactionId}});else if(c.data&&1==c.data.length){var f=c.data[0];a.selectedTransaction=[],a.selectedTransaction.push(f),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),d.go("createbill",{type:"DEBIT",data:e,feeHeadAmnt:"YES",pageState:"CREATE",serviceTypeList:b.serviceTypes,transactionList:a.selectedTransaction})}},function(a){})}},function(a){})},a.init()}]),angular.module("paripal.appointmentModule").controller("AppointmentNotesCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$filter","serverSidePagination","userStatusService","httpService","urlService","utilService","appointmentsUploadDownloadService","emergencyUploadListService","commonConstants","fileOperations","manageFixAppointmentService","baseService","commonCalendarService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.WSApptUserDetails={},a.commonConstants=p;var u=function(){/*checkPageState();*/
var b=s.getLoggedInUser();if("mycalendarview"==c.callingUrl&&(a.isIndividualUser=!0),b)if(a.stateType=c.type,"view"==a.stateType&&(a.isViewMode=!0),a.stateParamValue=c.appointmentId,"true"==c.isCustomAppointment){var e={appointmentId:c.appointmentId};t.viewCustomAppointment(e,function(b){a.appointmentDetails=b},function(a){})}else r.getAppointmentDetailsById(c.appointmentId,function(b){a.appointmentDetails=b},function(a){});else if(c.otp&&c.accessKeyId){var g={};g.accessKeyId=c.accessKeyId,g.currentOTP=c.otp,k.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",g),null,function(b){b&&1==b.data?(a.stateType=c.type,"view"==a.stateType&&(a.isViewMode=!0),a.stateParamValue=c.appointmentId,r.getAppointmentDetailsById(c.appointmentId,function(b){a.appointmentDetails=b},function(a){})):(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))})}else f("error","OTP Has Expired Or Invalid Access"),d.go("login")};/*function checkPageState() {
        if (!utilService.isFieldEmpty($stateParams.data)) {
            angular.copy($stateParams.data, $scope.WSApptUserDetails);
            if (!utilService.isFieldEmpty($scope.WSApptUserDetails.apptDate)) {
                $scope.WSApptUserDetails.apptDate = $filter('timestampToDate')($scope.WSApptUserDetails.apptDate);
            }
        }
    };*/
a.getCliniclList=function(){if(c.appointmentId||(a.clinicalNotes=[]),c.treatmentRecId){var d={};d.recordId=c.treatmentRecId}else{var d={};d.appointmentId=c.appointmentId}var e=l.getParameterizedUrl("GET_CLINICAL_NOTES_FOR_APPOINTMENT",d);if(e)return k.getData(e,null,function(c){if(c&&c.data)return a.clinicalNotes=c.data,b.showSpinner=!1,a.clinicalNotes},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||(f("error",$translate.instant(a.data.messages[0])),b.showSpinner=!1)})},a.selectedUser=function(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")},u()}]),angular.module("paripal.appointmentModule").controller("AppointmentNotesPopupCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$filter","serverSidePagination","userStatusService","httpService","urlService","utilService","appointmentsUploadDownloadService","emergencyUploadListService","commonConstants","fileOperations","manageFixAppointmentService","baseService","commonCalendarService","pageType","appointmentId","diseaseVariant",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";a.WSApptUserDetails={},a.commonConstants=p,a.appointmentId=v;w&&(a.diseaseVariant=w),a.cancel=function(){g.cancel()};var x=function(){/*checkPageState();*/
var b=s.getLoggedInUser();if("mycalendarview"==c.callingUrl&&(a.isIndividualUser=!0),b)if(c.type?a.stateType=c.type:u?a.stateType=u:a.stateType="view","view"==a.stateType&&(a.isViewMode=!0),c.appointmentId?a.stateParamValue=c.appointmentId:a.appointmentId&&(a.stateParamValue=a.appointmentId.id),"true"==c.isCustomAppointment){var e={appointmentId:c.appointmentId};t.viewCustomAppointment(e,function(b){a.appointmentDetails=b},function(a){})}else r.getAppointmentDetailsById(a.stateParamValue,function(b){a.appointmentDetails=b},function(a){});else if(c.otp&&c.accessKeyId){var g={};g.accessKeyId=c.accessKeyId,g.currentOTP=c.otp,k.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",g),null,function(b){b&&1==b.data?(a.stateType=c.type,"view"==a.stateType&&(a.isViewMode=!0),a.stateParamValue=c.appointmentId,r.getAppointmentDetailsById(c.appointmentId,function(b){a.appointmentDetails=b},function(a){})):(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))})}else f("error","OTP Has Expired Or Invalid Access"),d.go("login")};/*function checkPageState() {
        if (!utilService.isFieldEmpty($stateParams.data)) {
            angular.copy($stateParams.data, $scope.WSApptUserDetails);
            if (!utilService.isFieldEmpty($scope.WSApptUserDetails.apptDate)) {
                $scope.WSApptUserDetails.apptDate = $filter('timestampToDate')($scope.WSApptUserDetails.apptDate);
            }
        }
    };*/
a.getCliniclList=function(){if(c.appointmentId||v||(a.clinicalNotes=[]),c.treatmentRecId){var d={};d.recordId=c.treatmentRecId}else{var d={};c.appointmentId?d.appointmentId=c.appointmentId:a.appointmentId&&(d.appointmentId=a.appointmentId.id)}var e=l.getParameterizedUrl("GET_CLINICAL_NOTES_FOR_APPOINTMENT",d);if(e)return k.getData(e,null,function(c){if(c&&c.data)return a.clinicalNotes=c.data,b.showSpinner=!1,a.clinicalNotes},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||(f("error",$translate.instant(a.data.messages[0])),b.showSpinner=!1)})},a.selectedUser=function(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")},x()}]),angular.module("paripal.appointmentModule").controller("AppointmentSummaryCtrl",["$scope","$mdDialog","$filter","baseService","orbeonFormRunner","httpService","urlService","utilService","notify","$translate","summaryObj","appointmentId","appointmentsListService","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";CKEDITOR.editorConfig=function(a){a.language="en",a.uiColor="#F7B42C",a.height=300,a.toolbarCanCollapse=!0},a.cancel=function(){b.cancel()},a.addUpdateSummaryRecord=function(){var c={};if(a.summary&&""!=a.summary&&l){c.summary=a.summary;var d=a.summary.replace(/<\/?[^>]+(>|$)/g,"");if(d=d.replace(/\&nbsp;/g,""),d=d.substring(0,200),d=d.replace("\n"," "),c.summaryText=d,"edit"==a.pageState)c.appointmentId=l.id,c.id=a.summaryId,m.updateAppointmentSummary(c,function(a){i("success",j.instant("SUMMARY_UPDATED_SUCCESSFULLY")),b.cancel("SUCCESS")},function(a){});else{c.id=l.id;var d=a.summary.replace(/<\/?[^>]+(>|$)/g,"");d=d.replace(/\&nbsp;/g,""),d=d.substring(0,200),c.summaryText=d,m.saveAppointmentSummary(c,function(a){i("success",j.instant("SUMMARY_ADDED_SUCCESSFULLY")),b.cancel("SUCCESS")},function(a){})}}},a.init=function(){a.summary="",k?(a.summaryObj=k,a.pageState="edit",console.log(a.summaryObj),n(function(){a.summary=a.summaryObj.summary},1e3),a.summaryId=a.summaryObj.id):a.pageState="add"},a.init()}]),angular.module("paripal.appointmentModule").controller("AppointmentUploadDownloadCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$filter","serverSidePagination","userStatusService","httpService","urlService","utilService","appointmentsUploadDownloadService","emergencyUploadListService","commonConstants","fileOperations","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(){m.isFieldEmpty(c.data)||(angular.copy(c.data,a.WSApptUserDetails),m.isFieldEmpty(a.WSApptUserDetails.apptDate)||(a.WSApptUserDetails.apptDate=h("timestampToDate")(a.WSApptUserDetails.apptDate)))}a.WSApptUserDetails={},a.commonConstants=p;var t=function(){"view"===c.type&&(a.hideUploadBtn=!0,a.hideDeleteBtn=!0),JSON.parse(localStorage.getItem("uploadFrmSkype"))&&(a.appointmentupload=angular.fromJson(localStorage.getItem("uploadFrmSkype")),
//localStorage.removeItem("uploadFrmSkype");
angular.copy(a.appointmentupload,a.WSApptUserDetails),m.isFieldEmpty(a.WSApptUserDetails.apptDate)||(a.WSApptUserDetails.apptDate=h("timestampToDate")(a.WSApptUserDetails.apptDate))),s(),a.requestObject={},a.requestObject.module="appointmentId",a.requestObject.moduleNameAndUser="findAttachmentByAppointmentAndUser",a.requestObject.moduleName="deleteAttachmentsByAppointmentIdAndDocId",a.requestObject.forId=a.WSApptUserDetails.appointmentId,/* IMPORTANT - commented out the line below for passing userId as 0 so that all documents can be seen          without user filter at init */
/*  $scope.requestObject.userId = userStatusService.userData().userId;  */
m.isNullOrEmpty(a.WSApptUserDetails)||m.isNullOrEmpty(a.WSApptUserDetails.userId)?a.requestObject.userId=0:a.requestObject.userId=a.WSApptUserDetails.userId;var b={pathName:"findUsersByAppointmentId",id:a.WSApptUserDetails.appointmentId};n.getUsersByAppointmentOrRequestId(b,function(b){a.WSApptUserDetails.userList=b})};a.selectedUser=function(d){a.requestObject.userId=d,"view"!==c.type&&(d!=r.getLoggedInUser().id?a.hideDeleteBtn=!0:a.hideDeleteBtn=!1),b.$broadcast("getAttachmentList")},/*$scope.fileChange = function (fileElement) {
        $scope.files = [];
        var fileElement = angular.element(fileElement);
        if (fileElement) {
            var fileInput = angular.element(document.querySelector('input#fileInput'));
            var files = fileInput[0].files;
            angular.forEach(files, function (file, index) {
                var fileObject = new Object();
                fileObject.selectedFileObject = file;
                fileObject.fileName = file.name;
                $scope.files.push(fileObject);
            });
            fileInput.val(null);
        }
        if ($scope.files && $scope.files.length > 0) {
            $scope.saveAllDocuments($scope.files);
        }
    };

    $scope.saveAllDocuments = function (files) {
        var documentDetails = {};
        documentDetails.documentType = {};
        documentDetails.documentType.type = commonConstants.documentTypes.transaction;
        documentDetails.documentType.subType = commonConstants.documentSubTypes.appointment_transaction;
        documentDetails.documentType.id = 24;
        $scope.fileUploadSpinner = true;
        fileOperations.saveAllDocuments(documentDetails, false, files, function (successDocumentResponse) {
            if (files && files.length > 0 && successDocumentResponse) {
                $scope.saveTransactionAttachment(files, documentDetails, successDocumentResponse);
            }
        }, function (errorResponse) {
            $scope.fileUploadSpinner = false;
        });
    };

    $scope.saveTransactionAttachment = function (files, documentDetails, successDocumentResponse) {
        var WSTransactionAttachmentsDTO = {};
        if (!utilService.isFieldEmpty($scope.transactionId)) {
            WSTransactionAttachmentsDTO.transactionId = $scope.transactionId;
        }
        WSTransactionAttachmentsDTO.documentIds = [];
        for (var i = 0; i < successDocumentResponse.response.length; i++) {
            WSTransactionAttachmentsDTO.documentIds.push(successDocumentResponse.response[i].id);
        }
        WSTransactionAttachmentsDTO.appointmentId = $scope.WSApptUserDetails.appointmentId;
        emergencyUploadListService.saveTransactionAttachment(WSTransactionAttachmentsDTO, function (successTransactionResponse) {
            if (files && files.length > 0 && successDocumentResponse) {

                $scope.uploadFile(files, documentDetails, successDocumentResponse, WSTransactionAttachmentsDTO);
            }
        }, function (errorResponse) {
            $scope.fileUploadSpinner = false;
            emergencyUploadListService.deleteAllDocument(WSTransactionAttachmentsDTO.documentIds,
                function (successResponse) {},
                function (error) {});
        });
    };

    $scope.uploadFile = function (selectedFiles, documentDetails, successDocumentResponse, WSTransactionAttachmentsDTO) {
        var paramObject = new Object();
        paramObject.docType = documentDetails.documentType.type;
        paramObject.docSubType = documentDetails.documentType.subType;
        paramObject.recordId = $scope.WSApptUserDetails.appointmentId;

        if (successDocumentResponse.response) {
            paramObject.resourceDetails = JSON.stringify(successDocumentResponse.response);
        };
        fileOperations.uploadMultipleFiles(paramObject, selectedFiles, function (successResponse) {
                $scope.fileUploadSpinner = false;
                $rootScope.$broadcast('getAttachmentList');
            },
            function (errorResponse) {
                $scope.fileUploadSpinner = false;
                notify("Error", $translate.instant("ERROR_WHILE_UPLOADING"));
                emergencyUploadListService.deleteByTransactionIdAndDocIds(WSTransactionAttachmentsDTO, function (successResponse) {
                    emergencyUploadListService.deleteAllDocument(WSTransactionAttachmentsDTO.documentIds,
                        function (successResponse) {},
                        function (error) {});
                }, function (error) {});
            });
    };*/
t()}]),angular.module("paripal.appointmentModule").controller("AppointmentsListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","$filter","serverSidePagination","baseService","httpService","urlService","utilService","appointmentsListService","featurePrivilegeConstants","manageCalendarEventService","commonCalendarService","MakePrescriptionFactory","$timeout","manageRequestService","$cookies","skypeService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(a,b,d,e,f,g,i,j,k,o,p,q,r,s){function t(a,b,c,d,e,f,g,h){a.transactionList=f,a.selectedTransaction=[],a.currentTransaction=h,a.addRemoveTransaction=function(b){var c=!1;angular.forEach(a.selectedTransaction,function(d,e){d.transactionId==b.transactionId&&(a.selectedTransaction.splice(e,1),c=!0)}),0==c&&a.selectedTransaction.push(b)},a.createBill=function(){angular.forEach(a.transactionList,function(b,c){b.transactionId==a.currentTransaction&&a.selectedTransaction.push(b)}),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),b.cancel(),d.go("createbill",{type:"DEBIT",data:g,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})},a.cancel=function(){b.cancel()}}t.$inject=["$scope","$mdDialog","notify","$state","$rootScope","transactionList","paramData","currentTransaction"],a.cancel=function(){b.cancel()},a.later=function(){b.cancel()},a.prepareAdhocBill=function(){b.cancel();var c={};n.isNullOrEmpty(j)||(c.transactionId=j),n.isNullOrEmpty(k)||(c.appointmentId=k),n.isNullOrEmpty(o)||(c.serviceTypeId=o),n.isNullOrEmpty(p)||(c.locationId=p),c.whetherWalkinAppointment=!0,l.postData(m.getUrl("GET_ADHOC_BILL_SETUP"),c,function(d){if(n.isFieldEmpty(d.data))b.cancel();else{b.cancel();/* SERVER params to be sent */
var e=angular.copy(d.data);/* UI params to be sent */
e.fromCheckIn=!0,e.raisedOnDetails={raisedOnUserId:e.raisedOnUserId.id,raisedOnName:e.raisedOnUserId.value},e.transaction={id:c.transactionId};/*$state.go("createbill", {
                            type: "DEBIT",
                            data: paramData,
                            feeHeadAmnt: "YES",
                            pageState: 'CREATE',
                            isCreateReceipt: true
                        });*/
var f={};f.onBehalfofUser={id:e.raisedOnUserId.id,value:e.raisedOnUserId.value},f.organizationLocation={id:c.locationId},l.postData(m.getUrl("GET_ALL_UNBUILD_TRANSACTIONS"),f,function(d){if(d.data&&d.data.length>1)b.show({controller:t,templateUrl:"app/modules/billing/views/unbilled-transaction-list.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{transactionList:d.data,paramData:e,currentTransaction:c.transactionId}});else if(d.data&&1==d.data.length){var f=d.data[0];a.selectedTransaction=[],a.selectedTransaction.push(f),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),g.go("createbill",{type:"DEBIT",data:e,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})}},function(a){})}},function(a){})},a.generateBill=function(){b.cancel();var a={};a.transactionId=[],n.isNullOrEmpty(j)||a.transactionId.push(j),d.generateBill(a.transactionId,function(a){var c=null;c=n.isNullOrEmpty(k)?null:k,c&&e.setIsBilledOfAppointment(c,function(c){b.cancel();var d={};d.entityName=s,d.apptDate=q,d.event=r,g.go("managebill",{parentState:"APPOINTMENT",billId:a.response,type:"view",createReceipt:!0,appointmentDetails:d})},function(a){})},function(a){var d=b.confirm().title(h.instant("FEE_TYPE_NOT_FOUND_TITLE")).textContent(h.instant("APPOINTMENT_FEE_NOT_FOUND_BODY")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));b.show(d).then(function(){},function(){g.go("appointmentsList",c)})},{handleError:!1})}}function y(a,b,d,e,f,g){a.prescriptionList=d,a.cancel=function(){b.cancel()},a.viewPrescriptionCall=function(a){var d="PRESCRIPTION_REFERENCE_FORM",e=c;/*prevStateParam.stateName = "appointmentsList";*/
//         prevStateParam.data = {
//         };
b.cancel(),g.loadNewFormRunner(a.id,d,a.organizationLocation.id,1,e,null,0,null)}}function z(a){var b={};if(a.userId?b.userId=a.userId:b.userId=0,a.convId&&(b.convId=a.convId),a.userName&&(b.userName=a.userName),localStorage.setItem("skypeIssuedStatus",!0),a.startCall){var c;if("SKYPE"==a.usageType)c=d.href("skypeHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName});else{var e={};e.userId=b.userId,e.convId=b.convId,e.convType="APPOINTMENT",e.userName=angular.fromJson(k.getLoggedInUser()).displayName,
//$state.go("agoraHome",paramsObj);
c=d.href("agoraHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName});var f=window.open(c,"_blank");null==f||"undefined"==typeof f?alert('Please disable your pop-up blocker and click the "Open" link again.'):f.focus()}}else{var g;if("SKYPE"==a.usageType)d.go("skypeHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:b.userName});else{var e={};e.userId=b.userId,e.convId=b.convId,e.convType="APPOINTMENT",e.userName=b.userName,
//$state.go("agoraHome",paramsObj);
g=d.href("agoraHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:b.userName});var f=window.open(g,"_blank");null==f||"undefined"==typeof f?alert('Please disable your pop-up blocker and click the "Open" link again.'):f.focus()}}}function A(c){if(v.get("skype_access_token")&&g.show({templateUrl:"app/modules/skype-integration/views/skype-cookies-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,controller:["$scope","$location","baseConfig",function(a,b,c){a.cancel=function(){g.cancel()},a.clearCookies=function(){localStorage.setItem("skypeIssuedStatus",!1),v.remove("skype_access_token"),location.assign("https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+c.skypeRedirectUrl+"#/appointmentsList")}}]}),localStorage.skypeIssuedId){a.userData={},a.userData.userId=b.loggedInUserDetails.id,a.userData.convType="APPOINTMENT",localStorage.skypeIssuedId?a.userData.skypeIssuedId=localStorage.getItem("skypeIssuedId"):a.userData.skypeIssuedId=0;var e=m.getParameterizedUrl("CACHE_CLEAR_UPDATE",a.userData);if(e)return l.getData(e,null,function(a){var b={};c.userId?b.userId=c.userId:b.userId=0,c.convId&&(b.convId=c.convId),c.userName&&(b.userName=c.userName),w.issueSkypeId(b,function(a){if(a)if(localStorage.setItem("skypeIssuedStatus",!0),localStorage.setItem("skypeIssuedId",a.response.id),localStorage.setItem("skypeId",a.response.skypeId),localStorage.setItem("skypePassword",a.response.skypePassword),c.startCall){var e;if("SKYPE"==c.usageType)e=d.href("skypeHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName});else{var f={};f.userId=b.userId,f.convId=b.convId,f.convType="APPOINTMENT",f.userName=angular.fromJson(k.getLoggedInUser()).displayName,
//$state.go("agoraHome",paramsObj);
e=d.href("agoraHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName});var g=window.open(e,"_blank");null==g||"undefined"==typeof g?alert('Please disable your pop-up blocker and click the "Open" link again.'):g.focus()}}else{var h;if("SKYPE"==c.usageType)d.go("skypeHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:b.userName});else{var f={};f.userId=b.userId,f.convId=b.convId,f.convType="APPOINTMENT",f.userName=b.userName,
//$state.go("agoraHome",paramsObj);
h=d.href("agoraHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:b.userName});var g=window.open(h,"_blank");null==g||"undefined"==typeof g?alert('Please disable your pop-up blocker and click the "Open" link again.'):g.focus()}}},function(a){n.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},function(b){a.isSkypeCacheCleared=!0})}else{var i={};c.userId?i.userId=c.userId:i.userId=0,c.convId&&(i.convId=c.convId),c.userName&&(i.userName=c.userName),w.issueSkypeId(i,function(a){if(a)if(localStorage.setItem("skypeIssuedStatus",!0),localStorage.setItem("skypeIssuedId",a.response.id),localStorage.setItem("skypeId",a.response.skypeId),localStorage.setItem("skypePassword",a.response.skypePassword),c.startCall){var b;b="SKYPE"==c.usageType?d.href("skypeHome",{userId:i.userId,convId:i.convId,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName}):d.href("agoraHome",{userId:i.userId,convId:i.convId,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName});var e=window.open(b,"_blank");null==e||"undefined"==typeof e?alert('Please disable your pop-up blocker and click the "Open" link again.'):e.focus()}else{var f;if("SKYPE"==c.usageType)d.go("skypeHome",{userId:i.userId,convId:i.convId,convType:"APPOINTMENT",userName:i.userName});else{f=d.href("agoraHome",{userId:i.userId,convId:i.convId,convType:"APPOINTMENT",userName:i.userName});var e=window.open(f,"_blank");null==e||"undefined"==typeof e?alert('Please disable your pop-up blocker and click the "Open" link again.'):e.focus()}}},function(a){n.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})}}function B(a,b,c,d,e,f,g,i,j){a.fwdObj={},n.isNullOrEmpty(f.id)||g.getCheckInOutAllotment(f.id,function(b){e.showSpinner=!1,a.fwdDetails=b}),a.cancel=function(){b.hide()};/*$scope.forwardToList = [
                {
                    name: 'SELF',
                    value: 'whetherSelf'
                },
                {
                    name: 'HEALTH_PROFESSIONAL',
                    value: 'whetherHealthProfessional'
                },
                {
                    name: 'SUPPORT_SERVICE_PROFESSIONAL',
                    value: 'whetherSupportProfessional'
                },
                {
                    name: 'CHIEF_CLINICAL_CONSULTANT',
                    value: 'whetherChiefDoctor'
                },
                {
                    name: 'OTHER',
                    value: 'whetherOther'
                }
            ];*/
var k=angular.fromJson(localStorage.getItem("defaultOrg")),l=angular.fromJson(localStorage.getItem("defaultOrgLoc")),m=angular.fromJson(localStorage.getItem("loggedInUser"));a.forwardToSelected=function(b){var c={};return a.fwdObj.selectPerson="","whetherSelf"==b?c.whetherSelf=!0:c.whetherSelf=!1,"whetherHealthProfessional"==b?c.whetherHealthProfessional=!0:c.whetherHealthProfessional=!1,"whetherSupportProfessional"==b?c.whetherSupportProfessional=!0:c.whetherSupportProfessional=!1,"whetherChiefDoctor"==b?c.whetherChiefDoctor=!0:c.whetherChiefDoctor=!1,"whetherOther"==b?c.whetherOther=!0:c.whetherOther=!1,n.isNullOrEmpty(k)||(c.organizationId=k.id),n.isNullOrEmpty(l)||(c.organizationLocationId=l.id),n.isNullOrEmpty(m)||(c.userId=m.id),i.postData(j.getParameterizedUrl("FORWARD_USER_LIST"),c,function(b){return a.personList=angular.fromJson(b.data)},function(a){})},a.updateForwardTo=function(){var d={};n.isNullOrEmpty(f.organizationLocationId)||(d.organizationLocationId=f.organizationLocationId),d.actionTaken="FORWARDED",n.isNullOrEmpty(f.transactionId)||(d.transactionId=f.transactionId),n.isNullOrEmpty(f.startTime)||(d.checkInTime=f.startTime),n.isNullOrEmpty(f.patientId)||(d.onBehalfOfId=f.patientId),n.isNullOrEmpty(f.patientName)||(d.displayName=f.patientName),n.isNullOrEmpty(a.fwdDetails.patientPhoneNumber)||(d.cell1=a.fwdDetails.patientPhoneNumber),n.isNullOrEmpty(a.fwdDetails.patientAddress)||(d.onBehalfOfAddress=a.fwdDetails.patientAddress),n.isNullOrEmpty(a.fwdDetails.billPaid)||(d.whetherPaid=a.fwdDetails.billPaid),n.isNullOrEmpty(a.fwdDetails.walkin)||(d.isWalkIn=a.fwdDetails.walkin),n.isNullOrEmpty(a.fwdDetails.followUp)||(d.isFollowUp=a.fwdDetails.followUp),n.isNullOrEmpty(a.fwdDetails.isBillable)||(d.isBillable=a.fwdDetails.isBillable),/*if (!utilService.isNullOrEmpty($scope.fwdDetails.isBillable)) {
                    requestObj.isForwarded = rowObject.isBillable;
                }*/
n.isNullOrEmpty(a.fwdDetails.newUhid)||(d.isNewUHID=a.fwdDetails.newUhid),n.isNullOrEmpty(a.fwdDetails.freeVisit)||(d.isFreeVisit=a.fwdDetails.freeVisit),/*if (!utilService.isNullOrEmpty($scope.fwdDetails.tokenIssuedBy)) {
                    requestObj.tokenIssuedById = rowObject.tokenIssuedBy;
                }*/
n.isNullOrEmpty(a.fwdDetails.allocatedTo)||(d.allocatedToId=a.fwdDetails.allocatedTo.id),n.isNullOrEmpty(a.fwdObj.selectPerson)||(d.forwardedToId=a.fwdObj.selectPerson.userId),n.isNullOrEmpty(a.fwdObj.status)||(d.actionStatus=a.fwdObj.status),n.isNullOrEmpty(a.fwdDetails.forwardedBy)||(d.forwardedById=a.fwdDetails.forwardedBy.id),n.isNullOrEmpty(a.fwdDetails.forwardedOn)||(d.forwardedTime=a.fwdDetails.forwardedOn),n.isNullOrEmpty(a.fwdDetails.serviceType)||(d.serviceType=a.fwdDetails.serviceType),n.isNullOrEmpty(a.fwdDetails.wetherUserExist)||(d.whetherExistingUser=a.fwdDetails.wetherUserExist),i.putData(j.getParameterizedUrl("UPDATE_CHECK_IN_OUT_DETAILS",{appointmentId:f.id}),d,function(a){a&&a.data&&(c("success",h.instant("PATIENT_FORWARDED")),b.hide())},function(a){})}}function C(){a.queryUrl="FIND_ALL_PROCESSESS",a.queryParameter={orgLocationId:a.defaultUserLocation.id};var b=m.getParameterizedUrl(a.queryUrl,a.queryParameter);l.getData(b,null,function(b){b&&b.data&&(a.wsObjects=b.data,a.searchCriteria.entityName=a.wsObjects[0])},function(a){})}x.$inject=["$scope","$mdDialog","commonBillingService","manageCheckInOutAllotService","notify","$state","$rootScope","transactionId","appointmentId","serviceTypeId","locationId","apptDate","event","entityName"],y.$inject=["$scope","$mdDialog","prescriptionList","$filter","baseService","orbeonFormRunner"],B.$inject=["$scope","$mdDialog","notify","$state","$rootScope","rowObject","manageCheckInOutAllotService","httpService","urlService"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.showViewAppointmentMenu=!1,
//$scope.issueSkypeId = issueSkypeId;
a.issueSkypeIdForAgora=z,a.issueSkypeIdForSkype=A,a.getProcessName=C,b.showSpinner=!1,a.WSAppoinrmentList=[],
//$scope.orgLocPermission = featurePrivilegeConstants.PROCESS_VIEW;
a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.defaultUserLocation=angular.fromJson(localStorage.getItem("defaultOrgLoc")),a.postHeader={},a.entityType={queryUrl:"GET_ENTITY_TYPES_EXCEPT_ORG_LOC",queryParameter:{}},a.eventType={queryUrl:"GET_APPOINTMENT_EVENT_TYPE",queryParameter:{}},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.serviceType={queryUrl:"GET_ALL_TREATMENT_TYPE",queryParameter:{}},a.apptStatus={queryUrl:"GET_APPOINTMENT_STATUS",queryParameter:{}},a.allocatedForwarded={queryUrl:"GET_EQUIPMENT_USERS",queryParameter:{orgLocationId:0}},a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:a.defaultUserLocation.id}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}})):(a.searchCriteria.entityName=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.eventType",function(b,c){b&&b.id?(a.isEventNameDisabled=!1,a.searchCriteria.entityName&&a.searchCriteria.entityName.id?a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:a.searchCriteria.entityName.id}}:a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:0}}):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityName",function(b,c){b&&b.id?(a.isProcessSelected=!1,"CAL_PROCESS"===a.searchCriteria.entityType.code?(a.isProcessSelected=!0,a.specificProfessional={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.searchCriteria.specificProfessional={},a.searchCriteria.eventType&&(a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:a.searchCriteria.eventType.id,entityId:a.searchCriteria.entityName.id}})):(a.searchCriteria.specificProfessional={},a.isProcessSelected=!1)}),a.searchFixAppointment=function(c){a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.apptDate&&(localStorage.setItem("appointmentListFilter",angular.toJson(a.searchCriteria)),a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0,a.currentDate=i("timestampToDate")(new Date,"yyyy/MM/dd"),a.searchCriteria.apptDate=i("timestampToDate")(a.searchCriteria.apptDate,"yyyy/MM/dd"),a.searchCriteria.apptDate==a.currentDate?a.isCurrentDate=!0:a.isCurrentDate=!1,o.searchFixAppointment(a.searchCriteria,a.postHeader,function(c){b.showSpinner=!1,a.WSAppoinrmentList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1}))},a.viewTreatmentHistory=function(a){d.go("patientRecord",{type:"view",id:a.patientId,locationId:a.organizationLocationId,displayName:a.patientName,locationValue:a.locationName})},a.viewPatientActivity=function(a){d.go("patientActivityList",{apptId:a.id})},a.viewAppointment=function(a){d.go("manageFixAppointment",{type:"view",appointmentId:a.id})},a.goToAppointmentNotes=function(a){d.go("appointmentnotes",{appointmentId:a.id,type:"edit"})},a.goToAddComments=function(b,c){g.show({controller:"AddCommentsDetailsPopupCtrl",templateUrl:"app/modules/appointment/views/addComments-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{appointmentData:b,treatmentData:null,medicationData:null,diseaseVariantData:null,diagnosticTestData:null,fromState:c}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.goToUploadDownload=function(a){o.goToUploadDownload(a)},a.manageRecordWalkInForm=function(b,c,d,e){if("RECORDWALKIN"===d&&a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.apptDate)a.manageAppointmentForm(b,c,d,e);else{
//notify("warning", $translate.instant("FILTER_FILL_MANDATORY_FIELDS_RECORDWALKIN"));
var f=g.alert().title(h.instant("MANDETORY_FIELDS_NEEDED")).textContent(h.instant("FILTER_FILL_MANDATORY_FIELDS_RECORDWALKIN")).ariaLabel("Lucky day").ok(h.instant("OK"));g.show(f).then(function(){},function(){})}},a.showDiagnosticTests=function(a){var b={};a.patientId&&(b.userName=a.patientName,b.userId=a.patientId,d.go("usertestlist",b))},a.createViewBill=function(a){if(1==a.whetherTransactionBilled){var b={};/* raisedOn OR PARTY_TYPE value */
b.raisedOn="INDIVIDUAL",/* partyNameId.id OR RAISED_ON object */
b.partyNameId={id:a.patientId,value:a.patientName},/* type OR SELECT_BILL_TYPE value */
b.type="DEBIT",/* locationId OR SELECT_ORG_LOCATION object */
b.inFavorOfOrgList={id:a.organizationLocationId,value:a.locationName},/* dateFromString OR DATE_FROM */
b.dateFromString=a.apptDate,b.dateTillString=new Date,b.fromApptList=!0,b.transactionId=a.transactionId,d.go("searchbill",{data:b})}else{var c=a.transactionId,e=a.id,f=a.serviceTypeId,h=a.organizationLocationId,i=a.apptDate,j=a.event.value,k=a.entityName;g.show({controller:x,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{transactionId:c,appointmentId:e,serviceTypeId:f,locationId:h,apptDate:i,event:j,entityName:k}})}},a.viewPrescription=function(b){o.getPrescriptionByAppId(b.id,function(b){g.show({controller:y,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){})},a.viewPrescriptionForTreatment=function(b){o.getPrescriptionByTreatmentId(b.id,function(b){g.show({controller:y,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){})},a.viewPrescriptionForRequest=function(b){b.appointmentId?o.getPrescriptionByAppId(b.appointmentId,function(b){g.show({controller:y,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){}):o.getPrescriptionByRequestFulId(b.id,function(b){g.show({controller:y,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:k}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){})},a.makePrescription1=s.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="usermedication",a.makePrescription1(b,c,d,e,g,f)},a.treatmentRecordDetails=function(b){g.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:b,isCurrentDate:a.isCurrentDate,baseService:k,diseaseVariantObj:null,mode:"add"}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.manageAppointmentForm=function(b,c,e,f){if(localStorage.setItem("appmentData",angular.toJson(b)),b&&b.eventType&&"Online Appointment"==b.eventType.value&&"CHECKEDIN"==e){var g=angular.fromJson(localStorage.getItem("defaultOrg"));r.getOrganizationCallType(g,function(a){if(a)if("AGORA"==a.usageType){var c={};b&&b.event&&b.event.id&&(c.relatedtoCalendarEvent=b.event.id),b&&b.id&&(c.appointmentId=b.id),r.getConversationIdForAppointmentAgora(c,function(a){var c={};b.patientId?c.userId=b.patientId:c.userId=0,a.response.convId&&(c.convId=a.response.convId),b.patientName&&(c.userName=b.patientName),c.checkIn=!0,c.usageType=a.response.usageType,localStorage.setItem("usageType",a.response.usageType),localStorage.skypeIssuedStatus&&"false"!=localStorage.skypeIssuedStatus||z(c)},function(a){})}else if("SKYPE"==a.usageType){var c={};b&&b.event&&b.event.id&&(c.relatedtoCalendarEvent=b.event.id),b&&b.id&&(c.appointmentId=b.id),r.getConversationIdForAppointment(c,function(a){var c={};b.patientId?c.userId=b.patientId:c.userId=0,a.response.convId&&(c.convId=a.response.convId),b.patientName&&(c.userName=b.patientName),c.checkIn=!0,c.usageType=a.response.usageType,localStorage.setItem("usageType",a.response.usageType),localStorage.skypeIssuedStatus&&"false"!=localStorage.skypeIssuedStatus||A(c)},function(a){})}},function(a){})}else{var h={appointmentType:e};b&&b.id&&(h.appointmentId=b.id),h.urlState=c,a.searchCriteria.entityType?h.entityType=a.searchCriteria.entityType:b.entityType&&b.entityTypeId&&(h.entityType={id:b.entityTypeId,code:b.entityType}),a.searchCriteria.entityName?h.entityName=a.searchCriteria.entityName:b.entityId&&b.entityName&&(h.entityName={id:b.entityId,value:b.entityName}),a.searchCriteria.eventType?h.eventType=a.searchCriteria.eventType:b&&b.eventType&&(h.eventType=b.eventType),a.searchCriteria.eventName&&a.searchCriteria.eventName.id?h.eventName=a.searchCriteria.eventName:b&&b.event&&(h.eventName=b.event),h.appDate=a.searchCriteria.apptDate,n.isNullOrEmpty(b)||n.isNullOrEmpty(b.organizationLocationId)?a.WSAppoinrmentList[0]&&(h.orgLocation=a.WSAppoinrmentList[0].organizationLocationId,h.locationName=a.WSAppoinrmentList[0].locationName):(h.orgLocation=b.organizationLocationId,h.locationName=b.locationName),d.go(c,h)}},a.startCall=function(b){localStorage.setItem("appmentData",angular.toJson(b));var c={};if(c.conversationLogId=b.conversationLogId,!n.isFieldEmpty(a.searchCriteria.entityName)){var d=angular.fromJson(localStorage.getItem("defaultOrg"));r.getOrganizationCallType(d,function(b){b&&("AGORA"==b.usageType?(c.userId=a.searchCriteria.entityName.id,r.getConversationIdForAppointmentForDocAgora(c,function(a){var b={};angular.fromJson(k.getLoggedInUser()).id?b.userId=angular.fromJson(k.getLoggedInUser()).id:b.userId=0,a.response.convId.id&&(b.convId=a.response.convId.id),angular.fromJson(k.getLoggedInUser()).displayName&&(b.userName=angular.fromJson(k.getLoggedInUser()).displayName),b.startCall=!0,b.usageType=a.response.usageType,localStorage.setItem("usageType",a.response.usageType),localStorage.skypeIssuedStatus||z(b)},function(a){})):"SKYPE"==b.usageType&&(c.userId=a.searchCriteria.entityName.id,r.getConversationIdForAppointmentForDoc(c,function(a){var b={};angular.fromJson(k.getLoggedInUser()).id?b.userId=angular.fromJson(k.getLoggedInUser()).id:b.userId=0,a.response.convId.id&&(b.convId=a.response.convId.id),angular.fromJson(k.getLoggedInUser()).displayName&&(b.userName=angular.fromJson(k.getLoggedInUser()).displayName),b.startCall=!0,b.usageType=a.response.usageType,localStorage.setItem("usageType",a.response.usageType),localStorage.skypeIssuedStatus||A(b)},function(a){})))},function(a){})}},a.startCall1=function(c){localStorage.setItem("appmentData",angular.toJson(c));var d={};if(d.conversationLogId=c.conversationLogId,n.isFieldEmpty(a.searchCriteria.entityName))f("info",h.instant("ENTITY_NOT_SELECTED"));else if(v.get("skype_access_token"))g.show({templateUrl:"app/modules/skype-integration/views/skype-cookies-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,controller:["$scope","$location","baseConfig",function(a,b,c){a.cancel=function(){g.cancel()},a.clearCookies=function(){localStorage.setItem("skypeIssuedStatus",!1),v.remove("skype_access_token"),location.assign("https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+c.skypeRedirectUrl+"#/appointmentsList")}}]});else{var e={};e.organizationLocId=c.organizationLocationId,w.getskypeOrganizationAccess(e,function(c){if(1==c.data){a.userData={},a.userData.userId=b.loggedInUserDetails.id,a.userData.convType="APPOINTMENT",localStorage.skypeIssuedId?a.userData.skypeIssuedId=localStorage.getItem("skypeIssuedId"):a.userData.skypeIssuedId=0;var e=m.getParameterizedUrl("CACHE_CLEAR_UPDATE",a.userData);if(e)return l.getData(e,null,function(b){d.userId=a.searchCriteria.entityName.id,r.getConversationIdForAppointmentForDoc(d,function(a){var b={};angular.fromJson(k.getLoggedInUser()).id?b.userId=angular.fromJson(k.getLoggedInUser()).id:b.userId=0,a.response.convId.id&&(b.convId=a.response.convId.id),angular.fromJson(k.getLoggedInUser()).displayName&&(b.userName=angular.fromJson(k.getLoggedInUser()).displayName),b.startCall=!0,b.usageType=a.response.usageType,localStorage.setItem("usageType",a.response.usageType),localStorage.skypeIssuedStatus||issueSkypeId(b)},function(a){})},function(b){a.isSkypeCacheCleared=!0})}else g.show({templateUrl:"app/modules/skype-integration/views/skype-organization-count-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,controller:["$scope","$location","baseConfig",function(a,b,c){a.cancel=function(){g.cancel()}}]})})}},a.validateCallMenu=function(a){return"CAL_PROCESS"==a.entityType&&"ALLOCATED"==a.apptStatusCode&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum||"CAL_ORGANIZATION_USER"==a.entityType&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum},a.manageIssueToken=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageIssueToken(c.id,function(c){b.showSpinner=!1,f("success",h.instant("TOKEN_ISSUE_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageConsultationStarted=function(c,d){c&&(b.showSpinner=!0,o.validateStartConsultation(c,function(d){if(b.showSpinner=!1,""==d.successMessage)o.manageConsultationStarted(c.id,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_START_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1});else{var e=g.confirm().title(h.instant("CONFIRM_START_CUNSULTATION")).textContent(d.successMessage).ok(h.instant("OK")).cancel(h.instant("CANCEL"));g.show(e).then(function(){b.showSpinner=!0,o.confirmStartConsultation(c,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_START_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1})},function(){b.showSpinner=!1})}},function(a){b.showSpinner=!1}))},a.manageConsultationFinished=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageConsultationCompleted(c.id,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_FINISHED_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageFixAppointment=function(c){/*if ($scope.searchCriteria.entityType && $scope.searchCriteria.entityType.id &&
                $scope.searchCriteria.entityName && $scope.searchCriteria.entityName.id &&
                $scope.searchCriteria.eventType && $scope.searchCriteria.eventType.id &&
                $scope.searchCriteria.eventName && $scope.searchCriteria.eventName.id &&
                $scope.searchCriteria.apptDate) {

                $state.go('manageFixAppointment', {
                    type: 'add',
                    entityType: $scope.searchCriteria.entityType,
                    entityName: $scope.searchCriteria.entityName,
                    eventType: $scope.searchCriteria.eventType,
                    eventName: $scope.searchCriteria.eventName,
                    apptDate: $scope.searchCriteria.apptDate
                });
} else*/
a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.orgLocation&&a.searchCriteria.orgLocation.id?o.getCalendarByEntityId(a.searchCriteria.entityType.id,a.searchCriteria.entityName.id,a.searchCriteria.orgLocation.id,function(c){if(c.id&&null!=c.id){b.showSpinner=!0;var e={calendarId:c.id,entityTypeCode:a.searchCriteria.entityType.code,entityId:a.searchCriteria.entityName.id};r.getCalendarDetailsById(e,function(c){b.showSpinner=!1,"CAL_ORGANIZATION_USER"==a.searchCriteria.entityType.code?d.go("usercalendarview",{type:"regular",data:c}):"CAL_PROCESS"==a.searchCriteria.entityType.code?d.go("processcalendarview",{type:"regular",data:c}):"CAL_EQUIPMENT"==a.searchCriteria.entityType.code?d.go("equipmentcalendarview",{type:"regular",data:c}):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},function(a){b.showSpinner=!1})}},function(a){}):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},a.clear=function(){a.searchCriteria={},a.WSAppoinrmentList=[],a.totalItems=0,localStorage.removeItem("appointmentListFilter")},a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchFixAppointment()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFixAppointment()};
//datatble config json
var D={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(D),a.dtColumnDefs=e.setColumnProperties({}),a.forwardTo=function(a){var b=a;g.show({controller:B,templateUrl:"app/modules/appointment/views/forward-to-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{rowObject:b}})},a.forwardedApptChecked=function(b){if(1==b){a.isOrgUser&&(a.searchCriteria.entityName=null);var c={};c.code="APPOINTMENT_STATUS",l.getData(m.getParameterizedUrl("GET_APPOINTMENT_STATUS",c),null,function(b){a.getStatus=angular.fromJson(b.data),angular.forEach(a.getStatus,function(b,c){"FORWARDED"==b.code&&(a.searchCriteria.apptStatus=b)})},function(a){})}else a.searchCriteria.apptStatus=null,a.isOrgUser&&(a.loggedInUserDetails.userAccountStatusDTO.whetherDoctor||a.loggedInUserDetails.userAccountStatusDTO.whetherSupportServiceProfessional)&&(a.searchCriteria.entityName={id:a.loggedInUserDetails.id,value:a.loggedInUserDetails.displayName})},a.forwardedToMeChanged=function(b){a.forwardedApptChecked(b),1==b?(a.isOrgUser&&(a.searchCriteria.entityName=null),n.isNullOrEmpty(a.loggedInUserDetails)||n.isNullOrEmpty(a.loggedInUserDetails.userAccountStatusDTO)||(a.loggedInUserDetails.userAccountStatusDTO.whetherDoctor||a.loggedInUserDetails.userAccountStatusDTO.whetherSupportServiceProfessional||a.loggedInUserDetails.userAccountStatusDTO.whetherLabTechnician||a.loggedInUserDetails.userAccountStatusDTO.whetherPharmacyUser)&&(a.searchCriteria.allocatedForwarded={id:a.loggedInUserDetails.id,value:a.loggedInUserDetails.displayName}),a.searchFixAppointment()):(a.searchCriteria.apptStatus=null,a.searchCriteria.allocatedForwarded=null,a.isOrgUser&&(a.loggedInUserDetails.userAccountStatusDTO.whetherDoctor||a.loggedInUserDetails.userAccountStatusDTO.whetherSupportServiceProfessional||a.loggedInUserDetails.userAccountStatusDTO.whetherLabTechnician||a.loggedInUserDetails.userAccountStatusDTO.whetherPharmacyUser)&&(a.searchCriteria.entityName={id:a.loggedInUserDetails.id,value:a.loggedInUserDetails.displayName}),a.searchFixAppointment())},a.showSummary=function(a,b){var c={};c.rowObject=a,c.selectedCat=b,/*$state.go('summarydata', {
                rowObject: row,
                selectedCat: selectedCat
            });*/
g.show({controller:"SummaryDataCtrl",templateUrl:"app/modules/appointment/views/clinical-data-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{stateObj:c}})},a.goToAllergyList=function(a){var a=a;d.go("allergylist",{rowObject:a})},a.goToFollowUpActions=function(a){var a=a;d.go("followupactions",{rowObject:a})},a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")},a.init=function(b){a.canAllot=!0,a.canConsultationStart=!0,a.canIssueToken=!0,a.canForword=!0,a.canRecordDignosis=!0,a.loggedInUserDetails=k.getLoggedInUser();var d={};localStorage.getItem("appointmentListFilter")&&0!=c.loadFilter&&(d=angular.fromJson(localStorage.getItem("appointmentListFilter")),a.searchCriteria=d,a.searchFixAppointment());var e=k.getDefaultOrgLocation();if(n.isFieldEmpty(e)||(a.searchCriteria.orgLocation=e.orgLoc),c.event)q.getCalendarEventDetails(c.event.id,function(b){if(
//$scope.eventData = angular.fromJson(resp);
a.apptDetails=b,b.entityTypeDetails&&b.entityTypeDetails.id&&(0==c.loadFilter&&(a.searchCriteria.entityType=b.entityTypeDetails),"CAL_PROCESS"==a.searchCriteria.entityType.code)){var d={};d.eventId=c.event.id,d.userId=k.getLoggedInUser().id,o.getAccessRightsForProcess(d,function(b){a.processAccessRights=b.data,a.processAccessRights.canAllot||(a.canAllot=!1),a.processAccessRights.canExaminePatient||(a.canConsultationStart=!1),a.processAccessRights.canIssueToken||(a.canIssueToken=!1),a.processAccessRights.canForwardForOpinion||(a.canForword=!1),a.processAccessRights.canPrepareSummary||(a.canRecordDignosis=!1)},function(a){})}b.eventType&&b.eventType.id&&0==c.loadFilter&&(a.searchCriteria.eventType=b.eventType),b.id&&b.eventName&&0==c.loadFilter&&(a.searchCriteria.eventName={id:b.id,value:b.eventName}),a.appointmentType=b.appointmentType,c.apptDate&&0==c.loadFilter&&(a.searchCriteria.apptDate=i("timestampToDate")(c.apptDate,"MM/dd/yyyy")),c.entityName&&b.entityId&&0==c.loadFilter&&(a.searchCriteria.entityName={id:b.entityId,value:c.entityName}),a.searchFixAppointment()});else if(!localStorage.getItem("appointmentListFilter")&&0!=c.loadFilter){var f={};"MY_PROCESS_APPOINTMENTS"==c.menuName?(f.pickListCode="calendarEntityType",f.pickListItemCode="CAL_PROCESS"):(f.pickListCode="calendarEntityType",f.pickListItemCode="CAL_ORGANIZATION_USER"),u.getPicklistWSByCode(f,function(b){a.searchCriteria.entityType=b.data,"CAL_PROCESS"==a.searchCriteria.entityType.code&&C();var c=k.getLoggedInUser();c&&c.userAccountStatusDTO&&1==c.userAccountStatusDTO.whetherDoctor&&(a.searchCriteria.entityName={id:c.id,value:c.displayName},a.searchFixAppointment())},function(a){}),a.searchCriteria.apptDate=i("timestampToDate")(new Date,"MM/dd/yyyy")}var g=k.getLocationCategory();n.isFieldEmpty(g)||("SERVICE_PROVIDER_HO"==g.code?a.showFwdTo=!0:a.showFwdTo=!1),k.getLoggedInUser()&&(a.currentLoggedInUserId=k.getLoggedInUser().id)},a.goToCard=function(){d.go("appointmentsListCardView")},a.init()}]),angular.module("paripal.appointmentModule").controller("AppointmentsManagementCtrl",["$scope","$state","baseService","$rootScope","utilService",function(a,b,c,d,e){"use strict";if(a.showMyCalendars=function(){1==c.getLoggedInUser().isOrganizationUserMode?b.go("calendarlistview"):b.go("individualcalendarlist")},a.showMyAppointments=function(){1==c.getLoggedInUser().isOrganizationUserMode?b.go("appointmentsList"):b.go("individualAppointmentsList")},a.showEquipmentAppointments=function(){b.go("equipmentAppointmentsList")},!e.isNullOrEmpty(d.dashboardMenu)){a.parentMenus=d.dashboardMenu.children;for(var f=0;f<=a.parentMenus.length;f++)null!=a.parentMenus[f]&&"APPOINTMENTS"==a.parentMenus[f].name&&(a.childMenus=a.parentMenus[f].children)}a.redirectTo=function(a,c){a.preventDefault(),"FIX_APPOINTMENT"==c.name?b.go(c.state,{type:"add",fromState:"home"}):"MY_PROCESS_APPOINTMENTS"==c.name?b.go(c.state,{menuName:"MY_PROCESS_APPOINTMENTS"}):b.go(c.state)}}]),angular.module("paripal.appointmentModule").controller("CancelPostponeAppointmentListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","$filter","dateconvertor","serverSidePagination","baseService","httpService","urlService","utilService","cancelPostponeAppointmentListService","featurePrivilegeConstants","manageCalendarEventService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},b.showSpinner=!1,a.WSAppoinrmentList=[],a.WSAppointment={},
//$scope.orgLocPermission = featurePrivilegeConstants.PROCESS_VIEW;
a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.postHeader={},a.entityType={queryUrl:"GET_ENTITY_TYPES_WITHOUT_LOCATION",queryParameter:{}},a.eventType={queryUrl:"GET_APPOINTMENT_EVENT_TYPE",queryParameter:{}},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.serviceType={queryUrl:"GET_ALL_TREATMENT_TYPE",queryParameter:{}},a.apptStatus={queryUrl:"GET_APPOINTMENT_STATUS",queryParameter:{}},a.allocatedForwarded={queryUrl:"GET_EQUIPMENT_USERS",queryParameter:{orgLocationId:0}},a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}})):(a.searchCriteria.entityName=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.eventType",function(b,c){b&&b.id?(a.isEventNameDisabled=!1,a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:0}}):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityProcess",function(b,c){b&&b.id?(a.isProcessSelected=!1,"CAL_PROCESS"===a.searchCriteria.entityType.code?(a.isProcessSelected=!0,a.specificProfessional={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.searchCriteria.specificProfessional={}):(a.searchCriteria.specificProfessional={},a.isProcessSelected=!1)}),a.rowIds=[],a.recordLocation=[],a.checkedRecord={},a.selectedRecord={},a.recordSelected=function(b,c,d){if(a.checkedRecord.hasOwnProperty(b.id)){delete a.checkedRecord[b.id];var c=a.rowIds.indexOf(b.id);c>-1&&a.rowIds.splice(c,1)}else a.checkedRecord[b.id]=!0,a.rowIds.push(b.id)},a.searchFixAppointment=function(c){a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.eventType&&a.searchCriteria.eventType.id&&a.searchCriteria.eventName&&a.searchCriteria.eventName.id&&a.searchCriteria.apptDate&&(a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0,p.searchFixAppointment(a.searchCriteria,a.postHeader,function(c){b.showSpinner=!1,a.WSAppoinrmentList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1}))},a.cancelAppointment=function(){if(a.searchCriteria.apptDate)if(a.rowIds&&0==a.rowIds.length)f("warning",h.instant("PLEASE_SELECT_LIST_RECORD"));else{var c={};c.apptDate=j.convertToServerDate(a.searchCriteria.apptDate),c.appointmentIds=a.rowIds,c.cancelPostponeAppointmentReason=a.WSAppointment.cancelPostponeAppointmentReason,p.cancelAppointment(c,function(a){b.showSpinner=!1,f("success",h.instant("RECORD_UPDATED_SUCCESSFULLY"))},function(a){b.showSpinner=!1})}else f("warning",h.instant("PLEASE_SELECT_DATE"))},a.postponeAppointment=function(){if(a.searchCriteria.apptDate)if(a.rowIds&&0==a.rowIds.length)f("warning",h.instant("PLEASE_SELECT_LIST_RECORD"));else if(a.WSAppointment.postponeTime){var c={};c.apptDate=j.convertToServerDate(a.searchCriteria.apptDate),c.appointmentIds=a.rowIds,c.postponeTime=a.WSAppointment.postponeTime,c.cancelPostponeAppointmentReason=a.WSAppointment.cancelPostponeAppointmentReason,a.searchCriteria.entityName&&(c.onBehalfOfUserId=a.searchCriteria.entityName.id),p.postponeAppointment(c,function(a){if(b.showSpinner=!1,1==a.response)f("success",h.instant("APPOINTMENTS_POSTPONED_SUCCESSFULLY")),d.reload();else{var e=g.confirm().title(h.instant("CONFORM_APPOINTMENT_POSTPONE")).textContent(h.instant("CONFORM_APPOINTMENT_POSTPONE_MESSAGE1")+a.successMessage+" "+h.instant("CONFORM_APPOINTMENT_POSTPONE_MESSAGE2")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));g.show(e).then(function(){b.showSpinner=!0,p.postponeBulkAppointment(c,function(a){b.showSpinner=!1,f("success",h.instant("APPOINTMENTS_POSTPONED_SUCCESSFULLY")),d.reload()},function(a){b.showSpinner=!1})},function(){b.showSpinner=!1})}},function(a){b.showSpinner=!1})}else f("warning",h.instant("PLEASE_SELECT_POSTPONE"));else f("warning",h.instant("PLEASE_SELECT_DATE"))},a.clear=function(){a.searchCriteria={},a.searchFixAppointment()},a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.searchFixAppointment()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFixAppointment()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.minDate=i("timestampToDate")(new Date,"MM/dd/yyyy"),a.appointmentType=c.type,"postpone"==c.type&&(a.isDateDisable=!0),c.eventId&&r.getCalendarEventDetails(c.eventId,function(b){var d=b;a.searchCriteria.entityType=d.entityTypeDetails,a.searchCriteria.entityName={id:d.entityId,value:d.entityName},a.searchCriteria.eventType={id:d.eventType.id,value:d.eventType.value},a.searchCriteria.eventName={id:d.id,value:d.eventName},"postpone"==c.type?a.searchCriteria.apptDate=j.convertToViewDate(new Date):"postpone"!=c.type&&c.date?a.searchCriteria.apptDate=j.convertToViewDate(c.date):a.searchCriteria.apptDate=j.convertToViewDate(new Date),a.searchFixAppointment()},function(a){})},a.init()}]),angular.module("paripal.appointmentModule").controller("EquipmentAppointmentListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","$filter","serverSidePagination","baseService","httpService","urlService","utilService","appointmentsListService","featurePrivilegeConstants","manageCalendarEventService","commonCalendarService","dateconvertor","manageRequestService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},b.showSpinner=!1,a.WSAppoinrmentList=[],
//$scope.orgLocPermission = featurePrivilegeConstants.PROCESS_VIEW;
a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.postHeader={},n.isNullOrEmpty(c.fromHomeView)||"past"!=c.fromHomeView?a.entityType={queryUrl:"GET_ENTITY_TYPES",queryParameter:{}}:a.entityType={queryUrl:"GET_ENTITY_TYPES_WITHOUT_LOCATION",queryParameter:{}},a.eventType={queryUrl:"GET_APPOINTMENT_EVENT_TYPE",queryParameter:{}},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.serviceType={queryUrl:"GET_ALL_TREATMENT_TYPE",queryParameter:{}},a.apptStatus={queryUrl:"GET_APPOINTMENT_STATUS",queryParameter:{}},a.allocatedForwarded={queryUrl:"GET_EQUIPMENT_USERS",queryParameter:{orgLocationId:0}},a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}})):(a.searchCriteria.entityName=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.eventType",function(b,c){b&&b.id?(a.isEventNameDisabled=!1,a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:0}}):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityProcess",function(b,c){b&&b.id?(a.isProcessSelected=!1,"CAL_PROCESS"===a.searchCriteria.entityType.code?(a.isProcessSelected=!0,a.specificProfessional={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.searchCriteria.specificProfessional={}):(a.searchCriteria.specificProfessional={},a.isProcessSelected=!1)}),a.searchFixAppointment=function(){var d={};a.searchCriteria.entityName&&(d.entityId=a.searchCriteria.entityName.id),a.searchCriteria.entityType&&(d.entityType=a.searchCriteria.entityType.code),a.searchCriteria.eventType&&(d.eventTypeId=a.searchCriteria.eventType.id),a.searchCriteria.eventName&&(d.eventName=a.searchCriteria.eventName),a.searchCriteria.fromDate&&(d.fromDate=s.convertToServerDate(a.searchCriteria.fromDate)),a.searchCriteria.toDate&&(d.toDate=s.convertToServerDate(a.searchCriteria.toDate)),n.isNullOrEmpty(c.fromHomeView)||("upcoming"==c.fromHomeView?(a.currentDate=new Date,a.minDateValidFrom=a.currentDate,a.minDateValidTill=a.currentDate,a.searchCriteria.fromDate=a.currentDate,d.fromDate=s.convertToServerDate(a.currentDate),d.whetherFuture=!0):"past"==c.fromHomeView&&(a.currentDate=new Date,a.maxDateValidTill=a.currentDate,a.maxDateValidFrom=a.currentDate,a.searchCriteria.toDate=a.currentDate,d.toDate=s.convertToServerDate(a.currentDate),d.whetherPast=!0,a.whetherPast=!0)),d.pageNumber=a.currentPage,d.recordsPerPage=a.itemPerPage,/*$scope.searchCriteria.entityId = baseService.getLoggedInUser().id;*/
r.getMyAppointmentList(d,function(c){b.showSpinner=!1,a.WSIndividualAppointments=c.data,a.totalItems=c.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})},a.cancelAppointment=function(a){var b={},c=g.confirm().title(h.instant("APPOINTMENT_CANCELATION_TITLE")).textContent(h.instant("APPOINTMENT_CANCELATION_MSG")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));g.show(c).then(function(){b.appointmentIds=[a.id],b.apptDate=s.convertToServerDate(new Date(a.apptDate)),r.cancelAppointment(b,function(a){f("success",a.successMessage),d.reload()},function(a){})},function(){})},a.viewCalendar=function(c){var e={calendarId:c.calendarMasterId,entityTypeCode:c.entityType,entityId:c.entityId};r.getCalendarDetailsById(e,function(c){b.showSpinner=!1;var e=c;e.isPostpond=!0,e.slotId=a.selectedSlotId,e.appointmentId=a.oldAppointmentId,localStorage.setItem("isPostpond","true"),"CAL_ORGANIZATION_USER"==e.entityType.code?d.go("usercalendarview",{type:"regular",data:e}):"CAL_PROCESS"==e.entityType.code?d.go("processcalendarview",{type:"regular",data:e}):"CAL_EQUIPMENT"==e.entityType.code&&d.go("equipmentcalendarview",{type:"regular",data:e})},function(a){b.showSpinner=!1})},a.postponeAppointment=function(b){a.selectedSlotId=b.appointmentSlotId,a.oldAppointmentId=b.id,q.getCalendarEventDetails(b.event.id,function(b){a.viewCalendar(b)},function(a){})},a.goToAppointmentNotes=function(a){d.go("appointmentnotes",{appointmentId:a.id,type:"view"})},a.goToUploadDownload=function(a){o.goToUploadDownload(a)},a.manageRecordWalkInForm=function(b,c,d,e){"RECORDWALKIN"===d&&a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.eventType&&a.searchCriteria.eventType.id&&a.searchCriteria.eventName&&a.searchCriteria.eventName.id&&a.searchCriteria.apptDate?a.manageAppointmentForm(b,c,d,e):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},a.manageAppointmentForm=function(b,c,e,f){var g={appointmentType:e};b&&b.id&&(g.appointmentId=b.id),g.urlState=c,g.entityType=a.searchCriteria.entityType,g.entityName=a.searchCriteria.entityName,g.eventType=a.searchCriteria.eventType,g.eventName=a.searchCriteria.eventName,g.appDate=a.searchCriteria.apptDate,d.go(c,g)},a.startCall=function(b){var c={};c.conversationLogId=b.conversationLogId,n.isFieldEmpty(a.searchCriteria.entityName)?f("info",h.instant("ENTITY_NOT_SELECTED")):(c.userId=a.searchCriteria.entityName.id,r.getConversationIdForAppointmentForDoc(c,function(a){d.go("skypeHome",{userId:angular.fromJson(k.getLoggedInUser()).id,convId:a.response.convId.id,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName})},function(a){}))},a.validateCallMenu=function(a){return"CAL_PROCESS"==a.entityType&&"ALLOCATED"==a.apptStatusCode&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum||"CAL_ORGANIZATION_USER"==a.entityType&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum},a.manageIssueToken=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageIssueToken(c.id,function(c){b.showSpinner=!1,f("success",h.instant("TOKEN_ISSUE_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageConsultationStarted=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageConsultationStarted(c.id,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_START_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageFixAppointment=function(b){a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.eventType&&a.searchCriteria.eventType.id&&a.searchCriteria.eventName&&a.searchCriteria.eventName.id&&a.searchCriteria.apptDate?d.go("manageFixAppointment",{type:"add",entityType:a.searchCriteria.entityType,entityName:a.searchCriteria.entityName,eventType:a.searchCriteria.eventType,eventName:a.searchCriteria.eventName,apptDate:a.searchCriteria.apptDate}):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},a.clear=function(){a.searchCriteria={},a.WSAppoinrmentList=[]},a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchFixAppointment()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFixAppointment()};
//datatble config json
var u={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(u),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){var b={};b.pickListCode="calendarEntityType",b.pickListItemCode="CAL_EQUIPMENT",t.getPicklistWSByCode(b,function(b){a.searchCriteria.entityType=b.data},function(a){}),a.searchFixAppointment()},a.init()}]),angular.module("paripal.appointmentModule").controller("EquipmentListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","equipmentListService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.equipmentListSpinner=!1,a.WSEquipmentMappingList=[],a.orgLocPermission=o.EQUIPMENT_PROFESSIONAL_MAPPING_VIEW,a.postHeader={headers:{orgLocPermission:a.orgLocPermission}},a.searchCriteria.recordStatus=null,a.equipment={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{orgLocationId:0}},a.user={queryUrl:"GET_EQUIPMENT_USERS",queryParameter:{orgLocationId:0}},/*$scope.$watch('searchCriteria.organizationLocation', function (newVal, oldVal) {

        }, true);*/
a.searchEquipmentsMapping=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.equipmentListSpinner=!0,n.searchEquipmentsMapping(a.searchCriteria,a.postHeader,function(b){a.equipmentListSpinner=!1,a.WSEquipmentMappingList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.equipmentListSpinner=!1})},a.manageEquipmentMapping=function(a,b){var c={type:b};a&&a.id&&(c.id=a.id),d.go("manageEquipment",c)},a.inactiveEquipment=function(b){b.id&&n.inactiveEquipment(b.id,!1,function(b){f("success",h.instant("EQUIPMENT_MAP_INACTIVATE")),a.searchEquipmentsMapping()},function(a){})},a.activeEquipment=function(b){b.id&&n.activeEquipment(b.id,!0,function(b){f("success",h.instant("EQUIPMENT_MAP_ACTIVATE")),a.searchEquipmentsMapping()},function(a){})},a.clear=function(){a.searchCriteria={},a.searchEquipmentsMapping()},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchEquipmentsMapping()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchEquipmentsMapping()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.searchEquipmentsMapping()},a.init()}]),angular.module("paripal.appointmentModule").controller("FollowUpActionsCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.currentDate=(new Date).getTime(),a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}},a.statusList=[{id:1,value:"PENDING"},{id:2,value:"COMPLETED"},{id:3,value:"OVERDUE"}],a.manageAction=function(b,c){var d=null,e=null,f=null;m.isNullOrEmpty(c)||m.isNullOrEmpty(c.patient)||m.isNullOrEmpty(c.patient.id)?m.isNullOrEmpty(a.searchCriteria)||m.isNullOrEmpty(a.searchCriteria.patient)||(e=a.searchCriteria.patient.id,f=a.searchCriteria.patient.value):(e=c.patient.id,f=c.patient.value),m.isNullOrEmpty(c)||m.isNullOrEmpty(c.appointment)||m.isNullOrEmpty(c.appointment.id)?a.apptId&&(d=a.apptId):d=c.appointment.id,g.show({controller:"ManageFollowupActionPopupCtrl",templateUrl:"app/modules/appointment/views/add-follow-up-actions-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{userId:e,pageState:b,rowObject:c,apptId:d,patientName:f}}).then(function(b){1==b&&a.getActions()},function(b){1==b&&a.getActions()})},a.deleteActionRecord=function(c){b.showSpinner=!0;var d={id:c.id};k.postData(l.getParameterizedUrl("ACTION_DELETE",d),null,function(c){b.showSpinner=!1,a.getActions(),f("success",h.instant("ACTION_RECORD_DELETED"))},function(a){b.showSpinner=!1})},a.findUserByName=function(b){a.userNameAutoCmp=!0;var c={},d=[];return c.searchString=b,k.getData(l.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.actionCompleted=function(c,d){b.showSpinner=!0;var e={};e=angular.copy(c),"PENDING"==d?(e.actionStatus="COMPLETED",e.actionCompletedDate=q.convertToServerDate(new Date)):"COMPLETED"==d?(e.actionStatus="PENDING",e.actionCompletedDate=null):"OVERDUE"==d&&(e.actionStatus="OVERDUE",e.actionCompletedDate=null),delete e.daysToCloseAction,delete e.overdueDates,k.postData(l.getUrl("FOLLOWUP_ACTIONS_MARK_COMPLETED"),e,function(c){c&&c.data&&(b.showSpinner=!1,f("success",h.instant(c.data.successMessage)),a.getActions())},function(a){b.showSpinner=!1})},a.getActions=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,m.isNullOrEmpty(a.apptId)||(a.searchCriteria.appointment={id:a.apptId}),b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("FOLLOWUP_ACTIONS_LIST"),c,function(c){c&&c.data&&(b.showSpinner=!1,a.actionList=angular.fromJson(c.data),a.actionList.data.forEach(function(a){if(a.dueDate>new Date){var b=Math.round(Math.abs(new Date(a.dueDate).getTime()-(new Date).getTime())),c=Math.ceil(b/864e5);a.daysToCloseAction=c,a.overdueDates="-","COMPLETED"==a.actionStatus&&(a.daysToCloseAction="-",a.overdueDates="-")}else{var b=Math.round(Math.abs(new Date(a.dueDate).getTime()-(new Date).getTime())),c=Math.ceil(b/864e5);a.overdueDates=c,a.daysToCloseAction="-","COMPLETED"==a.actionStatus&&(a.daysToCloseAction="-",a.overdueDates="-")}}),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode&&m.isNullOrEmpty(a.apptId)?a.searchCriteria={}:(delete a.searchCriteria.actionUser,delete a.searchCriteria.startDate,delete a.searchCriteria.endDate,delete a.searchCriteria.actionStatus),a.getActions()},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getActions()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getActions()};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(r),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){m.isNullOrEmpty(c)||m.isNullOrEmpty(c.rowObject)||(a.apptId=c.rowObject.id,a.searchCriteria.patient={id:c.rowObject.patientId,value:c.rowObject.patientName},a.searchCriteria.actionUser={id:c.rowObject.allocatedForwardedToId,value:c.rowObject.allocatedForwardedTo},a.locationId=c.rowObject.organizationLocationId),b.loggedInUserDetails.isOrganizationUser||b.loggedInUserDetails.isOrganizationUserMode?m.isNullOrEmpty(a.searchCriteria.actionUser)&&(a.searchCriteria.actionUser={id:angular.fromJson(j.getLoggedInUser()).id,value:angular.fromJson(j.getLoggedInUser()).displayName}):m.isNullOrEmpty(a.searchCriteria.patient)&&(a.searchCriteria.patient={id:angular.fromJson(j.getLoggedInUser()).id,value:angular.fromJson(j.getLoggedInUser()).displayName}),a.loggedInUserId=b.loggedInUserDetails.id,a.getActions()},a.init()}]),angular.module("paripal.appointmentModule").controller("IndividualAppointmentListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","$filter","serverSidePagination","baseService","httpService","urlService","utilService","appointmentsListService","featurePrivilegeConstants","manageCalendarEventService","commonCalendarService","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(a){var b={};if(a.userId?b.userId=a.userId:b.userId=0,a.convId&&(b.convId=a.convId),a.userName&&(b.userName=a.userName),localStorage.setItem("skypeIssuedStatus",!0),a.startCall){var c;if("SKYPE"==a.usageType)c=d.href("skypeHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName});else{var e={};e.userId=b.userId,e.convId=b.convId,e.convType="APPOINTMENT",e.userName=angular.fromJson(k.getLoggedInUser()).displayName,d.go("agoraHome",e)}}else{if("SKYPE"==a.usageType)d.go("skypeHome",{userId:b.userId,convId:b.convId,convType:"APPOINTMENT",userName:b.userName});else{var e={};e.userId=b.userId,e.convId=b.convId,e.convType="APPOINTMENT",e.userName=b.userName,d.go("agoraHome",e)}}}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},b.showSpinner=!1,a.WSAppoinrmentList=[],
//$scope.orgLocPermission = featurePrivilegeConstants.PROCESS_VIEW;
a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.hideSubMenus=!0,a.status={open:!1},a.postHeader={},
//Added this for menu issue for whetherParipalAsSubdomain by krishna dated 4-5-2019
"true"==localStorage.whetherParipalAsSubdomain&&(b.loggedInUserDetails.isOrganizationUserMode||(a.hideSubMenus=!1)),n.isNullOrEmpty(c.fromHomeView)||"past"!=c.fromHomeView?a.entityType={queryUrl:"GET_ENTITY_TYPES",queryParameter:{}}:a.entityType={queryUrl:"GET_ENTITY_TYPES_WITHOUT_LOCATION",queryParameter:{}},a.eventType={queryUrl:"GET_APPOINTMENT_EVENT_TYPE",queryParameter:{}},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.serviceType={queryUrl:"GET_ALL_TREATMENT_TYPE",queryParameter:{}},a.apptStatus={queryUrl:"GET_APPOINTMENT_STATUS",queryParameter:{}},a.allocatedForwarded={queryUrl:"GET_EQUIPMENT_USERS",queryParameter:{orgLocationId:0}},a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}})):(a.searchCriteria.entityName=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.eventType",function(b,c){b&&b.id?(a.isEventNameDisabled=!1,a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:0}}):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityProcess",function(b,c){b&&b.id?(a.isProcessSelected=!1,"CAL_PROCESS"===a.searchCriteria.entityType.code?(a.isProcessSelected=!0,a.specificProfessional={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.searchCriteria.specificProfessional={}):(a.searchCriteria.specificProfessional={},a.isProcessSelected=!1)}),a.manageAppointmentCheckInForm=function(b,c,e,f){if(b&&b.eventType&&"Online Appointment"==b.eventType.value&&"CHECKEDIN"==e){localStorage.setItem("appmentData",angular.toJson(b));var g={};g.organizationLocationId=b.organizationLocationId,l.getData(m.getParameterizedUrl("GET_ORG_LOC_BY_ID",g),null,function(c){var d=c.data.organization;r.getOrganizationCallType(d,function(a){if(a)if("AGORA"==a.usageType){var c={};b&&b.event&&b.event.id&&(c.relatedtoCalendarEvent=b.event.id),b&&b.id&&(c.appointmentId=b.id),r.getConversationIdForAppointmentAgora(c,function(a){var c={};b.patientId?c.userId=b.patientId:c.userId=0,a.response.convId&&(c.convId=a.response.convId),b.patientName&&(c.userName=b.patientName),c.checkIn=!0,c.usageType=a.response.usageType,localStorage.setItem("usageType",a.response.usageType),localStorage.skypeIssuedStatus&&"false"!=localStorage.skypeIssuedStatus||t(c)},function(a){})}else if("SKYPE"==a.usageType){var c={};b&&b.event&&b.event.id&&(c.relatedtoCalendarEvent=b.event.id),b&&b.id&&(c.appointmentId=b.id),r.getConversationIdForAppointment(c,function(a){var c={};b.patientId?c.userId=b.patientId:c.userId=0,a.response.convId&&(c.convId=a.response.convId),b.patientName&&(c.userName=b.patientName),c.checkIn=!0,c.usageType=a.response.usageType,localStorage.setItem("usageType",a.response.usageType),localStorage.skypeIssuedStatus&&"false"!=localStorage.skypeIssuedStatus||issueSkypeIdForSkype(c)},function(a){})}},function(a){!n.isEmpty(a.data)&&!n.isEmpty(a.data.messages[0])},{orgLocPermission:a.orgLocPermission})},function(a){})}else{var h={appointmentType:e};b&&b.id&&(h.appointmentId=b.id),h.urlState=c,a.searchCriteria.entityType?h.entityType=a.searchCriteria.entityType:b.entityType&&b.entityTypeId&&(h.entityType={id:b.entityTypeId,code:b.entityType}),a.searchCriteria.entityName?h.entityName=a.searchCriteria.entityName:b.entityId&&b.entityName&&(h.entityName={id:b.entityId,value:b.entityName}),a.searchCriteria.eventType?h.eventType=a.searchCriteria.eventType:b&&b.eventType&&(h.eventType=b.eventType),a.searchCriteria.eventName&&a.searchCriteria.eventName.id?h.eventName=a.searchCriteria.eventName:b&&b.event&&(h.eventName=b.event),h.appDate=a.searchCriteria.apptDate,n.isNullOrEmpty(b)||n.isNullOrEmpty(b.organizationLocationId)?a.WSAppoinrmentList[0]&&(h.orgLocation=a.WSAppoinrmentList[0].organizationLocationId,h.locationName=a.WSAppoinrmentList[0].locationName):(h.orgLocation=b.organizationLocationId,h.locationName=b.locationName),d.go(c,h)}},a.searchFixAppointment=function(){var d={};a.searchCriteria.entityName&&(d.entityId=a.searchCriteria.entityName.id),a.searchCriteria.entityType&&(d.entityType=a.searchCriteria.entityType.code),a.searchCriteria.eventType&&(d.eventTypeId=a.searchCriteria.eventType.id),a.searchCriteria.eventName&&(d.eventName=a.searchCriteria.eventName),a.searchCriteria.orgLocation&&(d.orgLocationId=a.searchCriteria.orgLocation.id),a.searchCriteria.onBehalfOfUserId&&(d.onBehalfOfUserId=a.searchCriteria.onBehalfOfUserId),a.searchCriteria.fromDate&&(d.fromDate=s.convertToServerDate(a.searchCriteria.fromDate)),a.searchCriteria.toDate&&(d.toDate=s.convertToServerDate(a.searchCriteria.toDate)),n.isNullOrEmpty(c.fromHomeView)||("upcoming"==c.fromHomeView?(a.currentDate=new Date,a.minDateValidFrom=a.currentDate,a.minDateValidTill=a.currentDate,a.searchCriteria.fromDate=a.currentDate,d.fromDate=s.convertToServerDate(a.currentDate),d.whetherFuture=!0):"past"==c.fromHomeView&&(a.currentDate=new Date,a.maxDateValidTill=a.currentDate,a.maxDateValidFrom=a.currentDate,a.searchCriteria.toDate=a.currentDate,d.toDate=s.convertToServerDate(a.currentDate),d.whetherPast=!0,a.whetherPast=!0)),d.pageNumber=a.currentPage,d.recordsPerPage=a.itemPerPage,/*$scope.searchCriteria.entityId = baseService.getLoggedInUser().id;*/
r.getMyAppointmentList(d,function(c){b.showSpinner=!1,a.WSIndividualAppointments=c.data,a.totalItems=c.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})},a.viewAppointment=function(a){d.go("manageFixAppointment",{type:"view",appointmentId:a.id})},a.cancelAppointment=function(a){var b={},c=g.confirm().title(h.instant("APPOINTMENT_CANCELATION_TITLE")).textContent(h.instant("APPOINTMENT_CANCELATION_MSG")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));g.show(c).then(function(){b.appointmentIds=[a.id],b.apptDate=s.convertToServerDate(new Date(a.apptDate)),r.cancelAppointment(b,function(a){f("success",a.successMessage),d.reload()},function(a){})},function(){})},a.viewCalendar=function(c){var e={calendarId:c.calendarMasterId,entityTypeCode:c.entityType,entityId:c.entityId};r.getCalendarDetailsById(e,function(c){b.showSpinner=!1;var e=c;e.isPostpond=!0,e.slotId=a.selectedSlotId,e.appointmentId=a.oldAppointmentId,localStorage.setItem("isPostpond","true"),"CAL_ORGANIZATION_USER"==e.entityType.code?d.go("usercalendarview",{type:"regular",data:e}):"CAL_PROCESS"==e.entityType.code?d.go("processcalendarview",{type:"regular",data:e}):"CAL_EQUIPMENT"==e.entityType.code&&d.go("equipmentcalendarview",{type:"regular",data:e})},function(a){b.showSpinner=!1})},a.postponeAppointment=function(b){a.selectedSlotId=b.appointmentSlotId,a.oldAppointmentId=b.id,q.getCalendarEventDetails(b.event.id,function(b){a.viewCalendar(b)},function(a){})},a.goToAppointmentNotes=function(a){d.go("appointmentnotes",{appointmentId:a.id,type:"view"})},a.goToUploadDownload=function(a){o.goToUploadDownload(a)},a.manageRecordWalkInForm=function(b,c,d,e){"RECORDWALKIN"===d&&a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.eventType&&a.searchCriteria.eventType.id&&a.searchCriteria.eventName&&a.searchCriteria.eventName.id&&a.searchCriteria.apptDate?a.manageAppointmentForm(b,c,d,e):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},a.manageAppointmentForm=function(b,c,e,f){var g={appointmentType:e};b&&b.id&&(g.appointmentId=b.id),g.urlState=c,g.entityType=a.searchCriteria.entityType,g.entityName=a.searchCriteria.entityName,g.eventType=a.searchCriteria.eventType,g.eventName=a.searchCriteria.eventName,g.appDate=a.searchCriteria.apptDate,d.go(c,g)},a.startCall=function(b){var c={};c.conversationLogId=b.conversationLogId,n.isFieldEmpty(a.searchCriteria.entityName)?f("info",h.instant("ENTITY_NOT_SELECTED")):(c.userId=a.searchCriteria.entityName.id,r.getConversationIdForAppointmentForDoc(c,function(a){d.go("skypeHome",{userId:angular.fromJson(k.getLoggedInUser()).id,convId:a.response.convId.id,convType:"APPOINTMENT",userName:angular.fromJson(k.getLoggedInUser()).displayName})},function(a){}))},a.validateCallMenu=function(a){return"CAL_PROCESS"==a.entityType&&"ALLOCATED"==a.apptStatusCode&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum||"CAL_ORGANIZATION_USER"==a.entityType&&"CALL_REQUEST_STATUS_NEW"==a.callRequestStatusEnum},a.manageIssueToken=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageIssueToken(c.id,function(c){b.showSpinner=!1,f("success",h.instant("TOKEN_ISSUE_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageConsultationStarted=function(c,d){c&&c.id&&(b.showSpinner=!0,o.manageConsultationStarted(c.id,function(c){b.showSpinner=!1,f("success",h.instant("CONSULT_START_SUCCESS")),a.searchFixAppointment()},function(a){b.showSpinner=!1}))},a.manageFixAppointment=function(b){a.searchCriteria.entityType&&a.searchCriteria.entityType.id&&a.searchCriteria.entityName&&a.searchCriteria.entityName.id&&a.searchCriteria.eventType&&a.searchCriteria.eventType.id&&a.searchCriteria.eventName&&a.searchCriteria.eventName.id&&a.searchCriteria.apptDate?d.go("manageFixAppointment",{type:"add",entityType:a.searchCriteria.entityType,entityName:a.searchCriteria.entityName,eventType:a.searchCriteria.eventType,eventName:a.searchCriteria.eventName,apptDate:a.searchCriteria.apptDate}):f("warning",h.instant("FILTER_FILL_MANDATORY_FIELDS"))},a.getCreatingOrgLoc=function(c){var d={};return d.keyword=c,b.loggedInUserDetails.isOrganizationUserMode?l.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission}):(d.userId=b.loggedInUserDetails.id,l.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD",d),null,function(a){if(a&&a.data)return a.data},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission}))},a.clear=function(){a.searchCriteria={},a.WSAppoinrmentList=[]},a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchFixAppointment()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFixAppointment()};
//datatble config json
var u={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(u),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){console.log(c),a.searchCriteria.fromDate=new Date,c&&c.orgLoc&&(a.searchCriteria.orgLocation=c.orgLoc),c&&c.onBehalfOf&&(a.searchCriteria.onBehalfOfUserId=c.onBehalfOf.id),a.searchFixAppointment()},a.init()}]),angular.module("paripal.appointmentModule").controller("AddUpdateAllergyCtrl",["$mdDialog","$scope","$rootScope","utilService","locationId","userId","pageState","rowObject","httpService","urlService","userStatusService","appointmentObj","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=k.userStatus();b.isOrgUser=o.isOrgUser,b.addAllergyObj={},b.appointmentObj=l,b.maxDate=new Date,d.isNullOrEmpty(h)||(b.addAllergyObj=angular.copy(h)),b.appointmentObj&&(b.addAllergyObj.patientUser={id:b.appointmentObj.patientId,value:b.appointmentObj.patientName},b.disablePatient=!0),b.findUserByName=function(a){b.userNameAutoCmp=!0;var c={},d=[];return c.searchString=a,i.getData(j.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(a){return b.userNameAutoCmp=!1,d=angular.fromJson(a.data)},function(a){b.userNameAutoCmp=!1})},b.addAllergyObj||(b.addAllergyObj={}),b.isOrgUser||(b.addAllergyObj.patientUser={id:angular.fromJson(baseService.getLoggedInUser()).id,value:angular.fromJson(baseService.getLoggedInUser()).displayName}),b.pageState=g,b.cancel=function(){a.hide()},b.addUpdateAllergyRecord=function(){c.showSpinner=!0,d.isNullOrEmpty(e)||(b.addAllergyObj.location={id:e,value:null}),d.isNullOrEmpty(f)||(b.addAllergyObj.patient={id:f,value:null}),b.addAllergyObj.allergyRecordDate=new Date,d.isNullOrEmpty(b.addAllergyObj.allergyStartedDate)&&(b.addAllergyObj.allergyStartedDate=new Date),c.loggedInUserDetails.isOrganizationUser&&c.loggedInUserDetails.isOrganizationUserMode?b.addAllergyObj.whetherSystemOrg=!1:b.addAllergyObj.whetherSystemOrg=!0,b.addAllergyObj.patient&&delete b.addAllergyObj.patient,"add"==b.pageState?i.postData(j.getUrl("ALLERGY_ADD"),b.addAllergyObj,function(b){c.showSpinner=!1;var d=!0;a.hide(d),m("success",n.instant("ALLERGY_RECORD_ADDED"))},function(a){c.showSpinner=!1}):i.putData(j.getUrl("ALLERGY_EDIT"),b.addAllergyObj,function(b){c.showSpinner=!1;var d=!0;a.hide(d),m("success",n.instant("ALLERGY_RECORD_UPDATED"))},function(a){c.showSpinner=!1})}}]),angular.module("paripal.appointmentModule").controller("ManageAppointmentMedicationCtrl",["$scope","$mdDialog","dateconvertor","manageUserMedicationService","baseService","utilService","viewUserMedicationService","notify","$translate","$stateParams","httpService","urlService","$state","$rootScope","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){a.finalList=[],a.finalList=angular.copy(a.testItArray),angular.forEach(a.finalList,function(b,c){(b.medicationVariantList||null==b.medicationVariantList)&&delete b.medicationVariantList,(b.validFromDate||null==b.validFromDate)&&delete b.validFromDate;for(var d in a.userMedication)b[d]=a.userMedication[d];(b.medicationVariant.whetherAvailable||null==b.medicationVariant.whetherAvailable||0==b.medicationVariant.whetherAvailable)&&delete b.medicationVariant.whetherAvailable,b.appointment={id:j.appointmentId}}),d.saveMultipleUserMedicationAppointment(a.finalList,function(a){f.isNullOrEmpty(a.successMessage)||(h("success",i.instant(a.successMessage)),f.goBackToPrevState())},function(a){j.type="edit",f.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})}function q(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,k.getData(l.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)
//$scope.userMedication.creatingOrganizationId.value = response.data[0].value;
//$scope.system = response.data[0].id;
return a.userMedication.creatingOrganizationId=b.data[0],a.userMedication.creatingOrganizationId},function(a){f.isEmpty(a.data)||f.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})}function r(b,c){a.queryObj={},a.queryObj.id=b,a.userMedication.creatingOrganizationId&&null!=a.userMedication.creatingOrganizationId&&(a.queryObj.orgLocId=a.userMedication.creatingOrganizationId.id);var d=l.getParameterizedUrl("GET_MEDICATION_FOR_APPT_BY_ORG_ID",a.queryObj);d&&k.getData(d,null,function(b){b&&b.data&&(c.medicationVariantList=b.data,1==c.medicationVariantList.length&&(a.drugVariantId=c.medicationVariantList[0].id))},function(a){f.isEmpty(a.data)||f.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})}function s(b,c){a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=b;var d=l.getParameterizedUrl("FIND_DISEASE_BY_VARIANT_ID",a.searchKeyWord);if(d)return k.getData(d,null,function(a){a&&a.data&&(c.disease=a.data)},function(a){f.isEmpty(a.data)||f.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})}function t(b){return a.medication={},a.medication.medication=b,a.medicationLoad=!0,k.getData(l.getParameterizedUrl("SEARCH_MEDICATION",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,f.isEmpty(b.data)||f.isEmpty(b.data.messages[0])||h("error",i.instant(b.data.messages[0]))})}if(a.userMedication={},a.getSystemOrg=q,a.hideDetailForm=!0,a.getDisease=s,a.loginDetails=n.loggedInUserDetails,a.getMedications=t,a.saveUserMedication=p,a.testItArray=[],
//$scope.validFromDate = new Date();
a.getVariant=r,
//$scope.viewMode = $stateParams.type;
"view"==j.type?a.viewmode=!0:"edit"==j.type&&(a.editmode=!0),a.addTest=function(){a.testItArray.splice(0,0,{validFromDate:new Date})},j.appointmentId){var u={};a.apptPatientId=j.userId,u.appointmentId=j.appointmentId,g.fetchRecordsForEdit(u,function(b){b&&o(function(){a.testItArray=b,angular.forEach(a.testItArray,function(a,b){a.startDate&&null!=a.startDate&&(a.validFromDate=a.startDate),r(a.medication.id,a)}),a.userMedication.prescribedOriginallyBy=a.testItArray[0].prescribedOriginallyBy,a.userMedication.currentPrescriptionFrom=a.testItArray[0].currentPrescriptionFrom},100)},function(a){})}if("add"==j.type){a.userMedication.startDate=new Date;var v=angular.fromJson(localStorage.getItem("loggedInUser"));v.userAccountStatusDTO&&1==v.userAccountStatusDTO.whetherDoctor&&(a.userMedication.prescribedOriginallyBy={id:v.id,value:v.displayName},a.userMedication.currentPrescriptionFrom={id:v.id,value:v.displayName})}if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)a.whethersub=!0,a.userMedication.user={},a.userMedication.user.value=a.loginDetails.displayName,a.userMedication.user.id=a.loginDetails.id,a.getSystemOrg();else{var w=e.getDefaultOrgLocation();f.isFieldEmpty(w)||(a.userMedication.creatingOrganizationId=w.orgLoc)}j.userId&&(a.userMedication.user=j.userId),a.removeTest=function(b){a.testItArray[b].id&&null!=a.testItArray[b].id?a.testItArray[b].whetherDeleted=!0:a.testItArray.splice(b)},a.validateMedicationVariant=function(b,c){c.orderWithUs=!1;var d=0;angular.forEach(a.testItArray,function(a,c){a.medicationVariant&&a.medicationVariant.id==b.id&&1!=a.whetherDeleted&&d++}),d>1&&(h("alert",i.instant("SELECTED_MEDICATION_ALREADY_PRESENT")),delete c.medicationVariant)},a.cancel1=function(){b.cancel()},a.cancel=function(){f.isNullOrEmpty(j)||f.isNullOrEmpty(j.fromState)?f.goBackToPrevState():m.go("appointmentsListCardView",{keepLocalStorage:!0})},a.getUserNamesForRoleHistory=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)
//return httpService.getData(urlService.getParameterizedUrl('FIND_USER_NAME', $scope.userData), null, function (response) {
return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,f.isEmpty(b.data)||f.isEmpty(b.data.messages[0])||h("Alert",i.instant(b.data.messages[0]))})},a.getDiseaseVariant=function(b){a.queryObj={},a.queryObj.searchKeyWord=b,a.queryObj.appointmentId=j.appointmentId;var c=l.getParameterizedUrl("GET_DISEASE_VARIANT_BY_APPID",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){f.isEmpty(a.data)||f.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getDoctor=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){a.queryObj={},a.queryObj.searchString=b;var c=l.getParameterizedUrl("GET_ADVISED_BY_SEACRH_KEY",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.doctor=b.data,a.doctor},function(a){f.isEmpty(a.data)||f.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})}else if(a.queryObj={},a.queryObj.name=b,a.queryObj.locationId=a.userMedication.creatingOrganizationId.id,c=l.getParameterizedUrl("GET_DOCTOR_BY_ORGLOCID",a.queryObj))return k.getData(c,null,function(b){if(b&&b.data)return a.doctor=b.data,a.doctor},function(a){f.isEmpty(a.data)||f.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getFood=function(){var b=l.getUrl("GET_LINKED_TO_FOOD_LIST_DROPDOWN");b&&k.getData(b,null,function(b){b&&b.data&&(a.linkageWithFood=b.data)},function(a){f.isEmpty(a.data)||f.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getFood(),a.callManageMedication=function(c){a.newMedication=c,a.newMedication.beingUsed=!0,b.cancel(),m.go("manageusermedication",{type:"add",data:a.newMedication})}}]),angular.module("paripal.appointmentModule").controller("ManageAppointmentScheduleCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","datatableconfig","applicationExceptionService","featurePrivilegeConstants","dateconvertor","GoogleMap","NgMap","$timeout","manageAppointmentScheduleService","manageCalendarEventService","orgLocListService","$mdDialog","EmergencyTransactionService","commonBillingService","appointmentsUploadDownloadService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";function B(a,b,c,d){if(a.index=d,c){var c=angular.copy(c);c.startTime=new Date(c.date+" "+c.startTime),c.endTime=new Date(c.date+" "+c.endTime),a.WSAppointmentAdhoc=c}else a.WSAppointmentAdhoc={};a.cancel=function(){b.cancel()},a.addScheduleAppointment=function(){a.WSAppointmentAdhoc.index=a.index,b.hide(a.WSAppointmentAdhoc)}}
//        $scope.startDate = new Date();
//        $scope.endDate = new Date();
B.$inject=["$scope","$mdDialog","editData","index"],a.disabledFormFields=!1,a.commonConstants=A,b.showSpinner=!1,a.isSchedulePresent=!1,a.WSAppointment={},a.WSAppointmentWeekly={},a.WSAppointmentDaily={},a.WSAppointmentAdhocList=[],a.WSAppointmentDefinePerVisit={},a.WSScheduleAppointment={},a.showWeeklyTimings=!1,/*$scope.isSchedule = true;*/
a.$watchGroup(["WSScheduleAppointment.eventName","WSScheduleAppointment.fromDate","WSScheduleAppointment.tillDate","WSScheduleAppointment.frequency"],function(b,c){if(b[0]&&b[1]&&b[2]&&b[3]){a.timings=[],delete a.calTimings,a.weeklyAvailableDays={},delete a.WSAppointmentWeekly.startTime,delete a.WSAppointmentWeekly.endTime,a.isWeekly&&(a.WSAppointmentWeekly.isMondayRepeat=!1,a.WSAppointmentWeekly.isTuesdayRepeat=!1,a.WSAppointmentWeekly.isWednesdayRepeat=!1,a.WSAppointmentWeekly.isThursdayRepeat=!1,a.WSAppointmentWeekly.isFridayRepeat=!1,a.WSAppointmentWeekly.isSaturdayRepeat=!1,a.WSAppointmentWeekly.isSundayRepeat=!1);var d={};d.id=b[0].id,d.repeatFrequency=b[3].id,/* IMP : if the below code i.e. 'requestObj.eventStartDate = new Date(newVal[1])' does not return proper/accurate date use this code */
/*var startDate = newVal[1].split('-');
                requestObj.eventStartDate = new Date(startDate[0], startDate[1] - 1, startDate[2]);*/
d.eventStartDate=new Date(b[1]),d.eventEndDate=new Date(b[2]),a.isWeekly?j.postData(k.getUrl("WEEKLY_SCHEDULE_DAYS"),d,function(b){b&&b.data&&(a.weeklyAvailableDays=b.data,l.isNullOrEmpty(b.data.wsCalendarEvent)||0==b.data.wsCalendarEvent.isMondayRepeat&&0==b.data.wsCalendarEvent.isTuesdayRepeat&&0==b.data.wsCalendarEvent.isWednesdayRepeat&&0==b.data.wsCalendarEvent.isThursdayRepeat&&0==b.data.wsCalendarEvent.isFridayRepeat&&0==b.data.wsCalendarEvent.isSaturdayRepeat&&0==b.data.wsCalendarEvent.isSundayRepeat&&f("info",g.instant("NO_AVAILABLE_DAYS")))},function(a){}):j.postData(k.getUrl("SEARCH_SLOTS"),d,function(b){b&&b.data&&(a.timings=b.data,0==a.timings.length&&f("info",g.instant("NO_AVAILABLE_SLOTS")))},function(a){})}}),a.setDataToAppointmentForm=function(b){l.isEmpty(b)||(b.entityTypeDetails&&b.entityTypeDetails.id&&(a.WSAppointment.entityType=b.entityTypeDetails),b.entityId&&b.entityName&&(a.WSAppointment.entityName={id:b.entityId,value:b.entityName},"CAL_ORGANIZATION_USER"===a.WSAppointment.entityType.code?(a.isOrgUserEntityType=!0,a.getEntityImageInfo(b.entityId)):a.isOrgUserEntityType=!1),b.eventType&&(a.WSAppointment.eventType=b.eventType,"CAL_EVENT_HOME_VISIT"!=a.WSAppointment.eventType.code?a.getOrgLocationAddressDetails(b.organizationLocationId):a.isHomeVisit=!0),b.id&&b.eventName&&(a.WSAppointment.eventName={id:b.id,value:b.eventName},a.WSAppointment.eventId=b.id),a.WSAppointment.paymentToBeTaken=b.paymentToBeTaken,a.WSAppointment.orgLocId=b.organizationLocationId)},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()};
//datatble config json
var C={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=m.setOptionProperties(C),a.dtColumnDefs=m.setColumnProperties({}),a.changeTimings=function(b){a.calTimings=b,a.dailyStartTime=moment("1970-01-01T"+b.startTime).toDate(),a.dailyEndTime=moment("1970-01-01T"+b.endTime).toDate(),l.isNullOrEmpty(a.isDaily)||1==a.isDaily&&(a.WSAppointmentDaily.startTime=moment("1970-01-01T"+b.startTime).toDate(),a.WSAppointmentDaily.endTime=moment("1970-01-01T"+b.endTime).toDate()),l.isNullOrEmpty(a.isWeekly)||1==a.isWeekly&&(a.WSAppointmentWeekly.startTime=moment("1970-01-01T"+b.startTime).toDate(),a.WSAppointmentWeekly.endTime=moment("1970-01-01T"+b.endTime).toDate())},a.daysChecked=function(b){delete a.WSAppointmentWeekly.startTime,delete a.WSAppointmentWeekly.endTime,a.timings=[],"monday"==b?l.isNullOrEmpty(a.WSAppointmentWeekly.isMondayRepeat)?a.WSAppointmentWeekly.isMondayRepeat=!0:1==!a.WSAppointmentWeekly.isMondayRepeat?a.WSAppointmentWeekly.isMondayRepeat=!0:a.WSAppointmentWeekly.isMondayRepeat=!1:"tuesday"==b?l.isNullOrEmpty(a.WSAppointmentWeekly.isTuesdayRepeat)?a.WSAppointmentWeekly.isTuesdayRepeat=!0:1==!a.WSAppointmentWeekly.isTuesdayRepeat?a.WSAppointmentWeekly.isTuesdayRepeat=!0:a.WSAppointmentWeekly.isTuesdayRepeat=!1:"wednesday"==b?l.isNullOrEmpty(a.WSAppointmentWeekly.isWednesdayRepeat)?a.WSAppointmentWeekly.isWednesdayRepeat=!0:1==!a.WSAppointmentWeekly.isWednesdayRepeat?a.WSAppointmentWeekly.isWednesdayRepeat=!0:a.WSAppointmentWeekly.isWednesdayRepeat=!1:"thursday"==b?l.isNullOrEmpty(a.WSAppointmentWeekly.isThursdayRepeat)?a.WSAppointmentWeekly.isThursdayRepeat=!0:1==!a.WSAppointmentWeekly.isThursdayRepeat?a.WSAppointmentWeekly.isThursdayRepeat=!0:a.WSAppointmentWeekly.isThursdayRepeat=!1:"friday"==b?l.isNullOrEmpty(a.WSAppointmentWeekly.isFridayRepeat)?a.WSAppointmentWeekly.isFridayRepeat=!0:1==!a.WSAppointmentWeekly.isFridayRepeat?a.WSAppointmentWeekly.isFridayRepeat=!0:a.WSAppointmentWeekly.isFridayRepeat=!1:"saturday"==b?l.isNullOrEmpty(a.WSAppointmentWeekly.isSaturdayRepeat)?a.WSAppointmentWeekly.isSaturdayRepeat=!0:1==!a.WSAppointmentWeekly.isSaturdayRepeat?a.WSAppointmentWeekly.isSaturdayRepeat=!0:a.WSAppointmentWeekly.isSaturdayRepeat=!1:"sunday"==b&&(l.isNullOrEmpty(a.WSAppointmentWeekly.isSundayRepeat)?a.WSAppointmentWeekly.isSundayRepeat=!0:1==!a.WSAppointmentWeekly.isSundayRepeat?a.WSAppointmentWeekly.isSundayRepeat=!0:a.WSAppointmentWeekly.isSundayRepeat=!1)},a.showWeeklyAvailableTimings=function(){var b={};l.isNullOrEmpty(a.WSScheduleAppointment.eventName)||(b.id=a.WSScheduleAppointment.eventName.id),l.isNullOrEmpty(a.WSScheduleAppointment.fromDate)||(b.eventStartDate=new Date(a.WSScheduleAppointment.fromDate)),l.isNullOrEmpty(a.WSScheduleAppointment.tillDate)||(b.eventEndDate=new Date(a.WSScheduleAppointment.tillDate)),l.isNullOrEmpty(a.WSScheduleAppointment.frequency)||(b.repeatFrequency=a.WSScheduleAppointment.frequency.id),l.isNullOrEmpty(a.WSAppointmentWeekly.isMondayRepeat)||1==a.WSAppointmentWeekly.isMondayRepeat&&(b.isMondayRepeat=!0),l.isNullOrEmpty(a.WSAppointmentWeekly.isTuesdayRepeat)||1==a.WSAppointmentWeekly.isTuesdayRepeat&&(b.isTuesdayRepeat=!0),l.isNullOrEmpty(a.WSAppointmentWeekly.isWednesdayRepeat)||1==a.WSAppointmentWeekly.isWednesdayRepeat&&(b.isWednesdayRepeat=!0),l.isNullOrEmpty(a.WSAppointmentWeekly.isThursdayRepeat)||1==a.WSAppointmentWeekly.isThursdayRepeat&&(b.isThursdayRepeat=!0),l.isNullOrEmpty(a.WSAppointmentWeekly.isFridayRepeat)||1==a.WSAppointmentWeekly.isFridayRepeat&&(b.isFridayRepeat=!0),l.isNullOrEmpty(a.WSAppointmentWeekly.isSaturdayRepeat)||1==a.WSAppointmentWeekly.isSaturdayRepeat&&(b.isSaturdayRepeat=!0),l.isNullOrEmpty(a.WSAppointmentWeekly.isSundayRepeat)||1==a.WSAppointmentWeekly.isSundayRepeat&&(b.isSundayRepeat=!0),j.postData(k.getUrl("SEARCH_SLOTS"),b,function(b){b&&b.data&&(a.timings=b.data,a.showWeeklyTimings=!0)},function(a){})},a.$watch("WSScheduleAppointment.frequency",function(b){b&&b.id?(a.WSAppointmentWeekly={},a.WSAppointmentDaily={},a.isWeekly=!1,a.isDaily=!1,a.isAdhoc=!1,a.isDefinePerVisit=!1,"WEEKLY"==b.id&&(a.isWeekly=!0),"DAILY"==b.id&&(a.isDaily=!0),"ADHOC"==b.id&&(a.isAdhoc=!0),"DEFINE_PER_VISIT"==b.id&&(a.isDefinePerVisit=!0,a.WSScheduleAppointment.perVisitStartdate=p.convertToViewDate(new Date),a.WSScheduleAppointment.perVisitEndDate=a.WSScheduleAppointment.perVisitStartdate)):(a.isWeekly=!1,a.isDaily=!1,a.isAdhoc=!1,a.isDefinePerVisit=!1)},!0),a.defineSchedule=function(){a.isWeekly?t.createWeeklyObject(a.WSAppointmentWeekly,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isDaily?(l.isNullOrEmpty(a.dailyStartTime)||l.isNullOrEmpty(a.dailyEndTime)||(a.WSAppointmentDaily.eventStartTime=a.dailyStartTime,a.WSAppointmentDaily.eventEndTime=a.dailyEndTime,delete a.WSAppointmentDaily.startTime,delete a.WSAppointmentDaily.endTime),t.createDailyObject(a.WSAppointmentDaily,function(b){a.WSScheduleAppointment.scheduleDetails=b})):a.isAdhoc?t.createAdhocObject(a.WSAppointmentAdhocList,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isDefinePerVisit&&t.createDefinePerVisitObject(a.WSAppointmentDefinePerVisit,function(b){a.WSScheduleAppointment.scheduleDetails=b}),c.appointmentId&&(a.WSScheduleAppointment.appointmentId=c.appointmentId),c.requestId&&(a.WSScheduleAppointment.requestId=c.requestId),a.WSAppointment.eventName&&a.WSAppointment.eventName.id&&(a.WSScheduleAppointment.eventId=a.WSAppointment.eventName.id),t.defineSchedule(a.WSScheduleAppointment,c.type,function(e){b.showSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),a.isSchedulePresent=!0,c.parentState&&(c.parentType&&c.parentId?d.go(c.parentState,{scheduleId:e,id:c.parentId,type:c.parentType}):d.go(c.parentState,{scheduleId:e}))},function(a){b.showSpinner=!1,l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},a.scheduleAppointment=function(b,c,d){w.show({controller:B,templateUrl:"app/modules/appointment/views/schedule-appointment-popup.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:A.dialogBox.clickOutsideToClose,locals:{editData:c,index:d}}).then(function(b){var c=h("date")(b.startTime,"HH:mm:ss"),e=h("date")(b.endTime,"HH:mm:ss");b.index==-1?(b.startTime=c,b.endTime=e,delete b.index,a.WSAppointmentAdhocList.push(b)):(a.WSAppointmentAdhocList[d].startTime=c,a.WSAppointmentAdhocList[d].endTime=e)},function(){})},a.deleteScheduleAppointment=function(b){a.WSAppointmentAdhocList.splice(b,1)},a.editJson={},a.bindData=function(b){if(a.WSScheduleAppointment.fromDate=h("timestampToDate")(b.fromDate,"MM/dd/yyyy"),a.WSScheduleAppointment.tillDate=h("timestampToDate")(b.tillDate,"MM/dd/yyyy"),a.WSScheduleAppointment.frequency={id:b.frequency,value:g.instant(b.frequency)},"WEEKLY"==b.frequency&&t.editWeeklyObject(b,function(b){a.WSAppointmentWeekly=b,1==b.isMonday?a.isMonday=!0:1==b.isTuesday?a.isTuesday=!0:1==b.isWednesday?a.isWednesday=!0:1==b.isThursday?a.isThursday=!0:1==b.isFriday?a.isFriday=!0:1==b.isSaturday?a.isSaturday=!0:1==b.isSunday&&(a.isSunday=!0)}),"DAILY"==b.frequency){var c=h("timestampToDate")(b.fromDate,"MM/dd/yyyy");a.WSAppointmentDaily.startTime=new Date(c+" "+b.scheduleDetails[0].startTime),a.WSAppointmentDaily.endTime=new Date(c+" "+b.scheduleDetails[0].endTime)}if("ADHOC"==b.frequency&&(a.WSAppointmentAdhocList=b.scheduleDetails),"DEFINE_PER_VISIT"==b.frequency){var c=h("timestampToDate")(b.fromDate,"MM/dd/yyyy");b.perVisitStartdate=c,b.perVisitEndDate=c}},a.getScheduleDetailsById=function(c){l.isNullOrEmpty(c)||(b.showSpinner=!0,t.getScheduleDetailsById(c,function(c){b.showSpinner=!1,a.setDataToScheduleForm(c)},function(a){b.showSpinner=!1}))},a.setDataToScheduleForm=function(b){l.isEmpty(b)||(b.id&&(a.WSScheduleAppointment.id=b.id),b.entityType&&b.entityType.id&&(a.WSScheduleAppointment.entityType=b.entityType),b.eventType&&b.eventType.id&&(a.WSScheduleAppointment.eventType=b.eventType),b.event&&b.event.id&&(a.WSScheduleAppointment.eventName=b.event),b.serviceType&&b.serviceType.id&&(a.WSScheduleAppointment.serviceType=b.serviceType),b.patientId&&b.onBehalfOfName&&(a.WSScheduleAppointment.onBehalfOf={id:b.patientId,value:b.onBehalfOfName}),b.doctor&&b.doctor.id&&(a.WSScheduleAppointment.doctor=b.doctor),b.problemDescription&&(a.WSScheduleAppointment.problemDescription=b.problemDescription),b.loggedInUserId&&(a.WSScheduleAppointment.loggedInUserId=b.loggedInUserId),a.bindData(b))},
//Init Method
a.init=function(){/*$stateParams.parentState="current callback State";

            $stateParams.scheduleId=null;
            $stateParams.entityType = {
                    "id":418,
                    "value":"Organization User",
                    "code":"CAL_ORGANIZATION_USER"
            };

            $stateParams.eventType = {
                code:"CAL_EVENT_APPT",
                id:421,
                value:"Appointment"
            };
            $stateParams.serviceType = {"id":3,"value":"EMERGENCY_ADMISSION"};
            $stateParams.onBehalfOf = {
                id: "66",
                value: "Tata2 Client2"
            };
            $stateParams.doctor = {
                id: "230",
                value: "Maimangeshkardoc1"
            };

            $stateParams.problemDescription = "ABC";
            $scope.WSScheduleAppointment.loggedInUserId = 53;
            $scope.WSScheduleAppointment.onBehalfOfCellPhone= "2323232323";
            $scope.WSScheduleAppointment.onBehalfOfAddress= "karvenagar";

            $stateParams.scheduleId = null;
            $stateParams.type="add";*/
"add"===c.type?a.pageState="add":"edit"===c.type?(a.pageState="edit",a.disabledFormFields=!1):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0),c.scheduleId&&a.getScheduleDetailsById(c.scheduleId),c.fromDate&&(a.WSScheduleAppointment.fromDate=c.fromDate),c.tillDate&&(a.WSScheduleAppointment.tillDate=c.tillDate),c.entityType&&c.entityType.id&&(a.WSScheduleAppointment.entityType=c.entityType),c.eventType&&c.eventType.id&&(a.WSScheduleAppointment.eventType=c.eventType),c.serviceType&&c.serviceType.id&&(a.WSScheduleAppointment.serviceType=c.serviceType),c.onBehalfOf&&c.onBehalfOf.id?a.WSScheduleAppointment.onBehalfOf=c.onBehalfOf:c.onBehalfOf&&c.onBehalfOf.value&&(a.WSScheduleAppointment.onBehalfOf={},a.WSScheduleAppointment.onBehalfOf.value=c.onBehalfOf.value),c.doctor&&c.doctor.id&&(a.WSScheduleAppointment.doctor=c.doctor),c.problemDescription&&(a.WSScheduleAppointment.problemDescription=c.problemDescription),c.loggedInUserId&&(a.WSScheduleAppointment.loggedInUserId=c.loggedInUserId),c.onBehalfOfCellPhone&&(a.WSScheduleAppointment.onBehalfOfCellPhone=c.onBehalfOfCellPhone),c.onBehalfOfAddress&&(a.WSScheduleAppointment.onBehalfOfAddress=c.onBehalfOfAddress),a.WSScheduleAppointment.entityType&&a.WSScheduleAppointment.entityType.code&&a.WSScheduleAppointment.eventType&&a.WSScheduleAppointment.eventType.code&&a.WSScheduleAppointment.doctor&&a.WSScheduleAppointment.doctor.id&&(a.eventName={queryUrl:"GET_EVENT_LIST_BY_ENTITY",queryParameter:{entityTypeValue:a.WSScheduleAppointment.entityType.code,eventTypeValue:a.WSScheduleAppointment.eventType.code,entityId:a.WSScheduleAppointment.doctor.id}}),a.frequency={queryUrl:"GET_LIST_SCHEDULE_FREQUENCY"}},a.init()}]),angular.module("paripal.appointmentModule").controller("ManageCheckInOutAllotCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","$mdDialog","baseService","httpService","urlService","utilService","applicationExceptionService","featurePrivilegeConstants","dateconvertor","manageFixAppointmentService","manageCheckInOutAllotService","commonBillingService","manageCalendarEventService","appointmentsUploadDownloadService","commonConstants","addOrgLocClientService","appointmentsListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";function y(a,b,c,d,e,f,g,h,i,j){a.transactionList=h,a.selectedTransaction=[],a.currentTransaction=j,a.addRemoveTransaction=function(b){var c=!1;angular.forEach(a.selectedTransaction,function(d,e){d.transactionId==b.transactionId&&(a.selectedTransaction.splice(e,1),c=!0)}),0==c&&a.selectedTransaction.push(b)},a.createBill=function(){angular.forEach(a.transactionList,function(b,c){b.transactionId==a.currentTransaction&&a.selectedTransaction.push(b)}),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&(null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes),(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate,(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes}),b.cancel(),f.go("createbill",{type:"DEBIT",data:i,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})},a.cancel=function(){b.cancel()}}function z(a,b,d,e,f,h,i,j,n,o,p){"AT_CHECKOUT"==n.paymentToBeTaken&&"CHECKEDOUT"!=n.actionTaken&&(a.disableGenerateBill=!0),m.isNullOrEmpty(p)||(a.disableGenerateBill=p),n.billIdWithResidualFS?a.isAutobillMade=!0:a.isAutobillMade=!1,a.cancel=function(){b.cancel()},a.later=function(){b.cancel()},a.viewBill=function(){b.cancel();var a={};a.entityName=n.entityName,a.apptDate=n.apptDate,a.event=n.eventName,h.go("managebill",{parentState:"APPOINTMENT",billId:n.billIdWithResidualFS,type:"view",createReceipt:!0,appointmentDetails:a})},a.prepareAdhocBill=function(){b.cancel();var c={};m.isNullOrEmpty(j.response)?m.isNullOrEmpty(j.transactionId)||(c.transactionId=j.transactionId):c.transactionId=j.response.transactionId,m.isNullOrEmpty(j.response)?m.isNullOrEmpty(j.appointmentId)||(c.appointmentId=j.appointmentId):c.appointmentId=j.response.appointmentId,m.isNullOrEmpty(n.organizationLocationId)||(c.locationId=n.organizationLocationId),m.isNullOrEmpty(n.serviceType)||m.isNullOrEmpty(n.serviceType.id)||(c.serviceTypeId=n.serviceType.id),c.whetherWalkinAppointment=!0,k.postData(l.getUrl("GET_ADHOC_BILL_SETUP"),c,function(d){if(m.isFieldEmpty(d.data))b.cancel();else{var e={};n.organizationLocationId?e.organizationLocation={id:n.organizationLocationId}:n.orgLocId&&(e.organizationLocation={id:n.orgLocId});var f=angular.copy(d.data);f.fromCheckIn=!0,f.raisedOnDetails={raisedOnUserId:f.raisedOnUserId.id,raisedOnName:f.raisedOnUserId.value},f.transaction={id:c.transactionId},e.onBehalfofUser={id:f.raisedOnUserId.id,value:f.raisedOnUserId.value},k.postData(l.getUrl("GET_ALL_UNBUILD_TRANSACTIONS"),e,function(d){if(d.data&&d.data.length>1)b.cancel(),b.show({controller:y,templateUrl:"app/modules/billing/views/unbilled-transaction-list.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{transactionList:d.data,paramData:f,currentTransaction:c.transactionId}});else if(d.data&&1==d.data.length){var e=d.data[0];a.selectedTransaction=[],a.selectedTransaction.push(e),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),h.go("createbill",{type:"DEBIT",data:f,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})}},function(a){}),b.cancel();/* SERVER params to be sent */
var f=angular.copy(d.data);f.fromCheckIn=!0,f.raisedOnDetails={raisedOnUserId:f.raisedOnUserId.id,raisedOnName:f.raisedOnUserId.value},f.transaction={id:c.transactionId}}},function(a){})},a.generateBill=function(){b.cancel();var a={};a.transactionId=[],m.isNullOrEmpty(j.response)?a.transactionId.push(j.transactionId):a.transactionId.push(j.response.transactionId),d.generateBill(a.transactionId,function(a){var c=null;c=j.response?j.response.appointmentId:j.appointmentId?j.appointmentId:null,c&&e.setIsBilledOfAppointment(c,function(c){b.cancel();var d={};d.entityName=n.entityName,d.apptDate=n.apptDate,d.event=n.eventName,h.go("managebill",{parentState:"APPOINTMENT",billId:a.response,type:"view",createReceipt:!0,appointmentDetails:d})},function(a){})},function(a){var d=b.confirm().title(g.instant("FEE_TYPE_NOT_FOUND_TITLE")).textContent(g.instant("APPOINTMENT_FEE_NOT_FOUND_BODY")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));b.show(d).then(function(){},function(){h.go("appointmentsList",c)})},{handleError:!1})}}y.$inject=["$scope","$mdDialog","commonBillingService","manageCheckInOutAllotService","notify","$state","$rootScope","transactionList","paramData","currentTransaction"],z.$inject=["$scope","$mdDialog","commonBillingService","manageCheckInOutAllotService","notify","$state","$rootScope","successResponse","WSAppointment","organizationObj","disableGenerateBill"],a.WSAppointment={},a.diseaseVariantList=[],a.WSAppointment.isFreeVisit=!1,a.WSAppointment.isBillable=!1,a.WSAppointment.isWalkIn=!1,a.WSAppointment.billPaid=!1,a.WSAppointment.isFollowUp=!1,a.WSAppointment.isNewUHID=!1,a.WSAppointment.billPaid=!1,a.commonConstants=v,a.isFreeVisitDisabled=!0,a.isBillableDisabled=!0,a.isWalkInDisabled=!0,a.isBillPaidDisabled=!0,a.isFollowUpDisabled=!0,a.isNewUhidDisabled=!0,a.WSClientExtraData={},a.guardianData={},a.isStartTimeRequired=!1,a.isEndTimeRequired=!1,a.isStartTimeDisabled=!0,a.isEndTimeDisabled=!0,a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.disabledFormFields=!1,b.showSpinner=!1,a.isOrgUser=!1,a.eventType={queryUrl:"GET_APPOINTMENT_EVENT_TYPE",queryParameter:{}},a.showCell=!1,a.dialogOpen=!1,a.$watch("WSAppointment.eventType",function(b,c){b&&b.id?(a.isEventNameDisabled=!1,a.WSAppointment.entityName&&a.WSAppointment.entityName.id?a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:a.WSAppointment.entityName.id}}:a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:b.id,entityId:0}}):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.getCityNameData=function(b){return a.requestData={},a.requestData.searchString=b,a.requestData.noOfSuggestions=v.smartSearchRecordLimit,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_CITY_DISTRICT_BY_STRING",a.requestData),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.calculateDateOfBirth=function(){
//changes done to calculate birthDate by age and month
var b,c;b=a.WSClientExtraData.age?(new Date).getFullYear()-a.WSClientExtraData.age:(new Date).getFullYear(),c=a.WSClientExtraData.month?(new Date).getMonth()-a.WSClientExtraData.month:(new Date).getMonth(),a.guardianData.birthDate=new Date(b,c,(new Date).getDate()),a.dobChanged(a.WSClientExtraData.age)},a.$watch("guardianData.birthDate",function(b){if(b){var c=Date.now()-new Date(b).getTime(),d=new Date(c);// miliseconds from epoch
a.WSClientExtraData.age=Math.abs(d.getUTCFullYear()-1970);var e=(new Date).valueOf()-new Date(b).valueOf(),f=Math.floor(e%31536e6/864e5),g=Math.floor(f/30);a.WSClientExtraData.month=g,a.WSClientExtraData.age<18?(a.guardianData.guardianCheck=!0,a.userList&&(a.guardianData.guardian={id:a.userList[0].userId,value:a.userList[0].displayName})):(a.guardianData.guardianCheck=!1,a.guardianData.guardian={})}}),a.setDirectiveFn=function(b){a.dobChanged=b},/*$scope.serviceType = {
            queryUrl: "GET_SERVICE_TREATMENT_TYPE",
            queryParameter: {
                calendarEventId: 1
            }
        };*/
a.$watch("WSAppointment.entityName",function(b){b&&b.id&&("CAL_PROCESS"==a.WSAppointment.entityType.code?(a.isSpecificProfessionalDisabled=!1,a.specificDoctor={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.isSpecificProfessionalDisabled=!0)},!0),a.$watch("WSAppointment.patientPhoneNumber",function(b){m.isNullOrEmpty(b)&&(a.WSAppointment.patient=null,a.WSClientExtraData.selectUserId=null,a.WSAppointment.patientAddress=null,a.WSAppointment.addressInfo=null)},!0),a.$watch("WSAppointment.serviceType",function(b){b&&b.id&&a.WSAppointment.eventName&&a.WSAppointment.patient&&a.WSAppointment.patient.id&&a.getFreeVisitDetails(a.WSAppointment.eventName.id,b.id,a.WSAppointment.patient.id)},!0),a.$watch("WSAppointment.isFreeVisit",function(b,d){b?"RECORDWALKIN"===c.appointmentType&&(a.WSAppointment.isBillable=!1,a.WSAppointment.billPaid=!1):"RECORDWALKIN"===c.appointmentType&&(a.WSAppointment.isBillable=!0)},!0),a.$watch("WSAppointment.patient",function(d,e){if(d&&d.id){if(a.showCell=!0,"RECORDWALKIN"===c.appointmentType){b.showSpinner=!0;var f=null;c.eventName&&c.eventName.id?f=c.eventName.id:a.WSAppointment.eventName&&a.WSAppointment.eventName.id&&(f=a.WSAppointment.eventName.id),q.getOnBehalfAddressDetails(d.id,f,function(c){b.showSpinner=!1,a.WSAppointment.patientPhoneNumber=c.phoneNumber,a.WSAppointment.uhidNumber=c.uhidnumber,a.WSAppointment.uhidNumber&&(a.patientId=c.uhidnumber),a.patientId=c.uhidnumber,a.WSAppointment.patientAddress=c.userAddress,a.WSAppointment.addressInfo=c.addressInfo}),a.WSAppointment.wetherUserExist=!0,a.wetherUserExist=!0}a.WSAppointment.eventName&&a.WSAppointment.serviceType&&a.WSAppointment.serviceType.id&&a.getFreeVisitDetails(a.WSAppointment.eventName.id,a.WSAppointment.serviceType.id,d.id)}else a.patientId&&(a.patientId=null,delete a.WSAppointment.uhidNumber),
// $scope.guardianData.guardianCheck = true;
// if($scope.userList){
//     if($scope.userList[0].age>18){
//         $scope.guardianData.guardian ={
//         id:$scope.userList[0].userId,
//         value:$scope.userList[0].displayName
// }
//     }
// }
a.WSAppointment.wetherUserExist=!1,a.wetherUserExist=!1,d&&(a.patientString=d)},!0),a.paymentMethod=function(b){if("AT_BOOKING"===a.WSAppointment.paymentToBeTaken&&b){var e={transactionId:b};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"FIX_APPOINTMENTS"})),EmergencyTransactionService.getWhetherBillDetails(e,function(a){d.go("billsummaryview",{transactionId:b})},function(a){var b=i.confirm().title(g.instant("FEE_TYPE_NOT_FOUND_TITLE")).textContent(g.instant("APPOINTMENT_FEE_NOT_FOUND_BODY")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));i.show(b).then(function(){},function(){d.go("appointmentsList",c)})},{handleError:!1})}},a.saveCheckInOutAllotment=function(e){e.$valid&&(m.isFieldEmpty(c.orgLocation)||(a.WSAppointment.organizationLocationId=c.orgLocation,m.isFieldEmpty(c.locationName)||(a.locationName=c.locationName)),m.isFieldEmpty(a.WSAppointment.noOfPeriod)||m.isFieldEmpty(a.WSAppointment.periodType)||("Month"==a.WSAppointment.periodType?a.daysEquivalent=30*a.WSAppointment.noOfPeriod:"Week"==a.WSAppointment.periodType?a.daysEquivalent=7*a.WSAppointment.noOfPeriod:"Days"==a.WSAppointment.periodType&&(a.daysEquivalent=a.WSAppointment.noOfPeriod),m.isFieldEmpty(a.daysEquivalent)||(a.followUpDate=new Date(a.WSAppointment.apptDate),a.followUpDate.setDate(a.followUpDate.getDate()+parseInt(a.daysEquivalent)))),b.showSpinner=!0,m.isFieldEmpty(a.followUpDate)||(a.WSAppointment.followUpDate=a.followUpDate),m.isFieldEmpty(c.clientId)||(a.WSAppointment.clientId=c.clientId),m.isFieldEmpty(a.wetherUserExist)||(a.WSAppointment.whetherExistingUser=a.wetherUserExist,1==a.WSAppointment.wetherUserExist&&a.WSAppointment.patient&&a.WSAppointment.patient.id&&(a.WSAppointment.existingUserId=a.WSAppointment.patient.id)),m.isFieldEmpty(a.guardianData.birthDate)||(a.WSAppointment.birthDate=a.guardianData.birthDate),m.isFieldEmpty(a.WSClientExtraData.age)||(a.WSAppointment.age=a.WSClientExtraData.age),m.isFieldEmpty(a.guardianData.guardianCheck)||(a.WSAppointment.hasGuardian=a.guardianData.guardianCheck),m.isNullOrEmpty(a.guardianData.guardian)||(a.WSAppointment.guardianId=a.guardianData.guardian.id,a.WSAppointment.guardianName=a.guardianData.guardian.value),m.isNullOrEmpty(a.isForwarded)?a.WSAppointment.isForwarded=!1:a.WSAppointment.isForwarded=a.isForwarded,m.isNullOrEmpty(a.WSAppointment)||m.isNullOrEmpty(a.WSAppointment.patient)||m.isNullOrEmpty(a.WSAppointment.patient.value)||(a.WSAppointment.patient.value=a.WSAppointment.patient.value.replace(/\-.*/,"")),r.saveCheckInOutAllotment(a.WSAppointment,c.appointmentId,c.appointmentType,function(e){if(b.showSpinner=!1,a.disabledFormFields=!0,a.isSaveHide=!0,a.WSAppointment.id||(a.WSAppointment.id=e.response.appointmentId),!a.requestObject){var h=j.getLoggedInUser();a.requestObject={},a.requestObject.module="appointmentId",a.requestObject.moduleNameAndUser="findAttachmentByAppointmentAndUser",a.requestObject.moduleName="deleteAttachmentsByAppointmentIdAndDocId",a.requestObject.forId=a.WSAppointment.id,a.requestObject.userId=h.id}if(("CHECKEDIN"==c.appointmentType&&"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"==c.appointmentType&&"AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken||"CHECKEDIN"==c.appointmentType&&"AT_BOOKING"===a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"==c.appointmentType&&"AT_BOOKING"===a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"==c.appointmentType&&"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1==a.WSAppointment.isBillable)if(0==a.WSAppointment.billPaid){if(e.transactionId)if("CHECKEDOUT"==c.appointmentType)if(m.isFieldEmpty(a.WSAppointment.billId)){if(b.showSpinner=!1,!m.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!m.isNullOrEmpty(a.locationName))var k={id:a.WSAppointment.organizationLocationId,value:a.locationName};if(!m.isNullOrEmpty(a.WSAppointment.isFreeVisit)&&1==a.WSAppointment.isFreeVisit)var l=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&i.show({controller:z,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:k,disableGenerateBill:l}})}else{var n=null;n=e.response?e.response.appointmentId:e.appointmentId?e.appointmentId:null,n&&r.setIsBilledOfAppointment(n,function(b){var c={};c.entityName=a.WSAppointment.entityName,c.apptDate=a.WSAppointment.apptDate,c.event=a.WSAppointment.eventName,d.go("managebill",{parentState:"APPOINTMENT",billId:successResponseObj.response,type:"view",createReceipt:!0,appointmentDetails:c})},function(a){}),b.showSpinner=!1}else{if(b.showSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),!m.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!m.isNullOrEmpty(a.locationName))var k={id:a.WSAppointment.organizationLocationId,value:a.locationName};if(!m.isNullOrEmpty(a.WSAppointment.isFreeVisit)&&1==a.WSAppointment.isFreeVisit)var l=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&i.show({controller:z,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:k,disableGenerateBill:l}})}}else{if(!m.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!m.isNullOrEmpty(a.locationName))var k={id:a.WSAppointment.organizationLocationId,value:a.locationName};var l=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&i.show({controller:z,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:k,disableGenerateBill:l}})}else{if(1==a.WSAppointment.isBillable&&"RECORDWALKIN"==c.appointmentType&&("RECORDWALKIN"==c.appointmentType&&"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken||"RECORDWALKIN"==c.appointmentType&&"AT_BOOKING"===a.WSAppointment.paymentToBeTaken)&&1==a.WSAppointment.isBillable)if(0==a.WSAppointment.billPaid||m.isFieldEmpty(a.WSAppointment.billPaid)){if(b.showSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),!m.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!m.isNullOrEmpty(a.locationName))var k={id:a.WSAppointment.organizationLocationId,value:a.locationName};a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&(a.dialogOpen=!0,i.show({controller:z,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),onRemoving:function(){a.dialogOpen=!1},clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e.response,WSAppointment:a.WSAppointment,organizationObj:k,disableGenerateBill:null}}))}else{if(!m.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!m.isNullOrEmpty(a.locationName))var k={id:a.WSAppointment.organizationLocationId,value:a.locationName};var l=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&i.show({controller:z,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e.response,WSAppointment:a.WSAppointment,organizationObj:k,disableGenerateBill:l}})}if(f("success",g.instant("RECORD_UPDATED_SUCCESSFULLY")),!m.isNullOrEmpty(a.WSAppointment.organizationLocationId)&&!m.isNullOrEmpty(a.locationName))var k={id:a.WSAppointment.organizationLocationId,value:a.locationName};if(!m.isNullOrEmpty(a.WSAppointment.isFreeVisit)&&1==a.WSAppointment.isFreeVisit)var l=!0;a.WSAppointment&&("AT_CHECKOUT"===a.WSAppointment.paymentToBeTaken&&"CHECKEDOUT"==c.appointmentType||"AT_CHECKIN"===a.WSAppointment.paymentToBeTaken)&&1!=a.WSAppointment.billPaid&&0==a.dialogOpen&&i.show({controller:z,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{successResponse:e,WSAppointment:a.WSAppointment,organizationObj:k,disableGenerateBill:l}})}},function(a){b.showSpinner=!1,a.data&&a.data.messages&&a.data.messages.length>0?f("error",g.instant(a.data.messages[0])):f("error",g.instant("FAILED_TO_SAVE_RECORD"))},a.patientString))},a.WSApptUserDetails={},a.getUserByAppointmentId=function(){var b=j.getLoggedInUser();a.requestObject={},a.requestObject.module="appointmentId",a.requestObject.moduleNameAndUser="findAttachmentByAppointmentAndUser",a.requestObject.moduleName="deleteAttachmentsByAppointmentIdAndDocId",a.requestObject.forId=c.appointmentId,a.requestObject.userId=b.id;var d={pathName:"findUsersByAppointmentId",id:c.appointmentId};u.getUsersByAppointmentOrRequestId(d,function(b){a.WSApptUserDetails.userList=b})},a.onUserSelection=function(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")},a.getCheckInOutAllotment=function(d,e){m.isNullOrEmpty(d)||(b.showSpinner=!0,r.getCheckInOutAllotment(d,function(d){b.showSpinner=!1,m.isNullOrEmpty(d.status)||(a.checkInOutInfo=d.status.code,"CHECKEDOUT"==c.appointmentType&&"CHECKED_OUT"!=a.checkInOutInfo||"CHECKEDIN"==c.appointmentType&&("NEW"==a.checkInOutInfo||"FORWARDED"==a.checkInOutInfo)||"CHECKEDOUT"!=c.appointmentType&&"CHECKEDIN"!=c.appointmentType?a.isSaveHide=!1:a.isSaveHide=!0),a.setDataToCheckInOutAllotment(d)}))},a.getClientDetails=function(b,d){m.isNullOrEmpty(b)||r.getClientDetails(b,function(b){"RECORDWALKIN"!==c.appointmentType&&a.getCheckInOutAllotment(c.appointmentId),a.WSAppointment.patient={id:angular.fromJson(b).userId,value:angular.fromJson(b).patientName},a.WSAppointment.patientPhoneNumber=angular.fromJson(b).phoneNumber,a.WSAppointment.uhidNumber=angular.fromJson(b).uhidnumber,a.patientId=a.WSAppointment.uhidNumber,a.WSAppointment.patientAddress=angular.fromJson(b).userAddress})},a.getUserImageInfo=function(b,c){m.isNullOrEmpty(b)||j.getUserImageInfo(b,function(b){a.setUserImageInfo(b,c)},function(b){a.setUserImageInfo("app/images/user.jpg",c)})},a.setUserImageInfo=function(b,c){"ENTITY"===c?a.entityImageUrl=b:"PATIENT"===c?a.patientImageUrl=b:"ISSUED_BY"===c?a.issuedByImageUrl=b:"ALLOCATED_BY"===c?a.allocatedByImageUrl=b:"FORWARDED_BY"===c&&(a.forwardedByImageUrl=b)},a.setDataToCheckInOutAllotment=function(b){m.isEmpty(b)||(a.WSAppointment.billIdWithResidualFS=b.billIdWithResidualFS,a.wetherUserExist=b.wetherUserExist,/*if (!$scope.wetherUserExist) {
    $scope.checkUsersMobileNo(responseData.patientPhoneNumber);
}*/
//$scope.WSAppointment = angular.copy(responseData);
b.entityType&&b.entityType.id&&(a.WSAppointment.entityType=b.entityType,"CAL_ORGANIZATION_USER"==b.entityType.code?a.isOrgUser=!0:a.isOrgUser=!1,"CAL_PROCESS"==b.entityType.code?a.isProcessEntity=!0:a.isProcessEntity=!1),b.entityName&&b.entityName.id&&(a.WSAppointment.entityName=b.entityName,a.isOrgUser&&a.getUserImageInfo(a.WSAppointment.entityName.id,"ENTITY"),"CAL_PROCESS"==b.entityType.code&&(a.forwardedTo={queryUrl:"GET_PROFESSIONAL_FORWARDED_TO",queryParameter:{processId:b.entityName.id}})),b.eventType&&b.eventType.id&&(a.WSAppointment.eventType=b.eventType),b.eventName&&b.eventName.id&&(a.WSAppointment.eventName=b.eventName),b.apptDate&&(a.WSAppointment.apptDate=h("timestampToDate")(b.apptDate,"MM/dd/yyyy"),a.patient={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(a.WSAppointment.apptDate),eventId:a.WSAppointment.eventName.id}}),b.apptStartTime&&(a.WSAppointment.apptStartTime=b.apptStartTime),b.checkInTime?a.WSAppointment.checkInTime=new Date(a.WSAppointment.apptDate+" "+b.checkInTime):a.WSAppointment.checkInTime=new Date,b.checkOutTime&&(a.WSAppointment.checkOutTime=new Date(a.WSAppointment.apptDate+" "+b.checkOutTime)),"CHECKEDOUT"!==c.appointmentType||b.checkOutTime||(a.WSAppointment.checkOutTime=new Date),b.uhidNumber&&(a.WSAppointment.uhidNumber=b.uhidNumber),b.patientPhoneNumber&&(a.WSAppointment.patientPhoneNumber=b.patientPhoneNumber),b.patientAddress&&(a.WSAppointment.patientAddress=b.patientAddress),b.patient&&b.patient.id&&(a.WSAppointment.patient=b.patient,a.getUserImageInfo(a.WSAppointment.patient.id,"PATIENT")),b.patientId&&(a.patientId=b.patientId,a.WSAppointment.uhidNumber=a.patientId),b.serviceType&&b.serviceType.id?(a.WSAppointment.serviceType=b.serviceType,a.showServiceSearch=!1):a.showServiceSearch=!0,b.tokenNumber&&(a.WSAppointment.tokenNumber=b.tokenNumber,a.isToken=!0),b.tokenIssuedBy&&b.tokenIssuedBy.id&&(a.WSAppointment.tokenIssuedBy=b.tokenIssuedBy,a.getUserImageInfo(a.WSAppointment.tokenIssuedBy.id,"ISSUED_BY")),b.allocatedTo&&b.allocatedTo.id&&(a.WSAppointment.allocatedTo=b.allocatedTo),b.allocatedBy&&b.allocatedBy.id,b.forwardedTo&&b.forwardedTo.id&&(a.WSAppointment.forwardedTo=b.forwardedTo),b.forwardedBy&&b.forwardedBy.id&&(a.WSAppointment.forwardedBy=b.forwardedBy,a.getUserImageInfo(a.WSAppointment.forwardedBy.id,"FORWARDED_BY")),b.allocatedOn,b.forwardedOn&&("FORWARDED"===c.appointmentType?a.WSAppointment.forwardedOn=h("date")(new Date,"HH:mm:ss"):a.WSAppointment.forwardedOn=b.forwardedOn),b.tokenIssuedAt&&(a.WSAppointment.tokenIssuedAt=h("timestampToDate")(b.tokenIssuedAt,"MM/dd/yyyy")),b.transactionId&&(a.WSAppointment.transactionId=b.transactionId),b.tokenGenerated&&(a.WSAppointment.tokenGenerated=b.tokenGenerated),b.paymentToBeTaken&&(a.WSAppointment.paymentToBeTaken=b.paymentToBeTaken,"CHECKEDIN"===c.appointmentType&&"AT_CHECKIN"==a.WSAppointment.paymentToBeTaken||"CHECKEDOUT"===c.appointmentType&&"AT_CHECKOUT"==a.WSAppointment.paymentToBeTaken?a.isServiceRequired=!0:a.isServiceRequired=!1),b.billPaid?a.WSAppointment.billPaid=b.billPaid:a.WSAppointment.billPaid=!1,b.isBillable?a.WSAppointment.isBillable=b.isBillable:a.WSAppointment.isBillable=!1,b.followUp?a.WSAppointment.isFollowUp=b.followUp:a.WSAppointment.isFollowUp=!1,b.freeVisit?a.WSAppointment.isFreeVisit=b.freeVisit:a.WSAppointment.isFreeVisit=!1,b.newUhid?a.WSAppointment.isNewUHID=b.newUhid:a.WSAppointment.isNewUHID=!1,b.walkin?a.WSAppointment.isWalkIn=b.walkin:a.WSAppointment.isWalkIn=!1,b.wetherUserExist?a.WSAppointment.wetherUserExist=b.wetherUserExist:a.WSAppointment.wetherUserExist=!1,b.location&&(a.location=b.location),b.organization&&(a.organization=b.organization),b.disease&&b.diseaseVariant&&(a.WSAppointment.wsTreatmentHistoryRelatedToAppointment.disease=b.disease,a.diseaseVariantList.push(b.diseaseVariant)),b.addressInfo&&(a.WSAppointment.addressInfo=b.addressInfo),"CHECKEDOUT"==c.appointmentType&&b.allocatedTo&&b.allocatedTo.id&&(a.WSAppointment.wsTreatmentHistoryRelatedToAppointment.doctor=b.allocatedTo,a.WSAppointment.wsTreatmentHistoryRelatedToAppointment.actionTaken=c.appointmentType),!a.WSAppointment.isFreeVisit&&("AT_CHECKIN"==a.WSAppointment.paymentToBeTaken||"AT_CHECKOUT"==a.WSAppointment.paymentToBeTaken),a.isRecordWalkIn?a.WSAppointment.isWalkIn=!0:a.isCheckIn&&(a.WSAppointment.isWalkIn=!1))},
// on cancel forward to search list
a.cancel=function(){c.calendarState&&c.callingPage?d.go(c.callingPage,{data:c.calendarState.data}):m.goBackToPrevState()},a.manageCreateClient=function(b){var e={};c.appointmentId&&(e.appointmentId=c.appointmentId),e.type="add",e.appointmentType=c.appointmentType,e.urlState=c.urlState,e.data={},e.data.organizationLocation={},a.organization&&(e.data.organizationLocation.organization=a.organization),a.location&&(e.data.organizationLocation.id=a.location.id,e.data.organizationLocation.displayName=a.location.value),e.entityType=c.entityType,e.entityName=c.entityName,e.eventType=c.eventType,e.eventName=c.eventName,a.WSAppointment.patient&&a.WSAppointment.patient.id?w.userDetailsInfo(a.WSAppointment.patient.id,function(a){e.data.userByUserId=a,d.go("addorglocclient",e)},function(a){}):(a.patient.queryParameter&&a.patient.queryParameter.userName&&(e.data.userByUserId={nameValue:a.patient.queryParameter.userName},a.WSAppointment.patientPhoneNumber&&(e.data.userByUserId.cell1=a.WSAppointment.patientPhoneNumber)),d.go("addorglocclient",e))},a.getCalendarEventDetails=function(d){m.isNullOrEmpty(d)||(b.showSpinner=!0,t.getCalendarEventDetails(d,function(d){b.showSpinner=!1,"RECORDWALKIN"==c.appointmentType&&("AT_BOOKING"!=d.paymentToBeTaken&&"AT_CHECKIN"!=d.paymentToBeTaken||(a.isServiceRequired=!0)),a.setDataToAppointmentFormForm(d)}))},a.setDataToAppointmentFormForm=function(b){m.isEmpty(b)||(b.entityTypeDetails&&b.entityTypeDetails.id&&(a.WSAppointment.entityType=b.entityTypeDetails),b.entityName&&b.entityId&&(a.WSAppointment.entityName={id:b.entityId,value:b.entityName}),b&&b.eventType&&(a.WSAppointment.eventType=b.eventType),b&&b.id&&b.eventName&&(a.WSAppointment.eventName={id:b.id,value:b.eventName}),b&&b.paymentToBeTaken&&(a.WSAppointment.paymentToBeTaken=b.paymentToBeTaken),b&&b.organizationLocationId&&(a.WSAppointment.orgLocId=b.organizationLocationId),b&&b.organizationLocationId&&b.organizationLocationName&&(a.location={id:b.organizationLocationId,value:b.organizationLocationName}),b&&b.organizationId&&b.organizationName&&(a.organization={id:b.organizationId,value:b.organizationName}),a.patient={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(a.WSAppointment.apptDate),eventId:c.eventName.id}},a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===a.WSAppointment.entityType.code?(a.isProcess=!0,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:0}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===a.WSAppointment.entityType.code?(a.isEquipment=!0,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===a.WSAppointment.entityType.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}}):"CAL_ORGANIZATION_USER"===a.WSAppointment.entityType.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}}))},a.getFreeVisitDetails=function(c,d,e){m.isNullOrEmpty(c)||(b.showSpinner=!0,q.getFreeVisitDetails(c,d,e,function(c){if(b.showSpinner=!1,c.data.isFreeVisit){if(a.WSAppointment.isFreeVisit=!0,a.isFreeVisitDisabled=!1,a.WSAppointment.isBillable=!1,1==a.WSAppointment.billPaid){var d=i.alert().title(g.instant("INFO")).textContent(g.instant("FREE_VISIT_REFUND_MSG")).ok(g.instant("OK"));i.show(d).then(function(){},function(){})}}else a.WSAppointment.isFreeVisit=!1,a.isFreeVisitDisabled=!0,a.WSAppointment.isBillable=!0;a.WSAppointment.isFollowUp=c.data.isFollowUp},function(b){a.isFreeVisitDisabled=!1}))},a.selectedUser=function(d){a.requestObject.userId=d,"view"!==c.type&&(d!=j.getLoggedInUser().id?a.hideDeleteBtn=!0:a.hideDeleteBtn=!1),b.$broadcast("getAttachmentList")},a.getDisease=function(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseList=angular.fromJson(b.data)},function(a){})},a.getDiseaseVariant=function(b){var c={};return c.diseaseId=b.id,k.getData(l.getParameterizedUrl("GET_VARIANT_BY_DISEASE_ID",c),null,function(b){return a.diseaseVariantList=b.data},function(a){})},a.getPeriodType=function(b){return k.getData(l.getUrl("GET_FREE_PERIOD_TYPE"),null,function(b){return a.periodTypeList=b.data},function(a){})},a.getDetailsByUhid=function(b){m.isNullOrEmpty(b)?(a.WSAppointment.patientPhoneNumber=null,a.WSAppointment.patient=null):(a.requestData={},a.requestData.searchKeyWord=b,a.requestData.orgLocId=a.WSAppointment.orgLocId,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("FIND_CLIENT_BY_UHID",a.requestData),null,function(b){a.userNameAutoCmpLoading=!1,b&&b.data&&(a.WSAppointment.patient={id:b.data[0].id,value:b.data[0].value})},function(b){a.userNameAutoCmpLoading=!1}))},
//Init Method
a.init=function(){a.WSAppointment={},a.WSAppointment.wsTreatmentHistoryRelatedToAppointment={},a.apptStatus=c.appointmentType;var b=j.getLoggedInUser();if(c.orgLocation&&c.entityType&&"CAL_PROCESS"==c.entityType.code&&c.entityName&&c.entityName.id&&(a.allocatedTo={queryUrl:"GET_PROFESSIONAL_ALLOTED_TO",jsonParameter:{processId:c.entityName.id,organizationLocationId:c.orgLocation}}),b&&(a.WSAppointment.userName={id:b.id,value:b.displayName},b.isOrganizationUser&&b.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1),c.appointmentType&&(a.WSAppointment.actionTaken=c.appointmentType,a.pageTitle="MANAGE_"+c.appointmentType),"RECORDWALKIN"==c.appointmentType){c.clientId&&a.getClientDetails(c.clientId),
//added for other request requestId
c.requestId&&(a.WSAppointment.requestId=c.requestId);var d=new Date;if(a.WSAppointment.apptDate=h("timestampToDate")(d,"MM/dd/yyyy"),a.WSAppointment.apptStartTime=d.getHours()+":"+d.getMinutes()+":00",c.eventName&&c.eventName.id)a.getCalendarEventDetails(c.eventName.id),/*$scope.getFreeVisitDetails($stateParams.eventName.id);*/
a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:c.eventName.id}},a.patient={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(a.WSAppointment.apptDate),eventId:c.eventName.id}};else if((!a.WSAppointment.eventName||!a.WSAppointment.eventType)&&c.entityName&&c.entityType&&"RECORDWALKIN"==a.apptStatus){var e={};e.entityId=c.entityName.id,e.entityType=c.entityType.code,/*requestObj.organizationLocationId = responseData.organizationLocationId;*/
x.getCurrentEvent(e,function(b){b.eventType&&(a.WSAppointment.eventType=b.eventType),b.id&&b.eventName&&(a.WSAppointment.eventName={id:b.id,value:b.eventName}),a.WSAppointment.eventType&&a.WSAppointment.eventName&&(a.getCalendarEventDetails(a.WSAppointment.eventName.id),/*$scope.getFreeVisitDetails($stateParams.eventName.id);*/
a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:a.WSAppointment.eventName.id}},a.$broadcast("loadWSAppointmentServiceType",a.serviceType),a.patient={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(a.WSAppointment.apptDate),eventId:a.WSAppointment.eventName.id}})},function(a){})}}else c.eventName&&c.eventName.id&&(a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:c.eventName.id}}),c.appointmentId&&(a.WSAppointment.id=c.appointmentId,a.getCheckInOutAllotment(c.appointmentId)),c.clientId&&a.getClientDetails(c.clientId);if(/*if($stateParams.entityType){
                $scope.WSAppointment.entityType= $stateParams.entityType;
            }
            if($stateParams.entityName){
                $scope.WSAppointment.entityName= $stateParams.entityName;
            }
            if($stateParams.eventType){
                $scope.WSAppointment.eventType= $stateParams.eventType;
            }
            if($stateParams.eventName){
                $scope.WSAppointment.eventName= $stateParams.eventName;
            }*/
a.isCheckIn=!1,a.isCheckOut=!1,a.isForwarded=!1,a.isAllocated=!1,a.isRecordWalkIn=!1,a.entityImageUrl="app/images/user.jpg",a.patientImageUrl="app/images/user.jpg",a.issuedByImageUrl="app/images/user.jpg",a.isStartTimeRequired=!1,a.isStartTimeDisabled=!1,a.isEndTimeRequired=!1,a.isEndTimeDisabled=!1,"CHECKEDIN"===c.appointmentType)a.isCheckIn=!0,a.isStartTimeRequired=!0,a.isStartTimeDisabled=!1,a.isEndTimeRequired=!1,a.isEndTimeDisabled=!0;else if("CHECKEDOUT"===c.appointmentType)a.isCheckOut=!0,a.isStartTimeRequired=!0,a.isStartTimeDisabled=!0,a.isEndTimeRequired=!0,a.isEndTimeDisabled=!1;else if("FORWARDED"===c.appointmentType)a.isForwarded=!0,a.forwardedByImageUrl="app/images/user.jpg",a.isStartTimeRequired=!0,a.isStartTimeDisabled=!0,a.isEndTimeRequired=!1,a.isEndTimeDisabled=!0;else if("ALLOCATED"===c.appointmentType){a.WSAppointment.allocatedOn=h("date")(new Date,"H:mm:ss");var b=j.getLoggedInUser();a.WSAppointment.allocatedBy={},a.WSAppointment.allocatedBy.value=b.displayName,a.WSAppointment.allocatedBy.id=b.id,a.WSAppointment.allocatedBy.code=b.userCode,a.getUserImageInfo(a.WSAppointment.allocatedBy.id,"ALLOCATED_BY"),a.isAllocated=!0,a.allocatedByImageUrl="app/images/user.jpg",a.isStartTimeRequired=!0,a.isStartTimeDisabled=!0,a.isEndTimeRequired=!1,a.isEndTimeDisabled=!0}else if("RECORDWALKIN"===c.appointmentType)return a.WSAppointment.checkInTime=new Date,a.showUploadDownload=!1,a.isRecordWalkIn=!0,a.isStartTimeRequired=!0,a.isStartTimeDisabled=!1,a.isEndTimeRequired=!1,a.isEndTimeDisabled=!0,a.WSAppointment.isWalkIn=!0,a.isFreeVisitDisabled=!1,a.isWalkInDisabled=!0,a.isBillPaidDisabled=!0,a.isFollowUpDisabled=!1,a.isNewUhidDisabled=!1,void(a.showServiceSearch=!0);a.getUserByAppointmentId(),a.getPeriodType()},a.init(),a.checkUsersMobileNo=function(b){b&&w.UserInfoDTO(b,function(b){b&&b.length>0?(a.selectUserList=b.sort(function(a,b){return b.age-a.age}),a.guardianData.guardian={id:a.selectUserList[0].userId,value:a.selectUserList[0].displayName}):(a.selectUserList={},a.WSAppointment.patientAddress=null,a.WSAppointment.patient=null)},function(a){})},a.checkOrgLocClient=function(b,c){if(localStorage.getItem("defaultOrgLoc"))var d=angular.fromJson(localStorage.getItem("defaultOrgLoc"));var e={};e.userId=b.userId,e.orgLocId=d.id,k.getData(l.getParameterizedUrl("IS_LOGGED_USER_CLIENT_BY_LOC_ID",e),null,function(b){b&&b.data?a.isLocUser=!0:a.isLocUser=!1},function(a){})},a.getUserDetails=function(b){a.WSAppointment.patient={id:b.userId,value:b.displayName}}}]),angular.module("paripal.appointmentModule").controller("ManageEquipmentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","featurePrivilegeConstants","dateconvertor","manageEquipmentService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.WSEquipment={},a.disabledFormFields=!1,a.isOrgSelected=!1,a.equipmentDescription=null,a.WSEquipment.recordStatus=!0,a.equipmentFormSpinner=!1,a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.$watch("WSEquipment.orgLocation",function(b,c){b&&b.id?(a.isOrgSelected=!0,a.equipment={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{orgLocationId:b.id}},a.$broadcast("loadWSEquipmentEquipment",a.equipment),a.user={queryUrl:"GET_PROFESSIONALS_FOR_MAPPING",queryParameter:{orgLocationId:b.id}}):(a.isOrgSelected=!1,a.WSEquipment.equipment={},a.WSEquipment.user={})}),a.$watch("WSEquipment.equipment",function(b,c){b&&b.id?(a.equipmentFormSpinner=!0,p.getEquipmentDescription(b.id,function(b){a.equipmentFormSpinner=!1,a.equipmentDescription=b.code})):a.equipmentDescription=null}),a.saveEquipmentMappingToProfessional=function(b){b.$valid&&(a.equipmentFormSpinner=!0,p.saveEquipmentMappingToProfessional(a.WSEquipment,c.type,function(b){a.equipmentFormSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),d.go("equipmentList",c)},function(b){a.equipmentFormSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))}))},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()},
//Init Method
a.init=function(){"add"===c.type&&(a.orgLocPermission=n.EVENT_ADD,a.minDate=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.WSEquipment.dateMapped=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.pageState="add")},a.init()}]),angular.module("paripal.appointmentModule").controller("ManageFixAppointmentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","datatableconfig","applicationExceptionService","featurePrivilegeConstants","dateconvertor","GoogleMap","NgMap","$timeout","manageFixAppointmentService","manageCalendarEventService","orgLocListService","$mdDialog","EmergencyTransactionService","commonBillingService","appointmentsUploadDownloadService","commonConstants","manageCheckInOutAllotService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){"use strict";function C(a,b,c,d){if(a.index=d,c){var c=angular.copy(c);c.startTime=new Date(c.date+" "+c.startTime),c.endTime=new Date(c.date+" "+c.endTime),a.WSAppointmentAdhoc=c}else a.WSAppointmentAdhoc={};a.cancel=function(){b.cancel()},a.addScheduleAppointment=function(){a.WSAppointmentAdhoc.index=a.index,b.hide(a.WSAppointmentAdhoc)}}
//        $scope.startDate = new Date();
//        $scope.endDate = new Date();
C.$inject=["$scope","$mdDialog","editData","index"],a.disabledFormFields=!1,a.commonConstants=A,b.showSpinner=!1,a.isFixAppointment=!0,a.isAppointmentPresent=!1,a.isSchedulePresent=!1,a.isFreeVisitDisabled=!0,a.WSAppointment={},a.WSApptUserDetails={},a.WSSlotTime=[],a.WSAppointmentWeekly={},a.WSAppointmentDaily={},a.WSAppointmentAdhocList=[],a.WSAppointmentDefinePerVisit={},a.WSScheduleAppointment={},a.WSAppointmentDetails={organizationLocation:{}},a.isStartTimeDisabled=!0,a.isEndTimeDisabled=!0,a.eventName={queryUrl:"GET_EVENT_NAME_FOR_FIX_APPOINTMENT",jsonParameter:{locationId:null,entityType:null,entityId:null,keyword:null,eventTypeId:null}},a.locLabel="APPOINTMENT_AT",/*$scope.isSchedule = true;*/
//CURRENR_LOCARION_ADDRESS
/*$scope.entityType = {
            queryUrl: "GET_ENTITY_TYPES",
            queryParameter: {}
        };
        $scope.eventType = {
            queryUrl: "GET_EVENT_TYPE_BY_ORG_LOC",
            queryParameter: {}
        };
        $scope.entityName = {
            queryUrl: "GET_IMAGE_BY_USER_ID",
            queryParameter: {
                userId:5
            }
        };*/
a.frequency={queryUrl:"GET_LIST_SCHEDULE_FREQUENCY"},a.selectedUser=function(d){a.requestObject.userId=d,"view"!==c.type&&(d!=i.getLoggedInUser().id?a.hideDeleteBtn=!0:a.hideDeleteBtn=!1),b.$broadcast("getAttachmentList")},a.getCityNameData=function(b){return a.requestData={},a.requestData.searchString=b,a.requestData.noOfSuggestions=A.smartSearchRecordLimit,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("GET_CITY_DISTRICT_BY_STRING",a.requestData),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.$watch("WSAppointment.entityName",function(b){b&&b.id&&("CAL_PROCESS"==a.WSAppointment.entityType.code?(a.isSpecificProfessionalDisabled=!1,a.specificDoctor={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.isSpecificProfessionalDisabled=!0)},!0),a.$watch("WSAppointment.onBehalfOfAddress",function(b){b&&a.WSAppointment.eventType&&("add"!=c.type&&"view"!=c.type||"CAL_EVENT_HOME_VISIT"!==a.WSAppointment.eventType.code||(a.WSAppointment.orgLocarionAddress=b))},!0),a.$watch("WSAppointment.apptDate",function(d){d?(!c.slotId&&c.apptDate&&c.eventName&&c.eventName.id?(b.showSpinner=!0,t.getSlotBasedListOnDateByEventId(c.apptDate,c.eventName.id,function(c){b.showSpinner=!1,a.WSSlotTime=c,a.WSSlotTime&&"ADHOC"==a.WSSlotTime[0].appointmentType&&(a.WSAppointment.slotId=a.WSSlotTime[0].id)},function(a){b.showSpinner=!1})):"home"!==c.fromState&&"individualcalendarlist"!==c.fromState&&(a.isSlotBased=!0),c.eventName&&c.eventName.id&&(a.onBehalfOf={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(c.apptDate),eventId:c.eventName.id}})):(a.WSAppointment.startTime=null,a.WSAppointment.endTime=null)},!0),a.selectSlotChanged=function(b){if(b){var c=JSON.parse(b);a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+c.startTime),a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+c.endTime),a.WSAppointment.slotId=c.id}else a.WSAppointment.startTime=null,a.WSAppointment.endTime=null,a.WSAppointment.slotId=null},a.$watchGroup(["WSAppointment.eventName","WSAppointmentDetails.eventName"],function(d,e){if(d&&(d[0]&&d[0].id||d[1]&&d[1].id)){if("add"==c.type){b.showSpinner=!0;var f=null;f=d[0]&&d[0].id?d[0].id:d[1].id,a.WSAppointment.onBehalfOf&&a.WSAppointment.onBehalfOf.id?t.getOnBehalfAddressDetails(a.WSAppointment.onBehalfOf.id,f,function(c){b.showSpinner=!1,a.WSAppointment.onBehalfOfCellPhone=c.phoneNumber,a.WSAppointment.uhid=c.uhidnumber,a.WSAppointment.isNewUHID=c.isNewUHID,a.WSAppointment.onBehalfOfAddress=c.userAddress,a.WSAppointment.addressInfo=c.addressInfo,a.WSAppointment.eventType&&"CAL_EVENT_HOME_VISIT"===a.WSAppointment.eventType.code&&(a.WSAppointment.orgLocarionAddress=c.userAddress)}):b.showSpinner=!1}a.WSAppointment.onBehalfOf&&t.getEarlierAppointmentDetails(a.WSAppointment.onBehalfOf.id,function(c){b.showSpinner=!1,a.WSAppointment.lastProfessional=c}),a.WSAppointment.serviceType&&a.WSAppointment.serviceType.id&&a.WSAppointment.onBehalfOf.id&&(a.WSAppointment.eventName?a.getFreeVisitDetails(a.WSAppointment.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id):a.WSAppointmentDetails.eventName&&a.getFreeVisitDetails(a.WSAppointmentDetails.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id))}else c.contactNo||(a.WSAppointment.onBehalfOfCellPhone=null),a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.uhid=null}),a.$watch("WSAppointment.onBehalfOf",function(d,e){if(d&&d.id){if("add"==c.type&&(c.eventName||c.fromState))if("home"==c.fromState){if(a.fromState="home",a.WSAppointment.eventName||a.WSAppointmentDetails.eventName){var f=null;f=a.WSAppointment.eventName?a.WSAppointment.eventName.id:a.WSAppointmentDetails.eventName.id,b.showSpinner=!0,t.getOnBehalfAddressDetails(d.id,f,function(c){b.showSpinner=!1,a.WSAppointment.onBehalfOfCellPhone=c.phoneNumber,a.WSAppointment.uhid=c.uhidnumber,a.WSAppointment.isNewUHID=c.isNewUHID,a.WSAppointment.onBehalfOfAddress=c.userAddress,a.WSAppointment.addressInfo=c.addressInfo,"CAL_EVENT_HOME_VISIT"===a.WSAppointment.eventType.code&&(a.WSAppointment.orgLocarionAddress=c.userAddress)})}}else"individualcalendarlist"==c.fromState?a.fromState="individualcalendarlist":(b.showSpinner=!0,t.getOnBehalfAddressDetails(d.id,c.eventName.id,function(c){b.showSpinner=!1,a.WSAppointment.onBehalfOfCellPhone=c.phoneNumber,a.WSAppointment.uhid=c.uhidnumber,a.WSAppointment.isNewUHID=c.isNewUHID,a.WSAppointment.onBehalfOfAddress=c.userAddress,a.WSAppointment.addressInfo=c.addressInfo,"CAL_EVENT_HOME_VISIT"===a.WSAppointment.eventType.code&&(a.WSAppointment.orgLocarionAddress=c.userAddress)}));
//$rootScope.showSpinner = true;
t.getEarlierAppointmentDetails(d.id,function(c){b.showSpinner=!1,
//conslole.log(successResponse);
//$scope.WSCalendarEvent.dateMapped = successResponse.dateMapped;
a.WSAppointment.lastProfessional=c}),a.WSAppointment.serviceType&&a.WSAppointment.serviceType.id&&a.WSAppointment.onBehalfOf.id&&(a.WSAppointment.eventName?a.getFreeVisitDetails(a.WSAppointment.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id):a.WSAppointmentDetails.eventName&&a.getFreeVisitDetails(a.WSAppointmentDetails.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id))}else c.contactNo||(a.WSAppointment.onBehalfOfCellPhone=null),a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.uhid=null},!0),a.$watch("WSAppointment.serviceType",function(b,c){b&&b.id&&a.WSAppointment.onBehalfOf&&a.WSAppointment.onBehalfOf.id&&(a.WSAppointment.eventName?a.getFreeVisitDetails(a.WSAppointment.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id):a.WSAppointmentDetails.eventName&&a.getFreeVisitDetails(a.WSAppointmentDetails.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id))},!0),a.$watch("WSAppointmentDetails.orgUser",function(c,d){c&&c.id&&a.WSAppointmentDetails.organizationLocation.data.id&&"CAL_ORGANIZATION_USER"==a.WSAppointmentDetails.entityTypeName.code&&(a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES",queryParameter:{locationId:a.WSAppointmentDetails.organizationLocation.data.id,userId:c.id}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType))},!0),a.$watch("WSAppointmentDetails.organizationLocation",function(c,d){c&&c.data&&c.data.id&&a.WSAppointmentDetails.orgUser&&a.WSAppointmentDetails.orgUser.id&&"CAL_ORGANIZATION_USER"==a.WSAppointmentDetails.entityTypeName.code&&(a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES",queryParameter:{locationId:c.data.id,userId:a.WSAppointmentDetails.orgUser.id}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType))},!0),a.getAvailableSlots=function(){l.isFieldEmpty(a.WSAppointment.apptDate)||l.isFieldEmpty(a.WSAppointmentDetails.eventName)||(a.getCalendarEventDetails(a.WSAppointmentDetails.eventName.id),/*$scope.getFreeVisitDetails($scope.WSAppointmentDetails.eventName.id);*/
a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:a.WSAppointmentDetails.eventName.id}},a.onBehalfOf={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(a.WSAppointment.apptDate),eventId:a.WSAppointmentDetails.eventName.id}},b.$broadcast("loadWSAppointmentServiceType",a.serviceType),a.WSAppointment.eventId=a.WSAppointmentDetails.eventName.id,t.getSlotBasedListOnDateByEventId(a.WSAppointment.apptDate,a.WSAppointmentDetails.eventName.id,function(c){b.showSpinner=!1,a.WSSlotTime=c,a.WSSlotTime&&"CAL_PROCESS"==a.WSAppointmentDetails.entityTypeName.code&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+a.WSSlotTime[0].startTime),a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate),a.WSAppointment.slotId=a.WSSlotTime[0].id),a.WSSlotTime&&"ADHOC"==a.WSSlotTime[0].appointmentType&&(a.WSAppointment.slotId=a.WSSlotTime[0].id)},function(a){b.showSpinner=!1}))},a.getEntityImageInfo=function(b){l.isNullOrEmpty(b)||i.getUserImageInfo(b,function(b){a.entityImageUrl=b},function(b){a.entityImageUrl="app/images/user.jpg"})},a.paymentMethod=function(b){if(c.appointmentId&&localStorage.setItem("appointmentId",c.appointmentId),"AT_BOOKING"===a.WSAppointment.paymentToBeTaken&&b){var e={transactionId:b};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"FIX_APPOINTMENTS"})),x.getWhetherBillDetails(e,function(a){d.go("billsummaryview",{transactionId:b})},function(a){var b="UNABLE_TO_FIX_APPOINTMENT",e="UNABLE_TO_FIX_APPOINTMENT_MESSAGE";1==i.getLoggedInUser().isOrganizationUserMode&&(e="APPOINTMENT_FEE_NOT_FOUND_BODY",b="FEE_TYPE_NOT_FOUND_TITLE");var f=w.confirm().title(g.instant(b)).textContent(g.instant(e)).ok(g.instant("OK")).cancel(g.instant("CANCEL"));w.show(f).then(function(){},function(){d.go("appointmentsList",c)})},{handleError:!1})}},a.saveFixAppointment=function(e){e.$valid&&(b.showSpinner=!0,t.saveFixAppointment(a.WSAppointment,c.type,function(e){if(b.showSpinner=!1,e.response)if(f("success",g.instant("ADDED_SUCCESS")),c.appointmentId=e.response.appointmentId,a.stateParamValue=e.response.appointmentId,a.WSAppointment.isFreeVisit||"AT_BOOKING"!=e.response.paymentToBeTaken)a.getAppointmentDetailsById(c.appointmentId);else if(a.whetherOrgUser){if(e.response.transactionId){b.showSpinner=!0;var h=[e.response.transactionId];y.generateBill(h,function(h){b.showSpinner=!1;var i=w.confirm().title(g.instant("PAYMENT_CONFIRMATION")).textContent(g.instant("APPOINTMENT_PAYMENT_PERMISSION")).ok(g.instant("YES")).cancel(g.instant("NO"));w.show(i).then(function(){B.setIsBilledOfAppointment(e.response.appointmentId,function(b){var c={};c.entityName=a.WSAppointment.entityName,c.apptDate=a.WSAppointment.apptDate,c.event=a.WSAppointment.eventName,d.go("managebill",{parentState:"APPOINTMENT",billId:h.response,type:"view",createReceipt:!0,appointmentDetails:c})},function(a){}),b.showSpinner=!1},function(){f("success",g.instant("ADDED_SUCCESS")),c.type="edit",c.appointmentId=c.appointmentId,a.init()})},function(a){b.showSpinner=!1;var e="UNABLE_TO_FIX_APPOINTMENT",f="UNABLE_TO_FIX_APPOINTMENT_MESSAGE";1==i.getLoggedInUser().isOrganizationUserMode&&(f="APPOINTMENT_FEE_NOT_FOUND_BODY",e="FEE_TYPE_NOT_FOUND_TITLE");var h=w.confirm().title(g.instant(e)).textContent(g.instant(e)).ok(g.instant("OK")).cancel(g.instant("CANCEL"));w.show(h).then(function(){},function(){d.go("appointmentsList",c)})},{handleError:!1})}}else a.paymentMethod(e.response.transactionId)},function(a){b.showSpinner=!1,l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))}))},a.getCliniclList=function(){if(a.generatedAppointmentId||(a.clinicalNotes=[]),c.treatmentRecId){var b={};b.recordId=c.treatmentRecId}else{var b={};b.appointmentId=a.generatedAppointmentId}var d=k.getParameterizedUrl("GET_CLINICAL_NOTES_FOR_APPOINTMENT",b);if(d)return j.getData(d,null,function(b){if(b&&b.data)return a.clinicalNotes=b.data,a.clinicalNotes},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getOrgLocationAddressDetails=function(c){l.isNullOrEmpty(c)||(b.showSpinner=!0,v.findCurrentAddressOfLocation(c,function(c){b.showSpinner=!1;var d="";c.addressLine1&&(d+=c.addressLine1+", "),c.addressLine2&&(d+=c.addressLine2+", "),c.addressLine3&&(d+=c.addressLine3+", "),c.city&&c.city.value&&(d+=c.city.value+", "),c.district&&c.district.value&&(d+=c.district.value+", "),c.state&&c.state.value&&(d+=c.state.value+", "),c.country&&c.country.value&&(d+=c.country.value+", "),c.postalCode&&(d+=c.postalCode),null!=d&&d.length>0&&","==d.charAt(d.length-1)&&(d=d.substring(0,d.length()-1)),a.WSAppointment.orgLocarionAddress=d}))},a.getCalendarEventDetails=function(c){l.isNullOrEmpty(c)||(b.showSpinner=!0,u.getCalendarEventDetails(c,function(c){b.showSpinner=!1,a.setDataToAppointmentForm(c)}))},a.getAppointmentDetailsById=function(d){l.isNullOrEmpty(d)||(b.showSpinner=!0,t.getAppointmentDetailsById(d,function(e){a.generatedAppointmentId=d,b.showSpinner=!1,a.setAppDataToAppointmentForm(e),a.getUserByAppointmentId(),i.getLoggedInUser()&&a.onUserSelection(i.getLoggedInUser().id),a.isAppointmentPresent=!0,a.stateParamValue=d,a.disabledFormFields=!0,"add"==c.type&&(c.type="edit")}))},a.getFreeVisitDetails=function(c,d,e){l.isNullOrEmpty(c)||(b.showSpinner=!0,t.getFreeVisitDetails(c,d,e,function(c){b.showSpinner=!1,c.data.isFreeVisit?(a.WSAppointment.isFreeVisit=!0,a.isFreeVisitDisabled=!1):(a.WSAppointment.isFreeVisit=!1,a.isFreeVisitDisabled=!0),a.WSAppointment.isFollowUp=c.data.isFollowUp},function(b){a.isFreeVisitDisabled=!0}))},a.setAppDataToAppointmentForm=function(b){b.id&&(a.WSAppointment.id=b.id),b.eventId&&(a.getCalendarEventDetails(b.eventId),a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:b.eventId}}),b.apptDate?(a.WSAppointment.apptDate=h("timestampToDate")(b.apptDate,"MM/dd/yyyy"),a.isAppoinmentDateDisabled=!0):a.isAppoinmentDateDisabled=!1,b.apptStartTime?(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+b.apptStartTime),a.isStartTimeDisabled=!0):a.isStartTimeDisabled=!1,b.apptEndTime?(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+b.apptEndTime),a.isEndTimeDisabled=!0):a.isEndTimeDisabled=!1,b.slotId?(a.WSAppointment.slotId=b.slotId,a.displayId=b.slotId,a.isSlotBased=!0):a.isSlotBased=!1,b.isFollowUp&&(a.WSAppointment.isFollowUp=b.isFollowUp),b.isRecurring&&(a.WSAppointment.isRecurring=b.isRecurring,a.isRecurring=b.isRecurring),b.serviceType&&b.serviceType.id&&(a.WSAppointment.serviceType=b.serviceType),b.problemDescription&&(a.WSAppointment.problemDescription=b.problemDescription),b.specificDoctor&&b.specificDoctor.id&&(a.WSAppointment.specificDoctor=b.specificDoctor),b.user&&b.user.id&&(a.WSAppointment.userName=b.user,a.getUserByAppointmentId()),b.onBehalfOf&&b.onBehalfOf.id?a.WSAppointment.onBehalfOf=b.onBehalfOf:b.onBehalfOfName&&(a.WSAppointment.onBehalfOf={value:b.onBehalfOfName}),b.onBehalfOfCellPhone&&(a.WSAppointment.onBehalfOfCellPhone=b.onBehalfOfCellPhone),b.onBehalfOfAddress&&(a.WSAppointment.onBehalfOfAddress=b.onBehalfOfAddress),b.isNewUHID&&(a.WSAppointment.isNewUHID=b.isNewUHID),b.uhid&&(a.WSAppointment.uhid=b.uhid),b.isFreeVisit?(a.WSAppointment.isFreeVisit=b.isFreeVisit,a.isFreeVisitDisabled=!0):a.isFreeVisitDisabled=!1,b.orgLoc&&b.orgLoc.id&&(a.WSAppointment.orgLocId=b.orgLoc.id)},a.setDataToAppointmentForm=function(b){if(!l.isEmpty(b)){var d=i.getLoggedInUser();b.entityTypeDetails&&b.entityTypeDetails.id&&(a.WSAppointment.entityType=b.entityTypeDetails,"CAL_EQUIPMENT"==a.WSAppointment.entityType.code&&1==d.userAccountStatusDTO.whetherDoctor&&(a.WSAppointment.onBehalfOf={id:d.id,value:d.displayName})),b.entityId&&b.entityName&&(a.WSAppointment.entityName={id:b.entityId,value:b.entityName},"CAL_ORGANIZATION_USER"===a.WSAppointment.entityType.code?("ADHOC"==b.appointmentType&&(a.isSlotBased=!0,"add"==c.type&&l.isNullOrEmpty(c.startTime)&&(b.eventStartTime&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+b.eventStartTime)),b.eventEndTime&&(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate)))),a.isOrgUserEntityType=!0,a.getEntityImageInfo(b.entityId),a.WSAppointment.lastProfessional={id:b.entityId,value:b.entityName}):a.isOrgUserEntityType=!1,"CAL_EQUIPMENT"===a.WSAppointment.entityType.code&&"ADHOC"==b.appointmentType&&(a.isSlotBased=!0,"add"==c.type&&l.isNullOrEmpty(c.startTime)&&(b.eventStartTime&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+b.eventStartTime)),b.eventEndTime&&(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate))))),b.eventType&&(a.WSAppointment.eventType=b.eventType,"CAL_EVENT_HOME_VISIT"!=a.WSAppointment.eventType.code?a.getOrgLocationAddressDetails(b.organizationLocationId):(a.isHomeVisit=!0,a.WSAppointment.onBehalfOfAddress&&(a.WSAppointment.orgLocarionAddress=a.WSAppointment.onBehalfOfAddress))),b.id&&b.eventName&&(a.WSAppointment.eventName={id:b.id,value:b.eventName},a.WSAppointment.eventId=b.id),a.WSAppointment.paymentToBeTaken=b.paymentToBeTaken,"AT_BOOKING"==a.WSAppointment.paymentToBeTaken?a.isServiceRequired=!0:a.isServiceRequired=!1,a.WSAppointment.orgLocId=b.organizationLocationId,b.appointmentType&&"ADHOC"==b.appointmentType&&"add"==c.type&&(a.isStartTimeDisabled=!1,a.isEndTimeDisabled=!1)}},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()},/*Map Integration Start*/
a.currentPosition=[18.51954370906854,73.85534405708313],/*$scope.$watch('WSEventSession.city', function (newValue) {
            if (newValue) {
                $scope.currentPosition = newValue.value;
            }
        });*/
a.$watch("WSAppointment.orgLocarionAddress",function(b){b&&(a.currentPosition=b)}),a.getPosition=function(b){if(!a.disabledFormFields&&(a.currentPosition=q.getCoordinates(b),!l.isFieldEmpty(b))){/* $scope.WSEventSession.googleMapLink = "http://maps.google.com/?ll=" + event.latLng.lat() + "," + event.latLng.lng();*/
var c=new google.maps.Geocoder;c.geocode({latLng:b.latLng},function(b,c){c==google.maps.GeocoderStatus.OK&&b[1]&&angular.forEach(b[1].address_components,function(c,d){d>=0&&"administrative_area_level_2"==c.types[0]&&(a.zoom=15,/*$scope.WSEventSession.city = angular.copy({
                                                id: 1,
                                                value: v.long_name
                                            });*/
a.WSAppointment.orgLocarionAddress=b[1].formatted_address,s(function(){angular.element(document.getElementById("clickHere")).trigger("click")},0))})})}};/*Map Integration End*/
//datatble config json
var D={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=m.setOptionProperties(D),a.dtColumnDefs=m.setColumnProperties({}),a.getUserByAppointmentId=function(){var b=i.getLoggedInUser();a.requestObject={},a.requestObject.module="appointmentId",a.requestObject.moduleNameAndUser="findAttachmentByAppointmentAndUser",a.requestObject.moduleName="deleteAttachmentsByAppointmentIdAndDocId",a.requestObject.forId=c.appointmentId,a.WSAppointment.userName?a.requestObject.userId=a.WSAppointment.userName.id:b?a.requestObject.userId=b.id:null!=c.dprUserId&&(a.requestObject.userId=c.dprUserId);var d={pathName:"findUsersByAppointmentId",id:c.appointmentId};z.getUsersByAppointmentOrRequestId(d,function(b){a.WSApptUserDetails.userList=b})},a.onUserSelection=function(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")},/**
         * Called when entity type is selected
         */
a.entityTypeSelected=function(){a.WSAppointmentDetails.entityId=null,a.changeEntityVisuals(a.WSAppointmentDetails.entityTypeName),"CAL_ORGANIZATION_USER"==a.WSAppointmentDetails.entityTypeName.code?l.isFieldEmpty(a.WSAppointmentDetails.orgUser)||l.isFieldEmpty(a.WSAppointmentDetails.orgUser.id)||(a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES",queryParameter:{locationId:a.WSAppointmentDetails.organizationLocation.data.id,userId:a.WSAppointmentDetails.orgUser.id}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType)):("CAL_PROCESS"==a.WSAppointmentDetails.entityTypeName.code&&(a.isSlotBased=!0,a.isStartTimeDisabled=!1,a.isEndTimeDisabled=!1),a.eventType={queryUrl:"GET_EVENT_TYPE_BY_ENTITY_TYPE_ID",queryParameter:{entityType:a.WSAppointmentDetails.entityTypeName.code}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType)),a.eventName.jsonParameter.locationId=a.WSAppointmentDetails.organizationLocation.data.id,a.eventName.jsonParameter.entityType=a.WSAppointmentDetails.entityTypeName.code,"individualcalendarlist"!=a.fromState&&(a.WSAppointmentDetails.orgUser=null),a.WSAppointmentDetails.eventType=null,a.WSAppointment.startTime=null,a.WSAppointmentDetails.eventName=null,a.WSAppointment.endTime=null,b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType)},a.getUserNames=function(b,c){return a.userData={},a.userData.userName=b,a.userData.orgLocId=c,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("FIND_USERBYORGLOC",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.entitySelected=function(){l.isFieldEmpty(a.WSAppointmentDetails.entityId)||(a.eventName.jsonParameter.entityId=a.WSAppointmentDetails.entityId.id)},a.userNameChanged=function(){l.isFieldEmpty(a.WSAppointmentDetails.orgUser)||(a.eventName.jsonParameter.entityId=a.WSAppointmentDetails.orgUser.id)},a.setEventType=function(b,c){l.isFieldEmpty(b)?a.eventName.jsonParameter.eventTypeId=null:a.eventName.jsonParameter.eventTypeId=b.id,"onSelect"===c&&(a.WSAppointmentDetails.eventName=null)},a.changeEntityVisuals=function(b){if("CAL_ORGANIZATION_USER"==b.code)a.WSAppointmentDetails.entityId=null,"individualcalendarlist"!=a.fromState&&!l.isEmpty(i.getLoggedInUser());else{var c="";l.isFieldEmpty(a.WSAppointmentDetails.orgUser)||(a.WSAppointmentDetails.orgUser=null),c="CAL_EQUIPMENT"==b.code?"FIND_EQUIPMENT_BY_LOC_ID":"FIND_PROCESS_BY_LOC_ID";var d={orgLocationId:a.WSAppointmentDetails.organizationLocation.data.id};j.getData(k.getUrl(c),d,function(b){a.entities=b.data},function(a){})}"CAL_ORGANIZATION_LOCATION"==b.code&&(a.eventName.jsonParameter.entityId=a.WSAppointmentDetails.organizationLocation.data.id)},a.showNotes=function(){c.appointmentId&&d.go("appointmentnotes",{appointmentId:c.appointmentId,type:c.type,otp:c.otp,accessKeyId:c.accessKeyId})},a.getCalendarEventException=function(d,e){l.isNullOrEmpty(d)||(b.showSpinner=!0,u.getCalendarEventException(d,function(d){b.showSpinner=!1,"ADHOC"==d.appointmentType&&(a.isSlotBased=!0,c.apptStartTime&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+c.apptStartTime)),c.apptEndTime&&(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+c.apptEndTime)))}))},/* Code for searching user by phone number and UHID 11/1/19 - START */
a.searchUserByNumber=function(b){if(l.isNullOrEmpty(b))c.contactNo||(a.WSAppointment.onBehalfOfCellPhone=null),a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.onBehalfOf=null;else{var d={};d.cell=b,j.postData(k.getUrl("CHECK_USER_BY_EMAIL_AND_CELL"),d,function(b){b&&b.data&&b.data.length>0&&(a.WSAppointment.onBehalfOf={id:b.data[0].userId,value:b.data[0].displayName})},function(a){})}},a.getDetailsByUhid=function(b){l.isNullOrEmpty(b)?(c.contactNo||(a.WSAppointment.onBehalfOfCellPhone=null),a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.onBehalfOf=null):(a.requestData={},a.requestData.searchKeyWord=b,a.requestData.orgLocId=a.WSAppointment.orgLocId,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("FIND_CLIENT_BY_UHID",a.requestData),null,function(b){a.userNameAutoCmpLoading=!1,b&&b.data&&(a.WSAppointment.onBehalfOf={id:b.data[0].id,value:b.data[0].value})},function(b){a.userNameAutoCmpLoading=!1}))},/* Code for searching user by phone number and UHID 11/1/19 - END */
//Init Method
a.init=function(){localStorage.getItem("appointmentId")&&localStorage.removeItem("appointmentId");var b=i.getLoggedInUser();if(b)"add"==c.type&&(a.minDate=new Date,a.WSAppointment.userName={id:b.id,value:b.displayName}),l.isNullOrEmpty(c.typeOfService)||(a.WSAppointment.serviceType=c.typeOfService),l.isNullOrEmpty(c.probDescription)||(a.WSAppointment.problemDescription=c.probDescription),l.isNullOrEmpty(c.startTime)||(a.WSAppointment.startTime=c.startTime),l.isNullOrEmpty(c.endTime)||(a.WSAppointment.endTime=c.endTime),l.isNullOrEmpty(c.onBehalfOf)||l.isNullOrEmpty(c.onBehalfOf.id)?(l.isNullOrEmpty(c.onBehalfOf)||(a.WSAppointment.onBehalfOf={value:c.onBehalfOf}),l.isNullOrEmpty(c.contactNo)||(a.WSAppointment.onBehalfOfCellPhone=c.contactNo)):a.WSAppointment.onBehalfOf={id:c.onBehalfOf.id,value:c.onBehalfOf.value},b.isOrganizationUser&&b.isOrganizationUserMode?a.whetherOrgUser=!0:(a.WSAppointment.onBehalfOf={id:b.id,value:b.displayName},a.whetherOrgUser=!1);else if(c.otp&&c.accessKeyId){var e={};e.accessKeyId=c.accessKeyId,e.currentOTP=c.otp,j.getData(k.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",e),null,function(a){a&&1==a.data||(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))})}else f("error","Invalid Access"),d.go("login");"edit"==c.type&&c.appointmentId?(a.getAppointmentDetailsById(c.appointmentId),a.isAppointmentPresent=!0):"add"==c.type?("home"==c.fromState&&(a.fromState="home",j.getData(k.getUrl("GET_CONDITION_ENTITY_TYPE"),null,function(b){a.entityTypes=angular.fromJson(b.data)},function(a){})),"individualcalendarlist"==c.fromState&&(a.fromState="individualcalendarlist",j.getData(k.getUrl("GET_CONDITION_ENTITY_TYPE"),null,function(b){a.entityTypes=angular.fromJson(b.data)},function(a){}),c.orgLocation&&(a.WSAppointmentDetails.organizationLocation={},a.WSAppointmentDetails.organizationLocation.data=c.orgLocation),c.entityType&&(a.selectedEntityTypeId=c.entityType.id),c.entityName&&(a.selectedEntityId=c.entityName.id),c.entityType&&"CAL_ORGANIZATION_USER"==c.entityType.code&&c.entityName&&(a.WSAppointmentDetails.orgUser={displayName:c.entityName.value,id:c.entityName.id})),a.isAppointmentPresent=!1,c.eventName&&c.eventName.id?(a.getCalendarEventDetails(c.eventName.id),c.eventExceptionId&&a.getCalendarEventException(c.eventExceptionId),/*$scope.getFreeVisitDetails($stateParams.eventName.id);*/
a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:c.eventName.id}}):(c.entityType&&(a.WSAppointment.entityType=c.entityType,"CAL_EQUIPMENT"==c.entityType.code&&1==i.getLoggedInUser().userAccountStatusDTO.whetherDoctor&&(a.WSAppointment.onBehalfOf={id:b.id,value:b.displayName})),c.entityName&&(a.WSAppointment.entityName=c.entityName),c.eventType&&(a.WSAppointment.eventType=c.eventType),c.eventName&&(a.WSAppointment.eventName=c.eventName,a.WSAppointment.eventId=c.eventName.id)),c.apptDate?(a.WSAppointment.apptDate=h("timestampToDate")(c.apptDate,"MM/dd/yyyy"),a.isAppoinmentDateDisabled=!0):a.isAppoinmentDateDisabled=!1,c.slotId?(a.WSAppointment.slotId=c.slotId,a.isSlotBased=!0,c.apptStartTime?(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+c.apptStartTime),//$stateParams.apptStartTime;
"CAL_PROCESS"!=c.entityType.code?a.isStartTimeDisabled=!0:a.isStartTimeDisabled=!1):a.isStartTimeDisabled=!1,c.apptEndTime?(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+c.apptEndTime),"CAL_PROCESS"!=c.entityType.code?a.isEndTimeDisabled=!0:a.isEndTimeDisabled=!1):(l.isNullOrEmpty(c.endTime)&&(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate)),a.isEndTimeDisabled=!1)):"ADHOC"!=c.appointmentType&&c.entityType&&"CAL_PROCESS"!=c.entityType.code&&(a.isSlotBased=!1)):"view"==c.type&&(a.getUserByAppointmentId(),a.getAppointmentDetailsById(c.appointmentId),a.isAppointmentPresent=!0,a.disabledFormFields=!0,a.isViewMode=!0)},a.init(),/*$scope.tabChange = function(value){
            $scope.isFixAppointment = false;
            $scope.isSchedule = false;
            $scope.isException = false;
            if(value == 'fixAppointment'){
                $scope.isFixAppointment = true;
            }
            if(value == 'schedule'){
                $scope.isSchedule = true;
            }
            if(value == 'exception'){
                $scope.isException = true;
            }
        }*/
a.$watch("WSScheduleAppointment.frequency",function(b){b&&b.id?(a.isWeekly=!1,a.isDaily=!1,a.isAdhoc=!1,a.isDefinePerVisit=!1,"WEEKLY"==b.id&&(a.isWeekly=!0),"DAILY"==b.id&&(a.isDaily=!0),"ADHOC"==b.id&&(a.isAdhoc=!0),"DEFINE_PER_VISIT"==b.id&&(a.isDefinePerVisit=!0,a.WSScheduleAppointment.perVisitStartdate=p.convertToViewDate(new Date),a.WSScheduleAppointment.perVisitEndDate=a.WSScheduleAppointment.perVisitStartdate)):(a.isWeekly=!1,a.isDaily=!1,a.isAdhoc=!1,a.isDefinePerVisit=!1)},!0),a.defineSchedule=function(){a.WSScheduleAppointment.onBehalfOfId=a.WSAppointment.onBehalfOf.id,a.isWeekly?t.createWeeklyObject(a.WSAppointmentWeekly,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isDaily?t.createDailyObject(a.WSAppointmentDaily,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isAdhoc?t.createAdhocObject(a.WSAppointmentAdhocList,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isDefinePerVisit&&t.createDefinePerVisitObject(a.WSAppointmentDefinePerVisit,function(b){a.WSScheduleAppointment.scheduleDetails=b}),c.appointmentId&&(a.WSScheduleAppointment.appointmentId=c.appointmentId),a.WSAppointment.eventName&&a.WSAppointment.eventName.id&&(a.WSScheduleAppointment.eventId=a.WSAppointment.eventName.id),t.defineSchedule(a.WSScheduleAppointment,function(c){b.showSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),a.isSchedulePresent=!0},function(a){b.showSpinner=!1,l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},a.scheduleAppointment=function(b,c,d){w.show({controller:C,templateUrl:"app/modules/appointment/views/schedule-appointment-popup.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:A.dialogBox.clickOutsideToClose,locals:{editData:c,index:d}}).then(function(b){var c=h("date")(b.startTime,"HH:mm:ss"),e=h("date")(b.endTime,"HH:mm:ss");b.index==-1?(b.startTime=c,b.endTime=e,delete b.index,a.WSAppointmentAdhocList.push(b)):(a.WSAppointmentAdhocList[d].startTime=c,a.WSAppointmentAdhocList[d].endTime=e)},function(){})},a.deleteScheduleAppointment=function(b){a.WSAppointmentAdhocList.splice(b,1)},a.editJson={pageNumber:0,recordsPerPage:0,sorters:[],eventId:1,patientId:5,appointmentId:1,fromDate:1454265e6,tillDate:14579802e5,frequency:"ADHOC",scheduleDetails:[{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"MONDAY",date:1454265e6},{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"TUESDAY",date:1454265e6},{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"WEDNESDAY",date:1454265e6},{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"FRIDAY",date:1454265e6}]},a.bindData=function(){if(a.WSScheduleAppointment.fromDate=h("timestampToDate")(a.editJson.fromDate,"MM/dd/yyyy"),a.WSScheduleAppointment.tillDate=h("timestampToDate")(a.editJson.tillDate,"MM/dd/yyyy"),a.WSScheduleAppointment.frequency={id:a.editJson.frequency,value:g.instant(a.editJson.frequency)},"WEEKLY"==a.editJson.frequency&&t.editWeeklyObject(a.editJson,function(b){a.WSAppointmentWeekly=b}),"DAILY"==a.editJson.frequency){var b=h("timestampToDate")(a.editJson.fromDate,"MM/dd/yyyy");a.WSAppointmentDaily.startTime=new Date(b+" "+a.editJson.scheduleDetails[0].startTime),a.WSAppointmentDaily.endTime=new Date(b+" "+a.editJson.scheduleDetails[0].endTime)}if("ADHOC"==a.editJson.frequency&&(a.WSAppointmentAdhocList=a.editJson.scheduleDetails),"DEFINE_PER_VISIT"==a.editJson.frequency){var b=h("timestampToDate")(a.editJson.fromDate,"MM/dd/yyyy");a.WSScheduleAppointment.perVisitStartdate=b,a.WSScheduleAppointment.perVisitEndDate=b}}}]),angular.module("paripal.appointmentModule").controller("ManageFollowupActionPopupCtrl",["$mdDialog","$scope","$rootScope","utilService","userId","pageState","rowObject","apptId","httpService","urlService","patientName","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.followUpActionsObj={},b.minDate=new Date,d.isNullOrEmpty(g)||(b.followUpActionsObj=angular.copy(g)),b.pageState=f,"add"==b.pageState&&(b.followUpActionsObj.patient={id:e,value:k}),b.cancel=function(){a.hide()},b.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}},b.addUpdateActionsRecord=function(){c.showSpinner=!0,d.isNullOrEmpty(e)||(b.followUpActionsObj.patient={id:e,value:k}),d.isNullOrEmpty(h)||(b.followUpActionsObj.appointment={id:h,value:null}),"add"==b.pageState?i.postData(j.getUrl("ACTION_ADD"),b.followUpActionsObj,function(b){c.showSpinner=!1;var d=!0;a.hide(d),l("success",m.instant("ACTION_RECORD_ADDED"))},function(a){c.showSpinner=!1}):(delete b.followUpActionsObj.daysToCloseAction,delete b.followUpActionsObj.overdueDates,i.putData(j.getUrl("ACTION_EDIT"),b.followUpActionsObj,function(b){c.showSpinner=!1;var d=!0;a.hide(d),l("success",m.instant("ACTION_RECORD_UPDATED"))},function(a){c.showSpinner=!1}))}}]),angular.module("paripal.appointmentModule").controller("ManageProcessAssociationCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","featurePrivilegeConstants","dateconvertor","manageProcessAssocationService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.WSProcess={},a.disabledFormFields=!1,a.isOrgSelected=!1,a.processAssociationFormSpinner=!1,a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.$watch("WSProcess.orgLocation",function(b,c){b&&b.id?(a.isOrgSelected=!0,a.process={queryUrl:"FIND_PROCESS_BY_LOC_ID",queryParameter:{orgLocationId:b.id}},a.$broadcast("loadWSProcessProcess",a.process),a.user={queryUrl:"GET_PROFESSIONALS_FOR_MAPPING",queryParameter:{orgLocationId:b.id}}):(a.isOrgSelected=!1,a.WSProcess.process={},a.WSProcess.user={})}),/*$scope.$watch('WSProcess.process', function (newValue, oldValue) {
            if(newValue && newValue.id){
                $scope.processAssociationFormSpinner = true;
                manageProcessAssocationService.getEquipmentDescription(newValue.id,
                        function (successResponse) {
                            $scope.processAssociationFormSpinner = false;
                            $scope.equipmentDescription = successResponse.code;
                        });
            }else{
                $scope.equipmentDescription = null;
            }
        });*/
a.saveProcessAssociationToProfessional=function(b){b.$valid&&(a.processAssociationFormSpinner=!0,p.saveEquipmentMappingToProfessional(a.WSProcess,c.type,function(b){a.processAssociationFormSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),d.go("processAssociationList",c)},function(b){a.processAssociationFormSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))}))},a.getProcessAssociationDetails=function(b,c){l.isNullOrEmpty(b)||(a.processAssociationFormSpinner=!0,p.getProcessAssociationDetails(b,function(b){a.processAssociationFormSpinner=!1,a.setDataToProcessAssociationForm(b)}))},a.setDataToProcessAssociationForm=function(b){l.isEmpty(b)||(a.WSProcess=angular.copy(b),/*$scope.WSProcess.id = responseData.id;
                $scope.WSProcess.version = responseData.version;

                if (!utilService.isEmpty(responseData.orgLocation)) {
                    $scope.WSProcess.orgLocation = responseData.orgLocation;
                }
                if (!utilService.isEmpty(responseData.process)) {
                    $scope.WSProcess.process = responseData.process;
                }
                if (!utilService.isEmpty(responseData.user)) {
                    $scope.WSProcess.user = responseData.user;
                }*/
b.dateMapped&&(a.WSProcess.dateMapped=h("timestampToDate")(b.dateMapped,"MM/dd/yyyy")))},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()},
//Init Method
a.init=function(){"add"===c.type?(a.minDate=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.WSProcess.dateMapped=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.WSProcess.recordStatus=!0,a.pageState="add"):"edit"===c.type&&(a.disabledFormFields=!0,a.pageState="edit",a.getProcessAssociationDetails(c.id,c.type))},a.init()}]),angular.module("paripal.appointmentModule").controller("PatientActivityListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","patientActivityListService","featurePrivilegeConstants","manageFixAppointmentService","manageCalendarEventService","dateconvertor","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},b.showSpinner=!1,a.WSPatientActivityList=[],
//$scope.orgLocPermission = featurePrivilegeConstants.PROCESS_VIEW;
a.postHeader={},a.userName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}},a.eventName={queryUrl:"GET_APPOINTMENT_EVENT_NAME",queryParameter:{eventTypeId:-1,entityId:0}},a.processName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{}},a.serviceType={queryUrl:"GET_ALL_TREATMENT_TYPE",queryParameter:{}},a.specificProfessional={queryUrl:"GET_PROFESSINAL_NAME",queryParameter:{}},a.searchPatientCheckInToOutDetails=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0,n.searchPatientCheckInToOutDetails(a.searchCriteria,a.postHeader,function(c){b.showSpinner=!1,a.WSPatientActivityList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})},a.clear=function(){a.searchCriteria={},a.searchPatientCheckInToOutDetails()},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchPatientCheckInToOutDetails()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchPatientCheckInToOutDetails()};
//datatble config json
var t={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(t),a.dtColumnDefs=e.setColumnProperties({}),a.fillFilters=function(b){b&&(a.appointmentId=b,p.getAppointmentDetailsById(a.appointmentId,function(b){if(a.appointmentDetails=b,a.appointmentDetails.onBehalfOf&&(a.searchCriteria.patient=a.appointmentDetails.onBehalfOf),a.appointmentDetails.apptDate&&(a.searchCriteria.apptDate=r.convertToServerDate(a.appointmentDetails.apptDate)),a.appointmentDetails.checkInTIme){var c=new Date;c.setHours(parseInt(a.appointmentDetails.checkInTIme.substring(0,2))),c.setMinutes(parseInt(a.appointmentDetails.checkInTIme.substring(3,5))),c.setSeconds(parseInt(a.appointmentDetails.checkInTIme.substring(6))),a.searchCriteria.checkInTime=c}if(a.appointmentDetails.checkOutTime){/* $scope.searchCriteria.checkOutTime = $filter('date')($scope.appointmentDetails.checkOutTime, 'HH:mm:ss');*/
var d=new Date;d.setHours(parseInt(a.appointmentDetails.checkOutTime.substring(0,2))),d.setMinutes(parseInt(a.appointmentDetails.checkOutTime.substring(3,5))),d.setSeconds(parseInt(a.appointmentDetails.checkOutTime.substring(6))),a.searchCriteria.checkOutTime=d}a.appointmentDetails.serviceType&&(a.searchCriteria.serviceType=a.appointmentDetails.serviceType),a.appointmentDetails.onBehalfOfCellPhone&&(a.searchCriteria.patientContactNumber=a.appointmentDetails.onBehalfOfCellPhone),a.appointmentDetails.tokenNo&&(a.searchCriteria.token=a.appointmentDetails.tokenNo),a.appointmentDetails.specificDoctor&&(a.searchCriteria.specificProfessional=a.appointmentDetails.specificDoctor),a.searchPatientCheckInToOutDetails()},function(a){}))},a.init=function(){a.loggedInUser=j.getLoggedInUser(),c.apptId?a.fillFilters(c.apptId):a.searchPatientCheckInToOutDetails()},a.init()}]),angular.module("paripal.appointmentModule").controller("ProcessAssociationListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","processAssociationListService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.processAssociateListSpinner=!1,a.WSProcessAssociationList=[],a.orgLocPermission=o.PROCESS_VIEW,a.postHeader={headers:{orgLocPermission:a.orgLocPermission}},a.searchCriteria.recordStatus=null,a.getProcess=function(){a.process={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:a.searchCriteria.orgLocation.id}},a.$broadcast("loadSearchCriteriaProcess",a.process)},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.user={queryUrl:"GET_EQUIPMENT_USERS",queryParameter:{orgLocationId:0}},a.searchProcessAssociation=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.processAssociateListSpinner=!0,n.searchProcessAssociation(a.searchCriteria,a.postHeader,function(b){a.processAssociateListSpinner=!1,a.WSProcessAssociationList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.processAssociateListSpinner=!1})},a.manageProcessAssociation=function(a,b){var c={type:b};a&&a.id&&(c.id=a.id),d.go("manageProcessAccessRight",c)},a.activeInActivateProcessAssociation=function(b,c){b.id&&n.activeInActivateProcessAssociation(b.id,c,function(b){c?f("success",h.instant("PROCESS_ASSOCIATION_ACTIVATE")):f("success",h.instant("PROCESS_ASSOCIATION_INACTIVATE")),a.searchProcessAssociation()},function(a){})},a.clear=function(){a.searchCriteria={},a.searchProcessAssociation()},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchProcessAssociation()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchProcessAssociation()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.searchProcessAssociation()},a.init()}]),angular.module("paripal.appointmentModule").controller("QuickFixAppointmentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","datatableconfig","applicationExceptionService","featurePrivilegeConstants","dateconvertor","GoogleMap","NgMap","$timeout","manageFixAppointmentService","manageCalendarEventService","orgLocListService","$mdDialog","EmergencyTransactionService","commonBillingService","appointmentsUploadDownloadService","commonConstants","manageCheckInOutAllotService","fixApptObj",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){"use strict";function D(a,b,c,d){if(a.index=d,c){var c=angular.copy(c);c.startTime=new Date(c.date+" "+c.startTime),c.endTime=new Date(c.date+" "+c.endTime),a.WSAppointmentAdhoc=c}else a.WSAppointmentAdhoc={};a.cancel=function(){b.cancel()},a.addScheduleAppointment=function(){a.WSAppointmentAdhoc.index=a.index,b.hide(a.WSAppointmentAdhoc)}}D.$inject=["$scope","$mdDialog","editData","index"],a.loggedInUserDetails={},a.loggedInUserDetails.isOrganizationUser=b.loggedInUserDetails.isOrganizationUser,a.loggedInUserDetails.isOrganizationUserMode=b.loggedInUserDetails.isOrganizationUserMode,l.isNullOrEmpty(C)||(c=angular.copy(C)),
//        $scope.startDate = new Date();
//        $scope.endDate = new Date();
a.disabledFormFields=!1,a.commonConstants=A,b.showSpinner=!1,a.isFixAppointment=!0,a.isAppointmentPresent=!1,a.isSchedulePresent=!1,a.isFreeVisitDisabled=!0,a.WSAppointment={},a.WSApptUserDetails={},a.WSSlotTime=[],a.WSAppointmentWeekly={},a.WSAppointmentDaily={},a.WSAppointmentAdhocList=[],a.WSAppointmentDefinePerVisit={},a.WSScheduleAppointment={},a.WSAppointmentDetails={organizationLocation:{}},a.isStartTimeDisabled=!0,a.isEndTimeDisabled=!0,a.eventName={queryUrl:"GET_EVENT_NAME_FOR_FIX_APPOINTMENT",jsonParameter:{locationId:null,entityType:null,entityId:null,keyword:null,eventTypeId:null}},a.frequency={queryUrl:"GET_LIST_SCHEDULE_FREQUENCY"},a.viewCompleteForm=function(){localStorage.setItem("isPopupOpen","false"),w.hide(),l.isNullOrEmpty(a.WSAppointment)||l.isNullOrEmpty(a.WSAppointment.serviceType)||(a.typeOfService=a.WSAppointment.serviceType),l.isNullOrEmpty(a.WSAppointment)||l.isNullOrEmpty(a.WSAppointment.problemDescription)||(a.probDescription=a.WSAppointment.problemDescription),l.isNullOrEmpty(a.WSAppointment)||l.isNullOrEmpty(a.WSAppointment.onBehalfOf)||(a.onBehalfOf=a.WSAppointment.onBehalfOf,a.onBehalfOfCell=a.WSAppointment.onBehalfOfCellPhone),l.isNullOrEmpty(a.WSAppointment)||l.isNullOrEmpty(a.WSAppointment.UHID)||(a.onBehalfOfUHID=a.WSAppointment.UHID),l.isNullOrEmpty(a.typeOfAppt)||l.isNullOrEmpty(a.WSAppointment)||l.isNullOrEmpty(a.WSAppointment.startTime)||(a.startTime=a.WSAppointment.startTime,a.endTime=a.WSAppointment.endTime);/* *IMP* if you want to send endTime then just add 'endTime: $scope.endTime' below 'startTime: $scope.startTime' and make entry of same in params in appointmentModule */
var b=null;a.onBehalfOf&&!a.onBehalfOf.queryUrl&&(b=a.onBehalfOf),d.go("manageFixAppointment",{type:"add",appointmentId:c.appointmentId,slotId:c.slotId,entityType:c.entityType,entityName:c.entityName,eventType:c.eventType,eventName:c.eventName,apptDate:c.apptDate,apptStartTime:c.apptStartTime,apptEndTime:c.apptEndTime,eventExceptionId:c.eventExceptionId,typeOfService:a.typeOfService,probDescription:a.probDescription,onBehalfOf:b,startTime:a.startTime,endTime:a.endTime,contactNo:a.onBehalfOfCell,onBehalfOfUHID:a.onBehalfOfUHID})},a.closePopup=function(){localStorage.setItem("isPopupOpen","false"),w.hide()},a.selectedUser=function(d){a.requestObject.userId=d,"view"!==c.type&&(d!=i.getLoggedInUser().id?a.hideDeleteBtn=!0:a.hideDeleteBtn=!1),b.$broadcast("getAttachmentList")},a.$watch("WSAppointment.entityName",function(b){b&&b.id&&("CAL_PROCESS"==a.WSAppointment.entityType.code?(a.isSpecificProfessionalDisabled=!1,a.specificDoctor={queryUrl:"GET_PROCESS_PROFSSIONAL_BY_PROCESS_ID",queryParameter:{processId:b.id}}):a.isSpecificProfessionalDisabled=!0)},!0),a.$watch("WSAppointment.onBehalfOfAddress",function(b){b&&a.WSAppointment.eventType&&("add"!=c.type&&"view"!=c.type||"CAL_EVENT_HOME_VISIT"!==a.WSAppointment.eventType.code||(a.WSAppointment.orgLocarionAddress=b))},!0),a.$watch("WSAppointment.apptDate",function(d){d?(!c.slotId&&c.apptDate&&c.eventName&&c.eventName.id?(b.showSpinner=!0,t.getSlotBasedListOnDateByEventId(c.apptDate,c.eventName.id,function(c){b.showSpinner=!1,a.WSSlotTime=c,a.WSSlotTime&&"ADHOC"==a.WSSlotTime[0].appointmentType&&(a.WSAppointment.slotId=a.WSSlotTime[0].id)},function(a){b.showSpinner=!1})):"home"!==c.fromState&&"individualcalendarlist"!==c.fromState&&(a.isSlotBased=!0),c.eventName&&c.eventName.id&&(a.onBehalfOf={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(c.apptDate),eventId:c.eventName.id}})):(a.WSAppointment.startTime=null,a.WSAppointment.endTime=null)},!0),a.selectSlotChanged=function(b){if(b){var c=JSON.parse(b);a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+c.startTime),a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+c.endTime),a.WSAppointment.slotId=c.id}else a.WSAppointment.startTime=null,a.WSAppointment.endTime=null,a.WSAppointment.slotId=null},a.$watchGroup(["WSAppointment.eventName","WSAppointmentDetails.eventName"],function(d,e){if(d&&(d[0]&&d[0].id||d[1]&&d[1].id)){if("add"==c.type){b.showSpinner=!0;var f=null;f=d[0]&&d[0].id?d[0].id:d[1].id,a.WSAppointment.onBehalfOf&&a.WSAppointment.onBehalfOf.id?t.getOnBehalfAddressDetails(a.WSAppointment.onBehalfOf.id,f,function(c){b.showSpinner=!1,a.WSAppointment.onBehalfOfCellPhone=c.phoneNumber,a.WSAppointment.UHID=c.uhidnumber,a.WSAppointment.isNewUHID=c.isNewUHID,a.WSAppointment.onBehalfOfAddress=c.userAddress,a.WSAppointment.eventType&&"CAL_EVENT_HOME_VISIT"===a.WSAppointment.eventType.code&&(a.WSAppointment.orgLocarionAddress=c.userAddress)}):b.showSpinner=!1}a.WSAppointment.onBehalfOf&&t.getEarlierAppointmentDetails(a.WSAppointment.onBehalfOf.id,function(c){b.showSpinner=!1,a.WSAppointment.lastProfessional=c}),a.WSAppointment.serviceType&&a.WSAppointment.serviceType.id&&a.WSAppointment.onBehalfOf.id&&(a.WSAppointment.eventName?a.getFreeVisitDetails(a.WSAppointment.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id):a.WSAppointmentDetails.eventName&&a.getFreeVisitDetails(a.WSAppointmentDetails.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id))}else a.WSAppointment.onBehalfOfCellPhone=null,a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.UHID=null}),a.$watch("WSAppointment.onBehalfOf",function(d,e){if(d&&d.id){if("add"==c.type&&(c.eventName||c.fromState))if("home"==c.fromState){if(a.fromState="home",a.WSAppointment.eventName||a.WSAppointmentDetails.eventName){var f=null;f=a.WSAppointment.eventName?a.WSAppointment.eventName.id:a.WSAppointmentDetails.eventName.id,b.showSpinner=!0,t.getOnBehalfAddressDetails(d.id,f,function(c){b.showSpinner=!1,a.WSAppointment.onBehalfOfCellPhone=c.phoneNumber,a.WSAppointment.UHID=c.uhidnumber,a.WSAppointment.isNewUHID=c.isNewUHID,a.WSAppointment.onBehalfOfAddress=c.userAddress,"CAL_EVENT_HOME_VISIT"===a.WSAppointment.eventType.code&&(a.WSAppointment.orgLocarionAddress=c.userAddress)})}}else"individualcalendarlist"==c.fromState?a.fromState="individualcalendarlist":(b.showSpinner=!0,t.getOnBehalfAddressDetails(d.id,c.eventName.id,function(c){b.showSpinner=!1,a.WSAppointment.onBehalfOfCellPhone=c.phoneNumber,a.WSAppointment.UHID=c.uhidnumber,a.WSAppointment.isNewUHID=c.isNewUHID,a.WSAppointment.onBehalfOfAddress=c.userAddress,"CAL_EVENT_HOME_VISIT"===a.WSAppointment.eventType.code&&(a.WSAppointment.orgLocarionAddress=c.userAddress)}));
//$rootScope.showSpinner = true;
t.getEarlierAppointmentDetails(d.id,function(c){b.showSpinner=!1,
//conslole.log(successResponse);
//$scope.WSCalendarEvent.dateMapped = successResponse.dateMapped;
a.WSAppointment.lastProfessional=c}),a.WSAppointment.serviceType&&a.WSAppointment.serviceType.id&&a.WSAppointment.onBehalfOf.id&&(a.WSAppointment.eventName?a.getFreeVisitDetails(a.WSAppointment.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id):a.WSAppointmentDetails.eventName&&a.getFreeVisitDetails(a.WSAppointmentDetails.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id))}else a.WSAppointment.onBehalfOfCellPhone=null,a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.UHID=null},!0),a.$watch("WSAppointment.serviceType",function(b,c){b&&b.id&&a.WSAppointment.onBehalfOf&&a.WSAppointment.onBehalfOf.id&&(a.WSAppointment.eventName?a.getFreeVisitDetails(a.WSAppointment.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id):a.WSAppointmentDetails.eventName&&a.getFreeVisitDetails(a.WSAppointmentDetails.eventName.id,a.WSAppointment.serviceType.id,a.WSAppointment.onBehalfOf.id))},!0),a.$watch("WSAppointmentDetails.orgUser",function(c,d){c&&c.id&&a.WSAppointmentDetails.organizationLocation.data.id&&"CAL_ORGANIZATION_USER"==a.WSAppointmentDetails.entityTypeName.code&&(a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES",queryParameter:{locationId:a.WSAppointmentDetails.organizationLocation.data.id,userId:c.id}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType))},!0),a.$watch("WSAppointmentDetails.organizationLocation",function(c,d){c&&c.data&&c.data.id&&a.WSAppointmentDetails.orgUser&&a.WSAppointmentDetails.orgUser.id&&"CAL_ORGANIZATION_USER"==a.WSAppointmentDetails.entityTypeName.code&&(a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES",queryParameter:{locationId:c.data.id,userId:a.WSAppointmentDetails.orgUser.id}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType))},!0),a.getAvailableSlots=function(){l.isFieldEmpty(a.WSAppointment.apptDate)||l.isFieldEmpty(a.WSAppointmentDetails.eventName)||(a.getCalendarEventDetails(a.WSAppointmentDetails.eventName.id),/*$scope.getFreeVisitDetails($scope.WSAppointmentDetails.eventName.id);*/
a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:a.WSAppointmentDetails.eventName.id}},a.onBehalfOf={queryUrl:"GET_PATIENT_NAME",queryParameter:{eventDate:p.convertToServerDate(a.WSAppointment.apptDate),eventId:a.WSAppointmentDetails.eventName.id}},b.$broadcast("loadWSAppointmentServiceType",a.serviceType),a.WSAppointment.eventId=a.WSAppointmentDetails.eventName.id,t.getSlotBasedListOnDateByEventId(a.WSAppointment.apptDate,a.WSAppointmentDetails.eventName.id,function(c){b.showSpinner=!1,a.WSSlotTime=c,a.WSSlotTime&&"CAL_PROCESS"==a.WSAppointmentDetails.entityTypeName.code&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+a.WSSlotTime[0].startTime),a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate),a.WSAppointment.slotId=a.WSSlotTime[0].id),a.WSSlotTime&&"ADHOC"==a.WSSlotTime[0].appointmentType&&(a.WSAppointment.slotId=a.WSSlotTime[0].id)},function(a){b.showSpinner=!1}))},a.getEntityImageInfo=function(b){l.isNullOrEmpty(b)||i.getUserImageInfo(b,function(b){a.entityImageUrl=b},function(b){a.entityImageUrl="app/images/user.jpg"})},a.paymentMethod=function(b){if(c.appointmentId&&localStorage.setItem("appointmentId",c.appointmentId),"AT_BOOKING"===a.WSAppointment.paymentToBeTaken&&b){var e={transactionId:b};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"FIX_APPOINTMENTS"})),x.getWhetherBillDetails(e,function(a){d.go("billsummaryview",{transactionId:b})},function(a){var b="UNABLE_TO_FIX_APPOINTMENT",e="UNABLE_TO_FIX_APPOINTMENT_MESSAGE";1==i.getLoggedInUser().isOrganizationUserMode&&(e="APPOINTMENT_FEE_NOT_FOUND_BODY",b="FEE_TYPE_NOT_FOUND_TITLE");var f=w.confirm().title(g.instant(b)).textContent(g.instant(e)).ok(g.instant("OK")).cancel(g.instant("CANCEL"));w.show(f).then(function(){},function(){d.go("appointmentsList",c)})},{handleError:!1})}},a.saveFixAppointment=function(e){b.showSpinner=!0,t.saveFixAppointment(a.WSAppointment,c.type,function(e){if(b.showSpinner=!1,localStorage.setItem("isPopupOpen","false"),w.hide(),e.response)if(f("success",g.instant("ADDED_SUCCESS")),c.appointmentId=e.response.appointmentId,a.stateParamValue=e.response.appointmentId,a.WSAppointment.isFreeVisit||"AT_BOOKING"!=e.response.paymentToBeTaken)a.getAppointmentDetailsById(c.appointmentId);else if(a.whetherOrgUser){if(e.response.transactionId){b.showSpinner=!0;var h=[e.response.transactionId];y.generateBill(h,function(h){b.showSpinner=!1;var i=w.confirm().title(g.instant("PAYMENT_CONFIRMATION")).textContent(g.instant("APPOINTMENT_PAYMENT_PERMISSION")).ok(g.instant("YES")).cancel(g.instant("NO"));w.show(i).then(function(){B.setIsBilledOfAppointment(e.response.appointmentId,function(b){var c={};c.entityName=a.WSAppointment.entityName,c.apptDate=a.WSAppointment.apptDate,c.event=a.WSAppointment.eventName,d.go("managebill",{parentState:"APPOINTMENT",billId:h.response,type:"view",createReceipt:!0,appointmentDetails:c})},function(a){}),b.showSpinner=!1},function(){f("success",g.instant("ADDED_SUCCESS")),c.type="edit",c.appointmentId=c.appointmentId,a.init()})},function(a){b.showSpinner=!1;var e="UNABLE_TO_FIX_APPOINTMENT",f="UNABLE_TO_FIX_APPOINTMENT_MESSAGE";1==i.getLoggedInUser().isOrganizationUserMode&&(f="APPOINTMENT_FEE_NOT_FOUND_BODY",e="FEE_TYPE_NOT_FOUND_TITLE");var h=w.confirm().title(g.instant(e)).textContent(g.instant(e)).ok(g.instant("OK")).cancel(g.instant("CANCEL"));w.show(h).then(function(){},function(){d.go("appointmentsList",c)})},{handleError:!1})}}else a.paymentMethod(e.response.transactionId)},function(a){b.showSpinner=!1,localStorage.setItem("isPopupOpen","false"),w.hide(),l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},a.getCliniclList=function(){if(a.generatedAppointmentId||(a.clinicalNotes=[]),c.treatmentRecId){var b={};b.recordId=c.treatmentRecId}else{var b={};b.appointmentId=a.generatedAppointmentId}var d=k.getParameterizedUrl("GET_CLINICAL_NOTES_FOR_APPOINTMENT",b);if(d)return j.getData(d,null,function(b){if(b&&b.data)return a.clinicalNotes=b.data,a.clinicalNotes},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getOrgLocationAddressDetails=function(c){l.isNullOrEmpty(c)||(b.showSpinner=!0,v.findCurrentAddressOfLocation(c,function(c){b.showSpinner=!1;var d="";c.addressLine1&&(d+=c.addressLine1+", "),c.addressLine2&&(d+=c.addressLine2+", "),c.addressLine3&&(d+=c.addressLine3+", "),c.city&&c.city.value&&(d+=c.city.value+", "),c.district&&c.district.value&&(d+=c.district.value+", "),c.state&&c.state.value&&(d+=c.state.value+", "),c.country&&c.country.value&&(d+=c.country.value+", "),c.postalCode&&(d+=c.postalCode),null!=d&&d.length>0&&","==d.charAt(d.length-1)&&(d=d.substring(0,d.length()-1)),a.WSAppointment.orgLocarionAddress=d}))},a.getCalendarEventDetails=function(c){l.isNullOrEmpty(c)||(b.showSpinner=!0,u.getCalendarEventDetails(c,function(c){b.showSpinner=!1,a.setDataToAppointmentForm(c)}))},a.getAppointmentDetailsById=function(d){l.isNullOrEmpty(d)||(b.showSpinner=!0,t.getAppointmentDetailsById(d,function(e){a.generatedAppointmentId=d,b.showSpinner=!1,a.setAppDataToAppointmentForm(e),a.getUserByAppointmentId(),a.onUserSelection(i.getLoggedInUser().id),a.isAppointmentPresent=!0,a.stateParamValue=d,a.disabledFormFields=!0,"add"==c.type&&(c.type="edit")}))},a.getFreeVisitDetails=function(c,d,e){l.isNullOrEmpty(c)||(b.showSpinner=!0,t.getFreeVisitDetails(c,d,e,function(c){b.showSpinner=!1,c.data.isFreeVisit?(a.WSAppointment.isFreeVisit=!0,a.isFreeVisitDisabled=!1):(a.WSAppointment.isFreeVisit=!1,a.isFreeVisitDisabled=!0),a.WSAppointment.isFollowUp=c.data.isFollowUp},function(b){a.isFreeVisitDisabled=!0}))},a.setAppDataToAppointmentForm=function(b){b.id&&(a.WSAppointment.id=b.id),b.eventId&&(a.getCalendarEventDetails(b.eventId),a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:b.eventId}}),b.apptDate?(a.WSAppointment.apptDate=h("timestampToDate")(b.apptDate,"MM/dd/yyyy"),a.isAppoinmentDateDisabled=!0):a.isAppoinmentDateDisabled=!1,b.apptStartTime?(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+b.apptStartTime),a.isStartTimeDisabled=!0):a.isStartTimeDisabled=!1,b.apptEndTime?(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+b.apptEndTime),a.isEndTimeDisabled=!0):a.isEndTimeDisabled=!1,b.slotId?(a.WSAppointment.slotId=b.slotId,a.displayId=b.slotId,a.isSlotBased=!0):a.isSlotBased=!1,b.isFollowUp&&(a.WSAppointment.isFollowUp=b.isFollowUp),b.isRecurring&&(a.WSAppointment.isRecurring=b.isRecurring,a.isRecurring=b.isRecurring),b.serviceType&&b.serviceType.id&&(a.WSAppointment.serviceType=b.serviceType),b.problemDescription&&(a.WSAppointment.problemDescription=b.problemDescription),b.specificDoctor&&b.specificDoctor.id&&(a.WSAppointment.specificDoctor=b.specificDoctor),b.user&&b.user.id&&(a.WSAppointment.userName=b.user,a.getUserByAppointmentId()),b.onBehalfOf&&b.onBehalfOf.id?a.WSAppointment.onBehalfOf=b.onBehalfOf:b.onBehalfOfName&&(a.WSAppointment.onBehalfOf={value:b.onBehalfOfName}),b.onBehalfOfCellPhone&&(a.WSAppointment.onBehalfOfCellPhone=b.onBehalfOfCellPhone),b.onBehalfOfAddress&&(a.WSAppointment.onBehalfOfAddress=b.onBehalfOfAddress),b.isNewUHID&&(a.WSAppointment.isNewUHID=b.isNewUHID),b.UHID&&($scopeWSAppointment.UHID=b.UHID),b.isFreeVisit?(a.WSAppointment.isFreeVisit=b.isFreeVisit,a.isFreeVisitDisabled=!0):a.isFreeVisitDisabled=!1,b.orgLoc&&b.orgLoc.id&&(a.WSAppointment.orgLocId=b.orgLoc.id)},a.setDataToAppointmentForm=function(b){if(!l.isEmpty(b)){var d=i.getLoggedInUser();b.entityTypeDetails&&b.entityTypeDetails.id&&(a.WSAppointment.entityType=b.entityTypeDetails,"CAL_EQUIPMENT"==a.WSAppointment.entityType.code&&1==d.userAccountStatusDTO.whetherDoctor&&(a.WSAppointment.onBehalfOf={id:d.id,value:d.displayName})),b.entityId&&b.entityName&&(a.WSAppointment.entityName={id:b.entityId,value:b.entityName},"CAL_ORGANIZATION_USER"===a.WSAppointment.entityType.code?("ADHOC"==b.appointmentType&&(a.typeOfAppt=b.appointmentType,a.isSlotBased=!0,"add"==c.type&&(c.apptStartTime||b.eventStartTime&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+b.eventStartTime)),b.eventEndTime&&(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate)))),a.isOrgUserEntityType=!0,a.getEntityImageInfo(b.entityId),a.WSAppointment.lastProfessional={id:b.entityId,value:b.entityName}):a.isOrgUserEntityType=!1,"CAL_EQUIPMENT"===a.WSAppointment.entityType.code&&"ADHOC"==b.appointmentType&&(a.typeOfAppt=b.appointmentType,a.isSlotBased=!0,"add"==c.type&&(c.apptStartTime||b.eventStartTime&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+b.eventStartTime)),b.eventEndTime&&(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate))))),b.eventType&&(a.WSAppointment.eventType=b.eventType,"CAL_EVENT_HOME_VISIT"!=a.WSAppointment.eventType.code?a.getOrgLocationAddressDetails(b.organizationLocationId):(a.isHomeVisit=!0,a.WSAppointment.onBehalfOfAddress&&(a.WSAppointment.orgLocarionAddress=a.WSAppointment.onBehalfOfAddress))),b.id&&b.eventName&&(a.WSAppointment.eventName={id:b.id,value:b.eventName},a.WSAppointment.eventId=b.id),a.WSAppointment.paymentToBeTaken=b.paymentToBeTaken,"AT_BOOKING"==a.WSAppointment.paymentToBeTaken?a.isServiceRequired=!0:a.isServiceRequired=!1,a.WSAppointment.orgLocId=b.organizationLocationId,b.appointmentType&&"ADHOC"==b.appointmentType&&"add"==c.type&&(a.isStartTimeDisabled=!1,a.isEndTimeDisabled=!1)}},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()},/*Map Integration Start*/
a.currentPosition=[18.51954370906854,73.85534405708313],/*$scope.$watch('WSEventSession.city', function (newValue) {
            if (newValue) {
                $scope.currentPosition = newValue.value;
            }
        });*/
a.$watch("WSAppointment.orgLocarionAddress",function(b){b&&(a.currentPosition=b)}),a.getPosition=function(b){if(!a.disabledFormFields&&(a.currentPosition=q.getCoordinates(b),!l.isFieldEmpty(b))){/* $scope.WSEventSession.googleMapLink = "http://maps.google.com/?ll=" + event.latLng.lat() + "," + event.latLng.lng();*/
var c=new google.maps.Geocoder;c.geocode({latLng:b.latLng},function(b,c){c==google.maps.GeocoderStatus.OK&&b[1]&&angular.forEach(b[1].address_components,function(c,d){d>=0&&"administrative_area_level_2"==c.types[0]&&(a.zoom=15,/*$scope.WSEventSession.city = angular.copy({
                                                id: 1,
                                                value: v.long_name
                                            });*/
a.WSAppointment.orgLocarionAddress=b[1].formatted_address,s(function(){angular.element(document.getElementById("clickHere")).trigger("click")},0))})})}};/*Map Integration End*/
//datatble config json
var E={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=m.setOptionProperties(E),a.dtColumnDefs=m.setColumnProperties({}),a.getUserByAppointmentId=function(){var b=i.getLoggedInUser();a.requestObject={},a.requestObject.module="appointmentId",a.requestObject.moduleNameAndUser="findAttachmentByAppointmentAndUser",a.requestObject.moduleName="deleteAttachmentsByAppointmentIdAndDocId",a.requestObject.forId=c.appointmentId,a.WSAppointment.userName?a.requestObject.userId=a.WSAppointment.userName.id:b&&(a.requestObject.userId=b.id);var d={pathName:"findUsersByAppointmentId",id:c.appointmentId};z.getUsersByAppointmentOrRequestId(d,function(b){a.WSApptUserDetails.userList=b})},a.onUserSelection=function(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")},/**
         * Called when entity type is selected
         */
a.entityTypeSelected=function(){a.WSAppointmentDetails.entityId=null,a.changeEntityVisuals(a.WSAppointmentDetails.entityTypeName),"CAL_ORGANIZATION_USER"==a.WSAppointmentDetails.entityTypeName.code?l.isFieldEmpty(a.WSAppointmentDetails.orgUser)||l.isFieldEmpty(a.WSAppointmentDetails.orgUser.id)||(a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES",queryParameter:{locationId:a.WSAppointmentDetails.organizationLocation.data.id,userId:a.WSAppointmentDetails.orgUser.id}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType)):("CAL_PROCESS"==a.WSAppointmentDetails.entityTypeName.code&&(a.isSlotBased=!0,a.isStartTimeDisabled=!1,a.isEndTimeDisabled=!1),a.eventType={queryUrl:"GET_EVENT_TYPE_BY_ENTITY_TYPE_ID",queryParameter:{entityType:a.WSAppointmentDetails.entityTypeName.code}},b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType)),a.eventName.jsonParameter.locationId=a.WSAppointmentDetails.organizationLocation.data.id,a.eventName.jsonParameter.entityType=a.WSAppointmentDetails.entityTypeName.code,"individualcalendarlist"!=a.fromState&&(a.WSAppointmentDetails.orgUser=null),a.WSAppointmentDetails.eventType=null,a.WSAppointment.startTime=null,a.WSAppointmentDetails.eventName=null,a.WSAppointment.endTime=null,b.$broadcast("loadWSAppointmentDetailsEventType",a.eventType)},a.getUserNames=function(b,c){return a.userData={},a.userData.userName=b,a.userData.orgLocId=c,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("FIND_USERBYORGLOC",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.entitySelected=function(){l.isFieldEmpty(a.WSAppointmentDetails.entityId)||(a.eventName.jsonParameter.entityId=a.WSAppointmentDetails.entityId.id)},a.userNameChanged=function(){l.isFieldEmpty(a.WSAppointmentDetails.orgUser)||(a.eventName.jsonParameter.entityId=a.WSAppointmentDetails.orgUser.id)},a.setEventType=function(b,c){l.isFieldEmpty(b)?a.eventName.jsonParameter.eventTypeId=null:a.eventName.jsonParameter.eventTypeId=b.id,"onSelect"===c&&(a.WSAppointmentDetails.eventName=null)},a.changeEntityVisuals=function(b){if("CAL_ORGANIZATION_USER"==b.code)a.WSAppointmentDetails.entityId=null,"individualcalendarlist"!=a.fromState&&!l.isEmpty(i.getLoggedInUser());else{var c="";l.isFieldEmpty(a.WSAppointmentDetails.orgUser)||(a.WSAppointmentDetails.orgUser=null),c="CAL_EQUIPMENT"==b.code?"FIND_EQUIPMENT_BY_LOC_ID":"FIND_PROCESS_BY_LOC_ID";var d={orgLocationId:a.WSAppointmentDetails.organizationLocation.data.id};j.getData(k.getUrl(c),d,function(b){a.entities=b.data},function(a){})}"CAL_ORGANIZATION_LOCATION"==b.code&&(a.eventName.jsonParameter.entityId=a.WSAppointmentDetails.organizationLocation.data.id)},a.showNotes=function(){c.appointmentId&&d.go("appointmentnotes",{appointmentId:c.appointmentId,type:c.type,otp:c.otp,accessKeyId:c.accessKeyId})},a.getCalendarEventException=function(d,e){l.isNullOrEmpty(d)||(b.showSpinner=!0,u.getCalendarEventException(d,function(d){b.showSpinner=!1,"ADHOC"==d.appointmentType&&(a.isSlotBased=!0,c.apptStartTime&&(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+c.apptStartTime)),c.apptEndTime&&(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+c.apptEndTime)))}))},/* Code for searching user by phone number and UHID 11/1/19 - START */
a.searchUserByNumber=function(b){if(l.isNullOrEmpty(b))c.contactNo||(a.WSAppointment.onBehalfOfCellPhone=null),a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.onBehalfOf=null;else{var d={};d.cell=b,j.postData(k.getUrl("CHECK_USER_BY_EMAIL_AND_CELL"),d,function(b){b&&b.data&&b.data.length>0&&(a.WSAppointment.onBehalfOf={id:b.data[0].userId,value:b.data[0].displayName})},function(a){})}},a.getDetailsByUhid=function(b){l.isNullOrEmpty(b)?(c.contactNo||(a.WSAppointment.onBehalfOfCellPhone=null),a.WSAppointment.onBehalfOfAddress=null,a.WSAppointment.onBehalfOf=null):(a.requestData={},a.requestData.searchKeyWord=b,a.requestData.orgLocId=a.WSAppointment.orgLocId,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("FIND_CLIENT_BY_UHID",a.requestData),null,function(b){a.userNameAutoCmpLoading=!1,b&&b.data&&(a.WSAppointment.onBehalfOf={id:b.data[0].id,value:b.data[0].value})},function(b){a.userNameAutoCmpLoading=!1}))},/* Code for searching user by phone number and UHID 11/1/19 - END */
//Init Method
a.init=function(){localStorage.getItem("appointmentId")&&localStorage.removeItem("appointmentId");var b=i.getLoggedInUser();if(b)"add"==c.type&&(a.minDate=new Date,a.WSAppointment.userName={id:b.id,value:b.displayName}),b.isOrganizationUser&&b.isOrganizationUserMode?a.whetherOrgUser=!0:(a.WSAppointment.onBehalfOf={id:b.id,value:b.displayName},a.whetherOrgUser=!1);else if(c.otp&&c.accessKeyId){var e={};e.accessKeyId=c.accessKeyId,e.currentOTP=c.otp,j.getData(k.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",e),null,function(a){a&&1==a.data||(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||(f("error","OTP Has Expired Or Invalid Access"),d.go("login"))})}else f("error","Invalid Access"),d.go("login");"edit"==c.type&&c.appointmentId?(a.getAppointmentDetailsById(c.appointmentId),a.isAppointmentPresent=!0):"add"==c.type?("home"==c.fromState&&(a.fromState="home",j.getData(k.getUrl("GET_CONDITION_ENTITY_TYPE"),null,function(b){a.entityTypes=angular.fromJson(b.data)},function(a){})),"individualcalendarlist"==c.fromState&&(a.fromState="individualcalendarlist",j.getData(k.getUrl("GET_CONDITION_ENTITY_TYPE"),null,function(b){a.entityTypes=angular.fromJson(b.data)},function(a){}),c.orgLocation&&(a.WSAppointmentDetails.organizationLocation={},a.WSAppointmentDetails.organizationLocation.data=c.orgLocation),c.entityType&&(a.selectedEntityTypeId=c.entityType.id),c.entityName&&(a.selectedEntityId=c.entityName.id),c.entityType&&"CAL_ORGANIZATION_USER"==c.entityType.code&&c.entityName&&(a.WSAppointmentDetails.orgUser={displayName:c.entityName.value,id:c.entityName.id})),a.isAppointmentPresent=!1,c.eventName&&c.eventName.id?(a.getCalendarEventDetails(c.eventName.id),c.eventExceptionId&&a.getCalendarEventException(c.eventExceptionId),/*$scope.getFreeVisitDetails($stateParams.eventName.id);*/
a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:c.eventName.id}}):(c.entityType&&(a.WSAppointment.entityType=c.entityType,"CAL_EQUIPMENT"==c.entityType.code&&1==i.getLoggedInUser().userAccountStatusDTO.whetherDoctor&&(a.WSAppointment.onBehalfOf={id:b.id,value:b.displayName})),c.entityName&&(a.WSAppointment.entityName=c.entityName),c.eventType&&(a.WSAppointment.eventType=c.eventType),c.eventName&&(a.WSAppointment.eventName=c.eventName,a.WSAppointment.eventId=c.eventName.id)),c.apptDate?(a.WSAppointment.apptDate=h("timestampToDate")(c.apptDate,"MM/dd/yyyy"),a.isAppoinmentDateDisabled=!0):a.isAppoinmentDateDisabled=!1,c.slotId?(a.WSAppointment.slotId=c.slotId,a.isSlotBased=!0,c.apptStartTime?(a.WSAppointment.startTime=new Date(a.WSAppointment.apptDate+" "+c.apptStartTime),//$stateParams.apptStartTime;
a.popUpStartTime=c.apptStartTime,"CAL_PROCESS"!=c.entityType.code?a.isStartTimeDisabled=!0:a.isStartTimeDisabled=!1):a.isStartTimeDisabled=!1,c.apptEndTime?(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate+" "+c.apptEndTime),a.popUpEndTime=c.apptEndTime,"CAL_PROCESS"!=c.entityType.code?a.isEndTimeDisabled=!0:a.isEndTimeDisabled=!1):(a.WSAppointment.endTime=new Date(a.WSAppointment.apptDate),a.isEndTimeDisabled=!1)):"ADHOC"!=c.appointmentType&&c.entityType&&"CAL_PROCESS"!=c.entityType.code&&(a.isSlotBased=!1)):"view"==c.type&&(a.getUserByAppointmentId(),a.getAppointmentDetailsById(c.appointmentId),a.isAppointmentPresent=!0,a.disabledFormFields=!0,a.isViewMode=!0)},a.init(),/*$scope.tabChange = function(value){
            $scope.isFixAppointment = false;
            $scope.isSchedule = false;
            $scope.isException = false;
            if(value == 'fixAppointment'){
                $scope.isFixAppointment = true;
            }
            if(value == 'schedule'){
                $scope.isSchedule = true;
            }
            if(value == 'exception'){
                $scope.isException = true;
            }
        }*/
a.$watch("WSScheduleAppointment.frequency",function(b){b&&b.id?(a.isWeekly=!1,a.isDaily=!1,a.isAdhoc=!1,a.isDefinePerVisit=!1,"WEEKLY"==b.id&&(a.isWeekly=!0),"DAILY"==b.id&&(a.isDaily=!0),"ADHOC"==b.id&&(a.isAdhoc=!0),"DEFINE_PER_VISIT"==b.id&&(a.isDefinePerVisit=!0,a.WSScheduleAppointment.perVisitStartdate=p.convertToViewDate(new Date),a.WSScheduleAppointment.perVisitEndDate=a.WSScheduleAppointment.perVisitStartdate)):(a.isWeekly=!1,a.isDaily=!1,a.isAdhoc=!1,a.isDefinePerVisit=!1)},!0),a.defineSchedule=function(){a.WSScheduleAppointment.onBehalfOfId=a.WSAppointment.onBehalfOf.id,a.isWeekly?t.createWeeklyObject(a.WSAppointmentWeekly,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isDaily?t.createDailyObject(a.WSAppointmentDaily,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isAdhoc?t.createAdhocObject(a.WSAppointmentAdhocList,function(b){a.WSScheduleAppointment.scheduleDetails=b}):a.isDefinePerVisit&&t.createDefinePerVisitObject(a.WSAppointmentDefinePerVisit,function(b){a.WSScheduleAppointment.scheduleDetails=b}),c.appointmentId&&(a.WSScheduleAppointment.appointmentId=c.appointmentId),a.WSAppointment.eventName&&a.WSAppointment.eventName.id&&(a.WSScheduleAppointment.eventId=a.WSAppointment.eventName.id),t.defineSchedule(a.WSScheduleAppointment,function(c){b.showSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),a.isSchedulePresent=!0},function(a){b.showSpinner=!1,l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},a.scheduleAppointment=function(b,c,d){w.show({controller:D,templateUrl:"app/modules/appointment/views/schedule-appointment-popup.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:A.dialogBox.clickOutsideToClose,locals:{editData:c,index:d}}).then(function(b){var c=h("date")(b.startTime,"HH:mm:ss"),e=h("date")(b.endTime,"HH:mm:ss");b.index==-1?(b.startTime=c,b.endTime=e,delete b.index,a.WSAppointmentAdhocList.push(b)):(a.WSAppointmentAdhocList[d].startTime=c,a.WSAppointmentAdhocList[d].endTime=e)},function(){})},a.deleteScheduleAppointment=function(b){a.WSAppointmentAdhocList.splice(b,1)},a.editJson={pageNumber:0,recordsPerPage:0,sorters:[],eventId:1,patientId:5,appointmentId:1,fromDate:1454265e6,tillDate:14579802e5,frequency:"ADHOC",scheduleDetails:[{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"MONDAY",date:1454265e6},{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"TUESDAY",date:1454265e6},{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"WEDNESDAY",date:1454265e6},{id:null,startTime:"10:15:00",endTime:"10:15:00",day:"FRIDAY",date:1454265e6}]},a.bindData=function(){if(a.WSScheduleAppointment.fromDate=h("timestampToDate")(a.editJson.fromDate,"MM/dd/yyyy"),a.WSScheduleAppointment.tillDate=h("timestampToDate")(a.editJson.tillDate,"MM/dd/yyyy"),a.WSScheduleAppointment.frequency={id:a.editJson.frequency,value:g.instant(a.editJson.frequency)},"WEEKLY"==a.editJson.frequency&&t.editWeeklyObject(a.editJson,function(b){a.WSAppointmentWeekly=b}),"DAILY"==a.editJson.frequency){var b=h("timestampToDate")(a.editJson.fromDate,"MM/dd/yyyy");a.WSAppointmentDaily.startTime=new Date(b+" "+a.editJson.scheduleDetails[0].startTime),a.WSAppointmentDaily.endTime=new Date(b+" "+a.editJson.scheduleDetails[0].endTime)}if("ADHOC"==a.editJson.frequency&&(a.WSAppointmentAdhocList=a.editJson.scheduleDetails),"DEFINE_PER_VISIT"==a.editJson.frequency){var b=h("timestampToDate")(a.editJson.fromDate,"MM/dd/yyyy");a.WSScheduleAppointment.perVisitStartdate=b,a.WSScheduleAppointment.perVisitEndDate=b}}}]),angular.module("paripal.appointmentModule").controller("RequestUploadDownloadCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$filter","serverSidePagination","userStatusService","httpService","urlService","utilService","appointmentsUploadDownloadService","emergencyUploadListService","commonConstants","fileOperations",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(){if(m.isFieldEmpty(c.data)){var b={};b.requestId=1,n.getUserDetailsByRequestId(b,function(b){if(!m.isFieldEmpty(b)){angular.copy(b,a.WSServiceRequestUserDetails),a.WSServiceRequestUserDetails.requestId=1,m.isFieldEmpty(a.WSServiceRequestUserDetails.apptDate)||(a.WSServiceRequestUserDetails.apptDate=h("timestampToDate")(a.WSServiceRequestUserDetails.apptDate));var c={pathName:"findUsersByRequestId",id:a.WSServiceRequestUserDetails.requestId};n.getUsersByAppointmentOrRequestId(c,function(b){a.WSServiceRequestUserDetails.userList=b})}})}else angular.copy(c.data,a.WSServiceRequestUserDetails),m.isFieldEmpty(a.WSServiceRequestUserDetails.apptDate)||(a.WSServiceRequestUserDetails.apptDate=h("timestampToDate")(a.WSServiceRequestUserDetails.apptDate))}a.WSServiceRequestUserDetails={},a.commonConstants=p;var s=function(){r(),a.requestObject={},a.requestObject.module="requestId",a.requestObject.moduleNameAndUser="findAttachmentByRequestAndUser",a.requestObject.moduleName="deleteAttachmentsByRequestIdAndDocId",a.requestObject.forId=1,//$scope.WSServiceRequestUserDetails.requestId;
a.requestObject.userId=j.userData().userId};a.selectedUser=function(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")},a.fileChange=function(b){a.files=[];var b=angular.element(b);if(b){var c=angular.element(document.querySelector("input#fileInput")),d=c[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)}),c.val(null)}a.files&&a.files.length>0&&a.saveAllDocuments(a.files)},a.saveAllDocuments=function(b){var c={};c.documentType={},c.documentType.type=p.documentTypes.transaction,c.documentType.subType=p.documentSubTypes.request_transaction,c.documentType.id=24,a.fileUploadSpinner=!0,q.saveAllDocuments(c,!1,b,function(d){b&&b.length>0&&d&&a.saveTransactionAttachment(b,c,d)},function(b){a.fileUploadSpinner=!1})},a.saveTransactionAttachment=function(b,c,d){var e={};m.isFieldEmpty(a.transactionId)||(e.transactionId=a.transactionId),e.documentIds=[];for(var f=0;f<d.response.length;f++)e.documentIds.push(d.response[f].id);e.requestId=a.WSServiceRequestUserDetails.requestId,o.saveTransactionAttachment(e,function(f){b&&b.length>0&&d&&a.uploadFile(b,c,d,e)},function(b){a.fileUploadSpinner=!1,o.deleteAllDocument(e.documentIds,function(a){},function(a){})})},a.uploadFile=function(c,d,e,g){var h=new Object;h.docType=d.documentType.type,h.docSubType=d.documentType.subType,h.recordId=a.WSServiceRequestUserDetails.requestId,e.response&&(h.resourceDetails=JSON.stringify(e.response)),q.uploadMultipleFiles(h,c,function(c){a.fileUploadSpinner=!1,b.$broadcast("getAttachmentList")},function(b){a.fileUploadSpinner=!1,f("Error",$translate.instant("ERROR_WHILE_UPLOADING")),o.deleteByTransactionIdAndDocIds(g,function(a){o.deleteAllDocument(g.documentIds,function(a){},function(a){})},function(a){})})},s()}]),angular.module("paripal.userTestModule").controller("SummaryDataCtrl",["$scope","$rootScope","$stateParams","datatableconfig","$state","notify","$translate","serverSidePagination","httpService","urlService","utilService","commonConstants","baseService","$mdDialog","featurePrivilegeConstants","stateObj","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.summaryData={},a.commonConstants=l,a.showNewCommentField=!1,a.showHistoricDataTable=!1,a.primeComment="",a.editExisting=!1,a.addNewComment=function(b,c){a.rowAddComData={},a.rowAddComData.data=c.clinicalDataMaster.clinicalDataName,a.rowAddComData.value=c.clinicalDataValue,a.rowAddComData.comments=c.appointmentClinicalDataCommentList,a.editExisting=!1,a.showNewCommentField=!0,a.globalIndexToPush=b},a.hideAddUpdateComment=function(){a.showNewCommentField=!1,a.primeComment=""},a.addComment=function(){var b=m.getLoggedInUser();if(!k.isNullOrEmpty(a.primeComment)){var c=a.primeComment;a.systemSummaryData[a.globalIndexToPush].appointmentClinicalDataCommentList.push({id:null,user:{id:b.id,value:b.displayName},actionFlag:"C",comment:c}),angular.forEach(a.systemSummaryData[a.globalIndexToPush].appointmentClinicalDataCommentList,function(b,c){"C"==b.actionFlag&&a.oldDataArray[a.globalIndexToPush].appointmentClinicalDataCommentList.push(b)}),a.showNewCommentField=!1,a.primeComment="",a.editExisting=!1}},a.updateComment=function(){var b=m.getLoggedInUser();if(!k.isNullOrEmpty(a.primeComment)){var c=a.primeComment;angular.forEach(a.oldDataArray[a.globalIndexToPush].appointmentClinicalDataCommentList,function(d,e){k.isNullOrEmpty(a.selectedChipToEdit)||(null==a.selectedChipToEdit.id&&"C"==d.actionFlag?(d.comment=c,d.actionFlag="C"):d.id==a.selectedChipToEdit.id&&(d.comment=c,d.actionFlag="U",d.user.id=b.id,d.user.value=b.displayName,angular.forEach(a.systemSummaryData[a.globalIndexToPush].appointmentClinicalDataCommentList,function(b,c){"U"==d.actionFlag&&b.id==a.selectedChipToEdit.id&&(a.systemSummaryData[a.globalIndexToPush].appointmentClinicalDataCommentList[c]=d)})))})}a.showNewCommentField=!1,a.primeComment="",a.editExisting=!1},a.chipRemoved=function(b,c){null!=a.oldDataArray&&a.oldDataArray.length>0&&angular.forEach(a.oldDataArray,function(a,c){null!=a.appointmentClinicalDataCommentList&&a.appointmentClinicalDataCommentList.length>0&&angular.forEach(a.appointmentClinicalDataCommentList,function(a,c){if(null!=a.id&&b.id==a.id){a.actionFlag="D"}})})},a.chipSelected=function(b,c,d){a.rowAddComData={},a.rowAddComData.data=d.clinicalDataMaster.clinicalDataName,a.rowAddComData.value=d.clinicalDataValue,a.rowAddComData.comments=d.appointmentClinicalDataCommentList,a.selectedChipToEdit=b,a.showNewCommentField=!0,a.primeComment=b.comment,a.editExisting=!0,a.globalIndexToPush=c},a.cancel=function(){n.hide()},a.submitSystemSummary=function(){a.validRequestData=!1,b.showSpinner=!0;var c=[];/*var requestObj = angular.copy($scope.systemSummaryData);*/
angular.forEach(a.systemSummaryData,function(b,d){null!=b.clinicalDataValue&&(a.validRequestData=!0),a.validRequestData&&(c.push({key:d,clinicalDataValue:b.clinicalDataValue}),null!=c&&c.length>0&&angular.forEach(a.oldDataArray,function(a,b){angular.forEach(c,function(c,d){b==c.key&&(a.clinicalDataValue=c.clinicalDataValue)})}))});var d=angular.copy(a.oldDataArray);/*var reqCatIdObj = {};
                reqCatIdObj.categoryId = $scope.categoryId;
                reqCatIdObj.appointmentId = $scope.appt.id;*/
a.validRequestData?i.postData(j.getUrl("SAVE_SYSTEM_SUMMARY"),d,function(c){c&&(b.showSpinner=!1,f("success",g.instant("DATA_RECORDED_SUCCESSFULLY")),a.fetchRecord())},function(a){b.showSpinner=!1}):(b.showSpinner=!1,f("info",g.instant("PLEASE_ENTER_ATLEAST_ONE_VALUE")))},a.viewHistoricData=function(){if(!k.isNullOrEmpty(a.appt)&&(a.showHistoricDataTable=!0,!k.isNullOrEmpty(a.appt.patientId))){var c={};c.userId=a.appt.patientId,c.categoryId=a.categoryId,k.isNullOrEmpty(a.orgLocId)||(c.locationId=a.orgLocId),b.showSpinner=!0,i.getData(j.getParameterizedUrl("FETCH_SYSTEM_SUMMARY_HISTORY",c),null,function(c){b.showSpinner=!1,c&&c.data&&(a.pushComments=[],angular.forEach(c.data.dataArray,function(b,c){angular.forEach(b.historicDataObj,function(b,c){angular.forEach(b.commentList,function(c,d){a.pushComments.push({id:b.index,user:c.user.value,comment:c.comment})})})}),a.historicData=angular.copy(c.data))},function(a){b.showSpinner=!1})}},a.hideHistoricTable=function(){a.showHistoricDataTable=!1},a.fetchRecord=function(){if(k.isNullOrEmpty(c.selectedCat)||k.isNullOrEmpty(c.selectedCat.id)||(a.categoryId=c.selectedCat.id),!k.isNullOrEmpty(c.rowObject)&&!k.isNullOrEmpty(c.rowObject.id)){a.appt=c.rowObject;var d={};d.id=a.appt.id,k.isNullOrEmpty(a.categoryId)||(d.categoryId=a.categoryId),b.showSpinner=!0,i.getData(j.getParameterizedUrl("FETCH_SYSTEM_SUMMARY",d),null,function(c){b.showSpinner=!1,c&&c.data&&(angular.forEach(c.data.appointmentClinicalDataList,function(a,b){"NUMBER"==a.clinicalDataMaster.clinicalDataType&&(a.clinicalDataValue=angular.fromJson(a.clinicalDataValue))}),angular.forEach(c.data.appointmentClinicalDataList,function(a,b){null==a.appointmentClinicalDataCommentList&&(a.appointmentClinicalDataCommentList=[])}),a.oldDataArray=angular.copy(c.data.appointmentClinicalDataList),a.systemSummaryData=angular.copy(c.data.appointmentClinicalDataList),c.data.whetherFirstTime?a.whetherFirstTime=!0:a.whetherFirstTime=!1)},function(a){b.showSpinner=!1})}};var r=function(){k.isNullOrEmpty(c.rowObject)&&!k.isNullOrEmpty(p)&&(c=p,a.dialogHeader=p.selectedCat.value+" "+g.instant("PARAMETERS"),k.isNullOrEmpty(p.rowObject)||k.isNullOrEmpty(p.rowObject.organizationLocationId)||(a.orgLocId=p.rowObject.organizationLocationId)),a.fetchRecord()};r()}]),angular.module("paripal.appointmentModule").controller("TreatmentRecordDetailsPopCtrl",["$scope","$mdDialog","recordDetails","isCurrentDate","$filter","baseService","orbeonFormRunner","httpService","urlService","utilService","notify","$translate","diseaseVariantObj","manageUserIssueService","viewUserTreatmentService","mode","manageUserTreatmentService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(b){"undefined"!=typeof b&&n.getIcd10DetailsById(b,function(b){b&&(a.searchCriteria.icd10CodeDescription=b.icd10CodeDescription)},function(b){a.manageOrgLocSpinner=!1,j.isEmpty(b.data)||j.isEmpty(b.data.messages[0])||k("error",l.instant(b.data.messages[0]))})}function s(b){var c={orgLocId:b.orgLoc.id,serviceTypeId:b.serviceType.id};h.getData(i.getParameterizedUrl("GET_TREATMENT_TYPE_BY_LOCID_SERVICEID",c),null,function(b){a.apptTreatmentType=b.data.treatmentType},function(a){})}function t(b){var c={};c.patientId=b.onBehalfOf.id,c.diseaseVariantId=m.diseaseVariant.id,c.appointmentId=b.id,h.getData(i.getParameterizedUrl("GET_USERTREATMENT_FOR_APPOINTMENT_ID",c),null,function(b){a.userTreatment=b.data,a.searchCriteria.icd10CodeDescription=a.userTreatment.icd10CodeDescription},function(a){})}function u(){var b={appointmentId:m.appointmentId};h.getData(i.getParameterizedUrl("GET_APPOINTMENT_BY_ID",b),null,function(b){a.apptDetails=b.data,s(a.apptDetails),t(a.apptDetails)},function(a){})}
//$scope.searchCriteria = {};
a.recordDetails=c,a.isCurrentDate=d,a.diseaseVariantList=[],a.searchCriteria={},a.getIcd10Details=r,a.getTreatmentType=s,
//$scope.searchCriteria.icd10CodeDescription = {};
a.fillTreatmentRecordDetails=function(b){a.searchCriteria.disease=b.disease,a.searchCriteria.diseaseVariant=b.diseaseVariant,a.searchCriteria.icd10CodeDescription=b.icd10CodeDescription},j.isNullOrEmpty(m)||"view"!=p?j.isNullOrEmpty(m)||"edit"!=p||(a.isEditDisable=!0,a.fillTreatmentRecordDetails(m),!j.isNullOrEmpty(m)&&m.appointmentId&&u()):(a.isDisable=!0,a.fillTreatmentRecordDetails(m)),r(),a.$watch("searchCriteria.icd10CodeDescription",function(a){new Def.Autocompleter.Search("icd10","https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code,name",{tableFormat:!1,valueCols:[0][1],colHeaders:["Code","Name"]})}),a.getDiseaseVariantDetails=function(){if(!j.isNullOrEmpty(a.recordDetails)&&!j.isNullOrEmpty(a.recordDetails.id)||!j.isNullOrEmpty(m)&&!j.isNullOrEmpty(m.appointmentId)){var b={};if(!j.isNullOrEmpty(a.recordDetails)&&!j.isNullOrEmpty(a.recordDetails.id))return b.appointmentId=a.recordDetails.id,h.getData(i.getParameterizedUrl("GET_DISEASE_VARIANT_DETAILS_FOR_APPT",b),null,function(b){j.isNullOrEmpty(b)||j.isNullOrEmpty(b.data)||j.isNullOrEmpty(b.data.disease)||j.isNullOrEmpty(b.data.diseaseVariant)||(a.searchCriteria.disease=b.data.disease,a.diseaseVariantList.push(b.data.diseaseVariant))},function(a){});m.userTreatment&&m.userTreatment.id&&o.getUserTreatmentById(m.userTreatment.id,function(b){a.searchCriteria=b},function(a){})}},a.getDiseaseVariantDetails(),a.cancel=function(){b.cancel()},a.getDisease=function(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,h.getData(i.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseList=angular.fromJson(b.data)},function(a){})},a.$watch("searchCriteria.disease",function(b){b&&a.getDiseaseVariant(b)}),a.getDiseaseVariant=function(b){var c={};return c.diseaseId=b.id,h.getData(i.getParameterizedUrl("GET_VARIANT_BY_DISEASE_ID",c),null,function(b){return a.diseaseVariantList=b.data},function(a){})},a.updateTreatmentRecord=function(){if(j.isFieldEmpty(a.searchCriteria.disease)||j.isFieldEmpty(a.searchCriteria.diseaseVariant)||j.isFieldEmpty(a.recordDetails)||j.isFieldEmpty(a.recordDetails.id))j.isFieldEmpty(a.searchCriteria.disease)||j.isFieldEmpty(a.searchCriteria.diseaseVariant)||"edit"!=p||(a.userTreatment&&(a.userTreatment.icd10CodeDescription=a.searchCriteria.icd10CodeDescription),q.save(a.userTreatment,function(a){k("success",l.instant("DISEASE_DETAILS_UPDATED_SUCCESSFULLY")),b.cancel()},function(a){}));else{var d=angular.copy(a.searchCriteria);d.appointmentId=a.recordDetails.id,h.putData(i.getUrl("UPDATE_APPT_DISEASE_VARIANT"),d,function(d){k("success",l.instant("DISEASE_DETAILS_UPDATED_SUCCESSFULLY")),a.getdiseaseByAppointmentId(c.id,function(a){var d={};d.diseaseVariantList=a.data,d.recordDetails=c,b.cancel(d)},function(a){b.cancel()})},function(a){k("error",l.instant("PLEASE_ADD_TREATMENT_TYPE_FOR_APPT"))})}},a.getdiseaseByAppointmentId=function(a,b,c){var d={appointmentId:a};h.getData(i.getParameterizedUrl("GET_CURRENT_DISEASE_FOR_APPOINTMENT",d),null,function(a){b(a)},function(a){errorResponse(a)})}}]),angular.module("paripal.appointmentModule").controller("UpdateMedicationAppointmentDetailsCtrl",["$scope","$rootScope","$state","$stateParams","httpService","urlService","utilService","notify","dateconvertor","datatableconfig","commonConstants","userStatusService","$filter","$mdDialog","medicationObj","usedFor","appointmentsListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.cancel=function(){n.cancel()},a.saveMedicationAppointmentDetails=function(){o&&o.id&&(a.detailsObj.id=o.id,a.detailsObj.appointment=o.appointment,q.updateMedicationAppointmentDetails(a.detailsObj,function(a){n.cancel(!0)},function(a){}))},a.init=function(){a.detailsObj={},"quantity"==p?(a.showQuantity=!0,o.quantity&&(a.detailsObj={quantity:o.quantity})):(a.showQuantity=!1,o.orderWithUs?a.detailsObj={orderWithUs:o.orderWithUs}:a.detailsObj={orderWithUs:!1})},a.init()}]),angular.module("paripal.appointmentModule").controller("UserAppointmentStatusCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","featurePrivilegeConstants","dateconvertor","userAppointmentStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.calendarEvent={},a.disabledFormFields=!1,b.showSpinner=!1,a.$watch("calendarEvent.doctorIsIn",function(b,c){b?(a.isExpectedTimeDisabled=!0,a.calendarEvent.doctorExpectedTime=null):a.isExpectedTimeDisabled=!1}),a.saveDoctorStatus=function(d){d.$valid&&(b.showSpinner=!0,p.saveDoctorStatus(a.calendarEvent,c.type,function(d){b.showSpinner=!1,f("success",g.instant("RECORD_UPDATED_SUCCESSFULLY")),a.getUserAppointmentStatus(c.appoinmentId)},function(a){b.showSpinner=!1,a.data&&a.data.messages&&a.data.messages.length>0?f("error",g.instant(a.data.messages[0])):f("error",g.instant("FAILED_TO_SAVE_RECORD"))}))},a.getUserAppointmentStatus=function(c,d){l.isNullOrEmpty(c)||(b.showSpinner=!0,p.getUserAppointmentStatus(c,function(c){b.showSpinner=!1,a.setDataToUserAppointmentStatus(c)}))},a.getUserAppointmentStatusForEvent=function(c,d,e){l.isNullOrEmpty(c)||l.isNullOrEmpty(d)||(b.showSpinner=!0,p.getUserAppointmentStatusByEventId(c,d,function(c){b.showSpinner=!1,a.setDataToUserAppointmentStatus(c)}))},a.setDataToUserAppointmentStatus=function(b){l.isEmpty(b)||(
//$scope.calendarEvent = angular.copy(responseData);
b.entityType&&b.entityType.id&&(a.calendarEvent.entityType=b.entityType),b.entityName&&b.entityName.id&&(a.calendarEvent.entityName=b.entityName),b.eventType&&b.eventType.id&&(a.calendarEvent.eventType=b.eventType),b.doctor&&(a.calendarEvent.doctor=b.doctor),b.eventName&&(a.calendarEvent.eventName=b.eventName),b.eventId&&(a.calendarEvent.eventId=b.eventId),b.appointmentId&&(a.calendarEvent.appointmentId=b.appointmentId),l.isNullOrEmpty(b.patientsBeforeWaiting)||(a.calendarEvent.patientsBeforeWaiting=b.patientsBeforeWaiting),l.isNullOrEmpty(b.patientsCurrentlyInProcess)||(a.calendarEvent.patientsCurrentlyInProcess=b.patientsCurrentlyInProcess),l.isNullOrEmpty(b.patientsNotYetArrived)||(a.calendarEvent.patientsNotYetArrived=b.patientsNotYetArrived),l.isNullOrEmpty(b.totalPatients)||(a.calendarEvent.totalPatients=b.totalPatients),l.isNullOrEmpty(b.avgTimePerPatient)||(a.calendarEvent.avgTimePerPatient=b.avgTimePerPatient),b.doctorIsIn?a.calendarEvent.doctorIsIn=b.doctorIsIn:a.calendarEvent.doctorIsIn=!1,b.apptStartTime&&(a.calendarEvent.apptStartTime=b.apptStartTime),b.apptEndTime&&(a.calendarEvent.apptEndTime=b.apptEndTime),b.doctorExpectedTime&&(a.calendarEvent.doctorExpectedTime=b.doctorExpectedTime))},
// on cancel forward to search list
a.cancel=function(){c.calendarState&&c.callingPage?d.go(c.callingPage,{data:c.calendarState.data}):l.goBackToPrevState()},
//Init Method
a.init=function(){b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1,c.appoinmentId&&a.getUserAppointmentStatus(c.appoinmentId),c.eventId&&c.eventDate&&a.getUserAppointmentStatusForEvent(c.eventId,c.eventDate)},a.init()}]),angular.module("paripal.appointmentModule").controller("trialPopupCtrl",["$scope","$mdDialog","$filter","baseService","orbeonFormRunner","httpService","urlService","utilService","notify","$translate","manageUserIssueService","imageData",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.searchCriteria={},a.diseaseVariantList=[],a.searchCriteria={},a.searchCriteria.icd10CodeDescription={},a.fillTreatmentRecordDetails=function(b){a.searchCriteria.disease=b.disease,a.searchCriteria.diseaseVariant=b.diseaseVariant},a.getDiseaseVariantDetails=function(){if(!h.isNullOrEmpty(a.recordDetails)&&!h.isNullOrEmpty(a.recordDetails.id)||!h.isNullOrEmpty(diseaseVariantObj)&&!h.isNullOrEmpty(diseaseVariantObj.appointmentId)){var b={};return h.isNullOrEmpty(a.recordDetails)||h.isNullOrEmpty(a.recordDetails.id)?b.appointmentId=diseaseVariantObj.appointmentId:b.appointmentId=a.recordDetails.id,f.getData(g.getParameterizedUrl("GET_DISEASE_VARIANT_DETAILS_FOR_APPT",b),null,function(b){h.isNullOrEmpty(b)||h.isNullOrEmpty(b.data)||h.isNullOrEmpty(b.data.disease)||h.isNullOrEmpty(b.data.diseaseVariant)||(a.searchCriteria.disease=b.data.disease,a.diseaseVariantList.push(b.data.diseaseVariant))},function(a){})}},a.cancel=function(){b.cancel()},a.getDisease=function(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,f.getData(g.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseList=angular.fromJson(b.data)},function(a){})},a.$watch("searchCriteria.disease",function(b){b&&a.getDiseaseVariant(b)}),a.getDiseaseVariant=function(b){var c={};return c.diseaseId=b.id,f.getData(g.getParameterizedUrl("GET_VARIANT_BY_DISEASE_ID",c),null,function(b){return a.diseaseVariantList=b.data},function(a){})},a.updateTreatmentRecord=function(){if(!h.isFieldEmpty(a.searchCriteria.disease)||!h.isFieldEmpty(a.searchCriteria.diseaseVariant)||!h.isFieldEmpty(a.recordDetails.id)){var c=angular.copy(a.searchCriteria);c.appointmentId=a.recordDetails.id,f.putData(g.getUrl("UPDATE_APPT_DISEASE_VARIANT"),c,function(c){i("success",j.instant("DISEASE_DETAILS_UPDATED_SUCCESSFULLY")),a.getdiseaseByAppointmentId(recordDetails.id,function(a){var c={};c.diseaseVariantList=a.data,c.recordDetails=recordDetails,b.cancel(c)},function(a){b.cancel()})},function(a){})}},a.getdiseaseByAppointmentId=function(a,b,c){var d={appointmentId:a};f.getData(g.getParameterizedUrl("GET_CURRENT_DISEASE_FOR_APPOINTMENT",d),null,function(a){b(a)},function(a){errorResponse(a)})},console.log(l),a.imgSrc=l}]),angular.module("paripal.appointmentModule").service("appointmentsListService",["httpService","urlService","dateconvertor","$filter","utilService","$state",function(a,b,c,d,e,f){"use strict";this.searchFixAppointment=function(d,f,g,h){var i={};e.isEmpty(d.entityType)||(i.entityType=d.entityType.code),d.entityName&&d.entityName.id?i.entityId=d.entityName.id:i.entityId=null,d.specificProfessional&&d.specificProfessional.id?i.specificProfessionalId=d.specificProfessional.id:i.specificProfessionalId=null,d.eventType&&d.eventType.id?i.eventTypeId=d.eventType.id:i.eventTypeId=null,d.eventName&&d.eventName.id?i.eventName=d.eventName:i.eventName=null,d.orgLocation&&d.orgLocation.id?i.orgLocationId=d.orgLocation.id:i.orgLocationId=null,d.serviceType&&d.serviceType.id?i.serviceType=d.serviceType.id:i.serviceType=null,d.apptStatus&&d.apptStatus.id?i.apptStatus=d.apptStatus.id:i.apptStatus=null,d.allocatedForwarded&&d.allocatedForwarded.id?i.allocatedForwardedId=d.allocatedForwarded.id:i.allocatedForwardedId=null,e.isNullOrEmpty(d.apptDate)?i.apptDate=null:i.apptDate=c.convertToServerDate(d.apptDate),e.isNullOrEmpty(d.apptStartTime)?i.apptStartTime=null:i.apptStartTime=d.apptStartTime.getHours()+":"+d.apptStartTime.getMinutes()+":00",e.isNullOrEmpty(d.apptEndTime)?i.apptEndTime=null:i.apptEndTime=d.apptEndTime.getHours()+":"+d.apptEndTime.getMinutes()+":00",e.isNullOrEmpty(d.forwardedAppt)?i.forwardedAppt=!1:i.forwardedAppt=d.forwardedAppt,e.isNullOrEmpty(d.walkInAppt)?i.walkInAppt=!1:i.walkInAppt=d.walkInAppt,e.isNullOrEmpty(d.followUpAppt)?i.followUpAppt=!1:i.followUpAppt=d.followUpAppt,i.pageNumber=d.pageNumber,i.recordsPerPage=d.recordsPerPage,d.sorters&&(i.sorters=d.sorters),e.isNullOrEmpty(d.patientUserId)||(i.patientUserId=d.patientUserId.id),a.postData(b.getUrl("SEARCH_APPOINTMENT_LIST"),i,function(a){g(a.data)},function(a){h(a)})},this.getRegisteredOnBehalfOfList=function(c,d,f){var g={};return g.searchKeyWord=c,e.isNullOrEmpty(d)||(g.organizationLocationId=d),a.getData(b.getParameterizedUrl("FIND_REGISTER_ON_BEHALF_BY_LOCATION_ID",g),null,function(a){if(a&&a.data)return a.data},function(a){},f)},this.manageConsultationStarted=function(c,d,e){if(c){var f={appointmentId:c};a.putData(b.getParameterizedUrl("CONSULTATION_STARTED",f),null,function(a){d(a.data)},function(a){e(a)})}},this.manageConsultationCompleted=function(c,d,e){if(c){var f={appointmentId:c};a.putData(b.getParameterizedUrl("CONSULTATION_FINISHED",f),null,function(a){d(a.data)},function(a){e(a)})}},this.manageIssueToken=function(c,d,e){if(c){var f={appointmentId:c};a.getData(b.getParameterizedUrl("GET_APPOINTMENT_ISSUE_TOKEN",f),null,function(a){d(a.data)},function(a){e(a)})}},this.goToUploadDownload=function(c){var d={};d.appointmentId=c.id,a.getData(b.getParameterizedUrl("GET_USER_DETAILS_BY_APPT_ID",d),null,function(a){a.data.appointmentId=c.id,a.data.organizationLocationId=c.organizationLocationId,a.type="edit",f.go("appointmentsuploadlist",a)})},this.getUploadDownloadListForAppointment=function(c,d){a.getData(b.getParameterizedUrl("GET_ATTACHEMENTS_FOR_APPOINTMENT_LIST",c),null,function(a){d(a.data)})},this.validateStartConsultation=function(c,e,f){var g={};g.appointmentId=c.id,g.eventName=c.event,g.apptDate=d("date")(c.apptDate,"yyyy-MM-dd"),a.putData(b.getUrl("VALIDATE_START_CONSULTATION"),g,function(a){e(a.data)},function(a){f(a)})},this.confirmStartConsultation=function(c,e,f){var g={};g.appointmentId=c.id,g.eventName=c.event,g.apptDate=d("date")(c.apptDate,"yyyy-MM-dd"),a.putData(b.getUrl("CONFIRM_START_CONSULTATION"),g,function(a){e(a.data)},function(a){f(a)})},this.getAccessRightsForProcess=function(c,d,e){var f={};f.eventId=c.eventId,f.userId=c.userId,a.getData(b.getParameterizedUrl("GET_ACCESS_RIGHTS_FOR_PROCESS",f),null,function(a){d(a)},function(a){e(a)})},this.getAppointmentById=function(c,d,e){if(c){var f={appointmentId:c};a.getData(b.getParameterizedUrl("GET_USER_DETAILS_BY_APPT_ID",f),null,function(a){d(a.data)},function(a){e(a)})}},this.getPrescriptionByAppId=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_PRESCRIPTION_BY_APPID",f),null,function(a){d(a)},function(a){e(a)})},this.getPrescriptionByTransactionId=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_PRESCRIPTION_BY_TRANSACTION_ID",f),null,function(a){d(a)},function(a){e(a)})},this.getPrescriptionByRequestFulId=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_PRESCRIPTION_BY_REQUEST_ID",f),null,function(a){d(a)},function(a){e(a)})},this.getCalendarByEntityId=function(c,d,e,f,g){var h={};h.entityId=d,h.entityTypeId=c,h.locationId=e,a.getData(b.getParameterizedUrl("GET_ACTIVE_CALENDAR_BY_ENTITY_ID",h),null,function(a){f(a.data)},function(a){g(a.data)})},this.getPrescriptionByTreatmentId=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_PRESCRIPTION_BY_TREATMENT_ID",f),null,function(a){d(a)},function(a){e(a)})},this.getSummaryById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_APPOINTMENT_SUMMARY_BY_ID",f),null,function(a){d(a)},function(a){e(a)})},this.getSummaryByApptId=function(c,d,e){var f={};f.apptId=c,a.getData(b.getParameterizedUrl("GET_APPOINTMENT_SUMMARY_BY_APPT_ID",f),null,function(a){d(a)},function(a){e(a)})},this.deleteIssueById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_ISSUE_RECORD",f),null,function(a){d(a)},function(a){e(a)})},this.deleteTreatmentById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_USER_TREATMENT",f),null,function(a){d(a)},function(a){e(a)})},this.saveAppointmentSummary=function(c,d,e){var f={};f.appointment={id:c.id},f.summary=c.summary,f.summaryText=c.summaryText,a.postData(b.getUrl("SAVE_APPOINTMENT_SUMMARY"),f,function(a){d(a)},function(a){e(a)})},this.updateAppointmentSummary=function(c,d,e){var f={};f.appointment={id:c.appointmentId},f.summary=c.summary,f.id=c.id,f.summaryText=c.summaryText,a.putData(b.getUrl("SAVE_APPOINTMENT_SUMMARY"),f,function(a){d(a)},function(a){e(a)})},this.getCurrentEvent=function(c,d,e){var f={};f.entityId=c.entityId,f.entityType=c.entityType,c.organizationLocationId&&(f.organizationLocationId=c.organizationLocationId),a.postData(b.getUrl("GET_CURRENT_EVENT"),f,function(a){d(a.data)},function(a){e(a)})},this.getAllergyListForAppointment=function(c,d,e){var f={};f.pageNumber=1,f.recordsPerPage=1e3,f.location={id:c.organizationLocationId},f.whetherSystemOrg=!1,f.orgId=null,f.patientUser={id:c.patientId},a.postData(b.getUrl("ALLERGY_LIST"),f,function(a){d(a.data)},function(a){e(a)})},this.createPrescriptionForMedication=function(c,d,e){a.postData(b.getUrl("SAVE_MEDICATION_APPT_PRESCRIPTION"),c,function(a){d(a.data)},function(a){e(a)})},this.createPharmacyOrder=function(c,d,e){a.postData(b.getParameterizedUrl("CREATE_PHARMACY_ORDER_BY_APPPID",c),null,function(a){d(a.data)},function(a){e(a)})},this.updateMedicationAppointmentDetails=function(c,d,e){a.postData(b.getUrl("UPDATE_MEDICATION_APP_DETAILS"),c,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.appointmentModule").service("appointmentsUploadDownloadService",["httpService","urlService","dateconvertor","$filter","utilService","$state",function(a,b,c,d,e,f){"use strict";this.getUsersByAppointmentOrRequestId=function(c,d){a.getData(b.getParameterizedUrl("GET_USERS_BY_APPT_ID_OR_REQUEST_ID",c),null,function(a){d(a.data)},function(){})},this.getUserDetailsByRequestId=function(c,d){a.getData(b.getParameterizedUrl("GET_USER_DETAILS_BY_REQUEST_ID",c),null,function(a){d(a.data)},function(){})}}]),angular.module("paripal.appointmentModule").service("cancelPostponeAppointmentListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchFixAppointment=function(d,f,g,h){var i={};d.entityType&&d.entityType.code&&(i.entityType=d.entityType.code),d.entityName&&d.entityName.id?i.entityId=d.entityName.id:i.entityId=null,d.specificProfessional&&d.specificProfessional.id?i.specificProfessionalId=d.specificProfessional.id:i.specificProfessionalId=null,d.eventType&&d.eventType.id?i.eventTypeId=d.eventType.id:i.eventTypeId=null,d.eventName&&d.eventName.id?i.eventName={value:d.eventName.value,id:d.eventName.id}:i.eventName=null,d.orgLocation&&d.orgLocation.id?i.orgLocationId=d.orgLocation.id:i.orgLocationId=null,d.serviceType&&d.serviceType.id?i.serviceType=d.serviceType.id:i.serviceType=null,d.apptStatus&&d.apptStatus.id?i.apptStatus=d.apptStatus.id:i.apptStatus=null,e.isNullOrEmpty(d.apptDate)?i.apptDate=null:i.apptDate=c.convertToServerDate(d.apptDate),e.isNullOrEmpty(d.apptStartTime)?i.apptStartTime=null:i.apptStartTime=d.apptStartTime.getHours()+":"+d.apptStartTime.getMinutes()+":00",e.isNullOrEmpty(d.apptEndTime)?i.apptEndTime=null:i.apptEndTime=d.apptEndTime.getHours()+":"+d.apptEndTime.getMinutes()+":00",i.pageNumber=d.pageNumber,i.recordsPerPage=d.recordsPerPage,d.sorters&&(i.sorters=d.sorters),a.postData(b.getUrl("SEARCH_CANCEL_POSTPONE_APPOINTMENT_LIST"),i,function(a){g(a.data)},function(a){h(a)})},this.cancelAppointment=function(c,d,e){c&&a.putData(b.getUrl("CANCEL_APPOINTMENT"),c,function(a){d(a.data)},function(a){errorCallBack(a)})},this.postponeAppointment=function(c,d,e){c&&a.putData(b.getUrl("POSTPONE_APPOINTMENT"),c,function(a){d(a.data)},function(a){errorCallBack(a)})},this.postponeBulkAppointment=function(c,d,e){c&&a.postData(b.getUrl("BULK_POSTPONE_APPOINTMENT"),c,function(a){d(a.data)},function(a){errorCallBack(a)})}}]),angular.module("paripal.appointmentModule").service("equipmentListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchEquipmentsMapping=function(c,d,f,g){var h={};e.isEmpty(c.equipment)||(h.equipmentId=c.equipment.id),e.isEmpty(c.user)||(h.userId=c.user.id),e.isEmpty(c.status)||(h.status=c.status.id),e.isNullOrEmpty(c.recordStatus)||(h.recordStatus=c.recordStatus),e.isNullOrEmpty(c.startDate)||(h.startDate=c.startDate),e.isNullOrEmpty(c.endDate)||(h.endDate=c.endDate),h.pageNumber=c.pageNumber,h.recordsPerPage=c.recordsPerPage,c.sorters&&(h.sorters=c.sorters),a.postDataWithHeader(b.getUrl("SEARCH_EQUIPMENT_MAPPING_LIST"),h,d,function(a){f(a.data)},function(a){g(a)})},this.inactiveEquipment=function(c,d,e,f){var g={id:c,recordStatus:d};a.putData(b.getParameterizedUrl("IN_ACTIVATE_EQUIPMENT_MAPPING",g),null,function(a){e(a.data)},function(a){f(a)})},this.activeEquipment=function(c,d,e,f){var g={id:c,recordStatus:d};a.putData(b.getParameterizedUrl("IN_ACTIVATE_EQUIPMENT_MAPPING",g),null,function(a){e(a.data)},function(a){f(a)})}}]),angular.module("paripal.appointmentModule").service("manageAppointmentScheduleService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.defineSchedule=function(d,e,f,g){var h={};if(d.eventName&&d.eventName.id&&(h.eventId=d.eventName.id),d.onBehalfOf&&d.onBehalfOf.id&&(h.patientId=d.onBehalfOf.id),d.onBehalfOf&&d.onBehalfOf.value&&(h.onBehalfOfName=d.onBehalfOf.value),h.appointmentId=null,h.fromDate=c.convertToServerDate(d.fromDate),h.tillDate=c.convertToServerDate(d.tillDate),d.frequency&&d.frequency.id&&(h.frequency=d.frequency.id),h.scheduleDetails=d.scheduleDetails,h.problemDescription=d.problemDescription,d.serviceType&&d.serviceType.id&&(h.serviceTypeId=d.serviceType.id),d.requestId&&(h.requestId=d.requestId),h.loggedInUserId=d.loggedInUserId,h.onBehalfOfCellPhone=d.onBehalfOfCellPhone,h.onBehalfOfAddress=d.onBehalfOfAddress,"add"===e)a.postData(b.getUrl("SAVE_DEFINE_SCHEDULE_BY_REQUEST"),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)});else{var i={};d&&d.id&&(i.id=d.id,a.putData(b.getParameterizedUrl("UPDATE_DEFINE_SCHEDULE_BY_REQUEST",i),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)}))}},this.getScheduleDetailsById=function(c,d,e){if(c){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_SCHEDULE_BY_SCHEDULE_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}},this.createWeeklyObject=function(a,b){var c=[];if(a.isMondayRepeat){var d={};d.date=null,d.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",d.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",d.day="MONDAY",c.push(d)}if(a.isTuesdayRepeat){var e={};e.date=null,e.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",e.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",e.day="TUESDAY",c.push(e)}if(a.isWednesdayRepeat){var f={};f.date=null,f.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",f.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",f.day="WEDNESDAY",c.push(f)}if(a.isThursdayRepeat){var g={};g.date=null,g.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",g.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",g.day="THURSDAY",c.push(g)}if(a.isFridayRepeat){var h={};h.date=null,h.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",h.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",h.day="FRIDAY",c.push(h)}if(a.isSaturdayRepeat){var i={};i.date=null,i.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",i.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",i.day="SATURDAY",c.push(i)}if(a.isSundayRepeat){var j={};j.date=null,j.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",j.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",j.day="SUNDAY",c.push(j)}b(c)},this.createDailyObject=function(a,b){var c={},e=[];c.date=null,d.isNullOrEmpty(a.eventStartTime)||d.isNullOrEmpty(a.eventEndTime)?(c.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",c.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00"):(c.startTime=a.eventStartTime.getHours()+":"+a.eventStartTime.getMinutes()+":00",c.endTime=a.eventEndTime.getHours()+":"+a.eventEndTime.getMinutes()+":00"),c.day=null,e.push(c),b(e)},this.createAdhocObject=function(a,b){var d=angular.copy(a);angular.forEach(d,function(a,b){d[b].date=c.convertToServerDate(a.date)}),b(d)},this.createDefinePerVisitObject=function(a,b){var c={},d=[];c.date=null,c.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",c.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",c.day=null,d.push(c),b(d)},this.editWeeklyObject=function(a,b){var c={},d=e("timestampToDate")(a.fromDate,"MM/dd/yyyy");angular.forEach(a.scheduleDetails,function(a,b){"MONDAY"==a.day&&(c.mondayStartTime=new Date(d+" "+a.startTime),c.mondayEndTime=new Date(d+" "+a.endTime),c.isMonday=!0),"TUESDAY"==a.day&&(c.tuesdayStartTime=new Date(d+" "+a.startTime),c.tuesdayEndTime=new Date(d+" "+a.endTime),c.isTuesday=!0),"WEDNESDAY"==a.day&&(c.wednesdayStartTime=new Date(d+" "+a.startTime),c.wednesdayEndTime=new Date(d+" "+a.endTime),c.isWednesday=!0),"THRUSDAY"==a.day&&(c.thrusdayStartTime=new Date(d+" "+a.startTime),c.thrusdayEndTime=new Date(d+" "+a.endTime),c.isThrusday=!0),"FRIDAY"==a.day&&(c.fridayStartTime=new Date(d+" "+a.startTime),c.fridayEndTime=new Date(d+" "+a.endTime),c.isFriday=!0),"SATURDAY"==a.day&&(c.saturdayStartTime=new Date(d+" "+a.startTime),c.saturdayEndTime=new Date(d+" "+a.endTime),c.isSaturday=!0),"SUNDAY"==a.day&&(c.sundayStartTime=new Date(d+" "+a.startTime),c.sundayEndTime=new Date(d+" "+a.endTime),c.isSunday=!0)}),b(c)}}]),angular.module("paripal.appointmentModule").service("manageCheckInOutAllotService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveCheckInOutAllotment=function(e,f,g,h,i,j){if("RECORDWALKIN"!==g){var k={};if(e.organizationLocationId&&(k.organizationLocationId=e.organizationLocationId),e.followUpDate&&(k.followUpDate=e.followUpDate),e.actionTaken&&(k.actionTaken=e.actionTaken),e.transactionId&&(k.transactionId=e.transactionId),e.checkInTime&&(k.checkInTime=e.checkInTime.getHours()+":"+e.checkInTime.getMinutes()+":00"),e.checkOutTime&&(k.checkOutTime=e.checkOutTime.getHours()+":"+e.checkOutTime.getMinutes()+":00"),e.patient&&e.patient.id){k.onBehalfOfId=e.patient.id,k.displayName=e.patient.value;var l=k.displayName.split(" ");l[0]&&(k.firstName=l[0]),l[1]&&(k.lastName=l[1])}e.patientPhoneNumber&&(k.cell1=e.patientPhoneNumber),d.isNullOrEmpty(e.patientAddress)||(k.onBehalfOfAddress=e.patientAddress),e.billPaid?k.whetherPaid=e.billPaid:k.whetherPaid=!1,e.isWalkIn?k.isWalkIn=e.isWalkIn:k.isWalkIn=!1,e.isFollowUp?k.isFollowUp=e.isFollowUp:k.isFollowUp=!1,e.isBillable?k.isBillable=e.isBillable:k.isBillable=!1,e.isForwarded?k.isForwarded=e.isForwarded:k.isForwarded=!1,e.isNewUHID?k.isNewUHID=e.isNewUHID:k.isNewUHID=!1,e.isFreeVisit?k.isFreeVisit=e.isFreeVisit:k.isFreeVisit=!1,e.tokenNumber&&(k.tokenNo=e.tokenNumber),e.tokenIssuedAt&&(k.tokenIssueAt=c.convertToServerDate(e.tokenIssuedAt)),e.tokenIssuedBy&&e.tokenIssuedBy.id&&(k.tokenIssuedById=e.tokenIssuedBy.id),e.allocatedBy&&e.allocatedBy.id&&(k.allocatedById=e.allocatedBy.id),e.allocatedTo&&e.allocatedTo.id&&(k.allocatedToId=e.allocatedTo.id),e.forwardedTo&&e.forwardedTo.id&&(k.forwardedToId=e.forwardedTo.id),e.forwardedBy&&e.forwardedBy.id&&(k.forwardedById=e.forwardedBy.id),e.allocatedOn&&(k.allocatedTime=e.allocatedOn),e.forwardedOn&&(k.forwardedTime=e.forwardedOn),e.clientId&&(k.clientId=e.clientId),e.wsTreatmentHistoryRelatedToAppointment&&(k.wsTreatmentHistoryRelatedToAppointment=e.wsTreatmentHistoryRelatedToAppointment),e.serviceType&&(k.serviceType=e.serviceType),/*if (appointmentObj.wetherUserExist) {
                    WSAppointment.wetherUserExist = appointmentObj.wetherUserExist;
                }*/
e.birthDate&&(k.birthDate=e.birthDate),e.age&&(k.age=e.age),e.hasGuardian?k.hasGuardian=e.hasGuardian:k.hasGuardian=!1,e.guardianId&&e.guardianName?(k.guardianId=e.guardianId,k.guardianName=e.guardianName):e.guardianName&&(k.guardianName=e.guardianName),e.wetherUserExist?k.whetherExistingUser=e.wetherUserExist:k.whetherExistingUser=!1,d.isNullOrEmpty(e.addressInfo)||(k.addressInfo=e.addressInfo),a.putData(b.getParameterizedUrl("UPDATE_CHECK_IN_OUT_DETAILS",{appointmentId:f}),k,function(a){h(a&&a.data?a.data:a)},function(a){i(a)})}else{var k={};if(k.appointmentId=null,e.eventName&&e.eventName.id&&(k.eventId=e.eventName.id),e.userName&&e.userName.id&&(k.userId=e.userName.id),d.isNullOrEmpty(e.apptDate)||(k.apptDate=c.convertToServerDate(e.apptDate)),e.checkInTime&&(k.apptStartTime=e.checkInTime.getHours()+":"+e.checkInTime.getMinutes()+":00"),e.checkInTime&&(k.checkInTIme=e.checkInTime.getHours()+":"+e.checkInTime.getMinutes()+":00"),e.checkOutTime&&(k.apptEndTime=e.checkOutTime.getHours()+":"+e.checkOutTime.getMinutes()+":00"),e.patient&&e.patient.id){k.onBehalfOfId=e.patient.id,k.onBehalfOfName=e.patient.value,k.displayName=e.patient.value;var l=k.displayName.split(" ");l[0]&&(k.firstName=l[0]),l[1]&&(k.lastName=l[1])}else if(j){k.onBehalfOfId=null,k.onBehalfOfName=j,k.displayName=j;var l=j.split(" ");l[0]&&(k.firstName=l[0]),l[1]&&(k.lastName=l[1])}d.isNullOrEmpty(e.patientPhoneNumber)||(k.onBehalfOfCellPhone=e.patientPhoneNumber),d.isNullOrEmpty(e.patientAddress)||(k.onBehalfOfAddress=e.patientAddress),e.serviceType&&e.serviceType.id&&(k.serviceType=e.serviceType),d.isNullOrEmpty(e.problemDescription)||(k.problemDescription=e.problemDescription),d.isNullOrEmpty(e.orgLocId)||(k.orgLocId=e.orgLocId),e.billPaid?k.whetherPaid=e.billPaid:k.whetherPaid=!1,e.isWalkIn?k.isWalkIn=e.isWalkIn:k.isWalkIn=!1,e.isFollowUp?k.isFollowUp=e.isFollowUp:k.isFollowUp=!1,e.isBillable?k.isBillable=e.isBillable:k.isBillable=!1,e.isForwarded?k.isForwarded=e.isForwarded:k.isForwarded=!1,e.isNewUHID?k.isNewUHID=e.isNewUHID:k.isNewUHID=!1,e.isFreeVisit?k.isFreeVisit=e.isFreeVisit:k.isFreeVisit=!1,k.isRecurring=!1,k.billRaised=!1,k.allotOn=null,k.followUpDate=null,k.nextAppt=null,k.slotId=null,k.scheduleId=null,e.birthDate&&(k.birthDate=e.birthDate),e.age&&(k.age=e.age),e.hasGuardian?k.hasGuardian=e.hasGuardian:k.hasGuardian=!1,e.guardianId&&e.guardianName?(k.guardianId=e.guardianId,k.guardianName=e.guardianName):e.guardianName&&(k.guardianName=e.guardianName),e.wetherUserExist?k.whetherExistingUser=e.wetherUserExist:k.whetherExistingUser=!1,d.isNullOrEmpty(e.addressInfo)||(k.addressInfo=e.addressInfo),
//added for other request requestId
e.requestId&&(k.requestId=e.requestId),"CAL_ORGANIZATION_USER"==e.entityType.code&&e.entityName&&(k.lastProfessional=e.entityName),a.postData(b.getUrl("SAVE_RECORD_WALK_IN"),k,function(a){h(a&&a.data?a.data:a)},function(a){i(a)})}},this.getCheckInOutAllotment=function(c,d){var e={};e.appointmentId=c,a.getData(b.getParameterizedUrl("GET_CHECK_IN_OUT_DETAILS",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.getClientDetails=function(c,d){if(c){var e={};e.clientId=c,a.getData(b.getParameterizedUrl("GET_APPOINTMENT_CLIENT_DETAILS",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}},this.setIsBilledOfAppointment=function(c,d){if(c){var e={};e.appointmentId=c,a.putData(b.getParameterizedUrl("SET_IS_BILLED_FOR_APPOINTMENT",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}}}]),angular.module("paripal.appointmentModule").service("manageEquipmentService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveEquipmentMappingToProfessional=function(e,f,g,h){var i={};//angular.copy(equipmentMappingObj);
d.isEmpty(e.equipment)||(i.equipmentId=e.equipment.id),d.isEmpty(e.orgLocation)||(i.orgLocationId=e.orgLocation.id),d.isEmpty(e.user)||(i.userId=e.user.id),d.isNullOrEmpty(e.dateMapped)||(i.dateMapped=c.convertToServerDate(e.dateMapped)),d.isNullOrEmpty(e.recordStatus)||(i.recordStatus=e.recordStatus),"add"===f&&a.postData(b.getUrl("CREATE_EQUIPMENT_MAPPING"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)})},this.getEquipmentDescription=function(c,d){var e={};e.equipmentId=c,a.getData(b.getParameterizedUrl("FIND_EQUIPMENT_DESC_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}}]),angular.module("paripal.appointmentModule").service("manageFixAppointmentService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.saveFixAppointment=function(e,f,g,h){var i={};//angular.copy(appointmentObj);
d.isNullOrEmpty(e.id)?i.appointmentId="":i.appointmentId=e.id,d.isNullOrEmpty(e.eventId)||(i.eventId=e.eventId),d.isNullOrEmpty(e.apptDate)||(i.apptDate=c.convertToServerDate(e.apptDate),i.allotOn=c.convertToServerDate(e.apptDate),i.followUpDate=c.convertToServerDate(e.apptDate),i.nextAppt=c.convertToServerDate(e.apptDate)),d.isNullOrEmpty(e.startTime)||(i.apptStartTime=e.startTime.getHours()+":"+e.startTime.getMinutes()+":"+e.startTime.getSeconds()),d.isNullOrEmpty(e.endTime)||(i.apptEndTime=e.endTime.getHours()+":"+e.endTime.getMinutes()+":"+e.endTime.getSeconds()),d.isEmpty(e.specificDoctor)||(i.specificDoctorId=e.specificDoctor.id),d.isEmpty(e.userName)||(i.userId=e.userName.id),e.onBehalfOf&&e.onBehalfOf.id?(i.onBehalfOfId=e.onBehalfOf.id,i.onBehalfOfName=e.onBehalfOf.value.split("-")[0].trim()):d.isNullOrEmpty(e.onBehalfOf)||d.isNullOrEmpty(e.onBehalfOf.value)?i.onBehalfOfName=e.onBehalfOf:i.onBehalfOfName=e.onBehalfOf.value.split("-")[0].trim(),d.isNullOrEmpty(e.onBehalfOfCellPhone)||(i.onBehalfOfCellPhone=e.onBehalfOfCellPhone),d.isNullOrEmpty(e.onBehalfOfAddress)||(i.onBehalfOfAddress=e.onBehalfOfAddress),d.isEmpty(e.serviceType)||(i.serviceType=e.serviceType),d.isNullOrEmpty(e.isRecurring)?i.isRecurring=!1:i.isRecurring=e.isRecurring,d.isNullOrEmpty(e.isNewUHID)?i.isNewUHID=!1:i.isNewUHID=e.isNewUHID,d.isNullOrEmpty(e.isFollowUp)?i.isFollowUp=!1:i.isFollowUp=e.isFollowUp,d.isNullOrEmpty(e.isFreeVisit)?(i.isFreeVisit=!1,i.isBillable=!0):(i.isFreeVisit=e.isFreeVisit,i.isBillable=!e.isFreeVisit),d.isNullOrEmpty(e.problemDescription)||(i.problemDescription=e.problemDescription),d.isNullOrEmpty(e.lastProfessional)||(i.allocatedTo=e.lastProfessional,i.lastProfessionalId=e.lastProfessional.id),d.isNullOrEmpty(e.addressInfo)||(i.addressInfo=e.addressInfo),i.isWalkIn=!1,//appointmentObj.isWalkIn;
i.slotId=e.slotId,i.orgLocId=e.orgLocId,i.billRaised=!0,//appointmentObj.billRaised;
i.billPaid=!1,//appointmentObj.billPaid;
a.postData(b.getUrl("SAVE_FIX_APPOINTMENT"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)})},this.getAppointmentDetailsById=function(c,d,e){if(c){var f={};f.appointmentId=c,a.getData(b.getParameterizedUrl("GET_APPOINTMENT_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}},this.getSlotBasedListOnDateByEventId=function(d,e,f,g){if(d&&e){var h={};h.slotDate=c.convertToServerDate(d),h.eventId=e,a.getData(b.getParameterizedUrl("GET_SLOT_BASED_LIST_BY_EVENT_ID",h),null,function(a){a&&a.data&&f(a.data)},function(a){g(a)})}},this.getOnBehalfAddressDetails=function(c,d,e){var f={};f.userId=c,d&&null!=d&&(f.eventId=d),a.getData(b.getParameterizedUrl("GET_APPOINTMENT_USER_DETAILS",f),null,function(a){a&&a.data&&e(a.data)},function(a){errorCallback(a)})},this.getEarlierAppointmentDetails=function(c,d){var e={};e.onBehalfOfId=c,a.getData(b.getParameterizedUrl("GET_EARLIER_APPOINTMENT_USER_DETAILS",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.getFreeVisitDetails=function(c,d,e,f,g){var h={};h.calendarEventId=c,h.serviceId=d,h.onBehalfOfId=e,a.getData(b.getParameterizedUrl("IS_FREE_VISIT_APPLICABLE",h),null,function(a){a&&f(a)},function(a){g(a)})},this.getAvailableEntityTypes=function(c,d,e,f){var g={};g.locationId=c,g.userId=d,a.getData(b.getParameterizedUrl("GET_AVAILABLE_ENTITY_TYPES",g),null,function(a){a&&e(a)},function(a){f(a)})},this.createWeeklyObject=function(a,b){var c=[];if(a.isMonday){var d={};d.date=null,d.startTime=a.mondayStartTime.getHours()+":"+a.mondayStartTime.getMinutes()+":00",d.endTime=a.mondayEndTime.getHours()+":"+a.mondayEndTime.getMinutes()+":00",d.day="MONDAY",c.push(d)}if(a.isTuesday){var e={};e.date=null,e.startTime=a.tuesdayStartTime.getHours()+":"+a.tuesdayStartTime.getMinutes()+":00",e.endTime=a.tuesdayEndTime.getHours()+":"+a.tuesdayEndTime.getMinutes()+":00",e.day="TUESDAY",c.push(e)}if(a.isWednesday){var f={};f.date=null,f.startTime=a.wednesdayStartTime.getHours()+":"+a.wednesdayStartTime.getMinutes()+":00",f.endTime=a.wednesdayEndTime.getHours()+":"+a.wednesdayEndTime.getMinutes()+":00",f.day="WEDNESDAY",c.push(f)}if(a.isThrusday){var g={};g.date=null,g.startTime=a.thrusdayStartTime.getHours()+":"+a.thrusdayStartTime.getMinutes()+":00",g.endTime=a.thrusdayEndTime.getHours()+":"+a.thrusdayEndTime.getMinutes()+":00",g.day="THRUSDAY",c.push(g)}if(a.isFriday){var h={};h.date=null,h.startTime=a.fridayStartTime.getHours()+":"+a.fridayStartTime.getMinutes()+":00",h.endTime=a.fridayEndTime.getHours()+":"+a.fridayEndTime.getMinutes()+":00",h.day="FRIDAY",c.push(h)}if(a.isSaturday){var i={};i.date=null,i.startTime=a.saturdayStartTime.getHours()+":"+a.saturdayStartTime.getMinutes()+":00",i.endTime=a.saturdayEndTime.getHours()+":"+a.saturdayEndTime.getMinutes()+":00",i.day="SATURDAY",c.push(i)}if(a.isSunday){var j={};j.date=null,j.startTime=a.sundayStartTime.getHours()+":"+a.sundayStartTime.getMinutes()+":00",j.endTime=a.sundayEndTime.getHours()+":"+a.sundayEndTime.getMinutes()+":00",j.day="SUNDAY",c.push(j)}b(c)},this.createDailyObject=function(a,b){var c={},d=[];c.date=null,c.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",c.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",c.day=null,d.push(c),b(d)},this.createAdhocObject=function(a,b){var d=angular.copy(a);angular.forEach(d,function(a,b){d[b].date=c.convertToServerDate(a.date)}),b(d)},this.createDefinePerVisitObject=function(a,b){var c={},d=[];c.date=null,c.startTime=a.startTime.getHours()+":"+a.startTime.getMinutes()+":00",c.endTime=a.endTime.getHours()+":"+a.endTime.getMinutes()+":00",c.day=null,d.push(c),b(d)},this.defineSchedule=function(d,e,f){var g={};g.eventId=d.eventId,g.patientId=d.onBehalfOfId,g.appointmentId=d.appointmentId,g.fromDate=c.convertToServerDate(d.fromDate),g.tillDate=c.convertToServerDate(d.tillDate),g.frequency=d.frequency.id,g.scheduleDetails=d.scheduleDetails,a.postData(b.getUrl("SAVE_SCHEDULE_APPOINTMENT"),g,function(a){e(a&&a.data?a.data:a)},function(a){f(a)})},this.editWeeklyObject=function(a,b){var c={},d=e("timestampToDate")(a.fromDate,"MM/dd/yyyy");angular.forEach(a.scheduleDetails,function(a,b){"MONDAY"==a.day&&(c.mondayStartTime=new Date(d+" "+a.startTime),c.mondayEndTime=new Date(d+" "+a.endTime),c.isMonday=!0),"TUESDAY"==a.day&&(c.tuesdayStartTime=new Date(d+" "+a.startTime),c.tuesdayEndTime=new Date(d+" "+a.endTime),c.isTuesday=!0),"WEDNESDAY"==a.day&&(c.wednesdayStartTime=new Date(d+" "+a.startTime),c.wednesdayEndTime=new Date(d+" "+a.endTime),c.isWednesday=!0),"THRUSDAY"==a.day&&(c.thrusdayStartTime=new Date(d+" "+a.startTime),c.thrusdayEndTime=new Date(d+" "+a.endTime),c.isThrusday=!0),"FRIDAY"==a.day&&(c.fridayStartTime=new Date(d+" "+a.startTime),c.fridayEndTime=new Date(d+" "+a.endTime),c.isFriday=!0),"SATURDAY"==a.day&&(c.saturdayStartTime=new Date(d+" "+a.startTime),c.saturdayEndTime=new Date(d+" "+a.endTime),c.isSaturday=!0),"SUNDAY"==a.day&&(c.sundayStartTime=new Date(d+" "+a.startTime),c.sundayEndTime=new Date(d+" "+a.endTime),c.isSunday=!0)}),b(c)}}]),angular.module("paripal.appointmentModule").service("manageProcessAssocationService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveEquipmentMappingToProfessional=function(e,f,g,h){var i={};//angular.copy(processAssociationObj);
d.isNullOrEmpty(e.id)||(i.id=e.id),d.isNullOrEmpty(e.version)||(i.version=e.version),d.isEmpty(e.process)||(i.processId=e.process.id),d.isEmpty(e.orgLocation)||(i.orgLocationId=e.orgLocation.id),d.isEmpty(e.user)||(i.userId=e.user.id),d.isNullOrEmpty(e.recordStatus)||(i.recordStatus=e.recordStatus),d.isNullOrEmpty(e.dateMapped)||(i.dateMapped=c.convertToServerDate(e.dateMapped)),d.isNullOrEmpty(e.canAllot)?i.canAllot=!1:i.canAllot=e.canAllot,d.isNullOrEmpty(e.canExaminePatient)?i.canExaminePatient=!1:i.canExaminePatient=e.canExaminePatient,d.isNullOrEmpty(e.canIssueToken)?i.canIssueToken=!1:i.canIssueToken=e.canIssueToken,d.isNullOrEmpty(e.canForwardForOpinion)?i.canForwardForOpinion=!1:i.canForwardForOpinion=e.canForwardForOpinion,d.isNullOrEmpty(e.canPrepareSummary)?i.canPrepareSummary=!1:i.canPrepareSummary=e.canPrepareSummary,"add"===f?a.postData(b.getUrl("CREATE_PROCESS_PROFESSIONAL"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)}):"edit"===f&&a.putData(b.getUrl("UPDATE_PROCESS_PROFESSIONAL"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)})},this.getProcessAssociationDetails=function(c,d){var e={};e.id=c,a.getData(b.getParameterizedUrl("GET_PROCESS_ASSOCIATION_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}}]),angular.module("paripal.appointmentModule").service("patientActivityListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchPatientCheckInToOutDetails=function(d,f,g,h){var i={};d.eventName&&d.eventName.id?i.eventId=d.eventName.id:i.eventId=null,d.processName&&d.processName.id?i.processId=d.processName.id:i.processId=null,d.userName&&d.userName.id?i.userId=d.userName.id:i.userId=null,d.serviceType&&d.serviceType.id?i.serviceType=d.serviceType.id:i.serviceType=null,d.specificProfessional&&d.specificProfessional.id?i.professionalId=d.specificProfessional.id:i.professionalId=null,e.isNullOrEmpty(d.apptDate)?i.apptDate=null:i.apptDate=c.convertToServerDate(d.apptDate),e.isNullOrEmpty(d.checkInTime)?i.checkInTime=null:i.checkInTime=d.checkInTime.getHours()+":"+d.checkInTime.getMinutes()+":00",e.isNullOrEmpty(d.checkOutTime)?i.checkOutTime=null:i.checkOutTime=d.checkOutTime.getHours()+":"+d.checkOutTime.getMinutes()+":00",d.patientContactNumber?i.patientContactNumber=d.patientContactNumber:i.patientContactNumber=null,d.token?i.token=d.token:i.token=null,d.patient?i.patientId=d.patient.id:i.patientId=null,i.pageNumber=d.pageNumber,i.recordsPerPage=d.recordsPerPage,d.sorters&&(i.sorters=d.sorters),a.postData(b.getUrl("SEARCH_PATIENT_ACTIVITY_LIST"),i,function(a){g(a.data)},function(a){h(a)})}}]),angular.module("paripal.appointmentModule").service("processAssociationListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchProcessAssociation=function(c,d,f,g){var h={};e.isEmpty(c.process)||(h.processId=c.process.id),e.isEmpty(c.user)||(h.userId=c.user.id),e.isEmpty(c.orgLocation)||(h.organizationLocationIds=[],h.organizationLocationIds.push(c.orgLocation.id)),e.isNullOrEmpty(c.recordStatus)||(h.recordStatus=c.recordStatus),h.pageNumber=c.pageNumber,h.recordsPerPage=c.recordsPerPage,c.sorters&&(h.sorters=c.sorters),a.postDataWithHeader(b.getUrl("SEARCH_PROCESS_PROFESSIONAL_LIST"),h,d,function(a){f(a.data)},function(a){g(a)})},this.activeInActivateProcessAssociation=function(c,d,e,f){var g={id:c,recordStatus:d};a.putData(b.getParameterizedUrl("IN_ACTIVATE_PROCESS_PROFESSIONAL",g),null,function(a){e(a.data)},function(a){f(a)})}}]),angular.module("paripal.appointmentModule").service("userAppointmentStatusService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveDoctorStatus=function(c,d,e,f){var g={};c.doctorIsIn?g.doctorIn=c.doctorIsIn:g.doctorIn=!1,c.doctorExpectedTime?g.doctorExpectedTime=c.doctorExpectedTime.getHours()+":"+c.doctorExpectedTime.getMinutes()+":00":g.doctorExpectedTime=null,c.eventId?g.eventId=c.eventId:g.eventId=1,a.putData(b.getUrl("UPDATE_DOCTOR_APPOINTMENT_STATUS"),g,function(a){e(a&&a.data?a.data:a)},function(a){f(a)})},this.getUserAppointmentStatus=function(c,d){var e={};e.appointmentId=c,a.getData(b.getParameterizedUrl("GET_USER_APPOINTMENT_STATUS_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.getUserAppointmentStatusByEventId=function(c,d,e){var f={};f.id=c,f.date=d,a.getData(b.getParameterizedUrl("GET_USER_APPOINTMENT_STATUS_BY_EVENT_ID",f),null,function(a){a&&a.data&&e(a.data)},function(a){})}}]),angular.module("paripal.articlesModule").controller("ArticleListCtrl",["$scope","$rootScope","ArticlesService","commonConstants","datatableconfig","serverSidePagination","$mdDialog","utilService","notify","$stateParams","$state","userStatusService","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){a.closeDialog=function(){b.hide()},a.cancel=function(){b.cancel()}}n.$inject=["$scope","$mdDialog"],a.commonConstants=d,/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=d.defaultPageNo,a.itemPerPage=d.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterCriteria={};var o=function(){h.isFieldEmpty(j.userData)?k.go("home.view"):(a.user=j.userData,a.filterCriteria.userId=a.user.id,l.isUserLoggedIn()&&(a.loggedInUserId=l.userData().userId),a.searchData())};a.searchData=function(){b.showSpinner=!0,a.filterCriteria.pageNumber=a.currentPage,a.filterCriteria.recordsPerPage=a.itemPerPage,c.findArticleByCriteria(a.filterCriteria,function(c){b.showSpinner=!1,a.articles=c.data,a.totalItems=c.totalRecords,a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems)})},a.manageArticle=function(b,c,e){h.isNullOrEmpty(a.managePageType)&&h.isNullOrEmpty(a.WSArticle)&&(a.managePageType=e,a.WSArticle=new Object),angular.copy(c,a.WSArticle),h.isFieldEmpty(c)||(delete a.WSArticle.createdDate,delete a.WSArticle.lastUpdatedDate,delete a.WSArticle.organizationLocationId),g.show({clickOutsideToClose:d.dialogBox.clickOutsideToClose,scope:a,preserveScope:!0,templateUrl:"app/modules/article/views/manage-article.html",controller:n})},$("#data-table").on("click",".editCls",function(){a.managePageType=$(this).attr("pageType").valueOf();var b=$(this).attr("data").valueOf();a.WSArticle=new Object,a.WSArticle=JSON.parse(b),h.isNullOrEmpty(a.managePageType)||h.isNullOrEmpty(a.WSArticle)||a.manageArticle()}),$("#data-table").on("click",".deleteCls",function(){var b=$(this).attr("data").valueOf(),c=new Object;if(c=JSON.parse(b),!h.isNullOrEmpty(c)){var d=g.confirm().title(m.instant("COMMON_CONFIRMATION_BOX_TITLE")).textContent(m.instant("REMOVE_CONFIRM_MESSAGE")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));g.show(d).then(function(){a.deleteArticle(c)},function(){})}}),a.createArticle=function(){c.createArticle(a.WSArticle,function(b){i("success",b.successMessage),a.closeDialog(),a.searchData()})},a.deleteArticle=function(b){c.deleteArticle(b,function(b){i("success",b.successMessage),a.searchData()})},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},o();/* Data table configurations */
var p=d.gridConfigurations;a.options=e.setOptionProperties(p)}]),angular.module("paripal.articlesModule").service("ArticlesService",["utilService","httpService","urlService","notify",function(a,b,c,d){this.findArticleByCriteria=function(a,d){b.postData(c.getUrl("FIND_ARTICLE_BY_CRITERIA"),a,function(a){d(a.data)})},this.createArticle=function(d,e){a.isFieldEmpty(d.id)?b.postData(c.getUrl("CREATE_ARTICLE"),d,function(a){e(a.data)},function(){}):b.putData(c.getUrl("UPDATE_ARTICLE"),d,function(a){e(a.data)},function(){})},this.deleteArticle=function(a,d){b.deleteData(c.getParameterizedUrl("DELETE_ARTICLE",a),null,function(a){d(a.data)},function(){})}}]),angular.module("paripal.auditReportModule").controller("LoginHistoryListCtrl",["$scope","$rootScope","datatableconfig","utilService","httpService","urlService","commonConstants","serverSidePagination","featurePrivilegeConstants","apiCodeTranslationService","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.currentPage=g.defaultPageNo,a.itemPerPage=g.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterObject={};var l=function(){a.loadLoginHistory()};j.loadapicodetranslationdata(),a.loadLoginHistory=function(){var b={};angular.copy(a.filterObject,b),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b=j.formatCriteriaObject(b),a.spinner=!0,e.postData(f.getUrl("LOGIN_HISTORY_BY_CRITERIA"),b,function(b){a.spinner=!1,a.listItems=b.data.data,a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.spinner=!1})},a.getAccessibleUsers=function(a){var b={orgLocPermission:i.LOGIN_HISTORY_VIEW},c={searchString:a};return e.getData(f.getQueryParameterizedUrl("FIND_ALL_ACTIVE_USER",c),null,function(a){return angular.fromJson(a.data)},function(a){},b)},a.clear=function(){a.filterObject={},k.reload(),a.loadLoginHistory()},a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.loadLoginHistory()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.loadLoginHistory()};var m=g.gridConfigurations;a.options=c.setOptionProperties(m),l()}]),angular.module("paripal.auditReportModule").controller("SecuredApiUsageListCtrl",["$scope","$rootScope","datatableconfig","utilService","httpService","urlService","commonConstants","serverSidePagination","featurePrivilegeConstants","apiCodeTranslationService","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.currentPage=g.defaultPageNo,a.itemPerPage=g.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterObject={};var l=function(){a.loadHistory()};j.loadapicodetranslationdata(),a.loadApiCodeTranslations=function(a){return j.getApiCodeTranslations(a)},a.loadHistory=function(){var b={};angular.copy(a.filterObject,b),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b=j.formatCriteriaObject(b),a.spinner=!0,e.postData(f.getUrl("SECUREDAPI_USAGE_BY_CRITERIA"),b,function(b){a.spinner=!1,a.listItems=b.data.data,a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.spinner=!1})},a.getAccessibleUsers=function(a){var b={orgLocPermission:i.SECURED_API_USAGE_VIEW},c={searchString:a};return e.getData(f.getQueryParameterizedUrl("FIND_ASSIGNED_BY_LOCATION_ID",c),null,function(a){return angular.fromJson(a.data)},function(a){},b)},a.clear=function(){a.filterObject={},k.reload()},a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.loadHistory()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.loadHistory()};var m=g.gridConfigurations;a.options=c.setOptionProperties(m),l()}]),angular.module("paripal.auditReportModule").controller("SystemUsageListCtrl",["$scope","$rootScope","datatableconfig","utilService","httpService","urlService","commonConstants","serverSidePagination","apiCodeTranslationService","$state",function(a,b,c,d,e,f,g,h,i,j){a.currentPage=g.defaultPageNo,a.itemPerPage=g.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.chartList=[],a.filterObject={};var k=function(){a.loadUsageList()};i.loadapicodetranslationdata(),a.loadApiCodeTranslations=function(a){return i.getApiCodeTranslations(a)},a.user={queryUrl:"GET_PATIENTS_USER_BY_SEACRH_KEY"},a.loadUsageList=function(){var b={};angular.copy(a.filterObject,b),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b=i.formatCriteriaObject(b),a.spinner=!0,e.postData(f.getUrl("SYSTEM_USAGE_BY_CRITERIA"),b,function(b){a.spinner=!1,a.listItems=b.data.data,a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.spinner=!1})},a.clear=function(){a.filterObject={},j.reload()},a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.loadUsageList()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.loadUsageList()};var l=g.gridConfigurations;a.options=c.setOptionProperties(l),k()}]),angular.module("paripal.auditReportModule").controller("UserUsageListCtrl",["$scope","$rootScope","datatableconfig","$mdDialog","utilService","httpService","urlService","commonConstants","serverSidePagination","featurePrivilegeConstants","apiCodeTranslationService","$state",function(a,b,c,d,e,f,g,h,i,j,k,l){a.currentPage=h.defaultPageNo,a.itemPerPage=h.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.chartList=[],a.filterObject={};var m=function(){a.loadUsageList()};k.loadapicodetranslationdata(),a.loadApiCodeTranslations=function(a){return k.getApiCodeTranslations(a)},a.loadUsageList=function(){var b={};angular.copy(a.filterObject,b),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b=k.formatCriteriaObject(b),a.spinner=!0,f.postData(g.getUrl("USER_USAGE_BY_CRITERIA"),b,function(b){a.spinner=!1,a.listItems=b.data.data,a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.spinner=!1})},a.getAccessibleUsers=function(a){var b={orgLocPermission:j.USER_USAGE_VIEW},c={searchString:a};return f.getData(g.getQueryParameterizedUrl("FIND_ASSIGNED_BY_LOCATION_ID",c),null,function(a){return angular.fromJson(a.data)},function(a){},b)},a.clear=function(){a.filterObject={},l.reload()},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.loadUsageList()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.loadUsageList()};var n=h.gridConfigurations;a.options=c.setOptionProperties(n),m()}]),angular.module("paripal.auditReportModule").service("apiCodeTranslationService",["httpService","$rootScope","dateconvertor","urlService","utilService",function(a,b,c,d,e){"use strict";b.apicodetranslationdata={},this.loadapicodetranslationdata=function(){a.getJsonData(d.getJsonFileUrl("apiCodeJson",null),function(a){a&&a.data&&(b.apicodetranslationdata=a.data)},function(a){})},this.getApiCodeTranslations=function(a){var c=[];return b.apicodetranslationdata&&angular.forEach(b.apicodetranslationdata,function(b,d){b.indexOf(a)>-1&&c.push({key:d,value:b})}),c},this.formatCriteriaObject=function(a){return a.fromDate&&(a.fromDate=c.convertToServerDate(a.fromDate)),a.toDate&&(a.toDate=c.convertToServerDate(a.toDate)),e.isFieldEmpty(a.user)||(a.userId=a.user.id),delete a.user,e.isFieldEmpty(a.apiCodeObj)||(a.apiCode=a.apiCodeObj.key),delete a.apiCodeObj,a}}]),/**
 * Creating Log In controller  for validate user and log in to system
 *
 */
angular.module("paripal.autheticationModule").controller("AuthenticationCtrl",["$scope","$auth","$state","$stateParams","$translate","urlService","baseService","utilService","httpService","menuGenerationService","authenticationService","notify","$rootScope","$cookieStore","$cookies","storageService","$mdDialog","$mdSelect","notificationMessagingService","$filter","$injector","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){function w(a){FCMPlugin.getToken(function(b){
//alert('get token: ' + token);
var c={};c.user=a,c.deviceToken=b,c.deviceType=device.platform,c.deviceId=device.uuid,i.postData(f.getUrl("SAVE_NOTIFICATION_TOKEN"),c,function(){},function(){})})}a.disableEmailCell=!1,a.disableDocType=!1,a.disableDocRef=!0,a.error=!1,a.errorEmailCell=!1,a.errorDocType=!1,a.errorDocRef=!1,a.passwordMatched=!1,a.passwordNotMatched=!1,a.user={forgotid:{},login:{idEmailCellIdentity:"",password:""}},a.documentTypeList={},localStorage.removeItem("defaultOrg"),localStorage.removeItem("defaultOrgLoc"),localStorage.removeItem("locationCategory"),localStorage.removeItem("whetherLocationIsLab"),localStorage.client&&localStorage.removeItem("client"),localStorage.location&&localStorage.removeItem("location"),d.username&&(a.user.login.idEmailCellIdentity=d.username),m.isLoggedIn&&m.loggedInUserDetails.isOrganizationUser&&i.getData(f.getUrl("FIND_ORG_DETAILS_BY_USER"),null,function(a){m.defaultOrgLoc=a.data.orgLocation.value,m.locationCategory=a.data.orgLctnCategoryId2,m.whetherLocationIsLab=a.data.whetherLab,localStorage.setItem("defaultOrg",angular.toJson(a.data.organization)),localStorage.setItem("defaultOrgLoc",angular.toJson(a.data.orgLocation)),localStorage.setItem("locationCategory",angular.toJson(a.data.orgLctnCategoryId2)),localStorage.setItem("whetherLocationIsLab",angular.toJson(a.data.whetherLab))},function(a){}),/***************************** Guardian Of Functionality ********************************************/
a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")},a.goToLinkedAccount=function(c){var d=localStorage.getItem("paripal_token"),e=(m.loggedInUserDetails.id,c.userId),h="INDIVIDUAL"==c.accountType?"guardian":"company",j={linkedUserId:e,token:d,type:h};i.getData(f.getParameterizedUrl("GO_TO_LINKED_ACCOUNT",j),null,function(c){a.linkedAccountResult=angular.fromJson(c.data),
//  $scope.logout(false);
m.isLoggedIn=!1,m.loggedInUserDetails=null,/*$rootScope.userDateFormat = null;
                  localStorage.removeItem('userDateFormat');*/
g.setDefaultUserDateFormat(),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userMode"),localStorage.removeItem("loggedInUser"),localStorage.removeItem("paripal_token"),localStorage.removeItem("individualUserMenu"),localStorage.removeItem("organizationUserMenu"),localStorage.removeItem("requesterInfo"),localStorage.removeItem("isOrgUserMode"),localStorage.removeItem("emergencyAutomateUser"),n.remove("token"),b.setToken(a.linkedAccountResult.access_token),a.loginProcess(a.linkedAccountResult)},function(a){})},a.loginProcess=function(e){b.setToken(e.access_token),
// to be used for orbeon forms
n.put("token",e.access_token),o.put("token",e.access_token,{path:"/"}),m.isLoggedIn=!0,localStorage.setItem("isLoggedIn",!0),k.getUserDetails(a.user.login,function(b){if(m.showSpinner=!1,!h.isEmpty(b)){p.setPrivileges(b),g.setLoggedInUser(b),delete b.individualFeaturePrivileges,delete b.locationConsolidatedPrivileges,delete b.locationFeaturePrivileges,m.loggedInUserDetails=b,m.userDateFormat=b.userDateFormat,localStorage.setItem("userDateFormat",m.userDateFormat),a.user.login={},a.selectLanguage(),h.isNullOrEmpty(b.redirectPage)||(h.isFieldEmpty(d.callbackState)||h.isFieldEmpty(d.callbackUrl)?"FIRST_LOGIN"===b.redirectPage?(m.whetherFirstLogin=!0,c.go("newUserSignIn")):"RESET_PASSWORD_PAGE"===b.redirectPage?(m.whetherFirstLogin=!1,c.go("resetPassword")):(m.whetherFirstLogin=!1,a.userId=g.getLoggedInUser().id,a.userId&&(a.findLatestNotificationByUserId(),s.getMsgCount(function(a){m.msgCount=a.unreadCount},function(a){})),a.getDataForPopup(),
// added this broadcast scenario for dashboardMenu refresh issue after login success
// dated 24-04-2019 by krishna
m.$on("dashboardMenu",function(a,b){m.whetherFirstLogin||null!=b&&
// if($rootScope.userDefaultScreen){
//     $state.go($rootScope.userDefaultScreen.state);
// }else{
//     $state.go("home.view");
// }
c.go("home.view")})):c.go(d.callbackUrl,d.callbackState));g.getLoggedInUser;"undefined"!=typeof FCMPlugin&&w(b)}},function(b){m.showSpinner=!1,a.user.login.idEmailCellIdentity="",a.user.login.password="",a.getDataForPopup(),c.go("home.view")})},a.getDataForPopup=function(b){var c=v.userStatus().userData,d={};if(d.userId=c.id,a.organizationList||b){var g=a.organizationList[a.counter].organizationLocation.value+" where you are a"+a.organizationList[a.counter].designation+"would like to be added as a stakeholder so as to be able to view your updated Health Information. Please Provide your Approval. Approved/ Not Approved buttons",h=q.confirm().title(e.instant("POSTPONE_APPOINTMENT")).textContent(g).ok("Approved").cancel("Reject");q.show(h).then(function(){q.hide(),a.submitStakeholderResponse(a.organizationList[a.counter].clientId,!0),a.counter++,a.counter<a.organizationList.length&&a.getDataForPopup(a.organizationList)},function(){q.hide(),a.submitStakeholderResponse(a.organizationList[a.counter].clientId,!1),a.counter++,a.counter<a.organizationList.length&&a.getDataForPopup(a.organizationList)})}else a.counter=0,i.getData(f.getParameterizedUrl("GET_DETAILS_FOR_STAKE_HOLDER_APPROVAL",d),null,function(b){if(a.organizationList=b.data,a.organizationList&&a.organizationList.length>0){var c=a.organizationList[a.counter].organizationLocation.value+" where you are a"+a.organizationList[a.counter].designation+"would like to be added as a stakeholder so as to be able to view your updated Health Information. Please Provide your Approval. Approved/ Not Approved buttons",d=q.confirm().title(e.instant("POSTPONE_APPOINTMENT")).textContent(c).ok("Approved").cancel("Reject");q.show(d).then(function(){q.hide(),a.submitStakeholderResponse(a.organizationList[a.counter].clientId,!0),a.counter++,a.counter<a.organizationList.length&&a.getDataForPopup(a.organizationList)},function(){q.hide(),a.submitStakeholderResponse(a.organizationList[a.counter].clientId,!1),a.counter++,a.counter<a.organizationList.length&&a.getDataForPopup(a.organizationList)})}})},a.submitStakeholderResponse=function(a,b){var c={clientId:a,stakeholderApproval:b};i.postData(f.getParameterizedUrl("SUBMIT_STAKE_HOLDER_APPROVAL",c),null,function(a){l("success",a.data.successMessage)})},a.findLatestNotificationByUserId=function(){r.hide();var b=u.get("baseService");a.userId=b.getLoggedInUser().id,s.findLatestNotificationByUserId(a.userId,function(b){a.WSLatestNotifications=b,angular.forEach(a.WSLatestNotifications,function(a,b){a.msgContent=atob(a.msgContent),a.msgContent=t("limitTo")(a.msgContent,20),/*value.msgContent = $sce.trustAsHtml(value.msgContent);*/
a.msgContent=a.messageContent})},function(b){a.error=b})},/***************************** Log In Functionality ********************************************/
m.logoUrl="app/images/user.jpg",a.login=function(b){h.isEmpty(a.user)||(m.WSAllNotifications=null,
//var inValidPassword = utilService.checkPasswordPolicy($scope.user.login.password);
h.isEmpty(a.user.login.idEmailCellIdentity)||h.isEmpty(a.user.login.password)||(m.showSpinner=!0,k.login(a.user.login,function(b){m.showSpinner=!1,h.isNullOrEmpty(b)||
//added for personalization implemenatation for user
// $scope.getUserDefaultScreen();
// $scope.getUserPersonalizedScreenData();
// $scope.getScreenMasterData();
//end of new changes for personalization 
a.loginProcess(b)},function(b){m.showSpinner=!1,a.user.login.idEmailCellIdentity="",a.user.login.password=""})))},/***************************** Log Out Functionality ********************************************/
a.logout=function(a){m.whetherFirstLogin=!1,/* event.preventDefault(); */
/*localStorage.removeItem("defaultOrg");
            localStorage.removeItem("defaultOrgLoc");
            localStorage.removeItem("whetherLocationIsLab");
            localStorage.removeItem("locationCategory");
            localStorage.removeItem("appointmentListFilter");*/
//added to clear the existing userDefaultScreen in rootscope value 
//delete $rootScope.userDefaultScreen;
localStorage.clear(),/* $mdDialog.cancel();*/
r.hide(),k.removeExistingToken(angular.fromJson(localStorage.loggedInUser)),m.msgCount=null,m.WSAllNotifications=null},/***************************** Forgot ID Functionality ********************************************/
a.findDocumentTypes=function(){i.getData(f.getUrl("FIND_USER_ID_DOCUMENTS"),null,function(b){b&&b.data&&(a.documentTypeList=b.data)},function(a){})},a.findDocumentTypes(),a.enableDisableDocType=function(b){h.isNullOrEmpty(b)&&(b=!1),a.disableDocType=b,a.disableDocRef=b,a.errorDocType=!b,a.errorDocRef=!b},a.validateDocTypeField=function(b){h.isNullOrEmpty(b)?(a.errorEmailCell=!0,a.enableDisableDocType(!1)):(a.docType=null,a.user.forgotid.documentRef=null,a.enableDisableDocType(!0))},a.validateEmailFiels=function(b){h.isNullOrEmpty(b)||(a.user.forgotid.emailCellIdentity=null,a.user.forgotid.retrivalText=null,a.enableDisableDocType(!1),a.errorEmailCell=!0)},a.enableDisableField=function(b){a.user.forgotid.documentRef=""," "===a.user.forgotid.documentType?(a.disableEmailCell=!1,a.disableDocType=!1,a.disableDocRef=!0,a.errorEmailCell=!0,a.errorDocRef=!1):h.isNullOrEmpty(b)?(a.disableEmailCell=!1,a.enableDisableDocType(!0)):(a.disableDocRef=!1,a.disableDocType=!1,a.disableEmailCell=!0,a.errorEmailCell=!1)},a.forgotid=function(b){h.isNullOrEmpty(a.user.forgotid)?(a.errorEmailCell=!0,a.errorDocType=!0,a.errorDocRef=!0):h.isNullOrEmpty(a.user.forgotid.emailCellIdentity)&&h.isNullOrEmpty(a.user.forgotid.documentType)&&h.isNullOrEmpty(a.docType)?(a.errorEmailCell=!0,a.errorDocType=!0):h.isNullOrEmpty(a.user.forgotid.emailCellIdentity)||h.isNullOrEmpty(a.user.forgotid.retrivalText)?h.isNullOrEmpty(a.user.forgotid.documentType)&&h.isNullOrEmpty(a.docType)||h.isNullOrEmpty(a.user.forgotid.documentRef)||a.sendforgotid():a.sendforgotid()},a.sendforgotid=function(){m.showSpinner=!0,h.isFieldEmpty(a.docType)||(a.user.forgotid.documentTypeId=a.docType),delete a.user.forgotid.documentType,k.forgotId(a.user.forgotid,function(b){m.showSpinner=!1,h.isNullOrEmpty(b.successMessage)||l("success",b.successMessage),a.user.forgotPassword={},c.go("login")},function(b){m.showSpinner=!1,a.user.forgotid={},a.user.forgotid.documentType=null,a.errorEmailCell=!0,a.disableDocType=!1,a.disableDocRef=!1,a.errorEmailCell=!0,a.errorDocType=!1,a.errorDocRef=!1})},/***************************** Forgot Password Functionality **************************************/
a.forgotpassword=function(b){b.$valid&&(m.showSpinner=!0,k.forgotPassword(a.user.forgotPassword,function(b){m.showSpinner=!1,h.isNullOrEmpty(b.successMessage)||l("success",b.successMessage),a.user.forgotPassword={},c.go("login")},function(b){m.showSpinner=!1,a.user.forgotPassword.idEmailCellIdentity="",a.user.forgotPassword.retrivalText=""}))},/***************************** Reset Password Functionality ****************************************/
a.showPrePopulateId=function(){var b=g.getLoggedInUser();h.isEmpty(b)||h.isNullOrEmpty(b.userCode)||(a.user={resetPassword:{id:b.userCode}})},a.resetpassword=function(b){b.$valid&&a.updateresetpassword()},a.changePassword=function(b){b.$valid&&a.updatechangepassword()},a.checkValidPassword=function(){/* Validate old password,new password and repeat new password as per Business Rule*/
var b=h.checkPasswordPolicy(a.user.resetPassword.newPassword);b?(/*notify("Error", $translate.instant("INVALID_NEW_PASSWORD"));*/
a.user.resetPassword.newPassword="",a.user.resetPassword.repeatNewPassword="",a.passwordMatched=!1,a.passwordNotMatched=!1):a.user.resetPassword.newPassword!==a.user.resetPassword.repeatNewPassword&&(a.user.resetPassword.repeatNewPassword="",a.passwordMatched=!1,a.passwordNotMatched=!0),a.showValidationRules=!1},a.repeatPasswordCheck=function(){/* Validate old password,new password and repeat new password as per Business Rule*/
var b=h.checkPasswordPolicy(a.user.resetPassword.repeatNewPassword);b?(/*notify("Error", $translate.instant("INVALID_CONFIRM_PASSWORD"));*/
a.user.resetPassword.repeatNewPassword="",a.passwordMatched=!1,a.passwordNotMatched=!1):a.user.resetPassword.newPassword!==a.user.resetPassword.repeatNewPassword?(/*notify("Error", $translate.instant("NEWPASS_CONFIRMPASS_SAME"));*/
a.error=!0,a.user.resetPassword.repeatNewPassword="",a.passwordMatched=!1,a.passwordNotMatched=!0):(a.passwordMatched=!0,a.passwordNotMatched=!1),a.showValidationRules=!1},a.showPasswordValidation=function(){a.showValidationRules=!0},a.updateresetpassword=function(){m.showSpinner=!0,k.resetPassword(a.user.resetPassword,function(b){m.showSpinner=!1,h.isNullOrEmpty(b.successMessage)||l("success",b.successMessage),a.user.resetPassword={},k.logout()},function(b){m.showSpinner=!1,a.user.resetPassword.oldPassword="",a.user.resetPassword.newPassword="",a.user.resetPassword.repeatNewPassword=""})},a.updatechangepassword=function(){m.showSpinner=!0,a.user.resetPassword.id=d.userId,k.changePassword(a.user.resetPassword,function(b){m.showSpinner=!1,h.isNullOrEmpty(b.successMessage)||l("success",b.successMessage),a.user.resetPassword={},k.logout()},function(b){m.showSpinner=!1,a.user.resetPassword.oldPassword="",a.user.resetPassword.newPassword="",a.user.resetPassword.repeatNewPassword=""})},/**
         * [[Description]]
         */
a.switchUser=function(){if(m.showSpinner=!0,!h.isEmpty(m.loggedInUserDetails)&&!h.isNullOrEmpty(m.loggedInUserDetails.isOrganizationUser)&&!h.isNullOrEmpty(m.loggedInUserDetails.isOrganizationUserMode)){/*authenticationService.switchUser($rootScope.loggedInUserDetails.isOrganizationUserMode, function (successResponse) {*/
var a=g.getLoggedInUser();if(a){//This flag is used to reload the menu data in dashboard
if(a.isOrganizationUserMode=!a.isOrganizationUserMode,g.setLoggedInUser(a),m.loggedInUserDetails=a,g.setLoggedInUser(a),g.setUserMode({isOrganizationUserMode:a.isOrganizationUserMode}),m.switchUserReloadFlag=!0,a.isOrganizationUserMode){//Organization User Mode
var b=g.getOrganizationUserMenu();b?m.loadMenuContents(b):m.loadMenuContents()}else{//Individual User Mode
var d=g.getIndividualUserMenu();d?m.loadMenuContents(d):m.loadMenuContents()}m.showSpinner=!1,c.go("home.view")}}},a.onResetCancelClick=function(){c.go("home.view")},a.onCancelClick=function(){k.logout()},a.viewMyCalendar=function(){c.go("mycalendarview",{type:"regular"})},/***************************** Common Functions ****************************************/
a.goToIndividualUserSignUp=function(){c.go("individualUserSignUp")},a.changeLanguage=function(){e.use(a.selectedLanguage)}}]),/**
 * Creating Register controller for registering user in to system
 *
 */
angular.module("paripal.autheticationModule").controller("RegisterCtrl",["$scope","Flash","$auth","$state","registerService","utilService","notify","$translate","authenticationService","baseService","$rootScope","dateconvertor","httpService","urlService","EmergencyTransactionService","ManageOrgSubscriptionService","$mdDialog","vcRecaptchaService","$location","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){a.user={},a.sysOrgList=[],a.languageList=[],k.showSpinner=!1,a.guardian={},a.currentDate=new Date,a.passwordMatched=!1,a.passwordNotMatched=!1,a.verifyCaptcha=!1,a.whetherSubscriberSelected=!1,$(".modal-backdrop").removeClass("modal-backdrop");/***************************** Captcha Functionality ********************************************/
var u=!!window.cordova;u?(a.whetherMobileApp=!1,a.verifyCaptcha=!0):a.whetherMobileApp=!0,"localhost"==s.host()?a.model={key:"6LetdD4UAAAAAOdSV21MNzuZXxAXTzBphKvTySKl"}:"test.paripal.com"==s.host()?a.model={key:"6LfXEj4UAAAAABRJtUACKoeMPoCdPHYQ3Pwh7Kd3"}:"www.paripal.com"==s.host()&&(a.model={key:"6Lebcz4UAAAAAEGbVP0Ra4rQO4bOQwRiuSd3kCBu"}),a.setResponse=function(b){/* $scope.captchaResponse = response; */
var c={};c.captchaResponse=b;var d=n.getParameterizedUrl("CAPTCHA_RESPONSE",c);return m.getData(d,null,function(b){b&&b.data&&(a.verifyCaptcha=angular.fromJson(b.data))},function(a){})},a.setWidgetId=function(b){a.widgetId=b},a.cbExpiration=function(){r.reload(a.widgetId)},/***************************** Captcha Functionality ********************************************/
/***************************** Individual user sign up Functionality ********************************************/
a.user.signUp={},a.defaultSubs=!1,/* if ($stateParams.fromIndividualUserSignUp) {
            var offer = $mdDialog.alert()
                
                .htmlContent('<div class="padding-t-10 textAlign-C"><h3><b>' + $translate.instant('LIMITED_OFFER') + '</b></h3></div>' + '<br>' + '<div class="padding-t-10 textAlign-J"><h4>' + $translate.instant('SPECIAL_OFFER') + '</h4></div>')
                .ok($translate.instant('CLOSE'));
            $mdDialog.show(offer).then(function () { }, function () { });
        } */
a.getReferredByData=function(b){var c={};return c.userName=b,m.getData(n.getParameterizedUrl("FIND_USER_NAME",c),null,function(b){return a.userNames=angular.fromJson(b.data)},function(a){})},a.individualUserSignUp=function(b){a.verifyCaptcha&&(a.user.signUp.birthDate=l.convertToServerDate(b.birthDate),a.user.signUp.guardianCheck=a.guardianCheck,a.user.signUp.guardian=a.WSUserServiceOrganization,a.user.signUp.sysOrganization=a.individualUserSignUpForm.sysOrganization.id,a.user.signUp.sponsorOrganization=a.sponsorOrg,k.showSpinner=!0,a.setMsgOrganizationLocationId("1"),/*$scope.setOrganizationLocationId(angular.fromJson(individualUserSignUpForm.sysOrganization.$$rawModelValue).id);*/
e.individualUserSignUp(a.user.signUp,function(b){k.showSpinner=!1,f.isNullOrEmpty(b.successMessage)||(g("success",b.successMessage),b.response&&a.paymentMethod(b.response.transactionId),i.logout(),a.user.signUp={})},function(a){k.showSpinner=!1}))},a.paymentMethod=function(a){if(a){var b={transactionId:a};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"USER_SUBSCRIPTION"})),o.getWhetherBillDetails(b,function(b){d.go("billsummaryview",{transactionId:a})},function(a){var b="FEE_TYPE_NOT_FOUND_TITLE",c="FEE_TYPE_NOT_FOUND_BODY";q.confirm().title(h.instant(b)).textContent(h.instant(c)).ok(h.instant("OK")).cancel(h.instant("CANCEL"))},{handleError:!1})}},a.onCancelClick=function(){k.whetherFirstLogin=!1,i.logout()},a.loadListOfOrganizations=function(){e.loadListOfOrganizations(function(b){f.isEmpty(b)||(a.sysOrgList=b)},function(a){})},a.getSponsorOrganizations=function(b){var c={};c.keyword=b;var d=n.getParameterizedUrl("FIND_SPONSOR_ORGANIZATIONS_BY_KEYWORD",c);return m.getData(d,null,function(b){return b&&b.data&&(a.sponsorOrganizations=angular.fromJson(b.data)),a.sponsorOrganizations},function(a){})},a.cancel=function(){d.go("login")},a.subscriptionFor=function(){e.subscriptionFor(function(b){f.isEmpty(b)||(a.forSubscriptions=b,angular.forEach(a.forSubscriptions,function(b,c){"SUBSCRIPTION_TYPE_INDIVIDUAL"==b.code&&(a.subscriptionForId=angular.fromJson(b))}))},function(a){})},a.subscriptionFor(),a.sysOrgSelected=function(b){var c=JSON.parse(b);a.individualUserSignUpForm.sysOrganization=c;var d={};d.sysOrgId=c.id,d.subscriptionForId=a.subscriptionForId.id;var e=n.getParameterizedUrl("FIND_SUBSCRIPTION_TYPES",d);m.getData(e,null,function(b){b&&b.data&&(a.subscriptionTypeList=angular.fromJson(b.data)),1==a.subscriptionTypeList.length&&(a.defaultSubs=!0)},function(a){})},a.sponsorSelected=function(b,c,d){a.sponsorOrg=b},a.whetherSubscriberChecked=function(){a.whetherSubscriberSelected=!0},a.whetherSubscriberClicked=function(b){f.isNullOrEmpty(b)?a.whetherSubscriberSelected=!0:1==b?(a.whetherSubscriberSelected=!1,a.user.signUp.subscriptionFrom="",a.user.signUp.subscriptionTill=""):a.whetherSubscriberSelected=!0,/* if ($scope.whetherSubscriberSelected) {
                var confirm = $mdDialog.alert()
                    .title($translate.instant('AVAIL_OFFER_TERMS'))
                    .htmlContent($translate.instant('DO_YOU_WANT_TO_AVAIL_OFFER') + '<b><u>' + $translate.instant('DO_YOU_WANT_TO_AVAIL_OFFER2') + '</b></u>' + $translate.instant('DO_YOU_WANT_TO_AVAIL_OFFER3'))
                    .ok($translate.instant('CLOSE'));
                $mdDialog.show(confirm).then(function () { }, function () { });
            } */
b&&(a.user.signUp.whetherSponsored&&(a.user.signUp.whetherSponsored=!1),a.individualUserSignUpForm.sponsorOrganization&&(a.individualUserSignUpForm.sponsorOrganization=null),a.sponsorOrg&&(a.sponsorOrg=null))},a.whetherSponsoredClicked=function(b){b&&(a.individualUserSignUpForm.sponsorOrganization=null,a.sponsorOrg=null)},a.getSubscriptionTypeById=function(b){a.user.signUp.subscriptionFrom=new Date,/* $scope.user.signUp.subscriptionTill = ""; */
a.subscriptionTypeId=angular.fromJson(b).id,p.getSubscriptionTypeById(a.subscriptionTypeId,function(b){a.WSSubscriptionType=b,a.noOfValidDays=a.WSSubscriptionType.noOfValidDays,a.user.signUp.subscriptionTill=p.validFromChanged(a.user.signUp.subscriptionFrom,a.noOfValidDays)})},a.validFromChanged=function(b){a.user.signUp.subscriptionTill=p.validFromChanged(b,a.noOfValidDays)},a.viewSubscriptionTypeServices=function(b){if(a.WSSubscriptionType.subscriptionTypeServiceses.length>0)q.show({scope:a,preserveScope:!0,controller:viewSubscriptionServices,templateUrl:"app/modules/billing-setup/views/view-subscription-type-services.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:commonConstants.dialogBox.clickOutsideToClose});else{var c=q.confirm().title(h.instant("VALIDITY")).htmlContent('<div class="padding-t-10"><b>'+h.instant("VALIDITY")+" : </b>"+a.WSSubscriptionType.noOfValidDays+" Days</div>").ok(h.instant("OK")).cancel(h.instant("CANCEL"));q.show(c).then(function(){},function(){})}},/***************************** New user sign in Functionality ********************************************/
a.loadListOfLanguages=function(){a.user.signIn=j.getLoggedInUser(),a.birthDate=l.convertToViewDate(a.user.signIn.birthDate),a.guardian={id:a.user.signIn.guardianId,value:a.user.signIn.guardianName},e.loadListOfLanguages(function(b){f.isEmpty(b)||(a.languageList=b)},function(a){})},a.newUserSignIn=function(b){b.$valid&&(k.whetherFirstLogin=!1,/* Validate new password and confirm password as per Business Rule*/
b.$valid&&(a.user.signIn.cell1===a.user.signIn.cell2?(g("Error",h.instant("PRI_ALT_MOBILE_NUM_DIFFERENT")),a.user.signIn.cell2=""):null!=a.user.signIn.email1&&a.user.signIn.email1===a.user.signIn.email2?(g("Error",h.instant("PRI_ALT_EMAIL_DIFFERENT")),a.user.signIn.email2=""):(k.showSpinner=!0,a.updateNewUserSignInDetails())))},a.showPasswordValidation=function(){a.showValidationRules=!0},a.checkPassword=function(){var b=f.checkPasswordPolicy(a.user.signIn.newPassword);b?(/*notify("Error", $translate.instant("INVALID_NEW_PASSWORD"));*/
a.user.signIn.newPassword="",a.user.signIn.confirmPassword="",a.passwordMatched=!1,a.passwordNotMatched=!1):a.user.signIn.newPassword!==a.user.signIn.confirmPassword&&(a.user.signIn.confirmPassword="",a.passwordMatched=!1,a.passwordNotMatched=!0),a.showValidationRules=!1},a.repeatPasswordCheck=function(){var b=f.checkPasswordPolicy(a.user.signIn.confirmPassword);b?(/*notify("Error", $translate.instant("INVALID_CONFIRM_PASSWORD"));*/
a.user.signIn.confirmPassword="",a.passwordMatched=!1,a.passwordNotMatched=!1):a.user.signIn.newPassword!==a.user.signIn.confirmPassword?(/*notify("Error", $translate.instant("NEWPASS_CONFIRMPASS_SAME"));*/
a.user.signIn.confirmPassword="",a.passwordMatched=!1,a.passwordNotMatched=!0):(a.passwordMatched=!0,a.passwordNotMatched=!1),a.showValidationRules=!1},a.updateNewUserSignInDetails=function(){a.guardian?(a.user.signIn.guardianId=a.guardian.id,a.user.signIn.guardianName=a.guardian.value):(a.user.signIn.guardianId="",a.user.signIn.guardianName="",a.user.signIn.hasGuardian=!1),a.user.signIn.birthDate=a.birthDate;var b=angular.copy(a.user.signIn);b.birthDate=l.convertToServerDate(b.birthDate),e.newUserSignIn(b,function(b){k.showSpinner=!1,f.isNullOrEmpty(b.successMessage)||g("success",b.successMessage),a.user.signIn={},i.logout()},function(a){k.showSpinner=!1})},a.whySubscribe=function(){var a="<br /><div class='subscription-benefits-list'><ul><li> "+h.instant("SUBSCRIPTION_BENEFIT_DETAILS_KEY1")+"</li><li>"+h.instant("SUBSCRIPTION_BENEFIT_DETAILS_KEY2")+"</li><li>"+h.instant("SUBSCRIPTION_BENEFIT_DETAILS_KEY3")+"</li><li>"+h.instant("SUBSCRIPTION_BENEFIT_DETAILS_KEY4")+"</li><li>"+h.instant("SUBSCRIPTION_BENEFIT_DETAILS_KEY5")+"</li><li>"+h.instant("SUBSCRIPTION_BENEFIT_DETAILS_KEY6")+"</li></ul></div>",b=q.alert().title(h.instant("BENEFITS_OF_SUBSCRIPTION_TITLE")).htmlContent(a).ok(h.instant("OK"));q.show(b).then(function(){},function(){})},a.whatSponsoredSubcription=function(a){var b="<br /><div class='subscription-benefits-list'><ul><li> "+h.instant("SPONSORSHIP_BENEFIT_DETAILS_KEY1")+"</li><li>"+h.instant("SPONSORSHIP_BENEFIT_DETAILS_KEY2")+"</li></ul></div>",c=q.alert().title(h.instant("SPONSORED_SUBSCRIPTION_TITLE")).htmlContent(b).ok(h.instant("OK"));q.show(c).then(function(){},function(){})}}]),/**
 * Creating Log In controller  for validate user and log in to system
 *
 */
angular.module("paripal.autheticationModule").controller("TrustedUserCtrl",["$scope","$auth","$state","$stateParams","$translate","urlService","baseService","utilService","httpService","menuGenerationService","authenticationService","notify","$rootScope","$cookieStore","$cookies","storageService","$mdDialog","$mdSelect","notificationMessagingService","$filter","$injector","$timeout","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(){m.$broadcast("customHeader",!0),d.stateName?"redirectPatientToAgora"==d.stateName?c.go("redirectPatientToAgora"):c.go(d.stateName):c.go("home.view")}function y(a){if(a){var b={};b.paripalClientId=a,i.getData(f.getParameterizedUrl("GET_TRUSTED_USER_CSS",b),null,function(a){a&&a.data&&(localStorage.setItem("applyCustomCSS",a.data.applyCustomCSS),localStorage.setItem("applyCustomHeader",a.data.applyCustomHeader),localStorage.setItem("whetherParipalAsSubdomain",a.data.whetherParipalAsSubdomain),localStorage.setItem("paripalClientId",a.data.paripalClientId),x())},function(a){})}}a.disableEmailCell=!1,a.disableDocType=!1,a.disableDocRef=!0,a.error=!1,a.errorEmailCell=!1,a.errorDocType=!1,a.errorDocRef=!1,a.passwordMatched=!1,a.passwordNotMatched=!1,a.user={forgotid:{},login:{idEmailCellIdentity:"",password:""}},a.documentTypeList={},/*localStorage.removeItem("defaultOrg");
        localStorage.removeItem("defaultOrgLoc");
        if ($stateParams.username) {
            $scope.user.login.idEmailCellIdentity = $stateParams.username;
        }

        if ($rootScope.isLoggedIn && $rootScope.loggedInUserDetails.isOrganizationUser) {
            httpService.getData(urlService.getUrl('FIND_ORG_DETAILS_BY_USER'), null, function (response) {
                $rootScope.defaultOrgLoc = response.data.orgLocation.value;
                localStorage.setItem("defaultOrg", angular.toJson(response.data.organization));
                localStorage.setItem("defaultOrgLoc", angular.toJson(response.data.orgLocation));
            }, function (error) {});
        }*/
/***************************** Log In Functionality ********************************************/
a.loginProcess=function(){var e,f,i;h.isNullOrEmpty(d)||(console.log(d),e=d.accessToken,d.stateName&&(i=d.stateName)),b.setToken(e),
//removing cookies before assigning new token to the cookies 
n.remove("token"),o.remove("token"),
// to be used for orbeon forms
n.put("token",e),o.put("token",e,{path:"/"}),m.isLoggedIn=!0,localStorage.setItem("isLoggedIn",!0),k.getUserDetails(a.user.login,function(b){if(m.showSpinner=!1,!h.isEmpty(b)){p.setPrivileges(b),g.setLoggedInUser(b),delete b.individualFeaturePrivileges,delete b.locationConsolidatedPrivileges,delete b.locationFeaturePrivileges,m.loggedInUserDetails=b,m.userDateFormat=b.userDateFormat,localStorage.setItem("userDateFormat",m.userDateFormat),a.user.login={},a.selectLanguage();/*if (!utilService.isNullOrEmpty(successResponse.redirectPage)) {
                        if (!utilService.isFieldEmpty($stateParams.callbackState) && !utilService.isFieldEmpty($stateParams.callbackUrl)) {
                            $state.go($stateParams.callbackUrl, $stateParams.callbackState);
                        } else {
                            if (successResponse.redirectPage === "FIRST_LOGIN") {
                                $rootScope.whetherFirstLogin = true;
                                $state.go("newUserSignIn");
                            } else if (successResponse.redirectPage === "RESET_PASSWORD_PAGE") {
                                $rootScope.whetherFirstLogin = false;
                                $state.go("resetPassword");
                            } else {
                                $rootScope.whetherFirstLogin = false;
                                $scope.userId = baseService.getLoggedInUser().id;
                                if ($scope.userId) {
                                    $scope.findLatestNotificationByUserId();
                                    notificationMessagingService.getMsgCount(function (resp) {
                                        $rootScope.msgCount = resp.unreadCount;
                                    }, function (error) {

                                    });
                                }
                                $state.go("home.view");
                            }
                        }
                    }*/
// if(stateName){
//     if(stateName == 'redirectPatientToAgora'){
//         $state.go('redirectPatientToAgora');
//     //     $state.go("redirectPatientToAgora", {
//     //         data: $rootScope.loggedInUserDetails
//     // });
//     }else{
//         $state.reload();
//        $state.go(stateName); 
//     }
//  }else{
//     $state.reload();
//     $state.go("home.view");
// }
g.getLoggedInUser;"undefined"!=typeof FCMPlugin&&getNotificationToken(b),d.paripalClientId&&(f=d.paripalClientId,y(f))}},function(b){m.showSpinner=!1,a.user.login.idEmailCellIdentity="",a.user.login.password="",
//$state.go("home.view");
//Changes done for logout redirect issue for healthplus server, dated:17-05-2019 by krishna
"paripal_healthplus"==d.paripalClientId?w.location.href="http://healthplus.life/#/error":c.go("home.view")})},a.loginProcess()}]),angular.module("paripal.autheticationModule").directive("confirmPassword",function(){return{require:"ngModel",scope:{actualPassword:"=confirmPassword"},link:function(a,b,c,d){function e(b){a.actualPassword||(a.actualPassword="");var c=b!=a.actualPassword;return d.$setValidity("noMatch",!c),!!c&&c}d.$parsers.unshift(e),a.$watch("actualPassword",function(a){d.$setValidity("noMatch",a===d.$viewValue)})}}}),angular.module("paripal.autheticationModule").service("authenticationService",["httpService","urlService","utilService","baseConfig","$auth","$state","$rootScope","$cookieStore","$translate","baseService","$cookies","$location",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";/***************************** Log In Functionality ********************************************/
this.login=function(a,b,c){var f=new Object;f.url=d.baseUrl+"oauth/token?grant_type=password&client_id=admin&client_secret=pass&username="+a.idEmailCellIdentity+"&password="+encodeURIComponent(a.password),e.login(null,f).then(function(a){a&&a.data&&b(a.data)})},this.getUserDetails=function(d,e,f){var g=new Object;c.isNullOrEmpty(d)||(g.userIdntification=d.idEmailCellIdentity);var h=b.getUrl("GET_USER_BASIC_INFO");a.getData(h,null,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.switchUser=function(c,d,e){var f=new Object;f.isOrganizationUserMode=!c;var g=b.getParameterizedUrl("SWITCH_USER",f);a.getData(g,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.removeExistingToken=function(c){var d={},e=this;if("undefined"==typeof FCMPlugin){var f=b.getUrl("LOGOUT"),h=""+k.get("token");a.logOut(f,null,h,function(a){e.logout(function(){g.logoUrl="app/images/user.jpg",g.loadMenuContents()})},function(a){e.logout(function(){})})}else FCMPlugin.getToken(function(f){console.log("get token: "+f),d.user=c,d.deviceToken=f,d.deviceType=device.platform,d.deviceId=device.uuid,a.postData(b.getUrl("REMOVE_NOTIFICATION_TOKEN"),d,function(){console.log(" in successCallback");var c=b.getUrl("LOGOUT");a.getData(c,null,function(a){e.logout(function(){g.logoUrl="app/images/user.jpg",g.loadMenuContents()})},function(a){e.logout(function(){})})},function(){})})},/***************************** Log Out Functionality ********************************************/
this.logout=function(a){e.logout().then(function(b){g.isLoggedIn=!1,g.professionalId=null,/***TODO: NKL   Uncomment this on integration of logo   ***/
/*$rootScope.defaultLogo = null;*/
g.loggedInUserDetails=null,j.setDefaultUserDateFormat(),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("loggedInUser"),localStorage.removeItem("paripal_token"),localStorage.removeItem("individualUserMenu"),localStorage.removeItem("organizationUserMenu"),localStorage.removeItem("requesterInfo"),localStorage.removeItem("isOrgUserMode"),localStorage.removeItem("emergencyAutomateUser"),localStorage.removeItem("location"),localStorage.removeItem("client"),localStorage.removeItem("vprCurrentTab"),h.remove("token"),g.loadMenuContents(),f.go("landingPage"),a&&a()})},/***************************** Forgot ID Functionality ********************************************/
this.forgotId=function(c,d,e){var f=new Object;f.userIdentificationCode=c.emailCellIdentity,f.documentType=c.documentType,f.documentReference=c.documentRef,f.retrievalText=c.retrivalText,f.documentTypeId=c.documentTypeId,a.postData(b.getUrl("FORGOT_ID"),f,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},/***************************** Forgot Password Functionality **************************************/
this.forgotPassword=function(d,e,f){if(!c.isNullOrEmpty(d.idEmailCellIdentity)){var g=b.getUrl("FORGOT_LOGIN_PASSWORD");g=g+"?loginId="+d.idEmailCellIdentity,a.getData(g,null,function(a){a&&a.data&&e(a.data)},function(a){f(a)})}},/***************************** Reset Password Functionality **************************************/
this.resetPassword=function(d,e,f){if(!c.isNullOrEmpty(d.id)&&!c.isNullOrEmpty(d.oldPassword)&&!c.isNullOrEmpty(d.newPassword)){var g=new Object;g.id=d.id,g.currentPassword=d.oldPassword,g.newPassword=d.newPassword,a.postData(b.getUrl("RESET_PASSWORD"),g,function(a){a&&a.data&&e(a.data)},function(a){f(a)})}},/***************************** Change Password Functionality **************************************/
this.changePassword=function(d,e,f){if(!c.isNullOrEmpty(d.id)&&!c.isNullOrEmpty(d.oldPassword)&&!c.isNullOrEmpty(d.newPassword)){var g=new Object;g.id=d.id,g.currentPassword=d.oldPassword,g.newPassword=d.newPassword,a.postData(b.getUrl("CHANGE_PASSWORD"),g,function(a){a&&a.data&&e(a.data)},function(a){f(a)})}}}]),angular.module("paripal.autheticationModule").service("registerService",["httpService","urlService","utilService","dateconvertor",function(a,b,c,d){"use strict";/***************************** Individual user sign up Functionality ********************************************/
this.individualUserSignUp=function(d,e,f){var g=b.getUrl("REGISTER"),h={};h.userBasicInformationDTO={},h.wsUserSubscription={},h.wsUserSubscription.subscriptionType={},h.sponsorOrganization={},c.isFieldEmpty(d.referredBy)||(h.userBasicInformationDTO.referredByUser=d.referredBy),h.userBasicInformationDTO.firstName=d.firstName,h.userBasicInformationDTO.lastName=d.lastName,h.userBasicInformationDTO.cell1=d.mobile,h.userBasicInformationDTO.email1=d.email;var i=angular.fromJson(d.sysOrganization);h.userBasicInformationDTO.organizationId=i,h.userBasicInformationDTO.birthDate=d.birthDate,h.userBasicInformationDTO.hasGuardian=d.guardianCheck,c.isFieldEmpty(d.guardian)||(h.userBasicInformationDTO.guardianId=d.guardian.id,h.userBasicInformationDTO.guardianName=d.guardian.value),h.userBasicInformationDTO.whetherSubscriber=d.whetherSubscriber,h.userBasicInformationDTO.whetherSponsored=d.whetherSponsored,c.isFieldEmpty(d.subscriptionType)||(h.wsUserSubscription.subscriptionType.id=d.subscriptionType.id,h.wsUserSubscription.subscriptionType.value=d.subscriptionType.value,h.wsUserSubscription.subscriptionType.code=d.subscriptionType.code),c.isFieldEmpty(d.subscriptionFrom)||(h.wsUserSubscription.subscriptionFrom=d.subscriptionFrom),c.isFieldEmpty(d.subscriptionTill)||(h.wsUserSubscription.subscriptionTill=d.subscriptionTill),h.sponsorOrganization=d.sponsorOrganization,a.postData(g,h,function(a){a&&a.data&&e(a.data)},function(a){f(a)},{organizationLocationId:i})},this.individualUserSubscription=function(c,d,e,f){var g={},h=b.getUrl("INDIVIDUAL_USER_SUBSCRIPTION");console.log(c),console.log(d),g.whetherOptedForSubscription=!0,g.user={id:d.id,value:d.displayName},c.remarks&&(g.remarks=c.remarks.$modelValue),c.subscriptionType.$modelValue&&(g.subscriptionType={id:c.subscriptionType.$modelValue.id}),c.dateForm.validFrom&&c.dateForm.validFrom.$modelValue&&(g.subscriptionFrom=c.dateForm.validFrom.$modelValue),c.validTillDate&&(g.subscriptionTill=c.validTillDate),c.sponsor.$modelValue&&(g.whetherSponsored=!0,g.sponsorOrganization=c.sponsor.$modelValue),c.sponsorOrganization&&(g.sponsorOrganization=c.sponsorOrganization),a.postData(h,g,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.getUserDetails=function(c,d,e){var f=b.getUrl("GET_USER_DETAILS")+"/"+c.idEmailCellIdentity;a.postData(f,paramObject,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.loadListOfOrganizations=function(c,d){a.getData(b.getUrl("GET_SYSTEM_ORGANIZATIONS"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.subscriptionFor=function(c,d){a.getData(b.getUrl("GET_LIST_OF_SUBSCRIPTION_FOR"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},/***************************** New user sign in Functionality ********************************************/
this.loadListOfLanguages=function(c,d){a.getData(b.getUrl("GET_LANGUAGES"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.newUserSignIn=function(c,e,f){var g=b.getUrl("NEW_USER_SIGN_IN"),h=new Object;h.birthDate=d.convertToServerDate(c.birthDate),h.hasGuardian=c.hasGuardian,h.guardianId=c.guardianId,h.guardianName=c.guardianName,h.firstName=c.firstName,h.middleName=c.middleName,h.lastName=c.lastName,h.displayName=c.displayName,h.cell1=c.cell1,h.email1=c.email1,h.id=c.id,h.organizationId=c.organizationId,h.preferredLanguageId=c.preferredLanguageId,h.userCode=c.userCode,h.cell2=c.cell2,h.email2=c.email2,h.accessPin=c.accessPin,h.retrievalText=c.retrievalText,h.password=c.newPassword,a.postData(g,h,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.getSubscriptionDetails=function(c,d,e){var f={id:c};a.getData(b.getParameterizedUrl("FIND_USER_SUBSCRIPTION_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),/**
 * Creating base service for handling basic functions used in all modules
 *
 */
angular.module("baseModule").factory("baseService",["utilService","urlService","httpService","$rootScope","baseConfig","$mdDialog","$timeout","$translate",function(a,b,c,d,e,f,g,h){var i={};/**
     * This function is used to set user object in cache.
     * @param {user} object: user is logged in user object
     *
     */
/**
     * This function is used to get logged in user object.
     *
     */
/**
     * This function is used to get state params value from local storage
     *
     * @param stateParams
     * @param stateView
     */
/**
     * This function is used to set state params value to local storage
     *
     * @param stateView
     * @param stateParams
     */
/**
     * This function is used to set language object in cache.
     * @param {language} object: language is user selected language
     *
     */
/**
     * This function is used to get user language object.
     *
     */
/**
     * This function is used to set message organization location id in cache.
     * @param {msgOrganizationLocationId} int: msgOrganizationLocationId is user selected organization location
     *
     */
/**
     * This function is used to get user language object.
     *
     */
/**
     * This function is used to set individual user menu object in cache.
     * @param {menu} object: menu is individual user menu object
     *
     */
/**
     * This function is used to get individual user menu object.
     *
     */
/**
     * This function is used to set organization user menu object in cache.
     * @param {menu} object: menu is organization user menu object
     *
     */
/**
     * This function is used to get organization user menu object.
     *
     */
/**
     * This function is used to set  user mode  in cache.
     * @param {mode} object: mode is  user mode object
     *
     */
/**
     * This function is used to get  user mode object.
     *
     */
/**
     * This function returns the logo of org, org-loc and user
     */
return i.isAppPaused=!1,i.setLoggedInUser=function(a){delete a.individualFeaturePrivileges,delete a.locationConsolidatedPrivileges,delete a.locationFeaturePrivileges,localStorage.setItem("loggedInUser",angular.toJson(a))},i.getLoggedInUser=function(){return null!==localStorage.getItem("loggedInUser")?angular.fromJson(localStorage.getItem("loggedInUser")):null},i.getStateParamsFromLocalStarage=function(b,c){return a.isNullOrEmpty(c)?b:null!==localStorage.getItem(c)?angular.fromJson(localStorage.getItem(c)):b},i.setStateParamsToLocalStarage=function(b,c){a.isNullOrEmpty(b)||(delete localStorage.removeItem(b),localStorage.setItem(b,angular.toJson(c)))},i.setUserLanguage=function(a){localStorage.setItem("userLanguage",angular.toJson(a))},i.getUserLanguage=function(){return null!==localStorage.getItem("userLanguage")?angular.fromJson(localStorage.getItem("userLanguage")):null},i.setMsgOrganizationLocationId=function(a){localStorage.setItem("msgOrganizationLocationId",angular.toJson(a))},i.getMsgOrganizationLocationId=function(){return null!==localStorage.getItem("msgOrganizationLocationId")?angular.fromJson(localStorage.getItem("msgOrganizationLocationId")):null},i.setIndividualUserMenu=function(a){localStorage.setItem("individualUserMenu",angular.toJson(a))},i.getIndividualUserMenu=function(){return null!==localStorage.getItem("individualUserMenu")?angular.fromJson(localStorage.getItem("individualUserMenu")):null},i.setOrganizationUserMenu=function(a){localStorage.setItem("organizationUserMenu",angular.toJson(a))},i.getOrganizationUserMenu=function(){return null!==localStorage.getItem("organizationUserMenu")?angular.fromJson(localStorage.getItem("organizationUserMenu")):null},i.getUserBasicInfo=function(a,d){var e=b.getUrl("GET_USER_BASIC_INFO");c.getData(e,null,function(b){b&&b.data&&a(b.data)},function(a){d(a)})},i.getUserImageInfo=function(a,d,e){a&&c.downloadFileData(b.getParameterizedUrl("GET_IMAGE_BY_USER_ID",{userId:a}),null,function(a){if(a&&a.data){var b=new Uint8Array(a.data);if(b.length>0){var c=new Blob([b],{type:""});window.URL.createObjectURL(c)&&d(window.URL.createObjectURL(c))}else d("app/images/user.jpg")}else d("app/images/user.jpg")},function(a){e("app/images/user.jpg")})},i.setUserMode=function(a){localStorage.setItem("userMode",angular.toJson(a))},i.getUserMode=function(){return null!==localStorage.getItem("userMode")?angular.fromJson(localStorage.getItem("userMode")):null},i.getAllMinLengths=function(){c.getData(b.getJsonFileUrl("GET_ALL_MIN_LENGTHS"),null,function(a){d.minLengthList=a.data},function(){})},i.setUserDateFormat=function(b){a.isFieldEmpty(b)?(d.userDateFormat="MM/dd/yyyy",localStorage.setItem("userDateFormat","MM/dd/yyyy")):(d.userDateFormat=b,localStorage.setItem("userDateFormat",b))},i.getUserDateFormat=function(){return"true"==localStorage.isLoggedIn||1==localStorage.isLoggedIn?a.isFieldEmpty(d.userDateFormat)?a.isFieldEmpty(localStorage.userDateFormat)?"MM/dd/yyyy":localStorage.userDateFormat:d.userDateFormat:localStorage.userDateFormat},i.setDefaultUserDateFormat=function(){d.userDateFormat="MM/dd/yyyy",localStorage.userDateFormat="MM/dd/yyyy"},i.getBaseConfig=function(){return e},i.getLogo=function(b,f){var g=e.baseUrl+"rest/"+b+"/",h="";"user"==b&&(g+="public/"),g=g+"logo/"+f,h="../../images/paripalLogo.png",c.downloadFileData(g,null,function(b){if(b&&b.data&&b.data.byteLength>0){var c=new Uint8Array(b.data),e=new Blob([c],{type:""});window.URL.createObjectURL(e)&&(h=window.URL.createObjectURL(e)),angular.element(document.getElementById("paripalLogo2"))[0].style.backgroundImage="url("+h+")"}else angular.element(document.getElementById("paripalLogo2"))[0].style.backgroundImage="url("+h+")";a.isFieldEmpty(d.defaultLogo)&&(d.defaultLogo=h)},function(){})},i.validateListing=function(a){var b=i.getLoggedInUser();b&&0==b.isOrganizationUserMode&&!b.userAccountStatusDTO.whetherSubscriber&&g(function(){f.show(f.alert().title(h.instant("INFORMATION")).textContent(h.instant(a)).ok(h.instant("OK")))},2e3)},i.getDefaultOrgLocation=function(){if(null!==localStorage.getItem("defaultOrg")&&null!==localStorage.getItem("defaultOrgLoc")){var a={};return a.org=angular.fromJson(localStorage.getItem("defaultOrg")),a.orgLoc=angular.fromJson(localStorage.getItem("defaultOrgLoc")),a}return null},i.getLocationCategory=function(){if(null!==localStorage.getItem("locationCategory")){var a={};return a=angular.fromJson(localStorage.getItem("locationCategory"))}return null},i}]),angular.module("paripal.benchmarkChartDataModule").controller("BenchmarkChartParameterListCtrl",["$scope","$state","utilService","datatableconfig","serverSidePagination","commonConstants","BenchmarkChartParameterListService","httpService","urlService","$mdDialog","notify",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,b,c,d,e,f,g,h,i,j){a.WSBenchmarkChart={},a.requestType=f,a.cancel=function(){b.cancel()},a.init=function(){"view"==f&&(a.disableInput=!0),e&&i.getParameterById(e,function(b){a.WSBenchmarkChart=b},function(a){}),a.getParameterTypeList(),a.getTables()},a.getParameterTypeList=function(){i.getParameterTypeList(function(b){a.parameterTypeList=b},function(a){})},a.$watch("WSBenchmarkChart.tableName",function(b){b&&a.getColumns(b)}),a.getColumns=function(b){i.getColumnList(b,function(b){a.columnList=b},function(a){})},a.saveParameter=function(){"add"==a.requestType?i.getCreateBenchmarkParams(a.WSBenchmarkChart,function(a){j("success",a.successMessage),b.cancel(!0)},function(a){}):i.updateBenchmarkParams(a.WSBenchmarkChart,function(a){console.log(a),j("success",a.successMessage),b.cancel(!0)},function(a){})},a.getTables=function(){i.getTableList(function(b){a.tableList=b},function(a){})},a.getMeasurementIndicator=function(b){var c={};return c.measurementIndicatorName=b,g.getData(h.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",c),null,function(b){return a.indicatorAutoCmpLoading=!1,a.indicator=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.init()}l.$inject=["$scope","$mdDialog","$filter","baseService","parameterData","requestType","httpService","urlService","BenchmarkChartParameterListService","notify"],a.currentPage=f.defaultPageNo,a.itemPerPage=f.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WSBenchmarkChart={},a.commonConstants=f;var m=function(){a.getFilteredValues(),a.getParameterTypeList()};a.clear=function(){a.WSBenchmarkChart={}},a.getParameterTypeList=function(){g.getParameterTypeList(function(b){a.parameterTypeList=b},function(a){})},a.manageParameter=function(a,c){j.show({controller:l,templateUrl:"app/modules/benchmark-chart-data/views/manage-parameter-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{parameterData:c,requestType:a}}).then(function(a){},function(a){a&&b.reload()})},a.deleteParameter=function(a){g.deleteParameter(a,function(a){k("success",a.successMessage),b.reload()},function(a){})},a.getMeasurementIndicator=function(b){var c={};return c.measurementIndicatorName=b,h.getData(i.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",c),null,function(b){return a.indicatorAutoCmpLoading=!1,a.indicator=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.getFilteredValues=function(){g.getFilteredBenchmarkParams(a.WSBenchmarkChart,function(b){a.benchmarkChartParamList=b},function(a){})};/**
         *datatble config json
         */
var n=f.gridConfigurations;a.options=d.setOptionProperties(n),m()}]),angular.module("paripal.benchmarkChartDataModule").controller("IndicatorBenchmarkChartListCtrl",["$scope","$state","utilService","datatableconfig","serverSidePagination","commonConstants","BenchmarkChartParameterListService","httpService","urlService","$mdDialog","notify","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b,c,d,e,f,g,h,i,j,k){a.WSBenchmarkChart={},a.requestType=f,a.cancel=function(){b.cancel()},a.init=function(){"view"==f&&(a.disableInput=!0),"add"==f&&e&&(a.WSBenchmarkChart.measurementIndicator=e,a.disableIndicator=!0),g&&j.getIndicatorBenchmarkChartById(g,function(b){a.WSBenchmarkChart=b},function(a){})},a.$watch("WSBenchmarkChart.tableName",function(b){b&&a.getColumns(b)}),a.saveIndicatorBenchmarkChart=function(){"add"==a.requestType?j.getCreateIndicatorBenchmarkChart(a.WSBenchmarkChart,function(a){k("success",a.successMessage),b.cancel(!0)},function(a){}):j.updateIndicatorBenchmarkChart(a.WSBenchmarkChart,function(a){k("success",a.successMessage),b.cancel(!0)},function(a){})},a.getMeasurementIndicator=function(b){var c={};return c.measurementIndicatorName=b,h.getData(i.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",c),null,function(b){return a.indicatorAutoCmpLoading=!1,a.indicator=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.getBenchmarkChart=function(b){var c={};return c.name=b,h.getData(i.getParameterizedUrl("GET_ALL_BENCHMARK_CHARTS",c),null,function(b){return a.benchmarkChart=angular.fromJson(b.data)},function(a){})},a.init()}m.$inject=["$scope","$mdDialog","$filter","baseService","measurementIndicator","requestType","indicatorChartId","httpService","urlService","BenchmarkChartParameterListService","notify"],a.currentPage=f.defaultPageNo,a.itemPerPage=f.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WSBenchmarkChart={},a.commonConstants=f;var n=function(){l.indicator&&l.indicator.measurementIndicatorName&&l.indicator.id&&(a.WSBenchmarkChart.measurementIndicator={id:l.indicator.id,value:l.indicator.measurementIndicatorName}),a.getFilteredValues()};a.clear=function(){a.WSBenchmarkChart={}},a.addUserConditions=function(a){b.go("manageBenchmarkConditions",{data:a,test:"userMeasurement"})},a.manageIndicatorBenchmarkChart=function(c,d){j.show({controller:m,templateUrl:"app/modules/benchmark-chart-data/views/manage-indicator-chart-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{measurementIndicator:a.WSBenchmarkChart.measurementIndicator,requestType:c,indicatorChartId:d}}).then(function(a){},function(a){a&&b.reload()})},a.deleteIndicatorBenchmarkChart=function(a){g.deleteIndicatorBenchmarkChart(a,function(a){k("success",a.successMessage),b.reload()},function(a){})},a.getMeasurementIndicator=function(b){var c={};return c.measurementIndicatorName=b,h.getData(i.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",c),null,function(b){return a.indicatorAutoCmpLoading=!1,a.indicator=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.getBenchmarkChart=function(b){var c={};return c.name=b,h.getData(i.getParameterizedUrl("GET_ALL_BENCHMARK_CHARTS",c),null,function(b){return a.benchmarkChart=angular.fromJson(b.data)},function(a){})},a.getFilteredValues=function(){g.getFilteredIndicatorBenchmarkChartList(a.WSBenchmarkChart,function(b){a.indicatorBenchmarkChartList=b},function(a){})};/**
         *datatble config json
         */
var o=f.gridConfigurations;a.options=d.setOptionProperties(o),n()}]),angular.module("paripal.benchmarkChartDataModule").controller("ManageBenchmarkChartDataCtrl",["$scope","$state","utilService","datatableconfig","serverSidePagination","commonConstants","$stateParams","BenchmarkChartParameterListService","dateconvertor","$mdDialog",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){a.pageState=c.isFieldEmpty(b.params.type)?"add":b.params.type}a.currentPage=f.defaultPageNo,a.itemPerPage=f.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=f;var l=function(){k(),g.recordId&&g.fromPage&&g.clientId&&a.getBenchmarkChartTypeList(g.recordId,g.fromPage,g.clientId),a.initiateBarChart(),a.initiateTimeSeriesChart(),a.initiateLineChart()};a.cancel=function(){c.goBackToPrevState()},a.getBenchmarkChartData=function(){var b=a.WSBenchmarkChart.benchmarkChartType,c={};c.id=b.id,a.WSBenchmarkChart.whetherTrend?c.whetherTrend=a.WSBenchmarkChart.whetherTrend:c.whetherTrend=!1,a.WSBenchmarkChart.from&&(c.from=i.convertToServerDate(a.WSBenchmarkChart.from)),a.WSBenchmarkChart.till&&(c.till=i.convertToServerDate(a.WSBenchmarkChart.till)),g.clientId&&(c.userId=g.clientId),h.getBenchmarkChartData(c,g.fromPage,function(b){console.log(b),a.chartData=b.columnData,a.chartKeys=b.keys,a.variantKeys=b.variantKeys,"LINE"==b.chartType?a.initiateLineChart():"TIME_SERIES"==b.chartType?a.initiateTimeSeriesChart():a.initiateBarChart()},function(a){})},a.getBenchmarkChartTypeList=function(b,c,d){h.getBenchmarkChartType(b,c,d,function(b){a.benchmarkChartTypeList=b},function(a){})},a.initiateTimeSeriesChart=function(){if(a.chartData&&a.chartKeys){c3.generate({size:{height:600},padding:{top:20},title:{show:!0,text:a.WSBenchmarkChart.benchmarkChartType.benchmarkChart.value,position:"top-center"},bindto:"#bar1",data:{labels:!0,json:a.chartData,keys:a.chartKeys},subchart:{show:!0},axis:{x:{type:"timeseries",tick:{format:"%Y-%m-%d",rotate:90,fit:!0}}},legend:{/*show: scope.legend,*/
show:!0,position:"bottom"},zoom:{enabled:!0,rescale:!0},point:{r:2,focus:{expand:{enabled:!1}}}});angular.forEach(a.variantKeys,function(a,b){var c="c3-line-"+a.replace(/ /g,"-"),d="c3-circles-"+a.replace(/ /g,"-");$("."+c).addClass("c3-target-line-width-5"),$("."+d).children().attr("r",5)}),a.currentBar="bar1"}},a.initiateLineChart=function(){if(a.chartData&&a.chartKeys){c3.generate({title:{show:!0,text:a.WSBenchmarkChart.benchmarkChartType.benchmarkChart.value,position:"top-center"},bindto:"#bar1",data:{labels:!0,json:a.chartData,keys:a.chartKeys},subchart:{show:!0},axis:{x:{type:"line"}},legend:{/*show: scope.legend,*/
show:!0,position:"bottom"}});a.currentBar="bar1"}},a.initiateBarChart=function(){if(a.chartData&&a.chartKeys){c3.generate({title:{show:!0,text:a.WSBenchmarkChart.benchmarkChartType.benchmarkChart.value,position:"top-center"},bindto:"#bar",data:{type:"bar",labels:!0,json:a.chartData,keys:a.chartKeys},subchart:{show:!0},axis:{x:{extent:a.extentWidth,type:"category",label:{position:"inner-right"}},y:{label:{position:"outer-middle"}}},bar:{width:{ratio:.3}},legend:{/*show: scope.legend,*/
show:!0,position:"bottom"}});a.currentBar="bar"}},a.manageBenchmark=function(){b.go("managebenchmarkchartdata")},a.abc=function(){b.go("addbenchmarkparameterdata")},a.xyz=function(){b.go("addparameterdata")};/**
         *datatble config json
         */
var m=f.gridConfigurations;a.options=d.setOptionProperties(m),l()}]),angular.module("paripal.benchmarkChartDataModule").controller("ManageBenchmarkConditionsCtrl",["$scope","$state","$filter","httpService","urlService","$mdDialog","$mdMedia","notify","utilService","featurePrivilegeConstants","dateconvertor","$stateParams","$translate","commonConstants","associateFHService","$rootScope","BenchmarkChartParameterListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.benchmarkConditions={},a.benchmarkConditions.conditionEntityDef=null,a.dateObj={},a.paymentModes=[],a.isDateRquired=!1,a.currentDate=new Date,a.benchmarkConditions.conditionUIDef={},a.condition={},a.queryMetaData={entities:[{entityName:"User",entityId:"user",id:1},{entityName:"Professional",entityId:"professional",id:2}]};var r=function(){a.commonConstants=n,a.benchmarkConditions.conditionSubCategory="DEFAULT_CATEGORY",s()};a.onChangeWhetherCondition=function(){a.feeScheduleObj.whetherConditional?a.condition.open=!0:a.condition.open=!1},a.$on("form",function(b,c){a.conditionform=c.form});var s=function(){var b={category:"BENCHMARK",subCategory:"DEFAULT_CATEGORY"};o.getQueryBuilderColumnConf("GET_QUERY_BUILDER_GROUP_DEF",b,function(b){a.queryMetaData=b},function(a){}),o.getQueryBuilderColumnConf("GET_QUERY_BUILDER_ENTITY_DEF",b,function(b){a.entityFields=b},function(a){})};a.saveBenchmarkCondition=function(b){l.test&&(a.pageLink=l.test),l.data&&l.data.id&&(p.showSpinner=!0,a.benchmarkConditions.id=l.data.id,q.setBenchmarkCondition(a.benchmarkConditions,a.pageLink,function(a){p.showSpinner=!1,console.log(a)},function(a){p.showSpinner=!1}))},a.cancel=function(){i.goBackToPrevState()},r()}]),angular.module("paripal.benchmarkChartDataModule").controller("TestBenchmarkChartListCtrl",["$scope","$state","utilService","datatableconfig","serverSidePagination","commonConstants","BenchmarkChartParameterListService","httpService","urlService","$mdDialog","notify","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b,c,d,e,f,g,h,i,j,k,l){a.screenType=l,a.WSBenchmarkChart={},a.requestType=f,a.cancel=function(){b.cancel()},a.getTestPrescribed=function(b){a.testNameAutoCmp=!0;var c={searchString:b};return h.getData(i.getParameterizedUrl("GET_DIAGNOSTIC_TEST_LIST",c),null,function(b){return a.testNameAutoCmp=!1,a.countryData=angular.fromJson(b.data),a.countryData},function(b){a.testNameAutoCmp=!1})},a.init=function(){"view"==f&&(a.disableInput=!0),"add"==f&&e&&(a.WSBenchmarkChart.diagnosticTest=e,a.disableTest=!0),g&&(a.disableTest=!0,j.getTestBenchmarkChartById(g,function(b){a.WSBenchmarkChart=b},function(a){}))},a.$watch("WSBenchmarkChart.tableName",function(b){b&&a.getColumns(b)}),a.saveIndicatorBenchmarkChart=function(){"add"==a.requestType?j.getCreateTestBenchmarkChart(a.WSBenchmarkChart,function(a){k("success",a.successMessage),b.cancel(!0)},function(a){}):j.updateTestBenchmarkChart(a.WSBenchmarkChart,function(a){k("success",a.successMessage),b.cancel(!0)},function(a){})},a.getMeasurementIndicator=function(b){var c={};return c.measurementIndicatorName=b,h.getData(i.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",c),null,function(b){return a.indicatorAutoCmpLoading=!1,a.indicator=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.getBenchmarkChart=function(b){var c={};return c.name=b,h.getData(i.getParameterizedUrl("GET_ALL_BENCHMARK_CHARTS",c),null,function(b){return a.benchmarkChart=angular.fromJson(b.data)},function(a){})},a.init()}m.$inject=["$scope","$mdDialog","$filter","baseService","diagnosticTest","requestType","testChartId","httpService","urlService","BenchmarkChartParameterListService","notify","screenType"],a.currentPage=f.defaultPageNo,a.itemPerPage=f.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WSBenchmarkChart={},a.commonConstants=f,a.addUserConditions=function(a){b.go("manageBenchmarkConditions",{data:a,test:""})};var n=function(){l.test&&l.test.diagnosticTestName&&l.test.diagnosticTestId&&(a.WSBenchmarkChart.diagnosticTest={id:l.test.diagnosticTestId,value:l.test.diagnosticTestName}),a.getFilteredValues()};a.clear=function(){a.WSBenchmarkChart={}},a.getTestPrescribed=function(b){a.testNameAutoCmp=!0;var c={searchString:b};return h.getData(i.getParameterizedUrl("GET_DIAGNOSTIC_TEST_LIST",c),null,function(b){return a.testNameAutoCmp=!1,a.countryData=angular.fromJson(b.data),a.countryData},function(b){a.testNameAutoCmp=!1})},a.manageTestBenchmarkChart=function(a,c){if(l.test.diagnosticTestName&&l.test.diagnosticTestId){var d={};d.id=l.test.diagnosticTestId,d.value=l.test.diagnosticTestName,j.show({controller:m,templateUrl:"app/modules/benchmark-chart-data/views/manage-indicator-chart-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{diagnosticTest:d,requestType:a,testChartId:c,screenType:"diagnosticTest"}}).then(function(a){},function(a){a&&b.reload()})}},a.deleteTestBenchmarkChart=function(a){g.deleteTestBenchmarkChart(a,function(a){k("success",a.successMessage),b.reload()},function(a){})},a.getMeasurementIndicator=function(b){var c={};return c.measurementIndicatorName=b,h.getData(i.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",c),null,function(b){return a.indicatorAutoCmpLoading=!1,a.indicator=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.getBenchmarkChart=function(b){var c={};return c.name=b,h.getData(i.getParameterizedUrl("GET_ALL_BENCHMARK_CHARTS",c),null,function(b){return a.benchmarkChart=angular.fromJson(b.data)},function(a){})},a.getFilteredValues=function(){g.getFilteredTestBenchmarkChartList(a.WSBenchmarkChart,function(b){a.testBenchmarkChartList=b},function(a){})};/**
         *datatble config json
         */
var o=f.gridConfigurations;a.options=d.setOptionProperties(o),n()}]),angular.module("paripal.benchmarkChartDataModule").service("BenchmarkChartParameterListService",["httpService","$filter","urlService","dateconvertor","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f){"use strict";this.getParameterTypeList=function(b,d){a.getData(c.getUrl("GET_PARAMETER_TYPE"),null,function(a){b(a.data)},function(a){d(a)})},this.getTableList=function(b,d){a.getData(c.getUrl("GET_ALL_TABLES"),null,function(a){b(a.data)},function(a){d(a)})},this.getColumnList=function(b,d,e){var f={table:b};a.getData(c.getParameterizedUrl("GET_ALL_COLUMNS_BY_TABLE",f),null,function(a){d(a.data)},function(a){e(a)})},this.getFilteredBenchmarkParams=function(b,d,e){var f={};b.parameterName&&(f.parameterName=b.parameterName),b.parameterType&&(f.parameterType=b.parameterType),b.measurementIndicator&&(f.measurementIndicator=b.measurementIndicator),a.postData(c.getUrl("GET_FILTERED_BENCHMARK_PARAM"),f,function(a){d(a.data)},function(a){e(a)})},this.getFilteredIndicatorBenchmarkChartList=function(b,d,e){var f={};b.benchmarkChart&&(f.benchmarkChart=b.benchmarkChart),b.measurementIndicator&&(f.measurementIndicator=b.measurementIndicator),a.postData(c.getUrl("GET_FILTERED_INDICATOR_BENCHMARK_CHART_LIST"),f,function(a){d(a.data)},function(a){e(a)})},this.getFilteredTestBenchmarkChartList=function(b,d,e){var f={};b.benchmarkChart&&(f.benchmarkChart=b.benchmarkChart),b.diagnosticTest&&(f.diagnosticTest=b.diagnosticTest),a.postData(c.getUrl("FIND_CHART_TEST_MAPPINGS"),f,function(a){d(a.data)},function(a){e(a)})},this.getCreateBenchmarkParams=function(b,d,e){var f={};b.parameterName&&(f.parameterName=b.parameterName),b.parameterType&&(f.parameterType=b.parameterType,"OTHER_MEASUREMENT_INDICATOR"==b.parameterType&&b.measurementIndicator&&(f.measurementIndicator=b.measurementIndicator),"DEMOGRAPHIC"==b.parameterType&&b.tableName&&(f.tableName=b.tableName),"DEMOGRAPHIC"==b.parameterType&&b.columnName&&(f.columnName=b.columnName)),a.postData(c.getUrl("CREATE_BENCHMARK_PARAMETER"),f,function(a){d(a.data)},function(a){e(a)})},this.getCreateIndicatorBenchmarkChart=function(b,d,e){var f={};b.benchmarkChart&&(f.benchmarkChart=b.benchmarkChart,delete f.benchmarkChart.value,delete f.benchmarkChart.code),b.measurementIndicator&&(f.measurementIndicator=b.measurementIndicator,delete f.measurementIndicator.value,delete f.measurementIndicator.code),a.postData(c.getUrl("CREATE_INDICATOR_BENCHMARK_CHART"),f,function(a){d(a.data)},function(a){e(a)})},this.getCreateTestBenchmarkChart=function(b,d,e){var f={};b.benchmarkChart&&(f.benchmarkChart=b.benchmarkChart,delete f.benchmarkChart.value,delete f.benchmarkChart.code),b.diagnosticTest&&(f.diagnosticTest=b.diagnosticTest,delete f.diagnosticTest.value,delete f.diagnosticTest.code),a.postData(c.getUrl("CREATE_CHART_TEST_MAPPING"),f,function(a){d(a.data)},function(a){e(a)})},this.updateBenchmarkParams=function(b,d,e){var f={};b.parameterName&&(f.parameterName=b.parameterName),b.parameterType&&(f.parameterType=b.parameterType,"OTHER_MEASUREMENT_INDICATOR"==b.parameterType&&b.measurementIndicator&&(f.measurementIndicator=b.measurementIndicator),"DEMOGRAPHIC"==b.parameterType&&b.tableName&&(f.tableName=b.tableName),"DEMOGRAPHIC"==b.parameterType&&b.columnName&&(f.columnName=b.columnName)),b.id&&(f.id=b.id),b.version&&(f.version=b.version),a.putData(c.getUrl("UPDATE_BENCHMARK_PARAMETER"),f,function(a){d(a.data)},function(a){e(a)})},this.updateIndicatorBenchmarkChart=function(b,d,e){var f={};b.benchmarkChart&&(f.benchmarkChart=b.benchmarkChart,delete f.benchmarkChart.value,delete f.benchmarkChart.code),b.measurementIndicator&&(f.measurementIndicator=b.measurementIndicator,delete f.measurementIndicator.value,delete f.measurementIndicator.code),b.id&&(f.id=b.id),b.version&&(f.version=b.version),a.putData(c.getUrl("UPDATE_INDICATOR_BENCHMARK_CHART"),f,function(a){d(a.data)},function(a){e(a)})},this.updateTestBenchmarkChart=function(b,d,e){var f={};b.benchmarkChart&&(f.benchmarkChart=b.benchmarkChart,delete f.benchmarkChart.value,delete f.benchmarkChart.code),b.diagnosticTest&&(f.diagnosticTest=b.diagnosticTest,delete f.diagnosticTest.value,delete f.diagnosticTest.code),b.id&&(f.id=b.id),b.version&&(f.version=b.version),a.putData(c.getUrl("UPDATE_CHART_TEST_MAPPING"),f,function(a){d(a.data)},function(a){e(a)})},this.getParameterById=function(b,d,e){var f={id:b};a.getData(c.getParameterizedUrl("GET_PARAMETER_BY_ID",f),null,function(a){d(a.data)},function(a){e(a)})},this.getIndicatorBenchmarkChartById=function(b,d,e){var f={id:b};a.getData(c.getParameterizedUrl("GET_INDICATOR_BENCHMARK_CHART_BY_ID",f),null,function(a){d(a.data)},function(a){e(a)})},this.getTestBenchmarkChartById=function(b,d,e){var f={id:b};a.getData(c.getParameterizedUrl("FIND_CHART_TEST_MAPPINGS_BY_ID",f),null,function(a){d(a.data)},function(a){e(a)})},this.deleteParameter=function(b,d,e){var f={id:b};a.deleteData(c.getParameterizedUrl("DELETE_BENCHMARK_PARAMETER",f),null,function(a){d(a.data)},function(a){e(a)})},this.deleteIndicatorBenchmarkChart=function(b,d,e){var f={id:b};a.deleteData(c.getParameterizedUrl("DELETE_INDICATOR_BENCHMARK_CHART",f),null,function(a){d(a.data)},function(a){e(a)})},this.deleteTestBenchmarkChart=function(b,d,e){var f={id:b};a.deleteData(c.getParameterizedUrl("REMOVE_CHART_TEST_MAPPING",f),null,function(a){d(a.data)},function(a){e(a)})},this.getBenchmarkChartType=function(b,d,e,f,g){var h="";h="userMeasurement"==d?"GET_AVAILABLE_BENCHMARK_CHARTS":"GET_CHART_LIST_BY_TEST_ID";var b={id:b,clientId:e};a.getData(c.getParameterizedUrl(h,b),null,function(a){f(a.data)},function(a){g(a)})},this.getBenchmarkChartData=function(b,d,e,f){var g="";g="userMeasurement"==d?"GET_BENCHMARK_CHART_DATA":"GET_BENCHMARK_CHART_DATA_BY_TEST_ID";var h={mappingId:b.id};b.from&&(h.from=b.from),b.till&&(h.till=b.till),b.userId&&(h.userId=b.userId),h.whetherTrend=b.whetherTrend,a.postData(c.getUrl(g),h,function(a){e(a.data)},function(a){f(a)})},this.setBenchmarkCondition=function(b,d,e,f){var g="";g="userMeasurement"==d?"BENCHMARK_MEASUREMENT_CONDITION_ADD":"BENCHMARK_TEST_CONDITION_ADD";var h={mappingId:b.id};b.conditionDesc&&(h.conditionDesc=b.conditionDesc),b.conditionEntityDef&&(h.conditionEntityDef=b.conditionEntityDef),b.conditionUIDef&&(h.conditionUIDef=JSON.stringify(b.conditionUIDef)),b.sqlQueryWhereDef&&(h.sqlQueryWhereDef=b.sqlQueryWhereDef),b.conditionSubCategory&&(h.conditionSubCategory=b.conditionSubCategory),a.postData(c.getUrl(g),h,function(a){e(a.data)},function(a){f(a)})}}]),angular.module("paripal.benchmarkChartModule").controller("AddBenchmarkImageCtrl",["$scope","$mdDialog","userIdDocumentService","$rootScope","utilService","urlService","httpService","stateParams","$timeout",function(a,b,c,d,e,f,g,h,i){a.documentUploadFile=null,a.uploadDocumentObj={},a.loadListOfDocumentTypes=function(){d.showSpinner=!0;var b=f.getUrl("GET_DOCUMENT_TYPES");g.getData(b,null,function(b){a.documentTypeList=b.data.filter(function(a){return"BENCHMARK_CHART"==a.subType&&"MASTER"==a.type}),d.showSpinner=!1},function(a){d.showSpinner=!1})},a.$watch("uploadDocumentObj.fileName",function(b,c){e.isFieldEmpty(b)||(a.isFileNotimage=!b.match(/.(jpg|jpeg|png|gif)$/i))},!0),a.uploadForm=function(a,c){c.$valid&&a&&b.hide(a)},a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.init=function(){a.loadListOfDocumentTypes(),a.checkPageState()},a.checkPageState=function(){if("add"===h.type)a.pageState="add",a.uploadDocumentObj={};else{a.pageState=h.type;var b={};angular.copy(h.data,b),a.uploadDocumentObj.name=b.name,a.uploadDocumentObj.documentType=b.document.documentType,/* $scope.displayId = data.document.documentType.id;*/
a.uploadDocumentObj.fileIdentifier=b.document.fileIdentifier,a.uploadDocumentObj.fileToBeUploaded=b.document,a.uploadDocumentObj.fileName=b.document.fileName,a.uploadDocumentObj.id=b.id,a.uploadDocumentObj.version=b.version}},i(function(){angular.element(document.getElementById("DocType")).removeClass("ng-invalid")},300),a.init()}]),angular.module("paripal.benchmarkChartModule").controller("BenchmarkChartCtrl",["$scope","datatableconfig","$http","$mdDialog","utilService","httpService","urlService","notify","commonConstants","serverSidePagination","tabDataSwitchService","$timeout","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m){
//popup controller
function n(a,b,c,d,e,f,g){a.hide=function(){g.hide()},a.cancel=function(){g.cancel()},a.addInputObj={};var h=function(){a.checkPageState()};a.checkPageState=function(){"add"===f.type?(a.pageState="add",a.addInputObj={}):(a.pageState=f.type,angular.copy(f.data,a.addInputObj))},/* Create / edit / view benchmark */
a.createBenchmark=function(f){if(a.progress=!0,f.$valid)if(a.addInputObj.id){var g={};g.id=a.addInputObj.id,c.putData(d.getParameterizedUrl("UPDATE_BENCHMARK",g),a.addInputObj,function(c){b.isNullOrEmpty(c.data.message)&&(e("success",c.data.successMessage),a.cancel(),a.searchData())},function(b){a.progress=!1})}else c.postData(d.getUrl("CREATE_BENCHMARK"),a.addInputObj,function(c){b.isNullOrEmpty(c.messages)&&(e("success",c.data.successMessage),a.cancel(),a.searchData())},function(b){a.progress=!1});else a.progress=!1},h()}n.$inject=["$scope","utilService","httpService","urlService","notify","stateParams","$mdDialog"],a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.chartList=[];var o=function(){a.searchData()};a.divEnabled=!1,a.addinputpopup=function(b,c,e){d.show({scope:a,preserveScope:!0,controller:n,templateUrl:"app/modules/benchmark-chart/views/popup-add-benchmark.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:i.dialogBox.clickOutsideToClose,locals:{stateParams:{type:e,data:b}}})},/**
             *search Data functionality
             */
a.searchData=function(){var b={};a.BenchmarkListSpinner=!0,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,f.postData(g.getUrl("GET_BENCHMARK"),b,function(b){a.BenchmarkListSpinner=!1;var c={};c=angular.fromJson(b.data),a.totalItems=c.totalRecords,a.chartList=c.data,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.BenchmarkListSpinner=!1})},/*Benchmark Item Chart*/
a.benchmarkItem=function(a){k.setData(a),l(function(){var a=document.getElementById("next");angular.element(a).triggerHandler("click")},0),m.$broadcast("callManageBenchmarkController")},a.pageChanged=function(b){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};/**
             *datatble config json
             */
var p=i.gridConfigurations;a.options=b.setOptionProperties(p),o()}]),angular.module("paripal.benchmarkChartModule").controller("BenchmarkImageListCtrl",["$scope","datatableconfig","$http","$mdDialog","utilService","httpService","urlService","notify","commonConstants","serverSidePagination","manageAttachmentService","fileOperations",function(a,b,c,d,e,f,g,h,i,j,k,l){a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.chartList=[],a.filterObject={};var m=function(){a.loadBenchmarkChartList()};a.manageChartImage=function(b,c,f){e.isEmpty(b)||(a.previousDocumentId=b.document.id),a.pageState=f,d.show({controller:"AddBenchmarkImageCtrl",templateUrl:"app/modules/benchmark-chart/views/popup-add-benchmark-image.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:i.dialogBox.clickOutsideToClose,locals:{stateParams:{type:f,data:b}}}).then(function(b){a.saveDocumentIdInDocumentTable(b)})},a.saveDocumentIdInDocumentTable=function(b){if(!e.isEmpty(b)){a.fileUploadSpinner=!0;var c={};c.fileName=b.fileName,c.fileIdentifier=b.fileIdentifier,c.documentType=b.documentType,e.isFieldEmpty(a.previousDocumentId)||(c.id=a.previousDocumentId),/**[TODO] : Change pagestate [NKL]
                     */
k.saveDocumentDetails(c,a.pageState,function(c){a.manageUserTestSpiner=!1,b&&a.uploadFile(b,c)},function(){a.fileUploadSpinner=!1,a.manageUserTestSpiner=!1})}},a.uploadFile=function(b,c){var d=new Object;d.file=b.fileToBeUploaded,d.docType=b.documentType.type,d.docSubType=b.documentType.subType,e.isNullOrEmpty(c.response)||(d.resourceId=c.response),l.uploadFile(d,function(d){var e=c.response;a.saveBenchmarkChartImage(b,e)},function(b){a.fileUploadSpinner=!1,h("Error",$translate.instant("ERROR_WHILE_UPLOADING"))})},a.saveBenchmarkChartImage=function(b,c){var d={};d={name:b.name,document:{id:c}},b.id?(d.id=b.id,d.version=b.version,f.putData(g.getParameterizedUrl("UPDATE_BENCHMARKCHART_IMAGE",b),d,function(b){e.isNullOrEmpty(b.data.message)&&(a.fileUploadSpinner=!1,h("success",b.data.successMessage),a.loadBenchmarkChartList())},function(b){a.fileUploadSpinner=!1,a.progress=!1})):f.postData(g.getUrl("CREATE_BENCHMARKCHART_IMAGE"),d,function(b){a.fileUploadSpinner=!1,b.data.successMessage&&(h("success",b.data.successMessage),a.loadBenchmarkChartList())},function(b){a.fileUploadSpinner=!1})},a.loadBenchmarkChartList=function(){var b={};angular.copy(a.filterObject,b),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,a.BenchmarkListSpinner=!0,f.postData(g.getUrl("GET_ALL_BENCHMARKCHART_IMAGES"),b,function(b){a.BenchmarkListSpinner=!1,a.chartImageList=b.data.data,a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.BenchmarkListSpinner=!1})},a.downloadFile=function(a){if(!e.isEmpty(a)){var b=new Object;b.fileName=a.fileName,b.resourceId=a.id,b.docType=a.documentType.type,b.docSubType=a.documentType.subType,l.downloadFile(b,function(a){},function(a){})}},a.viewPrintFile=function(b,c){if(!e.isEmpty(c)){var d=new Object;d.fileName=c.fileName,d.resourceId=c.id,d.docType=c.documentType.type,d.docSubType=c.documentType.subType,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!0}},a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.loadBenchmarkChartList()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.loadBenchmarkChartList()};var n=i.gridConfigurations;a.options=b.setOptionProperties(n),m()}]),angular.module("paripal.benchmarkChartModule").controller("ManageBenchmarkChartCtrl",["$scope","datatableconfig","$http","$mdDialog","tabDataSwitchService","utilService","httpService","urlService","notify","commonConstants","serverSidePagination","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l){
//popup controller
function m(a,b,c,d,e,f,g){a.hide=function(){g.hide()},a.cancel=function(){g.cancel()},a.addItemObj={},a.addItemObj.benchmarkChart={},a.addItemObj.benchmarkChart=f.data;var h=function(){a.checkPageState()};a.checkPageState=function(){"add"===f.type?(a.pageState="add",a.addInputObj={}):(a.pageState=f.type,angular.copy(f.data,a.addItemObj))},/* Create / edit / view benchmark */
a.createBenchmark=function(f){a.progress=!0;var g={};if(angular.copy(a.addItemObj,g),g.benchmarkChart.value=g.benchmarkChart.name,delete g.benchmarkChart.name,delete g.benchmarkChart.version,g.id){var h={};h.id=g.id,delete a.addItemObj.benchmarkChart.count,c.putData(d.getParameterizedUrl("UPDATE_BENCHMARK_ITEM",h),a.addItemObj,function(c){b.isNullOrEmpty(c.data.message)&&(e("success",c.data.successMessage),a.cancel(),a.searchData())},function(b){a.progress=!1})}else c.postData(d.getUrl("CREATE_BENCHMARK_ITEM"),g,function(c){b.isNullOrEmpty(c.messages)&&(e("success",c.data.successMessage),a.cancel(),a.searchData())},function(b){a.progress=!1})},h()}m.$inject=["$scope","utilService","httpService","urlService","notify","stateParams","$mdDialog"],a.filterObject={},a.commanConstants=j,a.currentPage=j.defaultPageNo,a.itemPerPage=j.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.chartList=[],a.totalItems={};var n=function(){var b=e.getData();f.isEmpty(b)||(a.filterObject.benchmarkChart=b,a.filterObject.benchmarkChart.value=b.name,a.searchData())};/**
             *Get Benchmark Name name on autocomplete
             */
a.getBenchmarkChart=function(b){a.benchmarkChartAutoCmp=!0;var c={},d=[];return c.name=b,g.getData(h.getParameterizedUrl("FIND_BENCHMARK_BY_NAME",c),null,function(b){return a.benchmarkChartAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.benchmarkChartAutoCmp=!1})},a.addinputpopup=function(b,c,e){d.show({scope:a,preserveScope:!0,controller:m,templateUrl:"app/modules/benchmark-chart/views/popup-add-input-for-manage-benchmark.html",parent:angular.element(document.body),targetEvent:event,clickOutsideToClose:j.dialogBox.clickOutsideToClose,locals:{stateParams:{type:e,data:b}}})},/*
             *search Data functionality
             */
a.searchData=function(){if(a.filterObject.benchmarkChart){var b={};a.BenchmarkItemListSpinner=!0,a.filterObject.benchmarkChart.id&&(b.id=a.filterObject.benchmarkChart.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,g.postData(h.getUrl("GET_BENCHMARK_ITEM"),b,function(b){a.BenchmarkItemListSpinner=!1;var c={};c=angular.fromJson(b.data),a.totalItems=c.totalRecords,a.chartList=c.data,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.BenchmarkItemListSpinner=!1})}},a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},l.$on("callManageBenchmarkController",function(){n()});/**
                 *datatble config json
                 */
var o=j.gridConfigurations;a.options=b.setOptionProperties(o),n()}]),angular.module("paripal.benchmarkChartModule").service("tabDataSwitchService",[function(){"use strict";this.setData=function(a){this.rowObj=a},this.getData=function(){return this.rowObj}}]),/**
 * Creating Register controller for registering user in to system
 *
 */
angular.module("paripal.billingSetupModule").controller("CreateUserSubscriptionCtrl",["$scope","$state","registerService","utilService","notify","$translate","authenticationService","baseService","$rootScope","dateconvertor","httpService","urlService","EmergencyTransactionService","ManageOrgSubscriptionService","$filter","$mdDialog","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.user={},a.sysOrgList=[],a.languageList=[],i.showSpinner=!1,a.guardian={},a.currentDate=new Date,a.individualUserSubscriptionForm={},/***************************** Individual user sign up Functionality ********************************************/
a.individualUserSubscription=function(b){i.showSpinner=!0,a.setMsgOrganizationLocationId("1"),a.validTillDate&&(b.validTillDate=a.validTillDate),c.individualUserSubscription(b,a.userDetails,function(b){i.showSpinner=!1,d.isNullOrEmpty(b.successMessage)||(e("success",f.instant(b.successMessage)),b.response.transactionId?a.paymentMethod(b.response.transactionId):d.goBackToPrevState())},function(a){i.showSpinner=!1})},a.paymentMethod=function(a){if(a){var c={transactionId:a};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"USER_SUBSCRIPTION"})),m.getWhetherBillDetails(c,function(c){b.go("billsummaryview",{transactionId:a})},function(a){var b="FEE_TYPE_NOT_FOUND_TITLE",c="FEE_TYPE_NOT_FOUND_BODY";p.confirm().title(f.instant(b)).textContent(f.instant(c)).ok(f.instant("OK")).cancel(f.instant("CANCEL"))},{handleError:!1})}},a.onCancelClick=function(){d.goBackToPrevState()},a.loadListOfOrganizations=function(){c.loadListOfOrganizations(function(b){d.isEmpty(b)||(a.sysOrgList=b)},function(a){})},a.loadListOfOrganizations(),a.getSponsorOrganizations=function(b){var c={};c.keyword=b;var d=l.getParameterizedUrl("FIND_SPONSOR_ORGANIZATIONS_BY_KEYWORD",c);return k.getData(d,null,function(b){return b&&b.data&&(a.sponsorOrganizations=angular.fromJson(b.data)),a.sponsorOrganizations},function(a){})},a.cancel=function(){d.goBackToPrevState()},a.subscriptionFor=function(){c.subscriptionFor(function(b){d.isEmpty(b)||(a.forSubscriptions=b,angular.forEach(a.forSubscriptions,function(b,c){"SUBSCRIPTION_TYPE_INDIVIDUAL"==b.code&&(a.subscriptionForId=b)}))},function(a){})},a.subscriptionFor(),a.sysOrgSelected=function(b){var c={};c.sysOrgId=b,c.subscriptionForId=a.subscriptionForId.id,a.selectedFranchise=b;var d=l.getParameterizedUrl("FIND_SUBSCRIPTION_TYPES",c);k.getData(d,null,function(b){b&&b.data&&(a.subscriptionTypeList=angular.fromJson(b.data))},function(a){})},a.orgSelected=function(b){a.individualOrganization=b.value},a.sponsorSelected=function(b,c,d){a.sponsorOrg=b},a.whetherSubscriberClicked=function(b){b&&(a.user.signUp.whetherSponsored&&(a.user.signUp.whetherSponsored=!1),a.individualUserSignUpForm.sponsorOrganization&&(a.individualUserSignUpForm.sponsorOrganization=null),a.sponsorOrg&&(a.sponsorOrg=null))},a.whetherSponsoredClicked=function(b){b&&(a.individualUserSubscriptionForm.sponsorOrganization&&(a.individualUserSubscriptionForm.sponsorOrganization=null),a.individualUserSignUpForm.sponsorOrganization=null,a.sponsorOrg=null)},a.getSubscriptionTypeById=function(b){a.user.signUp.subscriptionFrom="",a.user.signUp.subscriptionTill="",a.subscriptionTypeId=angular.fromJson(b).id,n.getSubscriptionTypeById(a.subscriptionTypeId,function(b){a.WSSubscriptionType=b,a.noOfValidDays=a.WSSubscriptionType.noOfValidDays})},a.$watch("user.signUp.subscriptionFrom",function(b){b&&(a.validTillDate=n.validFromChanged(a.user.signUp.subscriptionFrom,a.noOfValidDays),a.user.signUp.subscriptionTill=a.validTillDate)},!0),a.viewSubscriptionTypeServices=function(b){a.WSSubscriptionType.subscriptionTypeServiceses.length>0?p.show({scope:a,preserveScope:!0,controller:viewSubscriptionServices,templateUrl:"app/modules/billing-setup/views/view-subscription-type-services.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:commonConstants.dialogBox.clickOutsideToClose}):e("warning",f.instant("NO_SERVICES_IN_SELECTED_SUBSCRIPTION_TYPE"))},a.getUserDetails=function(){a.userDetails=h.getLoggedInUser(),a.user={},a.user.signUp={},a.user.signUp.firstName=a.userDetails.firstName,a.user.signUp.lastName=a.userDetails.lastName,a.user.signUp.mobile=a.userDetails.cell1,a.user.signUp.email=a.userDetails.email1,a.individualUserSignUpForm={},a.individualUserSignUpForm.birthDate=o("date")(a.userDetails.birthDate,"dd-MM-yyyy")},a.getUserDetails()}]),angular.module("paripal.billingSetupModule").controller("CurrencyExchangeListCtrl",["$scope","datatableconfig","$state","utilService","commonConstants","featurePrivilegeConstants","CurrencyExchangeListService","serverSidePagination","dataSettingsService","$rootScope","$mdDialog","ManageExchangeRateService","notify",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b){function c(){d.isFieldEmpty(a.currencyList)&&(a.currencyList=[],l.getCurrencyList(function(b){a.sourceCurrencyList=[],a.targetCurrencyList=[],e=b,angular.copy(b,a.sourceCurrencyList),angular.copy(b,a.targetCurrencyList)}))}a.WSCurrencyExchangeRate={},a.WSCurrencyExchangeRate.organization={},a.WSCurrencyExchangeRate.organizationLocation={};var e=[];a.changeTargetCurrencyList=function(b,c){a.targetCurrencyList="targetCurrency"===c?angular.copy(e):a.targetCurrencyList,a.sourceCurrencyList="sourceCurrency"===c?angular.copy(e):a.sourceCurrencyList;var d=e.map(function(a){return a.id}).indexOf(b.id);"sourceCurrency"===c&&a.targetCurrencyList.splice(d,1),"targetCurrency"===c&&a.sourceCurrencyList.splice(d,1)},c(),a.setExchangeRate=function(b){b.$valid&&(a.manageFeeHeadSpinner=!0,l.setExchangeRate(a.WSCurrencyExchangeRate,function(b){a.manageFeeHeadSpinner=!1,m("success",b.data.successMessage),a.hide()},function(){a.manageFeeHeadSpinner=!1}))},a.hide=function(){k.hide()},a.cancel=function(){k.cancel()}}a.commonConstants=e,a.filterCriteria={},a.filterCriteria.organization={},a.filterCriteria.orgLocation={},a.todaysDate=new Date,a.currencyFrom={queryUrl:"GET_CURRENCY_BY_TYPE",queryParameter:{currencyType:"source"},jsonParameter:{}},a.currencyTo={queryUrl:"GET_CURRENCY_BY_TYPE",queryParameter:{currencyType:"target"},jsonParameter:{}},/*
     * For Pagination defaults value
     * Default records per page
     */
a.currentPage=e.defaultPageNo,a.itemPerPage=e.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var o=function(){a.searchData()};a.searchData=function(){a.exchangeRateListSpinner=!0,g.searchData(a.filterCriteria,a.currentPage,a.itemPerPage,function(b){a.exchangeRateList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.exchangeRateListSpinner=!1},function(){a.exchangeRateListSpinner=!1})},a.manageCurrencyExchangeRate=function(b,c,d){n(c),a.pageState=c,g.manageCurrencyExchangeRate(b,c,d,a,function(){a.searchData()},function(){},function(){})},a.clear=function(){c.reload()},/***** Code for popup *****/
/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},o();/* Data table configurations */
var p=e.gridConfigurations;a.options=b.setOptionProperties(p)}]),angular.module("paripal.billingSetupModule").controller("FeeHeadListCtrl",["$scope","datatableconfig","$state","utilService","commonConstants","featurePrivilegeConstants","FeeHeadListService","serverSidePagination","dataSettingsService","$rootScope",function(a,b,c,d,e,f,g,h,i,j){a.commonConstants=e,a.filterCriteria={},a.filterCriteria.orgCategory="SERVICE_PROVIDER",a.orgLocParams={},a.disableOrgLoc=!0,a.status={open:!0},/*
     * For Pagination defaults value
     * Default records per page
     */
a.currentPage=e.defaultPageNo,a.itemPerPage=e.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var k=function(){a.setParamObject(),a.searchData(),i.getOrganizationCategory(function(b){a.organizationCategoryList=b})};a.setParamObject=function(){if(d.isFieldEmpty(a.filterCriteria.orgCategory)||(a.orgLocParams.orgCategory=a.filterCriteria.orgCategory),!d.isFieldEmpty(j.loggedInUserDetails)){var b=j.loggedInUserDetails.userOrganizationCategoryType,c=a.filterCriteria.orgCategory;"ANY"===b&&"SERVICE_PROVIDER"===c?a.disableOrgLoc=!1:"SYSTEM"===b&&"FRANCHISER"===c?a.disableOrgLoc=!1:a.disableOrgLoc=!0}},a.searchData=function(){j.showSpinner=!0,g.searchData(a.filterCriteria,a.currentPage,a.itemPerPage,function(b){a.feeHeadList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),j.showSpinner=!1},function(){j.showSpinner=!1})},a.addFeeHead=function(a){c.go("managefeehead",{type:"add"})},a.manageFeeHead=function(b,c,d){j.showSpinner=!0,g.manageFeeHead(b,c,d,function(){a.searchData()},function(){j.showSpinner=!1},function(){j.showSpinner=!1})},a.clear=function(){c.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},k();/* Data table configurations */
var l=e.gridConfigurations;a.options=b.setOptionProperties(l)}]),angular.module("paripal.billingSetupModule").controller("FeeTypeFeeScheduleCtrl",["$scope","$rootScope","commonConstants","datatableconfig","httpService","urlService","serverSidePagination","$stateParams","utilService","FeeTypeFeeScheduleService","$state","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.getFeeSchedules(!1),i.isFieldEmpty(h.data)||(a.a.feeTypeCode=h.data.feeTypeCode)}a.commonConstants=c,a.feeScheduleList=[],a.WSFeeTypeFeeSchedule={},a.a={},a.WSFeeTypeFeeSchedule.whetherPermanent="false";var n,o=[];a.changePriority=function(b,c,d){a.feeScheduleList.splice(b,1),a.newIndex=null,"up"===d&&(a.newIndex=b-1),"down"===d&&(a.newIndex=b+1),a.feeScheduleList.splice(a.newIndex,0,c),a.enableSave=!0,angular.equals(a.feeScheduleList,o)&&(a.enableSave=!1)},a.sortableOptions={stop:function(b,c){var d=[];angular.forEach(a.feeScheduleList,function(a,b){a.prioritySequence=n+b,d.push(a)}),a.feeScheduleList=d,a.enableSave=!angular.equals(a.feeScheduleList,o)},activate:function(){},update:function(){}},a.savePriority=function(){j.savePriorityChanges(a.feeScheduleList,n,l)},a.getFeeSchedules=function(b){/*$scope.feeTypefeeScheduleSpinner = true;*/
j.getFeeSchedules(h,b,function(b){a.feeTypefeeScheduleSpinner=!1,a.WSFeeTypeFeeSchedule.residualFeeScheduleName=b.residualFeeScheduleName,i.isFieldEmpty(b.feeSchedules)||(n=b.feeSchedules[0].prioritySequence),angular.copy(b.feeSchedules,o),angular.copy(b.feeSchedules,a.feeScheduleList)},function(){a.feeTypefeeScheduleSpinner=!1})},a.cancel=function(){l.cancel()},m(),a.back=function(){i.goBackToPrevState()};/* Data table configurations */
var p=c.gridConfigurations;a.options=d.setOptionProperties(p)}]),angular.module("paripal.billingSetupModule").controller("FeeTypeListCtrl",["$scope","datatableconfig","$state","utilService","commonConstants","featurePrivilegeConstants","FeeTypeListService","serverSidePagination","dataSettingsService","$rootScope","$mdDialog","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.commonConstants=e,a.filterCriteria={},a.orgLocParams={},a.disableOrgLoc=!0,/*
     * For Pagination defaults value
     * Default records per page
     */
a.currentPage=e.defaultPageNo,a.itemPerPage=e.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var n=function(){a.setParamObject(),a.searchData(),i.getOrganizationCategory(function(b){a.organizationCategoryList=b})};a.setParamObject=function(){if(d.isFieldEmpty(a.filterCriteria.orgCategory)||(a.orgLocParams.orgCategory=a.filterCriteria.orgCategory),!d.isFieldEmpty(j.loggedInUserDetails)){var b=j.loggedInUserDetails.userOrganizationCategoryType,c=a.filterCriteria.orgCategory;"ANY"===b&&"SERVICE_PROVIDER"===c?a.disableOrgLoc=!1:"SYSTEM"===b&&"FRANCHISER"===c?a.disableOrgLoc=!1:a.disableOrgLoc=!0}},a.changePriority=function(b,c,d){j.showSpinner=!0,a.feeTypeList.splice(b,1),a.newIndex=null,"up"===d&&(a.newIndex=b-1),"down"===d&&(a.newIndex=b+1),a.feeTypeList.splice(a.newIndex,0,c),j.showSpinner=!1},a.setOrgLocId=function(){a.orgLocId=a.filterCriteria.orgLoc.data.id},a.searchData=function(){j.showSpinner=!0,g.searchData(a.filterCriteria,a.currentPage,a.itemPerPage,function(b){a.feeTypeList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),j.showSpinner=!1},function(){j.showSpinner=!1})},a.addFeeType=function(a){c.go("managefeetype",{type:"add"})},a.viewAssociatedFeeSchedules=function(a){c.go("feeschedulesearch",{data:{feeTypeId:a.id,feeTypeCode:a.feeTypeCode},callingUrl:"/feetypelist"})},a.viewFeeSchedules=function(b){/*$state.go('feetypefeeschedule', {
            data: {
                feeTypeId: feeTypeId
            }
        });*/
k.show({controller:"FeeTypeFeeScheduleCtrl",templateUrl:"app/modules/billing-setup/views/fee-type-fee-schedule.html",locals:{$stateParams:{data:{feeTypeId:b.id,feeTypeCode:b.feeTypeCode}}},parent:angular.element(document.body),clickOutsideToClose:e.dialogBox.clickOutsideToClose}).then(function(){a.searchData()},function(){})},a.manageFeeType=function(a,b,c){j.showSpinner=!0,g.manageFeeType(a,b,c,function(){j.showSpinner=!1},function(){j.showSpinner=!1})},a.isEditable=function(a){if(!d.isFieldEmpty(a)&&"object"==typeof a)/*else if (row.whetherActive && row.whetherResidualAvailable) {
                           return false;
                       }*/
return!(a.whetherActive||!a.whetherResidualAvailable)||(l("warning",m.instant("LINK_RESIDUAL_FEE_SCHEDULE")),!1)},a.clear=function(){c.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},n();/* Data table configurations */
var o=e.gridConfigurations;a.options=b.setOptionProperties(o)}]),angular.module("paripal.billingSetupModule").controller("IndividualSubscriptionListCtrl",["$scope","datatableconfig","$state","commonConstants","featurePrivilegeConstants","OrgSubscriptionListService","serverSidePagination","$rootScope","IndividualSubscriptionListService",function(a,b,c,d,e,f,g,h,i){a.commonConstants=d,a.filterCriteria={},a.orgLocParams={},a.disableOrgLoc=!0,/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=d.defaultPageNo,a.itemPerPage=d.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var j=function(){f.getAllStatuses(function(b){a.statuses=b}),a.searchData(),$(".modal-backdrop").removeClass("modal-backdrop")};a.searchData=function(){h.showSpinner=!0,i.searchData(a.filterCriteria,a.currentPage,a.itemPerPage,function(b){a.organizationList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),h.showSpinner=!1})},a.manageIndividualSubscription=function(){c.go("createUserSubscription")},a.clear=function(){c.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};/* Data table configurations */
var k=d.gridConfigurations;a.options=b.setOptionProperties(k),j()}]),angular.module("paripal.billingSetupModule").controller("ManageFeeHeadCtrl",["$scope","utilService","commonConstants","$stateParams","notify","FeeHeadListService","ManageFeeHeadService","$state","$translate","$mdDialog","featurePrivilegeConstants","$rootScope","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.featurePrivilegeConstants=k,a.commonConstants=c,a.WSFeeHead={},a.WSFeeHead.organization={},a.WSFeeHead.organizationLocation={};var n=!1;a.onBehalfOfParams={category:"SERVICE_PROVIDER"},a.onBehalfOf={url:"GET_ON_BEHALF_OF",queryParameter:{},jsonParameter:{}};var o=function(){if(p(),"add"===a.pageState){var c=m.getDefaultOrgLocation();b.isFieldEmpty(c)||(a.WSFeeHead.organization={data:c.org},a.WSFeeHead.organizationLocation={data:c.orgLoc},a.WSFeeHead.onBehalfOfId={data:c.orgLoc},a.setOnBehalfOfSelectedFlag(a.WSFeeHead.onBehalfOfId))}};a.setOrgLocId=function(){a.orgLocId=a.WSFeeHead.organization.data.id};var p=function(){a.pageState=null===d.type?"add":d.type,"edit"!==a.pageState&&"view"!==a.pageState||(a.WSFeeHead=g.setFeeHeadData(d.data))};a.setOnBehalfOf=function(){n||angular.copy(a.WSFeeHead.organizationLocation,a.WSFeeHead.onBehalfOfId)},a.setOnBehalfOfSelectedFlag=function(b){b!=a.WSFeeHead.organizationLocation&&(n=!0)},a.createFeeHead=function(b){b.$valid&&(l.showSpinner=!0,g.createFeeHead(a.WSFeeHead,function(b){l.showSpinner=!1,a.cancel()},function(){l.showSpinner=!1}))},a.hide=function(){j.hide()},a.cancel=function(){b.goBackToPrevState()},o()}]),angular.module("paripal.billingSetupModule").controller("ManageFeeTypeCtrl",["$scope","utilService","commonConstants","$stateParams","notify","FeeTypeListService","ManageFeeTypeService","$state","$translate","featurePrivilegeConstants","$rootScope","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.featurePrivilegeConstants=j,a.commonConstants=c,a.WSFeeType={},a.WSFeeType.organization={},a.WSFeeType.organizationLocation={},a.WSFeeType.autoRefundEnabled=!1;var m=function(){if(n(),"add"===a.pageState){var c=l.getDefaultOrgLocation();b.isFieldEmpty(c)||(a.WSFeeType.organization={data:c.org},a.WSFeeType.organizationLocation={data:c.orgLoc},a.setOrgLocId())}},n=function(){a.pageState=null===d.type?"add":d.type,"edit"!==a.pageState&&"view"!==a.pageState||(a.WSFeeType=g.setFeeTypeData(d.data),a.setOrgLocId())};a.setOrgLocId=function(){a.orgLocId=a.WSFeeType.organizationLocation.data.id},a.createFeeType=function(c){c.$valid&&(k.showSpinner=!0,b.isFieldEmpty(a.WSFeeType.serviceType)&&(a.WSFeeType.serviceGroup=null),g.createFeeType(a.WSFeeType,function(b){k.showSpinner=!1,a.back()},function(){k.showSpinner=!1}))},a.back=function(){b.goBackToPrevState()},m()}]),angular.module("paripal.billingSetupModule").controller("ManageOrgSubscriptionCtrl",["$scope","utilService","commonConstants","$stateParams","notify","ManageOrgSubscriptionService","OrgSubscriptionListService","$state","$translate","$mdDialog","datatableconfig","$rootScope","EmergencyTransactionService","commonBillingService","baseService","ManageSubscriptionTypeService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.commonConstants=c,a.WSOrgSubscription={},a.WSOrgSubscription.subscriptionFor={};var q=function(){s(),g.getSystemOrganizations(function(b){a.systemOrgList=b})};a.org={queryUrl:"GET_SUBSCRIBER_ORGANIZATIONS",queryParameter:{},jsonParameter:{}},a.getServiceTypeList=function(){a.subscriptionTypeList=[];var b=angular.fromJson(a.WSOrgSubscription.subscribedTo).id;b&&angular.fromJson(a.WSOrgSubscription.subscriptionFor).id&&g.getSubscriptionType(b,angular.fromJson(a.WSOrgSubscription.subscriptionFor).id,function(b){a.subscriptionTypeList=b})},a.getSubscriptionTypeById=function(b){"add"==a.pageState&&(a.WSOrgSubscription.subscriptionFrom="",a.WSOrgSubscription.subscriptionTill=""),a.subscriptionTypeId=angular.fromJson(b).id,f.getSubscriptionTypeById(a.subscriptionTypeId,function(b){a.WSSubscriptionType=b,a.noOfValidDays=a.WSSubscriptionType.noOfValidDays})},a.cancelSubscription=function(){l.showSpinner=!0,f.cancelSubscripiton(a.WSOrgSubscription,function(a){l.showSpinner=!1})};var r=function(){p.getListOfSubscriptionForByOrgId(a.WSOrgSubscription.organization.id,function(b){a.subscriptionForList=b},function(a){})};a.$watch("WSOrgSubscription.organization",function(a){a&&a.id&&r()},!0),a.$watch("WSOrgSubscription.subscriptionFor",function(b){b&&b.id&&a.WSOrgSubscription.subscribedTo&&a.getServiceTypeList()},!0),a.$watch("WSOrgSubscription.subscribedTo",function(b){b&&b.id&&a.WSSubscriptionType.subscriptionFor&&a.getServiceTypeList()},!0),a.close=function(){j.cancel()},a.viewSubscriptionTypeServices=function(b){if(a.WSSubscriptionType.subscriptionTypeServiceses.length>0)j.show({scope:a,preserveScope:!0,templateUrl:"app/modules/billing-setup/views/view-subscription-type-services.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:c.dialogBox.clickOutsideToClose,locals:{WSSubscriptionType:a.WSSubscriptionType}});else{var d=j.alert().title(i.instant("DETAILS")).htmlContent('<div class="padding-t-10"><b>'+i.instant("USER_LIMIT")+": </b>"+a.WSSubscriptionType.userLimit+"</div>").ok(i.instant("OK"));j.show(d).then(function(){},function(){})}},a.validFromChanged=function(b){a.WSOrgSubscription.subscriptionTill=f.validFromChanged(b,a.noOfValidDays)};var s=function(){if(a.pageState=null===d.type?"add":d.type,a.todaysDate=new Date,"edit"===a.pageState||"view"===a.pageState){var c=f.setOrgSubscriptionData(d.data);b.isFieldEmpty(c.WSOrgSubscription.subscriptionFrom)||(a.todaysDate=b.dateComparator(a.todaysDate,c.WSOrgSubscription.subscriptionFrom,"lt")?a.todaysDate:c.WSOrgSubscription.subscriptionFrom),a.WSOrgSubscription=c.WSOrgSubscription,a.WSOrgSubscriptionData=c.WSOrgSubscriptionData,a.transactionId=c.WSOrgSubscription.transactionId,a.getServiceTypeList(),a.getSubscriptionTypeById(a.WSOrgSubscription.subscriptionType)}else{var e=o.getDefaultOrgLocation();b.isFieldEmpty(e)||(a.WSOrgSubscription.organization=e.org)}};a.subscribeOrg=function(b){b.$valid&&(l.showSpinner=!0,f.subscribeOrg(a.WSOrgSubscription,function(b){if(l.showSpinner=!1,a.transactionId=b.data.response.transactionId,"SYSTEM"===o.getLoggedInUser().userOrganizationCategoryType||"PRODUCT"===o.getLoggedInUser().userOrganizationCategoryType){var c=[a.transactionId];n.generateBill(c,function(b){e("success",b.successMessage),a.billId=b.response},function(a){})}a.pageState="view"}))},a.paymentCall=function(d){if(b.isFieldEmpty(d)&&(d={transactionId:a.transactionId}),"SYSTEM"===o.getLoggedInUser().userOrganizationCategoryType||"PRODUCT"===o.getLoggedInUser().userOrganizationCategoryType)a.billId&&h.go("managebill",{type:"view",createReceipt:!0,billId:a.billId});else{c.transactionTypes.SUBSCRIPTION_TYPE;m.getWhetherBillDetails(d,function(b){localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:c.transactionTypes.SUBSCRIPTION_TYPE})),h.go("billsummaryview",{transactionId:a.transactionId})},function(b){var c=j.confirm().title(i.instant("FEE_TYPE_NOT_FOUND_TITLE")).textContent(i.instant("FEE_TYPE_NOT_FOUND_BODY")).ok(i.instant("OK")).cancel(i.instant("CANCEL"));j.show(c).then(function(){},function(){a.cancel()})},{handleError:!1})}},a.cancel=function(){b.goBackToPrevState()};var t=c.gridConfigurations;a.options=k.setOptionProperties(t),q()}]),angular.module("paripal.billingSetupModule").controller("ManageSponsoredUserListCtrl",["$scope","datatableconfig","$state","commonConstants","featurePrivilegeConstants","OrgSubscriptionListService","serverSidePagination","$rootScope","$mdDialog","ManageSubscriptionTypeService","httpService","urlService","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.commonConstants=d,a.filterCriteria={},a.org={queryUrl:"GET_SUBSCRIBER_ORGANIZATIONS",queryParameter:{},jsonParameter:{}},/*
         * For Pagination defaults value
         * Default records per page
         */
a.date={},a.currentPage=d.defaultPageNo,a.itemPerPage=d.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var n=function(){o(),a.getServiceTypeList(),f.getSystemOrganizations(function(b){a.systemOrganizationList=b}),f.getAllStatuses(function(b){a.statuses=b}),a.searchData(),a.loadApprovalStatusList()};a.getServiceTypeList=function(b){a.subscriptionTypeList=[],f.getSubscriptionType(a.filterCriteria.systemOrgId,a.filterCriteria.subscriptionFor,function(b){a.subscriptionTypeList=b})};var o=function(){j.getListOfSubscriptionFor(function(b){a.subscriptionForList=b},function(a){})};a.manageSponseredUser=function(b,c){i.show({controller:"ManageSponsoredUserPopCtrl",templateUrl:"app/modules/billing-setup/views/manage-sponsored-user-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{orgId:b.sponsor.id,requestMode:c,recordId:b.id}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.searchData=function(){h.showSpinner=!0,a.organizationId&&(a.filterCriteria.organizationIds=[a.organizationId.id]),a.filterCriteria.subscriptionFrom=m.convertToServerDate(a.date.subscriptionFrom),a.filterCriteria.subscriptionTill=m.convertToServerDate(a.date.subscriptionTill),a.filterCriteria.requestFrom=m.convertToServerDate(a.date.requestFrom),a.filterCriteria.requestTill=m.convertToServerDate(a.date.requestTill),f.searchSubscriptionUsers(a.filterCriteria,a.currentPage,a.itemPerPage,function(b){a.subscriptionUserList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),h.showSpinner=!1})},a.getUser=function(b){a.userNameAutoCmp=!0;var c={},d=[];return c.userName=b,k.getData(l.getParameterizedUrl("GET_ALL_USERS",c),null,function(b){return a.userNameAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.getSubscriptionIds=function(b){var c={},d=[];return c.keyword=b,k.getData(l.getParameterizedUrl("GET_SUBSCRIPTION_IDS",c),null,function(a){return d=angular.fromJson(a.data)},function(b){a.userNameAutoCmp=!1})},a.loadApprovalStatusList=function(){a.approvalStatusList=[],a.approvalStatusList.push({value:"Approved",code:"true"}),a.approvalStatusList.push({value:"Rejected",code:"false"})},a.clear=function(){c.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},n();/* Data table configurations */
var p=d.gridConfigurations;a.options=b.setOptionProperties(p)}]),angular.module("paripal.billingSetupModule").controller("ManageSponsoredUserPopCtrl",["$scope","$state","utilService","commonConstants","featurePrivilegeConstants","$mdDialog","orgId","requestMode","manageSponsoredUserService","recordId","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l){a.init=function(){a.manageSponsoredUser={},c.isFieldEmpty(g)||c.isFieldEmpty(h)?f.cancel():(a.pageState=h,i.getSubscriptionTypeBySponsorId(g,function(b){a.subscriptionTypeList=b},function(a){}))},a.getSubscriptionDetails=function(b){i.getSubscriptionDetailsBySubscriptionTypeId(g,angular.fromJson(b).id,function(b){a.subscriptionDetails=b,a.manageSponsoredUser.subscriptionPeriod=a.subscriptionDetails.period,a.manageSponsoredUser.noOfPeriod=a.subscriptionDetails.periodTypeId.value,a.manageSponsoredUser.noOfUserLeft=a.subscriptionDetails.numberOfUsersLeft,a.whetherApprovable=a.subscriptionDetails.whetherApprovable},function(a){})},a.approveSponsoredUser=function(){var c={};c.id=j,c.organizationSubscriber=a.subscriptionDetails.organizationSubscriber,i.approveSponsoredUser(c,function(a){f.cancel(),k("success",l.instant("SPONSORSHIP_SUCCESSFULLY_APPROVED")),b.reload()},function(a){})},a.rejectSponsoredUser=function(){var c={};c.rejectionReason=a.manageSponsoredUser.rejectionReason,c.id=j,i.rejectSponsoredUser(c,function(a){f.cancel(),k("success",l.instant("SPONSORSHIP_SUCCESSFULLY_REJECTED")),b.reload()},function(a){})},a.cancel=function(){f.cancel()},a.init()}]),angular.module("paripal.billingSetupModule").controller("ManageSubscriptionTypeCtrl",["$scope","utilService","commonConstants","$stateParams","SubscriptionTypeListService","ManageSubscriptionTypeService","$state","featurePrivilegeConstants","datatableconfig","serverSidePagination","$rootScope","httpService","urlService","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.featurePrivilegeConstants=h,a.commonConstants=c,a.WSSubscriptionType={},a.selectedOrgLocId=null,/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=c.defaultPageNo,a.itemPerPage=c.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var o=[],p=function(){q(),r(),a.revenueSharingModes=a.commonConstants.revenueSharingMode,e.getSystemOrganizations(function(b){a.systemOrganizationList=b}),s()},q=function(){l.getData(m.getUrl("GET_ALL_ACCESSIBLE_ORG_LOC_LIST"),null,function(c){b.isNullOrEmpty(c)||(a.organizationLocations=c.data)},function(a){})},r=function(){f.getListOfSubscriptionFor(function(b){a.subscriptionForList=b},function(a){})},s=function(){a.pageState=null===d.type?"add":d.type,"edit"!==a.pageState&&"view"!==a.pageState||(a.isEditMode=!0,a.WSSubscriptionType=f.setSubscriptionTypeData(d.data),angular.copy(a.WSSubscriptionType.subscriptionTypeServiceses,o),b.isFieldEmpty(a.WSSubscriptionType.organizationLocation)||(a.selectedOrgLocId=a.WSSubscriptionType.organizationLocation.id))};a.subscriptionForSelected=function(){a.WSSubscriptionType.subscriptionFor},a.createSubscriptionType=function(b){b.$valid&&(k.showSpinner=!0,f.createSubscriptionType(a.WSSubscriptionType,function(b){k.showSpinner=!1,a.back()},function(){k.showSpinner=!1}))},
//TODO give proper name to function variables
a.selectedServices=function(){b.isFieldEmpty(o)||angular.forEach(o,function(c,d){angular.forEach(a.WSSubscriptionType.subscriptionTypeServiceses,function(a,d){b.isFieldEmpty(a)||c.subscriptionService.id!=a.subscriptionService.id||(c.subscriptionService.whetherLimitApplicable&&(a.serviceLimit=c.serviceLimit),a.whetherActive=c.whetherActive,a.id=c.id)})})},a.back=function(){b.goBackToPrevState()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},p();/* Data table configurations */
var t=c.gridConfigurations;a.currentDate=n("timestampToDate")(new Date,"MM/dd/yyyy"),a.options=i.setOptionProperties(t)}]),angular.module("paripal.billingSetupModule").controller("OrgLocSubscriptionListCtrl",["$scope","datatableconfig","$state","$stateParams","utilService","commonConstants","featurePrivilegeConstants","OrgLocSubscriptionListService","serverSidePagination","dataSettingsService","$rootScope","$mdDialog","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){a.WSOrganizationLocationSubscription={},a.subscriptionServiceList=[];var c={};a.locSelected=function(b){b&&(c.locationId=b.id),e.isFieldEmpty(c.locationId)||e.isFieldEmpty(c.systemOrgId)||a.getCurrentSubscriptions()},a.sysOrgSelected=function(a){a&&(c.systemOrgId=a.id)},a.getCurrentSubscriptions=function(){h.getCurrentSubscriptions(c,function(b){a.subscriptTypeList=b})};var f=function(){g()},g=function(){a.pageState=b.type,e.isFieldEmpty(b.data)||(a.subsType=b.data.subscriptionType.value),"add"==a.pageState?(a.WSOrganizationLocationSubscription.organizationSubscriberId={id:a.filterCriteria.organizationSubscriberId},a.WSOrganizationLocationSubscription.validTill=m.convertToViewDate(d.data.subscriptionTill),a.minDate=o):h.getOrgLocSubscriptionData(b.data,function(b){angular.copy(b,a.WSOrganizationLocationSubscription)})};a.getSubscriptionServices=function(b){if(e.isFieldEmpty(b)||(a.subscriptionTypeId=angular.fromJson(b).id),e.isFieldEmpty(a.subscriptionServiceList)){var c=angular.fromJson(b).id;h.getSubscriptionService(c,function(b){a.subscriptionServiceList=b})}};a.subscribeOrgLoc=function(){k.showSpinner=!0,e.isFieldEmpty(a.subscriptionTypeId)||(a.WSOrganizationLocationSubscription.subscriptionTypeId=a.subscriptionTypeId),h.subscribeOrgLocation(a.WSOrganizationLocationSubscription,function(){a.hide()})},a.hide=function(){l.hide(),k.showSpinner=!1},a.cancel=function(){l.cancel(),k.showSpinner=!1},f()}n.$inject=["$scope","stateParams"],a.commonConstants=f,a.filterCriteria={},a.orgLocParams={},a.disableOrgLoc=!0;var o=new Date;a.todaysDate=o;var p=[];a.sysOrganization={},/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=f.defaultPageNo,a.itemPerPage=f.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var q=function(){return e.isFieldEmpty(d.data)?void c.go("orgsubscriptionlist"):(a.orgLoc.queryParameter.orgId=d.data.organization.id,a.systemOrganization=d.data.subscribedTo,a.filterCriteria.organizationSubscriberId=d.data.id,h.getSystemOrganizations(function(b){a.systemOrganizationList=b}),void a.searchData())};a.selectedServices=function(){p=[];for(var b=0;b<=a.filterCriteria.subscriptionTypeServiceses.length;b++)null!=a.filterCriteria.subscriptionTypeServiceses[b]&&p.push(a.filterCriteria.subscriptionTypeServiceses[b].subscriptionService.id)},a.orgLoc={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:null},jsonParameter:{}},a.searchData=function(){k.showSpinner=!0;var b={};angular.copy(a.filterCriteria,b),e.isFieldEmpty(p)||(b.subscriptionServiceIds=p),delete b.subscriptionTypeServiceses,h.searchData(b,a.currentPage,a.itemPerPage,function(b){a.organizationLocationList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),k.showSpinner=!1})},a.manageOrgLocSubscription=function(a,b,c){/*OrgLocSubscriptionListService.manageOrgSubscription(pageState, id);*/
"add"===b?r(a,b,null):h.manageOrgSubscription(c,function(c){r(a,b,c)})};/**********  Code for popup starts from here  ***********/
var r=function(b,c,d){l.show({scope:a,preserveScope:!0,controller:n,templateUrl:"app/modules/billing-setup/views/manage-org-loc-subscription.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:f.dialogBox.clickOutsideToClose,locals:{stateParams:{type:c,data:d}}}).then(function(){a.searchData()})};/**********  Code for popup ends here  ***********/
a.clear=function(){c.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},q();/* Data table configurations */
var s=f.gridConfigurations;a.options=b.setOptionProperties(s)}]),angular.module("paripal.billingSetupModule").controller("OrgSubscriptionListCtrl",["$scope","datatableconfig","$state","utilService","commonConstants","featurePrivilegeConstants","OrgSubscriptionListService","serverSidePagination","dataSettingsService","$rootScope","$mdDialog","ManageSubscriptionTypeService","notify",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.commonConstants=e,a.filterCriteria={},a.orgLocParams={},a.disableOrgLoc=!0,/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=e.defaultPageNo,a.itemPerPage=e.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var n=function(){o(),/*$scope.getServiceTypeList();*/
g.getSystemOrganizations(function(b){a.systemOrganizationList=b}),g.getAllStatuses(function(b){a.statuses=b}),a.searchData()};a.org={queryUrl:"GET_SUBSCRIBER_ORGANIZATIONS",queryParameter:{},jsonParameter:{}},a.getServiceTypeList=function(b){a.subscriptionTypeList=[],g.getSubscriptionType(a.filterCriteria.systemOrgId,a.filterCriteria.subscriptionFor,function(b){a.subscriptionTypeList=b})};var o=function(){l.getListOfSubscriptionFor(function(b){a.subscriptionForList=b},function(a){})};a.searchData=function(){j.showSpinner=!0,g.searchData(a.filterCriteria,a.currentPage,a.itemPerPage,function(b){a.organizationList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),j.showSpinner=!1})},a.stopStartSubscription=function(b){g.stopStartSubscription(b,function(b){a.searchData()})},a.manageOrgSubscription=function(a,b){"cancel"==a?g.manageOrgSubscription(a,b,function(a){m("success",a.data.successMessage),c.reload()},function(a){}):g.manageOrgSubscription(a,b)},a.orgLocSubscription=function(a){c.go("locationsubscriptionlist",{data:a})},a.userSubscription=function(a){c.go("managesponsoreduser")},
//TODO dont reload the state , empty the object instead
a.clear=function(){c.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},n();/* Data table configurations */
var p=e.gridConfigurations;a.options=b.setOptionProperties(p)}]),angular.module("paripal.billingSetupModule").controller("SubscriptionTypeListCtrl",["$scope","datatableconfig","$state","utilService","commonConstants","featurePrivilegeConstants","SubscriptionTypeListService","serverSidePagination","dataSettingsService","$rootScope","$mdDialog","ManageSubscriptionTypeService",function(a,b,c,d,e,f,g,h,i,j,k,l){a.commonConstants=e,a.filterCriteria={},a.orgLocParams={},a.disableOrgLoc=!0,/*
     * For Pagination defaults value
     * Default records per page
     */
a.currentPage=e.defaultPageNo,a.itemPerPage=e.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var m=function(){n(),g.getSystemOrganizations(function(b){a.systemOrganizationList=b}),a.searchData()};a.searchData=function(){j.showSpinner=!0,g.searchData(a.filterCriteria,a.currentPage,a.itemPerPage,function(b){a.subscriptionTypeList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),j.showSpinner=!1})};var n=function(){l.getListOfSubscriptionFor(function(b){a.subscriptionForList=b},function(a){})};a.manageSubscriptionType=function(a,b){g.manageSubscriptionType(a,b)},a.clear=function(){c.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},m();/* Data table configurations */
var o=e.gridConfigurations;a.options=b.setOptionProperties(o)}]),angular.module("paripal.billingSetupModule").service("CurrencyExchangeListService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","notify","commonConstants","$rootScope",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a,b,c,f,h,j){g.show({scope:f,preserveScope:!0,templateUrl:"app/modules/billing-setup/views/manage-exchange-currency-rate.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:i.dialogBox.clickOutsideToClose,controller:["$scope",function(a){a.currencyMinLength=j.minLengthList.currencyMinLength,"add"===b&&(a.WSCurrencyExchangeRate.createdDate=d.convertToViewDate(new Date)),e.isFieldEmpty(c)||(a.WSCurrencyExchangeRate=angular.copy(c),e.isFieldEmpty(c.ownerLocationId)||(a.WSCurrencyExchangeRate.organizationLocation={data:c.ownerLocationId}),e.isFieldEmpty(c.organizationId)||(a.WSCurrencyExchangeRate.organization={data:c.organizationId}),e.isFieldEmpty(c.createdDate)||(a.WSCurrencyExchangeRate.createdDate=d.convertToViewDate(c.createdDate)))}]}).then(function(){h()},function(){})}this.manageCurrencyExchangeRate=function(b,d,f,g,h,i,l){var m=null;if(e.isFieldEmpty(d)||"add"==d)k(b,"add",m,g,h,j);else{var n={};n.exchangeRateId=f,a.getData(c.getParameterizedUrl("FIND_EXCHANGE_RATE_BY_ID",n),null,function(a){k(b,d,a.data,g,h,j)},function(a){l(a)})}},this.searchData=function(b,f,g,i,j){var k={};angular.copy(b,k),e.isFieldEmpty(b.fromCurrencyId)||(k.fromCurrencyId=b.fromCurrencyId.id),e.isFieldEmpty(b.toCurrencyId)||(k.toCurrencyId=b.toCurrencyId.id),e.isFieldEmpty(b.date)||(k.date=d.convertToServerDate(b.date)),e.isFieldEmpty(b.organization)||(k.organizationId=b.organization.data.id),e.isFieldEmpty(b.orgLocation)||(k.locationId=b.orgLocation.data.id),delete k.organization,delete k.orgLocation,k.pageNumber=f,k.recordsPerPage=g,a.postData(c.getUrl("GET_CURRENCY_EXCHANGE_LIST"),k,function(a){i(a.data)},function(a){h("Warning",a.data.messages[0]),j(a)})}}]),angular.module("paripal.billingSetupModule").service("FeeHeadListService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","commonConstants",function(a,b,c,d,e,f,g,h){"use strict";this.manageFeeHead=function(b,d,e,g,h,i){
//var _this = this;
var j=new Object;j.id=e,a.getData(c.getParameterizedUrl("GET_FEE_HEAD_BY_ID",j),null,function(a){h(),f.go("managefeehead",{type:d,data:a.data})},function(){i()})},this.searchData=function(b,d,f,g,h){var i={};angular.copy(b,i),e.isFieldEmpty(b.feeHeadGroup)||(i.feeHeadGroupId=b.feeHeadGroup.dataValue.id),delete i.feeHeadGroup,e.isFieldEmpty(b.orgLoc)||(i.locationId=b.orgLoc.data.id),delete i.orgLoc,i.pageNumber=d,i.recordsPerPage=f,a.postData(c.getUrl("GET_FEE_HEADS_BY_SEARCH_CRITERIA"),i,function(a){g(a.data)},function(){h()})},this.manageFeeHeadPopup=function(a,b,c,d){e.isFieldEmpty(c)&&(c=null),g.show({controller:"ManageFeeHeadCtrl",templateUrl:"app/modules/billing-setup/views/manage-fee-head.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:h.dialogBox.clickOutsideToClose,locals:{$stateParams:{type:b,data:c}}}).then(function(){d()},function(){})}}]),angular.module("paripal.billingSetupModule").service("FeeTypeFeeScheduleService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","notify",function(a,b,c,d,e,f,g,h){"use strict";this.getFeeSchedules=function(b,d,g,h){if(e.isFieldEmpty(b.data)||e.isFieldEmpty(b.data.feeTypeId))f.go("feetypelist");else{var i={};i.feeTypeId=b.data.feeTypeId,i.whetherPermanent=d,a.postData(c.getUrl("GET_FEE_SCHEDULES_BY_FEE_TYPE_ID"),i,function(a){g(a.data)},function(){h()})}},this.savePriorityChanges=function(b,d,e){var f=[];angular.forEach(b,function(a,b){var c={};c.id=a.id,c.prioritySequence=d+b,f.push(c)}),a.putData(c.getUrl("UPDATE_FEE_TYPE_FEE_SCHEDULE_PRIORITY_SEQUENCE"),f,function(a){h("success",a.data.successMessage),e.hide()},function(){})}}]),angular.module("paripal.billingSetupModule").service("FeeTypeListService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog",function(a,b,c,d,e,f,g){"use strict";this.manageFeeType=function(b,d,e,g,h){var i=new Object;i.id=e,a.getData(c.getParameterizedUrl("GET_FEE_TYPE_BY_ID",i),null,function(a){g(),f.go("managefeetype",{type:d,data:a.data})},function(){h()})},this.searchData=function(b,d,f,g,h){var i={};angular.copy(b,i),e.isFieldEmpty(b.transactionType)||(i.transactionTypeId=b.transactionType.dataValue.id),delete i.transactionType,e.isFieldEmpty(b.orgLoc)||(i.locationId=b.orgLoc.data.id),delete i.orgLoc,e.isFieldEmpty(b.serviceGroup)||(i.serviceTypeGroup=b.serviceGroup.id),delete i.serviceGroup,e.isFieldEmpty(b.serviceType)||(i.serviceTypeId=b.serviceType.id),delete i.serviceType,i.pageNumber=d,i.recordsPerPage=f,a.postData(c.getUrl("GET_FEE_TYPES_BY_SEARCH_CRITERIA"),i,function(a){g(a.data)},function(){h()})},this.manageFeeTypePopup=function(a,b,c,d){e.isFieldEmpty(c)&&(c=null),g.show({controller:"ManageFeeTypeCtrl",templateUrl:"app/modules/billing-setup/views/manage-fee-head.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:commonConstants.dialogBox.clickOutsideToClose,locals:{$stateParams:{type:b,data:c}}}).then(function(){d()},function(){})}}]),angular.module("paripal.billingSetupModule").service("IndividualSubscriptionListService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","notify",function(a,b,c,d,e,f,g,h){"use strict";this.searchData=function(b,d,e,f,g){var h={};angular.copy(b,h),h.pageNumber=d,h.recordsPerPage=e,a.postData(c.getUrl("GET_INDIVIDUAL_SUBSCRIPTION_LIST"),h,function(a){f(a.data)},function(){g()})}}]),angular.module("paripal.billingSetupModule").service("ManageExchangeRateService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","notify","commonConstants",function(a,b,c,d,e,f,g,h,i){"use strict";this.setExchangeRate=function(b,f,g){var h={};angular.copy(b,h),e.isFieldEmpty(b.organization)||(h.organizationId=b.organization.data),e.isFieldEmpty(b.organizationLocation)||(h.ownerLocationId=b.organizationLocation.data),e.isFieldEmpty(b.createdDate)||(h.createdDate=d.convertToServerDate(b.createdDate)),e.isFieldEmpty(b.exchangeRate)||(h.exchangeRate=parseFloat(b.exchangeRate)),delete h.organization,delete h.organizationLocation,e.isFieldEmpty(b.id)?a.postData(c.getUrl("CREATE_EXCHANGE_RATE"),h,function(a){f(a)},function(a){g(a)}):a.putData(c.getUrl("UPDATE_EXCHANGE_RATE"),h,function(a){f(a)},function(a){g(a)})},this.getCurrencyList=function(b){a.getData(c.getUrl("GET_CURRENCYLIST_DATA"),null,function(a){b(angular.fromJson(a.data))},function(a){})}}]),angular.module("paripal.billingSetupModule").service("ManageFeeHeadService",["httpService","$filter","urlService","dateconvertor","utilService","$state","notify","$translate",function(a,b,c,d,e,f,g,h){"use strict";this.createFeeHead=function(b,d,f){var i=new Object;angular.copy(b,i),e.isFieldEmpty(b.feeHeadGroupId)||(i.feeHeadGroupId=b.feeHeadGroupId.dataValue),e.isFieldEmpty(b.organizationLocation)||(i.organizationLocation=b.organizationLocation.data),e.isFieldEmpty(b.organization)||(i.organization=b.organization.data),e.isFieldEmpty(b.onBehalfOfId)||e.isFieldEmpty(b.onBehalfOfId.data)||(e.isFieldEmpty(b.onBehalfOfId.data.id)?(i.onBehalfOfLocationName=b.onBehalfOfId.data.value,i.onBehalfOfId=null):(i.onBehalfOfId=b.onBehalfOfId.data,i.onBehalfOfLocationName=null)),e.isFieldEmpty(b.id)?(i.whetherActive=!0,a.postData(c.getUrl("CREATE_FEE_HEAD"),i,function(a){g("success",h.instant("RECORD_SAVED_SUCCESS")),d(a)},function(){f()})):a.putData(c.getUrl("UPDATE_FEE_HEAD"),i,function(a){g("success",h.instant("RECORD_EDITED_SUCESS")),d(a)},function(){f()})},this.setFeeHeadData=function(a){var b={};return angular.copy(a,b),e.isFieldEmpty(a.organizationLocation)||(b.organizationLocation.data=a.organizationLocation),e.isFieldEmpty(a.organization)||(b.organization.data=a.organization),e.isFieldEmpty(a.onBehalfOfId)||(b.onBehalfOfId={},b.onBehalfOfId.data=a.onBehalfOfId),e.isFieldEmpty(a.onBehalfOfLocationName)||(b.onBehalfOfId={},b.onBehalfOfId.data={value:a.onBehalfOfLocationName}),b}}]),angular.module("paripal.billingSetupModule").service("ManageFeeTypeService",["httpService","$filter","urlService","dateconvertor","utilService","$state","notify","$translate",function(a,b,c,d,e,f,g,h){"use strict";var i=function(a){return a.toLowerCase().charAt(0).toUpperCase()+a.toLowerCase().slice(1)};this.createFeeType=function(b,d,f){var i=new Object;angular.copy(b,i),e.isFieldEmpty(b.organization)||(i.organization=b.organization.data),e.isFieldEmpty(b.organizationLocation)||(i.organizationLocation=b.organizationLocation.data),e.isFieldEmpty(b.transactionType)||(i.transactionType=b.transactionType.dataValue),e.isFieldEmpty(b.serviceGroup)||(i.serviceTypeGroup=b.serviceGroup.id),delete i.serviceGroup,e.isFieldEmpty(b.id)?a.postData(c.getUrl("CREATE_FEE_TYPE"),i,function(a){g("success",h.instant("RECORD_SAVED_SUCCESS")),d(a)},function(){f()}):a.putData(c.getUrl("UPDATE_FEE_TYPE"),i,function(a){g("success",h.instant("RECORD_EDITED_SUCESS")),d(a)},function(){f()})},this.setFeeTypeData=function(a){var b={};return angular.copy(a,b),e.isFieldEmpty(a.organizationLocation)||(b.organizationLocation.data=a.organizationLocation),e.isFieldEmpty(a.organization)||(b.organization.data=a.organization),e.isFieldEmpty(a.transactionType)||(b.transactionType.dataValue=a.transactionType),e.isFieldEmpty(a.serviceTypeGroup)||(b.serviceGroup={id:a.serviceTypeGroup,value:i(a.serviceTypeGroup)}),b}}]),angular.module("paripal.billingSetupModule").service("ManageOrgSubscriptionService",["httpService","$filter","urlService","dateconvertor","utilService","$state","notify","$translate","$mdDialog",function(a,b,c,d,e,f,g,h,i){"use strict";this.getSystemOrganizations=function(){return a.getData(c.getUrl("GET_ACCESSIBLE_SYSTEM_ORGANIZATIONS"),null,function(a){return angular.fromJson(a.data)},function(){})},this.getSubscriptionTypeById=function(b,d){var e={};e.recordId=b,a.getData(c.getParameterizedUrl("FIND_SUBSCRIPTION_TYPE_BY_ID",e),null,function(a){d(a.data)})},this.validFromChanged=function(a,b){var c=new Date(a);return d.convertToViewDate(c.setDate(c.getDate()+b))};var j=function(a){var b=new Object;return angular.copy(a,b),e.isFieldEmpty(a.subscribedTo)||(b.subscribedTo=angular.fromJson(a.subscribedTo)),e.isFieldEmpty(a.subscriptionType)||(b.subscriptionType=angular.fromJson(a.subscriptionType)),e.isFieldEmpty(a.subscriptionFrom)||(b.subscriptionFrom=d.convertToServerDate(a.subscriptionFrom)),e.isFieldEmpty(a.subscriptionTill)||(b.subscriptionTill=d.convertToServerDate(a.subscriptionTill)),!e.isFieldEmpty(a),b};this.cancelSubscripiton=function(b,d,e){var f=j(b);a.putData(c.getUrl("CANCEL_ORGANIZATION_SUBSCRIPTION"),f,function(a){g("success",h.instant("SUBSCRIPTION_CANCELLED_SUCCESSFULLY")),d(a)},function(){e()})},this.subscribeOrg=function(b,d,f){var i=j(b);e.isFieldEmpty(b.id)?a.postData(c.getUrl("SUBSCRIBE_ORGANIZATION"),i,function(a){g("success",h.instant("RECORD_SAVED_SUCCESS")),d(a)},function(){f()}):a.putData(c.getUrl("UPDATE_ORGANIZATION_SUBSCRIPTION"),i,function(a){g("success",h.instant("RECORD_EDITED_SUCESS")),d(a)},function(){f()})},this.setOrgSubscriptionData=function(a){var b=new Object,c=new Object;/******* Display data only *******/
return angular.copy(a,b),b.subscriptionFrom=d.convertToViewDate(a.subscriptionFrom),e.isFieldEmpty(a.subscriptionType)||(b.subscriptionType=angular.toJson(a.subscriptionType)),e.isFieldEmpty(a.subscribedTo)||(b.subscribedTo=angular.toJson(a.subscribedTo)),e.isFieldEmpty(a.subscriptionTill)||(b.subscriptionTill=d.convertToViewDate(a.subscriptionTill)),e.isFieldEmpty(a.subscriptionTill)||(c.subscriptionStatusEnum=a.subscriptionStatusEnum,delete b.subscriptionStatusEnum),e.isFieldEmpty(a.lastUpdatedBy)||(c.lastUpdatedBy=a.lastUpdatedBy.value,delete b.lastUpdatedBy),e.isFieldEmpty(a.createdDate)||(c.createdDate=d.convertToViewDate(a.createdDate),delete b.createdDate),e.isFieldEmpty(a.lastUpdatedDate)||(c.lastUpdatedDate=d.convertToViewDate(a.lastUpdatedDate),delete b.lastUpdatedDate),{WSOrgSubscription:b,WSOrgSubscriptionData:c}}}]),angular.module("paripal.billingSetupModule").service("manageSponsoredUserService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","notify",function(a,b,c,d,e,f,g,h){"use strict";this.getSubscriptionTypeBySponsorId=function(b,d,f){var g={};g.sponsorId=0,e.isFieldEmpty(b)||(g.sponsorId=b),a.getData(c.getParameterizedUrl("GET_SUBSCRIPTION_TYPES_BY_SPONSOR_ID",g),null,function(a){d(angular.fromJson(a.data))},function(a){})},this.getSubscriptionDetailsBySubscriptionTypeId=function(b,d,f,g){var h={};h.sponsorId=0,e.isFieldEmpty(b)||(h.sponsorId=b),e.isFieldEmpty(d)||(h.subscriptionTypeId=d),a.getData(c.getParameterizedUrl("GET_SUBSCRIPTION_DETAILS_BY_SUBSCRIPTION_TYPE_ID",h),null,function(a){f(angular.fromJson(a.data))},function(a){})},this.approveSponsoredUser=function(b,d,e){a.putData(c.getUrl("APPROVE_SPONSORED_USER"),b,function(a){d(angular.fromJson(a.data))},function(a){})},this.rejectSponsoredUser=function(b,d,e){a.putData(c.getUrl("REJECT_SPONSORED_USER"),b,function(a){d(angular.fromJson(a.data))},function(a){})}}]),angular.module("paripal.billingSetupModule").service("ManageSubscriptionTypeService",["httpService","$filter","urlService","dateconvertor","utilService","$state","notify","$translate",function(a,b,c,d,e,f,g,h){"use strict";this.createSubscriptionType=function(b,f,h){var i=new Object;angular.copy(b,i),e.isFieldEmpty(b.organizationLocation)||(i.organizationLocation=b.organizationLocation),e.isFieldEmpty(b.periodTypeId)||(i.periodTypeId=b.periodTypeId.dataValue),e.isFieldEmpty(b.validFrom)||(i.validFrom=d.convertToServerDate(b.validFrom)),i.subscriptionFor=b.subscriptionFor,b.subscriptionFor&&"SUBSCRIPTION_TYPE_INDIVIDUAL"==b.subscriptionFor.code&&((i.subscriptionTypeServiceses||null==i.subscriptionTypeServiceses)&&delete i.subscriptionTypeServiceses,(i.userLimit||null==i.userLimit)&&delete i.userLimit),b.subscriptionFor&&"SUBSCRIPTION_TYPE_SPONSOR"==b.subscriptionFor.code&&(i.subscriptionTypeServiceses||null==i.subscriptionTypeServiceses)&&delete i.subscriptionTypeServiceses,e.isFieldEmpty(b.id)?a.postData(c.getUrl("ADD_SUBSCRIPTION_TYPE"),i,function(a){g("success",a.data.successMessage),f(a)},function(a){g("error",a.data.messages[0]),h()}):a.putData(c.getUrl("UPDATE_SUBSCRIPTION_TYPE"),i,function(a){g("success",a.data.successMessage),f(a)},function(){h()})},this.setSubscriptionTypeData=function(a){var b={};return angular.copy(a,b),e.isFieldEmpty(a.organizationLocation)||(b.organizationLocation.data=a.organizationLocation),e.isFieldEmpty(a.periodTypeId)||(b.periodTypeId.dataValue=a.periodTypeId),e.isFieldEmpty(a.validFrom)||(b.validFrom=d.convertToViewDate(a.validFrom)),e.isFieldEmpty(a.subscriptionFor)||(b.subscriptionFor=a.subscriptionFor),b},this.getListOfSubscriptionFor=function(b,d){a.getData(c.getUrl("GET_LIST_OF_SUBSCRIPTION_FOR"),null,function(a){b(a.data)},function(a){d(a)})},this.getListOfSubscriptionForByOrgId=function(b,d,e){var f={};f.organizationId=b,a.getData(c.getParameterizedUrl("GET_LIST_OF_SUBSCRIPTION_FOR_BY_ORG_ID",f),null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.billingSetupModule").service("OrgLocSubscriptionListService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","notify",function(a,b,c,d,e,f,g,h){"use strict";this.getSubscriptionService=function(b,d){var e={};e.subscriptionTypeId=b,a.getData(c.getParameterizedUrl("GET_SUBSCRIPTION_SERVICES_BY_SUBSCRIPTION_TYPE_ID",e),null,function(a){d(a.data)},function(a){})},this.getSubscriptionType=function(b,d){var e={};e.orgId=b,a.getData(c.getParameterizedUrl("FIND_SUBSCRIPTION_TYPE_BY_ORG_ID",e),null,function(a){d(a.data)})},this.getOrgLocSubscriptionData=function(a,b){var c={};angular.copy(a,c),e.isFieldEmpty(a.validFrom)||(c.validFrom=d.convertToViewDate(a.validFrom)),e.isFieldEmpty(a.validTill)||(c.validTill=d.convertToViewDate(a.validTill)),/*if (!utilService.isFieldEmpty(data.subscriptionService)) {
    WSOrganizationLocationSubscription.subscriptionService = angular.toJson(data.subscriptionService);
}*/
b(c)},this.subscribeOrgLocation=function(b,f){var g={};angular.copy(b,g),g.validFrom=d.convertToServerDate(b.validFrom),e.isFieldEmpty(b.validTill)||(g.validTill=d.convertToServerDate(b.validTill)),e.isFieldEmpty(b.subscriptionService)||(g.subscriptionService=angular.fromJson(b.subscriptionService),delete g.subscriptionService.whetherLimitApplicable,delete g.subscriptionService.unitOfMeasurement),delete g.subscriptionType,e.isFieldEmpty(b.id)?a.postData(c.getUrl("SUBSCRIBE_ORGANIZATION_LOCATION"),g,function(a){h("success",a.data.successMessage),f()}):a.putData(c.getUrl("UPDATE_ORG_LOCATION_SUBSCRIPTION"),g,function(a){h("success",a.data.successMessage),f()})},this.getSystemOrganizations=function(b){a.getData(c.getUrl("GET_ACCESSIBLE_SYSTEM_ORGANIZATIONS"),null,function(a){b(angular.fromJson(a.data))},function(){})},this.getCurrentSubscriptions=function(b,d){a.getData(c.getParameterizedUrl("GET_CURRENT_SUBSCRIPTIONS",b),null,function(a){d(angular.fromJson(a.data))},function(){})};this.searchData=function(b,f,g,h,i){var j={};angular.copy(b,j),e.isFieldEmpty(b.subscriptionFrom)||(j.subscriptionFrom=d.convertToServerDate(b.subscriptionFrom)),e.isFieldEmpty(b.subscriptionTill)||(j.subscriptionTill=d.convertToServerDate(b.subscriptionTill)),e.isFieldEmpty(b.organizationLocationId)||(j.organizationLocationId=b.organizationLocationId.id),j.pageNumber=f,j.recordsPerPage=g,a.postData(c.getUrl("GET_SUBSCRIBED_ORG_LOC_BY_SEARCH_CRITERIA"),j,function(a){h(a.data)},function(){i()})},this.manageOrgSubscription=function(b,d){/*if (type === 'add') {
            manageOrgSubscription(type, null);
        } else {*/
var e={};e.recordId=b,a.getData(c.getParameterizedUrl("FIND_ORG_LOC_SUBSCRIPTION_BY_ID",e),null,function(a){d(a.data)},function(){})}}]),angular.module("paripal.billingSetupModule").service("OrgSubscriptionListService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog","notify",function(a,b,c,d,e,f,g,h){"use strict";this.getSubscriptionType=function(b,d,f){var g={};g.sysOrgId=0,e.isFieldEmpty(b)||(g.sysOrgId=b),g.subscriptionForId=d,a.getData(c.getParameterizedUrl("GET_LIST_OF_SUBSCRIPTION_TYPES",g),null,function(a){f(angular.fromJson(a.data))},function(a){})},this.stopStartSubscription=function(b,d){var e={};e.id=b.id,a.putData(c.getParameterizedUrl("START_STOP_SUBSCRIPTION",e),null,function(a){h("success",a.data.successMessage),d(a)},function(){})},this.getSystemOrganizations=function(b){a.getData(c.getUrl("GET_ACCESSIBLE_SYSTEM_ORGANIZATIONS"),null,function(a){b(angular.fromJson(a.data))},function(){})},this.getAllStatuses=function(b){a.getData(c.getUrl("GET_SUBSCRIPTION_STATUSES"),null,function(a){b(angular.fromJson(a.data))},function(){})},this.searchData=function(b,f,g,h,i){var j={};angular.copy(b,j),e.isFieldEmpty(b.organizationId)||(j.organizationId=b.organizationId.id),e.isFieldEmpty(b.subscriptionFrom)||(j.subscriptionFrom=d.convertToServerDate(b.subscriptionFrom)),e.isFieldEmpty(b.subscriptionTill)||(j.subscriptionTill=d.convertToServerDate(b.subscriptionTill)),j.pageNumber=f,j.recordsPerPage=g,a.postData(c.getUrl("GET_SUBSCRIBED_ORGS_BY_SEARCH_CRITERIA"),j,function(a){h(a.data)},function(){i()})},this.searchSubscriptionUsers=function(b,d,e,f,g){var h={};angular.copy(b,h),h.subscriptionId&&(h.subscriptionRecordId=h.subscriptionId.code,delete h.subscriptionId),h.user&&(h.userId=h.user.id,delete h.user),h.pageNumber=d,h.recordsPerPage=e,a.postData(c.getUrl("GET_LIST_FOR_MANAGE_SPONSORED_SUBSCRIPTION"),h,function(a){f(a.data)},function(){g()})},this.manageOrgSubscription=function(b,d,e,g){if("add"===b)f.go("manageorgsubscription",{type:b,data:null});else if("cancel"==b){var h={};h.subscriberId=d,a.putData(c.getParameterizedUrl("CANCEL_ORG_SUBSCRIPTION",h),null,function(a){e(a)},function(a){g(a)})}else{var i={};i.recordId=d,a.getData(c.getParameterizedUrl("FIND_ORG_SUBSCRIPTION_BY_ID",i),null,function(a){f.go("manageorgsubscription",{type:b,data:a.data})},function(){})}}}]),angular.module("paripal.billingSetupModule").service("SubscriptionTypeListService",["httpService","$filter","urlService","dateconvertor","utilService","$state","$mdDialog",function(a,b,c,d,e,f,g){"use strict";this.getSystemOrganizations=function(b){a.getData(c.getUrl("GET_ACCESSIBLE_SYSTEM_ORGANIZATIONS"),null,function(a){b(angular.fromJson(a.data))},function(){})};var h=function(a,b,c,d){f.go("managesubscriptiontype",{type:a,data:b})};this.searchData=function(b,f,g,h,i){var j={};angular.copy(b,j),e.isFieldEmpty(b.periodType)||(j.periodTypeId=b.periodType.dataValue.id),delete j.periodType,e.isFieldEmpty(b.validFrom)||(j.validFrom=d.convertToServerDate(b.validFrom)),/*if (!utilService.isFieldEmpty(filterCriteria.subscriptionTill)) {
            requestObject.subscriptionTill = dateconvertor.convertToServerDate(filterCriteria.subscriptionTill);
        };*/
j.pageNumber=f,j.recordsPerPage=g,a.postData(c.getUrl("GET_SUBSCRIPTION_TYPE_BY_SEARCH_CRITERIA"),j,function(a){h(a.data)},function(){i()})},this.manageSubscriptionType=function(b,d){if("add"===b)h(b,null);else{var f={};f.recordId=d,a.getData(c.getParameterizedUrl("FIND_SUBSCRIPTION_TYPE_BY_ID",f),null,function(a){e.isFieldEmpty(a.data)?alert("No data"):h(b,a.data)},function(){})}}}]),angular.module("paripal.billingModule").controller("AccountStatementCtrl",["datatableconfig","$scope","commonConstants","serverSidePagination","httpService","urlService","utilService","commonBillingService","accountStatementService","dateconvertor","$state","featurePrivilegeConstants","userStatusService","$filter","storageService","$timeout","$rootScope","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.filterCriteria={};var s=!1;b.isUserOrgUser=m.isOrgUser(),b.currentPage=1,b.itemPerPage=10,b.startRecord=(b.currentPage-1)*b.itemPerPage+1,b.endRecord=b.itemPerPage,b.pagingInfo={},b.accStatementSearchObject={},b.commonConstants=c,b.whetherProfessional=!1;var t;b.isSettlementEnabled=!1,b.isSettlement=!1,b.status={open:!0},b.date={},b.statementObj={},b.setMaxRecords=function(a){b.currentPage=1,b.itemPerPage=a,b.getFilteredValues(b.isSearched)};var u={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};b.options=a.setOptionProperties(u),b.dtColumnDefs=a.setColumnProperties({}),b.getPartyTypes=function(){v()};var v=function(){e.getData(f.getUrl("FIND_ALL_PARTY_TYPE_FOR_ACT_SMT"),null,function(a){b.accStatementSearchObject.accStatementPartyTypeList=angular.fromJson(a.data)},function(a){})};b.getClientType=function(){return e.getData(f.getUrl("FIND_PARTY_TYPE"),null,function(a){b.clientTypeList=angular.fromJson(a.data)},function(a){})},b.getPartyNameData=function(a){var d={};/*$scope.filterCriteria.statementForLocationId = item.id;*/
//set orgLoc id in this api as ‘orgLocationId’ ( set it as an attribute in an object)
return b.userNameAutoCmpLoading=!0,b.isUserOrgUser?(d.searchKeyword=a,"INDIVIDUAL"==b.filterCriteria.partyType?(g.isFieldEmpty(b.filterCriteria.orgLoc)||g.isFieldEmpty(b.filterCriteria.orgLoc.data)||"SETTLEMENT"!=b.statementObj.statementType||(d.orgLocId=b.filterCriteria.orgLoc.data.id),d.receiptPartyType=b.filterCriteria.partyType,d.noOfSuggestions=c.smartSearchRecordLimit,e.postData(f.getUrl("FIND_CLIENT_FOR_ACT_SMT"),d,function(a){return b.userNameAutoCmpLoading=!1,b.totalItems=a.totalRecords,angular.fromJson(a.data)},function(a){b.userNameAutoCmpLoading=!1},{orgLocPermission:l.ACC_STMT_VIEW})):"PROFESSIONAL"==b.filterCriteria.partyType?(g.isFieldEmpty(b.filterCriteria.orgLoc)||g.isFieldEmpty(b.filterCriteria.orgLoc.data)||"SETTLEMENT"!=b.statementObj.statementType||(d.orgLocId=b.filterCriteria.orgLoc.data.id),e.getData(f.getUrl("FIND_PROFESSIONAL_FOR_ACT_SMT"),d,function(a){return b.userNameAutoCmpLoading=!1,b.totalItems=a.totalRecords,angular.fromJson(a.data)},function(a){b.userNameAutoCmpLoading=!1},{orgLocPermission:l.ACC_STMT_VIEW})):void 0):(d.keyWord=a,e.getData(f.getUrl("FIND_PARTY_FOR_ACT_SMT"),d,function(a){return b.userNameAutoCmpLoading=!1,b.totalItems=a.totalRecords,angular.fromJson(a.data)},function(a){b.userNameAutoCmpLoading=!1},{orgLocPermission:l.ACC_STMT_VIEW}))},b.partyNameSelected=function(a){b.isSettlementEnabled=!1,b.filterCriteria.settlementType=null,b.billPaymentIds=[],b.isUserOrgUser?("ORGANIZATION_LOCATION"==b.filterCriteria.partyType&&(b.filterCriteria.statementForLocationId=a.id,b.filterCriteria.partyType="ORGANIZATION_LOCATION"),"INDIVIDUAL"==b.filterCriteria.partyType&&(b.filterCriteria.statementForUserId=a.id,b.filterCriteria.partyType="INDIVIDUAL"),"PROFESSIONAL"==b.filterCriteria.partyType&&(b.filterCriteria.statementForUserId=a.id,b.filterCriteria.partyType="PROFESSIONAL")):(b.filterCriteria.partyType="PROFESSIONAL",b.filterCriteria.statementForUserId=a.id),g.isFieldEmpty(b.statementObj.statementType)||"SETTLEMENT"!=b.statementObj.statementType||g.isFieldEmpty(b.filterCriteria.partyName)||(b.isSettlementEnabled=!0)};var w=function(a,c){q.showSpinner=!0,i.getAccountStatementDetails(a,c,function(a){var c=angular.fromJson(a);b.accStatementSearchObject.accountStatementList=c.data,b.totalItems=c.totalRecords,b.pagingInfo=d(b.currentPage,b.itemPerPage,b.totalItems),q.showSpinner=!1},function(a){q.showSpinner=!1})},x=function(a){var c="";b.isSettlement=!0,g.isFieldEmpty(a.billReceiptId)||(a.id=a.billReceiptId.id,"BILL_BASED"==a.settlementType?(a.typeCode="CREDIT",c="FIND_BILL_ADJUSTMENT_LIST"):"RECEIPT_PAYMENT_BASED"==a.settlementType&&(a.typeCode="RECEIPT",c="GET_RECEIPT_ACCOUNT_STATEMENTS"));var d={id:angular.copy(a.id),typeCode:angular.copy(a.typeCode),pageNumber:b.currentPage,recordsPerPage:b.itemPerPage};
//objectData = deleteExtraFields(objectData);
w(c,d)},y=function(a,c){var d="GET_ACCOUNT_STATEMENTS";b.isSettlement=!1,a.dateFrom=angular.copy(j.convertToServerDate(b.date.dateFromString)),a.dateTill=angular.copy(j.convertToServerDate(b.date.dateTillString)),g.isFieldEmpty(b.filterCriteria.orgLoc)||g.isFieldEmpty(c.statementForLocationId)&&g.isFieldEmpty(c.statementForUserId)?g.isFieldEmpty(b.filterCriteria.orgLoc)||!g.isFieldEmpty(c.statementForLocationId)&&!g.isFieldEmpty(c.statementForUserId)||(a.orgLocId=b.filterCriteria.orgLoc.data.id,delete a.partyType):a.orgLocId=b.filterCriteria.orgLoc.data.id,a=z(a),w(d,a)},z=function(a){
//delete objectData.partyType;
//delete objectData.whetherProfessional;
//delete objectData.whetherAccntOrFrntOfc
//delete objectData.statementForUserId;
// delete objectData.statementType;
//delete objectData.partyType;
return delete a.billReceiptId,delete a.settlementType,delete a.orgLoc,delete a.partyNameId,delete a.partyName,a};b.getFilteredValues=function(a,c){b.filterCriteria.partyType=b.filterCriteria.partyType,b.filterCriteria.pageNumber=b.currentPage,b.filterCriteria.recordsPerPage=b.itemPerPage;var d=angular.copy(b.filterCriteria),e=b.getUserStatus(d);g.isFieldEmpty(t)||(e.statementForUserId=t),e.statementType=b.statementObj.statementType,"SETTLEMENT"==b.statementObj.statementType?x(e):y(e,d)};b.setWhetherProfessional=function(){return b.userDetails={},b.userDetails=angular.fromJson(localStorage.loggedInUser),b.userDetails.userAccountStatusDTO.whetherDoctor!==!0&&b.userDetails.userAccountStatusDTO.whetherCounselor!==!0&&b.userDetails.userAccountStatusDTO.whetherOtherHealthServiceProfessional!==!0&&b.userDetails.userAccountStatusDTO.whetherSupportServiceProfessional!==!0||(b.whetherProfessional=!0),b.whetherProfessional},b.partyTypeChanged=function(){b.isPartyDisabled=!1,b.filterCriteria.partyName=null,0==s&&1==b.setWhetherProfessional()&&"PROFESSIONAL"==b.filterCriteria.partyType&&(
//$scope.partyNameId = {};
//   $scope.filterCriteria.statementForUserId = item.id;
b.filterCriteria.partyType="PROFESSIONAL",b.filterCriteria.partyNameId=m.userStatus().userData.value,t=m.userStatus().userData.id)},b.viewRecord=function(a){null!=a.billType?k.go("managebill",{type:"view",billId:a.id}):null!=a.receiptPaymentType&&k.go("managereceiptpayment",{type:"view",receiptId:a.id})},b.editRecord=function(a){null!=a.billType?k.go("managebill",{type:"edit",billId:a.id}):null!=a.receiptPaymentType&&k.go("managereceiptpayment",{type:"edit",receiptId:a.id})},b.addMonths=function(a,b){return a.setMonth(a.getMonth()+b),a},b.onSettlementType=function(){b.filterCriteria.settlementStatus=null,b.filterCriteria.billReceiptValue=null;var a={billSettlementType:b.filterCriteria.settlementType,partyId:b.filterCriteria.partyName.id};i.getAllBillPaymentIds(a,function(a){g.isFieldEmpty(a)||(b.billPaymentIds=a)},function(a){})},b.pageChanged=function(){b.pagingInfo=d(b.currentPage,b.itemPerPage,b.totalItems),b.getFilteredValues(b.isSearched)},b.onStatementTypeChanged=function(){/*delete $scope.filterCriteria.settlementStatus;
            delete $scope.filterCriteria.billReceiptValue;*/
b.isSettlement=!1,b.filterCriteria={},g.isFieldEmpty(b.statementObj.statementType)||"SETTLEMENT"!=b.statementObj.statementType||g.isFieldEmpty(b.filterCriteria.partyName)?(b.isSettlementEnabled=!1,b.filterCriteria.settlementType=null,b.billPaymentIds=[]):b.isSettlementEnabled=!0,D()},b.getUserStatus=function(a){return angular.fromJson(localStorage.loggedInUser)&&(b.userDetails={},b.userDetails=angular.fromJson(localStorage.loggedInUser),b.isUserOrgUser=m.isOrgUser(),b.isUserOrgUser?(a.whetherAccntOrFrntOfc=s,b.userDetails.userAccountStatusDTO.whetherDoctor!==!0&&b.userDetails.userAccountStatusDTO.whetherCounselor!==!0&&b.userDetails.userAccountStatusDTO.whetherOtherHealthServiceProfessional!==!0&&b.userDetails.userAccountStatusDTO.whetherSupportServiceProfessional!==!0||(a.whetherProfessional=!0,a.whetherClient=!1)):(b.userDetails.userAccountStatusDTO.whetherClient===!0&&(a.whetherClient=!0,b.userDetails.userAccountStatusDTO.whetherDoctor||b.userDetails.userAccountStatusDTO.whetherCounselor||b.userDetails.userAccountStatusDTO.whetherOtherHealthServiceProfessional||b.userDetails.userAccountStatusDTO.whetherSupportServiceProfessional===!0?a.whetherProfessional=!0:a.whetherProfessional=!1),1==a.whetherClient&&1==a.whetherProfessional&&(a.whetherProfessional=!1))),a},b.onLocationChanged=function(){b.filterCriteria.partyType=null,b.filterCriteria.partyName=null,b.filterCriteria.settlementType=null,b.billPaymentIds=[],b.isSettlementEnabled=!1},b.clear=function(){b.date.dateFromString=angular.copy(j.convertToViewDate(b.addMonths(new Date,-6))),b.date.dateTillString=angular.copy(j.convertToViewDate(new Date)),b.isSettlement=!1,b.filterCriteria={};var a=$.grep(b.statementTypeList,function(a){return"ALL"==a});b.statementObj.statementType=a[0],D()};var A=function(){q.showSpinner=!0,i.findSettlementTypes(function(a){g.isFieldEmpty(a)||(b.settlementTypes=a),q.showSpinner=!1},function(a){q.showSpinner=!0})},B=function(){i.findStatementType(function(a){if(!g.isFieldEmpty(a)){b.statementTypeList=a;var c=$.grep(b.statementTypeList,function(a){return"ALL"==a});b.statementObj.statementType=c[0],E()}},function(a){})},C=function(){q.showSpinner=!0,i.findSettlementStatuses(function(a){g.isFieldEmpty(a)||(b.settlementStatuses=a),q.showSpinner=!1},function(a){q.showSpinner=!1})},D=function(){b.isPartyTypeDisabled=!0,b.isSettlementEnabled=!1,b.isPartyTypeHidden=!1,b.isPartyDisabled=!0,b.isUserOrgUser?b.isPartyTypeDisabled=!1:(b.isPartyTypeHidden=!0,b.isPartyDisabled=!1)};b.onChangeBillPayment=function(){"BILL_BASED"==b.filterCriteria.settlementType?b.filterCriteria.settlementStatus=b.filterCriteria.billReceiptId.billStatusEnum:"RECEIPT_PAYMENT_BASED"==b.filterCriteria.settlementType&&(b.filterCriteria.settlementStatus=b.filterCriteria.billReceiptId.receiptPaymentStatusEnum),b.filterCriteria.billReceiptValue=b.filterCriteria.billReceiptId.amount};var E=function(){var a=angular.copy(b.filterCriteria);s=o.hasFeaturePrivilege("acc_stmt_accnt_frntofc_view");var c=b.getUserStatus(a);c.pageNumber=b.currentPage,c.recordsPerPage=b.itemPerPage,c.dateFrom=angular.copy(j.convertToServerDate(b.date.dateFromString)),c.dateTill=angular.copy(j.convertToServerDate(new Date)),delete c.orgLoc,1!=c.whetherClient&&1!=c.whetherProfessional||(c.statementType=b.statementObj.statementType,w("GET_ACCOUNT_STATEMENTS",c))};b.init=function(){if(!g.isFieldEmpty(r.wallData)&&!g.isFieldEmpty(r.wallData.orglocation)){var a={};a.data=r.wallData.orglocation,b.filterCriteria.orgLoc=a}B(),v(),A(),C(),b.isMadeFromDisabled=!0,b.minDate=b.addMonths(new Date,-6),b.date.dateFromString=angular.copy(j.convertToViewDate(b.addMonths(new Date,-6))),b.date.dateTillString=angular.copy(j.convertToViewDate(new Date)),D()},b.init()}]),angular.module("paripal.billingModule").controller("addFeeTypePopupCtrl",["datatableconfig","$scope","$mdDialog","commonBillingService","$translate","notify","stateParams","manageBillService",function(a,b,c,d,e,f,g,h){"use strict";b.manageBillObject={},b.searchFeeHeadObj={},console.log(g),b.orgLocation=g.orgLocation,b.currencyId=g.currencyId.id,b.cancel=function(){c.cancel()};var i=function(){d.getListOfTransactionTypes(function(a){b.manageBillObject.transactionTypeList=a},function(a){f("error",e.instant("TRANSACTION_TYPE_LIST_FAILURE"))})};b.findFeeHeads=function(){var a={};a.locationId=g.orgLocation.id,a.serviceTypeId=b.serviceTypeId.id,a.transactionTypeId=b.searchFeeHeadObj.transactionTypeId,a.currencyId=g.currencyId.id,a.serviceTypeId=b.serviceTypeId.id,h.getFeeHeadsForCreateBill(a,function(a){c.cancel(a)},function(a){var b=c.alert().title(e.instant("FEE_TYPE_ERROR")).textContent(e.instant("FEE_CONFIG_NOT_FOUND")).ariaLabel("Lucky day").ok(e.instant("OK"));c.show(b).then(function(){},function(){utilService.goBackToPrevState()})})},i()}]),angular.module("paripal.billingModule").controller("AddPaymentReceiptCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","addReceiptPaymentService","dateconvertor","$stateParams","notify","commonBillingService","featurePrivilegeConstants","$translate","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";function w(a,b,c,d,e){if(a.disableFields=!0,"View"!=d&&(a.disableFields=!1),"Add"==d){var f={pickListCode:"payment_mode",pickListItemCode:"PAYMENT_MODE_CASH"};e.getPicklistWSByCode(f,function(b){a.referenceDetails.paymentMode=b.data},function(a){}),a.referenceDetails.paymentRefDate=p.convertToViewDate(new Date),c&&(a.referenceDetails.amount=c.amount)}else a.isEdit=!1,a.minDate=a.addMonths(new Date,-6),angular.isUndefined(c)?a.referenceDetails={}:(a.referenceDetails=angular.copy(c),a.referenceDetails.paymentRefDate=p.convertToViewDate(a.referenceDetails.paymentRefDate),a.isEdit=!0);a.addReferenceObject={},a.clearData=function(){a.referenceDetails.paymentMode=null,a.referenceDetails.paymentReferenceNo="",a.referenceDetails.paymentRefDate=null,a.referenceDetails.paymentDetail="",a.referenceDetails.amount=null,a.referenceDetails.whetherDeposited=!1,a.referenceDetails.whetherRealized=!1},a.getPaymentModes=function(){return g.getData(h.getUrl("GET_PAYMENT_MODE"),null,function(b){a.addReferenceObject.paymentModeList=angular.fromJson(b.data)},function(a){})},a.getPaymentModes(),a.paymentModeChanged=function(b){445==b?a.isReferenceRequired=!1:a.isReferenceRequired=!0},a.cancel=function(){a.isSaved=!1,b.cancel()},a.savePaymentReference=function(){a.referenceDetails.amount>0?(a.isSaved=!0,b.cancel()):r("error",u.instant("AMOUNT_CANT_BE_LESS_THAN_0"))}}w.$inject=["$scope","$mdDialog","data","mode","manageRequestService"],e.referenceDetails={},e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.getReceiptPaymentTypes=function(){s.getListOfReceiptPaymentTypes(function(a){e.addReceiptObject.receiptTypeList=a},function(a){})},e.getCurrencys=function(){s.getCurrencyList(function(a){e.addReceiptObject.currencyTypeList=a},function(a){r("error",u.instant("CURRENCY_TYPE_LIST_FAILURE"))})},e.getMadeToOrgList=function(){e.getListOfMadeToOrgs()},e.organizationLocationSelected=function(a){a&&(e.getOrgLoc=a.id,e.receiptDetails.ownerLocationId=a,"RECEIPT"==e.receiptDetails.typeCode?(e.receiptDetails.madeToLocationId=a,e.receiptDetails.madeToName=a.value):(e.receiptDetails.madeByLocationId=a,e.receiptDetails.madeByName=a.value))},e.getListOfMadeToOrgs=function(){var a="";return a="EDIT"==e.pageState?t.RECEIPT_EDIT:"VIEW"==e.pageState?t.RECEIPT_VIEW:t.RECEIPT_ADD,g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){e.addReceiptObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getOnBehalfObjNameData=function(a){e.requestData={};var b="";return e.requestData.searchKeyword=a,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.requestData.orgLocId=e.getOrgLoc,e.requestData.receiptPartyType=e.receiptDetails.onBehalfOf,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?t.RECEIPT_EDIT:"VIEW"==e.pageState?t.RECEIPT_VIEW:t.RECEIPT_ADD,g.postData(h.getParameterizedUrl("FIND_MADE_BY_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.getListOfMadeFromOrgs=function(){var a="";return a="EDIT"==e.pageState?t.RECEIPT_EDIT:"VIEW"==e.pageState?t.RECEIPT_VIEW:t.RECEIPT_ADD,g.getData(h.getUrl("FIND_MADE_BY_DROPDOWN"),null,function(a){e.addReceiptObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})},e.getListOfOnBehalfOf=function(){return g.getData(h.getUrl("FIND_ONBEHALF_OF_PARTY_TYPE"),null,function(a){e.addReceiptObject.onBehalfOfPartyType=angular.fromJson(a.data)},function(a){})},e.getinFavorOfNameData=function(a){var b="";return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.receiptDetails.madeTo,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.requestData.orgLocId=e.getOrgLoc,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?t.RECEIPT_EDIT:"VIEW"==e.pageState?t.RECEIPT_VIEW:t.RECEIPT_ADD,g.postData(h.getParameterizedUrl("FIND_MADE_TO_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.getPartyNameData=function(a){e.requestData={};var b="";return e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.receiptDetails.madeBy,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.requestData.orgLocId=e.getOrgLoc,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?t.RECEIPT_EDIT:"VIEW"==e.pageState?t.RECEIPT_VIEW:t.RECEIPT_ADD,g.postData(h.getParameterizedUrl("FIND_MADE_BY_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.getPartyTypes=function(a){s.getListOfPartyTypes(function(a){e.addReceiptObject.inFavorOfTypeList=a,e.addReceiptObject.partyTypeList=a},function(a){r("error",u.instant("PARTY_TYPE_LIST_FAILURE"))},a)},e.receiptTypeSelected=function(a,b){"RECEIPT"==a?(e.hideReceipt=!0,e.hidePayment=!1,e.getPartyTypes("receipt"),e.organizationLocationSelected(b),"edit"!=q.type&&"view"!=q.type&&(e.receiptDetails.madeByLocationId=null,e.receiptDetails.madeByName=null)):(e.hideReceipt=!1,e.hidePayment=!0,e.getPartyTypes("payment"),e.organizationLocationSelected(b),e.receiptDetails.madeToLocationId=null,e.receiptDetails.madeToName=null,e.changePartyStyle()),"edit"!=q.type&&"view"!=q.type&&(e.receiptDetails.madeTo=null,e.receiptDetails.madeToUserId=null,e.receiptDetails.madeByUserId=null),e.changePartyStyle()},e.changePartyStyle=function(){"PAYMENT"==e.receiptDetails.typeCode?(e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!1,e.isPartyTypeDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0,e.receiptDetails.madeBy="ORGANIZATION_LOCATION","EDIT"==e.pageState||"VIEW"==e.pageState||q.data||(e.receiptDetails.madeTo="")):(e.isMadeToSSVisible=!1,e.isMadeToDDVisible=!0,e.isMadeFromSSVisible=!0,e.isMadeFromDDVisible=!1,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!0,e.isPartyTypeDisabled=!1,e.isMadeToDDDisabled=!1,e.isMadeToSSDisabled=!0,"EDIT"==e.pageState||"VIEW"==e.pageState||q.data||(e.receiptDetails.madeBy=null),e.receiptDetails.madeTo="ORGANIZATION_LOCATION"),e.partyTypeSelected()},e.partyTypeSelected=function(){"VIEW"==e.pageState||"EDIT"==e.pageState||e.billData||(e.partyNameId={}),"ORGANIZATION_LOCATION"==e.receiptDetails.madeBy||"INDIVIDUAL"==e.receiptDetails.madeBy?("RECEIPT"==e.receiptDetails.typeCode?(e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!1):("ORGANIZATION_LOCATION"==e.receiptDetails.madeBy?(e.isMadeFromDDVisible=!0,e.isMadeFromSSVisible=!1):(e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0),e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isThirdPartyVisible=!1,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0),e.addReceiptObject.madeToName="",e.isThirdPartyVisible=!1,e.isThirdPartyDisabled=!0):("THIRD_PARTY"!=e.receiptDetails.madeBy?e.isThirdPartyDisabled=!0:e.isThirdPartyDisabled=!1,e.isThirdPartyVisible=!0,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!1,e.addReceiptObject.madeToName=e.receiptDetails.madeByName)},e.inFavorOfSelected=function(){e.inFavorOfSSId={},"ORGANIZATION_LOCATION"!=e.receiptDetails.madeBy&&"INDIVIDUAL"!=e.receiptDetails.madeBy||(e.isMadeToSSDisabled=!1,e.isMadeToSSVisible=!0)},e.billedPartyTypeSelected=function(){e.fillBilledParty()},e.inFavorOfTypeSelected=function(){e.fillInFavorOf()},e.setStatusVisiblity=function(){"edit"==m.type?e.isStatusVisible=!0:e.isStatusVisible=!1},e.getMadeToOrgList=function(){s.getListOfMadeToOrgs(function(a){e.addReceiptObject.inFavorOfOrgList=a},function(a){},t.RECEIPT_VIEW)},e.editReference=function(a,b){e.referenceIndex=b,e.addPaymentReceipt(a,"Edit")},e.viewReference=function(a,b){e.referenceIndex=b,e.addPaymentReceipt(a,"View")},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},e.setMaxRecords=function(a){e.pageNumber=1,e.itemPerPage=a};var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.options=a.setOptionProperties(x),e.dtColumnDefs=a.setColumnProperties({}),e.addPaymentReceipt=function(a,b){d.isFieldEmpty(a)&&!d.isFieldEmpty(e.billData)&&(a=e.billData),d.isFieldEmpty(b)&&(b="Add"),k.show({scope:e,preserveScope:!0,controller:w,templateUrl:"app/modules/billing/views/add-payment-reference.html",parent:angular.element(document.body),clickOutsideToClose:n.dialogBox.clickOutsideToClose,locals:{data:a,mode:b}}).then(function(){e.WSHealthProfessionalsValues={}},function(){if(e.WSHealthProfessionalsValues={},"EDIT"==e.pageState&&(e.referenceDetails.receiptPayment={id:e.receiptDetails.id}),e.referenceDetails.whetherCancelled=!1,e.isEdit?e.isSaved&&!d.isFieldEmpty(e.referenceDetails)&&(d.isFieldEmpty(e.referenceDetails.paymentRefDate)||(e.referenceDetails.paymentRefDate=p.convertToServerDate(e.referenceDetails.paymentRefDate)),e.receiptReferenceList[e.referenceIndex]=e.referenceDetails):e.isSaved&&!d.isFieldEmpty(e.referenceDetails)&&(d.isFieldEmpty(e.referenceDetails.paymentRefDate)||(e.referenceDetails.paymentRefDate=p.convertToServerDate(e.referenceDetails.paymentRefDate)),e.pushArray=angular.copy(e.referenceDetails),e.receiptReferenceList.push(e.pushArray)),0==e.receiptReferenceList.length)e.isReferenceBlank=!0;else{var a=0;angular.forEach(e.receiptReferenceList,function(b,c){a+=parseInt(b.amount),1!=b.whetherDeposited&&(b.whetherDeposited=!1),1!=b.whetherRealized&&(b.whetherRealized=!1)}),e.receiptDetails.amount=a,e.isReferenceBlank=!1}})},e.savePaymentReceipt=function(){if(m.showSpinner=!0,"Cancelled"==e.receiptStatus?(e.receiptDetails.whetherCancelled=!0,e.receiptDetails.whetherAccounted=!1):"Accounted"==e.receiptStatus?(e.receiptDetails.whetherAccounted=!0,e.receiptDetails.whetherCancelled=!1):(e.receiptDetails.whetherCancelled=!1,e.receiptDetails.whetherAccounted=!1),e.receiptDetails.receiptPaymentItems=e.receiptReferenceList,d.isFieldEmpty(e.receiptDetails.receiptDate)||(e.receiptDetails.receiptDate=p.convertToServerDate(e.receiptDetails.receiptDate)),d.isFieldEmpty(e.receiptDetails.onBehalfOfLocation)&&d.isFieldEmpty(e.receiptDetails.onBehalfOfName)&&(e.receiptDetails.onBehalfOf=null),e.addReceiptObject.madeToName&&(e.receiptDetails.madeByName=e.addReceiptObject.madeToName),e.billData){var a={};"DEBIT"==e.billData.typeCode?(a.bill={id:e.billData.id},a.adjustmentDocumentType="BILL_TO_RECEIPT"):(a.refundBill={id:e.billData.id},a.adjustmentDocumentType="REFUND_BILL_TO_PAYMENT"),a.sourceAdjustmentDocumentCode=e.billData.serviceProviderReferenceNo,e.billData.amount>=e.receiptDetails.amount?(a.sourceAmountAdjusted=e.receiptDetails.amount,a.targetAmountAdjusted=e.receiptDetails.amount):(a.sourceAmountAdjusted=e.billData.amount,a.targetAmountAdjusted=e.billData.amount),a.sourceCurrencyId=e.billData.currency.id,e.receiptDetails.wsBillAdjustment=a}"EDIT"==e.pageState?o.updatePaymentReceipt(e.receiptDetails,function(a){m.showSpinner=!1,r("success",a.successMessage),c.go("searchreceipt",{type:null,data:null})},function(a){m.showSpinner=!1}):o.savePaymentReceipt(e.receiptDetails,function(a){if(m.showSpinner=!1,r("success",a.successMessage),!d.isNullOrEmpty(e.receiptDetails)){var b={};b.dateFromString=e.receiptDetails.receiptDate,b.location=e.receiptDetails.madeToLocationId,b.madeBy=e.receiptDetails.madeBy,e.receiptDetails.madeByUserId&&(b.madeFrom=e.receiptDetails.madeByUserId),e.receiptDetails.madeByLocationId&&(b.madeFrom=e.receiptDetails.madeByLocationId),b.onBehalfOfUser=e.receiptDetails.onBehalfOfUser}c.go("searchreceipt",{type:null,data:b})},function(a){m.showSpinner=!1})},e.inFavorOfPersonSelected=function(a){e.receiptDetails.madeToLocationId=a,e.receiptDetails.madeToName=a.value},e.getOrgLocationList=function(){return g.getData(h.getUrl("FIND_MADE_TO_LOCATION_DROPDOWN"),null,function(a){e.addReceiptObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:t.RECEIPT_VIEW})},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.receiptDetails.madeBy?(e.receiptDetails.madeByName=a.value,e.receiptDetails.madeByLocationId=a):(e.receiptDetails.madeByName=a.value,e.receiptDetails.madeByUserId=a)},e.onBehalfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.receiptDetails.onBehalfOf?(e.receiptDetails.onBehalfOfName=a.value,e.receiptDetails.onBehalfOfLocation=a):(e.receiptDetails.onBehalfOfName=a.value,e.receiptDetails.onBehalfOfUser=a)},e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.receiptDetails.madeTo?(e.receiptDetails.madeToLocationId=a,e.receiptDetails.madeToName=a.value):(e.receiptDetails.madeToUserId=a,e.receiptDetails.madeToName=a.value)},e.partyNameDDSelected=function(a){e.receiptDetails.madeByLocationId=a,e.receiptDetails.madeByName=a.value},e.removeReference=function(a,b){if("VIEW"!=e.pageState){var c=k.confirm().title(u.instant("REMOVE_PAYMENT_REFERENCE_TITLE")).textContent(u.instant("REMOVE_PAYMENT_REFERENCE_MSG")).ariaLabel("Lucky day").ok(u.instant("YES")).cancel(u.instant("NO"));k.show(c).then(function(){"VIEW"!=e.pageState&&a.splice(b,1),0==a.length&&(e.isReferenceBlank=!0);var c=0;angular.forEach(e.receiptReferenceList,function(a,b){c+=parseInt(a.amount)}),e.receiptDetails.amount=c},function(){})}},e.back=function(){d.goBackToPrevState()},e.addMonths=function(a,b){return a.setMonth(a.getMonth()+b),a},e.init=function(){if(e.isMadeFromSSVisible=!0,e.receiptReferenceList=[],e.filterCriteria={},e.addReceiptObject={},e.inFavorOfSSId={},e.partyNameId={},e.onBehalfObj={},e.minDate=e.addMonths(new Date,-6),e.maxDate=new Date,e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isReferenceBlank=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.referenceIndex=null,e.receiptDetails={},e.receiptDetails.typeCode="RECEIPT",e.hideReceipt=!0,e.receiptDetails.whetherAutoGenerated=!1,e.receiptDetails.madeToLocationId=null,e.receiptDetails.madeToUserId=null,e.receiptDetails.madeByLocationId=null,e.receiptDetails.madeByUserId=null,e.receiptDetails.ownerLocationId={},/* $scope.receiptDetails.ownerLocationId.id = 1;*/
e.setStatusVisiblity(),e.getReceiptPaymentTypes(),e.getCurrencys(),e.getMadeFromOrgList(),e.getMadeToOrgList(),e.getOrgLocationList(),e.getListOfOnBehalfOf(),e.pageState="CREATE",e.actionName="SAVE",e.commonConstants=n,q.data&&("DEBIT"==q.data.typeCode?(e.receiptDetails.typeCode="RECEIPT",e.billData=q.data,e.ownerLocationId=q.data.ownerLocationId,e.organizationLocationSelected(e.ownerLocationId),e.receiptDetails.currency={},e.receiptDetails.currency.id=e.billData.currency.id,e.billData.raisedOn&&(e.receiptDetails.madeBy=e.billData.raisedOn,e.receiptDetails.madeTo="ORGANIZATION_LOCATION","INDIVIDUAL"==e.billData.raisedOn?(e.receiptDetails.madeByUserId=e.billData.raisedOnUserId,e.receiptDetails.madeByName=e.billData.raisedOnUserId.value):(e.receiptDetails.madeByLocationId=e.billData.raisedOnLocationId,e.receiptDetails.madeByName=e.billData.raisedOnLocationId.value)),"INDIVIDUAL"==e.billData.raisedOn?e.billData.raisedOnUserId&&(e.partyNameId.id=e.billData.raisedOnUserId):e.billData.raisedOnLocationId&&(e.partyNameId.id=e.billData.raisedOnLocationId)):"CREDIT"==q.data.typeCode&&(e.receiptDetails.typeCode="PAYMENT",e.billData=q.data,e.ownerLocationId=q.data.ownerLocationId,e.organizationLocationSelected(e.ownerLocationId),e.receiptTypeSelected(e.receiptDetails.typeCode,e.receiptDetails.ownerLocationId),e.receiptDetails.currency={},e.receiptDetails.currency.id=e.billData.currency.id,e.billData.inFavorOf&&(e.receiptDetails.madeTo=e.billData.inFavorOf,e.receiptDetails.madeBy="ORGANIZATION_LOCATION",e.inFavorOfSelected(),"INDIVIDUAL"==e.billData.inFavorOf?(e.receiptDetails.madeToUserId=e.billData.inFavorOfUserId,e.inFavorOfSSId.id=e.receiptDetails.madeToUserId,e.receiptDetails.madeToName=e.billData.inFavorOfUserId.value):(e.receiptDetails.madeToLocationId=e.billData.inFavorOfLocationId,e.inFavorOfSSId.id=e.receiptDetails.madeToLocationId,e.receiptDetails.madeToName=e.billData.inFavorOfLocationId.value)),"INDIVIDUAL"==e.billData.inFavorOf?e.billData.inFavorOfUserId&&(e.partyNameId.id=e.billData.inFavorOfUserId):e.billData.inFavorOfLocationId&&(e.partyNameId.id=e.billData.inFavorOfLocationId))),q.receiptId&&q.type){var a={id:q.receiptId};g.getData(h.getParameterizedUrl("FIND_RECEIPT_PAYMENT_BY_ID",a),null,function(a){"edit"==q.type?(e.isReferenceBlank=!1,e.actionName="UPDATE",e.pageState="EDIT"):"view"==q.type&&(e.pageState="VIEW",e.isDisabled="a-disabled"),e.receiptDetails=angular.fromJson(a.data),"ORGANIZATION_LOCATION"==e.receiptDetails.madeBy?e.receiptDetails.madeByName=e.receiptDetails.madeByLocationId.value:e.receiptDetails.madeByName=e.receiptDetails.madeByUserId.value,e.receiptTypeSelected(e.receiptDetails.typeCode,e.receiptDetails.ownerLocationId),"RECEIPT"==e.receiptDetails.typeCode?e.getPartyTypes("receipt"):e.getPartyTypes("payment"),e.status=u.instant(e.receiptDetails.status),e.ownerLocationId=e.receiptDetails.ownerLocationId,d.isFieldEmpty(e.receiptDetails.receiptPaymentItems)&&(e.isReferenceBlank=!0),e.receiptDetails.receiptDate&&(e.receiptDetails.receiptDate=p.convertToViewDate(e.receiptDetails.receiptDate)),e.receiptReferenceList=e.receiptDetails.receiptPaymentItems,"RECEIPT"==e.receiptDetails.typeCode?(d.isFieldEmpty(e.receiptDetails.madeToLocationId)||(e.inFavorOfLocationId=e.receiptDetails.madeToLocationId),d.isFieldEmpty(e.receiptDetails.madeByUserId)?e.partyNameId.id=e.receiptDetails.madeByLocationId:e.partyNameId.id=e.receiptDetails.madeByUserId):(d.isFieldEmpty(e.receiptDetails.madeByLocationId)||(e.receiptLocationId=e.receiptDetails.madeByLocationId),d.isFieldEmpty(e.receiptDetails.madeToUserId)?e.inFavorOfSSId.id=e.receiptDetails.madeToLocationId:e.inFavorOfSSId.id=e.receiptDetails.madeToUserId),d.isFieldEmpty(e.receiptDetails.onBehalfOfLocation)?d.isFieldEmpty(e.receiptDetails.onBehalfOfUser)||(e.onBehalfObj.id=e.receiptDetails.onBehalfOfUser):e.onBehalfObj.id=e.receiptDetails.onBehalfOfLocation,1==e.receiptDetails.whetherCancelled?(e.isStatusTrue=!0,e.receiptStatus="Cancelled"):1==e.receiptDetails.whetherAccounted?(e.receiptStatus="Accounted",e.isStatusTrue=!0):e.receiptStatus="",e.changePartyStyle()},function(a){})}else e.getPartyTypes("receipt"),e.receiptDetails.receiptDate=p.convertToViewDate(new Date),q.data||e.changePartyStyle();var b=v.getDefaultOrgLocation();d.isFieldEmpty(b)||(e.defOrgLoc=b.orgLoc,e.organizationLocationSelected(e.defOrgLoc))},e.init()}]),angular.module("paripal.billingModule").controller("BillSettlementViewCtrl",["$scope","$rootScope","$stateParams","$state","$filter","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","viewBillSettlementService","settlementService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSBillAdjustmentList=[],a.billSettlementListSpinner=!1,a.getBillDetails=function(){if(c.billId){a.billSettlementListSpinner=!0;var b={id:c.billId};n.getBillDetails(b,function(b){a.billSettlementListSpinner=!1,a.WSBill=b,a.WSBill.billDate=e("timestampToDate")(b.billDate,"MM/dd/yyyy"),a.WSBill.balance=a.WSBill.amount-a.WSBill.amountSettled},function(b){a.billSettlementListSpinner=!1})}},a.searchBillAdjustmentDetails=function(){c.billId&&c.billTypeCode&&(a.billSettlementListSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.searchCriteria.id=c.billId,a.searchCriteria.typeCode=c.billTypeCode,n.searchBillAdjustmentDetails(a.searchCriteria,function(b){a.billSettlementListSpinner=!1,a.WSBillAdjustmentList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.billSettlementListSpinner=!1}))},a.confirmInactive=function(b,c,e){var f={},i={};f.adjustmentId=b.id,f.targetTypeCode=b.typeCode,f.sourceTypeCode=a.WSBill.typeCode,a.settlementDetails={},n.getBillAdjustmentDetails(f,function(b){i=b,a.inactivateObject={},a.inactivateObject.id=i.adjustmentId,a.inactivateObject.version=i.version,a.inactivateObject.sourceAdjustmentDocumentCode=i.sourceAdjustmentDocumentCode,a.inactivateObject.targetAdjustmentDocumentCode=i.targetAdjustmentDocumentCode,a.inactivateObject.adjustmentDocumentType=i.adjustmentDocumentType,a.inactivateObject.exchangeRate=i.exchangeRate,a.inactivateObject.sourceAmountAdjusted=i.sourceAmountAdjusted,a.inactivateObject.targetAmountAdjusted=i.targetAmountAdjusted,a.inactivateObject.inactiveReason=i.inactiveReason,a.inactivateObject.whetherActive=i.whetherActive,"RECEIPT"==i.targetTypeCode?(a.inactivateObject.receipt={id:i.targetId},a.inactivateObject.bill=null,a.inactivateObject.refundBill=null,a.inactivateObject.payment=null):"PAYMENT"==i.targetTypeCode?(a.inactivateObject.receipt=null,a.inactivateObject.bill=null,a.inactivateObject.refundBill=null,a.inactivateObject.payment={id:i.targetId}):"DEBIT"==i.targetTypeCode?(a.inactivateObject.receipt=null,a.inactivateObject.bill={id:i.targetId},a.inactivateObject.refundBill=null,a.inactivateObject.payment=null):(a.inactivateObject.receipt=null,a.inactivateObject.bill=null,a.inactivateObject.refundBill={id:i.targetId},a.inactivateObject.payment=null),"DEBIT"==i.typeCode?a.inactivateObject.bill={id:i.id}:a.inactivateObject.refundBill={id:i.id},a.inactivateObject.ownerLocationId={id:i.ownerLocationId},o.inactivateSettlement(a.inactivateObject,function(a){g("success",angular.fromJson(a.data).successMessage),d.reload()},function(a){g("error",h.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},function(a){g("error",h.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},a.manageBillSettlement=function(b,e,f,g,h){"add"==f?d.go("managebillsettlement",{type:f,billObject:a.WSBill,billAdjustmentObject:e,id:c.billId,billType:c.billTypeCode}):"edit"==f?d.go("managebillsettlement",{type:f,billObject:a.WSBill,billAdjustmentObject:e,id:c.billId,billType:c.billTypeCode,targetTypeCode:e.typeCode,settlementId:e.id}):d.go("managebillsettlement",{type:f,billObject:a.WSBill,billAdjustmentObject:e,id:c.billId,billType:c.billTypeCode,targetTypeCode:e.typeCode,settlementId:e.id})},a.fetchRecords=function(){a.searchBillAdjustmentDetails()},a.back=function(){m.goBackToPrevState()},a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.searchBillAdjustmentDetails()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchBillAdjustmentDetails()};var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=f.setOptionProperties(p),a.dtColumnDefs=f.setColumnProperties({}),a.init=function(){a.hideNew=!1,null!=c.pageFrom&&(a.hideNew=!0),c.billId&&c.billTypeCode?(a.getBillDetails(),a.searchBillAdjustmentDetails()):d.go("searchbill")},a.init()}]),angular.module("paripal.billingModule").controller("BillSummaryViewCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","addReceiptPaymentService","dateconvertor","$stateParams","commonBillingService","featurePrivilegeConstants","$http","$window","EmergencyTransactionService","notify","$translate","fileOperations","baseService","$sce",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";e.back=function(){var a=k.confirm().title(x.instant("BILL_SUMMARY")).textContent(x.instant("CANCEL_PROCESS_MSG")).ok(x.instant("YES")).cancel(x.instant("NO"));k.show(a).then(function(){d.isFieldEmpty(q.type)?d.goBackToPrevState():c.go(q.type,q.data)},function(){})},e.checkout=function(){var a='<html><head></head><body><form id="loginForm" action="'+e.paymentGatewayUrl+'" method="post"><input type="hidden" name="encRequest" value="'+e.encRequest+'"><input type="hidden" name="access_code" value="'+e.accessCode+'"><input type="hidden" name="merchantParam1" value="'+e.isCordova+'"><input type="hidden" name="merchant_id" value="'+e.merchantId+'"><input type="hidden" name="order_id" value="'+e.orderId+'"><input type="hidden" name="currency" value="'+e.currency+'"><input type="hidden" name="amount" value="'+e.amount+'"><input type="hidden" name="redirect_url" value="'+e.redirectUrl+'"><input type="hidden" name="cancel_url" value="'+e.cancelUrl+'"><input type="hidden" name="language" value="'+e.language+'"><input type="hidden" name="billing_name" value="'+e.billingName+'"><input type="hidden" name="billing_address" value="'+e.billingAddress+'"><input type="hidden" name="billing_city" value="'+e.billingCity+'"><input type="hidden" name="billing_state" value="'+e.billingState+'"><input type="hidden" name="billing_zip" value="'+e.billingZip+'"><input type="hidden" name="billing_country" value="'+e.billingCountry+'"><input type="hidden" name="billing_tel" value="'+e.billingTel+'"><input type="hidden" name="billing_email" value="'+e.billingEmail+'"></form> <script type="text/javascript">document.getElementById("loginForm").submit();</script></body></html>',b="data:text/html;base64,"+btoa(a);if("undefined"!=typeof cordova){var d,f=window.cordova.InAppBrowser.open(b,"_blank","hidden=no,location=no,clearsessioncache=yes,clearcache=yes,zoom=no");f.addEventListener("loadstop",function(a){/*browserRef.executeScript({
                        code: "localStorage.setItem('isInApp', true),var userLanguage=JSON.parse(localStorage.getItem('userLanguage')), localStorage.setItem('userLanguage', userLanguage)"
                    });*/
var b;b=setInterval(function(){a.url.indexOf("payment_close.html#")>-1&&(d=a.url,f.close(),clearInterval(b))},1e3)}),f.addEventListener("exit",function(a){var b=d.split("/"),f=b[b.indexOf("payment_close.html#")+1],g=b[b.indexOf("payment_close.html#")+2];"NEW"==g?c.go("receiptsummary",{receiptId:f}):"FAILURE"==g?(e.showErrorMsg=!0,e.errorMessage="TRANSACTION_UNSUCCESSFUL"):"ABORTED"==g&&(e.showErrorMsg=!0,e.errorMessage="TRANSACTION_ABORTED")})}},e.init=function(){if(e.showAddressBtn=!1,e.isCordova="undefined"!=typeof cordova,e.paymentGatewayUrl=A.trustAsResourceUrl(z.getBaseConfig().paymentGatewayUrl),localStorage.getItem("BillDetails")&&(e.billDetails=angular.fromJson(localStorage.getItem("BillDetails"))),z.getLoggedInUser()&&localStorage.setItem("isOrgUserMode",z.getLoggedInUser().isOrganizationUserMode),e.billSummary={},!d.isFieldEmpty(q.transactionId)){d.isFieldEmpty(q.status)||("FAILURE"==q.status?(e.showErrorMsg=!0,e.errorMessage="TRANSACTION_UNSUCCESSFUL"):"ABORTED"==q.status?(e.showErrorMsg=!0,e.errorMessage="TRANSACTION_ABORTED"):e.showErrorMsg=!1);var a={transactionId:q.transactionId};localStorage.setItem("transactionId",q.transactionId);var b="";b=e.billDetails&&e.billDetails.BILL_FOR?e.billDetails.BILL_FOR:"EMERGENCY_ADMISSION",v.getAutoBillDetails(a,b,function(a){if(e.billingAddress="",e.billObjectList=a.wsBillForAutoView.feeHeads,e.grandTotal=a.amount,"INDIVIDUAL"==a.wsBillForAutoView.raisedOn){if(e.billSummary.raisedOn=a.wsBillForAutoView.raisedOnUser.displayName,e.raisedOnUser=a.wsBillForAutoView.raisedOnUser,a.wsBillForAutoView.raisedOnUser.userAddressToDisplay&&(e.billSummary.raisedOnAddress=a.wsBillForAutoView.raisedOnUser.userAddressToDisplay),a.wsBillForAutoView.raisedOnUser.userAddress){if(d.isFieldEmpty(a.wsBillForAutoView.raisedOnUser.userAddress.addressLine1)||(e.billingAddress=a.wsBillForAutoView.raisedOnUser.userAddress.addressLine1+","),d.isFieldEmpty(a.wsBillForAutoView.raisedOnUser.userAddress.addressLine2)||(e.billingAddress=e.billingAddress+a.wsBillForAutoView.raisedOnUser.userAddress.addressLine2+"\n"),d.isFieldEmpty(a.wsBillForAutoView.raisedOnUser.userAddress.addressLine3)?e.billingAddress.length>0&&(e.billingAddress=e.billingAddress.substring(0,e.billingAddress.length)):e.billingAddress=e.billingAddress+a.wsBillForAutoView.raisedOnUser.userAddress.addressLine3,a.wsBillForAutoView.raisedOnUser.userAddress.city&&(e.billingCity=a.wsBillForAutoView.raisedOnUser.userAddress.city.value),a.wsBillForAutoView.raisedOnUser.userAddress.state&&(e.billingState=a.wsBillForAutoView.raisedOnUser.userAddress.state.value),a.wsBillForAutoView.raisedOnUser.userAddress.postalCode&&(e.billingZip=a.wsBillForAutoView.raisedOnUser.userAddress.postalCode),a.wsBillForAutoView.raisedOnUser.userAddress.country&&(e.billingCountry=a.wsBillForAutoView.raisedOnUser.userAddress.country.value),e.raisedOnUser.id){var b=k.confirm().title(x.instant("BILLING_ADDRESS")).htmlContent("<div class='padding-b-10'>"+a.wsBillForAutoView.raisedOnUser.userAddressToDisplayForReport+"</div><b>"+x.instant("DO_YOU_WANT_TO_CREATE_BILLING_ADDRESS")+"</b>").ok(x.instant("ADD_UPDATE_ADDRESS")).cancel(x.instant("NO"));k.show(b).then(function(){if(a.wsBillForAutoView.raisedOnUser.whetherBillingAddress)var b={type:"edit",userAddressId:e.raisedOnUser.userAddress.userAddressId,navigateFrom:"billSummary",userId:e.raisedOnUser.id,userCode:e.raisedOnUser.userCode,userName:e.raisedOnUser.displayName,isFirstLoggedIn:e.raisedOnUser.whetherFirstLogin};else var b={type:"add",navigateFrom:"billSummary",userId:e.raisedOnUser.id,userCode:e.raisedOnUser.userCode,userName:e.raisedOnUser.displayName,isFirstLoggedIn:e.raisedOnUser.whetherFirstLogin};c.go("manageUserAddress",b)},function(){})}}else{if(e.raisedOnUser&&1==e.raisedOnUser.whetherFirstLogin){var f={type:"add",navigateFrom:"billSummary",userId:e.raisedOnUser.id,userCode:e.raisedOnUser.userCode,userName:e.raisedOnUser.displayName,isFirstLoggedIn:e.raisedOnUser.whetherFirstLogin};c.go("manageUserAddress",f)}e.showAddressBtn=!0}a.wsBillForAutoView.raisedOnUser.userPhone&&(e.billingTel=a.wsBillForAutoView.raisedOnUser.userPhone),a.wsBillForAutoView.raisedOnUser.userEmail&&(e.billingEmail=a.wsBillForAutoView.raisedOnUser.userEmail)}else"ORGANIZATION_LOCATION"==a.wsBillForAutoView.raisedOn&&(e.billSummary.raisedOn=a.wsBillForAutoView.raisedOnOrgLoc.displayName,a.wsBillForAutoView.raisedOnOrgLoc.orgLocAddressToDisplay&&(e.billSummary.raisedOnAddress=a.wsBillForAutoView.raisedOnOrgLoc.orgLocAddressToDisplay),a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress&&(d.isFieldEmpty(a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.addressLine1)||(e.billingAddress=a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.addressLine1+" "),d.isFieldEmpty(a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.addressLine2)||(e.billingAddress=e.billingAddress+a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.addressLine2+" "),d.isFieldEmpty(a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.addressLine3)?e.billingAddress.length>0&&(e.billingAddress=e.billingAddress.substring(0,e.billingAddress.length)):e.billingAddress=e.billingAddress+a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.addressLine3+" ",a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.city&&(e.billingCity=a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.city.value),a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.state&&(e.billingState=a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.state.value),a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.postalCode&&(e.billingZip=a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.postalCode),a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.country&&(e.billingCountry=a.wsBillForAutoView.raisedOnOrgLoc.organizationLocationAddress.country.value)),a.wsBillForAutoView.raisedOnOrgLoc.orgLocPhone&&(e.billingTel=a.wsBillForAutoView.raisedOnOrgLoc.orgLocPhone),a.wsBillForAutoView.raisedOnOrgLoc.orgLocEmail&&(e.billingEmail=a.wsBillForAutoView.raisedOnOrgLoc.orgLocEmail));if(e.billSummary.raisedOn&&(e.billingName=e.billSummary.raisedOn),a.wsBillForAutoView.ownerOrgLoc.displayName&&(e.billSummary.raisedBy=a.wsBillForAutoView.ownerOrgLoc.displayName),a.wsBillForAutoView.ownerOrgLoc.orgLocAddressToDisplay&&(e.billSummary.raisedByAddress=a.wsBillForAutoView.ownerOrgLoc.orgLocAddressToDisplay),!d.isNullOrEmpty(a.wsBillForAutoView.ownerOrgLoc),e.encRequest=a.wsCCAvenueFormData.encRequest,e.accessCode=a.wsCCAvenueFormData.accessCode,e.merchantId=a.merchantId,e.orderId=a.orderId,e.currency=a.currency,e.amount=a.amount,e.redirectUrl=a.redirectUrl,e.cancelUrl=a.cancelUrl,e.language=a.language,a.wsBillForAutoView.ownerOrgLoc.logoDocumentId){var g=new Object;g.fileName=a.wsBillForAutoView.ownerOrgLoc.logoFilePath,g.resourceId=a.wsBillForAutoView.ownerOrgLoc.logoDocumentId,g.docType=n.documentTypes.orgLogo,g.docSubType=n.documentSubTypes.orgLocLogo,g.orgLocId=a.wsBillForAutoView.ownerOrgLoc.id,y.getImageUrl(g,function(a){e.logoUrl=a},function(){})}else e.logoUrl="app/images/billing/hospital.png"},function(){})}e.billSummary.billDate=p.convertToViewDate(new Date)},e.addAddress=function(){if(e.raisedOnUser){var a={type:"add",navigateFrom:"billSummary",userId:e.raisedOnUser.id,userCode:e.raisedOnUser.userCode,userName:e.raisedOnUser.displayName};c.go("manageUserAddress",a)}},e.init()}]),angular.module("paripal.billingModule").controller("ConsolidatedBillCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdMedia","$rootScope","commonConstants","addReceiptPaymentService","dateconvertor","$stateParams","commonBillingService","featurePrivilegeConstants","manageBillService","userStatusService","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.manageBillObject={},e.inFavorOfSSId={},e.partyNameId={},e.locationID=null,e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},e.setMaxRecords=function(a){e.pageNumber=1,e.itemPerPage=a};var w={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.options=a.setOptionProperties(w),e.dtColumnDefs=a.setColumnProperties({}),e.getBillTypes=function(){e.getListOfBillTypes()},e.getListOfBillTypes=function(){return g.getData(h.getUrl("FIND_BILL_TYPE"),null,function(a){e.manageBillObject.billTypeList=angular.fromJson(a.data)},function(a){})},e.getTransactionTypes=function(){q.getListOfTransactionTypes(function(a){e.manageBillObject.transactionTypeList=a},function(a){u("error",v.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getListOfTransactionTypes=function(){return g.getData(h.getUrl("GET_ADHOC_TRANSACTION_TYPE"),null,function(a){e.manageBillObject.transactionTypeList=angular.fromJson(a.data)},function(a){})},e.getServiceTypes=function(){e.getListOfServiceTypes()},e.getListOfServiceTypes=function(){return g.getData(h.getUrl("GET_ADHOC_SERVICE_TYPE"),null,function(a){e.manageBillObject.serviceTypeList=angular.fromJson(a.data)},function(a){})},e.getMadeToOrgList=function(){e.getListOfMadeToOrgs()},e.getListOfMadeToOrgs=function(){return g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN_FOR_BILL"),null,function(a){e.addReceiptObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:r.BILL_VIEW})},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){return g.getData(h.getUrl("FIND_MADE_BY_DROPDOWN"),null,function(a){e.addReceiptObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:r.BILL_VIEW})},e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.billDetails.inFavorOf?e.billDetails.inFavorOfLocationId=a:e.billDetails.inFavorOfUserId=a,e.billDetails.inFavorOfName=a.value},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.billDetails.raisedOn?e.billDetails.raisedOnLocationId=a:e.billDetails.raisedOnUserId=a,e.billDetails.raisedOnName=a.value},e.locationSelected=function(a){e.billDetails.inFavorOfLocationId=a,e.billDetails.inFavorOfName=a.value,e.getCurrencyLocation(a.id),e.locationID=a.id},e.partyNameDDSelected=function(a){e.billDetails.raisedOnLocationId=a,e.billDetails.raisedOnName=a.value},e.getinFavorOfNameData=function(a){e.requestData={};var b="";/*$scope.requestData.type = $scope.filterCriteria.type;*/
return e.requestData.searchKeyword=a,e.requestData.billPartyType=e.billDetails.inFavorOf,e.requestData.noOfSuggestions=m.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?r.BILL_EDIT:"VIEW"==e.pageState?r.BILL_VIEW:r.BILL_ADD,g.postData(h.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.getPartyNameData=function(a){var b="";return e.requestData={},e.requestData.searchKeyword=a,e.requestData.billPartyType=e.billDetails.raisedOn,e.requestData.noOfSuggestions=m.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?r.BILL_EDIT:"VIEW"==e.pageState?r.BILL_VIEW:r.BILL_ADD,g.postData(h.getParameterizedUrl("FIND_RAISED_ON_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.partyTypeSelected=function(){"ORGANIZATION_LOCATION"==e.billDetails.raisedOn||"INDIVIDUAL"==e.billDetails.raisedOn?(e.isMadeFromSSDisabled=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isThirdPartyDisabled=!0):(e.isThirdPartyVisible=!0,e.isThirdPartyDisabled=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!1)},e.inFavorOfTypeSelected=function(){e.inFavorOfSSId={},e.fillInFavorOf()},e.fillInFavorOf=function(){"ORGANIZATION_LOCATION"==e.billDetails.inFavorOf||"INDIVIDUAL"==e.billDetails.inFavorOf?(e.isMadeToSSDisabled=!1,e.isMadeToSSVisible=!0):e.isMadeToSSDisabled=!0},e.getPartyTypes=function(){e.getListOfPartyTypes()},e.getListOfPartyTypes=function(){return g.getData(h.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){e.manageBillObject.inFavorOfTypeList=angular.fromJson(a.data),e.manageBillObject.partyTypeList=angular.fromJson(a.data)},function(a){})},e.back=function(){d.goBackToPrevState()},e.billTypeSelected=function(){e.changePartyStyle()},e.changePartyStyle=function(){"CREDIT"==e.billDetails.typeCode?(e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!1,e.isPartyTypeDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0,e.infavorOfPartyVisible=!0,e.raisedOnPartyVisible=!1,"CREATE"==e.pageState&&(e.billDetails.raisedOn="ORGANIZATION_LOCATION",e.billDetails.inFavorOf=null)):(e.isMadeToSSVisible=!1,e.isMadeToDDVisible=!0,e.isMadeFromSSVisible=!0,e.isMadeFromDDVisible=!1,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!0,e.isPartyTypeDisabled=!1,e.isMadeToDDDisabled=!1,e.isMadeToSSDisabled=!0,e.infavorOfPartyVisible=!1,e.raisedOnPartyVisible=!0,"CREATE"==e.pageState&&(e.billDetails.raisedOn=null,e.billDetails.inFavorOf="ORGANIZATION_LOCATION"))},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){var a="";return a="EDIT"==e.pageState?r.BILL_EDIT:"VIEW"==e.pageState?r.BILL_VIEW:r.BILL_ADD,g.getData(h.getUrl("FIND_MADE_BY_DROPDOWN"),null,function(a){e.manageBillObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})},e.cancel=function(){d.goBackToPrevState()},e.saveManualBill=function(){var a={};d.isFieldEmpty(e.billObject)?(a=angular.copy(e.billDetails),e.billRequestObject=angular.copy(e.billDetails)):(a=angular.copy(e.billObject),e.billRequestObject=angular.copy(e.billObject)),"DEBIT"==e.billDetails.typeCode?(e.billRequestObject.inFavorOf="ORGANIZATION_LOCATION",e.billRequestObject.raisedOn=e.billDetails.raisedOn):(e.billRequestObject.inFavorOf=e.billDetails.inFavorOf,e.billRequestObject.raisedOn="ORGANIZATION_LOCATION"),e.billRequestObject.typeCode=e.billDetails.typeCode,"CREATE"==e.pageState?e.billRequestObject.currency=e.billDetails.currency.id:e.billRequestObject.currency=e.billDetails.currency,d.isFieldEmpty(e.billDetails.billDate)||(e.billRequestObject.billDate=o.convertToServerDate(e.billDetails.billDate)),d.isFieldEmpty(a.billStatus)?e.billRequestObject.billStatus=null:e.billRequestObject.billStatus=a.billStatus,d.isFieldEmpty(e.billDetails.inFavorOfLocationId)?e.billRequestObject.inFavorOfOrgLoc=null:(e.billRequestObject.inFavorOfOrgLoc={},e.billRequestObject.inFavorOfOrgLoc.id=e.billDetails.inFavorOfLocationId.id,e.billRequestObject.inFavorOfOrgLoc.displayName=e.billDetails.inFavorOfLocationId.value),d.isFieldEmpty(e.billDetails.inFavorOfUserId)?e.billRequestObject.inFavorOfUser=null:(e.billRequestObject.inFavorOfUser={},e.billRequestObject.inFavorOfUser.id=e.billDetails.inFavorOfUserId.id,e.billRequestObject.inFavorOfUser.displayName=e.billDetails.inFavorOfUserId.value),d.isFieldEmpty(e.billDetails.raisedOnLocationId)?e.billRequestObject.raisedOnOrgLoc=null:(e.billRequestObject.raisedOnOrgLoc={},e.billRequestObject.raisedOnOrgLoc.id=e.billDetails.raisedOnLocationId.id,e.billRequestObject.raisedOnOrgLoc.displayName=e.billDetails.raisedOnLocationId.value),d.isFieldEmpty(e.billDetails.raisedOnUserId)?e.billRequestObject.raisedOnUser=null:(e.billRequestObject.raisedOnUser={},e.billRequestObject.raisedOnUser.id=e.billDetails.raisedOnUserId.id,e.billRequestObject.raisedOnUser.displayName=e.billDetails.raisedOnUserId.value),e.billRequestObject.amount=e.grandTotal,e.billRequestObject.amountSettled=a.amountSettled,e.billRequestObject.narration=e.billDetails.narration,e.billRequestObject.whetherConsolidated=a.whetherConsolidated,e.billRequestObject.whetherCancelled=a.whetherCancelled,e.billRequestObject.whetherAccounted=a.whetherAccounted,e.billRequestObject.whetherAutoGenerated=a.whetherAutoGenerated,e.billRequestObject.whetherTransactionBased=a.whetherTransactionBased,"CREATE"==e.pageState?e.billRequestObject.raisedBy=e.loggedInUser.id:e.billRequestObject.raisedBy=e.loggedInUser,/*angular.forEach($scope.billRequestObject.billTransactions[0].billItems, function (value, key) {
                angular.forEach($scope.billDetails.taxes, function (value2, key2) {
                    if (value.feeScheduleFeeHead.feeHead.value == key2) {
                        value.amount = value2;
                    }
                });
            });*/
/*angular.forEach($scope.billRequestObject.billTransactions[0].billItems, function (value, key) {
                angular.forEach($scope.billDetails.taxes, function (value2, key2) {
                    if (value.feeHeadName) {
                        if (value.feeHeadName == key2) {
                            if (!utilService.isFieldEmpty(value2)) {
                                value.amount = value2;
                            } else {
                                value.amount = 0;
                            }
                        }
                    }
                });
            });
*/
angular.forEach(e.billRequestObject.billTransactions[0].billItems,function(a,b){d.isFieldEmpty(a)?a.amount=0:a.amount=a}),"CREATE"==e.pageState?s.saveManualBill(e.billRequestObject,function(a){u("success",a.successMessage),c.go("searchbill")},function(a){}):(e.billRequestObject.version=e.billDetails.version,delete e.billRequestObject.transactionTypeId,delete e.billRequestObject.serviceTypeId,delete e.billRequestObject.taxes,delete e.billRequestObject.inFavorOfOrgLoc,delete e.billRequestObject.inFavorOfUser,delete e.billRequestObject.raisedOnOrgLoc,delete e.billRequestObject.raisedOnUser,s.updateManualBill(e.billRequestObject,function(a){u("success",a.successMessage),c.go("searchbill")},function(a){}))},e.getMadeToOrgList=function(){e.getListOfMadeToOrgs()},e.getListOfMadeToOrgs=function(){var a="";return a="EDIT"==e.pageState?r.BILL_EDIT:"VIEW"==e.pageState?r.BILL_VIEW:r.BILL_ADD,g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN_FOR_BILL"),null,function(a){e.manageBillObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})},e.calculateBillTotal=function(a){e.grandTotal=0,q.recomputeBillItems(e.transactionObj.billItems),angular.forEach(e.transactionObj.billItems,function(a,b){var c=parseInt(a);c>=0?(isNaN(c)||(e.grandTotal+=c),e.billDetails.amount=angular.copy(e.grandTotal)):u("error",v.instant("NEGETIVE_VALUES_NOT_ALLOWED"))})},e.$watchGroup(["billDetails.transactionTypeId","billDetails.serviceTypeId","billDetails.currency.id","orgLocation"],function(){if("CREATE"==e.pageState&&!(d.isFieldEmpty(e.billDetails.transactionTypeId)||d.isFieldEmpty(e.billDetails.serviceTypeId)||d.isFieldEmpty(e.billDetails.currency.id)||d.isFieldEmpty(e.orgLocation))){var a={};a.locationId=e.orgLocation.id,a.serviceTypeId=e.billDetails.serviceTypeId,a.transactionTypeId=e.billDetails.transactionTypeId,a.currencyId=e.billDetails.currency.id,s.getFeeHeads(a,function(a){e.billObject=a,e.billObject.amountSettled||(e.billDetails.amountSettled=0),e.billDetails.raisedBy.value=angular.copy(e.loggedInUser.value),e.feeHeadList=a},function(a){u("error")})}}),e.getCurrencys=function(){q.getCurrencyList(function(a){e.manageBillObject.currencyTypeList=a},function(a){u("error",v.instant("CURRENCY_TYPE_LIST_FAILURE"))})},e.getCurrencyLocation=function(a){q.getCurrencyLocation(a,function(a){e.billDetails.currency.id=a.id},function(a){u("error",v.instant("CURRENCY_LOCATION_FAILURE"))})},e.addMonths=function(a,b){return a.setMonth(a.getMonth()+b),a},e.transactionChanged=function(){angular.forEach(e.transactionList,function(a,b){e.transactionModel.id==a.transaction.id&&(e.transactionObj=a)}),e.grandTotal=0,angular.forEach(e.transactionObj.billItems,function(a,b){var c=parseInt(a.amount);c>=0?isNaN(c)||(e.grandTotal+=c):u("error",v.instant("NEGETIVE_VALUES_NOT_ALLOWED"))})},e.init=function(){if(e.billDetails={},e.inFavorOfDD={},e.partyObj={},e.billDetails.currency={},e.billDetails.raisedBy={},e.billReferenceList=[],e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.getBillTypes(),e.getTransactionTypes(),e.getPartyTypes(),e.getMadeFromOrgList(),e.getMadeToOrgList(),e.getCurrencys(),/*$scope.getServiceTypes();*/
e.billDetails.typeCode="DEBIT",e.billTypeSelected(),e.currentDate=new Date,e.maxDate=e.addMonths(new Date,-6),e.pageState="CREATE",e.loggedInUser=t.userStatus().userData,p.billId){var a={id:p.billId};g.getData(h.getParameterizedUrl("FIND_TRANSACTION_BY_BILL",a),null,function(a){e.transactions=angular.fromJson(a.data),e.transactionObj=e.transactions[0],e.transactionId=e.transactions[0].id},function(a){},{}),g.getData(h.getParameterizedUrl("FIND_BILL_BY_ID",a),null,function(a){/*$scope.billDetails.locationId = $scope.orgLocation;*/
if(e.billDetails=angular.fromJson(a.data),e.locationSelected(e.billDetails.ownerLocationId),e.billDetails.serviceTypeId=e.billDetails.billTransactions[0].feeType.serviceType,e.serviceGroup={},e.serviceGroup.id=e.billDetails.billTransactions[0].feeType.serviceTypeGroup,e.billDetails){"edit"==p.type?e.pageState="EDIT":"view"==p.type&&(e.pageState="VIEW",e.isDisabled="a-disabled"),e.billDetails.billDate=o.convertToViewDate(e.billDetails.billDate),d.isFieldEmpty(e.billDetails.billTransactions)||(e.billReferenceList=e.billDetails.billTransactions[0].billItems,e.billDetails.transactionTypeId=e.billDetails.billTransactions[0].feeType.transactionType.id),"DEBIT"==e.billDetails.typeCode?(d.isFieldEmpty(e.billDetails.inFavorOfLocationId)||(e.billId=e.billDetails.inFavorOfLocationId),d.isFieldEmpty(e.billDetails.raisedOnUserId)?e.partyNameId.id=e.billDetails.raisedOnLocationId:e.partyNameId.id=e.billDetails.raisedOnUserId):(d.isFieldEmpty(e.billDetails.raisedOnLocationId)||(e.billId=e.billDetails.raisedOnLocationId),d.isFieldEmpty(e.billDetails.inFavorOfUserId)?e.inFavorOfSSId.id=e.billDetails.inFavorOfLocationId:e.inFavorOfSSId.id=e.billDetails.inFavorOfUserId),e.transactionList=e.billDetails.billTransactions,e.transactionObj=e.transactionList[0],/* $scope.billDetails.taxes = {};
 $scope.grandTotal = 0;
 var feeHeads = $scope.transactionList[0].billItems;
 feeHeads.forEach(function (feeHeadObj) {
     $scope.billDetails.taxes[feeHeadObj.feeScheduleFeeHead.feeHead.value] = feeHeadObj.amount;
     $scope.grandTotal = $scope.grandTotal + feeHeadObj.amount;
 });*/
e.grandTotal=0;var b=e.transactionList[0].billItems;b.forEach(function(a){e.grandTotal+=a.amount}),e.billTypeSelected()}},function(a){})}},e.init()}]),angular.module("paripal.billingModule").controller("CreateBillCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","addReceiptPaymentService","dateconvertor","$stateParams","commonBillingService","featurePrivilegeConstants","manageBillService","userStatusService","notify","$translate","$http","$window","baseService","manageRequestService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";function B(a,b,c,d,e){a.feeHead=e,a.total=0,a.amountChanged=function(){a.total=0,angular.forEach(a.rowList,function(b,c){b.value&&null!=b.value&&(a.total=a.total+parseFloat(parseFloat(b.value).toFixed(2)))})},a.rowList=[{}],b.isFieldEmpty(e)||b.isNullOrEmpty(e.billItemDetails)||0==e.billItemDetails.length||(a.rowList=e.billItemDetails),a.addRow=function(){a.rowList.push({})},a.removeRow=function(b){a.rowList.pop()},a.rateChanged=function(a,c){b.isNullOrEmpty(a.quantity)||b.isNullOrEmpty(a.rate)?b.isNullOrEmpty(a.quantity)&&!b.isNullOrEmpty(a.rate)?a.value=a.rate:!b.isNullOrEmpty(a.quantity)&&b.isNullOrEmpty(a.rate)&&(a.value=null,a.rate=null,a.quantity=null):a.value=(a.quantity*a.rate).toFixed(2)},a.cancel=function(){c.hide()},a.saveDescription=function(){var b=0;angular.forEach(a.rowList,function(a,c){b+=parseFloat(parseFloat(a.value).toFixed(2))}),e.netAmount!=b?d("error",w.instant("BREAKDOWN_NOT_EQUAL_TO_NET")):(e.billItemDetails=a.rowList,c.hide(e))}}/*var commonConstants = commonConstants;*/
B.$inject=["$scope","utilService","$mdDialog","notify","feeHead"],e.currentPage=n.defaultPageNo,e.itemPerPage=n.itemPerPage,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.manageBillObject={},e.inFavorOfSSId={},e.partyNameId={},e.isRaisedOnRequired=!0,e.isInFavorOfRequired=!0,e.enableRaisedOn=!1,e.enableInFavorOf=!1,e.saveEnable=!0,e.isPartTypeInFavorOfRequired=!1,e.isPartTypeRaisedOnRequired=!1,e.serviceComboDisable=!1,e.isLocationChanged=!0,e.previousOrg=null,e.feeHeadList=[];e.netAmount=0,e.discountPercentage=0,e.discountAmount=0,e.totalDiscountAmount=0,e.totalDisAmount=0,e.receiptBalanceAmount=0,e.totalReceiptAmount=0,e.showAddFeeHeadBtn=!0;var C=[];// this list is to compare amount for refund
e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},e.setMaxRecords=function(a){e.pageNumber=1,e.itemPerPage=a};var D={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.options=a.setOptionProperties(D),e.dtColumnDefs=a.setColumnProperties({});var E=function(){return g.getData(h.getUrl("FIND_BILL_TYPE"),null,function(a){e.manageBillObject.billTypeList=angular.fromJson(a.data)},function(a){})};e.calculateDiscount=function(a){e.totalDisAmt=a,e.totalDiscountAmount=parseFloat(a/100*e.grandTotal),e.totalDiscountAmount?(e.netAmount=e.grandTotal-e.totalDiscountAmount,e.receiptPaymentItems[0]&&null!=e.receiptPaymentItems[0]&&(e.receiptPaymentItems[0].amount=e.netAmount)):(e.netAmount=e.grandTotal,e.receiptPaymentItems[0]&&null!=e.receiptPaymentItems[0]&&(e.receiptPaymentItems[0].amount=e.netAmount))},e.calculateTotalDiscountPercentage=function(){e.discountPercentage=0,angular.forEach(e.feeHeadList,function(a,b){a.discountPercentage&&(e.discountPercentage=e.discountPercentage+a.discountPercentage)})},e.calculateTotalDiscountAmount=function(){e.discountAmount=0,angular.forEach(e.feeHeadList,function(a,b){a.discountAmount&&(e.discountAmount=e.discountAmount+a.discountAmount)})},e.calculateNetAmount=function(){e.grandTotal=0,angular.forEach(e.feeHeadList,function(a,b){a.netAmount&&(e.grandTotal=e.grandTotal+a.netAmount)}),e.grandTotal>0&&(e.saveEnable=!1,e.totalDiscountPrecentage||(e.totalDiscountPrecentage=0,e.netAmount=e.grandTotal,e.receiptPaymentItems[0]&&null!=e.receiptPaymentItems[0]&&(e.receiptPaymentItems[0].amount=e.netAmount)),e.totalDiscountAmount||(e.totalDiscountAmount=0,e.netAmount=e.grandTotal,e.receiptPaymentItems[0]&&null!=e.receiptPaymentItems[0]&&(e.receiptPaymentItems[0].amount=e.netAmount))),e.calculateDiscount(e.totalDisAmt),e.calculateTotalDisAmount(e.totalDisAmount),e.billDetails.amount=e.grandTotal},e.calculateNetResidualAmount=function(){e.residualTotal=0,angular.forEach(e.feeHeadList,function(a,b){a.amount&&(e.residualTotal=e.residualTotal+a.amount)})},e.calculateDiscountPercentage=function(a,b){a.amount>=0&&a.discountPercentage>=0&&angular.forEach(e.feeHeadList,function(c,d){(null===c.transId||c.transId)&&delete c.transId,d==b&&(a.discountPercentage<=100?(c.discountAmount=Math.round(a.amount*(a.discountPercentage/100)),c.netAmount=a.amount-c.discountAmount):(c.discountPercentage=0,c.discountAmount=0,a.discountPercentage=0,a.discountAmount=0))}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),e.calculateNetAmount(),e.calculateTotalDisAmount(),r.getAdhocBillTaxes(e.feeHeadList,function(a){e.feeHeadList=a,angular.forEach(e.feeHeadList,function(a,b){a.feeHeadGroupId&&delete a.feeHeadGroupId}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),e.calculateNetAmount(),e.calculateTotalDisAmount()},function(a){})},e.getPaymentModes=function(){return g.getData(h.getUrl("GET_PAYMENT_MODE"),null,function(a){e.paymentModeList=angular.fromJson(a.data)},function(a){})},e.calculateDiscountTotal=function(a,b){a.amount>=0&&a.discountAmount>=0&&angular.forEach(e.feeHeadList,function(c,d){(null===c.transId||c.transId)&&delete c.transId,d==b&&(a.discountAmount<a.amount?(c.discountPercentage=Math.round(a.discountAmount/a.amount*100),c.netAmount=a.amount-a.discountAmount):(c.discountAmount=0,c.discountPercentage=0,a.discountAmount=0,a.discountPercentage=0))}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),e.calculateNetAmount(),e.calculateTotalDisAmount(),r.getAdhocBillTaxes(e.feeHeadList,function(a){e.feeHeadList=a,angular.forEach(e.feeHeadList,function(a,b){a.feeHeadGroupId&&delete a.feeHeadGroupId}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),e.calculateNetAmount(),e.calculateTotalDisAmount()},function(a){})};var F=function(){r.getListOfTransactionTypes(function(a){e.manageBillObject.transactionTypeList=a},function(a){v("error",w.instant("TRANSACTION_TYPE_LIST_FAILURE"))})};e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.billDetails.inFavorOf?e.billDetails.inFavorOfLocationId=a:e.billDetails.inFavorOfUserId=a,e.billDetails.inFavorOfName=a.value},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.billDetails.raisedOn?(e.billDetails.raisedOnLocationId=a,e.billDetails.raisedOnUserId=null):(e.billDetails.raisedOnUserId=a,e.billDetails.raisedOnLocationId=null),e.billDetails.raisedOnName=a.value};var G=function(a){"REFUND"!==e.pageState&&d.isNullOrEmpty(q.data)&&(/*if (utilService.isNullOrEmpty($stateParams.data.fromCheckIn)) {*/
e.billDetails.amount=null,e.grandTotal=null,e.refundTotal=angular.copy(e.grandTotal),e.billDetails.serviceGroup={},e.serviceTypeId={})};e.locationChanged=function(a){(!e.previousOrg||e.previousOrg&&e.previousOrg.id!=a.id)&&(e.previousOrg=a,e.isLocationChanged=!0),e.enableRaisedOn=!0,e.enableInFavorOf=!0,d.isNullOrEmpty(q.data)&&(e.partyNameId={}),e.getOrgLoc=a,"CREDIT"==e.billDetails.typeCode?(e.billDetails.raisedOnLocationId=a,e.billDetails.inFavorOfLocationId=null):(e.billDetails.inFavorOfLocationId=a,e.billDetails.raisedOnLocationId=null),e.billDetails.inFavorOfName=a.value,O(a.id),G(a)},e.addFeeHead=function(){var a=!1;e.tempTransId=null,angular.forEach(e.feeHeadList,function(b,c){null==e.tempTransId&&null!=b.transactionId&&(e.tempTransId=b.transactionId),b.feeHeadName==e.selectedFeeHead.feeHeadName&&(a=!0)}),1!=a&&(e.selectedFeeHead.netAmount=e.selectedFeeHead.amount,e.selectedFeeHead.feeHeadName=e.selectedFeeHead.feeHeadName.slice(0,e.selectedFeeHead.feeHeadName.lastIndexOf("-")),null!=e.tempTransId&&(e.selectedFeeHead.transactionId=e.tempTransId),e.feeHeadList.push(e.selectedFeeHead),angular.forEach(e.feeHeadList,function(a,b){a.feeHeadGroupId&&delete a.feeHeadGroupId,(null===a.transId||a.transId)&&delete a.transId}),r.getAdhocBillTaxes(e.feeHeadList,function(a){e.feeHeadList=a,angular.forEach(e.feeHeadList,function(a,b){a.feeHeadGroupId&&delete a.feeHeadGroupId,(null===a.transId||a.transId)&&delete a.transId,null!=a.transactionId&&a.transactionId||!e.tempTransId||(a.transactionId=e.tempTransId)}),e.calculateNetAmount(),e.calculateTotalDisAmount()},function(a){})),e.selectedFeeHead=null},e.removeFeeHead=function(a,b){e.feeHeadList.splice(b,1);r.getAdhocBillTaxes(e.feeHeadList,function(a){e.feeHeadList=a,angular.forEach(e.feeHeadList,function(a,b){a.feeHeadGroupId&&delete a.feeHeadGroupId,(null===a.transId||a.transId)&&delete a.transId,null!=a.transactionId&&a.transactionId||!e.tempTransId||(a.transactionId=e.tempTransId)}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),e.calculateNetAmount(),e.calculateNetResidualAmount(),e.calculateNetAmount(),e.calculateTotalDisAmount()},function(a){})},e.removeReceiptItems=function(a,b){e.receiptPaymentItems.splice(b,1)},e.getinFavorOfNameData=function(a){e.requestData={};var b="";/*$scope.requestData.type = $scope.filterCriteria.type;*/
return e.requestData.searchKeyword=a,e.requestData.billPartyType=e.billDetails.inFavorOf,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?s.BILL_EDIT:"VIEW"==e.pageState?s.BILL_VIEW:s.BILL_ADD,g.postData(h.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.getFeeHeads=function(a){if(e.requestData={},e.requestData.keyword=a,e.requestData.orgLocId=e.orgLocation.id,e.requestData.orgLocId&&null!=e.requestData.orgLocId)return g.getData(h.getParameterizedUrl("GET_FEE_HEAD_LIST_FOR_CREATE_BILL",e.requestData),null,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getPartyNameData=function(a){var b="";return e.requestData={},e.requestData.searchKeyword=a,e.requestData.billPartyType=e.billDetails.raisedOn,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.requestData.orgLocationId=e.getOrgLoc.id,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?s.BILL_EDIT:"VIEW"==e.pageState?s.BILL_VIEW:s.BILL_ADD,g.postData(h.getParameterizedUrl("FIND_RAISED_ON_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.partyTypeSelected=function(){/*CONDITON TO DISABLE RAISED ON COMES HERE*/
"ORGANIZATION_LOCATION"==e.billDetails.raisedOn||"INDIVIDUAL"==e.billDetails.raisedOn?(e.isMadeFromSSDisabled=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isThirdPartyDisabled=!0):(e.isThirdPartyVisible=!0,e.isThirdPartyDisabled=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!1)},e.inFavorOfTypeSelected=function(){e.inFavorOfSSId={},H()};var H=function(){/*CONDITON TO DISABLE RAISED ON COMES HERE*/
"ORGANIZATION_LOCATION"==e.billDetails.inFavorOf||"INDIVIDUAL"==e.billDetails.inFavorOf?(e.isMadeToSSDisabled=!1,e.isMadeToSSVisible=!0):e.isMadeToSSDisabled=!0},I=function(){return g.getData(h.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){e.manageBillObject.inFavorOfTypeList=angular.fromJson(a.data),e.manageBillObject.partyTypeList=angular.fromJson(a.data)},function(a){})};e.back=function(){d.goBackToPrevState()},e.billTypeSelected=function(){e.whetherFeeHeadAmntEdit||(e.orgLocation=-1),J(),"CREDIT"==e.billDetails.typeCode?e.isPartTypeInFavorOfRequired=!0:e.isPartTypeRaisedOnRequired=!0};var J=function(){"CREDIT"==e.billDetails.typeCode?(e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isRaisedOnRequired=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!1,e.isPartyTypeDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0,e.infavorOfPartyVisible=!0,e.raisedOnPartyVisible=!1,
//if ($scope.pageState == "CREATE" || ($scope.pageState === 'VIEW' && $scope.whetherFeeHeadAmntEdit == 'YES')) {
"CREATE"==e.pageState&&d.isNullOrEmpty(e.billDetails.fromCheckIn)&&(e.billDetails.raisedOn="ORGANIZATION_LOCATION",e.billDetails.inFavorOf=null)):(e.isInFavorOfRequired=!1,e.isMadeToSSVisible=!1,e.isMadeToDDVisible=!0,e.isMadeFromSSVisible=!0,e.isMadeFromDDVisible=!1,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!0,e.isPartyTypeDisabled=!1,e.isMadeToDDDisabled=!1,e.isMadeToSSDisabled=!0,e.infavorOfPartyVisible=!1,e.raisedOnPartyVisible=!0,
//     if ($scope.pageState == "CREATE" || ($scope.pageState === 'VIEW' && $scope.whetherFeeHeadAmntEdit == 'YES')) {
"CREATE"==e.pageState&&d.isNullOrEmpty(q.data)&&(e.billDetails.raisedOn=null,e.billDetails.inFavorOf="ORGANIZATION_LOCATION"))},K=function(){var a="";return a="EDIT"==e.pageState?s.BILL_EDIT:"VIEW"==e.pageState?s.BILL_VIEW:s.BILL_ADD,g.getData(h.getUrl("FIND_MADE_BY_DROPDOWN"),null,function(a){e.manageBillObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})};e.cancel=function(){d.goBackToPrevState()},e.calculateTotalReceiptAmount=function(){j(function(){e.totalReceiptAmount=0,angular.forEach(e.receiptPaymentItems,function(a,b){a.amount&&(e.totalReceiptAmount=parseFloat(e.totalReceiptAmount)+parseFloat(a.amount))}),e.netAmount-e.totalReceiptAmount>=0?e.receiptBalanceAmount=e.netAmount-e.totalReceiptAmount:e.receiptBalanceAmount=0},100)},e.addPaymentReference=function(){e.receiptPaymentItems.push({whetherDeposited:!1,whetherRealized:!1,amount:e.netAmount,paymentRefDate:new Date,paymentMode:e.defaultPaymentMode}),e.totalReceiptAmount=0,angular.forEach(e.receiptPaymentItems,function(a,b){a.amount&&(e.totalReceiptAmount=parseFloat(e.totalReceiptAmount)+parseFloat(a.amount))}),e.netAmount-e.totalReceiptAmount>=0?e.receiptBalanceAmount=e.netAmount-e.totalReceiptAmount:e.receiptBalanceAmount=0},e.confirmManualBill=function(){var a=k.confirm().title(w.instant("BILLING_CONFIRMATION_TITLE")).textContent(w.instant("BILLING_CONFIRMATION_MSG")).ok(w.instant("OK")).cancel(w.instant("CANCEL"));k.show(a).then(function(){j(function(){e.saveManualBill()},100)},function(){})},e.saveManualBill=function(){m.showSpinner=!0;var a={};d.isFieldEmpty(e.feeHeadList)?(a=angular.copy(e.billDetails),e.billRequestObject=angular.copy(e.billDetails),""==e.pageState&&(e.billRequestObject.billTransactions=angular.copy(e.billDetails.billTransactions))):(a=angular.copy(e.feeHeadList),e.billRequestObject={billTransactions:[{billItems:angular.copy(e.feeHeadList)}]}),"DEBIT"==e.billDetails.typeCode?(e.billRequestObject.inFavorOf="ORGANIZATION_LOCATION",e.billRequestObject.raisedOn=e.billDetails.raisedOn):(e.billRequestObject.inFavorOf=e.billDetails.inFavorOf,e.billRequestObject.raisedOn="ORGANIZATION_LOCATION"),e.billRequestObject.typeCode=e.billDetails.typeCode,"CREATE"==e.pageState||""==e.pageState||"REFUND"===e.pageState?e.billRequestObject.currency=e.billDetails.currency.id:e.billRequestObject.currency=e.billDetails.currency,d.isFieldEmpty(e.billDetails.billDate)||(e.billRequestObject.billDate=p.convertToServerDate(e.billDetails.billDate)),d.isFieldEmpty(e.billDetails.refDebitBillId)||(e.billRequestObject.refDebitBillId={id:e.billDetails.refDebitBillId}),d.isFieldEmpty(a.billStatus)?e.billRequestObject.billStatus=null:e.billRequestObject.billStatus=a.billStatus,d.isFieldEmpty(e.billDetails.inFavorOfLocationId)?e.billRequestObject.inFavorOfLocationId=null:e.billRequestObject.inFavorOfLocationId=e.billDetails.inFavorOfLocationId.id,d.isFieldEmpty(e.billDetails.inFavorOfUserId)?e.billRequestObject.inFavorOfUserId=null:e.billRequestObject.inFavorOfUserId=e.billDetails.inFavorOfUserId.id,d.isFieldEmpty(e.billDetails.inFavorOfLocationId)?e.billRequestObject.inFavorOfName=e.billDetails.inFavorOfUserId.value:e.billRequestObject.inFavorOfName=e.billDetails.inFavorOfLocationId.value,d.isFieldEmpty(e.billDetails.raisedOnLocationId)?e.billRequestObject.raisedOnLocationId=null:e.billRequestObject.raisedOnLocationId=e.billDetails.raisedOnLocationId.id,d.isFieldEmpty(e.billDetails.raisedOnUserId)?e.billRequestObject.raisedOnUserId=null:e.billRequestObject.raisedOnUserId=e.billDetails.raisedOnUserId.id,d.isFieldEmpty(e.billDetails.raisedOnLocationId)?d.isFieldEmpty(e.billDetails.raisedOnUserId)?e.billRequestObject.raisedOnName=e.orgLocation.value:e.billRequestObject.raisedOnName=e.billDetails.raisedOnUserId.value:e.billRequestObject.raisedOnName=e.billDetails.raisedOnLocationId.value,e.billRequestObject.ownerLocationId=e.orgLocation.id,e.billRequestObject.amount=e.grandTotal,e.billRequestObject.amountSettled=a.amountSettled,e.billRequestObject.narration=e.billDetails.narration,e.billRequestObject.whetherConsolidated=a.whetherConsolidated,e.billRequestObject.whetherCancelled=a.whetherCancelled,e.billRequestObject.whetherAccounted=a.whetherAccounted,e.billRequestObject.whetherAutoGenerated=a.whetherAutoGenerated,e.billRequestObject.whetherTransactionBased=a.whetherTransactionBased,e.billRequestObject.discountAmount=e.totalDisAmount,e.billRequestObject.netAmount=e.netAmount,e.billRequestObject.discountPercentage=e.totalDiscountPrecentage,"CREATE"==e.pageState||""==e.pageState||"REFUND"===e.pageState?e.billRequestObject.raisedBy=e.loggedInUserID:e.billRequestObject.raisedBy=e.loggedInUser,d.isEmpty(e.billDetails.billTransactions)||d.isFieldEmpty(e.billDetails.billTransactions[0].transaction)?"CREATE"!=e.pageState&&"REFUND"!==e.pageState||angular.forEach(e.billRequestObject.billTransactions,function(a,b){a.bill=null,a.feeType=a.billItems[0].feeTypeId,a.feeSchedule=e.feeScheduleId,/*value.feeType = value.feeType;*/
a.transaction=null,angular.forEach(a.billItems,function(a,b){!e.feeScheduleId||a.feeScheduleId&&null!=a.feeScheduleId||(a.feeScheduleId=e.feeScheduleId),(a.transId||null==a.transId)&&delete a.transId,(a.roundOff||null==a.roundOff)&&delete a.roundOff})}):
// $scope.billRequestObject.billTransactions[0].transaction = $scope.billDetails.billTransactions[0].transaction;
e.billRequestObject.billTransactions=angular.copy(e.billDetails.billTransactions),/*            angular.forEach($scope.billRequestObject.billTransactions[0].billItems, function (value, key) {
                            if (!(value.feeHeadName in $scope.billDetails.taxes)) {
                                $scope.billDetails.taxes[value.feeHeadName] = 0;
                            }
                        });*/
angular.forEach(e.billRequestObject.billTransactions[0].billItems,function(a,b){angular.forEach(e.billDetails.taxes,function(b,c){a.feeHeadName&&a.feeHeadName==c&&(d.isFieldEmpty(b)?a.netAmount=0:a.netAmount=b)})}),d.isNullOrEmpty(q.data)||d.isNullOrEmpty(q.data.transaction)||(e.billRequestObject.transaction=q.data.transaction),e.receiptPaymentItems.length>0&&(e.billRequestObject.wsReceiptPayment={receiptPaymentItems:e.receiptPaymentItems}),e.receiptTotalAmount=0,angular.forEach(e.receiptPaymentItems,function(a,b){e.receiptTotalAmount=e.receiptTotalAmount+parseFloat(a.amount)}),e.receiptPaymentItems.length>0&&("DEBIT"==e.billRequestObject.typeCode?e.billRequestObject.wsReceiptPayment.typeCode="RECEIPT":e.billRequestObject.wsReceiptPayment.typeCode="PAYMENT",e.billRequestObject.wsReceiptPayment.whetherAccounted=!1,e.billRequestObject.wsReceiptPayment.whetherAutoGenerated=!1,e.billRequestObject.wsReceiptPayment.whetherCancelled=!1,e.billRequestObject.wsReceiptPayment.amount=e.receiptTotalAmount);var b={};"DEBIT"==e.billRequestObject.typeCode?b.adjustmentDocumentType="BILL_TO_RECEIPT":b.adjustmentDocumentType="REFUND_BILL_TO_PAYMENT",e.billRequestObject.netAmount>=e.receiptTotalAmount?(b.sourceAmountAdjusted=e.receiptTotalAmount,b.targetAmountAdjusted=e.receiptTotalAmount,e.receiptPaymentItems.length>0&&(e.billRequestObject.wsReceiptPayment.amountSettled=e.receiptTotalAmount),e.billRequestObject.amountSettled=e.receiptTotalAmount):(b.sourceAmountAdjusted=e.billRequestObject.netAmount,b.targetAmountAdjusted=e.billRequestObject.netAmount,e.receiptPaymentItems.length>0&&(e.billRequestObject.wsReceiptPayment.amountSettled=e.billRequestObject.netAmount),e.billRequestObject.amountSettled=e.billRequestObject.netAmount),e.receiptPaymentItems.length>0&&(e.billRequestObject.wsReceiptPayment.wsBillAdjustment=b);var f=[],g=[];angular.forEach(e.billRequestObject.billTransactions,function(a,b){angular.forEach(a.billItems,function(a,b){if(a.transactionId&&f.indexOf(a.transactionId)==-1){var c={};c.feeScheduleId=angular.copy(a.feeScheduleId),c.feeTypeId=angular.copy(a.feeTypeId),c.transactionId=a.transactionId,f.push(a.transactionId),g.push(c)}})});var h=[];angular.forEach(g,function(a,b){var c=e.billRequestObject.billTransactions[0];c.transaction=angular.copy(a.transactionId),c.feeSchedule=angular.copy(a.feeScheduleId),c.feeType=angular.copy(a.feeTypeId),0!=b&&(c.billItems=null),h.push(angular.copy(c))}),f.length>0&&(e.billRequestObject.billTransactions=h),"REFUND"==e.pageState?(delete e.billRequestObject.totalRefundedAmount,delete e.billRequestObject.whetherRefundAllowed,
//delete $scope.billRequestObject.refDebitBillId;
delete e.billRequestObject.transactionTypeId,delete e.billRequestObject.serviceTypeId,delete e.billRequestObject.serviceGroup,delete e.billRequestObject.serviceTypeGroup,delete e.billRequestObject.serviceType,t.saveRefundBill(e.billRequestObject,function(a){m.showSpinner=!1,v("success",a.successMessage),q.parentState?c.go(q.parentState,q.parentParams):c.go("searchbill")},function(a){m.showSpinner=!1})):t.saveManualBill(e.billRequestObject,function(a){m.showSpinner=!1,d.isNullOrEmpty(e.billDetails.fromCheckIn)?(v("success",a.successMessage),q.parentState?c.go(q.parentState,q.parentParams):c.go("searchbill")):c.go("managebill",{parentState:"APPOINTMENT",billId:a.response,type:"view",createReceipt:!0,appointmentDetails:null,showAutoPDF:!0})},function(a){m.showSpinner=!1})};var L=function(){var a=s.BILL_ADD;return g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN_FOR_BILL"),null,function(a){e.manageBillObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})},M=function(){e.grandTotal=0,e.refundTotal=angular.copy(e.grandTotal),r.recomputeBillItems(e.feeHeadList),angular.forEach(e.feeHeadList,function(a,b){var c=a.netAmount;c>=0?(isNaN(c)||(e.grandTotal+=c),e.refundTotal=angular.copy(e.grandTotal),e.billDetails.amount=angular.copy(e.grandTotal)):d.isFieldEmpty(c)||(a.amount=0,v("error",w.instant("NEGETIVE_VALUES_NOT_ALLOWED"))),e.refundTotal<e.grandTotal&&"REFUND"===e.pageState&&"YES"==e.whetherFeeHeadAmntEdit&&(e.grandTotal=angular.copy(e.refundTotal),e.billDetails.amount=angular.copy(e.grandTotal),v("error",w.instant("REFUND_AMNT_CANNOT_BE_GREATER_THAN_BILL_AMNT")))}),!e.grandTotal>0&&(e.billDetails.amount=0),e.grandTotal>0&&(e.saveEnable=!1),e.totalDiscountAmount?e.calculateTotalDisAmount(e.totalDiscountAmount):e.calculateDiscount(e.totalDiscountPrecentage)};e.calculateBillTotal=function(a,b){if(r.getAdhocBillTaxes(e.feeHeadList,function(a){e.feeHeadList=a,angular.forEach(e.feeHeadList,function(a,b){a.feeHeadGroupId&&delete a.feeHeadGroupId,(null===a.transId||a.transId)&&delete a.transId}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),M()},function(a){}),"REFUND"===e.pageState){var b=e.feeHeadList.indexOf(a);b!=-1&&C[b].amount<e.feeHeadList[b].amount&&(e.feeHeadList[b].amount=angular.copy(C[b].amount),v("error",w.instant("REFUND_FEE_HEAD_AMNT_CANNOT_BE_GREATER_THAN_ORIGINAL_FEE_HEAD_AMNT")))}angular.forEach(e.feeHeadList,function(c,d){b==d&&c.amount==a.amount&&(a.netAmount>c.amount?(c.discountPercentage=0,c.discountAmount=0):(c.discountAmount=c.amount-a.netAmount,c.discountPercentage=parseFloat((c.discountAmount/c.amount*100).toFixed(2))))}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),M()},e.getRoundOffValue=function(a){e.feeHeadList[e.feeHeadList.indexOf(a)].amount=d.getRoundOffValue(a.roundOff,a.amount),e.calculateBillTotal(a)},e.$watchGroup(["billDetails.transactionTypeId","serviceTypeId","billDetails.currency.id","orgLocation","serviceTypeList"],function(){if(!q.transactionList&&("CREATE"==e.pageState||q.data.fromCheckIn)&&1==e.isLocationChanged&&(1!=q.isFromBillList&&(e.isLocationChanged=!1),!d.isFieldEmpty(e.billDetails.transactionTypeId)&&!d.isFieldEmpty(e.orgLocation))){e.previousOrg||(e.previousOrg=e.orgLocation);var a=[],b={};e.billDetails.ownerLocationId?b.locationId=e.billDetails.ownerLocationId.id:b.locationId=e.orgLocation.id,d.isFieldEmpty(e.serviceTypeId)?e.serviceTypeList.length>0&&(b.serviceTypeIds=e.serviceTypeList):b.serviceTypeId=e.serviceTypeId.id,b.transactionTypeId=e.billDetails.transactionTypeId,d.isFieldEmpty(e.billDetails.currency.id)||(b.currencyId=e.billDetails.currency.id),a.push(b),angular.forEach(a,function(a,b){a.locationId=e.orgLocation.id}),t.getFeeHeads(a,function(a){a[0].feeHeadId?(e.grandTotal=0,e.refundTotal=angular.copy(e.grandTotal),e.billDetails.amount=0,e.billObject=a,e.billObject.amountSettled||(e.billDetails.amountSettled=0),angular.forEach(e.billObject,function(a,b){a.netAmount=a.amount}),e.billDetails.billTransactions=[],e.billDetails.billTransactions.push(e.billObject),e.billDetails.raisedBy.value=angular.copy(e.loggedInUser),e.feeScheduleId=a[0].feeScheduleId,e.feeHeadList=a,C=angular.copy(e.feeHeadList),e.calculateNetResidualAmount(),angular.forEach(e.feeHeadList,function(a,b){a.amount&&(e.grandTotal=e.grandTotal+a.netAmount)}),e.grandTotal>0&&(e.saveEnable=!1,e.totalDiscountPrecentage||(e.totalDiscountPrecentage=0,e.netAmount=e.grandTotal,e.receiptPaymentItems[0]&&(e.receiptPaymentItems[0].amount=e.netAmount)),e.totalDiscountAmount||(e.totalDiscountAmount=0,e.netAmount=e.grandTotal,e.receiptPaymentItems[0]&&(e.receiptPaymentItems[0].amount=e.netAmount)),e.billDetails.amount=e.netAmount)):e.feeScheduleId=a[0].feeScheduleId},function(a){})}});var N=function(){r.getCurrencyList(function(a){e.manageBillObject.currencyTypeList=a},function(a){v("error",w.instant("CURRENCY_TYPE_LIST_FAILURE"))})},O=function(a){r.getCurrencyLocation(a,function(a){d.isNullOrEmpty(e.billDetails.currency)&&(e.billDetails.currency={}),e.billDetails.currency.id=a.id},function(a){v("error",w.instant("CURRENCY_LOCATION_FAILURE"))})};e.calculateTotalDisAmount=function(a){a&&(e.totalDisAmount=a,e.netAmount=e.grandTotal-a,e.receiptPaymentItems[0]&&null!=e.receiptPaymentItems[0]&&(e.receiptPaymentItems[0].amount=e.netAmount),e.totalDiscountPrecentage=parseFloat(a/e.grandTotal*100))};var P=function(a,b){return a.setMonth(a.getMonth()+b),a};e.addDescription=function(a){k.show({clickOutsideToClose:n.dialogBox.clickOutsideToClose,scope:e,preserveScope:!0,parent:angular.element(document.body),templateUrl:"app/modules/billing/views/add-description-popup.html",controller:B,locals:{feeHead:a}}).then(function(a){})},e.getDefaultPaymentType=function(){var a={};a.pickListCode="payment_mode",a.pickListItemCode="PAYMENT_MODE_CASH",A.getPicklistWSByCode(a,function(a){e.defaultPaymentMode=a.data},function(a){})};var Q=function(){if(e.billDetails={},e.inFavorOfDD={},e.partyObj={},e.billDetails.currency={},e.billDetails.raisedBy={},e.billReferenceList=[],e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.serviceTypeList=[],E(),F(),I(),K(),e.getPaymentModes(),e.getDefaultPaymentType(),e.minDate=P(new Date,-6),e.receiptPaymentItems=[],e.maxReceipyDate=new Date,d.isNullOrEmpty(q.ownerLocationId)&&L(),/*getListOfMadeToOrgs();*/
N(),d.isNullOrEmpty(q.type)?e.billDetails.typeCode="DEBIT":e.billDetails.typeCode=q.type,e.billTypeSelected(),e.commonConstants=n,e.currentDate=new Date,e.maxDate=P(new Date,-6),e.totalRefundAllowed=0,e.pageState="CREATE",e.loggedInUser=u.userStatus().userData.value,e.loggedInUserID=u.userStatus().userData.id,e.billDetails.raisedBy.value=e.loggedInUser,e.billDetails.billDate=p.convertToViewDate(e.currentDate),e.whetherFeeHeadAmntEdit="NO",!d.isFieldEmpty(q.data)){if(e.hideServiceType=!0,d.isFieldEmpty(q.feeHeadAmnt)||(e.whetherFeeHeadAmntEdit=q.feeHeadAmnt),"REFUND"===q.type?e.pageState=q.type:e.pageState=q.pageState,d.isNullOrEmpty(q.data.fromApptList))e.billDetails=angular.copy(q.data),!q.data.serviceType&&q.serviceTypeList&&angular.forEach(q.serviceTypeList,function(a,b){e.serviceTypeList.push(a.id)}),e.billDetails.inFavorOf&&(e.manageBillObject.inFavorOfTypeList=[],e.manageBillObject.inFavorOfTypeList.push(e.billDetails.inFavorOf)),d.isNullOrEmpty(e.billDetails.fromCheckIn)&&(e.feeHeadList=e.billDetails.billTransactions[0].billItems,C=angular.copy(e.feeHeadList)),e.billDetails.billDate=p.convertToViewDate(new Date),"DEBIT"==q.type?e.billDetails.typeCode="DEBIT":e.billDetails.typeCode="CREDIT",e.orgLocation=e.billDetails.ownerLocationId,e.manageBillObject.inFavorOfOrgList=[],e.manageBillObject.inFavorOfOrgList.push(e.orgLocation),e.billDetails.serviceType&&(e.billDetails.serviceGroup={},e.billDetails.serviceGroup={id:e.billDetails.serviceTypeGroup,value:w.instant(e.billDetails.serviceTypeGroup)},e.serviceTypeId=e.billDetails.serviceType,d.isNullOrEmpty(e.billDetails.ownerLocationId)||d.isNullOrEmpty(e.billDetails.ownerLocationId.id)?e.orgLocation.id=e.billDetails.ownerLocationId:e.orgLocation.id=e.billDetails.ownerLocationId.id),d.isNullOrEmpty(e.billDetails.inFavorOf)||("INDIVIDUAL"==e.billDetails.inFavorOf?e.inFavorOfSSId.id=e.billDetails.inFavorOfUserId:e.inFavorOfSSId.id=e.billDetails.inFavorOfLocationId,e.inFavorOfSSId.id.value=e.billDetails.inFavorOfName),d.isNullOrEmpty(e.billDetails.raisedOn)||("INDIVIDUAL"==e.billDetails.raisedOn&&(e.manageBillObject.partyTypeList=[],e.manageBillObject.partyTypeList.push(e.billDetails.raisedOn),e.partyNameId.id=e.billDetails.raisedOnDetails),e.partyNameId.id.value=e.billDetails.raisedOnDetails.raisedOnName),e.grandTotal=0,e.refundTotal=angular.copy(e.grandTotal),e.totalRefundAllowed=e.billDetails.amount-e.billDetails.totalRefundedAmount,d.isNullOrEmpty(e.billDetails.fromCheckIn)&&e.feeHeadList.forEach(function(a){e.grandTotal=e.grandTotal+a.amount,e.refundTotal=angular.copy(e.grandTotal),e.calculateBillTotal()}),e.billDetails.raisedBy={},e.billDetails.raisedBy.value=angular.copy(e.loggedInUser),e.billTypeSelected();else{e.billDetails.typeCode="DEBIT",e.orgLocation=q.data.inFavorOfOrgList,e.locationChanged(e.orgLocation),e.billDetails.raisedOn=q.data.raisedOn,e.partyNameId.id=q.data.partyNameId,e.billDetails.fromCheckIn=!0,e.billDetails.raisedOnUserId={},e.billDetails.raisedOnUserId={id:q.data.partyNameId.id,value:q.data.partyNameId.value};var a={};a.transactionId=q.data.transactionId,g.postData(h.getUrl("GET_ADHOC_BILL_SETUP"),a,function(a){d.isFieldEmpty(a.data)?k.cancel():(e.billDetails.transactionTypeId=a.data.transactionTypeId,e.billDetails.serviceGroup={id:a.data.serviceTypeGroup,value:w.instant(a.data.serviceTypeGroup)},e.serviceTypeId=a.data.serviceType,!e.serviceTypeId&&q.serviceTypeList&&(e.serviceTypeList=q.serviceTypeList))},function(a){})}if(q.transactionList){var b=q.transactionList;angular.forEach(b,function(a,b){a.locationId=e.orgLocation.id}),t.getFeeHeads(b,function(a){e.grandTotal=0,e.refundTotal=angular.copy(e.grandTotal),e.billDetails.amount=0,e.billObject=[],angular.forEach(a,function(a,b){a.feeHeadId&&null!=a.feeHeadId&&e.billObject.push(a)}),e.billObject.amountSettled||(e.billDetails.amountSettled=0),angular.forEach(e.billObject,function(a,b){a.netAmount=a.amount}),e.billDetails.billTransactions=[],e.billDetails.billTransactions.push(e.billObject),e.billDetails.raisedBy.value=angular.copy(e.loggedInUser),e.feeScheduleId=a[0].feeScheduleId,angular.forEach(a,function(a,b){
//if ((value.feeHeadId && value.feeHeadId != null) || value.whetherComputed==true ) {
a.feeHeadId&&null!=a.feeHeadId&&(a.feeHeadGroupId&&delete a.feeHeadGroupId,e.feeHeadList.push(a))}),C=angular.copy(e.feeHeadList),e.calculateNetResidualAmount(),angular.forEach(e.feeHeadList,function(a,b){a.amount&&(e.grandTotal=e.grandTotal+a.netAmount)}),e.grandTotal>0&&(e.saveEnable=!1,e.totalDiscountPrecentage||(e.totalDiscountPrecentage=0,e.netAmount=e.grandTotal),e.totalDiscountAmount||(e.totalDiscountAmount=0,e.netAmount=e.grandTotal),e.billDetails.amount=e.netAmount),a[0].feeHeadId||(e.feeScheduleId=a[0].feeScheduleId)},function(a){})}}var c=z.getDefaultOrgLocation();d.isFieldEmpty(c)||(e.defOrgLoc=c.orgLoc,e.locationChanged(e.defOrgLoc))};Q()}]),angular.module("paripal.billingModule").controller("ManageBillCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","addReceiptPaymentService","dateconvertor","$stateParams","commonBillingService","featurePrivilegeConstants","manageBillService","userStatusService","notify","$translate","viewBillsService","manageRequestService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";function z(a,b,c,d,e){a.feeHead=e,a.total=0,a.amountChanged=function(){a.total=0,angular.forEach(a.rowList,function(b,c){b.value&&null!=b.value&&(a.total=a.total+parseInt(b.value))})},a.rowList=[{}],b.isFieldEmpty(e)||b.isNullOrEmpty(e.billItemDetails)||0==e.billItemDetails.length||(a.rowList=e.billItemDetails),a.addRow=function(){a.rowList.push({})},a.removeRow=function(b){a.rowList.pop()},a.rateChanged=function(a,c){b.isNullOrEmpty(a.quantity)||b.isNullOrEmpty(a.rate)?b.isNullOrEmpty(a.quantity)&&!b.isNullOrEmpty(a.rate)?a.value=a.rate:!b.isNullOrEmpty(a.quantity)&&b.isNullOrEmpty(a.rate)&&(a.value=null,a.rate=null,a.quantity=null):a.value=a.quantity*a.rate},a.cancel=function(){c.hide()},a.saveDescription=function(){var f=0;angular.forEach(a.rowList,function(a,b){f+=parseInt(a.value)}),e.netAmount!=f?d("error",w.instant("BREAKDOWN_NOT_EQUAL_TO_NET")):(angular.forEach(a.rowList,function(c,d){b.isNullOrEmpty(c.billItem)?b.isNullOrEmpty(a.tempBillItem)?c.billItem=a.feeHead.id:c.billItem=a.tempBillItem:a.tempBillItem=c.billItem}),e.billItemDetails=a.rowList,c.hide(e))}}z.$inject=["$scope","utilService","$mdDialog","notify","billItem"],e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.manageBillObject={},e.inFavorOfSSId={},e.partyNameId={},e.locationID=null,e.feeHeadList=[],e.orgLocationInput={queryUrl:"GET_SUBSCRIBER_ORGANIZATIONS",queryParameter:{},jsonParameter:{}},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},e.setMaxRecords=function(a){e.pageNumber=1,e.itemPerPage=a};var A={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.options=a.setOptionProperties(A),e.dtColumnDefs=a.setColumnProperties({}),e.createReceipt=function(){c.go("managereceiptpayment",{type:"add",data:e.billDetails})},e.viewBillPdf=function(a,b){var c={};a?c={billId:a.id}:q.billId&&(c={billId:q.billId}),m.showSpinner=!0,c.billId&&x.viewPdfBill(c,function(a){m.showSpinner=!1;var d=a;b&&b.preventDefault();var f=new Object;f.fileName=d.fileName,f.resourceId=d.id,f.recordId=c.billId,f.docType=d.documentType.type,f.docSubType=d.documentType.subType,e.fileResource=f,e.viewFileContent=!0,e.isHidingPrintButton=!1},function(a){m.showSpinner=!1})};var B=function(){return g.getData(h.getUrl("FIND_BILL_TYPE"),null,function(a){e.manageBillObject.billTypeList=angular.fromJson(a.data)},function(a){})},C=function(){r.getListOfTransactionTypes(function(a){e.manageBillObject.transactionTypeList=a},function(a){v("error",w.instant("TRANSACTION_TYPE_LIST_FAILURE"))})};e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){return g.getData(h.getUrl("FIND_MADE_BY_DROPDOWN"),null,function(a){e.addReceiptObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:s.BILL_VIEW})},e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.billDetails.inFavorOf?e.billDetails.inFavorOfLocationId=a:e.billDetails.inFavorOfUserId=a,e.billDetails.inFavorOfName=a.value},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.billDetails.raisedOn?e.billDetails.raisedOnLocationId=a:e.billDetails.raisedOnUserId=a,e.billDetails.raisedOnName=a.value},e.locationSelected=function(a){e.orgLocation=a,e.billDetails.inFavorOfLocationId=a,e.billDetails.inFavorOfName=a.value,G(a.id),e.locationID=a.id},e.partyNameDDSelected=function(a){e.billDetails.raisedOnLocationId=a,e.billDetails.raisedOnName=a.value},e.getinFavorOfNameData=function(a){e.requestData={};var b="";/*$scope.requestData.type = $scope.filterCriteria.type;*/
return e.requestData.searchKeyword=a,e.requestData.billPartyType=e.billDetails.inFavorOf,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?s.BILL_EDIT:"VIEW"==e.pageState?s.BILL_VIEW:s.BILL_ADD,g.postData(h.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.getPartyNameData=function(a){var b="";return e.requestData={},e.requestData.searchKeyword=a,e.requestData.billPartyType=e.billDetails.raisedOn,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,b="EDIT"==e.pageState?s.BILL_EDIT:"VIEW"==e.pageState?s.BILL_VIEW:s.BILL_ADD,g.postData(h.getParameterizedUrl("FIND_RAISED_ON_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:b})},e.partyTypeSelected=function(){"ORGANIZATION_LOCATION"==e.billDetails.raisedOn||"INDIVIDUAL"==e.billDetails.raisedOn?(e.isMadeFromSSDisabled=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isThirdPartyDisabled=!0):(e.isThirdPartyVisible=!0,e.isThirdPartyDisabled=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!1)},e.inFavorOfTypeSelected=function(){e.inFavorOfSSId={},e.fillInFavorOf()},e.fillInFavorOf=function(){"ORGANIZATION_LOCATION"==e.billDetails.inFavorOf||"INDIVIDUAL"==e.billDetails.inFavorOf?(e.isMadeToSSDisabled=!1,e.isMadeToSSVisible=!0):e.isMadeToSSDisabled=!0},e.getPartyTypes=function(){e.getListOfPartyTypes()},e.getListOfPartyTypes=function(){return g.getData(h.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){e.manageBillObject.inFavorOfTypeList=angular.fromJson(a.data),e.manageBillObject.partyTypeList=angular.fromJson(a.data)},function(a){})},e.back=function(){"APPOINTMENT"==q.parentState&&q.appointmentDetails?c.go("appointmentsList",q.appointmentDetails):c.go("searchbill")},e.billTypeSelected=function(){e.changePartyStyle()},e.changePartyStyle=function(){"CREDIT"==e.billDetails.typeCode?(e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!1,e.isPartyTypeDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0,e.infavorOfPartyVisible=!0,e.raisedOnPartyVisible=!1,"CREATE"==e.pageState&&(e.billDetails.raisedOn="ORGANIZATION_LOCATION",e.billDetails.inFavorOf=null)):(e.isMadeToSSVisible=!1,e.isMadeToDDVisible=!0,e.isMadeFromSSVisible=!0,e.isMadeFromDDVisible=!1,e.isThirdPartyVisible=!1,e.isInFavorOfTypeDisabled=!0,e.isPartyTypeDisabled=!1,e.isMadeToDDDisabled=!1,e.isMadeToSSDisabled=!0,e.infavorOfPartyVisible=!1,e.raisedOnPartyVisible=!0,"CREATE"==e.pageState&&(e.billDetails.raisedOn=null,e.billDetails.inFavorOf="ORGANIZATION_LOCATION"))},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){var a="";return a="EDIT"==e.pageState?s.BILL_EDIT:"VIEW"==e.pageState?s.BILL_VIEW:s.BILL_ADD,g.getData(h.getUrl("FIND_MADE_BY_DROPDOWN"),null,function(a){e.manageBillObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})},e.cancel=function(){d.goBackToPrevState()},e.saveManualBill=function(a,b,f){var g={};
//$scope.receiptPaymentItems
if(d.isFieldEmpty(e.billObject)?(g=angular.copy(e.billDetails),e.billRequestObject=angular.copy(e.billDetails)):(g=angular.copy(e.billObject),e.billRequestObject=angular.copy(e.billObject)),"DEBIT"==e.billDetails.typeCode?(e.billRequestObject.inFavorOf="ORGANIZATION_LOCATION",e.billRequestObject.raisedOn=e.billDetails.raisedOn):(e.billRequestObject.inFavorOf=e.billDetails.inFavorOf,e.billRequestObject.raisedOn="ORGANIZATION_LOCATION"),e.billRequestObject.typeCode=e.billDetails.typeCode,"CREATE"==e.pageState?e.billRequestObject.currency=e.billDetails.currency.id:e.billRequestObject.currency=e.billDetails.currency,d.isFieldEmpty(e.billDetails.billDate)||(e.billRequestObject.billDate=p.convertToServerDate(e.billDetails.billDate)),d.isFieldEmpty(g.billStatus)?e.billRequestObject.billStatus=null:e.billRequestObject.billStatus=g.billStatus,d.isFieldEmpty(e.billDetails.inFavorOfLocationId)?e.billRequestObject.inFavorOfOrgLoc=null:(e.billRequestObject.inFavorOfOrgLoc={},e.billRequestObject.inFavorOfOrgLoc.id=e.billDetails.inFavorOfLocationId.id,e.billRequestObject.inFavorOfOrgLoc.displayName=e.billDetails.inFavorOfLocationId.value),d.isFieldEmpty(e.billDetails.inFavorOfUserId)?e.billRequestObject.inFavorOfUser=null:(e.billRequestObject.inFavorOfUser={},e.billRequestObject.inFavorOfUser.id=e.billDetails.inFavorOfUserId.id,e.billRequestObject.inFavorOfUser.displayName=e.billDetails.inFavorOfUserId.value),d.isFieldEmpty(e.billDetails.raisedOnLocationId)?e.billRequestObject.raisedOnOrgLoc=null:(e.billRequestObject.raisedOnOrgLoc={},e.billRequestObject.raisedOnOrgLoc.id=e.billDetails.raisedOnLocationId.id,e.billRequestObject.raisedOnOrgLoc.displayName=e.billDetails.raisedOnLocationId.value),d.isFieldEmpty(e.billDetails.raisedOnUserId)?e.billRequestObject.raisedOnUser=null:(e.billRequestObject.raisedOnUser={},e.billRequestObject.raisedOnUser.id=e.billDetails.raisedOnUserId.id,e.billRequestObject.raisedOnUser.displayName=e.billDetails.raisedOnUserId.value),e.billRequestObject.amount=e.grandTotal,e.billRequestObject.netAmount=f,e.billRequestObject.discountPercentage=b,e.billRequestObject.discountAmount=e.grandTotal-f,0==e.billRequestObject.discountAmount&&(e.billRequestObject.discountPercentage=0),e.billRequestObject.amountSettled=g.amountSettled,e.billRequestObject.narration=e.billDetails.narration,e.billRequestObject.whetherConsolidated=g.whetherConsolidated,e.billRequestObject.whetherCancelled=g.whetherCancelled,e.billRequestObject.whetherAccounted=g.whetherAccounted,e.billRequestObject.whetherAutoGenerated=g.whetherAutoGenerated,e.billRequestObject.whetherTransactionBased=g.whetherTransactionBased,"CREATE"==e.pageState?e.billRequestObject.raisedBy=e.loggedInUser.id:e.billRequestObject.raisedBy=e.loggedInUser,angular.forEach(e.billRequestObject.billTransactions[0].billItems,function(a,b){angular.forEach(e.billDetails.taxes,function(b,c){a.feeScheduleFeeHead.feeHead.value==c&&(a.amount=b)})}),angular.forEach(e.billRequestObject.billTransactions[0].billItems,function(a,b){angular.forEach(e.billDetails.taxes,function(b,c){a.feeHeadName&&a.feeHeadName==c&&(d.isFieldEmpty(b)?a.amount=0:a.amount=b)})}),e.receiptPaymentItems&&0==e.billRequestObject.billAdjustmentsForBill.length){var h={};"DEBIT"==e.billRequestObject.typeCode?h.typeCode="RECEIPT":h.typeCode="PAYMENT",h.whetherAccounted=!1,h.whetherAutoGenerated=!1,h.whetherCancelled=!1,h.currency=e.billRequestObject.currency;var i={};"DEBIT"==e.billRequestObject.typeCode?i.adjustmentDocumentType="BILL_TO_RECEIPT":i.adjustmentDocumentType="REFUND_BILL_TO_PAYMENT",e.billRequestObject.netAmount>=e.receiptTotalAmount?(i.sourceAmountAdjusted=e.receiptTotalAmount,i.targetAmountAdjusted=e.receiptTotalAmount,e.receiptPaymentItems.length>0&&(h.amountSettled=e.receiptTotalAmount),e.billRequestObject.amountSettled=e.receiptTotalAmount):(i.sourceAmountAdjusted=e.billRequestObject.netAmount,i.targetAmountAdjusted=e.billRequestObject.netAmount,e.receiptPaymentItems.length>0&&(h.amountSettled=e.billRequestObject.netAmount),e.billRequestObject.amountSettled=e.billRequestObject.netAmount),e.receiptPaymentItems.length>0&&(h.wsBillAdjustment=i),e.billRequestObject.billAdjustmentsForBill.push({receipt:h})}
//$scope.billRequestObject.billAdjustmentsForBill[0].receipt.receiptPaymentItems = $scope.receiptPaymentItems;
angular.forEach(e.billRequestObject.billAdjustmentsForBill,function(a,b){null!=a.receipt?(delete a.receipt.receiptPaymentItems,a.receipt.receiptPaymentItems=[]):null!=a.payment&&(delete a.payment.receiptPaymentItems,a.payment.receiptPaymentItems=[]),angular.forEach(e.receiptPaymentItems,function(b,c){(null!=a.receipt&&null!=b.receiptPayment&&a.receipt.id==b.receiptPayment.id||null==b.receiptPayment)&&a.receipt.receiptPaymentItems.push(b),null!=a.payment&&null!=b.receiptPayment&&a.payment.id==b.receiptPayment.id&&a.receipt.receiptPaymentItems.push(b)})});var j=e.receiptPaymentItems.length-2;j>=0&&angular.forEach(e.receiptPaymentItems,function(a,b){null!=a.id&&a.id||(a.receiptPayment={id:e.receiptPaymentItems[j].receiptPayment.id})}),e.receiptTotalAmount=0,angular.forEach(e.receiptPaymentItems,function(a,b){e.receiptTotalAmount=e.receiptTotalAmount+parseInt(a.amount)}),e.billRequestObject.billAdjustmentsForBill[0]&&(e.billRequestObject.billAdjustmentsForBill[0].receipt.amount=e.receiptTotalAmount),e.billRequestObject.netAmount>=e.receiptTotalAmount?(e.billRequestObject.billAdjustmentsForBill[0]&&(e.billRequestObject.billAdjustmentsForBill[0].sourceAmountAdjusted=e.receiptTotalAmount,e.billRequestObject.billAdjustmentsForBill[0].targetAmountAdjusted=e.receiptTotalAmount,e.billRequestObject.billAdjustmentsForBill[0].receipt.amountSettled=e.receiptTotalAmount),
//$scope.billRequestObject.wsReceiptPayment.amountSettled = $scope.receiptTotalAmount;
e.billRequestObject.amountSettled=e.receiptTotalAmount):(e.billRequestObject.billAdjustmentsForBill[0]&&(e.billRequestObject.billAdjustmentsForBill[0].sourceAmountAdjusted=e.billRequestObject.netAmount,e.billRequestObject.billAdjustmentsForBill[0].targetAmountAdjusted=e.billRequestObject.netAmount,e.billRequestObject.billAdjustmentsForBill[0].receipt.amountSettled=e.billRequestObject.netAmount),e.billRequestObject.amountSettled=e.billRequestObject.netAmount),e.billRequestObject.version=e.billDetails.version,delete e.billRequestObject.transactionTypeId,delete e.billRequestObject.serviceTypeId,delete e.billRequestObject.taxes,delete e.billRequestObject.inFavorOfOrgLoc,delete e.billRequestObject.inFavorOfUser,delete e.billRequestObject.raisedOnOrgLoc,delete e.billRequestObject.raisedOnUser,t.updateManualBill(e.billRequestObject,function(a){v("success",w.instant(a.successMessage)),q.parentState?c.go(q.parentState,q.parentParams):c.go("searchbill")},function(a){})};var D=function(){var a="";return a="EDIT"==e.pageState?s.BILL_EDIT:"VIEW"==e.pageState?s.BILL_VIEW:s.BILL_ADD,g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN_FOR_BILL"),null,function(a){e.manageBillObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:a})};e.calculateBillTotal=function(a,b){angular.forEach(e.transactionList,function(c,d){c.billItems&&c.billItems.length>0&&angular.forEach(e.transactionList[d].billItems,function(c,d){b==d&&c.amount==a.amount&&(a.netAmount>c.amount?(c.discountPercentage=0,c.discountAmount=0):(c.discountAmount=c.amount-a.netAmount,c.discountPercentage=parseFloat((c.discountAmount/c.amount*100).toFixed(2))))})}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),E(),e.calculateDiscount(e.totalDiscountPrecentage)};var E=function(){e.grandTotal=0,e.refundTotal=angular.copy(e.grandTotal),angular.forEach(e.transactionList,function(a,b){a.billItems&&a.billItems.length>0&&angular.forEach(e.transactionList[b].billItems,function(a,b){var c=a.netAmount;c>=0?(isNaN(c)||(e.grandTotal+=c),e.refundTotal=angular.copy(e.grandTotal),e.billDetails.amount=angular.copy(e.grandTotal)):d.isFieldEmpty(c)||(a.amount=0,v("error",w.instant("NEGETIVE_VALUES_NOT_ALLOWED"))),e.refundTotal<e.grandTotal&&"REFUND"===e.pageState&&"YES"==e.whetherFeeHeadAmntEdit&&(e.grandTotal=angular.copy(e.refundTotal),e.billDetails.amount=angular.copy(e.grandTotal),v("error",w.instant("REFUND_AMNT_CANNOT_BE_GREATER_THAN_BILL_AMNT")))})}),!e.grandTotal>0&&(e.billDetails.amount=0),e.grandTotal>0&&(e.saveEnable=!1)};e.removeFeeHead=function(a,b,c){e.transactionList[c-1].billItems.splice(b,1);e.calculateNetAmount(),e.calculateTotalDisAmount(e.totalDiscountAmount)},e.removeReceiptItems=function(a,b){e.receiptPaymentItems.splice(b,1)},e.calculateDiscountTotal=function(a,b,c){a.amount>=0&&a.discountAmount>=0&&angular.forEach(e.transactionList,function(c,d){c.billItems&&c.billItems.length>0&&angular.forEach(e.transactionList[d].billItems,function(c,d){d==b&&(a.discountAmount<a.amount?(c.discountPercentage=Math.round(a.discountAmount/a.amount*100),c.netAmount=a.amount-a.discountAmount):(c.discountAmount=0,c.discountPercentage=0,a.discountAmount=0,a.discountPercentage=0))})}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),e.calculateNetAmount(),e.calculateTotalDisAmount(e.totalDiscountAmount)},e.calculateDiscountPercentage=function(a,b,c){a.amount>=0&&a.discountPercentage>=0&&angular.forEach(e.transactionList,function(c,d){c.billItems&&c.billItems.length>0&&angular.forEach(e.transactionList[d].billItems,function(c,d){d==b&&(a.discountPercentage<=100?(c.discountAmount=Math.round(a.amount*(a.discountPercentage/100)),/*$scope.totalDiscountAmount = value.discountAmount;*/
c.netAmount=a.amount-c.discountAmount):(c.discountPercentage=0,c.discountAmount=0,a.discountPercentage=0,a.discountAmount=0))})}),e.calculateTotalDiscountPercentage(),e.calculateTotalDiscountAmount(),e.calculateNetAmount(),e.calculateTotalDisAmount(e.totalDiscountAmount)},e.calculateNetAmount=function(){e.grandTotal=0,angular.forEach(e.transactionList,function(a,b){a.billItems&&a.billItems.length>0&&angular.forEach(e.transactionList[b].billItems,function(a,b){a.netAmount&&(e.grandTotal=e.grandTotal+a.netAmount)})}),e.calculateTotalDisAmount(e.totalDiscountAmount),e.billDetails.amount=e.grandTotal},e.$watch("grandTotal",function(a,b){a&&(e.totalDiscountAmount&&null!=e.totalDiscountAmount?e.calculateTotalDisAmount(e.totalDiscountAmount):e.totalDiscountPrecentage&&e.calculateDiscount(e.totalDiscountPrecentage))}),e.calculateTotalDiscountPercentage=function(){e.discountPercentage=0,angular.forEach(e.transactionList,function(a,b){a.billItems&&a.billItems.length>0&&angular.forEach(e.transactionList[0].billItems,function(a,b){a.discountPercentage&&(e.discountPercentage=e.discountPercentage+a.discountPercentage)})})},e.calculateTotalDiscountAmount=function(){e.discountAmount=0,angular.forEach(e.transactionList,function(a,b){a.billItems&&a.billItems.length>0&&angular.forEach(e.transactionList[0].billItems,function(a,b){a.discountAmount&&(e.discountAmount=e.discountAmount+a.discountAmount)})})};var F=function(){r.getCurrencyList(function(a){e.manageBillObject.currencyTypeList=a},function(a){v("error",w.instant("CURRENCY_TYPE_LIST_FAILURE"))})},G=function(a){r.getCurrencyLocation(a,function(a){e.billDetails.currency.id=a.id},function(a){v("error",w.instant("CURRENCY_LOCATION_FAILURE"))})},H=function(a,b){return a.setMonth(a.getMonth()+b),a};e.calculateTotalDisAmount=function(a){(a&&null!=a||0==a)&&(e.totalDiscountAmount=a,e.netAmount=e.grandTotal-a,0==a?e.totalDiscountPrecentage=0:e.totalDiscountPrecentage=parseInt(a/e.grandTotal*100))},e.calculateDiscount=function(a){e.totalDiscountAmount=a,e.totalDiscountAmount=parseInt(a/100*e.grandTotal),e.netAmount=e.grandTotal-e.totalDiscountAmount},e.mapFields=function(){/*$scope.billDetails.locationId = $scope.orgLocation;*/
if(e.billStatus=w.instant(e.billDetails.billStatus),e.locationSelected(e.billDetails.ownerLocationId),e.billDetails.serviceTypeId=e.billDetails.billTransactions[0].feeType.serviceType,e.serviceGroup={},e.serviceGroup.id=e.billDetails.billTransactions[0].feeType.serviceTypeGroup,e.billDetails){"edit"==q.type?(e.pageState="EDIT",e.showAddFeeHeadBtn=!0):"view"==q.type&&(e.pageState="VIEW",e.isDisabled="a-disabled",e.showAddFeeHeadBtn=!1),e.billDetails.amount==e.billDetails.amountSettled&&(e.createReceiptButton=!1),e.billDetails.billDate=p.convertToViewDate(e.billDetails.billDate),e.netAmount=e.billDetails.netAmount,e.totalDiscountAmount=e.billDetails.discountAmount,e.totalDiscountPrecentage=e.billDetails.discountPercentage,d.isFieldEmpty(e.billDetails.billTransactions)||(
/// $scope.billReferenceList = $scope.billDetails.billTransactions[0].billItems;
e.billDetails.transactionTypeId=e.billDetails.billTransactions[0].feeType.transactionType.id),"DEBIT"==e.billDetails.typeCode?(d.isFieldEmpty(e.billDetails.inFavorOfLocationId)||(e.billId=e.billDetails.inFavorOfLocationId),d.isFieldEmpty(e.billDetails.raisedOnUserId)?e.partyNameId.id=e.billDetails.raisedOnLocationId:e.partyNameId.id=e.billDetails.raisedOnUserId):(d.isFieldEmpty(e.billDetails.raisedOnLocationId)||(e.billId=e.billDetails.raisedOnLocationId),d.isFieldEmpty(e.billDetails.inFavorOfUserId)?e.inFavorOfSSId.id=e.billDetails.inFavorOfLocationId:e.inFavorOfSSId.id=e.billDetails.inFavorOfUserId),e.transactionList=e.billDetails.billTransactions,e.billDetails.taxes={},e.grandTotal=0;var a=null;angular.forEach(e.transactionList,function(b,c){b.billItems&&b.billItems.length>0&&(e.activeTransaction=b,a=e.transactionList[c].billItems)}),a.forEach(function(a){
///     $scope.billDetails.taxes[feeHeadObj.feeScheduleFeeHead.feeHead.value] = feeHeadObj.amount;
e.grandTotal=Math.round(100*(e.grandTotal+a.netAmount))/100}),angular.forEach(e.billDetails.billAdjustmentsForBill,function(a,b){angular.forEach(a.receipt.receiptPaymentItems,function(a,b){e.receiptPaymentItems.push(a)})}),/*$scope.receiptPaymentItems = $scope.billDetails.*/
e.billTypeSelected()}},e.getFeeHeads=function(a){if(e.requestData={},e.requestData.keyword=a,e.requestData.orgLocId=e.orgLocation.id,e.requestData.orgLocId&&null!=e.requestData.orgLocId)return g.getData(h.getParameterizedUrl("GET_FEE_HEAD_LIST_FOR_CREATE_BILL",e.requestData),null,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getDefaultPaymentType=function(){var a={};a.pickListCode="payment_mode",a.pickListItemCode="PAYMENT_MODE_CASH",y.getPicklistWSByCode(a,function(a){e.defaultPaymentMode=a.data},function(a){})},e.addPaymentReference=function(){e.receiptPaymentItems.push({whetherDeposited:!1,whetherRealized:!1,amount:e.netAmount,paymentRefDate:new Date,paymentMode:e.defaultPaymentMode})},e.addFeeHead=function(a){var b=!1;angular.forEach(e.transactionList,function(a,c){a.billItems&&a.billItems.length>0&&angular.forEach(e.transactionList[c].billItems,function(a,c){a.feeHeadName==e.selectedFeeHead.feeHeadName&&(b=!0)})}),1!=b&&(e.activeTransaction&&(e.selectedFeeHead.billTransaction=e.activeTransaction.billItems[0].billTransaction),e.selectedFeeHead.netAmount=e.selectedFeeHead.amount,e.selectedFeeHead.feeHeadName=e.selectedFeeHead.feeHeadName.slice(0,e.selectedFeeHead.feeHeadName.lastIndexOf("-")),delete e.selectedFeeHead.allowNegativeValue,delete e.selectedFeeHead.feeHeadShortCode,delete e.selectedFeeHead.transId,delete e.selectedFeeHead.feeScheduleId,delete e.selectedFeeHead.feeTypeId,angular.forEach(e.transactionList,function(a,b){a.billItems&&a.billItems.length>0&&e.transactionList[b].billItems.push(e.selectedFeeHead)}),e.calculateNetAmount(),e.calculateTotalDisAmount(e.totalDiscountAmount)),e.selectedFeeHead=null},e.getPaymentModes=function(){return g.getData(h.getUrl("GET_PAYMENT_MODE"),null,function(a){e.paymentModeList=angular.fromJson(a.data)},function(a){})},e.addDescription=function(a){k.show({clickOutsideToClose:n.dialogBox.clickOutsideToClose,scope:e,preserveScope:!0,parent:angular.element(document.body),templateUrl:"app/modules/billing/views/add-description-popup.html",controller:z,locals:{billItem:a}}).then(function(a){})};var I=function(){if(e.billDetails={},e.inFavorOfDD={},e.partyObj={},e.billDetails.currency={},e.billDetails.raisedBy={},
/// $scope.billReferenceList = [];
e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.totalDiscountAmount=0,B(),C(),e.getPartyTypes(),e.getMadeFromOrgList(),
//$scope.getMadeToOrgList();
D(),e.getPaymentModes(),
///$scope.getCurrencys();
F(),e.receiptPaymentItems=[],/*$scope.getServiceTypes();*/
e.billDetails.typeCode="DEBIT",e.billTypeSelected(),e.getDefaultPaymentType(),e.currentDate=new Date,e.maxDate=H(new Date,-6),q.createReceipt&&(e.createReceiptButton=!0),e.loggedInUser=u.userStatus().userData,q.type)if(q.billId){var a={id:q.billId};g.getData(h.getParameterizedUrl("FIND_BILL_BY_ID",a),null,function(b){e.billDetails=angular.fromJson(b.data),e.billDetails&&e.mapFields(),"view"==q.type&&1==q.showAutoPDF&&e.viewBillPdf(a)},function(a){})}else q.data&&(e.billDetails=angular.fromJson(q.data)),e.mapFields()};I()}]),angular.module("paripal.billingModule").controller("ManageBillSettlementCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","applicationExceptionService","viewBillSettlementService","viewReceiptPaymentService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.WSBillAdjustment={},a.WSBillAdjustment.version=null,a.disabledFormFields=!1,a.simulateQuery=!0,a.wsAdjustmentDocTypeList=[],a.isDocIdDisabled=!0,a.calculateBillAdjustmentAmount=function(){a.WSBillAdjustment.sourceAmountAdjusted=parseFloat(a.WSBillAdjustment.sourceAmountAdjusted),p.isFieldEmpty(a.WSBillAdjustment.sourceAmountAdjusted)||p.isFieldEmpty(a.WSBillAdjustment.exchangeRate)?(a.WSBillAdjustment.targetAmountAdjusted=0,p.isFieldEmpty(a.oldTargetAmountAdjusted)?(a.WSBillAdjustment.sourceBalanceAmount=angular.copy(a.billCopy.amount-a.billCopy.amountSettled).toFixed(2),a.WSBillAdjustment.targetBalanceAmount=a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount.toFixed(2)):(a.WSBillAdjustment.sourceBalanceAmount=angular.copy(a.billCopy.amount-a.billCopy.amountSettled+a.oldTargetAmountAdjusted).toFixed(2),a.WSBillAdjustment.targetBalanceAmount=(a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount+a.oldTargetAmountAdjusted).toFixed(2))):(a.tempAmount=angular.copy(a.billCopy.amount-a.billCopy.amountSettled),a.tempSettleAmount=angular.copy(a.billCopy.amountSettled),p.isFieldEmpty(a.oldTargetAmountAdjusted)?a.WSBillAdjustment.sourceAmountAdjusted*a.WSBillAdjustment.exchangeRate>a.tempAmount||a.WSBillAdjustment.sourceAmountAdjusted*a.WSBillAdjustment.exchangeRate>a.tempAmount||a.WSBillAdjustment.sourceAmountAdjusted>a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount?(h("error",i.instant("INCORRECT_AMOUNT_ERROR")),a.WSBillAdjustment.sourceBalanceAmount=angular.copy(a.tempAmount).toFixed(2),a.WSBillAdjustment.targetBalanceAmount=a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount.toFixed(2),a.WSBillAdjustment.sourceAmountAdjusted=0,a.WSBillAdjustment.targetAmountAdjusted=0):(a.tempAmount=angular.copy(a.billCopy.amount-a.billCopy.amountSettled),a.tempSettleAmount=angular.copy(a.billCopy.amountSettled),a.WSBillAdjustment.targetAmountAdjusted=a.WSBillAdjustment.sourceAmountAdjusted*a.WSBillAdjustment.exchangeRate,a.WSBillAdjustment.sourceBalanceAmount=angular.copy(a.tempAmount-a.WSBillAdjustment.targetAmountAdjusted).toFixed(2),a.WSBillAdjustment.targetBalanceAmount=(a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount-a.WSBillAdjustment.sourceAmountAdjusted).toFixed(2)):a.WSBillAdjustment.sourceAmountAdjusted*a.WSBillAdjustment.exchangeRate>a.tempAmount+a.oldTargetAmountAdjusted||a.WSBillAdjustment.sourceAmountAdjusted*a.WSBillAdjustment.exchangeRate>a.tempAmount+a.oldTargetAmountAdjusted||a.WSBillAdjustment.sourceAmountAdjusted>a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount+a.oldTargetAmountAdjusted?(h("error",i.instant("INCORRECT_AMOUNT_ERROR")),a.WSBillAdjustment.sourceBalanceAmount=angular.copy(a.tempAmount).toFixed(2),a.WSBillAdjustment.targetBalanceAmount=a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount.toFixed(2),a.WSBillAdjustment.sourceAmountAdjusted=0,a.WSBillAdjustment.targetAmountAdjusted=0):(a.tempAmount=angular.copy(a.billCopy.amount-a.billCopy.amountSettled),a.tempSettleAmount=angular.copy(a.billCopy.amountSettled),a.WSBillAdjustment.targetAmountAdjusted=a.WSBillAdjustment.sourceAmountAdjusted*a.WSBillAdjustment.exchangeRate,a.WSBillAdjustment.sourceBalanceAmount=angular.copy(a.tempAmount-a.WSBillAdjustment.targetAmountAdjusted+a.oldTargetAmountAdjusted).toFixed(2),a.WSBillAdjustment.targetBalanceAmount=(a.WSBillAdjustment.targetAdjustmentDocumentCode.balanceAmount-a.WSBillAdjustment.sourceAmountAdjusted+a.oldTargetAmountAdjusted).toFixed(2))),p.isFieldEmpty(a.billCopy)||0==a.valueChanged&&a.WSBillAdjustment.sourceAmountAdjusted!=a.billCopy.amountSettled&&(a.valueChanged=!0)},a.$watch("WSBillAdjustment.adjustmentDocumentType",function(b){if(b&&b.adjustmentDocumentType){a.WSBillAdjustment.adjustmentDocumentType={targetType:b.targetType,adjustmentDocumentType:b.adjustmentDocumentType},a.isDocIdDisabled=!1,1==a.isAmountChanged&&(a.WSBillAdjustment.targetAdjustmentDocumentCode=null);var d="";if("RECEIPT"===c.billType||"PAYMENT"===c.billType){"CREDIT"===b.targetType||"DEBIT"===b.targetType?d="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_RPCD":"RECEIPT"!==b.targetType&&"PAYMENT"!==b.targetType||(d="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_RPRP");var e={id:a.billObject.id,ownerLocationId:p.isEmpty(a.billObject.ownerLocationId)?null:a.billObject.ownerLocationId.id,madeToLocationId:p.isEmpty(a.billObject.inFavorOfLocationId)?null:a.billObject.inFavorOfLocationId.id,madeToUserId:p.isEmpty(a.billObject.inFavorOfUserId)?null:a.billObject.inFavorOfUserId.id,madeByUserId:p.isEmpty(a.billObject.raisedOnUserId)?null:a.billObject.raisedOnUserId.id,madeByLocationId:p.isEmpty(a.billObject.raisedOnLocationId)?null:a.billObject.raisedOnLocationId.id,madeByName:a.billObject.raisedOnName,madeBy:a.billObject.raisedOn,madeToName:a.billObject.inFavorOfName,madeTo:a.billObject.inFavorOf,whetherAccounted:a.billObject.whetherAccounted,typeCode:a.billObject.typeCode};"add"==a.pageState?e.whetherAdd=!0:e.whetherAdd=!1,a.loadAllAdjustmentDocCode(d,e)}else if("CREDIT"===a.billObject.typeCode||"DEBIT"===a.billObject.typeCode){"CREDIT"===b.targetType||"DEBIT"===b.targetType?d="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_CDCD":"RECEIPT"!==b.targetType&&"PAYMENT"!==b.targetType||(d="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_CDRP");var e={id:a.billObject.id,ownerLocationId:p.isEmpty(a.billObject.ownerLocationId)?null:a.billObject.ownerLocationId.id,inFavorOfLocationId:p.isEmpty(a.billObject.inFavorOfLocationId)?null:a.billObject.inFavorOfLocationId.id,inFavorOfUserId:p.isEmpty(a.billObject.inFavorOfUserId)?null:a.billObject.inFavorOfUserId.id,raisedOnUserId:p.isEmpty(a.billObject.raisedOnUserId)?null:a.billObject.raisedOnUserId.id,raisedOnLocationId:p.isEmpty(a.billObject.raisedOnLocationId)?null:a.billObject.raisedOnLocationId.id,raisedOnName:a.billObject.raisedOnName,raisedOn:a.billObject.raisedOn,inFavorOfName:a.billObject.inFavorOfName,inFavorOf:a.billObject.inFavorOf,whetherAccounted:a.billObject.whetherAccounted,typeCode:a.billObject.typeCode,whetherAllowReceiptSettlement:a.billObject.whetherAllowReceiptSettlement};"add"==a.pageState?e.whetherAdd=!0:e.whetherAdd=!1,a.loadAllAdjustmentDocCode(d,e)}}else a.WSBillAdjustment.targetBalanceAmount=null,a.isDocIdDisabled=!1,a.WSBillAdjustment.targetAdjustmentDocumentCode=null},!0),a.validateAdjusmentDocumentType=function(b){b?p.isEmpty(a.WSBillAdjustment.adjustmentDocumentType)?a.WSBillAdjustment.adjustmentDocumentType=null:a.WSBillAdjustment.adjustmentDocumentType.targetType!==b&&(a.WSBillAdjustment.adjustmentDocumentType=null):a.WSBillAdjustment.adjustmentDocumentType=null},a.selectAdjustmentDocTypeChanged=function(b){a.WSBillAdjustment.adjustmentDocumentType={targetType:b.targetType,adjustmentDocumentType:b.adjustmentDocumentType}},a.adjustmentDocumentTypeQuerySearch=function(b){a.isAmountChanged=!0;var c,d=b?a.wsAdjustmentDocTypeList.filter(a.createFilterForDocumentType(b)):a.wsAdjustmentDocTypeList;return a.simulateQuery?(c=l.defer(),k(function(){c.resolve(d)},1e3*Math.random(),!1),c.promise):d},a.createFilterForDocumentType=function(a){var b=angular.lowercase(a);return function(a){return 0===angular.lowercase(a.targetType).indexOf(b)}},a.back=function(){p.goBackToPrevState()},a.loadAllAdjustmentDocType=function(){var b={sourceType:c.billType};return n.getData(o.getParameterizedUrl("FIND_BILL_ADJUSTMENT_DOCUMENT_TYPE",b),null,function(b){if(b&&b.data)return a.wsAdjustmentDocTypeList=b.data,a.wsAdjustmentDocTypeList},function(a){})},a.wsAdjustmentDocCodeList=[],a.$watch("WSBillAdjustment.targetAdjustmentDocumentCode",function(b){b&&b.id&&(a.WSBillAdjustment.targetAdjustmentDocumentCode={serviceProviderReferenceNo:b.serviceProviderReferenceNo,id:b.id,balanceAmount:b.balanceAmount})},!0),a.validateAdjusmentDocumentCode=function(b){b?p.isEmpty(a.WSBillAdjustment.targetAdjustmentDocumentCode)?a.WSBillAdjustment.targetAdjustmentDocumentCode=null:a.WSBillAdjustment.targetAdjustmentDocumentCode.serviceProviderReferenceNo!==b&&(a.WSBillAdjustment.targetAdjustmentDocumentCode=null):a.WSBillAdjustment.targetAdjustmentDocumentCode=null},a.selectAdjustmentDocCodeChanged=function(b){a.WSBillAdjustment.targetAdjustmentDocumentCode={id:b.id,serviceProviderReferenceNo:b.serviceProviderReferenceNo,balanceAmount:b.balanceAmount,currencyId:b.currencyId},a.WSBillAdjustment.targetBalanceAmount=b.balanceAmount;var c={sourceCurrencyId:a.billObject.currency.id,targetCurrencyId:b.currency.id,orgLocId:a.billObject.ownerLocationId.id};return n.getData(o.getParameterizedUrl("GET_EXCHANGE_RATE",c),null,function(b){b&&b.data&&(a.WSBillAdjustment.exchangeRate=b.data)},function(a){})},a.adjusmentDocumentCodeQuerySearch=function(b){a.isAmountChanged=!0;var c,d=b?a.wsAdjustmentDocCodeList.filter(a.createFilterForDocumentCode(b)):a.wsAdjustmentDocCodeList;return a.simulateQuery?(c=l.defer(),k(function(){c.resolve(d)},1e3*Math.random(),!1),c.promise):d},a.createFilterForDocumentCode=function(a){var b=angular.lowercase(a);return function(a){return 0===angular.lowercase(a.serviceProviderReferenceNo).indexOf(b)}},a.loadAllAdjustmentDocCode=function(b,c){var d="";return d="edit"==a.pageState?t.BILL_SETTLEMENT_EDIT:"view"==a.pageState?t.BILL_SETTLEMENT_VIEW:t.BILL_SETTLEMENT_ADD,n.postData(o.getParameterizedUrl(b,null),c,function(b){return"add"!=a.pageState?(a.wsAdjustmentDocCodeList=b.data,a.wsAdjustmentDocCodeList):b&&!p.isFieldEmpty(b.data)?(a.wsAdjustmentDocCodeList=b.data,a.WSBillAdjustment.targetCurrencyId=b.data[0].currency.id,a.wsAdjustmentDocCodeList):void h("info",i.instant("NO_ID_AVAILABLE"))},function(a){},{orgLocPermission:d})},a.saveBillSettlement=function(){b.showSpinner=!0,a.WSBillAdjustment.targetAmountAdjusted>0?r.saveBillSettlement(a.WSBillAdjustment,a.billObject,c.type,function(a){"add"===c.type?h("success",i.instant("ADDED_SUCCESS")):h("success",i.instant("RECORD_EDITED_SUCESS")),p.goBackToPrevState(),b.showSpinner=!1},function(a){!p.isEmpty(a.data)&&a.data.messages.length>0&&!p.isEmpty(a.data.messages[0])?h("error",i.instant(a.data.messages[0])):h("error",i.instant("FAILED_TO_SAVE_RECORD")),b.showSpinner=!1}):(h("error",i.instant("AMOUNT_CANT_BE_LESS_THAN_0")),b.showSpinner=!1)},a.getBillAdjustmentDetails=function(b,c,d,e){if(!p.isNullOrEmpty(b)&&!p.isNullOrEmpty(c)&&!p.isNullOrEmpty(d)){var f={adjustmentId:b,targetTypeCode:c,sourceTypeCode:d};r.getBillAdjustmentDetails(f,function(b){a.tempAdjAmount=angular.copy(b.sourceAmountAdjusted),a.setDataToBillSettlementForm(b)},function(a){h("error",i.instant("FAILED_TO_LOAD_RECORD"))})}},a.setDataToBillSettlementForm=function(b){p.isEmpty(b)||(a.WSBillAdjustment=b,a.oldTargetAmountAdjusted=angular.copy(a.WSBillAdjustment.targetAmountAdjusted),a.WSBillAdjustment.adjustmentDate=j("timestampToDate")(a.WSBillAdjustment.adjustmentDate,"MM/dd/yyyy"),a.WSBillAdjustment.adjustmentDocumentType={targetType:b.targetTypeCode,adjustmentDocumentType:b.adjustmentDocumentType},"RECEIPT_TO_BILL"==b.adjustmentDocumentType.adjustmentDocumentType?a.WSBillAdjustment.targetAdjustmentDocumentCode={id:b.targetId,serviceProviderReferenceNo:b.sourceAdjustmentDocumentCode,balanceAmount:b.targetBalanceAmount}:a.WSBillAdjustment.targetAdjustmentDocumentCode={id:b.targetId,serviceProviderReferenceNo:b.targetAdjustmentDocumentCode,balanceAmount:b.targetBalanceAmount})},a.cancel=function(){d.go("billsettlementview",{type:c.type,billId:c.id,billTypeCode:c.billType})},a.init=function(){if(a.isAmountChanged=!1,"add"===c.type&&c.id){var b={id:c.id};r.getBillDetails(b,function(b){a.billObject=b,a.WSBillAdjustment.sourceCurrencyId=a.billObject.currency.id,a.WSBillAdjustment.serviceProviderReferenceNo=a.billObject.serviceProviderReferenceNo,a.WSBillAdjustment.adjustmentDate=j("timestampToDate")(a.billObject.billDate,"MM/dd/yyyy"),a.WSBillAdjustment.typeCode=a.billObject.typeCode,a.WSBillAdjustment.raisedOnName=a.billObject.raisedOnName,a.WSBillAdjustment.inFavorOfName=a.billObject.inFavorOfName,a.WSBillAdjustment.sourceBalanceAmount=a.billObject.amount-a.billObject.amountSettled,a.billCopy=angular.copy(a.billObject)},function(a){h("error",i.instant("ERROR"))}),a.pageState="add",a.valueChanged=!0}else if(c.id&&c.billType&&c.targetTypeCode&&c.settlementId&&"add"!==c.type){var b={id:c.id};r.getBillDetails(b,function(b){a.billObject=b,a.WSBillAdjustment.serviceProviderReferenceNo=a.billObject.serviceProviderReferenceNo,a.WSBillAdjustment.adjustmentDate=a.billObject.billDate,a.WSBillAdjustment.typeCode=a.billObject.typeCode,a.WSBillAdjustment.raisedOnName=a.billObject.raisedOnName,a.WSBillAdjustment.inFavorOfName=a.billObject.inFavorOfName,a.WSBillAdjustment.sourceBalanceAmount=a.billObject.amount-a.billObject.amountSettled,a.billCopy=angular.copy(a.billObject),"edit"===c.type?(a.pageState="edit",a.isEdit=!0,a.valueChanged=!1):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0,a.valueChanged=!1),a.getBillAdjustmentDetails(c.settlementId,c.targetTypeCode,c.billType,c.type)},function(a){h("error",i.instant("ERROR"))})}else d.go("billsettlementview",{type:c.type,billObject:c.billObject});a.wsAdjustmentDocTypeList=a.loadAllAdjustmentDocType()},a.init()}]),angular.module("paripal.billingModule").controller("ManageReceiptPaymentSettlementCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","$stateParams","viewReceiptPaymentService","dateconvertor","settlementService","notify","$translate","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.receiptSettlementDetails={},e.filterCriteria={},e.billSearchObject={},e.isConsolidatedChanged=function(){e.changeTransactionTypeAuthority(e.filterCriteria.isConsolidated)},e.changeTransactionTypeAuthority=function(a){e.billSearchObject.isTransactionTypeDisabled=a},e.sourceAmountChanged=function(){1==e.valueChanged&&(d.isFieldEmpty(e.receiptSettlementDetails.sourceAmountAdjusted)||d.isFieldEmpty(e.receiptSettlementDetails.exchangeRate)?(e.receiptSettlementDetails.targetAmountAdjusted=0,d.isFieldEmpty(e.receiptCopy)||d.isFieldEmpty(e.receiptCopy)||(d.isFieldEmpty(e.oldTargetAmountAdjusted)?e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.receiptCopy.amount-e.receiptCopy.amountSettled):e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.receiptCopy.amount-e.receiptCopy.amountSettled+e.oldTargetAmountAdjusted)),d.isFieldEmpty(e.receiptSettlementDetails.targetAdjustmentDocumentCode)||(d.isFieldEmpty(e.oldTargetAmountAdjusted)?e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount:e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount+e.oldTargetAmountAdjusted)):d.isFieldEmpty(e.oldTargetAmountAdjusted)?d.isFieldEmpty(e.receiptCopy.amount)||(e.tempAmount=angular.copy(e.receiptCopy.amount-e.receiptCopy.amountSettled),e.tempSettleAmount=angular.copy(e.receiptCopy.amountSettled),e.receiptSettlementDetails.sourceAmountAdjusted*e.receiptSettlementDetails.exchangeRate>e.tempAmount||e.receiptSettlementDetails.sourceAmountAdjusted*e.receiptSettlementDetails.exchangeRate>e.tempAmount||e.receiptSettlementDetails.sourceAmountAdjusted>e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount?(r("error",s.instant("INCORRECT_AMOUNT_ERROR")),e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.tempAmount),e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount,e.receiptSettlementDetails.sourceAmountAdjusted=0,e.receiptSettlementDetails.targetAmountAdjusted=0):(e.receiptSettlementDetails.targetAmountAdjusted=e.receiptSettlementDetails.sourceAmountAdjusted*e.receiptSettlementDetails.exchangeRate,d.isFieldEmpty(e.oldTargetAmountAdjusted)?(e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.tempAmount-e.receiptSettlementDetails.targetAmountAdjusted),e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount-e.receiptSettlementDetails.targetAmountAdjusted):(e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.tempAmount-e.receiptSettlementDetails.targetAmountAdjusted+e.oldTargetAmountAdjusted),e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount-e.receiptSettlementDetails.targetAmountAdjusted+e.oldTargetAmountAdjusted))):d.isFieldEmpty(e.receiptCopy.amount)||(e.tempAmount=angular.copy(e.receiptCopy.amount-e.receiptCopy.amountSettled),e.tempSettleAmount=angular.copy(e.receiptCopy.amountSettled),e.receiptSettlementDetails.sourceAmountAdjusted*e.receiptSettlementDetails.exchangeRate>e.tempAmount+e.oldTargetAmountAdjusted||e.receiptSettlementDetails.sourceAmountAdjusted*e.receiptSettlementDetails.exchangeRate>e.tempAmount+e.oldTargetAmountAdjusted||e.receiptSettlementDetails.sourceAmountAdjusted>e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount+e.oldTargetAmountAdjusted?(r("error",s.instant("INCORRECT_AMOUNT_ERROR")),e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.tempAmount),e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount,e.receiptSettlementDetails.sourceAmountAdjusted=0,e.receiptSettlementDetails.targetAmountAdjusted=0):(e.receiptSettlementDetails.targetAmountAdjusted=e.receiptSettlementDetails.sourceAmountAdjusted*e.receiptSettlementDetails.exchangeRate,d.isFieldEmpty(e.oldTargetAmountAdjusted)?(e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.tempAmount-e.receiptSettlementDetails.targetAmountAdjusted),e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount-e.receiptSettlementDetails.targetAmountAdjusted):(e.receiptSettlementDetails.sourceBalanceAmount=angular.copy(e.tempAmount-e.receiptSettlementDetails.targetAmountAdjusted+e.oldTargetAmountAdjusted),e.receiptSettlementDetails.targetBalanceAmount=e.receiptSettlementDetails.targetAdjustmentDocumentCode.balanceAmount-e.receiptSettlementDetails.targetAmountAdjusted+e.oldTargetAmountAdjusted)))),d.isFieldEmpty(e.receiptCopy)||0==e.valueChanged&&e.receiptSettlementDetails.sourceAmountAdjusted!=e.receiptCopy.amountSettled&&(e.valueChanged=!0)},e.inFavorOfTypeSelected=function(){e.fillInFavorOf()},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},e.setMaxRecords=function(a){e.pageNumber=1,e.itemPerPage=a};var u={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.options=a.setOptionProperties(u),e.dtColumnDefs=a.setColumnProperties({}),e.manageSettlement=function(){e.updateObject={},e.updateObject.id=e.receiptSettlementDetails.adjustmentId,e.updateObject.version=e.receiptSettlementDetails.version,"BILL_TO_RECEIPT"==e.targetTypeCode?(e.updateObject.sourceAdjustmentDocumentCode=e.receiptSettlementDetails.targetAdjustmentDocumentCode.serviceProviderReferenceNo,e.updateObject.targetAdjustmentDocumentCode=e.receiptSettlementDetails.serviceProviderReferenceNo):(e.updateObject.sourceAdjustmentDocumentCode=e.receiptSettlementDetails.serviceProviderReferenceNo,e.updateObject.targetAdjustmentDocumentCode=e.receiptSettlementDetails.targetAdjustmentDocumentCode.serviceProviderReferenceNo),/*$scope.updateObject.targetAdjustmentDocumentCode = $scope.receiptSettlementDetails.targetAdjustmentDocumentCode.serviceProviderReferenceNo;*/
e.updateObject.adjustmentDocumentType=e.receiptSettlementDetails.adjustmentDocumentType.adjustmentDocumentType,e.updateObject.exchangeRate=e.receiptSettlementDetails.exchangeRate,e.updateObject.sourceAmountAdjusted=e.receiptSettlementDetails.sourceAmountAdjusted,e.updateObject.targetAmountAdjusted=e.receiptSettlementDetails.targetAmountAdjusted,e.updateObject.inactiveReason=e.receiptSettlementDetails.inactiveReason,e.updateObject.whetherActive=e.receiptSettlementDetails.whetherActive,e.updateObject.ownerLocationId=e.receiptObject.ownerLocationId,/*if ($scope.updateObject.ownerLocationId && ($scope.updateObject.ownerLocationId.tin || $scope.updateObject.ownerLocationId.tin == null)) {
    delete $scope.updateObject.ownerLocationId.tin;
}
if ($scope.updateObject.ownerLocationId && ($scope.updateObject.ownerLocationId.salesTaxCode || $scope.updateObject.ownerLocationId.salesTaxCode == null)) {
    delete $scope.updateObject.ownerLocationId.salesTaxCode;
}*/
e.updateObject.sourceCurrencyId=e.receiptSettlementDetails.sourceCurrencyId,e.updateObject.targetCurrencyId=e.receiptSettlementDetails.targetCurrencyId,"RECEIPT"==e.receiptSettlementDetails.adjustmentDocumentType.targetType?("BILL_TO_RECEIPT"==e.targetTypeCode?e.updateObject.receipt={id:e.receiptSettlementDetails.id}:e.updateObject.receipt={id:e.receiptSettlementDetails.targetAdjustmentDocumentCode.id},e.updateObject.bill=null,e.updateObject.refundBill=null,e.updateObject.payment=null):"PAYMENT"==e.receiptSettlementDetails.adjustmentDocumentType.targetType?(e.updateObject.receipt=null,e.updateObject.bill=null,e.updateObject.refundBill=null,"BILL_TO_RECEIPT"==e.targetTypeCode?e.updateObject.payment={id:e.receiptSettlementDetails.id}:e.updateObject.payment={id:e.receiptSettlementDetails.targetAdjustmentDocumentCode.id}):"DEBIT"==e.receiptSettlementDetails.adjustmentDocumentType.targetType?(e.updateObject.receipt=null,"BILL_TO_RECEIPT"==e.targetTypeCode?e.updateObject.bill={id:e.receiptSettlementDetails.targetId}:e.updateObject.bill={id:e.receiptSettlementDetails.targetAdjustmentDocumentCode.id},e.updateObject.refundBill=null,e.updateObject.payment=null):(e.updateObject.receipt=null,e.updateObject.bill=null,e.updateObject.refundBill={id:e.receiptSettlementDetails.targetAdjustmentDocumentCode.id},e.updateObject.payment=null),"RECEIPT"==e.receiptSettlementDetails.typeCode?e.updateObject.receipt={id:e.receiptObject.id}:e.updateObject.payment={id:e.receiptObject.id},e.receiptSettlementDetails.targetAmountAdjusted>0?"Edit"==e.viewType?q.updateSettlement(e.updateObject,function(a){r("success",angular.fromJson(a.data).successMessage),c.go("receiptsettlementview",{type:null,data:null,receiptData:null,id:e.receiptSettlementDetails.id,receiptType:e.receiptSettlementDetails.typeCode})},function(a){r("error",s.instant("UPDATE_SETTLEMENT_ERROR"))}):(e.updateObject.whetherActive=!0,e.updateObject.inactiveReason=null,e.updateObject.targetAmountAdjusted>0?q.saveSettlement(e.updateObject,function(a){r("success",angular.fromJson(a).successMessage),
//window.history.back();
d.goBackToPrevState()},function(a){r("error",s.instant("SAVE_SETTLEMENT_ERROR"))}):r("error",s.instant("AMOUNT_CANT_BE_LESS_THAN_0"))):r("error",s.instant("AMOUNT_CANT_BE_LESS_THAN_0"))},e.adjusmentDocumentCodeQuerySearch=function(a){var b,c=a?e.wsAdjustmentDocCodeList.filter(e.createFilterForDocumentCode(a)):e.wsAdjustmentDocCodeList;return e.simulateQuery?(b=$q.defer(),j(function(){b.resolve(c)},1e3*Math.random(),!1),b.promise):c},e.createFilterForDocumentCode=function(a){var b=angular.lowercase(a);return function(a){return 0===angular.lowercase(a.serviceProviderReferenceNo).indexOf(b)}},e.validateAdjusmentDocumentCode=function(a){a?d.isEmpty(e.receiptSettlementDetails.targetAdjustmentDocumentCode)?e.receiptSettlementDetails.targetAdjustmentDocumentCode=null:e.receiptSettlementDetails.targetAdjustmentDocumentCode.serviceProviderReferenceNo!==a&&(e.receiptSettlementDetails.targetAdjustmentDocumentCode=null):e.receiptSettlementDetails.targetAdjustmentDocumentCode=null},e.selectAdjustmentDocCodeChanged=function(a){e.receiptSettlementDetails.targetAdjustmentDocumentCode={id:a.id,serviceProviderReferenceNo:a.serviceProviderReferenceNo,balanceAmount:a.balanceAmount,currencyId:a.currencyId},e.receiptSettlementDetails.targetBalanceAmount=a.balanceAmount;var b={sourceCurrencyId:e.receiptObject.currency.id,targetCurrencyId:a.currency.id,orgLocId:e.receiptObject.ownerLocationId.id};return g.getData(h.getParameterizedUrl("GET_EXCHANGE_RATE",b),null,function(a){a&&a.data&&(e.receiptSettlementDetails.exchangeRate=a.data)},function(a){})},e.wsAdjustmentDocCodeList=[],e.$watch("receiptSettlementDetails.targetAdjustmentDocumentCode",function(a){a&&a.id?e.receiptSettlementDetails.targetAdjustmentDocumentCode={serviceProviderReferenceNo:a.serviceProviderReferenceNo,id:a.id,balanceAmount:a.balanceAmount}:e.receiptSettlementDetails.targetAdjustmentDocumentCode=null},!0),e.$watch("receiptSettlementDetails.adjustmentDocumentType",function(a){if(a&&a.adjustmentDocumentType){e.receiptSettlementDetails.adjustmentDocumentType={targetType:a.targetType,adjustmentDocumentType:a.adjustmentDocumentType},e.isDocIdDisabled=!1;var b="";a.adjustmentDocumentType!==e.targetTypeCode&&(e.receiptSettlementDetails.targetAdjustmentDocumentCode={});var c="";if("RECEIPT"===e.receiptObject.typeCode||"PAYMENT"===e.receiptObject.typeCode){"CREDIT"===a.targetType||"DEBIT"===a.targetType?(c="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_RPCD",b=t.BILL_VIEW):"RECEIPT"!==a.targetType&&"PAYMENT"!==a.targetType||(c="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_RPRP",b=t.RECEIPT_VIEW);var f={id:e.receiptObject.id,ownerLocationId:d.isFieldEmpty(e.receiptObject.ownerLocationId)?null:e.receiptObject.ownerLocationId.id,madeToLocationId:d.isFieldEmpty(e.receiptObject.madeToLocationId)?null:e.receiptObject.madeToLocationId.id,madeToUserId:d.isFieldEmpty(e.receiptObject.madeToUserId)?null:e.receiptObject.madeToUserId.id,madeByUserId:d.isFieldEmpty(e.receiptObject.madeByUserId)?null:e.receiptObject.madeByUserId.id,madeByLocationId:d.isFieldEmpty(e.receiptObject.madeByLocationId)?null:e.receiptObject.madeByLocationId.id,madeByName:e.receiptObject.madeByName,madeBy:e.receiptObject.madeBy,madeToName:e.receiptObject.madeToName,madeTo:e.receiptObject.madeTo,whetherAccounted:e.receiptObject.whetherAccounted,typeCode:e.receiptObject.typeCode};"Create"==e.viewType?f.whetherAdd=!0:f.whetherAdd=!1,e.loadAllAdjustmentDocCode(c,f,b)}else if("CREDIT"===e.receiptObject.typeCode||"DEBIT"===e.receiptObject.typeCode){"CREDIT"===a.targetType||"DEBIT"===a.targetType?(c="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_CDCD",b=t.BILL_VIEW):"RECEIPT"!==a.targetType&&"PAYMENT"!==a.targetType||(c="FIND_ADJUSTMENT_DOCUMENT_ID_FOR_CDRP",b=t.RECEIPT_VIEW);var f={id:e.receiptObject.id,ownerLocationId:d.isFieldEmpty(e.receiptObject.ownerLocationId)?null:e.receiptObject.ownerLocationId.id,inFavorOfLocationId:d.isFieldEmpty(e.receiptObject.madeToLocationId)?null:e.receiptObject.madeToLocationId.id,inFavorOfUserId:d.isFieldEmpty(e.receiptObject.madeToUserId)?null:e.receiptObject.madeToId.id,raisedOnUserId:d.isFieldEmpty(e.receiptObject.madeByUserId)?null:e.receiptObject.madeByUserId.id,raisedOnLocationId:d.isFieldEmpty(e.receiptObject.madeByLocationId)?null:e.receiptObject.madeByLocationId.id,madeByName:e.receiptObject.raisedOnName,madeBy:e.receiptObject.raisedOn,madeToName:e.receiptObject.inFavorOfName,madeTo:e.receiptObject.inFavorOf,whetherAccounted:e.receiptObject.whetherAccounted,typeCode:e.receiptObject.typeCode};"Create"==e.viewType?f.whetherAdd=!0:f.whetherAdd=!1,e.loadAllAdjustmentDocCode(c,f,b)}}else e.receiptSettlementDetails.targetBalanceAmount=null,e.isDocIdDisabled=!1,e.receiptSettlementDetails.targetAdjustmentDocumentCode=null},!0),e.adjustmentDocumentTypeQuerySearch=function(a){var b,c=a?e.wsAdjustmentDocTypeList.filter(e.createFilterForDocumentType(a)):e.wsAdjustmentDocTypeList;return e.simulateQuery?(b=$q.defer(),j(function(){b.resolve(c)},1e3*Math.random(),!1),b.promise):c},e.loadAllAdjustmentDocCode=function(a,b,c){return g.postData(h.getParameterizedUrl(a,null),b,function(a){return"add"!=e.pageState?(e.wsAdjustmentDocCodeList=a.data,e.receiptSettlementDetails.targetCurrencyId=a.data[0].currency.id,e.wsAdjustmentDocCodeList):a&&!d.isFieldEmpty(a.data)?(e.wsAdjustmentDocCodeList=a.data,e.receiptSettlementDetails.targetCurrencyId=a.data[0].currency.id,e.wsAdjustmentDocCodeList):void r("info",s.instant("NO_ID_AVAILABLE"))},function(a){},{orgLocPermission:c})},e.loadAllAdjustmentDocType=function(){var a={sourceType:e.receiptObject.typeCode};return g.getData(h.getParameterizedUrl("FIND_BILL_ADJUSTMENT_DOCUMENT_TYPE",a),null,function(a){if(a&&a.data)return e.wsAdjustmentDocTypeList=a.data,e.wsAdjustmentDocTypeList},function(a){})},e.createFilterForDocumentType=function(a){var b=angular.lowercase(a);return function(a){return 0===angular.lowercase(a.targetType).indexOf(b)}},e.validateAdjusmentDocumentType=function(a){a?d.isEmpty(e.receiptSettlementDetails.adjustmentDocumentType)?e.receiptSettlementDetails.adjustmentDocumentType=null:e.receiptSettlementDetails.adjustmentDocumentType.targetType!==a&&(e.receiptSettlementDetails.adjustmentDocumentType=null):e.receiptSettlementDetails.adjustmentDocumentType=null},e.selectAdjustmentDocTypeChanged=function(a){e.receiptSettlementDetails.adjustmentDocumentType={targetType:a.targetType,adjustmentDocumentType:a.adjustmentDocumentType}},e.cancel=function(){
//window.history.back();
d.goBackToPrevState()},e.getSettlementDetails=function(a){e.settlementDetails={},o.getSettlementDetailsForReceiptById(a,function(a){e.receiptSettlementDetails=a,e.oldTargetAmountAdjusted=angular.copy(e.receiptSettlementDetails.targetAmountAdjusted),a.adjustmentDocumentType.adjustmentDocumentType?e.targetTypeCode=a.adjustmentDocumentType.adjustmentDocumentType:e.targetTypeCode=a.adjustmentDocumentType,"BILL_TO_RECEIPT"==e.targetTypeCode?(e.receiptSettlementDetails.adjustmentDocumentType={targetType:a.targetTypeCode,adjustmentDocumentType:a.adjustmentDocumentType},e.targetDocumentCode=a.sourceAdjustmentDocumentCode):(e.receiptSettlementDetails.adjustmentDocumentType={targetType:a.targetTypeCode,adjustmentDocumentType:a.adjustmentDocumentType},e.targetDocumentCode=a.targetAdjustmentDocumentCode),e.targetDocumentId=a.id,"BILL_TO_RECEIPT"==e.targetTypeCode?e.receiptSettlementDetails.targetAdjustmentDocumentCode={serviceProviderReferenceNo:a.sourceAdjustmentDocumentCode,id:a.adjustmentId,balanceAmount:a.targetBalanceAmount}:e.receiptSettlementDetails.targetAdjustmentDocumentCode={serviceProviderReferenceNo:a.targetAdjustmentDocumentCode,id:a.adjustmentId,balanceAmount:a.targetBalanceAmount},e.receiptSettlementDetails.adjustmentDate=f("timestampToDate")(e.receiptSettlementDetails.adjustmentDate)},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.init=function(){if(e.receiptObject={},n.id&&n.type&&n.sourceTypeCode&&n.targetTypeCode&&n.settlementId){var a={id:n.id};o.getReceiptPaymentDetails(a,function(a){e.receiptObject=a,e.receiptSettlementDetails.sourceCurrencyId=e.receiptObject.currency.id,e.receiptCopy=angular.copy(e.receiptObject),e.wsAdjustmentDocTypeList=e.loadAllAdjustmentDocType()},function(a){r("error",s.instant("ERROR"))}),e.viewType=n.type;var b={};b.adjustmentId=n.settlementId,b.targetTypeCode=n.targetTypeCode,b.sourceTypeCode=n.sourceTypeCode,e.getSettlementDetails(b),e.receiptSettlementDetails.sourceBalanceAmount=e.receiptObject.amount-e.receiptObject.amountSettled}else if(n.id&&n.sourceTypeCode){var a={id:n.id};o.getReceiptPaymentDetails(a,function(a){e.receiptObject=a,e.receiptCopy=angular.copy(e.receiptObject),e.receiptSettlementDetails.serviceProviderReferenceNo=e.receiptObject.serviceProviderReferenceNo,e.receiptSettlementDetails.typeCode=e.receiptObject.typeCode,e.receiptSettlementDetails.madeByName=e.receiptObject.madeByName,e.receiptSettlementDetails.madeToName=e.receiptObject.madeToName,e.receiptSettlementDetails.adjustmentDate=f("timestampToDate")(e.receiptObject.receiptDate),e.receiptSettlementDetails.sourceBalanceAmount=e.receiptObject.amount-e.receiptObject.amountSettled,e.receiptSettlementDetails.targetAmountAdjusted=0,e.receiptSettlementDetails.sourceCurrencyId=e.receiptObject.currency.id,e.wsAdjustmentDocTypeList=e.loadAllAdjustmentDocType()},function(a){r("error",s.instant("ERROR"))})}else e.receiptSettlementDetails={},c.go("receiptsettlementview",{id:n.id,receiptType:n.sourceTypeCode});d.isFieldEmpty(n.type)||"View"!=n.type&&"Edit"!=n.type?(e.viewType="Create",e.valueChanged=!0):(e.viewType=n.type,e.valueChanged=!1)},e.init()}]),angular.module("paripal.billingModule").controller("ReceiptPaymentSettlementViewCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","$stateParams","viewReceiptPaymentService","settlementService","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.sortedObject={},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},e.setMaxRecords=function(a){e.pageNumber=1,e.itemPerPage=a};var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.options=a.setOptionProperties(s),e.dtColumnDefs=a.setColumnProperties({}),e.viewSettlement=function(a){a.sorters=e.sortedObject.sorters,o.viewSettlement(a,function(a){e.receiptSettlementDetails=n.receiptData,e.receiptObjectList=a},function(a){q("error",r.instant("ERROR"))})},e.viewSettlementDetails=function(a){var b={};b.adjustmentId=a.id,b.targetTypeCode=a.typeCode,b.sourceTypeCode=e.receiptDetails.typeCode,e.settlementDetails={},o.getSettlementDetailsForReceiptById(b,function(a){e.settlementDetails=a,c.go("managereceiptsettlement",{type:"View",data:e.settlementDetails,id:n.id,sourceTypeCode:b.sourceTypeCode,targetTypeCode:b.targetTypeCode,receiptObject:e.receiptDetails,settlementId:b.adjustmentId})},function(a){q("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.viewReceiptDetails=function(a){o.getReceiptPaymentDetails(a,function(a){e.receiptDetails=a,e.receiptDetails.receiptDate=f("timestampToDate")(e.receiptDetails.receiptDate)},function(a){q("error",r.instant("ERROR"))})},e.editSettlementDetails=function(a){var b={};b.adjustmentId=a.id,b.targetTypeCode=a.typeCode,b.sourceTypeCode=e.receiptDetails.typeCode,e.settlementDetails={},o.getSettlementDetailsForReceiptById(b,function(a){e.settlementDetails=a,c.go("managereceiptsettlement",{type:"Edit",data:e.settlementDetails,id:n.id,sourceTypeCode:b.sourceTypeCode,targetTypeCode:b.targetTypeCode,receiptObject:e.receiptDetails,settlementId:b.adjustmentId})},function(a){q("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.addNewSettlement=function(){c.go("managereceiptsettlement",{id:n.id,sourceTypeCode:n.receiptType,receiptObject:e.receiptDetails,type:"Create"})},e.confirmInactive=function(a){var b={},d={};b.adjustmentId=a.id,b.targetTypeCode=a.typeCode,b.sourceTypeCode=e.receiptDetails.typeCode,e.settlementDetails={},o.getSettlementDetailsForReceiptById(b,function(a){d=a,e.inactivateObject={},e.inactivateObject.id=d.adjustmentId,e.inactivateObject.version=d.version,e.inactivateObject.sourceAdjustmentDocumentCode=d.sourceAdjustmentDocumentCode,e.inactivateObject.targetAdjustmentDocumentCode=d.targetAdjustmentDocumentCode,e.inactivateObject.adjustmentDocumentType=d.adjustmentDocumentType,e.inactivateObject.exchangeRate=d.exchangeRate,e.inactivateObject.sourceAmountAdjusted=d.sourceAmountAdjusted,e.inactivateObject.targetAmountAdjusted=d.targetAmountAdjusted,e.inactivateObject.inactiveReason=d.inactiveReason,e.inactivateObject.whetherActive=d.whetherActive,"RECEIPT"==d.targetTypeCode?(e.inactivateObject.receipt={id:d.targetId},e.inactivateObject.bill=null,e.inactivateObject.refundBill=null,e.inactivateObject.payment=null):"PAYMENT"==d.targetTypeCode?(e.inactivateObject.receipt=null,e.inactivateObject.bill=null,e.inactivateObject.refundBill=null,e.inactivateObject.payment={id:d.targetId}):"DEBIT"==d.targetTypeCode?(e.inactivateObject.receipt=null,e.inactivateObject.bill={id:d.targetId},e.inactivateObject.refundBill=null,e.inactivateObject.payment=null):(e.inactivateObject.receipt=null,e.inactivateObject.bill=null,e.inactivateObject.refundBill={id:d.targetId},e.inactivateObject.payment=null),"RECEIPT"==d.typeCode?e.inactivateObject.receipt={id:d.id}:e.inactivateObject.payment={id:d.id},e.inactivateObject.ownerLocationId={id:d.ownerLocationId},p.inactivateSettlement(e.inactivateObject,function(a){q("success",angular.fromJson(a.data).successMessage),c.reload()},function(a){q("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},function(a){q("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.back=function(){d.goBackToPrevState()},e.init=function(){if(e.filterCriteria={},e.hideNew=!1,null!=n.pageFrom&&(e.hideNew=!0),e.receiptSettlementDetails={},n.receiptType&&n.id){e.receiptId={id:n.id,typeCode:n.receiptType};var a={id:n.id};e.viewReceiptDetails(a),e.viewSettlement(e.receiptId)}else n.data&&n.receiptData&&(e.receiptDetails=n.receiptData,e.receiptObjectList=n.data,e.receiptDetails.receiptDate=f("timestampToDate")(e.receiptDetails.receiptDate))},e.init()}]),angular.module("paripal.billingModule").controller("ReceiptSummaryViewCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","addReceiptPaymentService","dateconvertor","$stateParams","commonBillingService","featurePrivilegeConstants","viewReceiptPaymentService","fileOperations","baseService","commonCalendarService","viewBillsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";var y={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"},z=angular.fromJson(localStorage.getItem("stateParamsData"));e.options=a.setOptionProperties(y),e.dtColumnDefs=a.setColumnProperties({}),e.disableLink=function(a){a.preventDefault()},e.done=function(){if(angular.fromJson(localStorage.getItem("loggedInUser")))if("EVENT"==e.billDetails.BILL_FOR&&"true"==localStorage.getItem("isOrgUserMode"))c.go("eventList");else if("MY_BOOKING"==e.billDetails.CALLER_SCREEN&&"false"==localStorage.getItem("isOrgUserMode"))c.go("myBookings");else if("EVENT"==e.billDetails.BILL_FOR&&"false"==localStorage.getItem("isOrgUserMode"))c.go("showEvents");else if("SUBSCRIPTION_TYPE"==e.billDetails.BILL_FOR&&"true"==localStorage.getItem("isOrgUserMode"))c.go("orgsubscriptionlist");else if("DIAGNOSTIC_TEST"==e.billDetails.BILL_FOR)c.go("testorderlist");else if("FIX_APPOINTMENTS"==e.billDetails.BILL_FOR&&"true"==localStorage.getItem("isOrgUserMode"))c.go("appointmentsList");else if("FIX_APPOINTMENTS"==e.billDetails.BILL_FOR&&"true"!=localStorage.getItem("isOrgUserMode")){var a=angular.fromJson(localStorage.getItem("whetherOnlineAppointment"));if(a){var b={};b.relatedtoCalendarEvent=angular.fromJson(localStorage.getItem("eventId")),b.appointmentId=angular.fromJson(localStorage.getItem("appointmentId")),"false"==localStorage.getItem("isCheckedIn")&&(localStorage.setItem("isCheckedIn","true"),w.getConversationIdForAppointmentAgora(b,function(a){
//var url = $state.href('skypeHome', {
var b={};b.userId=angular.fromJson(v.getLoggedInUser()).id,b.convId=a.response.convId,b.convType="APPOINTMENT",b.userName=angular.fromJson(v.getLoggedInUser()).displayName,"AGORA"==a.response.usageType?c.go("agoraHome",b):c.go("skypeHome",b)},function(a){}))}else c.go("manageFixAppointment",{type:"edit",appointmentId:localStorage.getItem("appointmentId")})}else"REQ_HOME_VISIT"==e.billDetails.BILL_FOR?c.go("requeststatus",{type:"edit",requestId:z.requeststatus.requestId,id:z.requeststatus.id}):"REQ_ONLINE_ADVICE"==e.billDetails.BILL_FOR?c.go("requeststatus",{type:"edit",requestId:z.requeststatus.requestId,id:z.requeststatus.id}):"REQ_URGENT_CLARIFICATION"==e.billDetails.BILL_FOR?c.go("requeststatus",{type:"edit",requestId:z.requeststatus.requestId,id:z.requeststatus.id}):"REQ_MEDICAL_CERTIFICATE"==e.billDetails.BILL_FOR?c.go("requeststatus",{type:"edit",requestId:z.requeststatus.requestId,id:z.requeststatus.id}):"SUBSCRIPTION_TYPE"==e.billDetails.BILL_FOR?c.go("login"):"EMERGENCY_ADMISSION"!=e.billDetails.BILL_FOR||d.isFieldEmpty(e.billDetails.sequenceId)?"EMERGENCY_ADMISSION"==e.billDetails.BILL_FOR&&d.isFieldEmpty(e.billDetails.sequenceId)?c.go("emergencymanagement"):c.go("home.view"):c.go("emergencyrequeststatus");else c.go("landingPage")},e.showDocument=function(a){if(/*var document = $scope.document;*/
a.preventDefault(),e.wsReceiptDocument){var b=new Object;b.fileName=e.wsReceiptDocument.fileName,b.resourceId=e.wsReceiptDocument.id,b.recordId=e.receiptId,b.docType=e.wsReceiptDocument.documentType.type,b.docSubType=e.wsReceiptDocument.documentType.subType,b.orgLocId=e.wsReceiptDocument.serviceProviderId,e.fileResource=b,e.viewFileContent=!0,e.isHidingPrintButton=!1}},e.init=function(){if(localStorage.getItem("BillDetails")&&(e.billDetails=angular.fromJson(localStorage.getItem("BillDetails"))),e.receiptSummary={},q.receiptId){var a={id:q.receiptId};t.getAutoReceiptDetails(a,function(a){var b=a.wsReceiptPaymentForAutoView;if(e.wsReceiptDocument=a.wsReceiptDocument,e.receiptId=b.receiptPaymentId,e.receiptSummary.receiptId=b.serviceProviderReferenceNo,e.receiptSummary.receiptDate=p.convertToViewDate(b.receiptDate),e.receiptSummary.paymentMode=b.payRefs[0].paymentMode,e.receiptSummary.paymentRefNo=b.payRefs[0].paymentReferenceNo,e.receiptSummary.amount=b.amount,b.ownerOrgLoc.orgLocAddressToDisplay&&(e.receiptSummary.raisedByAddress=b.ownerOrgLoc.orgLocAddressToDisplay),b.ownerOrgLoc.displayName&&(e.receiptSummary.raisedBy=b.ownerOrgLoc.displayName),!d.isNullOrEmpty(a.wsReceiptPaymentForAutoView.ownerOrgLoc),b.madeByOrgLoc?(b.madeByOrgLoc.orgLocAddressToDisplay&&(e.receiptSummary.raisedOnAddress=b.madeByOrgLoc.orgLocAddressToDisplay),b.madeByOrgLoc.displayName&&(e.receiptSummary.raisedOn=b.madeByOrgLoc.displayName)):b.madeByUser&&(b.madeByUser.userAddressToDisplay&&(e.receiptSummary.raisedOnAddress=b.madeByUser.userAddressToDisplay),b.madeByUser.displayName&&(e.receiptSummary.raisedOn=b.madeByUser.displayName)),b.ownerOrgLoc.logoDocumentId){var c=new Object;c.fileName=b.ownerOrgLoc.logoFilePath,c.resourceId=b.ownerOrgLoc.logoDocumentId,c.docType=n.documentTypes.orgLogo,c.docSubType=n.documentSubTypes.orgLocLogo,c.orgLocId=b.ownerOrgLoc.id,u.getImageUrl(c,function(a){e.logoUrl=a},function(){})}else e.logoUrl="app/images/billing/hospital.png"},function(a){})}},e.init()}]),angular.module("paripal.billingModule").controller("SearchBillCtrl",["datatableconfig","viewBillsService","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","dateconvertor","manageBillService","$translate","notify","commonBillingService","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.billObjectList=[{}],f.sortedObject={},f.isConsolidatedChanged=function(){f.changeTransactionTypeAuthority(f.filterCriteria.whetherConsolidated)},f.changeTransactionTypeAuthority=function(a){f.filterCriteria.transactionTypeId=-1,f.billSearchObject.isTransactionTypeDisabled=a},f.billedPartyTypeSelected=function(){f.partyNameId={},f.fillBilledParty()},f.inFavorOfTypeSelected=function(){f.inFavorOfSSId={},f.fillInFavorOf()},f.fillBilledParty=function(){"ORGANIZATION_LOCATION"!=f.filterCriteria.inFavorOf&&"INDIVIDUAL"!=f.filterCriteria.inFavorOf||(f.isMadeFromSSDisabled=!1)},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getPartyNameData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON_SMARTSEARCH"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.BILL_VIEW})},f.fillInFavorOf=function(){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf||"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.isMadeToSSDisabled=!1,f.isMadeToSSVisible=!0):f.isMadeToSSDisabled=!0},f.getOrgLocationList=function(){return h.getData(i.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){f.billSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.BILL_VIEW})},f.billTypeSettings=function(a){"DEBIT"==a?(f.showPartyType=!0,f.showInFavorOf=!1,f.isMadeToSSVisible=!1,f.isMadeToDDVisible=!0,f.isMadeFromSSVisible=!0,f.isMadeFromDDVisible=!1,f.isInFavorOfTypeDisabled=!0,f.isPartyTypeDisabled=!1,f.isMadeToDDDisabled=!1,f.isMadeToSSDisabled=!0,f.isBillTypeDisabled=!1,f.filterCriteria.inFavorOf="ORGANIZATION_LOCATION",f.filterCriteria.raisedOn=null):(f.showPartyType=!1,f.showInFavorOf=!0,f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromSSVisible=!1,f.isMadeFromDDVisible=!0,f.isInFavorOfTypeDisabled=!1,f.isPartyTypeDisabled=!0,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!1,f.isMadeFromSSDisabled=!0,f.isBillTypeDisabled=!0,f.filterCriteria.raisedOn="ORGANIZATION_LOCATION",f.filterCriteria.inFavorOf=null),f.filterCriteria.inFavorOfLocationId=null,f.filterCriteria.inFavorOfUserId=null,f.filterCriteria.raisedOnLocationId=null,f.filterCriteria.raisedOnUserId=null},f.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf?f.filterCriteria.inFavorOfLocationId=a.id:f.filterCriteria.inFavorOfUserId=a.id},f.inFavorOfPersonSelected=function(a){f.filterCriteria.inFavorOfLocationId=a.id},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getinFavorOfNameData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.BILL_VIEW})},f.billTypeSelected=function(){f.billTypeSettings(f.filterCriteria.type),"CREDIT"==f.filterCriteria.type?(f.disableConsolidated=!0,f.filterCriteria.whetherConsolidated=null):f.disableConsolidated=!1},f.pageChanged=function(){f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems),f.filterBills(f.isSearched)},f.setMaxRecords=function(a){f.currentPage=1,f.itemPerPage=a,f.filterBills(f.isSearched)};var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(x),f.dtColumnDefs=a.setColumnProperties({}),f.partyNameDDSelected=function(a){f.filterCriteria.raisedOnLocationId=a.id},f.createReceipt=function(a){var b={id:a.id};h.getData(i.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(a){f.billDetails=angular.fromJson(a.data),d.go("managereceiptpayment",{type:"add",data:f.billDetails})},function(a){})},f.getFilteredBills=function(a,d,g){n.showSpinner=!0;var h={},i="";0==a?(i="FILTER_BILLS",h.type="DEBIT"):(i="FILTER_BILLS",1==f.isSearched&&(e.isFieldEmpty(d)||(f.filterCriteria.dateFrom=p.convertToServerDate(d)),e.isFieldEmpty(g)||(f.filterCriteria.dateTill=p.convertToServerDate(g)),delete f.filterCriteria.inFavorOfId,delete f.filterCriteria.billedPartyId,h=angular.copy(f.filterCriteria),"DEBIT"==h.type?h.inFavorOfLocationId=h.billingLocationId:h.raisedOnLocationId=h.billingLocationId,delete h.billingLocationId,h.transactionTypeId==-1&&(h.transactionTypeId=null))),h.sorters=f.sortedObject.sorters,h.pageNumber=f.currentPage,h.recordsPerPage=f.itemPerPage,b.filterBills(i,h,function(a){f.billObjectList=a,f.totalItems=a.totalRecords,f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems),n.showSpinner=!1},function(a){})},f.viewBillPdf=function(a,c){var d={billId:a.id};n.showSpinner=!0,b.viewPdfBill(d,function(b){n.showSpinner=!1;var d=b;c.preventDefault();var e=new Object;e.fileName=d.fileName,e.resourceId=d.id,e.recordId=a.id,e.docType=d.documentType.type,e.docSubType=d.documentType.subType,f.fileResource=e,f.viewFileContent=!0,f.isHidingPrintButton=!1},function(a){n.showSpinner=!1})},f.clear=function(){f.init(),f.inFavorOfSSId={},f.filterCriteria={},f.partyNameId={}},f.getBillTypes=function(){f.getListOfBillTypes()},f.getListOfBillTypes=function(){return h.getData(i.getUrl("FIND_BILL_TYPE"),null,function(a){f.billSearchObject.billTypeList=angular.fromJson(a.data)},function(a){})},f.getBillingLocations=function(a){null==a&&(a="");var b={locationId:a};t.getBillingLocations(b,function(a){f.billSearchObject.billingLocationList=a},function(a){s("error",r.instant("PFROFESSIONAL_FETCH_ERROR"))},w.PROF_BILL_VIEW)},f.getBillStatuses=function(){f.getListOfBillStatus()},f.getListOfBillStatus=function(){return h.getData(i.getUrl("FIND_STATUS_LIST"),null,function(a){f.billSearchObject.billStatusList=angular.fromJson(a.data)},function(a){})},f.viewBill=function(a){({id:a.id});1==a.whetherConsolidated?d.go("consolidatedbill",{billId:a.id,type:"view"}):d.go("managebill",{billId:a.id,type:"view"})},f.editBill=function(a){({id:a.id});d.go("managebill",{billId:a.id,type:"edit"})},f.addNewBill=function(){var a=null;e.isNullOrEmpty(u)||e.isNullOrEmpty(u.data)||e.isNullOrEmpty(u.data.fromApptList)||(a=angular.copy(u.data),a.fromCheckIn=!0),d.go("createbill",{pageState:"CREATE",isFromBillList:!0,data:a})},f.viewSettlementView=function(a){a&&d.go("billsettlementview",{type:null,billId:a.id,billTypeCode:a.typeCode})},f.inactivateBill=function(a){var b={id:a.id};q.inactivateBill(b,function(a){s("success",a.successMessage),d.reload()},function(a){})},f.getTransactionTypes=function(){t.getListOfTransactionTypes(function(a){f.billSearchObject.transactionTypeList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.organizationLocationSelected=function(a){f.isControlDisabled=!1,f.disableControls=!1,f.getBillingLocations(a)},f.getPartyTypes=function(){f.getListOfPartyTypes()},f.getListOfPartyTypes=function(){return h.getData(i.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){f.billSearchObject.billedPartyTypeList=angular.fromJson(a.data)},function(a){})},f.filterBills=function(a,b,c){1==a&&(f.isSearched=!0),f.getFilteredBills(a,b,c)},f.getCurrencys=function(){f.getCurrencyList()},f.getCurrencyList=function(){return h.getData(i.getUrl("GET_CURRENCYLIST_DATA"),null,function(a){f.billSearchObject.currencyTypeList=angular.fromJson(a.data)},function(a){})},f.getInFavorOfData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.onInFavorOfSelect=function(a){f.selectedInFavor=a,"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.filterCriteria.inFavorOfUserId=a.id,f.filterCriteria.inFavorOfLocationId=null):(f.filterCriteria.inFavorOfLocationId=a.id,f.filterCriteria.inFavorOfUserId=null)},f.getBilledPartyData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.getMadeToOrgList=function(){f.getListOfMadeToOrgs()},f.getListOfMadeToOrgs=function(){return h.getData(i.getUrl("FIND_BILL_MADE_TO_DROPDOWN"),null,function(a){f.billSearchObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.BILL_VIEW})},f.getMadeFromOrgList=function(){f.getListOfMadeFromOrgs()},f.getListOfMadeFromOrgs=function(){return h.getData(i.getUrl("FIND_BILL_MADE_BY_DROPDOWN"),null,function(a){f.billSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.BILL_VIEW})},f.onBilledPartySelect=function(a){f.selectedRaisedOn=a,"INDIVIDUAL"==f.filterCriteria.raisedOn?(f.filterCriteria.raisedOnUserId=a.id,f.filterCriteria.raisedOnLocationId=null):(f.filterCriteria.raisedOnLocationId=a.id,f.filterCriteria.raisedOnUserId=null)},f.setSearchSettings=function(){f.searchType=""},f.init=function(){f.dateFromString=null,f.dateTillString=null,f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromDDVisible=!1,f.isMadeFromSSVisible=!0,f.isControlDisabled=!0,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!0,f.isMadeFromSSDisabled=!0,f.disableControls=!1,f.disableConsolidated=null,f.setSearchSettings(),f.selectedInFavor={},f.selectedRaisedOn={},f.billSearchObject={},f.billSearchObject.isTransactionTypeDisabled=!1,f.filterCriteria={},f.billSearchObject={},/*$scope.filterCriteria.locationId = {};*/
f.isInFavorOfDisabled=!0,f.isBilledPartyDisabled=!0,f.filterCriteria.type="DEBIT",f.isSearched=!1,f.getBillTypes(),f.getListOfBillStatus(),f.getPartyTypes(),f.getCurrencys(),f.getTransactionTypes(),f.billTypeSelected(),f.getMadeToOrgList(),f.getMadeFromOrgList(),f.partyNameId={},f.partyNameId.id=null,e.isNullOrEmpty(u)?(f.filterBills(!1),f.getBillingLocations(null)):(e.isNullOrEmpty(u.data)||(/* set location */
e.isNullOrEmpty(u.data.inFavorOfOrgList)||e.isNullOrEmpty(u.data.inFavorOfOrgList.id)||(f.locationID=u.data.inFavorOfOrgList.id,f.filterCriteria.billingLocationId=u.data.inFavorOfOrgList.id),/* set dates */
e.isNullOrEmpty(u.data.dateFromString)||e.isNullOrEmpty(u.data.dateTillString)||(f.dateFromString=u.data.dateFromString,f.dateTillString=u.data.dateTillString),/* set party type */
e.isNullOrEmpty(u.data.raisedOn)||(f.filterCriteria.raisedOn=u.data.raisedOn),/* set raisedOnUserId */
e.isNullOrEmpty(u.data.partyNameId)||e.isNullOrEmpty(u.data.partyNameId.id)||(f.filterCriteria.raisedOnUserId=u.data.partyNameId.id,f.partyNameId.id=u.data.partyNameId)),f.filterBills(!0,f.dateFromString,f.dateTillString))},f.init()}]),angular.module("paripal.billingModule").controller("SearchClientBillCtrl",["datatableconfig","viewBillsService","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","dateconvertor","manageBillService","$translate","notify","commonBillingService","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.billObjectList=[{}],f.sortedObject={},f.isConsolidatedChanged=function(){f.changeTransactionTypeAuthority(f.filterCriteria.whetherConsolidated)},f.changeTransactionTypeAuthority=function(a){f.filterCriteria.transactionTypeId=-1,f.billSearchObject.isTransactionTypeDisabled=a},f.createReceipt=function(a){var b={id:a.id};h.getData(i.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(a){f.billDetails=angular.fromJson(a.data),d.go("managereceiptpayment",{type:"add",data:f.billDetails})},function(a){})},f.viewBillPdf=function(a,c){var d={billId:a.id};n.showSpinner=!0,b.viewPdfBill(d,function(b){n.showSpinner=!1;var d=b;c.preventDefault();var e=new Object;e.fileName=d.fileName,e.resourceId=d.id,e.recordId=a.id,e.docType=d.documentType.type,e.docSubType=d.documentType.subType,f.fileResource=e,f.viewFileContent=!0,f.isHidingPrintButton=!1},function(a){n.showSpinner=!1})},f.billedPartyTypeSelected=function(){f.partyNameId={},f.fillBilledParty()},f.inFavorOfTypeSelected=function(){f.inFavorOfSSId={},f.fillInFavorOf()},f.fillBilledParty=function(){"ORGANIZATION_LOCATION"!=f.filterCriteria.inFavorOf&&"INDIVIDUAL"!=f.filterCriteria.inFavorOf||(f.isMadeFromSSDisabled=!1)},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getBillingLocations=function(a){null==a&&(a="");var b={locationId:a};t.getBillingLocations(b,function(a){f.billSearchObject.billingLocationList=a},function(a){s("error",r.instant("PFROFESSIONAL_FETCH_ERROR"))},w.CLIENT_BILL_VIEW)},f.getPartyNameData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON_SMARTSEARCH"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.CLIENT_BILL_VIEW})},f.fillInFavorOf=function(){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf||"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.isMadeToSSDisabled=!1,f.isMadeToSSVisible=!0):f.isMadeToSSDisabled=!0},f.getOrgLocationList=function(){return h.getData(i.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){f.billSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.CLIENT_BILL_VIEW})},f.billTypeSettings=function(a){"DEBIT"==a?(f.isMadeToSSVisible=!1,f.isMadeToDDVisible=!0,f.isMadeFromSSVisible=!0,f.isMadeFromDDVisible=!1,f.isInFavorOfTypeDisabled=!0,f.isPartyTypeDisabled=!1,f.isMadeToDDDisabled=!1,f.isMadeToSSDisabled=!0,f.isBillTypeDisabled=!1,f.filterCriteria.inFavorOf="ORGANIZATION_LOCATION",f.filterCriteria.raisedOn=null):(f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromSSVisible=!1,f.isMadeFromDDVisible=!0,f.isInFavorOfTypeDisabled=!1,f.isPartyTypeDisabled=!0,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!1,f.isMadeFromSSDisabled=!0,f.isBillTypeDisabled=!0,f.filterCriteria.raisedOn="ORGANIZATION_LOCATION",f.filterCriteria.inFavorOf=null),f.filterCriteria.inFavorOfLocationId=null,f.filterCriteria.inFavorOfUserId=null,f.filterCriteria.raisedOnLocationId=null,f.filterCriteria.raisedOnUserId=null},f.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf?f.filterCriteria.inFavorOfLocationId=a.id:f.filterCriteria.inFavorOfUserId=a.id},f.inFavorOfPersonSelected=function(a){f.filterCriteria.inFavorOfLocationId=a.id},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getinFavorOfNameData=function(a){/*$scope.requestData.type = $scope.filterCriteria.type;*/
return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.CLIENT_BILL_VIEW})},f.billTypeSelected=function(){f.billTypeSettings(f.filterCriteria.type)},f.pageChanged=function(){f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems),f.filterBills(f.isSearched)},f.setMaxRecords=function(a){f.currentPage=1,f.itemPerPage=a,f.filterBills(f.isSearched)};var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(x),f.dtColumnDefs=a.setColumnProperties({}),f.partyNameDDSelected=function(a){f.filterCriteria.raisedOnLocationId=a.id},f.getFilteredBills=function(a,d,g){var h={},i="";if(0==a)if("clientSearch"==f.searchType){if(i="FIND_BILLS_FOR_CLIENT",null!==localStorage.getItem("loggedInUser")){angular.fromJson(localStorage.getItem("loggedInUser")).id;h={},h.type="DEBIT"}}else i="professionalSearch"==f.searchType?"FIND_BILLS_FOR_PROFESSIONALS":"FILTER_BILLS";else i="clientSearch"==f.searchType?"FIND_BILLS_FOR_CLIENT":"professionalSearch"==f.searchType?"FIND_BILLS_FOR_PROFESSIONALS":"FILTER_BILLS",1==f.isSearched&&(e.isFieldEmpty(d)||(f.filterCriteria.dateFrom=p.convertToServerDate(d)),e.isFieldEmpty(g)||(f.filterCriteria.dateTill=p.convertToServerDate(g)),delete f.filterCriteria.inFavorOfId,delete f.filterCriteria.billedPartyId,h=angular.copy(f.filterCriteria),"DEBIT"==h.type?(h.inFavorOfLocationId=h.billingLocationId,h.raisedOn=f.billSearchObject.clientType):(h.raisedOnLocationId=h.billingLocationId,h.inFavorOf=f.billSearchObject.clientType),delete h.billingLocationId,h.transactionTypeId==-1&&(h.transactionTypeId=null));h.sorters=f.sortedObject.sorters,h.pageNumber=f.currentPage,h.recordsPerPage=f.itemPerPage,b.filterBills(i,h,function(a){f.billObjectList=a,f.totalItems=a.totalRecords,f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems)},function(a){})},f.clear=function(){f.init()},f.getBillTypes=function(){f.getListOfBillTypes()},f.getListOfBillTypes=function(){return h.getData(i.getUrl("FIND_BILL_TYPE"),null,function(a){f.billSearchObject.billTypeList=angular.fromJson(a.data)},function(a){})},f.getBillStatuses=function(){f.getListOfBillStatus()},f.getListOfBillStatus=function(){return h.getData(i.getUrl("FIND_STATUS_LIST"),null,function(a){f.billSearchObject.billStatusList=angular.fromJson(a.data)},function(a){})},f.viewBill=function(a){var b={id:a.id};h.getData(i.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(b){d.go("managebill",{billId:a.id,type:"view",data:angular.fromJson(b.data)})},function(a){})},f.viewSettlementView=function(a){a&&d.go("billsettlementview",{type:null,billId:a.id,billTypeCode:a.typeCode,pageFrom:"CLIENT"})},f.getTransactionTypes=function(){t.getListOfTransactionTypes(function(a){f.billSearchObject.transactionTypeList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.organizationLocationSelected=function(a){f.isControlDisabled=!1,"professionalSearch"==f.searchType?f.getProfessionals(a):"clientSearch"==f.searchType?f.getClientType():f.disableControls=!1,f.getBillingLocations(a)},f.clientNameSelected=function(a){f.disableControls=!1,f.filterCriteria.clientId=a.id},f.professionalSelected=function(){f.disableControls=!1},f.clientSelected=function(){f.disableControls=!1},f.getProfessionals=function(a){var b={locationId:a};t.getProfessionalsForBill(b,function(a){f.billSearchObject.professionalsList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.getClients=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.billSearchObject.clientType,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,e.isFieldEmpty(f.filterCriteria.locationId)?f.requestData.orgLocationId=null:f.requestData.orgLocationId=f.filterCriteria.locationId,f.userNameAutoCmpLoading=!0,h.postData(i.getUrl("FIND_CLIENTS_FOR_BILLS"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.CLIENT_BILL_VIEW})},f.getClientsForBills=function(a){var b={locationId:a};t.getClientsForBills(b,function(a){f.billSearchObject.clientList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.professionalSelected=function(){f.disableControls=!1},f.getPartyTypes=function(){f.getListOfPartyTypes()},f.getListOfPartyTypes=function(){return h.getData(i.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){f.billSearchObject.billedPartyTypeList=angular.fromJson(a.data)},function(a){})},f.getClientType=function(){return h.getData(i.getUrl("FIND_PARTY_TYPE"),null,function(a){f.clientTypeList=angular.fromJson(a.data)},function(a){})},f.filterBills=function(a,b,c){1==a&&(f.isSearched=!0),f.getFilteredBills(a,b,c)},f.getCurrencys=function(){f.getCurrencyList()},f.getCurrencyList=function(){return h.getData(i.getUrl("GET_CURRENCYLIST_DATA"),null,function(a){f.billSearchObject.currencyTypeList=angular.fromJson(a.data)},function(a){})},f.getInFavorOfData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.onInFavorOfSelect=function(a){f.selectedInFavor=a,"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.filterCriteria.inFavorOfUserId=a.id,f.filterCriteria.inFavorOfLocationId=null):(f.filterCriteria.inFavorOfLocationId=a.id,f.filterCriteria.inFavorOfUserId=null)},f.getBilledPartyData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.getMadeToOrgList=function(){f.getListOfMadeToOrgs()},f.getListOfMadeToOrgs=function(){return h.getData(i.getUrl("FIND_BILL_MADE_TO_DROPDOWN"),null,function(a){f.billSearchObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.CLIENT_BILL_VIEW})},f.getMadeFromOrgList=function(){f.getListOfMadeFromOrgs()},f.getListOfMadeFromOrgs=function(){return h.getData(i.getUrl("FIND_BILL_MADE_BY_DROPDOWN"),null,function(a){f.billSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.CLIENT_BILL_VIEW})},f.onBilledPartySelect=function(a){f.selectedRaisedOn=a,"INDIVIDUAL"==f.filterCriteria.raisedOn?(f.filterCriteria.raisedOnUserId=a.id,f.filterCriteria.raisedOnLocationId=null):(f.filterCriteria.raisedOnLocationId=a.id,f.filterCriteria.raisedOnUserId=null)},f.setSearchSettings=function(){u.searchType?"searchClientBill"==u.searchType?f.searchType="clientSearch":"searchProfessionalBill"==u.searchType&&(f.searchType="professionalSearch"):f.searchType=""},f.init=function(){n.$broadcast("clearValidFromValidTill"),f.dateFromString=null,f.dateTillString=null,f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromDDVisible=!1,f.isMadeFromSSVisible=!0,f.isControlDisabled=!1,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!0,f.isMadeFromSSDisabled=!0,"professionalSearch"==u.type||"clientSearch"==u.type?f.disableControls=!0:f.disableControls=!1,f.setSearchSettings(),f.client={},f.selectedInFavor={},f.selectedRaisedOn={},f.billSearchObject={},f.billSearchObject.isTransactionTypeDisabled=!1,f.filterCriteria={},f.billSearchObject={},f.isInFavorOfDisabled=!0,f.isBilledPartyDisabled=!0,f.filterCriteria.type="DEBIT",f.isSearched=!1,f.getBillTypes(),f.getListOfBillStatus(),f.getPartyTypes(),f.getCurrencys(),f.getTransactionTypes(),f.billTypeSelected(),f.getMadeToOrgList(),f.getMadeFromOrgList(),f.filterBills(!1),f.getClientType(),f.getBillingLocations(null)},f.init()}]),angular.module("paripal.billingModule").controller("SearchClientReceiptCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","viewReceiptPaymentService","dateconvertor","commonBillingService","notify","$translate","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.partyNameId=null,e.commonConstants=n,e.inFavorOfSSId={},e.partyNameId={},e.userIdentifyDetail={},e.sortedObject={},e.isConsolidatedChanged=function(){e.changeTransactionTypeAuthority(e.filterCriteria.whetherConsolidated)},e.changeTransactionTypeAuthority=function(a){e.filterCriteria.transactionTypeId=-1,e.receiptSearchObject.isTransactionTypeDisabled=a},e.addPaymentReceipt=function(){c.go("managereceiptpayment",{type:"",data:""})},e.viewReceiptPdf=function(a,b){var c={receiptId:a.id};m.showSpinner=!0,o.viewPdfReceipt(c,function(c){var d=c;b.preventDefault();var f=new Object;f.fileName=d.fileName,f.resourceId=d.id,f.recordId=a.id,f.docType=d.documentType.type,f.docSubType=d.documentType.subType,/*fileObject.orgLocId = document.organizationLocationId;*/
m.showSpinner=!1,e.fileResource=f,e.viewFileContent=!0,e.isHidingPrintButton=!1},function(a){m.showSpinner=!1})},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems),e.getFilteredReceiptPayment(e.isSearched)},e.setMaxRecords=function(a){e.currentPage=1,e.itemPerPage=a,e.getFilteredReceiptPayment(e.isSearched)};var w={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.getReceiptPaymentStatuses=function(){q.getListOfReceiptPaymentStatus(function(a){e.receiptSearchObject.receiptStatusList=a},function(a){r("error",s.instant("PROFESSIONAL_TYPE_FAITURE"))})},e.getReceiptPaymentTypes=function(){q.getListOfReceiptPaymentTypes(function(a){e.receiptSearchObject.receiptTypeList=a},function(a){})},e.getTransactionTypes=function(){q.getListOfTransactionTypes(function(a){e.receiptSearchObject.transactionTypeList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getPartyTypes=function(a){q.getListOfPartyTypes(function(a){e.receiptSearchObject.inFavorOfTypeList=a,e.receiptSearchObject.partyTypeList=a},function(a){r("error",s.instant("PARTY_TYPE_LIST_FAILURE"))},a)},e.getMadeToOrgList=function(){q.getListOfMadeToOrgs(function(a){e.receiptSearchObject.inFavorOfOrgList=a},function(a){},v.CLIENT_RP_VIEW)},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){var a="";return a="myReceipts"==t.searchType?"GET_LOCATIONS_FOR_MY_BILLS":"FIND_MADE_BY_DROPDOWN",g.getData(h.getUrl(a),null,function(a){e.receiptSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.CLIENT_RP_VIEW})},e.getUserNames=function(a){return e.userData={},e.userData.userName=a,e.userNameAutoCmpLoading=!0,g.getData(h.getParameterizedUrl("FIND_USER_NAME",e.userData),null,function(a){return e.userNameAutoCmpLoading=!1,e.userNames=angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getinFavorOfNameData=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.filterCriteria.madeTo,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,g.postData(h.getParameterizedUrl("FIND_MADE_TO_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:v.CLIENT_RP_VIEW})},e.getClientType=function(){return g.getData(h.getUrl("FIND_PARTY_TYPE"),null,function(a){e.clientTypeList=angular.fromJson(a.data)},function(a){})},e.getPartyNameData=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.filterCriteria.madeBy,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,g.postData(h.getParameterizedUrl("FIND_MADE_BY_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:v.CLIENT_RP_VIEW})},e.clientNameSelected=function(a){e.filterCriteria.clientId=a.id,e.disableControls=!1},e.getClients=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.receiptSearchObject.clientType,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,d.isFieldEmpty(e.filterCriteria.locationId)?e.requestData.orgLocId=null:e.requestData.orgLocId=e.filterCriteria.locationId,e.userNameAutoCmpLoading=!0,g.postData(h.getUrl("FIND_CLIENTS_FOR_RECEIPTS"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:v.CLIENT_RP_VIEW})},e.getOrgLocationList=function(){return g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){e.receiptSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.CLIENT_RP_VIEW})},e.typeSelected=function(){"RECEIPT"==e.filterCriteria.typeCode?e.getPartyTypes("receipt"):e.getPartyTypes("payment"),e.changePartyStyle()},e.changePartyStyle=function(){"PAYMENT"==e.filterCriteria.typeCode?(e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isInFavorOfTypeDisabled=!1,e.isPartyTypeDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0,e.filterCriteria.madeBy="ORGANIZATION_LOCATION",e.filterCriteria.madeTo=""):(e.isMadeToSSVisible=!1,e.isMadeToDDVisible=!0,e.isMadeFromSSVisible=!0,e.isMadeFromDDVisible=!1,e.isInFavorOfTypeDisabled=!0,e.isPartyTypeDisabled=!1,e.isMadeToDDDisabled=!1,e.isMadeToSSDisabled=!0,e.filterCriteria.madeBy="",e.filterCriteria.madeTo="ORGANIZATION_LOCATION"),e.filterCriteria.madeByLocationId=null,e.filterCriteria.madeByUserId=null,e.filterCriteria.madeToLocationId=null,e.filterCriteria.madeToUserId=null},e.inFavorOfSelected=function(){e.inFavorOfSSId={},"ORGANIZATION_LOCATION"==e.filterCriteria.madeTo||"INDIVIDUAL"==e.filterCriteria.madeTo?(e.isMadeToSSDisabled=!1,e.isMadeToSSVisible=!0):e.isMadeToSSDisabled=!0},e.partyTypeSelected=function(){e.partyNameId={},"ORGANIZATION_LOCATION"==e.filterCriteria.madeBy||"INDIVIDUAL"==e.filterCriteria.madeBy?(e.isMadeFromSSDisabled=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isThirdPartyDisabled=!0):(e.isThirdPartyVisible=!0,e.isThirdPartyDisabled=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!1)},e.options=a.setOptionProperties(w),e.dtColumnDefs=a.setColumnProperties({}),e.inFavorOfPersonSelected=function(a){e.filterCriteria.madeToLocationId=a},e.partyNameDDSelected=function(a){e.filterCriteria.madeByLocationId=a},e.getFilteredReceiptPayment=function(a,c,f){1==a&&(e.isSearched=!0);var g={},h="";if(0==a)if("clientSearch"==e.searchType||"myReceipts"==e.searchType){if(h="FIND_RECEIPTS_FOR_CLIENT",null!==localStorage.getItem("loggedInUser")){angular.fromJson(localStorage.getItem("loggedInUser")).id;g={}}}else h="professionalSearch"==e.searchType?"FIND_RECEIPT_FOR_PROFESSIONALS":"FILTER_RECEIPT_PAYMENT";else h="clientSearch"==e.searchType?"FIND_RECEIPTS_FOR_CLIENT":"professionalSearch"==e.searchType?"FIND_RECEIPT_FOR_PROFESSIONALS":"FILTER_RECEIPT_PAYMENT",1==e.isSearched&&(d.isFieldEmpty(c)||(e.filterCriteria.dateFrom=p.convertToServerDate(c)),d.isFieldEmpty(f)||(e.filterCriteria.dateTill=p.convertToServerDate(f)),g=angular.copy(e.filterCriteria),"RECEIPT"==g.typeCode?(g.madeToLocationId=e.filterCriteria.locationId,/*criteriaObject.madeToLocationId = criteriaObject.billingLocationId;*/
g.madeBy=e.receiptSearchObject.clientType,g.madeByUserId=e.filterCriteria.clientId):(g.madeByLocationId=e.filterCriteria.locationId,/*criteriaObject.madeByLocationId = criteriaObject.billingLocationId;*/
g.madeTo=e.receiptSearchObject.clientType,g.madeToUserId=e.filterCriteria.clientId),delete g.billingLocationId,g.transactionTypeId==-1&&(g.transactionTypeId=null));""==g.madeBy&&(g.madeBy=null),""==g.madeTo&&(g.madeTo=null),"myReceipts"==e.searchType&&(g.madeTo=null),g.sorters=e.sortedObject.sorters,g.pageNumber=e.currentPage,g.recordsPerPage=e.itemPerPage;var i=v.CLIENT_RP_VIEW;o.filterPaymentReceipt(h,g,function(a){e.receiptObjectList=a,e.totalItems=a.totalRecords,e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},function(a){},i)},e.viewSettlement=function(a){o.viewSettlement(a,function(b){e.settlementDetails=b,c.go("receiptsettlementview",{type:null,data:e.settlementDetails,receiptData:a,id:a.id,receiptType:a.typeCode,pageFrom:"CLIENT"})},function(a){r("error",s.instant("ERROR"))})},e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeTo?e.filterCriteria.madeToLocationId=a.id:e.filterCriteria.madeToUserId=a.id},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeBy?e.filterCriteria.madeByLocationId=a.id:e.filterCriteria.madeByUserId=a.id},e.organizationLocationSelected=function(a){e.isControlDisabled=!1,"professionalSearch"==e.searchType?e.getProfessionals(a):"clientSearch"==e.searchType&&e.getClientType()},e.professionalSelected=function(){e.disableControls=!1},e.clientSelected=function(){e.disableControls=!1},e.getProfessionals=function(a){var a={locationId:a};q.getProfessionalsForReceipt(a,function(a){e.receiptSearchObject.professionalsList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getClientsForReceipts=function(a){var a={locationId:a};q.getClientsForReceipts(a,function(a){e.receiptSearchObject.clientList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.manageReceipt=function(a,b){var d={id:a.id};o.getReceiptPaymentDetails(d,function(d){c.go("managereceiptpayment",{type:b,data:d.data,receiptId:a.id})},function(a){r("error",s.instant("ERROR"))})},e.inactivateReceipt=function(a){var b={id:a.id};o.getReceiptPaymentDetails(b,function(a){g.putData(h.getUrl("INACTIVATE_RECEIPT_PAYMENT",null),a,function(a){r("success",a.successMessage),c.reload()},function(a){})},function(a){r("error",s.instant("ERROR"))})},e.clear=function(){e.init()},e.setSearchSettings=function(){t.searchType?"searchClientReceipt"==t.searchType?e.searchType="clientSearch":"searchProfessionalReceipt"==t.searchType?e.searchType="professionalSearch":"myReceipts"==t.searchType&&(e.searchType="myReceipts"):e.searchType=""},e.addMonths=function(a,b){return a.setMonth(a.getMonth()+b),a},e.init=function(){e.minDate=e.addMonths(new Date,-6),m.$broadcast("clearValidFromValidTill"),e.isPartyChanged=!1,e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isControlDisabled=!1,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.clientType={},"professionalSearch"==t.type||"clientSearch"==t.type?e.disableControls=!0:e.disableControls=!1,e.isSearched=!1,e.partyId=0,e.filterCriteria={},e.receiptSearchObject={},e.filterCriteria.whetherConsolidated=!1,e.filterCriteria.typeCode="RECEIPT",e.setSearchSettings(),e.changePartyStyle(),e.getReceiptPaymentStatuses(),e.getReceiptPaymentTypes(),e.getTransactionTypes(),e.getPartyTypes("receipt"),e.getMadeToOrgList(),e.getMadeFromOrgList(),e.getClientType(),e.getFilteredReceiptPayment(!1)},e.init()}]),angular.module("paripal.billingModule").controller("SearchMyBillCtrl",["datatableconfig","viewBillsService","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","dateconvertor","manageBillService","$translate","notify","commonBillingService","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.billObjectList=[{}],f.sortedObject={},f.isConsolidatedChanged=function(){f.changeTransactionTypeAuthority(f.filterCriteria.whetherConsolidated)},f.changeTransactionTypeAuthority=function(a){f.filterCriteria.transactionTypeId=-1,f.billSearchObject.isTransactionTypeDisabled=a},f.billedPartyTypeSelected=function(){f.partyNameId={},f.fillBilledParty()},f.inFavorOfTypeSelected=function(){f.inFavorOfSSId={},f.fillInFavorOf()},f.createReceipt=function(a){var b={id:a.id};h.getData(i.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(a){f.billDetails=angular.fromJson(a.data),d.go("managereceiptpayment",{type:"add",data:f.billDetails})},function(a){})},f.fillBilledParty=function(){"ORGANIZATION_LOCATION"!=f.filterCriteria.inFavorOf&&"INDIVIDUAL"!=f.filterCriteria.inFavorOf||(f.isMadeFromSSDisabled=!1)},f.viewBillPdf=function(a,c){var d={billId:a.id};n.showSpinner=!0,b.viewPdfBill(d,function(b){var d=b;c.preventDefault();var e=new Object;e.fileName=d.fileName,e.resourceId=d.id,e.recordId=a.id,e.docType=d.documentType.type,e.docSubType=d.documentType.subType,n.showSpinner=!1,/*fileObject.orgLocId = document.organizationLocationId;*/
f.fileResource=e,f.viewFileContent=!0,f.isHidingPrintButton=!1},function(a){n.showSpinner=!1})},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getPartyNameData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON_SMARTSEARCH"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.BILL_VIEW})},f.fillInFavorOf=function(){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf||"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.isMadeToSSDisabled=!1,f.isMadeToSSVisible=!0):f.isMadeToSSDisabled=!0},f.getOrgLocationList=function(){return h.getData(i.getUrl("GET_MY_OWNER_LOCATIONS"),null,function(a){f.billSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.BILL_VIEW})},f.billTypeSettings=function(a){"DEBIT"==a?(f.isMadeToSSVisible=!1,f.isMadeToDDVisible=!0,f.isMadeFromSSVisible=!0,f.isMadeFromDDVisible=!1,f.isInFavorOfTypeDisabled=!0,f.isPartyTypeDisabled=!1,f.isMadeToDDDisabled=!1,f.isMadeToSSDisabled=!0,f.isBillTypeDisabled=!1,f.filterCriteria.inFavorOf="ORGANIZATION_LOCATION",f.filterCriteria.raisedOn=null):(f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromSSVisible=!1,f.isMadeFromDDVisible=!0,f.isInFavorOfTypeDisabled=!1,f.isPartyTypeDisabled=!0,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!1,f.isMadeFromSSDisabled=!0,f.isBillTypeDisabled=!0,f.filterCriteria.raisedOn="ORGANIZATION_LOCATION",f.filterCriteria.inFavorOf=null),f.filterCriteria.inFavorOfLocationId=null,f.filterCriteria.inFavorOfUserId=null,f.filterCriteria.raisedOnLocationId=null,f.filterCriteria.raisedOnUserId=null},f.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf?f.filterCriteria.inFavorOfLocationId=a.id:f.filterCriteria.inFavorOfUserId=a.id},f.inFavorOfPersonSelected=function(a){f.filterCriteria.inFavorOfLocationId=a.id},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getinFavorOfNameData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.BILL_VIEW})},f.billTypeSelected=function(){f.billTypeSettings(f.filterCriteria.type)},f.pageChanged=function(){f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems),f.filterBills(f.isSearched)},f.setMaxRecords=function(a){f.currentPage=1,f.itemPerPage=a,f.filterBills(f.isSearched)};var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(x),f.dtColumnDefs=a.setColumnProperties({}),f.partyNameDDSelected=function(a){f.filterCriteria.raisedOnLocationId=a.id},f.getFilteredBills=function(a,d,g){var h={},i="";i="FIND_BILLS_FOR_CLIENT",1==f.isSearched?(e.isFieldEmpty(d)||(f.filterCriteria.dateFrom=p.convertToServerDate(d)),e.isFieldEmpty(g)||(f.filterCriteria.dateTill=p.convertToServerDate(g)),delete f.filterCriteria.inFavorOfId,delete f.filterCriteria.billedPartyId,h=f.filterCriteria):h.type="DEBIT",h.sorters=f.sortedObject.sorters,h.pageNumber=f.currentPage,h.recordsPerPage=f.itemPerPage;var j=angular.fromJson(localStorage.getItem("loggedInUser"));e.isFieldEmpty(j)||(h.clientId=j.id),b.filterBills(i,h,function(a){f.billObjectList=a,f.totalItems=a.totalRecords,f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems)},function(a){})},f.clear=function(){f.init()},f.getBillTypes=function(){f.getListOfBillTypes()},f.getListOfBillTypes=function(){return h.getData(i.getUrl("FIND_BILL_TYPE"),null,function(a){f.billSearchObject.billTypeList=angular.fromJson(a.data)},function(a){})},f.getBillStatuses=function(){f.getListOfBillStatus()},f.getListOfBillStatus=function(){return h.getData(i.getUrl("FIND_STATUS_LIST"),null,function(a){f.billSearchObject.billStatusList=angular.fromJson(a.data)},function(a){})},f.viewBill=function(a){var b={id:a.id};h.getData(i.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(b){d.go("managebill",{billId:a.id,type:"view",data:angular.fromJson(b.data)})},function(a){})},f.viewSettlementView=function(a){a&&d.go("billsettlementview",{type:null,billId:a.id,billTypeCode:a.typeCode})},f.getTransactionTypes=function(){t.getListOfTransactionTypes(function(a){f.billSearchObject.transactionTypeList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.organizationLocationSelected=function(a){f.isControlDisabled=!1,"professionalSearch"==f.searchType?f.getProfessionals(a):"clientSearch"==f.searchType?f.getClientType():f.disableControls=!1},f.clientNameSelected=function(a){f.filterCriteria.clientId=a.id},f.professionalSelected=function(){f.disableControls=!1},f.clientSelected=function(){f.disableControls=!1},f.getProfessionals=function(a){var b={locationId:a};t.getProfessionalsForBill(b,function(a){f.billSearchObject.professionalsList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.getClients=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.billSearchObject.clientType,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.requestData.orgLocationId=f.filterCriteria.locationId,f.userNameAutoCmpLoading=!0,h.postData(i.getUrl("FIND_CLIENTS_FOR_BILLS"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.getClientsForBills=function(a){var b={locationId:a};t.getClientsForBills(b,function(a){f.billSearchObject.clientList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.clientNameSelected=function(){f.disableControls=!1},f.professionalSelected=function(){f.disableControls=!1},f.getPartyTypes=function(){f.getListOfPartyTypes()},f.getListOfPartyTypes=function(){return h.getData(i.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){f.billSearchObject.billedPartyTypeList=angular.fromJson(a.data)},function(a){})},f.getClientType=function(){return h.getData(i.getUrl("FIND_PARTY_TYPE"),null,function(a){f.clientTypeList=angular.fromJson(a.data)},function(a){})},f.filterBills=function(a,b,c){1==a&&(f.isSearched=!0),f.getFilteredBills(a,b,c)},f.getCurrencys=function(){f.getCurrencyList()},f.getCurrencyList=function(){return h.getData(i.getUrl("GET_CURRENCYLIST_DATA"),null,function(a){f.billSearchObject.currencyTypeList=angular.fromJson(a.data)},function(a){})},f.getInFavorOfData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.onInFavorOfSelect=function(a){f.selectedInFavor=a,"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.filterCriteria.inFavorOfUserId=a.id,f.filterCriteria.inFavorOfLocationId=null):(f.filterCriteria.inFavorOfLocationId=a.id,f.filterCriteria.inFavorOfUserId=null)},f.getBilledPartyData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.getMadeToOrgList=function(){f.getListOfMadeToOrgs()},f.getMadeFromOrgList=function(){f.getListOfMadeFromOrgs()},f.getListOfMadeFromOrgs=function(){return h.getData(i.getUrl("FIND_BILL_MADE_BY_DROPDOWN"),null,function(a){f.billSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.BILL_VIEW})},f.onBilledPartySelect=function(a){f.selectedRaisedOn=a,"INDIVIDUAL"==f.filterCriteria.raisedOn?(f.filterCriteria.raisedOnUserId=a.id,f.filterCriteria.raisedOnLocationId=null):(f.filterCriteria.raisedOnLocationId=a.id,f.filterCriteria.raisedOnUserId=null)},f.setSearchSettings=function(){u.searchType?"searchClientBill"==u.searchType?f.searchType="clientSearch":"searchProfessionalBill"==u.searchType&&(f.searchType="professionalSearch"):f.searchType=""},f.init=function(){/*
                        $scope.dateFromString = null;
                        $scope.dateTillString = null;*/
n.$broadcast("clearValidFromValidTill"),f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromDDVisible=!1,f.isMadeFromSSVisible=!0,f.isControlDisabled=!0,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!0,f.isMadeFromSSDisabled=!0,"professionalSearch"==u.type||"clientSearch"==u.type?f.disableControls=!0:f.disableControls=!1,f.setSearchSettings(),f.selectedInFavor={},f.selectedRaisedOn={},f.billSearchObject={},f.billSearchObject.isTransactionTypeDisabled=!1,f.filterCriteria={},f.billSearchObject={},f.isInFavorOfDisabled=!0,f.isBilledPartyDisabled=!0,f.filterCriteria.type="DEBIT",f.isSearched=!1,f.getBillTypes(),f.getListOfBillStatus(),f.getPartyTypes(),f.getCurrencys(),f.getTransactionTypes(),f.billTypeSelected(),f.getMadeFromOrgList(),f.filterBills(!1),f.getClientType(),f.getOrgLocationList()},f.init()}]),angular.module("paripal.billingModule").controller("SearchMyReceiptCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","viewReceiptPaymentService","dateconvertor","commonBillingService","notify","$translate","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.partyNameId=null,e.commonConstants=n,e.inFavorOfSSId={},e.partyNameId={},e.userIdentifyDetail={},e.sortedObject={},e.viewReceiptPdf=function(a,b){var c={receiptId:a.id};m.showSpinner=!0,o.viewPdfReceipt(c,function(c){var d=c;b.preventDefault();var f=new Object;f.fileName=d.fileName,f.resourceId=d.id,f.recordId=a.id,f.docType=d.documentType.type,f.docSubType=d.documentType.subType,/*fileObject.orgLocId = document.organizationLocationId;*/
m.showSpinner=!1,e.fileResource=f,e.viewFileContent=!0,e.isHidingPrintButton=!1},function(a){m.showSpinner=!1})};var w=function(){u.isOrgUser()&&c.go("home.view")};w(),e.isConsolidatedChanged=function(){e.changeTransactionTypeAuthority(e.filterCriteria.whetherConsolidated)},e.changeTransactionTypeAuthority=function(a){e.filterCriteria.transactionTypeId=-1,e.receiptSearchObject.isTransactionTypeDisabled=a},e.addPaymentReceipt=function(){c.go("managereceiptpayment",{type:"",data:""})},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems),e.getFilteredReceiptPayment(e.isSearched)},e.setMaxRecords=function(a){e.currentPage=1,e.itemPerPage=a,e.getFilteredReceiptPayment(e.isSearched)};var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.getReceiptPaymentStatuses=function(){q.getListOfReceiptPaymentStatus(function(a){e.receiptSearchObject.receiptStatusList=a},function(a){r("error",s.instant("PROFESSIONAL_TYPE_FAITURE"))})},e.getReceiptPaymentTypes=function(){q.getListOfReceiptPaymentTypes(function(a){e.receiptSearchObject.receiptTypeList=a},function(a){})},e.getTransactionTypes=function(){q.getListOfTransactionTypes(function(a){e.receiptSearchObject.transactionTypeList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getMadeToOrgList=function(){q.getListOfMadeToOrgs(function(a){e.receiptSearchObject.inFavorOfOrgList=a},function(a){},v.RECEIPT_VIEW)},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){var a="FIND_MADE_BY_DROPDOWN";return"myReceipts"==t.searchType&&(a="GET_LOCATIONS_FOR_MY_BILLS"),g.getData(h.getUrl(a),null,function(a){e.receiptSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.RECEIPT_VIEW})},e.getUserNames=function(a){return e.userData={},e.userData.userName=a,e.userNameAutoCmpLoading=!0,g.getData(h.getParameterizedUrl("FIND_USER_NAME",e.userData),null,function(a){return e.userNameAutoCmpLoading=!1,e.userNames=angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getOrgLocationList=function(){return g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){e.receiptSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.RECEIPT_VIEW})},e.typeSelected=function(){},e.options=a.setOptionProperties(x),e.dtColumnDefs=a.setColumnProperties({}),e.getFilteredReceiptPayment=function(a,c,f){1==a&&(e.isSearched=!0);var g={},h="";0==a?h="FIND_RECEIPTS_FOR_CLIENT":(h="FIND_RECEIPTS_FOR_CLIENT",1==e.isSearched&&(d.isFieldEmpty(c)||(e.filterCriteria.dateFrom=p.convertToServerDate(c)),d.isFieldEmpty(f)||(e.filterCriteria.dateTill=p.convertToServerDate(f)),g=e.filterCriteria,g.transactionTypeId==-1&&(g.transactionTypeId=null))),""==g.madeBy&&(g.madeBy=null),""==g.madeTo&&(g.madeTo=null),"myReceipts"==e.searchType&&(g.madeTo=null),g.sorters=e.sortedObject.sorters,g.pageNumber=e.currentPage,g.recordsPerPage=e.itemPerPage;var i=angular.fromJson(localStorage.getItem("loggedInUser"));d.isFieldEmpty(i)||(g.clientId=i.id);var j=v.MY_PAYMENT_REFUND_VIEW;o.filterPaymentReceipt(h,g,function(a){e.receiptObjectList=a,e.totalItems=a.totalRecords,e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},function(a){},j)},e.viewSettlement=function(a){o.viewSettlement(a,function(b){e.settlementDetails=b,c.go("receiptsettlementview",{type:null,data:e.settlementDetails,receiptData:a,id:a.id,receiptType:a.typeCode})},function(a){r("error",s.instant("ERROR"))})},e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeTo?e.filterCriteria.madeToLocationId=a.id:e.filterCriteria.madeToUserId=a.id},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeBy?e.filterCriteria.madeByLocationId=a.id:e.filterCriteria.madeByUserId=a.id},e.organizationLocationSelected=function(a){e.isControlDisabled=!1,"professionalSearch"==e.searchType?e.getProfessionals(a):"clientSearch"==e.searchType?e.getClientType():e.disableControls=!1},e.professionalSelected=function(){e.disableControls=!1},e.clientSelected=function(){e.disableControls=!1},e.getProfessionals=function(a){var a={locationId:a};q.getProfessionalsForReceipt(a,function(a){e.receiptSearchObject.professionalsList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getClientsForReceipts=function(a){var a={locationId:a};q.getClientsForReceipts(a,function(a){e.receiptSearchObject.clientList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.manageReceipt=function(a,b){var d={id:a.id};o.getReceiptPaymentDetails(d,function(d){c.go("managereceiptpayment",{type:b,data:d.data,receiptId:a.id})},function(a){r("error",s.instant("ERROR"))})},e.clear=function(){e.init()},e.setSearchSettings=function(){t.searchType?"searchClientReceipt"==t.searchType?e.searchType="clientSearch":"searchProfessionalReceipt"==t.searchType?e.searchType="professionalSearch":"myReceipts"==t.searchType&&(e.searchType="myReceipts"):e.searchType=""},e.addMonths=function(a,b){return a.setMonth(a.getMonth()+b),a},e.init=function(){e.minDate=e.addMonths(new Date,-6),m.$broadcast("clearValidFromValidTill"),e.isPartyChanged=!1,e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isControlDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.clientType={},"professionalSearch"==t.type||"clientSearch"==t.type?e.disableControls=!0:e.disableControls=!1,e.isSearched=!1,e.partyId=0,e.filterCriteria={},e.receiptSearchObject={},e.filterCriteria.whetherConsolidated=!1,e.filterCriteria.typeCode="RECEIPT",e.setSearchSettings(),e.getReceiptPaymentStatuses(),e.getReceiptPaymentTypes(),e.getTransactionTypes(),e.getMadeToOrgList(),e.getMadeFromOrgList(),e.getFilteredReceiptPayment(!1)},e.init()}]),angular.module("paripal.billingModule").controller("SearchProfessionalBillCtrl",["datatableconfig","viewBillsService","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","dateconvertor","manageBillService","$translate","notify","commonBillingService","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.billObjectList=[{}],f.sortedObject={},f.isConsolidatedChanged=function(){f.changeTransactionTypeAuthority(f.filterCriteria.whetherConsolidated)},f.changeTransactionTypeAuthority=function(a){f.filterCriteria.transactionTypeId=-1,f.billSearchObject.isTransactionTypeDisabled=a},f.billedPartyTypeSelected=function(){f.partyNameId={},f.fillBilledParty()},f.inFavorOfTypeSelected=function(){f.inFavorOfSSId={},f.fillInFavorOf()},f.createReceipt=function(a){var b={id:a.id};h.getData(i.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(a){f.billDetails=angular.fromJson(a.data),d.go("managereceiptpayment",{type:"add",data:f.billDetails})},function(a){})},f.fillBilledParty=function(){"ORGANIZATION_LOCATION"!=f.filterCriteria.inFavorOf&&"INDIVIDUAL"!=f.filterCriteria.inFavorOf||(f.isMadeFromSSDisabled=!1)},f.viewBillPdf=function(a,c){var d={billId:a.id};n.showSpinner=!0,b.viewPdfBill(d,function(b){var d=b;c.preventDefault();var e=new Object;e.fileName=d.fileName,e.resourceId=d.id,e.recordId=a.id,e.docType=d.documentType.type,e.docSubType=d.documentType.subType,n.showSpinner=!1,/*fileObject.orgLocId = document.organizationLocationId;*/
f.fileResource=e,f.viewFileContent=!0,f.isHidingPrintButton=!1},function(a){n.showSpinner=!1})},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getPartyNameData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON_SMARTSEARCH"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.PROF_BILL_VIEW})},f.fillInFavorOf=function(){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf||"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.isMadeToSSDisabled=!1,f.isMadeToSSVisible=!0):f.isMadeToSSDisabled=!0},f.getOrgLocationList=function(){return h.getData(i.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){f.billSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.PROF_BILL_VIEW})},f.billTypeSettings=function(a){"DEBIT"==a?(f.showPartyType=!0,f.showInFavorOf=!1,f.isMadeToSSVisible=!1,f.isMadeToDDVisible=!0,f.isMadeFromSSVisible=!0,f.isMadeFromDDVisible=!1,f.isInFavorOfTypeDisabled=!0,f.isPartyTypeDisabled=!1,f.isMadeToDDDisabled=!1,f.isMadeToSSDisabled=!0,f.isBillTypeDisabled=!1,f.filterCriteria.inFavorOf="ORGANIZATION_LOCATION",f.filterCriteria.raisedOn=null):(f.showPartyType=!1,f.showInFavorOf=!0,f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromSSVisible=!1,f.isMadeFromDDVisible=!0,f.isInFavorOfTypeDisabled=!1,f.isPartyTypeDisabled=!0,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!1,f.isMadeFromSSDisabled=!0,f.isBillTypeDisabled=!0,f.filterCriteria.raisedOn="ORGANIZATION_LOCATION",f.filterCriteria.inFavorOf=null),f.filterCriteria.inFavorOfLocationId=null,f.filterCriteria.inFavorOfUserId=null,f.filterCriteria.raisedOnLocationId=null,f.filterCriteria.raisedOnUserId=null},f.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.inFavorOf?f.filterCriteria.inFavorOfLocationId=a.id:f.filterCriteria.inFavorOfUserId=a.id},f.inFavorOfPersonSelected=function(a){f.filterCriteria.inFavorOfLocationId=a.id},f.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==f.filterCriteria.raisedOn?f.filterCriteria.raisedOnLocationId=a.id:f.filterCriteria.raisedOnUserId=a.id},f.getinFavorOfNameData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1},{orgLocPermission:w.PROF_BILL_VIEW})},f.billTypeSelected=function(){f.billTypeSettings(f.filterCriteria.type)},f.pageChanged=function(){f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems),f.filterBills(f.isSearched)},f.setMaxRecords=function(a){f.currentPage=1,f.itemPerPage=a,f.filterBills(f.isSearched)};var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(x),f.dtColumnDefs=a.setColumnProperties({}),f.partyNameDDSelected=function(a){f.filterCriteria.raisedOnLocationId=a.id},f.getFilteredBills=function(a,d,g){var h={},i="";if(0==a)if("clientSearch"==f.searchType){if(i="FIND_BILLS_FOR_CLIENT",null!==localStorage.getItem("loggedInUser")){angular.fromJson(localStorage.getItem("loggedInUser")).id;h={}}}else"professionalSearch"==f.searchType?(i="FIND_BILLS_FOR_PROFESSIONALS",h.type="DEBIT"):i="FILTER_BILLS";else i="clientSearch"==f.searchType?"FIND_BILLS_FOR_CLIENT":"professionalSearch"==f.searchType?"FIND_BILLS_FOR_PROFESSIONALS":"FILTER_BILLS",1==f.isSearched&&(e.isFieldEmpty(d)||(f.filterCriteria.dateFrom=p.convertToServerDate(d)),e.isFieldEmpty(g)||(f.filterCriteria.dateTill=p.convertToServerDate(g)),delete f.filterCriteria.inFavorOfId,delete f.filterCriteria.billedPartyId,h=angular.copy(f.filterCriteria),"DEBIT"==h.type?h.inFavorOfLocationId=h.billingLocationId:h.raisedOnLocationId=h.billingLocationId,delete h.billingLocationId,h.transactionTypeId==-1&&(h.transactionTypeId=null),h.whetherConsolidated||(h.whetherConsolidated=!1));h.sorters=f.sortedObject.sorters,h.pageNumber=f.currentPage,h.recordsPerPage=f.itemPerPage,b.filterBills(i,h,function(a){f.billObjectList=a,f.totalItems=a.totalRecords,f.pagingInfo=c(f.currentPage,f.itemPerPage,f.totalItems)},function(a){})},f.clear=function(){f.init(),f.partyNameId={}},f.getBillTypes=function(){f.getListOfBillTypes()},f.getListOfBillTypes=function(){return h.getData(i.getUrl("FIND_BILL_TYPE"),null,function(a){f.billSearchObject.billTypeList=angular.fromJson(a.data)},function(a){})},f.getBillStatuses=function(){f.getListOfBillStatus()},f.getListOfBillStatus=function(){return h.getData(i.getUrl("FIND_STATUS_LIST"),null,function(a){f.billSearchObject.billStatusList=angular.fromJson(a.data)},function(a){})},f.viewBill=function(a){var b={id:a.id};h.getData(i.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(b){d.go("managebill",{billId:a.id,type:"view",data:angular.fromJson(b.data)})},function(a){})},f.viewSettlementView=function(a){a&&d.go("billsettlementview",{type:null,billId:a.id,billTypeCode:a.typeCode})},f.getTransactionTypes=function(){t.getListOfTransactionTypes(function(a){f.billSearchObject.transactionTypeList=a},function(a){s("error",r.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},f.organizationLocationSelected=function(a){f.getBillingLocations(a),f.getProfessionals(a)},f.clientNameSelected=function(a){f.filterCriteria.clientId=a.id},f.professionalSelected=function(){f.disableControls=!1,f.isControlDisabled=!1,f.isProfessionalSelected=!0},f.clientSelected=function(){f.disableControls=!1},f.getBillingLocations=function(a){null==a&&(a="");var b={locationId:a};t.getBillingLocations(b,function(a){f.billSearchObject.billingLocationList=a},function(a){s("error",r.instant("PFROFESSIONAL_FETCH_ERROR"))},w.PROF_BILL_VIEW)},f.getProfessionals=function(a){null==a&&(a="");var b={locationId:a};t.getProfessionalsForBill(b,function(a){f.billSearchObject.professionalsList=a},function(a){s("error",r.instant("PFROFESSIONAL_FETCH_ERROR"))},w.PROF_BILL_VIEW)},f.getPartyTypes=function(){f.getListOfPartyTypes()},f.getListOfPartyTypes=function(){return h.getData(i.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){f.billSearchObject.billedPartyTypeList=angular.fromJson(a.data)},function(a){})},f.getClientType=function(){return h.getData(i.getUrl("FIND_PARTY_TYPE"),null,function(a){f.clientTypeList=angular.fromJson(a.data)},function(a){})},f.filterBills=function(a,b,c){1==a&&(f.isSearched=!0),f.getFilteredBills(a,b,c)},f.getCurrencys=function(){f.getCurrencyList()},f.getCurrencyList=function(){return h.getData(i.getUrl("GET_CURRENCYLIST_DATA"),null,function(a){f.billSearchObject.currencyTypeList=angular.fromJson(a.data)},function(a){})},f.getInFavorOfData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.inFavorOf,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_IN_FAVOR_OF"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.onInFavorOfSelect=function(a){f.selectedInFavor=a,"INDIVIDUAL"==f.filterCriteria.inFavorOf?(f.filterCriteria.inFavorOfUserId=a.id,f.filterCriteria.inFavorOfLocationId=null):(f.filterCriteria.inFavorOfLocationId=a.id,f.filterCriteria.inFavorOfUserId=null)},f.getBilledPartyData=function(a){return f.requestData={},f.requestData.searchKeyword=a,f.requestData.type=f.filterCriteria.type,f.requestData.billPartyType=f.filterCriteria.raisedOn,f.requestData.noOfSuggestions=o.smartSearchRecordLimit,f.userNameAutoCmpLoading=!0,h.postData(i.getParameterizedUrl("FIND_RAISED_ON"),f.requestData,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.getMadeToOrgList=function(){f.getListOfMadeToOrgs()},f.getListOfMadeToOrgs=function(){return h.getData(i.getUrl("FIND_BILL_MADE_TO_DROPDOWN"),null,function(a){f.billSearchObject.inFavorOfOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.PROF_BILL_VIEW})},f.getMadeFromOrgList=function(){f.getListOfMadeFromOrgs()},f.getListOfMadeFromOrgs=function(){return h.getData(i.getUrl("FIND_BILL_MADE_BY_DROPDOWN"),null,function(a){f.billSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:w.PROF_BILL_VIEW})},f.onBilledPartySelect=function(a){f.selectedRaisedOn=a,"INDIVIDUAL"==f.filterCriteria.raisedOn?(f.filterCriteria.raisedOnUserId=a.id,f.filterCriteria.raisedOnLocationId=null):(f.filterCriteria.raisedOnLocationId=a.id,f.filterCriteria.raisedOnUserId=null)},f.setSearchSettings=function(){u.searchType?"searchClientBill"==u.searchType?f.searchType="clientSearch":"searchProfessionalBill"==u.searchType&&(f.searchType="professionalSearch"):f.searchType=""},f.init=function(){n.$broadcast("clearValidFromValidTill"),f.dateTillString=null,f.dateFromString=null,f.dateFromString=null,f.dateTillString=null,f.isMadeToSSVisible=!0,f.isMadeToDDVisible=!1,f.isMadeFromDDVisible=!1,f.isMadeFromSSVisible=!0,f.isControlDisabled=!0,f.isMadeToSSDisabled=!0,f.isMadeToDDDisabled=!0,f.isMadeFromDDDisabled=!0,f.isMadeFromSSDisabled=!0,f.isProfessionalSelected=!1,"professionalSearch"==u.type||"clientSearch"==u.type?f.disableControls=!1:f.disableControls=!1,f.setSearchSettings(),f.selectedInFavor={},f.selectedRaisedOn={},f.billSearchObject={},f.billSearchObject.isTransactionTypeDisabled=!1,f.filterCriteria={},f.billSearchObject={},f.isInFavorOfDisabled=!0,f.isBilledPartyDisabled=!0,f.filterCriteria.type="DEBIT",f.isSearched=!1,f.getBillTypes(),f.getListOfBillStatus(),f.getPartyTypes(),f.getCurrencys(),f.getTransactionTypes(),f.billTypeSelected(),f.getMadeToOrgList(),f.getMadeFromOrgList(),f.filterBills(!1),f.getClientType(),f.getProfessionals(null),f.getBillingLocations(null)},f.init()}]),angular.module("paripal.billingModule").controller("SearchProfessionalReceiptCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","viewReceiptPaymentService","dateconvertor","commonBillingService","notify","$translate","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.partyNameId=null,e.commonConstants=n,e.inFavorOfSSId={},e.partyNameId={},e.userIdentifyDetail={},e.sortedObject={},e.isConsolidatedChanged=function(){e.changeTransactionTypeAuthority(e.filterCriteria.whetherConsolidated)},e.changeTransactionTypeAuthority=function(a){e.filterCriteria.transactionTypeId=-1,e.receiptSearchObject.isTransactionTypeDisabled=a},e.viewReceiptPdf=function(a,b){var c={receiptId:a.id};m.showSpinner=!0,o.viewPdfReceipt(c,function(c){var d=c;b.preventDefault();var f=new Object;f.fileName=d.fileName,f.resourceId=d.id,f.recordId=a.id,f.docType=d.documentType.type,f.docSubType=d.documentType.subType,/*fileObject.orgLocId = document.organizationLocationId;*/
m.showSpinner=!1,e.fileResource=f,e.viewFileContent=!0,e.isHidingPrintButton=!1},function(a){m.showSpinner=!1})},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems),e.getFilteredReceiptPayment(e.isSearched)},e.setMaxRecords=function(a){e.currentPage=1,e.itemPerPage=a,e.getFilteredReceiptPayment(e.isSearched)};var w={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.getReceiptPaymentStatuses=function(){q.getListOfReceiptPaymentStatus(function(a){e.receiptSearchObject.receiptStatusList=a},function(a){r("error",s.instant("PROFESSIONAL_TYPE_FAITURE"))})},e.getReceiptPaymentTypes=function(){q.getListOfReceiptPaymentTypes(function(a){e.receiptSearchObject.receiptTypeList=a},function(a){})},e.getTransactionTypes=function(){q.getListOfTransactionTypes(function(a){e.receiptSearchObject.transactionTypeList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getPartyTypes=function(a){q.getListOfPartyTypes(function(a){e.receiptSearchObject.inFavorOfTypeList=a,e.receiptSearchObject.partyTypeList=a},function(a){r("error",s.instant("PARTY_TYPE_LIST_FAILURE"))},a)},e.getMadeToOrgList=function(){q.getListOfMadeToOrgs(function(a){e.receiptSearchObject.inFavorOfOrgList=a},function(a){},v.RECEIPT_VIEW)},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){var a="";return a="myReceipts"==t.searchType?"GET_LOCATIONS_FOR_MY_BILLS":"FIND_MADE_BY_DROPDOWN",g.getData(h.getUrl(a),null,function(a){e.receiptSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.RECEIPT_VIEW})},e.getUserNames=function(a){return e.userData={},e.userData.userName=a,e.userNameAutoCmpLoading=!0,g.getData(h.getParameterizedUrl("FIND_USER_NAME",e.userData),null,function(a){return e.userNameAutoCmpLoading=!1,e.userNames=angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getinFavorOfNameData=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.filterCriteria.madeTo,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,g.postData(h.getParameterizedUrl("FIND_MADE_TO_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:v.RECEIPT_VIEW})},e.getClientType=function(){return g.getData(h.getUrl("FIND_PARTY_TYPE"),null,function(a){e.clientTypeList=angular.fromJson(a.data)},function(a){})},e.getPartyNameData=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.filterCriteria.madeBy,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,g.postData(h.getParameterizedUrl("FIND_MADE_BY_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:v.RECEIPT_VIEW})},e.clientNameSelected=function(a){e.filterCriteria.clientId=a.id},e.getClients=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.receiptSearchObject.clientType,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.requestData.orgLocationId=e.filterCriteria.locationId,e.userNameAutoCmpLoading=!0,g.postData(h.getUrl("FIND_CLIENTS_FOR_RECEIPTS"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getOrgLocationList=function(){return g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){e.receiptSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.RECEIPT_VIEW})},e.typeSelected=function(){"RECEIPT"==e.filterCriteria.typeCode?e.getPartyTypes("receipt"):e.getPartyTypes("payment"),e.changePartyStyle()},e.changePartyStyle=function(){"PAYMENT"==e.filterCriteria.typeCode?(e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isInFavorOfTypeDisabled=!1,e.isPartyTypeDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0,e.filterCriteria.madeBy="ORGANIZATION_LOCATION",e.filterCriteria.madeTo="",e.showMadeTo=!0,e.showMadeBy=!1):(e.isMadeToSSVisible=!1,e.isMadeToDDVisible=!0,e.isMadeFromSSVisible=!0,e.isMadeFromDDVisible=!1,e.isInFavorOfTypeDisabled=!0,e.isPartyTypeDisabled=!1,e.isMadeToDDDisabled=!1,e.isMadeToSSDisabled=!0,e.filterCriteria.madeBy="",e.filterCriteria.madeTo="ORGANIZATION_LOCATION",e.showMadeTo=!1,e.showMadeBy=!0),e.filterCriteria.madeByLocationId=null,e.filterCriteria.madeByUserId=null,e.filterCriteria.madeToLocationId=null,e.filterCriteria.madeToUserId=null},e.inFavorOfSelected=function(){e.inFavorOfSSId={},"ORGANIZATION_LOCATION"==e.filterCriteria.madeTo||"INDIVIDUAL"==e.filterCriteria.madeTo?(e.isMadeToSSDisabled=!1,e.isMadeToSSVisible=!0):e.isMadeToSSDisabled=!0},e.partyTypeSelected=function(){e.partyNameId={},"ORGANIZATION_LOCATION"==e.filterCriteria.madeBy||"INDIVIDUAL"==e.filterCriteria.madeBy?(e.isMadeFromSSDisabled=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isThirdPartyDisabled=!0):(e.isThirdPartyVisible=!0,e.isThirdPartyDisabled=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!1)},e.options=a.setOptionProperties(w),e.dtColumnDefs=a.setColumnProperties({}),e.inFavorOfPersonSelected=function(a){e.filterCriteria.madeToLocationId=a},e.partyNameDDSelected=function(a){e.filterCriteria.madeByLocationId=a},e.getFilteredReceiptPayment=function(a,c,f){1==a&&(e.isSearched=!0);var g={},h="";if(0==a)if("clientSearch"==e.searchType||"myReceipts"==e.searchType){if(h="FIND_RECEIPTS_FOR_CLIENT",null!==localStorage.getItem("loggedInUser")){angular.fromJson(localStorage.getItem("loggedInUser")).id;g={}}}else h="professionalSearch"==e.searchType?"FIND_RECEIPT_FOR_PROFESSIONALS":"FILTER_RECEIPT_PAYMENT";else h="clientSearch"==e.searchType?"FIND_RECEIPTS_FOR_CLIENT":"professionalSearch"==e.searchType?"FIND_RECEIPT_FOR_PROFESSIONALS":"FILTER_RECEIPT_PAYMENT",1==e.isSearched&&(d.isFieldEmpty(c)||(e.filterCriteria.dateFrom=p.convertToServerDate(c)),d.isFieldEmpty(f)||(e.filterCriteria.dateTill=p.convertToServerDate(f)),g=angular.copy(e.filterCriteria),"RECEIPT"==g.type?g.madeToLocationId=g.billingLocationId:g.madeByLocationId=g.billingLocationId,delete g.billingLocationId,g.transactionTypeId==-1&&(g.transactionTypeId=null));""==g.madeBy&&(g.madeBy=null),""==g.madeTo&&(g.madeTo=null),"myReceipts"==e.searchType&&(g.madeTo=null),g.sorters=e.sortedObject.sorters,g.pageNumber=e.currentPage,g.recordsPerPage=e.itemPerPage;var i=v.PROF_RP_VIEW;o.filterPaymentReceipt(h,g,function(a){e.receiptObjectList=a,e.totalItems=a.totalRecords,e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems)},function(a){},i)},e.viewSettlement=function(a){o.viewSettlement(a,function(b){e.settlementDetails=b,c.go("receiptsettlementview",{type:null,data:e.settlementDetails,receiptData:a,id:a.id,receiptType:a.typeCode})},function(a){r("error",s.instant("ERROR"))})},e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeTo?e.filterCriteria.madeToLocationId=a.id:e.filterCriteria.madeToUserId=a.id},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeBy?e.filterCriteria.madeByLocationId=a.id:e.filterCriteria.madeByUserId=a.id},e.organizationLocationSelected=function(a){e.isControlDisabled=!1,"professionalSearch"==e.searchType?e.getProfessionals(a):"clientSearch"==e.searchType?e.getClientType():e.disableControls=!1},e.professionalSelected=function(){e.disableControls=!1,e.isProfessionalSelected=!0},e.clientSelected=function(){e.disableControls=!1},e.getProfessionals=function(a){var a={locationId:a};q.getProfessionalsForReceipt(a,function(a){e.receiptSearchObject.professionalsList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getClientsForReceipts=function(a){var a={locationId:a};q.getClientsForReceipts(a,function(a){e.receiptSearchObject.clientList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.manageReceipt=function(a,b){var d={id:a.id};o.getReceiptPaymentDetails(d,function(d){c.go("managereceiptpayment",{type:b,data:d.data,receiptId:a.id})},function(a){r("error",s.instant("ERROR"))})},e.clear=function(){e.init()},e.setSearchSettings=function(){t.searchType?"searchClientReceipt"==t.searchType?e.searchType="clientSearch":"searchProfessionalReceipt"==t.searchType?e.searchType="professionalSearch":"myReceipts"==t.searchType&&(e.searchType="myReceipts"):e.searchType=""},e.addMonths=function(a,b){return a.setMonth(a.getMonth()+b),a},e.init=function(){e.minDate=e.addMonths(new Date,-6),m.$broadcast("clearValidFromValidTill"),e.isPartyChanged=!1,e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isControlDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.isProfessionalSelected=!1,e.clientType={},e.disableControls=!1,e.isSearched=!1,e.partyId=0,e.filterCriteria={},e.receiptSearchObject={},e.filterCriteria.whetherConsolidated=!1,e.filterCriteria.typeCode="RECEIPT",e.setSearchSettings(),e.changePartyStyle(),e.getReceiptPaymentStatuses(),e.getReceiptPaymentTypes(),e.getTransactionTypes(),e.getPartyTypes("receipt"),e.getMadeToOrgList(),e.getMadeFromOrgList(),e.getClientType(),e.getFilteredReceiptPayment(!1)},e.init()}]),angular.module("paripal.billingModule").controller("SearchReceiptCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","viewReceiptPaymentService","dateconvertor","commonBillingService","notify","$translate","$stateParams","userStatusService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";e.currentPage=1,e.itemPerPage=10,e.startRecord=(e.currentPage-1)*e.itemPerPage+1,e.endRecord=e.itemPerPage,e.pagingInfo={},e.partyNameId={},e.commonConstants=n,e.inFavorOfSSId={},e.userIdentifyDetail={},e.sortedObject={},e.isConsolidatedChanged=function(){e.changeTransactionTypeAuthority(e.filterCriteria.whetherConsolidated)},e.changeTransactionTypeAuthority=function(a){e.filterCriteria.transactionTypeId=-1,e.receiptSearchObject.isTransactionTypeDisabled=a},e.addPaymentReceipt=function(){c.go("managereceiptpayment",{type:"",data:""})},e.viewReceiptPdf=function(a,b){var c={receiptId:a.id};m.showSpinner=!0,o.viewPdfReceipt(c,function(c){var d=c;b.preventDefault();var f=new Object;f.fileName=d.fileName,f.resourceId=d.id,f.recordId=a.id,f.docType=d.documentType.type,f.docSubType=d.documentType.subType,/*fileObject.orgLocId = document.organizationLocationId;*/
m.showSpinner=!1,e.fileResource=f,e.viewFileContent=!0,e.isHidingPrintButton=!1},function(a){m.showSpinner=!1})},e.pageChanged=function(){e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems),e.getFilteredReceiptPayment(e.isSearched)},e.setMaxRecords=function(a){e.currentPage=1,e.itemPerPage=a,e.getFilteredReceiptPayment(e.isSearched)};var w={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};e.getReceiptPaymentStatuses=function(){q.getListOfReceiptPaymentStatus(function(a){e.receiptSearchObject.receiptStatusList=a},function(a){r("error",s.instant("PROFESSIONAL_TYPE_FAITURE"))})},e.getReceiptPaymentTypes=function(){q.getListOfReceiptPaymentTypes(function(a){e.receiptSearchObject.receiptTypeList=a},function(a){})},e.getTransactionTypes=function(){q.getListOfTransactionTypes(function(a){e.receiptSearchObject.transactionTypeList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getPartyTypes=function(a){q.getListOfPartyTypes(function(a){e.receiptSearchObject.inFavorOfTypeList=a,e.receiptSearchObject.partyTypeList=a},function(a){r("error",s.instant("PARTY_TYPE_LIST_FAILURE"))},a)},e.getMadeToOrgList=function(){q.getListOfMadeToOrgs(function(a){e.receiptSearchObject.inFavorOfOrgList=a},function(a){},v.RECEIPT_VIEW)},e.getMadeFromOrgList=function(){e.getListOfMadeFromOrgs()},e.getListOfMadeFromOrgs=function(){var a="";return a="myReceipts"==t.searchType?"GET_LOCATIONS_FOR_MY_BILLS":"FIND_MADE_BY_DROPDOWN",g.getData(h.getUrl(a),null,function(a){e.receiptSearchObject.partyOrgList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.RECEIPT_VIEW})},e.getUserNames=function(a){return e.userData={},e.userData.userName=a,e.userNameAutoCmpLoading=!0,g.getData(h.getParameterizedUrl("FIND_USER_NAME",e.userData),null,function(a){return e.userNameAutoCmpLoading=!1,e.userNames=angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getinFavorOfNameData=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.filterCriteria.madeTo,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,g.postData(h.getParameterizedUrl("FIND_MADE_TO_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:v.RECEIPT_VIEW})},e.getClientType=function(){return g.getData(h.getUrl("FIND_PARTY_TYPE"),null,function(a){e.clientTypeList=angular.fromJson(a.data)},function(a){})},e.getPartyNameData=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.filterCriteria.madeBy,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.userNameAutoCmpLoading=!0,g.postData(h.getParameterizedUrl("FIND_MADE_BY_SMARTSEARCH"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1},{orgLocPermission:v.RECEIPT_VIEW})},e.clientNameSelected=function(a){e.filterCriteria.clientId=a.id},e.getClients=function(a){return e.requestData={},e.requestData.searchKeyword=a,e.requestData.receiptPartyType=e.receiptSearchObject.clientType,e.requestData.noOfSuggestions=n.smartSearchRecordLimit,e.requestData.orgLocationId=e.filterCriteria.locationId,e.userNameAutoCmpLoading=!0,g.postData(h.getUrl("FIND_CLIENTS_FOR_RECEIPTS"),e.requestData,function(a){return e.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){e.userNameAutoCmpLoading=!1})},e.getOrgLocationList=function(){return g.getData(h.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(a){e.receiptSearchObject.organizationLocationList=angular.fromJson(a.data)},function(a){},{orgLocPermission:v.RECEIPT_VIEW})},e.typeSelected=function(){"RECEIPT"==e.filterCriteria.typeCode?e.getPartyTypes("receipt"):e.getPartyTypes("payment"),e.changePartyStyle()},e.changePartyStyle=function(){"PAYMENT"==e.filterCriteria.typeCode?(e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!0,e.isInFavorOfTypeDisabled=!1,e.isPartyTypeDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!1,e.isMadeFromSSDisabled=!0,e.filterCriteria.madeBy="ORGANIZATION_LOCATION",e.filterCriteria.madeTo=""):(e.isMadeToSSVisible=!1,e.isMadeToDDVisible=!0,e.isMadeFromSSVisible=!0,e.isMadeFromDDVisible=!1,e.isInFavorOfTypeDisabled=!0,e.isPartyTypeDisabled=!1,e.isMadeToDDDisabled=!1,e.isMadeToSSDisabled=!0,e.filterCriteria.madeBy="",e.filterCriteria.madeTo="ORGANIZATION_LOCATION"),e.filterCriteria.madeByLocationId=null,e.filterCriteria.madeByUserId=null,e.filterCriteria.madeToLocationId=null,e.filterCriteria.madeToUserId=null},e.inFavorOfSelected=function(){e.inFavorOfSSId=null,"ORGANIZATION_LOCATION"==e.filterCriteria.madeTo||"INDIVIDUAL"==e.filterCriteria.madeTo?(e.isMadeToSSDisabled=!1,e.isMadeToSSVisible=!0):e.isMadeToSSDisabled=!0},e.partyTypeSelected=function(){e.partyNameId={},"ORGANIZATION_LOCATION"==e.filterCriteria.madeBy||"INDIVIDUAL"==e.filterCriteria.madeBy?(e.isMadeFromSSDisabled=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isThirdPartyDisabled=!0):(e.isThirdPartyVisible=!0,e.isThirdPartyDisabled=!1,e.isMadeFromSSVisible=!1,e.isMadeFromDDVisible=!1)},e.options=a.setOptionProperties(w),e.dtColumnDefs=a.setColumnProperties({}),e.inFavorOfPersonSelected=function(a){e.filterCriteria.madeToLocationId=a},e.partyNameDDSelected=function(a){e.filterCriteria.madeByLocationId=a},e.getFilteredReceiptPayment=function(a,c,f){m.showSpinner=!0,1==a&&(e.isSearched=!0);var g={},h="";if(0==a)if("clientSearch"==e.searchType||"myReceipts"==e.searchType){if(h="FIND_RECEIPTS_FOR_CLIENT",null!==localStorage.getItem("loggedInUser")){angular.fromJson(localStorage.getItem("loggedInUser")).id;g={}}}else"professionalSearch"==e.searchType?h="FIND_RECEIPT_FOR_PROFESSIONALS":(h="FILTER_RECEIPT_PAYMENT",g.typeCode="RECEIPT");else h="clientSearch"==e.searchType?"FIND_RECEIPTS_FOR_CLIENT":"professionalSearch"==e.searchType?"FIND_RECEIPT_FOR_PROFESSIONALS":"FILTER_RECEIPT_PAYMENT",1==e.isSearched&&(d.isFieldEmpty(c)||(e.filterCriteria.dateFrom=p.convertToServerDate(c)),d.isFieldEmpty(f)||(e.filterCriteria.dateTill=p.convertToServerDate(f)),g=e.filterCriteria);""==g.madeBy&&(g.madeBy=null),""==g.madeTo&&(g.madeTo=null),"myReceipts"==e.searchType&&(g.madeTo=null),d.isNullOrEmpty(t.data)||d.isNullOrEmpty(t.data.location)||(g.locationId=t.data.location.id),g.sorters=e.sortedObject.sorters,g.pageNumber=e.currentPage,g.recordsPerPage=e.itemPerPage;var i=v.RECEIPT_VIEW;o.filterPaymentReceipt(h,g,function(a){e.receiptObjectList=a,e.totalItems=a.totalRecords,e.pagingInfo=b(e.currentPage,e.itemPerPage,e.totalItems),m.showSpinner=!1},function(a){},i)},e.viewSettlement=function(a){o.viewSettlement(a,function(b){e.settlementDetails=b,c.go("receiptsettlementview",{type:null,data:e.settlementDetails,receiptData:a,id:a.id,receiptType:a.typeCode})},function(a){r("error",s.instant("ERROR"))})},e.inFavorOfNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeTo?e.filterCriteria.madeToLocationId=a.id:e.filterCriteria.madeToUserId=a.id},e.partyNameSelected=function(a){"ORGANIZATION_LOCATION"==e.filterCriteria.madeBy?e.filterCriteria.madeByLocationId=a.id:e.filterCriteria.madeByUserId=a.id},e.organizationLocationSelected=function(a){e.isControlDisabled=!1,"professionalSearch"==e.searchType?e.getProfessionals(a):"clientSearch"==e.searchType?e.getClientType():e.disableControls=!1},e.professionalSelected=function(){e.disableControls=!1},e.clientSelected=function(){e.disableControls=!1},e.getProfessionals=function(a){var a={locationId:a};q.getProfessionalsForReceipt(a,function(a){e.receiptSearchObject.professionalsList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.getClientsForReceipts=function(a){var a={locationId:a};q.getClientsForReceipts(a,function(a){e.receiptSearchObject.clientList=a},function(a){r("error",s.instant("TRANSACTION_TYPE_LIST_FAILURE"))})},e.manageReceipt=function(a,b){var d={id:a.id};o.getReceiptPaymentDetails(d,function(d){c.go("managereceiptpayment",{type:b,data:d.data,receiptId:a.id})},function(a){r("error",s.instant("ERROR"))})},e.inactivateReceipt=function(a){var b={id:a.id};o.getReceiptPaymentDetails(b,function(a){g.putData(h.getUrl("INACTIVATE_RECEIPT_PAYMENT",null),a,function(a){r("success",a.data.successMessage),c.reload()},function(a){})},function(a){r("error",s.instant("ERROR"))})},e.clear=function(){e.init(),/*$scope.inFavorOfSSId = {};
            $scope.filterCriteria = {};
            $scope.partyNameId = {};
            $scope.inFavorOfDDId = null;*/
/*$scope.partyId = {};*/
e.filterCriteria.madeToLocationId=null,e.dateFromString=null,e.dateTillString=null,m.$broadcast("clearValidFromValidTill")},e.setSearchSettings=function(){t.searchType?"searchClientReceipt"==t.searchType?e.searchType="clientSearch":"searchProfessionalReceipt"==t.searchType?e.searchType="professionalSearch":"myReceipts"==t.searchType&&(e.searchType="myReceipts"):e.searchType=""},e.addMonths=function(a,b){return a.setMonth(a.getMonth()+b),a},e.init=function(){e.maxDate=new Date,e.minDate=e.addMonths(new Date,-6),e.isPartyChanged=!1,e.isMadeToSSVisible=!0,e.isMadeToDDVisible=!1,e.isMadeFromDDVisible=!1,e.isMadeFromSSVisible=!0,e.isThirdPartyVisible=!1,e.isControlDisabled=!0,e.isMadeToSSDisabled=!0,e.isMadeToDDDisabled=!0,e.isMadeFromDDDisabled=!0,e.isMadeFromSSDisabled=!0,e.isThirdPartyDisabled=!0,e.filter={},e.filter.inFavorOfDDId=null,e.clientType={},"professionalSearch"==t.type||"clientSearch"==t.type?e.disableControls=!0:e.disableControls=!1,e.isSearched=!1,e.partyId=0,e.filterCriteria={},e.partyNameId={},e.filterCriteria.madeByName=null,e.receiptSearchObject={},e.filterCriteria.whetherConsolidated=!1,e.filterCriteria.typeCode="RECEIPT",e.setSearchSettings(),e.changePartyStyle(),e.getReceiptPaymentStatuses(),e.getReceiptPaymentTypes(),e.getTransactionTypes(),e.getPartyTypes("receipt"),e.getMadeToOrgList(),e.getMadeFromOrgList(),e.getClientType(),
// $scope.inFavorOfDDId = {};
d.isNullOrEmpty(t.data)?e.getFilteredReceiptPayment(!1):(d.isNullOrEmpty(t.data.onBehalfOfUser)?(/*$scope.filterCriteria.madeByName = $stateParams.data.madeFrom.value;*/
e.filterCriteria.madeByUserId=t.data.madeFrom.id,e.partyNameId.id=t.data.madeFrom):(e.filterCriteria.madeByUserId=t.data.onBehalfOfUser.id,e.partyNameId.id=t.data.onBehalfOfUser),d.isNullOrEmpty(t.data.madeBy)||(e.filterCriteria.madeBy=t.data.madeBy),d.isNullOrEmpty(t.data.location)||(e.receiptSearchObject.partyOrgList=[],e.receiptSearchObject.partyOrgList.push(t.data.location)),d.isNullOrEmpty(t.data.dateFromString)||(e.dateFromString=t.data.dateFromString),e.getFilteredReceiptPayment(!0,e.dateFromString))},e.init()}]),angular.module("paripal.billingModule").service("accountStatementService",["httpService","$filter","urlService","dateconvertor","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f){"use strict";this.getAccountStatementDetails=function(b,d,e,g){a.postData(c.getUrl(b),d,function(a){e(a.data)},function(a){g(a)},{orgLocPermission:f.ACC_STMT_VIEW})},this.findSettlementTypes=function(b,d){a.getData(c.getUrl("FIND_SETTLEMENT_TYPES"),null,function(a){b(a.data)},function(a){d(a)},{orgLocPermission:f.ACC_STMT_VIEW})},this.findStatementType=function(b,d){a.getData(c.getUrl("FIND_STATEMENT_TYPES"),null,function(a){b(a.data)},function(a){d(a)},{orgLocPermission:f.ACC_STMT_VIEW})},this.findSettlementStatuses=function(b,d){a.getData(c.getUrl("FIND_SETTLEMENT_STATUS"),null,function(a){b(a.data)},function(a){d(a)},{orgLocPermission:f.ACC_STMT_VIEW})},this.getAllBillPaymentIds=function(b,d,e){a.postData(c.getUrl("GET_BILL_PAYMENT_IDS"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.billingModule").service("addReceiptPaymentService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.savePaymentReceipt=function(b,d,e){a.postData(c.getUrl("ADD_RECEIPT_PAYMENT"),b,function(a){d(a.data)},function(a){e(a)})},this.updatePaymentReceipt=function(b,d,e){a.putData(c.getUrl("UPDATE_RECEIPT_PAYMENT"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.billingModule").service("commonBillingService",["httpService","$filter","urlService","dateconvertor","utilService","$http",function(httpService,$filter,urlService,dateconvertor,utilService,$http){"use strict";this.filterPaymentReceipt=function(a,b,c){httpService.postData(urlService.getUrl("ADD_RECEIPT_PAYMENT"),a,function(a){b(a.data)},function(a){c(a)})},this.getListOfReceiptPaymentStatus=function(a,b){return httpService.getData(urlService.getUrl("FIND_RECEIPT_PAYMENT_STATUS"),null,function(b){a(b.data)},function(a){b()})},this.getListOfTransactionTypes=function(a,b){return httpService.getData(urlService.getUrl("FIND_TRANSACTION_TYPE"),null,function(b){a(b.data)},function(a){b()})},this.getListOfPartyTypes=function(a,b,c){return"receipt"==c?httpService.getData(urlService.getUrl("FIND_ALL_RECEIPT_PARTY_TYPE"),null,function(b){a(b.data)},function(a){b()}):httpService.getData(urlService.getUrl("FIND_ALL_PAYMENT_PARTY_TYPE"),null,function(b){a(b.data)},function(a){b()})},this.getCurrencyList=function(a,b){return httpService.getData(urlService.getUrl("GET_CURRENCYLIST_DATA"),null,function(b){a(b.data)},function(a){b()})},this.getListOfMadeToOrgs=function(a,b,c){return httpService.getData(urlService.getUrl("FIND_MADE_TO_DROPDOWN"),null,function(b){a(b.data)},function(a){b()},{orgLocPermission:c})},this.getListOfReceiptPaymentTypes=function(a,b){return httpService.getData(urlService.getUrl("FIND_RECEIPT_PAYMENT_TYPE"),null,function(b){a(b.data)},function(a){b()})},this.getProfessionalsForBill=function(a,b,c,d){return httpService.getData(urlService.getQueryParameterizedUrl("FIND_PROFESSIONALS_FOR_BILL",a),null,function(a){b(a.data)},function(a){c()},{orgLocPermission:d})},this.getBillingLocations=function(a,b,c,d){return httpService.getData(urlService.getQueryParameterizedUrl("FIND_BILLING_LOCATIONS",a),null,function(a){b(a.data)},function(a){c()},{orgLocPermission:d})},this.getProfessionalsForReceipt=function(a,b,c){return httpService.getData(urlService.getParameterizedUrl("FIND_PROFESSIONALS_FOR_RECEIPT",a),null,function(a){b(a.data)},function(a){c()})},this.getClientsForBills=function(a,b,c){return httpService.getData(urlService.getParameterizedUrl("FIND_CLIENTS_FOR_BILLS",a),null,function(a){b(a.data)},function(a){c()})},this.getClientsForReceipts=function(a,b,c){return httpService.getData(urlService.getParameterizedUrl("FIND_CLIENTS_FOR_RECEIPTS",a),null,function(a){b(a.data)},function(a){c()})},this.getCurrencyLocation=function(a,b,c){var d={locationId:a};httpService.getData(urlService.getParameterizedUrl("GET_BILLING_LOC_CURRENCY",d),null,function(a){b(a.data)},function(a){c(a)})},this.generateBill=function(a,b,c,d){httpService.postData(urlService.getUrl("GENERATE_BILL_BY_TRANSACTION_ID"),a,function(a){b(a.data)},function(a){c(a)},d)},this.recomputeBillItems=function(a){for(var b=0,c=0;c<a.length;c++)a[c].whetherComputed&&(a[c].amount=this.evaluateFormulae(a,a[c],b)),b++},this.evaluateFormulae=function(billItems,billItem,processedHeadCount){for(var formulae=billItem.formulae,i=0;i<processedHeadCount;i++)for(var j=0;j<billItems.length;j++){var formulaeHeadVarName="FH_"+billItems[j].feeHeadId,regexp=new RegExp("\\b("+formulaeHeadVarName+")\\b","gi");formulae=formulae.replace(regexp,billItems[j].amount)}return eval(formulae)},this.getAdhocBillTaxes=function(a,b,c){httpService.postData(urlService.getUrl("RECALCULATE_TAXES_FOR_ADHOC_BILL"),a,function(a){b(a.data)},function(a){c(a)})}}]),angular.module("paripal.billingModule").service("manageBillService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.inactivateBill=function(b,d,e){a.getData(c.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(b){a.putData(c.getUrl("INACTIVATE_BILL",null),b.data,function(a){d(a.data)},function(a){e(a)})},function(a){e(a)})},this.getFeeHeads=function(b,d,e){a.postData(c.getUrl("GET_FEE_HEADS_FOR_MANUAL_BILL"),b,function(a){d(a.data)},function(a){e(a)})},this.getFeeHeadsForCreateBill=function(b,d,e){a.postData(c.getUrl("GET_FEE_HEADS_FOR_CREATE_BILL"),b,function(a){d(a.data)},function(a){e(a)})},this.saveManualBill=function(b,d,e){a.postData(c.getUrl("SAVE_ADHOC_BILL"),b,function(a){d(a.data)},function(a){e(a)})},this.saveRefundBill=function(b,d,e){a.postData(c.getUrl("SAVE_REFUND_BILL"),b,function(a){d(a.data)},function(a){e(a)})},this.updateManualBill=function(b,d,e){a.putData(c.getUrl("UPDATE_MANUAL_BILL"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.billingModule").service("settlementService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.updateSettlement=function(b,d,e){a.putData(c.getUrl("UPDATE_SETTLEMENT"),b,function(a){d(a)},function(a){e(a)})},this.inactivateSettlement=function(b,d,e){a.putData(c.getUrl("INACTIVATE_SETTLEMENT"),b,function(a){d(a)},function(a){e(a)})},this.saveSettlement=function(b,d,e){a.postData(c.getUrl("SAVE_BILL_SETTLEMENT"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.billingModule").service("viewBillSettlementService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.searchBillAdjustmentDetails=function(b,d,e){a.postData(c.getUrl("FIND_BILL_ADJUSTMENT_LIST"),b,function(a){d(a.data)},function(a){e(a)})},this.getBillDetails=function(b,d,e){a.getData(c.getParameterizedUrl("FIND_BILL_BY_ID",b),null,function(a){d(a.data)},function(a){e(a)})},this.saveBillSettlement=function(b,d,f,g,h){var i={};e.isNullOrEmpty(d.id)||("RECEIPT"==b.adjustmentDocumentType.targetType?(i.receipt={id:b.targetAdjustmentDocumentCode.id},i.bill=null,i.refundBill=null,i.payment=null):"PAYMENT"==b.adjustmentDocumentType.targetType?(i.receipt=null,i.bill=null,i.refundBill=null,i.payment={id:b.targetAdjustmentDocumentCode.id}):"DEBIT"==b.adjustmentDocumentType.targetType?(i.receipt=null,i.bill={id:b.targetAdjustmentDocumentCode.id},i.refundBill=null,i.payment=null):(i.receipt=null,i.bill=null,i.refundBill={id:b.targetAdjustmentDocumentCode.id},i.payment=null)),e.isEmpty(b.adjustmentDocumentType)||(i.adjustmentDocumentType=b.adjustmentDocumentType.adjustmentDocumentType),e.isNullOrEmpty(b.sourceAdjustmentDocumentCode)?i.sourceAdjustmentDocumentCode=d.serviceProviderReferenceNo:i.sourceAdjustmentDocumentCode=b.sourceAdjustmentDocumentCode,e.isNullOrEmpty(b.targetAdjustmentDocumentCode)?i.targetAdjustmentDocumentCode=null:"RECEIPT_TO_BILL"==b.adjustmentDocumentType.adjustmentDocumentType?i.targetAdjustmentDocumentCode=b.serviceProviderReferenceNo:i.targetAdjustmentDocumentCode=b.targetAdjustmentDocumentCode.serviceProviderReferenceNo,e.isNullOrEmpty(b.exchangeRate)?i.exchangeRate=null:i.exchangeRate=b.exchangeRate,e.isNullOrEmpty(b.sourceAmountAdjusted)?i.sourceAmountAdjusted=null:i.sourceAmountAdjusted=b.sourceAmountAdjusted,e.isNullOrEmpty(b.targetAmountAdjusted)?i.targetAmountAdjusted=null:i.targetAmountAdjusted=b.targetAmountAdjusted,e.isEmpty(b.inactiveReason)?i.inactiveReason=null:i.inactiveReason=b.inactiveReason,"DEBIT"==b.typeCode?i.bill={id:d.id}:i.refundBill={id:d.id},i.id=b.adjustmentId,e.isFieldEmpty(i.ownerLocationId)?i.ownerLocationId={id:d.ownerLocationId.id}:i.ownerLocationId={id:b.ownerLocationId},i.version=b.version,e.isFieldEmpty(i.whetherActive)?i.whetherActive=!0:i.whetherActive=b.whetherActive,i.sourceCurrencyId=b.sourceCurrencyId,i.targetCurrencyId=b.targetCurrencyId,"add"===f?a.postData(c.getUrl("SAVE_BILL_SETTLEMENT"),i,function(a){g(a.data)},function(a){h(a)}):a.putData(c.getUrl("UPDATE_BILL_SETTLEMENT"),i,function(a){g(a.data)},function(a){h(a)})},this.getBillAdjustmentDetails=function(b,d,e){return a.postData(c.getUrl("GET_BILL_ADJUSTMENT_RECORD"),b,function(a){d(a.data)},function(a){e()})}}]),angular.module("paripal.billingModule").service("viewBillsService",["httpService","$filter","urlService","dateconvertor","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f){"use strict";this.filterBills=function(b,d,e,g){a.postData(c.getUrl(b),d,function(a){e(a.data)},function(a){g(a)},{orgLocPermission:f.BILL_VIEW})},this.viewPdfBill=function(b,d,e){a.postData(c.getUrl("GENERATE_BILL_PDF"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.billingModule").service("viewReceiptPaymentService",["httpService","$filter","urlService","dateconvertor","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f){"use strict";this.filterPaymentReceipt=function(b,d,e,f,g){a.postData(c.getUrl(b),d,function(a){e(a.data)},function(a){f(a)},{orgLocPermission:g})},this.getSettlementDetailsForReceipt=function(b,d,e){return a.postData(c.getUrl("GET_SETTLEMENT_DATA_OF_RECEIPT"),b,function(a){d(a.data)},function(a){e()},{orgLocPermission:f.BILL_SETTLEMENT_VIEW})},this.getSettlementDetailsForReceiptById=function(b,d,e){return a.postData(c.getUrl("GET_RECEIPT_SETTLEMENT_DETAILS_BY_ID"),b,function(a){d(a.data)},function(a){e()})},this.viewSettlement=function(a,b,c){var d={id:a.id,typeCode:a.typeCode,sorters:a.sorters},e={};this.getSettlementDetailsForReceipt(d,function(a){e=a,b(e)},function(a){c()})},this.getReceiptPaymentDetails=function(b,d,e){return a.getData(c.getParameterizedUrl("FIND_RECEIPT_PAYMENT_BY_ID",b),null,function(a){d(a.data)},function(a){e()})},this.getAutoReceiptDetails=function(b,d,e){return a.getData(c.getParameterizedUrl("FIND_AUTORECEIPT_BY_ID",b),null,function(a){d(a.data)},function(a){e()})},this.viewPdfReceipt=function(b,d,e){a.postData(c.getUrl("GENERATE_RECEIPT_PDF"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.callAmbulance").controller("AmbulanceRequestAllocationCtrl",["$scope","$rootScope","$state","ambulanceRequestListService","baseService","utilService","notify","$translate","datatableconfig","$interval","storageService","$mdDialog","commonConstants","dateconvertor","serverSidePagination","GeoCoder","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.commonConstants=m,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterCriteria={},a.picklistData={requestAllocationStatus:{}};var r=e.getLoggedInUser();f.isEmpty(r)||(a.loggedInUserId=r.id),a.userAddressInfo={},a.cancelType="AMBULANCE_REQUEST_CANCLE_DRIVER",a.ambulanceRequestStatus="CANCELLED_BY_DRIVER";var s=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.getUserAddress(b.coords.latitude,b.coords.longitude),a.userLat=b.coords.latitude,a.userLong=b.coords.longitude})},function(a){console.log(a)})};a.getUserAddress=function(b,c){var d=new google.maps.LatLng(b,c),e=new google.maps.Geocoder;e.geocode({latLng:d},function(d,e){e==google.maps.GeocoderStatus.OK&&d[1]&&(a.userAddressInfo.userAddress=d[1].formatted_address,a.userAddressInfo.longitude=c,a.userAddressInfo.lattitude=b,angular.forEach(d[1].address_components,function(b,c){"country"==b.types[0]?a.userAddressInfo.countryName=b.long_name:"administrative_area_level_1"==b.types[0]?a.userAddressInfo.stateName=b.long_name:"administrative_area_level_2"==b.types[0]&&(a.userAddressInfo.cityName=b.long_name)}))})},a.showAddress=function(a){var b=l.alert().title(h.instant("ADDRESS")).htmlContent('<div class="padding-t-10"><b>'+a+"</b></div>").ok(h.instant("OK"));l.show(b).then(function(){},function(){})},a.checkUserPermission=function(){var b=k.getLocationFeaturePrivileges();f.isEmpty(b)||(b.hasOwnProperty("ambulance_driver_assign_by_admin")&&(a.admin=!0),b.hasOwnProperty("ambulance_driver_accept_request")&&(a.driver=!0),b.hasOwnProperty("ambulance_driver_assign_by_admin")&&b.hasOwnProperty("ambulance_driver_accept_request")&&(a.admin=!1,a.driver=!1,a.adminDriver=!0))},a.checkUserPermission(),a.searchAmbulanceRequestAllocation=function(){a.filterCriteria.pageNumber=a.currentPage,a.filterCriteria.recordsPerPage=a.itemPerPage,d.searchAmbulanceRequestAllocation(a.filterCriteria,a.picklistData,a.ambulanceReqId,function(b){a.ambulanceAllocationList=b,a.checkUserPermission(),a.totalItems=b.totalRecords,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems)},function(a){})},a.clear=function(){},a.cancel=function(){l.hide()},a.patientPickedEntered=function(){a.ambulanceAllocationData.noOfPatientLeft>=a.noOfPatientsPicked?(a.cancel(),d.requesterPickedUp(a.ambulanceAllocationData,a.userAddressInfo,a.noOfPatientsPicked,function(b){a.searchAmbulanceRequestAllocation()},function(a){})):a.showError=!0},a.requesterPickedUp=function(b,c){a.ambulanceAllocationData=b,a.noOfRemainingPatients=a.ambulanceAllocationData.noOfPatientLeft,a.showError=!1,b.noOfPatientLeft>1?l.show({clickOutsideToClose:m.dialogBox.clickOutsideToClose,scope:a,preserveScope:!0,parent:angular.element(document.body),targetEvent:c,templateUrl:"app/modules/call-ambulance/views/no-of-patient-picked-popup.html",controller:"AmbulanceRequestAllocationCtrl"}).then(function(){}):d.requesterPickedUp(a.ambulanceAllocationData,a.userAddressInfo,1,function(b){a.searchAmbulanceRequestAllocation()},function(a){})},a.requesterDropped=function(b){d.requesterDropped(b,a.userAddressInfo,function(b){a.searchAmbulanceRequestAllocation()},function(a){})},a.backToLocation=function(b){d.backToLocation(b,function(b){a.searchAmbulanceRequestAllocation()},function(a){})},a.cancelRequest=function(b,c){a.cancellationData={},a.cancellationData.whetherDriver=!0,a.cancellationData.userAddressInfo=a.userAddressInfo,a.cancellationData.requestDetails={},a.cancellationData.requestDetails.ambulanceRequestId=b.ambulanceRequestId,a.cancellationData.requestDetails.ambulanceId=b.ambulanceId,a.cancellationData.requestDetails.ambulanceRequestAllocationId=b.ambulanceRequestAllocationId,a.cancellationData.userDetails={},a.cancellationData.userDetails.requesterName=q.userData.requesterName,a.cancellationData.userDetails.requesterEmail=q.userData.requesterEmail,a.cancellationData.userDetails.requesterContact=q.userData.requesterContact,a.currentRequestData={allocationStatus:b.ambulanceReqAllocationStatusCode},l.show({controller:"CancelAmbulanceRequestCtrl",templateUrl:"app/modules/call-ambulance/views/request-cancellation.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:m.dialogBox.clickOutsideToClose,locals:{parentScope:a}}).then(function(){a.searchAmbulanceRequestAllocation()},function(){a.unAcceptedCancel=!1,a.searchAmbulanceRequestAllocation()})},/****** Server side pagination module *******/
a.pageChanged=function(){a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems),a.searchAmbulanceRequestAllocation()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchAmbulanceRequestAllocation()};/****** datatble config json *******/
var t=m.gridConfigurations;a.options=i.setOptionProperties(t);var u;a.currentLocationDetailStart=function(){a.currentLocationDetailStop(),u=j(s,1e5)},a.currentLocationDetailStop=function(){j.cancel(u)},a.currentLocationDetailStart(),a.$on("$destroy",function(){a.currentLocationDetailStop()}),a.init=function(){q.ambulanceReqId&&(a.ambulanceReqId=q.ambulanceReqId),s(),a.searchAmbulanceRequestAllocation()},a.init(),$("#data-table").on("click",".clickCls",function(b){b.preventDefault();var c=($(this).attr("type").valueOf(),$(this).attr("data").valueOf());f.isNullOrEmpty(c)||a.showAddress(c)})}]),angular.module("paripal.callAmbulance").controller("AmbulanceRequestCtrl",["$scope","$rootScope","$state","ambulanceRequestListService","baseService","utilService","notify","$translate","datatableconfig","$interval","$mdDialog","commonConstants","dateconvertor","serverSidePagination","callAmbulanceService","storageService","NgMap","GeoCoder","urlService","httpService","storageService","GoogleMap","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,p,u,v){a.commonConstants=l,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterCriteria={},a.filterMapCriteria={},a.picklistData={ambulanceType:{},requestStatus:{},status:{}};var w=e.getLoggedInUser();f.isEmpty(w)||(a.loggedInUserId=w.id),a.currentLocation="current-location",a.filter={},a.filter.radius="10000",a.filter.slider=a.filter.radius/1e3;var x=0;a.isOnTheWay=!1,q.getMap().then(function(b){a.map=b}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.requester={queryUrl:"GET_REQUESTER_NAME",queryParameter:{},jsonParameter:{}};var y=new Date;y.setDate(y.getDate()-1),a.filterCriteria.requestDateFrom=m.convertToViewDate(y);var z=new Date;z.setDate(z.getDate()),a.filterCriteria.requestDateTill=m.convertToViewDate(z);var A=function(b){t.getJsonData(s.getJsonFileUrl("AMBULANCE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),B())},function(a){})},B=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){C(b.coords.latitude,b.coords.longitude)})},function(b){if(2==b.code&&"application does not have sufficient geolocation permissions."==b.message){var c=k.confirm().title(h.instant("CHECK_GPS")).textContent(h.instant("PLEASE_TURN_LOCATION_ON")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));k.show(c).then(function(){k.hide()},function(){k.hide()})}u.getUsersCoordinates(b,function(b){C(b.coords.latitude,b.coords.longitude),f.isFieldEmpty(b.errorMessage)||(a.mapErrorMessage=b.errorMessage)}),console.log(b)})},C=function(b,c){var d=e.getDefaultOrgLocation();f.isFieldEmpty(d)||(a.defOrgLoc=d.orgLoc);var g={};g.organizationLocationId=a.defOrgLoc.id,t.getData(s.getParameterizedUrl("CURRENR_LOCARION_ADDRESS",g),null,function(d){if(d&&d.data){a.userAddressDetails=d.data,a.filter.addressLattitudes=a.userAddressDetails.addressLattitudes,a.filter.addressLongitudes=a.userAddressDetails.addressLongitudes;({latLng:new google.maps.LatLng(b,c)});a.ambulanceMapList=[],a.currentLocationObject={orgLocId:0,id:0,location:[a.filter.addressLattitudes,a.filter.addressLongitudes],isDraggable:!1,ambulanceIcon:"app/images/pointers/gen_hospitals.png",isSelected:!1,organizationLocationName:"You are here"},a.ambulanceMapList.push(a.currentLocationObject)}},function(a){errorCallBack(a)})};A(),a.changeRadius=function(){a.filter.radius=1e3*a.filter.slider,a.fetchMapRecords()};var D=p.getLocationFeaturePrivileges();f.isEmpty(D)||(D.hasOwnProperty("ambulance_driver_accept_request")&&(f.isEmpty(w)||(a.ambulanceDriverId=w.id)),D.hasOwnProperty("ambulance_driver_assign_by_admin")&&D.hasOwnProperty("ambulance_driver_accept_request")&&(f.isEmpty(w)||(a.ambulanceDriverId=w.id))),a.cancelFilter=function(){c.reload()},a.checkUserPermission=function(){var b=p.getLocationFeaturePrivileges();f.isEmpty(b)||(b.hasOwnProperty("ambulance_driver_assign_by_admin")&&(a.admin=!0),b.hasOwnProperty("ambulance_driver_accept_request")&&(a.driver=!0),b.hasOwnProperty("ambulance_driver_assign_by_admin")&&b.hasOwnProperty("ambulance_driver_accept_request")&&(a.admin=!1,a.driver=!0,a.adminDriver=!0))},a.driverMapBackToLocation=function(){a.backToLocation()},a.fetchRecords=function(){e.getLoggedInUser()?(a.picklistData.status={},0==x&&(b.showSpinner=!0),a.filterCriteria.pageNumber=a.currentPage,a.filterCriteria.recordsPerPage=a.itemPerPage,d.fetchRecords(a.filterCriteria,a.picklistData,a.ambulanceDriverId,function(c){b.showSpinner=!1,x++,a.ambulanceList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems)})):(a.ambulanceRequesterDetailStop(),a.requestDetailsCallStop())},a.fetchMapRecords=function(){e.getLoggedInUser()?(a.picklistData.status.code="NEW/OPEN",a.filterMapCriteria.requestDateTill=new Date,a.filterMapCriteria.requestDateFrom=new Date(Date.now()-864e5),d.fetchRecords(a.filterMapCriteria,a.picklistData,a.ambulanceDriverId,function(b){a.ambulanceMapDetails=b.data,a.ambulanceMapDetails&&a.ambulanceMapDetails.length&&(a.createAmbulanceMapList(a.ambulanceMapDetails),q.getMap().then(function(b){a.map=b}))})):(a.ambulanceRequesterDetailStop(),a.requestDetailsCallStop())},a.showDetailsOfRequests=function(b){var d={};d.ambulanceReqId=b.id,d.userData={},d.userData.requesterName=b.requesterName,d.userData.requesterEmail=b.requesterEmail,d.userData.requesterContact=b.requesterContact,a.ambulanceRequesterDetailStop(),c.go("ambulancerequestallocation",d)},a.createAmbulanceMapList=function(b){a.ambulanceMapList=[],a.ambulanceMapList.push(a.currentLocationObject);for(var c=0;c<b.length;c++){var d={};d.id=c+1,d.isDraggable=!1,d.isSelected=!1,d.type="AMBULANCE",d.ambulanceIcon="app/images/pointers/male.png",d.ambulanceLattitude=b[c].reqFromLattitude,d.ambulanceLongitute=b[c].reqFromLongitude,d.fulfillAssignObject=b[c],d.location=[b[c].reqFromLattitude,b[c].reqFromLongitude],a.ambulanceMapList.push(d)}},a.getRequesterAddress=function(b,c,d){var e=new google.maps.LatLng(b,c),g=g=new google.maps.Geocoder;g.geocode({latLng:e},function(b,c){c==google.maps.GeocoderStatus.OK&&(f.isNullOrEmpty(d)?b[1]&&(a.requesterDetailsAddress=b[1].formatted_address):f.isNullOrEmpty(d.fulfillAssignObject)||(f.isNullOrEmpty(d.fulfillAssignObject.address)?f.isNullOrEmpty(b[1].formatted_address)||(a.requesterDetailsAddress=b[1].formatted_address):a.requesterDetailsAddress=d.fulfillAssignObject.address,f.isNullOrEmpty(d.fulfillAssignObject.ambulanceType)||f.isNullOrEmpty(d.fulfillAssignObject.ambulanceType.value)||(a.mapAmbulanceType=d.fulfillAssignObject.ambulanceType.value)))})},a.selectAmbulance=function(b,c){"AMBULANCE"==c.type&&(a.requesterDetails=c,a.locationDistance=null,a.source=[a.filter.addressLattitudes,a.filter.addressLongitudes],a.destination=c.location[0]+","+c.location[1],a.getRequesterAddress(c.ambulanceLattitude,c.ambulanceLongitute,c),a.map.showInfoWindow("requesterDetails","id_"+c.id))},a.fulFillRequest=function(b,c,d){a.requestType=d,a.WSfullfillRequest=new Object,angular.copy(c,a.WSfullfillRequest),k.show({clickOutsideToClose:l.dialogBox.clickOutsideToClose,scope:a,preserveScope:!0,parent:angular.element(document.body),targetEvent:b,templateUrl:"app/modules/call-ambulance/views/request-fullfillment.html",controller:"requestFullfillmentCtrl"}).then(function(){a.fetchRecords()})},a.backToLocation=function(){var b={};b.ambulanceId=a.currentRequestData.ambulanceId,d.backToLocation(b,function(b){a.isOnTheWay=!1,a.getDetailsByInterval()},function(a){})},/****** Server side pagination module *******/
a.pageChanged=function(){a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()};/****** datatble config json *******/
var E=l.gridConfigurations;a.options=i.setOptionProperties(E),a.init=function(){a.checkUserPermission(),a.fetchMapRecords(),w.isOrganizationUser||w.isOrganizationUserMode?w.isOrganizationUser&&w.isOrganizationUserMode&&1==a.driver?(a.mapVisibility="show-map",a.buttonText=h.instant("SHOW_TABLE"),a.data={travelMode:{value:"DRIVING",text:h.instant("DRIVING")}},a.isMapVisible=!0):(a.buttonText=h.instant("SHOW_MAP"),a.mapVisibility="hide-map"):(a.mapVisibility="show-map",a.buttonText=h.instant("SHOW_TABLE"),a.data={travelMode:{value:"DRIVING",text:h.instant("DRIVING")}}),a.fetchRecords()},a.init(),a.newRequest=function(){a.requestCancelled=!1,a.requestLastCancelled=!1,a.isSendAll=!1,a.isRecordSelected=!0,a.requestForUser=!0,k.show({controller:"PlaceAmbulanceRequestForUserCtrl",templateUrl:"app/modules/call-ambulance/views/place-ambulance-request-for-user.html",parent:angular.element(document.body),clickOutsideToClose:l.dialogBox.clickOutsideToClose,locals:{parentScope:a}}).then(function(){c.reload()},function(){c.reload()})},a.getMyCurrentRequestDetails=function(){if(!f.isFieldEmpty(a.ambulanceDriverId)){var b={};b.driverId=a.ambulanceDriverId,o.getMyCurrentRequestDetails(b,function(b){b.data&&(a.currentRequestData=b.data[0],f.isEmpty(a.currentRequestData)||f.isNullOrEmpty(a.currentRequestData.allocationStatus)||"ALLOCATED"!=a.currentRequestData.allocationStatus&&"PATIENT_PICKED_UP"!=a.currentRequestData.allocationStatus||c.go("callambulancedriver"),f.isEmpty(a.currentRequestData)||f.isNullOrEmpty(a.currentRequestData.ambulanceStatus)||"ON_THE_WAY"!=a.currentRequestData.ambulanceStatus||(a.isOnTheWay=!0))},function(a){})}},a.getMyCurrentRequestDetails(),a.getDetailsByInterval=function(){1==a.isMapVisible?a.fetchMapRecords():a.fetchRecords()};var F,G;a.ambulanceRequesterDetailStart=function(){1!=a.scopeDestroyed&&(a.ambulanceRequesterDetailStop(),F=j(a.getMyCurrentRequestDetails,5e3))},a.ambulanceRequesterDetailStop=function(){j.cancel(F)},a.ambulanceRequesterDetailStart(),a.requestDetailsCallStart=function(){1!=a.scopeDestroyed&&(a.requestDetailsCallStop(),G=j(a.getDetailsByInterval,15e3))},a.requestDetailsCallStop=function(){j.cancel(G)},a.requestDetailsCallStart(),a.$on("$destroy",function(){a.ambulanceRequesterDetailStop(),a.requestDetailsCallStop(),a.scopeDestroyed=!0}),a.toggleMap=function(){a.isMapVisible=!a.isMapVisible,1==a.isMapVisible?(a.buttonText=h.instant("SHOW_TABLE"),a.mapVisibility="show-map",a.fetchMapRecords()):(a.buttonText=h.instant("SHOW_MAP"),a.mapVisibility="hide-map",a.fetchRecords())},a.getMarkerPosition=function(){a.filter.addressLattitudes=this.position.lat(),a.filter.addressLongitudes=this.position.lng()}}]),angular.module("paripal.callAmbulance").controller("CallAmbulanceCtrl",["$scope","$rootScope","commonConstants","NgMap","httpService","urlService","utilService","notify","callAmbulanceService","$state","$translate","GeoCoder","SearchHospitalService","$mdDialog","baseService","$interval","placeAmbulanceRequestService","$stateParams","GoogleMap",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){a.commonConstants=c,a.currentLocation="current-location";var t=o.getLoggedInUser();g.isEmpty(t)?a.isLoggedIn=!1:(a.requester=t.id,a.userInfo={},a.userInfo.requesterName=t.displayName,a.userInfo.requesterContact=t.cell1,a.userInfo.requesterEmail=t.email1,a.isLoggedIn=!0);a.noOfPatients=1,a.filter={},a.filter.radius="20000",a.filter.slider=a.filter.radius/1e3,a.defaultZoom=12,a.filterCriteria={},a.currentLocationObject={},a.cancelType="AMBULANCE_REQUEST_CANCLE_REQUESTER",a.ambulanceRequestStatus="CANCELLED_BY_PATIENT",a.isRequester=!0,a.checkAdd=function(b){a.confirmEnteredAddress=!a.confirmEnteredAddress},a.assignBooleanValues=function(){a.requestNotPlaced=!0,a.requestNotAccepted=!1,a.requestPlaced=!1,a.patientNotPicked=!0},a.assignBooleanValues(),d.getMap().then(function(b){a.map=b}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.city={queryUrl:"FIND_CITY_BY_NAME",queryParameter:{},jsonParameter:{}};var u=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){v(b.coords.latitude,b.coords.longitude),a.getUserAddress(b.coords.latitude,b.coords.longitude),a.userLat=b.coords.latitude,a.userLong=b.coords.longitude})},function(b){if(2==b.code&&"application does not have sufficient geolocation permissions."==b.message){var c=n.confirm().title(k.instant("CHECK_GPS")).textContent(k.instant("PLEASE_TURN_LOCATION_ON")).ok(k.instant("OK")).cancel(k.instant("CANCEL"));n.show(c).then(function(){n.hide()},function(){n.hide()})}s.getUsersCoordinates(b,function(b){v(b.coords.latitude,b.coords.longitude),g.isFieldEmpty(b.errorMessage)||(a.mapErrorMessage=b.errorMessage)})}):h("error",k.instant("PLEASE_CHECK_GPRS"))},v=function(b,c){a.filter.requesterLattitude=b,a.filter.requesterLongitude=c;var d={latLng:new google.maps.LatLng(b,c)};a.changeLocation(d),a.ambulanceList=[],a.currentLocationObject={id:0,ambulanceId:null,location:[a.filter.requesterLattitude,a.filter.requesterLongitude],isDraggable:!0,ambulanceIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,ambulanceStatus:"USER",organizationLocationName:"You are here"},a.ambulanceList.push(a.currentLocationObject)};a.updateaddress=function(b){
//var ddress = newAddress;
d.getMap("map").then(function(){l.geocode({address:b}).then(function(c){
//vm.mapCenter = result[0].geometry.location;
a.currentLocation=[c[0].geometry.location.lat(),c[0].geometry.location.lng()],a.newAddressFieldCheck=b,a.filter.requesterLattitude=c[0].geometry.location.lat(),a.filter.requesterLongitude=c[0].geometry.location.lng(),a.ambulanceList[0].location=[c[0].geometry.location.lat(),c[0].geometry.location.lng()],a.defaultZoom=17})})},a.getUserAddress=function(b,c){var d=new google.maps.LatLng(b,c),e=e=new google.maps.Geocoder;e.geocode({latLng:d},function(b,c){if(c==google.maps.GeocoderStatus.OK&&b[1]){a.userAddress=b[1].formatted_address;b[1].address_components.length-1;a.userAddressInfo={},a.userAddressInfo.userAddress=a.userAddress,a.newAddressFieldCheck=a.userAddressInfo.userAddress,angular.forEach(b[1].address_components,function(b,c){"country"==b.types[0]?a.userAddressInfo.countryName=b.long_name:"administrative_area_level_1"==b.types[0]?a.userAddressInfo.stateName=b.long_name:"administrative_area_level_2"==b.types[0]&&(a.userAddressInfo.cityName=b.long_name)})}})},a.getLocationAddress=function(b,c){var d=new google.maps.LatLng(b,c),e=e=new google.maps.Geocoder;e.geocode({latLng:d},function(b,c){c==google.maps.GeocoderStatus.OK&&b[1]&&(a.locationAddress=b[1].formatted_address)})},a.findAmbulanceByLocation=function(){a.ambulanceList=[],a.ambulanceList.push(a.currentLocationObject),a.findNearByAmbulances()},a.selectAmbulance=function(b,c){a.locationDistance=null,a.destination=c.location[0]+","+c.location[1],0!==c.id?(a.infoObject={},g.isFieldEmpty(c.ambulanceId)?(a.infoObject.orgLocId=c.locationId,a.infoObject.ambulanceId=null):(a.infoObject.ambulanceId=c.ambulanceId,a.infoObject.orgLocId=null),a.infoObject.addressLattitudes=c.lattitude,a.infoObject.addressLongitudes=c.longitude,a.getLocationAddress(c.lattitude,c.longitude),i.getAmbulanceDetails(a.infoObject,function(b){a.ambulanceLocationDetails=b.data},function(a){}),a.requestNotPlaced&&(a.selectedId=c.id),a.selectedAmbulance=c,g.isFieldEmpty(c.ambulanceId)?a.map.showInfoWindow("locationDetails","id_"+c.id):g.isFieldEmpty(c.ambulanceId)&&a.map.showInfoWindow("ambulanceDetails","id_"+c.id)):a.map.showInfoWindow("userDetails","id_"+c.id)},a.confirmSelection=function(b){a.placeNewRequest(b),a.map.hideInfoWindow("locationDetails"),a.map.hideInfoWindow("ambulanceDetails")},a.confirmEmergencyLocation=function(b){m.changeEmergencyLocation(b),a.map.hideInfoWindow("foo-iw"),a.cancel()},a.unconfirm=function(){a.selectedId=null,a.selectedAddress=null,a.map.hideInfoWindow("bar"),a.destination=null},a.changeRadius=function(){a.filter.radius=1e3*a.filter.slider,a.findAmbulanceByLocation()},a.getMarkerPosition=function(){a.filter.requesterLattitude=this.position.lat(),a.filter.requesterLongitude=this.position.lng()},a.changeLocation=function(b){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filter.requesterLattitude=b.latLng.lat(),a.filter.requesterLongitude=b.latLng.lng(),a.locationChanged=!0,a.getUserAddress(b.latLng.lat(),b.latLng.lng()),a.userLat=b.latLng.lat(),a.userLong=b.latLng.lng(),m.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,requesterLattitude:b.latLng.lat(),requesterLongitude:b.latLng.lng()},a.newAddressFieldCheck=c}),a.currentLocationObject={id:0,ambulanceId:null,location:[a.filter.requesterLattitude,a.filter.requesterLongitude],isDraggable:!0,ambulanceIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,ambulanceStatus:"USER",organizationLocationName:"You dragged here"},a.findAmbulanceByLocation()},a.$watch("filterCriteria.ambulanceType",function(b){g.isEmpty(b)||g.isEmpty(b.dataValue)||(a.findAmbulanceByLocation(),a.getALLAmbulanceList())},!0),a.applyFilter=function(){var b="";g.isFieldEmpty(a.filter.city)||(b+=a.filter.city.value),g.isFieldEmpty(a.filter.postalCode)||(b=g.isFieldEmpty(b)?a.filter.postalCode:b+" "+a.filter.postalCode),g.isFieldEmpty(a.filter.landmark)||(g.isFieldEmpty(b)?b+=a.filter.landmark:b=b+" "+a.filter.landmark),g.isFieldEmpty(b)||(a.ambulanceList[0].location=b,d.getMap("map").then(function(){l.geocode({address:b}).then(function(b){
//vm.mapCenter = result[0].geometry.location;
a.currentLocation=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.filter.requesterLattitude=b[0].geometry.location.lat(),a.filter.requesterLongitude=b[0].geometry.location.lng(),a.ambulanceList[0].location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.findAmbulanceByLocation()})}))},a.findNearByAmbulances=function(){g.isEmpty(a.filterCriteria.ambulanceType)||(a.filter.ambulanceType=a.filterCriteria.ambulanceType.dataValue),a.searchHospSpinner=!0,i.findNearByAmbulances(a.filter,function(b){a.searchHospSpinner=!1;var c=b.data;a.ambulanceList=[],a.orgLocIdArray=[],a.ambulanceList.push(a.currentLocationObject);for(var d=0;d<c.length;d++)g.isFieldEmpty(c[d].lattitude)||g.isFieldEmpty(c[d].longitude)||(c[d].location=[c[d].lattitude,c[d].longitude],c[d].isDraggable=!1,g.isFieldEmpty(c[d].ambulanceId)?1==c[d].totalAmbulance?c[d].ambulanceIconsEnum="ONE":2==c[d].totalAmbulance?c[d].ambulanceIconsEnum="TWO":3==c[d].totalAmbulance?c[d].ambulanceIconsEnum="THREE":4==c[d].totalAmbulance?c[d].ambulanceIconsEnum="FOUR":5==c[d].totalAmbulance?c[d].ambulanceIconsEnum="FIVE":c[d].totalAmbulance>5&&(c[d].ambulanceIconsEnum="FIVEPLUS"):c[d].ambulanceIconsEnum="AMBULANCE",c[d].id=d+1,c[d].ambulanceIcon=a.iconsList.ICONS[c[d].ambulanceIconsEnum],c[d].isSelected=!1,a.orgLocIdArray.push(c[d].locationId),a.ambulanceList.push(c[d]))},function(){a.searchHospSpinner=!1})},a.clear=function(){j.reload()},a.getALLAmbulanceList=function(){a.wsPlaceRequestCriteria={},a.wsPlaceRequestCriteria.requesterLattitude=a.userLat,a.wsPlaceRequestCriteria.requesterLongitude=a.userLong,g.isEmpty(a.userAddressInfo)||(a.wsPlaceRequestCriteria.cityName=a.userAddressInfo.cityName,a.wsPlaceRequestCriteria.stateName=a.userAddressInfo.stateName,a.wsPlaceRequestCriteria.countryName=a.userAddressInfo.countryName),a.wsPlaceRequestCriteria.ambulanceType=angular.copy(a.filterCriteria.ambulanceType.dataValue),a.wsPlaceRequestCriteria.radius=0,q.getAmbulanceList(a.wsPlaceRequestCriteria,function(b){g.isEmpty(b)||angular.forEach(b,function(a,b){a.isSelected=!0}),a.allAmbulanceList=b},function(a){})},a.callBackUrl=function(a){var b=null;if(!g.isFieldEmpty(r.callBackURL)){b=j.current.name;var c=angular.fromJson(localStorage.getItem("sequenceId"));j.go(r.callBackURL,{callbackUrl:j.current.name,callingUrl:b,data:a,sequenceId:c})}},a.placeAmbulanceRequest=function(){a.orgLocIds=[],a.ambulanceIds=[],a.totalCount=0,angular.forEach(a.allAmbulanceList,function(b,c){b.isSelected&&a.orgLocIds.push(b.locationId)}),q.placeAmbulanceRequest(a.wsPlaceRequestCriteria,a.orgLocIds,a.userAddressInfo,a.requester,a.userInfo,a.noOfPatients,a.emergencyRequestDetails,function(b){localStorage.setItem("requesterInfo",angular.toJson(a.userInfo)),a.clear(),h("success",k.instant("REQUEST_PLACED_SUCCESSFULLY")),a.callBackUrl(b)},function(a){})},a.placeNewRequest=function(b){a.requestCancelled=!1,a.requestLastCancelled=!1,a.isSendAll=!1,n.show({controller:"PlaceAmbulanceRequestCtrl",templateUrl:"app/modules/call-ambulance/views/place-ambulance-request.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:c.dialogBox.clickOutsideToClose,locals:{parentScope:a}}).then(function(){},function(){})},a.sendRequestToAllAmbulance=function(b){return a.confirmEnteredAddress?(a.newAddressFieldCheck&&a.confirmEnteredAddress&&(a.userLocation.userAddress=a.newAddressFieldCheck),a.requestCancelled=!1,a.requestLastCancelled=!1,void(!a.isLoggedIn||g.isEmpty(a.filterCriteria.ambulanceType)?(a.isSendAll=!0,n.show({controller:"PlaceAmbulanceRequestCtrl",templateUrl:"app/modules/call-ambulance/views/place-all-ambulance-request.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:c.dialogBox.clickOutsideToClose,locals:{parentScope:a}}).then(function(){},function(){})):a.placeAmbulanceRequest())):void h("alert",k.instant("PLEASE_CONFIRM_ADDRESS"))},a.cancelRequest=function(b){a.cancelCurrentRequest(b),a.map.hideInfoWindow("locationDetails"),a.map.hideInfoWindow("ambulanceDetails")},a.cancelCurrentRequest=function(b){a.cancellationData={},a.cancellationData.userAddressInfo=a.userAddressInfo,a.cancellationData.requestDetails=a.WSAmbluanceAllocation,a.currentRequestData&&"ALLOCATION_REQUEST_CANCELLED"==a.currentRequestData.allocationStatus&&(a.cancellationData.isAllocationNull=!0),a.cancellationData.userDetails={},a.cancellationData.userDetails.requesterName=a.currentRequestData.requesterName,a.cancellationData.userDetails.requesterEmail=a.currentRequestData.requesterEmail,a.cancellationData.userDetails.requesterContact=a.currentRequestData.requesterContact,n.show({controller:"CancelAmbulanceRequestCtrl",templateUrl:"app/modules/call-ambulance/views/request-cancellation.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:c.dialogBox.clickOutsideToClose,locals:{parentScope:a}}).then(function(){},function(){a.unAcceptedCancel=!1})},a.cancelUnAcceptedRequest=function(b){a.unAcceptedCancel=!0,a.cancelCurrentRequest(b)},a.getMyCurrentRequestDetails=function(){var b=angular.fromJson(localStorage.getItem("requesterInfo"));a.isLoggedIn&&(b=a.userInfo),g.isEmpty(b)?a.assignBooleanValues():i.getMyCurrentRequestDetails(b,function(b){b.data&&(a.currentRequestData=b.data[0],g.isEmpty(a.currentRequestData)?a.assignBooleanValues():(a.WSAmbluanceAllocation={},a.WSAmbluanceAllocation.ambulanceRequestId=a.currentRequestData.requestId,a.WSAmbluanceAllocation.ambulanceId=a.currentRequestData.ambulanceId,a.WSAmbluanceAllocation.ambulanceRequestAllocationId=a.currentRequestData.requestAllocationId,g.isNullOrEmpty(a.currentRequestData.requestStatus)||"NEW/OPEN"!=a.currentRequestData.requestStatus&&"ALLOCATION_REQUEST_CANCELLED"!=a.currentRequestData.allocationStatus||(a.requestNotPlaced=!1,a.requestNotAccepted=!0,a.requestPlaced=!1,a.patientNotPicked=!0),g.isNullOrEmpty(a.currentRequestData.allocationStatus)||"ALLOCATED"!=a.currentRequestData.allocationStatus&&"PATIENT_PICKED_UP"!=a.currentRequestData.allocationStatus||(a.requestNotPlaced=!1,a.requestNotAccepted=!1,a.requestPlaced=!0,"PATIENT_PICKED_UP"==a.currentRequestData.allocationStatus&&(a.patientNotPicked=!1)),g.isNullOrEmpty(a.currentRequestData.requestStatus)||"REQUEST_CANCELLED"!=a.currentRequestData.requestStatus&&"REQUEST_FULFILLED"!=a.currentRequestData.requestStatus||a.assignBooleanValues()))},function(a){})},a.getMyCurrentRequestDetails();var w;a.requestNewOpenStart=function(){a.requestNewOpenStop(),w=p(a.getMyCurrentRequestDetails,5e3)},a.requestNewOpenStop=function(){p.cancel(w)},a.requestNewOpenStart(),a.$on("$destroy",function(){a.requestNewOpenStop()}),a.init=function(b){b||a.getAmbulanceIcons(),a.data={travelMode:{value:"DRIVING",text:k.instant("DRIVING")}},"emergencyrequeststatus"==r.callBackURL&&(a.emergencyRequestDetails=r.data)},a.getAmbulanceIcons=function(b){e.getJsonData(f.getJsonFileUrl("AMBULANCE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),u())},function(a){})},a.getAmbulanceTypeList=function(b){var c={};c.type="AMBULANCE_TYPE";var d="GET_PICKLIST_DATA";e.getData(f.getParameterizedUrl(d,c),null,function(b){a.ambulanceTypeList=angular.fromJson(b.data)},function(a){})},a.getAmbulanceTypeList(),a.getAmbulanceByType=function(b){angular.forEach(a.ambulanceTypeList,function(a,c){a.isSelected=!1,a.id==b.id&&(a.isSelected=!0)}),a.filter.ambulanceType=angular.copy(b),delete a.filter.ambulanceType.isSelected,a.filterCriteria.ambulanceType={dataValue:a.filter.ambulanceType},a.findNearByAmbulances()},a.init()}]),angular.module("paripal.callAmbulance").controller("CallAmbulanceDriverCtrl",["$scope","commonConstants","NgMap","httpService","urlService","utilService","notify","callAmbulanceService","$translate","GeoCoder","baseService","$state","$mdDialog","$interval","placeAmbulanceRequestService","storageService","ambulanceRequestListService","GoogleMap","$window","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){a.commonConstants=b,a.currentLocation="current-location";var u=k.getLoggedInUser();a.disableSave=!0,a.filter={},a.filter.radius="15000",a.isRequesterPicked=!1,a.isRequesterDropped=!1,a.isBackToLocation=!1,a.cancelType="AMBULANCE_REQUEST_CANCLE_DRIVER",a.isDriver=!0,a.ambulanceRequestStatus="CANCELLED_BY_DRIVER",a.userAddressInfo={},a.orgLocationAddress={},c.getMap().then(function(b){a.map=b}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.init=function(){a.data={travelMode:{value:"DRIVING",text:i.instant("DRIVING")}}},a.getAmbulanceIcons=function(b){d.getJsonData(e.getJsonFileUrl("AMBULANCE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList))},function(a){})},a.getAmbulanceIcons(),a.init();var v=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.getAmbulanceAddress(b.coords.latitude,b.coords.longitude),a.ambulanceLatitude=b.coords.latitude,a.ambulanceLongitude=b.coords.longitude,a.sourceAddress=b.coords.latitude+","+b.coords.longitude})},function(b){if(console.log(b),2==b.code&&"application does not have sufficient geolocation permissions."==b.message){var c=m.confirm().title(i.instant("CHECK_GPS")).textContent(i.instant("PLEASE_TURN_LOCATION_ON")).ok(i.instant("OK")).cancel(i.instant("CANCEL"));m.show(c).then(function(){m.hide()},function(){m.hide()})}r.getUsersCoordinates(b,function(b){a.getAmbulanceAddress(b.coords.latitude,b.coords.longitude),f.isFieldEmpty(b.errorMessage)||(a.mapErrorMessage=b.errorMessage)})}):g("error",i.instant("PLEASE_CHECK_GPRS"))},w=p.getLocationFeaturePrivileges();f.isEmpty(w)||(w.hasOwnProperty("ambulance_driver_accept_request")&&(f.isEmpty(u)||(a.driverId=u.id)),w.hasOwnProperty("ambulance_driver_assign_by_admin")&&w.hasOwnProperty("ambulance_driver_accept_request")&&(f.isEmpty(u)||(a.driverId=u.id))),a.getRequesterAddress=function(b,c){a.emergencyLocationAddress={},a.emergencyLocationAddress.lattitude=b,a.emergencyLocationAddress.longitude=c;var d=new google.maps.LatLng(b,c),e=e=new google.maps.Geocoder;e.geocode({latLng:d},function(b,c){c==google.maps.GeocoderStatus.OK&&b[1]&&(null!=a.requesterReqisteredAddress?a.requesterAddress=a.requesterReqisteredAddress:a.requesterAddress=b[1].formatted_address,a.emergencyLocationAddress.userAddress=a.requesterAddress,angular.forEach(b[1].address_components,function(b,c){"country"==b.types[0]?a.emergencyLocationAddress.countryName=b.long_name:"administrative_area_level_2"!=b.types[0]&&"locality"!=b.types[0]||(a.emergencyLocationAddress.cityName=b.long_name)}))})},a.getAmbulanceAddress=function(b,c){var d=new google.maps.LatLng(b,c),e=e=new google.maps.Geocoder;e.geocode({latLng:d},function(b,c){c==google.maps.GeocoderStatus.OK&&b[1]&&(a.ambulanceAddress=b[1].formatted_address)})},v(),a.createAmbulanceList=function(b){a.ambulanceList=[];for(var c=0;c<=1;c++){var d={};d.id=c+1,d.isDraggable=!1,d.isSelected=!1,0==c?(d.type="REQUESTER",d.ambulanceIcon="app/images/pointers/male.png",d.requesterLattitude=b.reqFromLattitude,d.requesterLongitute=b.reqFromLongitude,d.requesterAddress=b.address,d.location=[b.reqFromLattitude,b.reqFromLongitude]):(d.type="AMBULANCE",a.currentLocation=[a.ambulanceLatitude,a.ambulanceLongitude],d.ambulanceIcon="app/images/ambulance/Ambulance.png",d.ambulanceLattitude=a.ambulanceLatitude,d.ambulanceLongitute=a.ambulanceLongitude,d.location=[a.ambulanceLatitude,a.ambulanceLongitude]),a.ambulanceList.push(d),f.isNullOrEmpty(d.requesterLattitude)||f.isNullOrEmpty(d.requesterLongitute)||(a.destinationAddress=d.requesterLattitude+","+d.requesterLongitute,a.getRequesterAddress(d.requesterLattitude,d.requesterLongitute),f.isNullOrEmpty(d.requesterAddress)||(a.requesterReqisteredAddress=d.requesterAddress))}},a.getMyCurrentRequestDetails=function(){if(f.isFieldEmpty(a.driverId)||f.isFieldEmpty(k.getLoggedInUser())||1==a.isDestroyed)a.ambulanceRequesterDetailStop(),a.currentLocationDetailStop();else{var b={};b.driverId=a.driverId,h.getMyCurrentRequestDetails(b,function(b){b.data&&(a.currentRequestData=b.data[0],a.getOrgLocationAddress(),f.isEmpty(a.currentRequestData)||(a.noOfRemainingPatients=a.currentRequestData.noOfRemainingPatients,a.WSAmbluanceAllocation={},a.WSAmbluanceAllocation.ambulanceRequestId=a.currentRequestData.requestId,a.WSAmbluanceAllocation.ambulanceId=a.currentRequestData.ambulanceId,a.WSAmbluanceAllocation.ambulanceRequestAllocationId=a.currentRequestData.requestAllocationId,f.isNullOrEmpty(a.currentRequestData.allocationStatus)||"ALLOCATED"!=a.currentRequestData.allocationStatus||a.createAmbulanceList(a.currentRequestData),f.isNullOrEmpty(a.currentRequestData.allocationStatus)||"PATIENT_PICKED_UP"!=a.currentRequestData.allocationStatus||(a.createAmbulanceList(a.currentRequestData),a.isRequesterPicked=!0,t.showSpinner=!1),f.isNullOrEmpty(a.currentRequestData.allocationStatus)||"ALLOCATION_REQUEST_FULFILLED"!=a.currentRequestData.allocationStatus&&"ALLOCATION_REQUEST_CANCELLED"!=a.currentRequestData.allocationStatus||l.go("ambulancerequest")))},function(a){})}},a.getMyCurrentRequestDetails(),a.getOrgLocationAddress=function(){var b=new google.maps.LatLng(a.currentRequestData.providerLattitude,a.currentRequestData.providerLongitude),c=c=new google.maps.Geocoder;c.geocode({latLng:b},function(b,c){c==google.maps.GeocoderStatus.OK&&b[1]&&(a.userAddress=b[1].formatted_address,angular.forEach(b[1].address_components,function(b,c){a.orgLocationAddress.longitude=a.currentRequestData.providerLattitude,a.orgLocationAddress.lattitude=a.currentRequestData.providerLongitude,a.orgLocationAddress.userAddress=a.userAddress,"country"==b.types[0]?a.orgLocationAddress.countryName=b.long_name:"administrative_area_level_2"!=b.types[0]&&"locality"!=b.types[0]||(a.orgLocationAddress.cityName=b.long_name)}))})},a.selectAmbulance=function(b,c){a.locationDistance=null,a.destination=c.location[0]+","+c.location[1],"REQUESTER"==c.type?(a.getRequesterAddress(c.requesterLattitude,c.requesterLongitute),a.map.showInfoWindow("requesterDetails","id_"+c.id)):a.map.showInfoWindow("userDetails","id_"+c.id)},a.getMarkerPosition=function(){a.filter.addressLattitudes=this.position.lat(),a.filter.addressLongitudes=this.position.lng()},a.cancel=function(){m.hide()},a.patientPickedEntered=function(){a.currentRequestData.noOfRemainingPatients>=a.noOfPatientsPicked?a.noOfPatientsPicked>=a.currentRequestData.noOfMappedPatientsToAmbulance?(a.cancel(),q.requesterPickedUp(a.WSAmbluanceAllocation,a.userAddressInfo,a.noOfPatientsPicked,function(a){},function(a){})):g("error",i.instant("PICKED_UP_PATIENT_SHOULD_BY_GREATER_EQUAL_MAPPED_PATIENT")):a.showError=!0},a.validatePickup=function(){a.noOfPatientsPicked>=a.currentRequestData.noOfMappedPatientsToAmbulance?a.disableSave=!1:(g("error",i.instant("PICKED_UP_PATIENT_SHOULD_BY_GREATER_EQUAL_MAPPED_PATIENT")),a.disableSave=!0)},a.requesterPickedUp=function(c){a.showError=!1,a.currentRequestData.noOfRemainingPatients>1?m.show({clickOutsideToClose:b.dialogBox.clickOutsideToClose,scope:a,preserveScope:!0,parent:angular.element(document.body),targetEvent:c,templateUrl:"app/modules/call-ambulance/views/no-of-patient-picked-popup.html",controller:"CallAmbulanceDriverCtrl"}).then(function(){}):(t.showSpinner=!0,f.isNullOrEmpty(a.emergencyLocationAddress)?f.isNullOrEmpty(a.currentRequestData)||(a.orgLocationAddress.longitude=a.currentRequestData.providerLattitude,a.orgLocationAddress.lattitude=a.currentRequestData.providerLongitude,a.orgLocationAddress.userAddress=a.userAddress):!f.isNullOrEmpty(a.emergencyLocationAddress.cityName),q.requesterPickedUp(a.WSAmbluanceAllocation,a.emergencyLocationAddress,1,function(b){a.isRequesterPicked&&(t.showSpinner=!1)},function(a){t.showSpinner=!1}))},a.getCurrentLocation=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.getCurrentAddress(b.coords.latitude,b.coords.longitude)})},function(a){console.log(a)})},a.getCurrentAddress=function(b,c){var d=new google.maps.LatLng(b,c),e=e=new google.maps.Geocoder;e.geocode({latLng:d},function(d,e){e==google.maps.GeocoderStatus.OK&&d[1]&&(a.userAddress=d[1].formatted_address,angular.forEach(d[1].address_components,function(d,e){a.userAddressInfo.longitude=c,a.userAddressInfo.lattitude=b,a.userAddressInfo.userAddress=a.userAddress,"country"==d.types[0]?a.userAddressInfo.countryName=d.long_name:"administrative_area_level_1"==d.types[0]?a.userAddressInfo.stateName=d.long_name:"administrative_area_level_2"!=d.types[0]&&"locality"!=d.types[0]||(a.userAddressInfo.cityName=d.long_name)}))})},a.requesterDropped=function(){t.showSpinner=!0,q.requesterDropped(a.WSAmbluanceAllocation,a.orgLocationAddress,function(b){a.isRequesterDropped=!0,t.showSpinner=!1},function(a){t.showSpinner=!1})},a.cancelRequest=function(b){a.cancelCurrentRequest(b),a.map.hideInfoWindow("locationDetails"),a.map.hideInfoWindow("ambulanceDetails")},a.cancelCurrentRequest=function(c){a.cancellationData={},a.cancellationData.whetherDriver=!0,a.cancellationData.userAddressInfo=a.userAddressInfo,a.cancellationData.requestDetails=a.WSAmbluanceAllocation,a.cancellationData.userDetails={},a.cancellationData.userDetails.requesterName=a.currentRequestData.requesterName,a.cancellationData.userDetails.requesterEmail=a.currentRequestData.requesterEmail,a.cancellationData.userDetails.requesterContact=a.currentRequestData.requesterContact,m.show({controller:"CancelAmbulanceRequestCtrl",templateUrl:"app/modules/call-ambulance/views/request-cancellation.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:b.dialogBox.clickOutsideToClose,locals:{parentScope:a}}).then(function(){l.go("ambulancerequest")},function(){})};var x,y;a.ambulanceRequesterDetailStart=function(){a.ambulanceRequesterDetailStop(),x=n(a.getMyCurrentRequestDetails,5e3)},a.ambulanceRequesterDetailStop=function(){n.cancel(x)},a.ambulanceRequesterDetailStart(),a.currentLocationDetailStart=function(){a.currentLocationDetailStop(),y=n(a.getCurrentLocation,5e3)},a.currentLocationDetailStop=function(){n.cancel(y)},a.currentLocationDetailStart(),a.$on("$destroy",function(){a.isDestroyed=!0,a.ambulanceRequesterDetailStop(),a.currentLocationDetailStop()}),a.getDirections=function(){if(!f.isNullOrEmpty(a.destinationAddress)&&!f.isNullOrEmpty(a.sourceAddress))var b=a.sourceAddress,c=a.destinationAddress;var d=!!window.cordova;d?window.location.href="https://www.google.com/maps/search/?api=1&query="+c:s.open("http://maps.google.com/maps?saddr="+b+"&daddr="+c,"_blank")}}]),angular.module("paripal.callAmbulance").controller("CancelAmbulanceRequestCtrl",["$scope","placeAmbulanceRequestService","httpService","urlService","baseService","utilService","notify","$translate","$mdDialog","commonConstants","parentScope","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,c,d){a.hide=function(){i.hide()},a.cancel=function(){i.cancel()},a.saveCancelReason=function(){f.isEmpty(a.selectedReason)||b.cancelAmbulanceRequest(a.selectedReason,k.cancellationData,function(a){i.hide()},function(a){})},a.mapCancellationReasons=function(b){a.cancelReasonList=[],angular.forEach(b,function(b,c){"AMBULANCE_REQUEST_CANCLE_REQUESTER"==k.cancelType?("NEW/OPEN"!=k.currentRequestData.requestStatus&&"ALLOCATION_REQUEST_CANCELLED"!=k.currentRequestData.allocationStatus||"ALTERNATE_TRANSPORTATION_ARRANGED"!=b.code&&"REQUEST_NO_LONGER_REQUIRED"!=b.code||a.cancelReasonList.push(b),"ALLOCATED"==k.currentRequestData.allocationStatus&&"AMBULANCE_BREAK_DOWN_REQUESTER"!==b.code&&a.cancelReasonList.push(b)):"AMBULANCE_REQUEST_CANCLE_DRIVER"==k.cancelType&&("PATIENT_PICKED_UP"==k.currentRequestData.allocationStatus&&"AMBULANCE_BREAK_DOWN"==b.code?a.cancelReasonList.push(b):"PATIENT_PICKED_UP"!==k.currentRequestData.allocationStatus&&a.cancelReasonList.push(b))}),a.cancelReason=a.cancelReasonList},a.getPickList=function(b){var e={};e.type=b;var f="GET_PICKLIST_DATA";c.getData(d.getParameterizedUrl(f,e),null,function(b){a.mapCancellationReasons(angular.fromJson(b.data))},function(a){})},a.getPickList(k.cancelType),a.init=function(){},a.init()}]),angular.module("paripal.callAmbulance").controller("PlaceAmbulanceRequestCtrl",["$scope","placeAmbulanceRequestService","httpService","urlService","baseService","utilService","notify","$translate","datatableconfig","$mdDialog","commonConstants","dateconvertor","serverSidePagination","parentScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=e.getLoggedInUser();a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterCriteria={},a.filterCriteria.radius="0",a.filterCriteria.slider=a.filterCriteria.radius/1e3,a.picklistData={ambulanceType:{}},a.ambulanceList=[],a.checkedArray=[],a.isLoggedIn=!1,a.isRecordSelected=!1,f.isEmpty(o)||(a.requester=o.id,a.filterCriteria.requesterName=o.displayName,a.filterCriteria.requesterContact=o.cell1,a.filterCriteria.requesterEmail=o.email1,a.isLoggedIn=!0),!f.isEmpty(n)&&n.userLocation&&n.userLocation.userAddress&&(a.filterCriteria.currentLocationAddress=n.userLocation.userAddress),a.hide=function(){j.hide()},a.cancel=function(){j.cancel()},a.$watch("picklistData.ambulanceType",function(b){f.isEmpty(b)||(f.isFieldEmpty(b.id)&&!f.isEmpty(b.dataValue)?(a.selectedServiceProviderId=-1,a.wsPlaceRequestCriteria.ambulanceType=b.dataValue):f.isEmpty(b.dataValue)||(a.wsPlaceRequestCriteria.ambulanceType=b.dataValue),a.getAmbulanceList())},!0),a.$watch("checkedArray",function(b){f.isEmpty(b)||(a.isRecordSelected=!1,angular.forEach(a.checkedArray,function(b,c){b&&(a.isRecordSelected=!0)}))},!0),a.changeRadius=function(){a.wsPlaceRequestCriteria.radius=1e3*a.filterCriteria.slider,f.isEmpty(a.wsPlaceRequestCriteria.ambulanceType)||f.isEmpty(n.filterCriteria.ambulanceType.dataValue)||a.getAmbulanceList()},a.getAmbulanceList=function(){b.getAmbulanceList(a.wsPlaceRequestCriteria,function(b){f.isEmpty(b)||angular.forEach(b,function(b,c){a.checkedArray[b.locationId]=!1,b.isSelected=!1,f.isEmpty(n.selectedAmbulance)?(a.checkedArray[b.locationId]=!0,b.isSelected=!0):b.locationId==a.selectedServiceProviderId&&(b.isSelected=!0,a.checkedArray[b.locationId]=!0),n.isSendAll&&(a.checkedArray[b.locationId]=!0,b.isSelected=!0)}),a.ambulanceList=b},function(a){})},a.recordSelected=function(b){b.isSelected=!b.isSelected,a.checkedArray[b.locationId]=b.isSelected},a.placeAmbulanceRequest=function(){a.orgLocIds=[],a.ambulanceIds=[],a.totalCount=0,angular.forEach(a.ambulanceList,function(b,c){b.isSelected&&(a.orgLocIds.push(b.locationId),a.totalCount=a.totalCount+b.total)}),b.placeAmbulanceRequest(a.wsPlaceRequestCriteria,a.orgLocIds,n.userAddressInfo,a.requester,a.filterCriteria,n.noOfPatients,n.emergencyRequestDetails,function(b){localStorage.setItem("requesterInfo",angular.toJson(a.filterCriteria)),a.cancel(),n.clear(),g("success",h.instant("REQUEST_PLACED_SUCCESSFULLY")),n.callBackUrl(b)},function(a){})},a.sendRequestToALlAmbulance=function(){a.placeAmbulanceRequest()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()};
//datatble config json
var p=k.gridConfigurations;a.options=i.setOptionProperties(p),a.init=function(){a.wsPlaceRequestCriteria={};var b=[];$.each(n.orgLocIdArray,function(a,c){$.inArray(c,b)===-1&&b.push(c)}),f.isEmpty(n.selectedAmbulance)||(a.selectedServiceProviderId=angular.copy(n.selectedAmbulance.locationId)),/*$scope.wsPlaceRequestCriteria.orgLocIds = angular.copy(orgLocIds);*/
a.wsPlaceRequestCriteria.requesterLattitude=n.userLat,a.wsPlaceRequestCriteria.requesterLongitude=n.userLong,f.isEmpty(n.userAddressInfo)||(a.wsPlaceRequestCriteria.cityName=n.userAddressInfo.cityName,a.wsPlaceRequestCriteria.stateName=n.userAddressInfo.stateName,a.wsPlaceRequestCriteria.countryName=n.userAddressInfo.countryName),n.filter&&n.filter.slider&&0!=n.filter.slider?a.wsPlaceRequestCriteria.radius=n.filter.slider:a.wsPlaceRequestCriteria.radius=20,f.isEmpty(n.filterCriteria.ambulanceType)||f.isEmpty(n.filterCriteria.ambulanceType.dataValue)||(a.wsPlaceRequestCriteria.ambulanceType=angular.copy(n.filterCriteria.ambulanceType.dataValue.code),a.picklistData.ambulanceType=angular.copy(n.filterCriteria.ambulanceType.dataValue))},a.init()}]),angular.module("paripal.callAmbulance").controller("PlaceAmbulanceRequestForUserCtrl",["$scope","$rootScope","placeAmbulanceRequestService","httpService","urlService","baseService","utilService","notify","$translate","datatableconfig","$mdDialog","commonConstants","dateconvertor","serverSidePagination","parentScope","$http","GeoCoder","addOrgLocClientService","$state","NgMap","GeoCoder","GoogleMap","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,q,u,v){var w=f.getLoggedInUser();a.filterCriteria={},a.WSClientExtraData={},a.addressInfo={},a.user={userData:{}},a.picklistData={ambulanceType:{}},a.isLoggedIn=!1,a.isRecordSelected=!1,a.latLngPresent=!1,a.disableUser=!1,g.isEmpty(w)||(a.isLoggedIn=!0),a.addressInfo={},a.hide=function(){k.hide()},a.showMap=!1,a.showMapDisabled=!0,a.userList=[],a.$watch("picklistData.ambulanceType",function(b){g.isEmpty(b)||(g.isFieldEmpty(b.id)&&!g.isEmpty(b.dataValue)?(a.selectedServiceProviderId=-1,a.wsPlaceRequestCriteria.ambulanceType=b.dataValue):g.isEmpty(b.dataValue)||(a.wsPlaceRequestCriteria.ambulanceType=b.dataValue))},!0),a.checkUsersMobileNo=function(){a.WSClientExtraData.cellNo&&r.UserInfoDTO(a.WSClientExtraData.cellNo,function(b){b&&b.length>0?a.userList=b.sort(function(a,b){return b.age-a.age}):(a.userList=[],a.user.userData={},a.userDetails={},delete a.WSClientExtraData.email,delete a.WSClientExtraData.selectUserId)},function(a){})},a.checkOrgLocClient=function(b,c){var f={};f.userId=b.userId,f.orgLocId=a.defOrgLoc.id,d.getData(e.getParameterizedUrl("IS_LOGGED_USER_CLIENT_BY_LOC_ID",f),null,function(b){b&&b.data?a.isLocUser=!0:a.isLocUser=!1},function(a){})},a.getUserDetails=function(b){a.user={},r.userDetailsInfo(b.userId,function(c){r.userInfo(b.userId,function(b){a.user={},a.user.userData={},a.user.userData.data=b,a.user.userData.data.value=b.displayName,a.user.userData.data.userAccountType=null,a.user.userData.nameValue=b.displayName},function(a){})},function(a){})},a.$watch("user.userData",function(b){g.isNullOrEmpty(b)||b.data!=-1||g.isNullOrEmpty(b.nameValue)||(a.userName=b.nameValue)},!0),a.$watch("user.userData.data",function(b){a.user&&a.user.userData&&!g.isEmpty(a.user.userData.data)?(g.isFieldEmpty(a.user.userData.data.id)||a.userDetailsInfo(a.user.userData.data.id),a.WSClientExtraData.cellNo=parseFloat(b.cell1),a.WSClientExtraData.email=b.email1,a.disableUser=!0):(a.isLocUser=!1,a.user.userData&&a.user.userData.data==-1&&(delete a.WSClientExtraData.email,delete a.WSClientExtraData.selectUserId,a.userList=[],a.addressInfo.addressLine1=""),a.disableUser=!1,a.userSelectedDisabled=!1)},!0),a.userDetailsInfo=function(b){r.userDetailsInfo(b,function(b){a.addressData=b.userAddress,a.WSClientExtraData.cellNo=b.cell1,a.WSClientExtraData.email=b.email1},function(a){})},a.placeAmbulanceRequest=function(){if(b.showSpinner=!0,g.isNullOrEmpty(a.WSClientExtraData)||(g.isNullOrEmpty(a.WSClientExtraData.cellNo)||(a.filterCriteria.requesterContact=a.WSClientExtraData.cellNo),g.isNullOrEmpty(a.WSClientExtraData.email)||(a.filterCriteria.requesterEmail=a.WSClientExtraData.email)),g.isNullOrEmpty(a.user)?g.isNullOrEmpty(a.user.userData.nameValue)?g.isNullOrEmpty(a.userName)||(a.filterCriteria.requesterName=a.userName):a.filterCriteria.requesterName=a.user.userData.nameValue:g.isNullOrEmpty(a.user.userData)?g.isNullOrEmpty(a.user.userData.nameValue)?g.isNullOrEmpty(a.userName)||(a.filterCriteria.requesterName=a.userName):a.filterCriteria.requesterName=a.user.userData.nameValue:g.isNullOrEmpty(a.user.userData.data)?g.isNullOrEmpty(a.user.userData.nameValue)?g.isNullOrEmpty(a.userName)||(a.filterCriteria.requesterName=a.userName):a.filterCriteria.requesterName=a.user.userData.nameValue:g.isNullOrEmpty(a.user.userData.data.id)||(a.requester=a.user.userData.data.id,a.filterCriteria.requesterName=a.user.userData.data.value),a.wsPlaceRequestCriteria.whetherRaisedByAdmin=!0,a.orgLocIds=[],a.orgLocIds.push(a.defOrgLoc.id),geocoder=new google.maps.Geocoder,!g.isNullOrEmpty(a.addressInfo)){if(!g.isNullOrEmpty(a.addressInfo.addressLine1))var d=a.addressInfo.addressLine1;if(!g.isNullOrEmpty(a.addressInfo.city))var e=a.addressInfo.city.value;if(!g.isNullOrEmpty(a.addressInfo.district))var f=a.addressInfo.district.value;if(!g.isNullOrEmpty(a.addressInfo.state))var j=a.addressInfo.state.value;if(!g.isNullOrEmpty(a.addressInfo.country))var k=a.addressInfo.country.value;if(!g.isNullOrEmpty(a.addressInfo.postalCode))var l=a.addressInfo.postalCode;var m=d+" "+e+" "+f+" "+j+" "+k+" "+l}var n=m;geocoder.geocode({address:n},function(d,e){"OK"==e?(a.zoom=25,a.currentPosition=[d[0].geometry.location.lat(),d[0].geometry.location.lng()],a.wsPlaceRequestCriteria.requesterLongitude=a.currentPosition[1],a.wsPlaceRequestCriteria.requesterLattitude=a.currentPosition[0],c.placeAmbulanceRequest(a.wsPlaceRequestCriteria,a.orgLocIds,a.addressInfo,a.requester,a.filterCriteria,o.noOfPatients,o.emergencyRequestDetails,function(c){b.showSpinner=!1,localStorage.setItem("requesterInfo",angular.toJson(a.filterCriteria)),a.hide(),h("success",i.instant("REQUEST_PLACED_SUCCESSFULLY"))},function(a){b.showSpinner=!1})):b.showSpinner=!1})},a.init=function(){v(function(){a.mapDisplay=!0},500),a.wsPlaceRequestCriteria={};var b=f.getDefaultOrgLocation();g.isFieldEmpty(b)||(a.defOrgLoc=b.orgLoc);var c={};c.organizationLocationId=a.defOrgLoc.id,d.getData(e.getParameterizedUrl("CURRENR_LOCARION_ADDRESS",c),null,function(b){b&&b.data&&(a.userAddressDetails=b.data,a.addressInfo.country=a.userAddressDetails.country,a.countryId=a.userAddressDetails.country.id,a.addressInfo.city=a.userAddressDetails.city,a.addressInfo.district=a.userAddressDetails.district,a.districtId=a.userAddressDetails.district.id,a.addressInfo.state=a.userAddressDetails.state,a.stateId=a.userAddressDetails.state.id,a.setAddress())},function(a){errorCallBack(a)}),g.isEmpty(o.filterCriteria.ambulanceType)||g.isEmpty(o.filterCriteria.ambulanceType.dataValue)||(a.wsPlaceRequestCriteria.ambulanceType=angular.copy(o.filterCriteria.ambulanceType.dataValue.code),a.picklistData.ambulanceType=angular.copy(o.filterCriteria.ambulanceType.dataValue))},a.init(),a.getOrgCountries=function(b){var c={};return c.searchString=b,d.getData(e.getParameterizedUrl("GET_COUNTRY_DATA",c),null,function(b){return a.countryData=angular.fromJson(b.data),a.countryData},function(a){})},a.onCountrySelect=function(b){a.addressInfo.country=b,a.countryId=b.id,a.stateDisabled=!1,a.clearData("country")},a.getOrgState=function(b){var c={};return c.searchString=b,c.countryId=a.countryId,d.getData(e.getParameterizedUrl("GET_STATE_DATA",c),null,function(b){return a.stateData=angular.fromJson(b.data),a.stateData},function(a){})},a.onStateSelect=function(b){a.addressInfo.state=b,a.stateId=b.id,a.cityDistValue=!1,a.clearData("state")},a.getOrgDists=function(b){var c={};return c.searchString=b,c.stateId=a.stateId,d.getData(e.getParameterizedUrl("GET_DISTRICT_DATA",c),null,function(b){return a.districtData=angular.fromJson(b.data),a.districtData},function(a){})},a.onDistrictSelect=function(b){a.addressInfo.district=b,a.districtId=b.id,a.clearData("district")},a.getOrgCities=function(b){var c={};return c.searchString=b,c.stateId=a.stateId,a.districtId?c.districtId=a.districtId:c.districtId=-1,d.getData(e.getParameterizedUrl("GET_CITY_DATA",c),null,function(b){return a.cityData=angular.fromJson(b.data),a.cityData},function(a){})},a.onCitySelect=function(b){a.addressInfo.city=b},a.clearData=function(b){"country"===b?(a.addressInfo.state="",a.addressInfo.district="",a.addressInfo.city="",a.stateDisabled=!1):"state"===b?(a.addressInfo.district="",a.addressInfo.city="",a.cityDistValue=!1):"district"===b&&(a.addressInfo.city="")},a.addressTextValue=function(b,c){"addressLine1"===c&&(g.isNullOrEmpty(b)||(a.addressInfo.addressLine1=b)),"postalCode"===c&&(g.isNullOrEmpty(b)||(a.addressInfo.postalCode=b))},a.setAddress=function(c,d){var e="";g.isFieldEmpty(a.addressInfo.addressLine1)||(e=e+a.addressInfo.addressLine1+", "),g.isFieldEmpty(a.addressInfo.city)||(e=e+a.addressInfo.city.value+", "),g.isFieldEmpty(a.addressInfo.postalCode)||(e=e+a.addressInfo.postalCode+", "),g.isFieldEmpty(a.addressInfo.district)||(e=e+a.addressInfo.district.value+", "),g.isFieldEmpty(a.addressInfo.state)||(e=e+a.addressInfo.state.value+", "),g.isFieldEmpty(a.addressInfo.country)||(e+=a.addressInfo.country.value),a.finalUserlocation=e,geocoder=new google.maps.Geocoder;var f=e;geocoder.geocode({address:f},function(c,d){"OK"==d?angular.forEach(c[0].address_components,function(b,d){d>=0&&(a.zoom=25,/*$scope.addressInfo.addressLine1 = results[0].formatted_address;*/
a.currentPosition=[c[0].geometry.location.lat(),c[0].geometry.location.lng()],a.showMapDisabled=!1,"postal_code"==b.types[0]&&(a.addressInfo.postalCode=b.long_name),v(function(){angular.element(document.getElementById("clickHere")).trigger("click")},0))}):b.showSpinner=!1})},a.findRequester=function(){a.showMap=!0},a.saveAddress=function(){a.showMap=!1},/*Map Integration Start*/
a.getPosition=function(b){if(!a.disabledFormFields&&(a.currentPosition=u.getCoordinates(b),!g.isFieldEmpty(b))){var c=new google.maps.Geocoder;c.geocode({latLng:b.latLng},function(b,c){c==google.maps.GeocoderStatus.OK&&angular.forEach(b[0].address_components,function(c,d){d>=0&&(a.zoom=25,a.addressInfo.addressLine1=b[0].formatted_address,a.currentPosition=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],"postal_code"==c.types[0]&&(a.addressInfo.postalCode=c.long_name),v(function(){angular.element(document.getElementById("clickHere")).trigger("click")},0))})})}}}]),angular.module("paripal.callAmbulance").controller("requestFullfillmentCtrl",["$scope","$mdDialog","userStatusService","ambulanceRequestListService","$rootScope","utilService","httpService","urlService","$translate","notify",function(a,b,c,d,e,f,g,h,i,j){a.driver={queryUrl:"FIND_DRIVERS_TO_MAP_TO_REQUEST",queryParameter:{orgId:a.WSfullfillRequest.ambulanceLocId},jsonParameter:{}},a.cancel=function(){b.cancel()},a.setDataOnPopup=function(){a.WSfullfillRequest.vehicleNo=a.wsAmbulanceDetails.vehicleNo,a.WSfullfillRequest.color=a.wsAmbulanceDetails.color,a.WSfullfillRequest.make=a.wsAmbulanceDetails.make,a.WSfullfillRequest.modelYear=a.wsAmbulanceDetails.modelYear},a.getAmbulanceDetailByDriverId=function(){f.isFieldEmpty(a.driverId)||d.getAmbulanceDetailByDriverId(a.driverId,function(b){f.isEmpty(b)||b.type.code==a.WSfullfillRequest.ambulanceType.code&&(a.wsAmbulanceDetails=b,a.ambulanceId=a.wsAmbulanceDetails.id,a.setDataOnPopup(),f.isEmpty(b.driver)?a.WSfullfillRequest.driver={driverName:b.driverName}:a.WSfullfillRequest.driver={driverName:b.driver.value,driverId:b.driver.id})})},"fulfillRequest"==a.requestType?(a.isFulfillRequest=!0,a.driverId=c.userStatus().userData.id,a.getAmbulanceDetailByDriverId()):a.isFulfillRequest=!1,a.getUsers=function(b){var c={};return c.searchName=b,c.ambulanceTypeId=a.WSfullfillRequest.ambulanceType.id,c.isDriver=a.isFulfillRequest,g.getData(h.getParameterizedUrl("FIND_DRIVERS_TO_MAP_TO_REQUEST",c),null,function(b){if(b&&b.data)return a.driverValues=angular.fromJson(b.data),a.driverValues},function(a){})},a.onUserSelect=function(b){a.driverId=b.driverId,a.ambulanceId=b.ambulanceId,a.getAmbulanceDetailByDriverId()},a.validateValue=function(b){f.isFieldEmpty(b)&&(a.driverId=null,a.ambulanceId=null,a.wsAmbulanceDetails={},a.setDataOnPopup())},a.assignRequest=function(){e.showSpinner=!0,d.assignRequest(a.ambulanceId,a.WSfullfillRequest.id,function(a){e.showSpinner=!1,j("success",i.instant("DRIVER_ASSIGN_SUCCESSFULLY")),b.hide()})}}]),angular.module("paripal.callAmbulance").service("callAmbulanceService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.findNearByAmbulances=function(c,e,f){var g=b.getParameterizedUrl("FIND_NEAR_BY_AMBULANCE",c),h=angular.copy(c);d.isEmpty(h.ambulanceType)||(h.ambulanceType=h.ambulanceType.code),d.isEmpty(h.city)||(h.cityName=h.city.value),h.radius=h.slider,delete h.city,delete h.landmark,delete h.postalCode,delete h.slider,a.postData(g,h,function(a){e(a)},function(){f()})},this.getAmbulanceDetails=function(c,d,e){var f=b.getUrl("GET_AMBULANCE_DETAILS");a.postData(f,c,function(a){d(a)},function(){e()})},this.getAmbulanceRequestDetails=function(c,d,e){var f=b.getUrl("GET_AMBULANCE_REQUEST_DETAILS");a.postData(f,c,function(a){d(a)},function(){e()})},this.getAmbulanceDetailsForDriverMap=function(c,d,e){var f=b.getParameterizedUrl("GET_AMBULANCE_DETAILS_FOR_DRIVER",c);a.getData(f,null,function(a){d(a)},function(a){e()})},this.updateRequestStatus=function(c,e,f,g){var h={};d.isFieldEmpty(c.ambulanceRequestId)?h.ambulanceRequestId=c.id:h.ambulanceRequestId=c.ambulanceRequestId,h.ambulanceId=c.ambulanceId,h.ambulanceRequestStatus=e,h.cancellationReason=null,d.isNullOrEmpty(c.destinationCityName)||(h.cityName=c.destinationCityName),d.isNullOrEmpty(c.stateName)||(h.stateName=c.stateName),d.isNullOrEmpty(c.countryName)||(h.countryName=c.countryName),d.isFieldEmpty(c.destinationPostalCode)||(h.postalCode=c.destinationPostalCode),d.isFieldEmpty(c.tripToLattitude)||(h.destinationLattitude=c.tripToLattitude),d.isFieldEmpty(c.tripToLongitude)||(h.destinationLongitude=c.tripToLongitude);var i=b.getUrl("UPDATE_AMBULANCE_REQUEST_STATUS");a.putData(i,h,function(a){f(a)},function(a){g()})},this.getMyCurrentRequestDetails=function(c,e,f){var g={};d.isNullOrEmpty(c.requesterName)?d.isFieldEmpty(c.driverId)||(g.driverId=c.driverId):(g.name=c.requesterName,g.email=c.requesterEmail,g.contact=c.requesterContact);var h=b.getUrl("GET_MY_CURRENT_REQUEST_DETAILS");a.postData(h,g,function(a){e(a)},function(a){f()})}}]),angular.module("paripal.callAmbulance").service("placeAmbulanceRequestService",["httpService","urlService","dateconvertor","utilService","baseService","notify","$translate",function(a,b,c,d,e,f,g){"use strict";this.storeAmbulanceInLocalStorage=function(a){var b=[],c=2,f=e.getLoggedInUser();if(d.isEmpty(f)||(c=f.id),d.isEmpty(localStorage.getItem("WSAmbulanceDetails"))||(b=angular.fromJson(localStorage.getItem("WSAmbulanceDetails")),angular.forEach(b,function(a,d){a.userId==c&&b.splice(d,1)})),b||(b=[]),a){var g={};g.userId=c,g.isRequestPlaced=!0,b.push(g)}localStorage.setItem("WSAmbulanceDetails",angular.toJson(b))},this.getAmbulanceList=function(c,e,f){var g=angular.copy(c);d.isEmpty(g.ambulanceType)||(g.ambulanceType=g.ambulanceType.code);var h=b.getUrl("GET_PLACE_REQUEST_GRID_DATA");a.postData(h,g,function(a){a&&a.data&&e(a.data)},function(){f()})},this.placeAmbulanceRequest=function(c,e,f,g,h,i,j,k,l){var m={};d.isEmpty(c)||(m.reqFromLongitude=c.requesterLongitude,m.reqFromLattitude=c.requesterLattitude,d.isFieldEmpty(c.ambulanceType)||(m.ambulanceType=c.ambulanceType),d.isEmpty(c.emergency)||(m.emergency=c.emergency),d.isNullOrEmpty(c.whetherRaisedByAdmin)||(m.whetherRaisedByAdmin=c.whetherRaisedByAdmin)),d.isEmpty(h)||(d.isFieldEmpty(h.requesterName)||(m.requesterName=h.requesterName),d.isFieldEmpty(h.requesterContact)||(m.requesterContact=h.requesterContact),d.isFieldEmpty(h.requesterEmail)||(m.requesterEmail=h.requesterEmail)),d.isEmpty(f)||(d.isEmpty(f.addressLine1)?(d.isFieldEmpty(f.cityName)||(m.city=f.cityName),!d.isFieldEmpty(f.stateName),d.isFieldEmpty(f.countryName)||(m.country=f.countryName),d.isFieldEmpty(h.currentLocationAddress)||(
//requestObject.address = userAddressInfo.userAddress;
m.address=h.currentLocationAddress)):(d.isFieldEmpty(f.city)||(m.city=f.city.value),d.isFieldEmpty(f.state)||(m.state=f.state.value),d.isFieldEmpty(f.country)||(m.country=f.country.value),d.isFieldEmpty(f.addressLine1)||(m.address=f.addressLine1),d.isFieldEmpty(f.postalCode)||(m.pincode=f.postalCode))),d.isEmpty(e)||(m.orgLocIds=angular.copy(e)),d.isFieldEmpty(g)||(m.requester={id:g}),d.isEmpty(j)||(m.emergency={id:j.emergency.id},m.emergencyAdmission={id:j.id}),m.noOfPatients=i;var n=b.getUrl("PLACE_AMBULANCE_REQUEST");a.postData(n,m,function(a){a&&a.data&&k(a.data)},function(){l()})},this.cancelAmbulanceRequest=function(c,e,h,i){var j={};d.isEmpty(e)||(d.isEmpty(e.userAddressInfo)||(j.longitude=e.userAddressInfo.longitude,j.lattitude=e.userAddressInfo.lattitude,j.city=e.userAddressInfo.cityName,/*object.state = cancellationData.userAddressInfo.stateName;*/
j.country=e.userAddressInfo.countryName,j.address=e.userAddressInfo.userAddress),d.isEmpty(e.requestDetails)||(e.isAllocationNull||(j.ambulanceRequestAllocationId=e.requestDetails.ambulanceRequestAllocationId),j.ambulanceRequestId=e.requestDetails.ambulanceRequestId,j.ambulanceId=e.requestDetails.ambulanceId),d.isEmpty(e.userDetails)||(j.requesterName=e.userDetails.requesterName,j.requesterEmail=e.userDetails.requesterEmail,j.requesterContact=e.userDetails.requesterContact),e&&e.whetherDriver&&(j.whetherDriver=!0)),j.cancellationReasonId=c.id,a.postData(b.getUrl("CANCEL_AMBULANCE_REQUEST"),j,function(a){a&&a&&(h(a),f("success",g.instant("AMBULANCE_REQUEST_IS_CANCELLED")))},function(){i()})}}]),angular.module("paripal.callAmbulance").service("ambulanceRequestListService",["httpService","urlService","utilService","dateconvertor","notify",function(a,b,c,d,e){this.fetchRecords=function(e,f,g,h,i){var j={};angular.copy(e,j),c.isFieldEmpty(e.requestDateFrom)||(j.requestDateFrom=d.convertToServerDate(e.requestDateFrom)),c.isFieldEmpty(e.requestDateTill)||(j.requestDateTill=d.convertToServerDate(e.requestDateTill)),c.isFieldEmpty(f.ambulanceType)||(j.ambulanceType=f.ambulanceType.dataValue),c.isEmpty(f.requestStatus)||(j.requestStatus=f.requestStatus.dataValue),c.isEmpty(f.status)||(j.requestStatus=f.status),c.isFieldEmpty(e.orgLoc)||(j.orgLocId=e.orgLoc.data.id),c.isFieldEmpty(e.requesterId)||(j.requesterId=e.requesterId.id),c.isFieldEmpty(e.ambulanceId)||(j.ambulanceId=e.ambulanceId),/*requestData.driverId = driverId;*/
c.isFieldEmpty(e.driverId)||(j.driverId=e.driverId),c.isFieldEmpty(e.pageNumber)||(j.pageNumber=e.pageNumber),c.isFieldEmpty(e.recordsPerPage)||(j.recordsPerPage=e.recordsPerPage),delete j.orgLoc,a.postData(b.getUrl("FIND_AMBULANCE_REQUESTS"),j,function(a){h(a.data)},function(){})},this.assignRequest=function(c,d,e){var f={};f.ambulanceId=c,f.ambulanceRequestId=d,a.postData(b.getUrl("ASSIGN_AMBULANCE_REQUEST"),f,function(a){e(a.data)},function(){})},this.getAmbulanceDetailByDriverId=function(c,d){var e={};e.driverId=c,a.getData(b.getParameterizedUrl("GET_AMBULANCE_BY_DRIVER_ID",e),null,function(a){d(a.data)},function(){})},this.checkOnTheWayAmbulance=function(c,d){var e={};e.driverId=c,a.getData(b.getParameterizedUrl("GET_ON_THE_WAY_AMBULANCE_BY_DRIVER_ID",e),null,function(a){d(a.data)},function(){})},this.searchAmbulanceRequestAllocation=function(d,e,f,g,h){var i={};i.ambulanceRequestId=f,c.isEmpty(e.requestAllocationStatus)||c.isEmpty(e.requestAllocationStatus.dataValue)||(i.requestAllocationStatusId=e.requestAllocationStatus.dataValue.id),c.isFieldEmpty(d.pageNumber)||(i.pageNumber=d.pageNumber),c.isFieldEmpty(d.recordsPerPage)||(i.recordsPerPage=d.recordsPerPage),a.postData(b.getUrl("FIND_AMBULANCE_REQUESTS_ALLOCATION"),i,function(a){a.data&&a.data.data&&g(a.data.data)},function(a){h(a)})},this.requesterPickedUp=function(c,d,e,f,g){var h={};h.ambulanceRequestId=c.ambulanceRequestId,h.ambulanceId=c.ambulanceId,h.ambulanceRequestAllocationId=c.ambulanceRequestAllocationId,h.noOfPatientsPicked=e,h.longitude=d.longitude,h.lattitude=d.lattitude,h.city=d.cityName,/*requestData.state = userInfo.ambulanceRequestId;*/
h.country=d.countryName,h.address=d.userAddress,a.postData(b.getUrl("REQUESTER_PICKED_UP"),h,function(a){f(a.data)},function(a){g(a)})},this.requesterDropped=function(c,d,e,f){var g={};g.ambulanceRequestId=c.ambulanceRequestId,g.ambulanceId=c.ambulanceId,g.ambulanceRequestAllocationId=c.ambulanceRequestAllocationId,g.longitude=d.longitude,g.lattitude=d.lattitude,g.city=d.cityName,/*requestData.state = userInfo.ambulanceRequestId;*/
g.country=d.countryName,g.address=d.userAddress,a.postData(b.getUrl("REQUESTER_DROPPED"),g,function(a){e(a.data)},function(a){f(a)})},this.backToLocation=function(c,d,e){var f={};f.ambulanceId=c.ambulanceId,a.postData(b.getUrl("DRIVER_BACK_TO_LOCATION"),f,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.complaintsModule").controller("AttachmentListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","serverSidePagination","baseService","utilService","attachmentListService","manageComplaintsService","manageAttachmentService","fileOperations","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSComplaintAttachmentList=[],a.complaintAttachmentSpinner=!1,a.criteriaForm={},a.setForm=function(b){a.criteriaForm=b.listForm,a.searchAttachmentDetails()},a.$watch("searchCriteria.complaintCode",function(b,c){b||(a.WSComplaintAttachmentList=[])},!0),
//Search follow up
a.searchAttachmentDetails=function(){a.criteriaForm.$valid&&(a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.complaintAttachmentSpinner=!0,l.searchAttachmentDetails(a.searchCriteria,a.userId,a.whetherOrgUser,function(b){a.complaintAttachmentSpinner=!1,a.WSComplaintAttachmentList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.complaintAttachmentSpinner=!1}))},
//clear search
a.clear=function(){a.searchCriteria={},a.WSComplaintAttachmentList=[]},
//Dispaly add/edit/view complaints attachment form
a.addComplaintAttachment=function(b,e){var f={};f=k.isEmpty(a.searchCriteria.complaintCode)?{type:e,complaintId:c.complaintId,complaintCode:c.complaintCode}:{type:e,complaintId:a.searchCriteria.complaintCode.id,complaintCode:a.searchCriteria.complaintCode.value},d.go("manageComplaintAttachment",f)},
//Dispaly add/edit/view complaints attachment form
a.manageComplaintAttachment=function(a,b){if("edit"===b&&"COMPLAINT_USER_STATUS_CLOSED"!==a.complaint.userStatus.code&&"COMPLAINT_USER_STATUS_CANCELLED"!==a.complaint.userStatus.code||"view"===b){var c={type:b,complaintId:a.complaint.id,complaintCode:a.complaint.complaintCode,complaintAttachmentId:a.id};d.go("manageComplaintAttachment",c)}else f("warning",g.instant("CANNOT_EDIT_ATTACHMENT_FOR_CLOSED_OR_CANCELLED"))},a.inactiveComplaintAttachment=function(b,c,d){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){"COMPLAINT_USER_STATUS_CLOSED"!==c.complaint.userStatus.code&&"COMPLAINT_USER_STATUS_CANCELLED"!==c.complaint.userStatus.code?n.inactiveComplaintAttachment(c.id,function(b){f("success",g.instant(b.successMessage)),a.searchCriteria.complaintCode={id:c.complaint.id,value:c.complaint.complaintCode},a.searchAttachmentDetails()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))}):f("warning",g.instant("CANNOT_DEACTIVATE_ATTACHMENT_FOR_CLOSED_OR_CANCELLED"))},function(){})},a.downloadFile=function(a){if(!k.isEmpty(a)){var b=new Object;b.fileName=a.fileName,b.resourceId=a.id,b.docType=p.documentTypes.userIdDocument,b.docSubType=p.documentSubTypes.complaint,o.downloadFile(b,function(a){},function(a){})}},a.viewPrintFile=function(b,c){if(!k.isEmpty(c)){var d=new Object;d.fileName=c.fileName,d.resourceId=c.id,d.docType=p.documentTypes.userIdDocument,d.docSubType=p.documentSubTypes.complaint,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!1}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchAttachmentDetails()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchAttachmentDetails()};
//datatble config json
var q={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(q),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1,a.userId=b.loggedInUserDetails.id,a.searchCriteria.complaintCode={id:c.complaintId,value:c.complaintCode},a.complaintCode={queryUrl:"FIND_CODE_REF_BY_LOGGED_USER",queryParameter:{},jsonParameter:{userId:b.loggedInUserDetails.id,whetherOrgUser:a.whetherOrgUser,whetherCode:!0,whetherAssignedTo:!1}}},a.init()}]),angular.module("paripal.complaintsModule").controller("ComplaintsListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","complaintsListService","manageComplaintsService","featurePrivilegeConstants","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a,b,c,d,e){a.WSComplaint={},a.WSComplaint.closureReason={},a.closureReason={queryUrl:"FIND_ALL_CLOSURE_REASON",queryParameter:{},jsonParameter:{}},a.saveInactiveRaiseComplaint=function(c){c.$valid&&(a.WSComplaint.id=d.id,a.WSComplaint.version=d.version,a.WSComplaint.orgLocation={id:d.orgLocation.id,value:d.orgLocation.value},o.inactiveRaiseComplaint(a.WSComplaint,function(a){f("success",h.instant(a.successMessage)),e.searchComplaints()},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("FAILED_TO_UPDATE_RECORD")):f("error",h.instant(a.data.messages[0]))}),b.cancel())},a.cancelInactiveComplaintForm=function(){b.cancel()}}r.$inject=["$scope","$mdDialog","type","complaintObj","parentScope"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.searchCriteria.complaintType={},a.searchCriteria.registeredOnBehalfOf={},a.searchCriteria.organizationLocation={},a.searchCriteria.serviceType={},a.searchCriteria.userStatus={},a.searchCriteria.systemStatus={},a.WSComplaintsList=[],a.userStatusDisplayId=[],a.systemStatusDisplayId=[],a.userStatusList=[],a.systemStatusList=[],a.userId=null,a.whetherOrgUser=!1,a.complaintSpinner=!1,a.WSComplaint={},a.WSComplaint.id=null,a.WSComplaint.closureReason={},a.orgLocId=null,a.orgLocPermission=p.COMPLAINT_VIEW,d.params.orgLocId&&(a.searchCriteria.organizationLocation={},a.searchCriteria.organizationLocation.id=d.params.orgLocId),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,a.postHeader={headers:{orgLocPermission:a.orgLocPermission}},a.closureReason={queryUrl:"FIND_COMPLAINT_CLOSURE_REASON"},a.$watch("searchCriteria.organizationLocation",function(b,c){a.searchCriteria.complaintType={},a.searchCriteria.registeredOnBehalfOf={},b&&b.id?(a.orgLocId=b.id,a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID",queryParameter:{orgLocationId:b.id}},a.registeredOnBehalfOf={queryUrl:"FIND_REGISTER_BY_LOCATION_ID",queryParameter:{orgLocationId:b.id,whetherSubscriber:!0},jsonParameter:{}},a.$broadcast("loadSearchCriteriaComplaintType",a.complaintType)):(a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID",queryParameter:{}},a.registeredOnBehalfOf={queryUrl:"FIND_REGISTER_BY_LOCATION_ID",queryParameter:{whetherSubscriber:!0},jsonParameter:{}},a.$broadcast("loadSearchCriteriaComplaintType",a.complaintType),a.orgLocId=null)},!0),
//Search complaints
a.searchComplaints=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.complaintListSpinner=!0,n.searchComplaints(a.searchCriteria,a.userId,a.whetherOrgUser,a.postHeader,function(b){a.complaintListSpinner=!1,a.WSComplaintsList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.complaintListSpinner=!1})},
//clear search
a.clear=function(){a.searchCriteria={},a.searchComplaints()},a.addRaiseComplaints=function(a,b,c){var e={type:c,navigateFrom:"complaintsList",complaintId:null};d.go("addComplaints",e)},
//Dispaly add/edit/view complaints form
a.manageRaiseComplaints=function(a,b,c,e){if("edit"===e&&"COMPLAINT_USER_STATUS_CLOSED"!==c&&"COMPLAINT_USER_STATUS_CANCELLED"!==c||"view"===e){var g={type:e,navigateFrom:"complaintsList",complaintId:a,complaintCode:b};d.go("manageComplaints",g)}else"COMPLAINT_USER_STATUS_CLOSED"===c?f("warning",h.instant("CLOSED_CANNOT_EDIT")):"COMPLAINT_USER_STATUS_CANCELLED"===c&&f("warning",h.instant("CANCELLED_CANNOT_EDIT"))},a.viewComplaintServiceLevel=function(a,b){var c={type:b,complaintId:a.id,complaintType:a.complaintType,organizationLocation:a.orgLocation};d.go("serviceLevelList",c)},a.viewComplaintFollowUp=function(b,c){if(a.whetherOrgUser){var e={type:c,complaintId:{id:b.id,value:b.complaintCode}};d.go("followUpList",e)}else f("Warning",h.instant("INDIVIDUAL_CANNOT_VIEW_FOLLOWUP"))},a.viewComplaintAttchment=function(a,b,c){var e={type:c,complaintId:a.id,complaintCode:a.complaintCode};d.go("complaintAttachmentList",e)},a.inactiveRaiseComplaints=function(c,d,e){
//row.id,row.version,row.recordedBy.id, row.systemStatus.code
if(d)if(d.recordedBy.id===b.loggedInUserDetails.id||a.whetherOrgUser)if("COMPLAINT_SYSTEM_STATUS_CLOSED"!==d.systemStatus.code&&"COMPLAINT_SYSTEM_STATUS_CANCELLED"!==d.systemStatus.code){var i=g.confirm().title(h.instant("WARNING")).textContent(h.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(c).ok(h.instant("OK")).cancel(h.instant("CANCEL"));g.show(i).then(function(){g.show({controller:r,templateUrl:"app/modules/complaints/views/inactive-raise-complaint.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:q.dialogBox.clickOutsideToClose,locals:{type:e,complaintObj:d,parentScope:a}}).then(function(){},function(){})},function(){})}else f("warning",h.instant("CANNOT_DEACTIVATE_COMPLAINT_FOR_CLOSED_OR_CANCELLED"));else f("warning",h.instant("RECORDED_PERSON_CAN_DEACTIVE_REQUEST"))},a.getUserStatusList=function(){o.getUserStatusList(function(b){/*for(var i=0; i<successResponse.length; i++){
                    if(successResponse[i].code==="COMPLAINT_USER_STATUS_OPEN"){
                        $scope.userStatusDisplayId = successResponse[i].id;
                    }
                    $scope.userStatusList.push(successResponse[i]);
                }*/
a.userStatusList=b},function(a){})},a.getSystemStatusList=function(){o.getSystemStatusList(function(b){/*for(var i=0; i<successResponse.length; i++){
                    if(successResponse[i].code==="COMPLAINT_SYSTEM_STATUS_OPEN"){
                        $scope.systemStatusDisplayId = successResponse[i].id;
                    }
                    $scope.systemStatusList.push(successResponse[i]);
                }*/
a.systemStatusList=b},function(a){})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchComplaints()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchComplaints()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.markClosed=function(b,c,d,e){if("edit"===e&&"COMPLAINT_USER_STATUS_OPEN"===c&&"COMPLAINT_SYSTEM_STATUS_CLOSED"===d){var g={};g.userStatus="COMPLAINT_USER_STATUS_CLOSED",g.id=b,o.updateComplaint(g,function(b){a.complaintFormSpinner=!1,f("success",h.instant(b.successMessage)),a.searchComplaints()})}else"COMPLAINT_USER_STATUS_CLOSED"===c?f("warning",h.instant("CLOSED_CANNOT_EDIT")):"COMPLAINT_USER_STATUS_CANCELLED"===c&&f("warning",h.instant("CANCELLED_CANNOT_EDIT"))},a.init=function(){a.userId=b.loggedInUserDetails.id,b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?(a.whetherOrgUser=!0,a.organizationLocation={queryUrl:"FIND_SUBSCRIBER_LOCATION",queryParameter:{whetherSubscriber:!0}}):(a.whetherOrgUser=!1,a.organizationLocation={queryUrl:"SEARCH_COMPLAINT_ORG_LOCATION_FOR_INDIVIDUAL",queryParameter:{userId:a.userId}}),a.getUserStatusList(),a.getSystemStatusList(),a.searchComplaints()},a.init()}]),angular.module("paripal.complaintsModule").controller("FollowUpListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","baseService","utilService","followUpListService","manageComplaintsService","manageFollowUpService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.searchCriteria.complaintType={},a.searchCriteria.identifier={},a.searchCriteria.currentlyAssignedTo={},a.searchCriteria.organizationLocation={},a.searchCriteria.serviceType={},a.searchCriteria.userStatus={},a.searchCriteria.systemStatus={},a.WSFollowUpList=[],a.followUpListSpinner=!1,a.userStatusDisplayId=null,a.systemStatusDisplayId=null,a.userStatusList=[],a.systemStatusList=[],a.orgLocPermission=n.COMPLAINT_FOLLOW_UP_VIEW,a.postHeader={headers:{orgLocPermission:a.orgLocPermission}},a.organizationLocation={queryUrl:"FIND_SUBSCRIBER_LOCATION",queryParameter:{whetherSubscriber:!0}},a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID"},a.currentlyAssignedTo={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{whetherSubscriber:!0}},a.$watch("searchCriteria.organizationLocation",function(b,c){a.searchCriteria.complaintType={},a.searchCriteria.currentlyAssignedTo={},b&&b.id?(a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID",queryParameter:{orgLocationId:b.id}},a.currentlyAssignedTo={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{organizationLocationId:b.id,whetherSubscriber:!0}},a.$broadcast("loadSearchCriteriaComplaintType",a.complaintType)):(a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID"},a.$broadcast("loadSearchCriteriaComplaintType",a.complaintType),a.currentlyAssignedTo={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{whetherSubscriber:!0}})},!0),a.getUserStatusList=function(){l.getUserStatusList(function(b){/*for (var i = 0; i < successResponse.length; i++) {
                    if (successResponse[i].code === "COMPLAINT_USER_STATUS_OPEN") {
                        $scope.userStatusDisplayId = successResponse[i].id;
                    }
                    $scope.userStatusList.push(successResponse[i]);
                }*/
a.userStatusList=b},function(a){})},a.getSystemStatusList=function(){l.getSystemStatusList(function(b){/*for (var i = 0; i < successResponse.length; i++) {
                    if (successResponse[i].code === "COMPLAINT_SYSTEM_STATUS_OPEN") {
                        $scope.systemStatusDisplayId = successResponse[i].id;
                    }
                    $scope.systemStatusList.push(successResponse[i]);
                }*/
a.systemStatusList=b},function(a){})},
//Search follow up
a.searchFollowUpDetails=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.followUpListSpinner=!0,k.searchFollowUpDetails(a.searchCriteria,a.userId,a.whetherOrgUser,a.postHeader,function(b){a.followUpListSpinner=!1,a.WSFollowUpList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.followUpListSpinner=!1})},a.sort=function(b){a.searchFollowUpDetails(b)},
//Fetch records
a.fetchRecords=function(){a.searchFollowUpDetails()},
//clear search
a.clear=function(){a.searchCriteria={},a.searchCriteria.complaintType={},a.searchCriteria.identifier={},a.searchCriteria.currentlyAssignedTo={},a.searchCriteria.organizationLocation={},a.searchCriteria.serviceType={},a.searchCriteria.userStatus=[],a.searchCriteria.systemStatus=[],c.complaintId&&(a.disableComplaintCode=!0,a.searchCriteria.complaintCode=angular.fromJson(c.complaintId),a.searchCriteria.complaintCode.organizationLocationId=null,a.searchCriteria.complaintCode.code=null),a.searchFollowUpDetails()},a.addFollowUpDetails=function(a,c){m.getWhetherAssignedToUser(b.loggedInUserDetails.id,function(a){if(a){var b={type:c,complaintId:null,complaintFollowUpId:null};d.go("manageFollowUp",b)}else f("Warning",g.instant("NO_COMPLAINT_ASSIGNED_TO_USER"))},function(a){})},
//Dispaly add/edit/view complaints follow up form
a.manageFollowUpDetails=function(a,c){if(a){if("edit"===c){if(a.assignedFrom.id!==b.loggedInUserDetails.id)return void f("warning",g.instant("ASIGNED_PERSON_CAN_EDIT_REQUEST"));if(!a.whetherEditable)return void f("warning",g.instant("PAST_FOLLOW_UP_CANNOT_BE_COMMITED"))}var e={type:c,complaintId:a.complaint.id,complaintFollowUpId:a.id};d.go("manageFollowUp",e)}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchFollowUpDetails()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFollowUpDetails()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.getUserStatusList(),a.getSystemStatusList(),b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1,a.userId=b.loggedInUserDetails.id,c.complaintId&&(a.disableComplaintCode=!0,a.searchCriteria.complaintCode=c.complaintId),a.complaintCode={queryUrl:"FIND_CODE_REF_BY_LOGGED_USER",queryParameter:{},jsonParameter:{userId:a.userId,whetherOrgUser:a.whetherOrgUser,whetherCode:!0,whetherActive:!0}},a.searchFollowUpDetails()},a.init()}]),angular.module("paripal.complaintsModule").controller("ManageAttachmentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageAttachmentService","manageComplaintsService","fileOperations","commonConstants","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.WSComplaintAttachment={},a.WSComplaintAttachment.complainantRemarks=null,a.WSComplaintAttachment.ourRemarks=null,a.WSComplaintAttachment.document={},a.documentUploadFile=null,a.WSComplaint={},a.WSComplaint.version=null,a.WSComplaint.orgLocation={},a.WSComplaint.registeredBy={},a.WSComplaint.registeredOnBehalfOf={},a.searchCriteria={},a.searchCriteria.complaintCode={},a.isRecordedBy=!1,a.disabledFormFields=!1,a.whetherOrgUser=!1,a.attachmentFormSpinner=!1,
//$rootScope.loggedInUserDetails = baseService.getLoggedInUser();
a.isDocumentNameDisabled=!1,a.isDocumentFileDisabled=!1,a.iscomplainantRemarksDisabled=!1,a.isOurRemarkDisabled=!1,
//$rootScope.loggedInUserDetails
a.$watch("searchCriteria.complaintCode",function(b){l.isEmpty(b)?a.WSComplaint={}:b.id?a.getRaiseComplaintDetails(b.id,"add"):a.attachmentForm.complaintCode.$setValidity("required",!1,null)},!0),a.$watch("WSComplaint.registeredBy",function(b){l.isEmpty(b)?a.WSComplaint.registeredBy=null:a.attachmentForm.registeredBy.$setValidity("required",!0,null)},!0),a.$watch("WSComplaint.registeredOnBehalfOf",function(b){l.isEmpty(b)?a.WSComplaint.registeredOnBehalfOf=null:a.attachmentForm.registeredOnBehalfOf.$setValidity("required",!0,null)},!0),a.getRegisteredByList=function(b){return l.isEmpty(a.WSComplaint.orgLocation)||l.isNullOrEmpty(a.WSComplaint.orgLocation.id)?void f("warning",g.instant("SELECT_ORG_LOC_FIRST")):o.getRegisteredByList(b,a.WSComplaint.orgLocation.id,{orgLocPermission:a.orgLocPermission})},a.getRegisteredOnBehalfOfList=function(b){return l.isEmpty(a.WSComplaint.orgLocation)||l.isNullOrEmpty(a.WSComplaint.orgLocation.id)?void f("warning",g.instant("SELECT_ORG_LOC_FIRST")):o.getRegisteredOnBehalfOfList(b,a.WSComplaint.orgLocation.id,{orgLocPermission:a.orgLocPermission})},a.selectRegisteredByChanged=function(b){a.WSComplaint.registeredBy=b},a.selectRegisteredOnBehalfOfChanged=function(b){a.WSComplaint.registeredOnBehalfOf=b},a.$watch("WSComplaint.userStatus",function(b,c){l.isEmpty(b)||l.isNullOrEmpty(b.id)||a.checkFieldValidation()},!0),a.checkFieldValidation=function(){"COMPLAINT_USER_STATUS_OPEN"===a.WSComplaint.systemStatus.code&&"COMPLAINT_SYSTEM_STATUS_OPEN"===a.WSComplaint.systemStatus.code?a.isRecordedBy&&!a.whetherOrgUser?(a.isDocumentNameDisabled=!1,a.isDocumentFileDisabled=!1,a.iscomplainantRemarksDisabled=!1):!a.isRecordedBy&&a.whetherOrgUser?(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!0):a.isRecordedBy&&a.whetherOrgUser&&(a.isDocumentNameDisabled=!1,a.isDocumentFileDisabled=!1,a.iscomplainantRemarksDisabled=!1):"COMPLAINT_USER_STATUS_OPEN"===a.WSComplaint.systemStatus.code&&"COMPLAINT_SYSTEM_STATUS_CLOSED"===a.WSComplaint.systemStatus.code?a.isRecordedBy&&!a.whetherOrgUser?(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!1):!a.isRecordedBy&&a.whetherOrgUser?(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!0):a.isRecordedBy&&a.whetherOrgUser&&(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!1):"COMPLAINT_USER_STATUS_OPEN"===a.WSComplaint.systemStatus.code&&"COMPLAINT_SYSTEM_STATUS_CLOSED"!==a.WSComplaint.systemStatus.code&&(a.isRecordedBy&&!a.whetherOrgUser?(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!1):!a.isRecordedBy&&a.whetherOrgUser?(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!0):a.isRecordedBy&&a.whetherOrgUser&&(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!1)),(a.WSComplaint.currentlyAssignedTo&&a.WSComplaint.currentlyAssignedTo.id&&a.WSComplaint.currentlyAssignedTo.id===b.loggedInUserDetails.id||a.whetherOrgUser)&&(a.isOurRemarkDisabled=!1),"view"===c.type&&(a.isDocumentNameDisabled=!0,a.isDocumentFileDisabled=!0,a.iscomplainantRemarksDisabled=!1,a.isOurRemarkDisabled=!1)},a.saveDocumentDetails=function(b){b.$valid&&(a.attachmentFormSpinner=!0,a.documentUploadFile?(a.WSComplaintAttachment.document.fileName=a.documentUploadFile.name,a.WSComplaintAttachment.document.fileSize=a.documentUploadFile.size,a.WSComplaintAttachment.document.organizationLocationId=a.WSComplaint.orgLocation.id,"add"===c.type&&(a.WSComplaintAttachment.document.documentType={subType:q.documentSubTypes.complaint}),n.saveDocumentDetails(a.WSComplaintAttachment.document,c.type,function(b){a.attachmentFormSpinner=!1,a.documentUploadFile&&a.uploadFile(a.documentUploadFile,b)},function(b){a.attachmentFormSpinner=!1})):a.saveAttachmentDetails())},a.uploadFile=function(b,c){var d=new Object;d.file=b,d.orgLocId=a.WSComplaint.orgLocation.id,d.docType=q.documentTypes.complaint,d.docSubType=q.documentSubTypes.complaint,l.isNullOrEmpty(c.response)||(d.resourceId=c.response),a.attachmentFormSpinner=!0,p.uploadFile(d,function(b){var d=c.response;a.saveAttachmentDetails(d),a.attachmentFormSpinner=!1},function(b){a.attachmentFormSpinner=!1,f("Error",g.instant("ERROR_WHILE_UPLOADING"))})},
// save complaints attachment
a.saveAttachmentDetails=function(b){"add"===c.type&&(a.WSComplaintAttachment.document={id:b},a.WSComplaintAttachment.complaint={id:c.complaintId}),a.attachmentFormSpinner=!0,n.saveAttachmentDetails(a.WSComplaintAttachment,a.WSComplaint,c.type,function(b){a.attachmentFormSpinner=!1,f("success",g.instant(b.successMessage));var e={};e="add"===c.type?{complaintId:a.searchCriteria.complaintCode.id,complaintCode:a.searchCriteria.complaintCode.value}:{complaintId:a.WSComplaint.id,complaintCode:a.WSComplaint.value},d.go("complaintAttachmentList",e)},function(b){a.attachmentFormSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))})},
// Get selected complaints data
a.getRaiseComplaintDetails=function(b,c){l.isNullOrEmpty(b)||(a.attachmentFormSpinner=!0,o.getRaiseComplaintDetails(b,function(b){if(a.attachmentFormSpinner=!1,"add"===c){if("COMPLAINT_SYSTEM_STATUS_CANCELLED"===b.systemStatus.code)return f(g.instant("WARNING"),g.instant("CANNOT_ADD_ATTACHMENT_FOR_CANCELLED")),void(a.WSComplaint={});if("COMPLAINT_SYSTEM_STATUS_CLOSED"===b.systemStatus.code)return f(g.instant("WARNING"),g.instant("CANNOT_ADD_ATTACHMENT_FOR_CLOSED")),void(a.WSComplaint={})}a.setDataToAttachmentForm(b,!0)}))},
// Get selected complaints data
a.getAttachmentDetails=function(b,c){l.isNullOrEmpty(b)||(a.attachmentFormSpinner=!0,n.getAttachmentDetails(b,function(b){a.attachmentFormSpinner=!1,a.setDataToAttachmentForm(b,!1)}))},
// set selected complaint data
a.setDataToAttachmentForm=function(c,d){d?(a.WSComplaint=c,l.isEmpty(c.recordedBy)||(a.WSComplaint.recordedBy=c.recordedBy,a.WSComplaint.recordedBy.id===b.loggedInUserDetails.id&&(a.isRecordedBy=!0)),l.isEmpty(c.registeredBy)?l.isNullOrEmpty(c.registeredByName)||(a.WSComplaint.registeredBy=c.registeredByName):a.WSComplaint.registeredBy={id:c.registeredBy.id,value:c.registeredByName},l.isEmpty(c.registeredOnBehalfOf)?l.isNullOrEmpty(c.registeredOnBehalfOfName)||(a.WSComplaint.registeredOnBehalfOf=c.registeredOnBehalfOfName):a.WSComplaint.registeredOnBehalfOf={id:c.registeredOnBehalfOf.id,value:c.registeredOnBehalfOfName},c.dateRegistered&&(a.WSComplaint.dateRegistered=h("timestampToDate")(c.dateRegistered,"MM/dd/yyyy")),l.isEmpty(c.currentlyAssignedTo)||c.currentlyAssignedTo.id!==b.loggedInUserDetails.id||(a.isAssignedUser=!0)):(l.isNullOrEmpty(c.id)||(a.WSComplaintAttachment.id=c.id),l.isNullOrEmpty(c.version)||(a.WSComplaintAttachment.version=c.version),l.isNullOrEmpty(c.documentName)||(a.WSComplaintAttachment.documentName=c.documentName),l.isNullOrEmpty(c.ourRemarks)||(a.WSComplaintAttachment.ourRemarks=c.ourRemarks),l.isNullOrEmpty(c.complainantRemarks)||(a.WSComplaintAttachment.complainantRemarks=c.complainantRemarks),l.isNullOrEmpty(c.sequence)||(a.WSComplaintAttachment.sequence=c.sequence),l.isNullOrEmpty(c.complaint)||(a.WSComplaintAttachment.complaint=c.complaint),l.isEmpty(c.document)||(a.WSComplaintAttachment.document=c.document),l.isNullOrEmpty(c.document.fileName)||(a.uploadFileName=c.document.fileName))},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()},
//Init Method
a.init=function(){b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1,a.orgLocation={queryUrl:"FIND_ACCESSIBLE_ORG_LOCATION",queryParameter:{whetherOrgUser:a.whetherOrgUser},jsonParameter:{}},"add"===c.type?(a.orgLocPermission=r.COMPLAINT_ATTCH_ADD,a.pageState="add",a.isOurRemarkDisabled=!0,a.userId=b.loggedInUserDetails.id,l.isNullOrEmpty(c.complaintId)||l.isNullOrEmpty(c.complaintCode)||(a.searchCriteria.complaintCode={id:c.complaintId,value:c.complaintCode}),a.complaintCode={queryUrl:"FIND_CODE_REF_BY_LOGGED_USER",queryParameter:{},jsonParameter:{userId:b.loggedInUserDetails.id,whetherOrgUser:a.whetherOrgUser,whetherCode:!0,whetherAssignedTo:!1,whetherActive:!0}}):"edit"===c.type?(a.orgLocPermission=r.COMPLAINT_ATTCH_EDIT,
//$scope.WSComplaint.reopenedDate = $filter('timestampToDate')(new Date(), 'MM/dd/yyyy');
a.pageState="edit",a.viewMode=!1,a.getRaiseComplaintDetails(c.complaintId,c.type),a.getAttachmentDetails(c.complaintAttachmentId,c.type)):"view"===c.type&&(a.orgLocPermission=r.COMPLAINT_ATTCH_VIEW,a.pageState="view",a.viewMode=!0,a.getRaiseComplaintDetails(c.complaintId,c.type),a.getAttachmentDetails(c.complaintAttachmentId,c.type),a.disabledFormFields=!0)},a.init()}]),angular.module("paripal.complaintsModule").controller("ManageComplaintsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","$mdDialog","baseService","httpService","urlService","utilService","applicationExceptionService","manageComplaintsService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.searchCriteria={},a.searchCriteria.complaintCode={},a.WSComplaint={},a.WSComplaint.version=null,a.WSComplaint.complaintCode=null,a.WSComplaint.complaintRef=null,a.WSComplaint.registeredBy={},a.WSComplaint.registeredOnBehalfOf={},a.WSComplaint.orgLocation={},a.WSComplaint.recordedBy={},a.WSComplaint.currentlyAssignedTo={},a.WSComplaint.closureReason={},a.WSComplaint.userStatus={},a.WSComplaint.systemStatus={},a.WSComplaint.complaintType={},a.WSComplaint.serviceType={},a.isOrgLocExist=!1,a.disabledFormFields=!1,a.whetherOrgUser=!1,a.isRecordedBy=!1,a.isRegisterdBy=!1,a.isAssignedBy=!1,a.isRegisteredByDisabled=!1,a.isRegisteredOnBehalfDisabled=!1,a.isAssignedToDisabled=!1,a.isComplaintTypeDisabled=!1,a.isServiceTypeDisabled=!1,a.isUserStatusDisabled=!1,a.isSystemStatusDisabled=!1,a.isAddressDisabled=!1,a.isDescriptionFieldDisabled=!1,a.isShowReOpenButton=!1,a.isReopenedStatus=!1,a.isShowClosureDetails=!1,a.isSubmitDisabled=!1,a.registeredByList=[],a.registeredOnBehalfOfList=[],a.userStatusDisplayId=null,a.systemStatusDisplayId=null,a.userStatusList=[],a.systemStatusList=[],a.complaintFormSpinner=!1,a.registeredBySelectionRequired=!0,a.forSelectionRequired=!0,a.orgLocId=null,
//$rootScope.loggedInUserDetails = baseService.getLoggedInUser();
a.orgLocation={queryUrl:"FIND_SUBSCRIBER_LOCATION",queryParameter:{whetherSubscriber:!0}},a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID"},/*$scope.serviceType = {
            queryUrl: "FIND_ALL_SERVICE_TYPE"
        };*/
a.recordedBy={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{whetherSubscriber:!0}},a.currentlyAssignedTo={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{whetherSubscriber:!0}},a.closureReason={queryUrl:"FIND_ALL_CLOSURE_REASON"},a.$watch("searchCriteria.complaintCode",function(b){m.isEmpty(b)?"edit"!==c.type&&"view"!==c.type||(a.WSComplaint={},a.userStatusDisplayId=null,a.systemStatusDisplayId=null):b.id?a.getRaiseComplaintDetails(b.id,c.type):(a.WSComplaint={},a.userStatusDisplayId=null,a.systemStatusDisplayId=null)},!0),a.$watch("WSComplaint.orgLocation",function(d,e){m.isEmpty(d)?(a.orgLocId=null,a.isOrgLocExist=!1,a.WSComplaint.complaintType={},!d&&e&&a.whetherOrgUser?(a.WSComplaint.registeredBy={},a.WSComplaint.registeredOnBehalfOf={}):d||!e||a.whetherOrgUser||(a.WSComplaint.registeredOnBehalfOf={}),a.WSComplaint.currentlyAssignedTo={}):d&&d.id&&(a.isOrgLocExist=!0,a.orgLocId=d.id,"add"===c.type&&a.isLoggedInUserClient(d.id,b.loggedInUserDetails.id),a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID",queryParameter:{orgLocationId:d.id,whetherDeleted:!1}},a.currentlyAssignedTo={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{organizationLocationId:d.id,whetherSubscriber:!0}},a.recordedBy={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{organizationLocationId:d.id,whetherSubscriber:!0}},a.$broadcast("loadWSComplaintComplaintType",a.complaintType))},!0),a.$watch("WSComplaint.registeredBy",function(b){m.isEmpty(b)?a.WSComplaint.registeredBy=null:b.id?(a.WSComplaint.registeredBy=b,a.complaintForm.registeredBy.$setValidity("required",!0,null),m.isEmpty(a.WSComplaint.registeredOnBehalfOf)&&m.isNullOrEmpty(a.WSComplaint.registeredOnBehalfOf)||a.complaintForm.registeredOnBehalfOf.$setValidity("required",!0,null)):(a.WSComplaint.registeredBy=b,m.isEmpty(a.WSComplaint.registeredOnBehalfOf)||m.isNullOrEmpty(a.WSComplaint.registeredOnBehalfOf.id)?a.complaintForm.registeredOnBehalfOf.$setValidity("required",!1,null):a.complaintForm.registeredOnBehalfOf.$setValidity("required",!0,null))},!0),a.$watch("WSComplaint.registeredOnBehalfOf",function(b,d){m.isEmpty(b)?a.WSComplaint.registeredOnBehalfOf=null:b.id?(a.WSComplaint.registeredOnBehalfOf=b,a.complaintForm.registeredOnBehalfOf.$setValidity("required",!0,null),m.isEmpty(a.WSComplaint.registeredBy)&&m.isNullOrEmpty(a.WSComplaint.registeredBy)||a.complaintForm.registeredBy.$setValidity("required",!0,null),"add"===c.type&&a.getForUserHomeAddress(b.id,"HOME")):(a.WSComplaint.registeredOnBehalfOf=b,m.isEmpty(a.WSComplaint.registeredBy)||m.isNullOrEmpty(a.WSComplaint.registeredBy.id)?a.complaintForm.registeredBy.$setValidity("required",!1,null):a.complaintForm.registeredBy.$setValidity("required",!0,null))},!0),a.$watch("WSComplaint.userStatus",function(b,c){m.isEmpty(b)||m.isNullOrEmpty(b.id)||a.checkFieldValidation()},!0),a.$watch("WSComplaint.systemStatus",function(b,c){m.isEmpty(b)||m.isNullOrEmpty(b.id)||a.checkFieldValidation()},!0),a.checkFieldValidation=function(){"add"===c.type||"edit"===c.type?m.isEmpty(a.WSComplaint.userStatus)||m.isNullOrEmpty(a.WSComplaint.systemStatus)||("COMPLAINT_USER_STATUS_OPEN"===a.WSComplaint.userStatus.code&&"COMPLAINT_SYSTEM_STATUS_OPEN"===a.WSComplaint.systemStatus.code?m.isEmpty(a.WSComplaint.currentlyAssignedTo)&&(a.isRegisterdBy||a.isRecordedBy||a.whetherOrgUser)?(a.isRegisteredByDisabled=!0,a.isRegisteredOnBehalfDisabled=!1,a.isComplaintTypeDisabled=!1,a.isServiceTypeDisabled=!1,a.whetherOrgUser?a.isAssignedToDisabled=!1:a.isAssignedToDisabled=!0,a.isUserStatusDisabled=!0,a.isSystemStatusDisabled=!0,a.isAddressDisabled=!1,a.isDescriptionFieldDisabled=!1,a.isShowReOpenButton=!1,a.isReopenedStatus=!1,a.isShowClosureDetails=!1):m.isEmpty(a.WSComplaint.currentlyAssignedTo)?(a.isRegisteredByDisabled=!0,a.isRegisteredOnBehalfDisabled=!0,a.isAssignedToDisabled=!0,a.isComplaintTypeDisabled=!0,a.isServiceTypeDisabled=!0,a.isUserStatusDisabled=!0,a.isSystemStatusDisabled=!0,a.isAddressDisabled=!0,a.isDescriptionFieldDisabled=!0,a.isShowReOpenButton=!1,a.isReopenedStatus=!1,a.isShowClosureDetails=!1):(a.whetherOrgUser?a.isAssignedToDisabled=!1:a.isAssignedToDisabled=!0,(a.isRegisterdBy||a.isAssignedBy)&&(a.isRegisteredByDisabled=!0,a.isRegisteredOnBehalfDisabled=!1,a.isComplaintTypeDisabled=!1,a.isServiceTypeDisabled=!1,a.isUserStatusDisabled=!0,a.isSystemStatusDisabled=!0,a.isAddressDisabled=!1,a.isDescriptionFieldDisabled=!1,a.isShowReOpenButton=!1,a.isReopenedStatus=!1,a.isShowClosureDetails=!1)):"COMPLAINT_USER_STATUS_OPEN"===a.WSComplaint.userStatus.code&&"COMPLAINT_SYSTEM_STATUS_CLOSED"===a.WSComplaint.systemStatus.code?(a.isRegisteredByDisabled=!0,a.isRegisteredOnBehalfDisabled=!0,a.isAssignedToDisabled=!0,a.isComplaintTypeDisabled=!0,a.isServiceTypeDisabled=!0,a.isSystemStatusDisabled=!0,a.isAddressDisabled=!0,a.isDescriptionFieldDisabled=!0,a.isReopenedStatus=!1,a.isShowClosureDetails=!0,a.isRegisterdBy&&a.whetherOrgUser||a.isRegisterdBy&&!a.whetherOrgUser?(a.isUserStatusDisabled=!1,a.isShowReOpenButton=!0,a.isSubmitDisabled=!1):(a.isUserStatusDisabled=!0,a.isShowReOpenButton=!1,a.isSubmitDisabled=!0)):"COMPLAINT_USER_STATUS_CLOSED"===a.WSComplaint.userStatus.code&&"COMPLAINT_SYSTEM_STATUS_CLOSED"===a.WSComplaint.systemStatus.code?(a.isRegisteredByDisabled=!0,a.isRegisteredOnBehalfDisabled=!0,a.isAssignedToDisabled=!0,a.isComplaintTypeDisabled=!0,a.isServiceTypeDisabled=!0,a.isUserStatusDisabled=!1,a.isSystemStatusDisabled=!0,a.isAddressDisabled=!0,a.isDescriptionFieldDisabled=!0,a.isShowReOpenButton=!0,a.isReopenedStatus=!1,a.isShowClosureDetails=!0):(a.isRegisteredByDisabled=!0,a.isRegisteredOnBehalfDisabled=!0,a.isAssignedToDisabled=!0,a.isComplaintTypeDisabled=!0,a.isServiceTypeDisabled=!0,a.isUserStatusDisabled=!0,a.isSystemStatusDisabled=!0,a.isAddressDisabled=!0,a.isDescriptionFieldDisabled=!0,a.isShowReOpenButton=!1,a.isReopenedStatus=!1,a.isShowClosureDetails=!1)):"view"===c.type&&(a.disabledFormFields=!0,a.isShowReOpenButton=!1,a.isRegisteredByDisabled=!0,a.isRegisteredOnBehalfDisabled=!0,a.isAssignedToDisabled=!0,a.isComplaintTypeDisabled=!0,a.isServiceTypeDisabled=!0,a.isUserStatusDisabled=!0,a.isSystemStatusDisabled=!0,a.isAddressDisabled=!0,a.isDescriptionFieldDisabled=!0)},a.onUserStatusChange=function(){if(!m.isEmpty(a.WSComplaint.userStatus)&&!m.isNullOrEmpty(a.WSComplaint.userStatus.id)&&"COMPLAINT_USER_STATUS_CLOSED"===a.WSComplaint.userStatus.code&&"COMPLAINT_SYSTEM_STATUS_OPEN"===a.WSComplaint.systemStatus.code){f("warning",g.instant("OPEN_COMPLAINT_CANT_CLOSED"));for(var b=0;b<a.userStatusList.length;b++)if("COMPLAINT_USER_STATUS_OPEN"===a.userStatusList[b].code){a.userStatusDisplayId=a.userStatusList[b].id,a.WSComplaint.userStatus=a.userStatusList[b];break}}},a.getRegisteredByList=function(b){var c=null;return m.isEmpty(a.WSComplaint.orgLocation)||m.isNullOrEmpty(a.WSComplaint.orgLocation.id)||(c=a.WSComplaint.orgLocation.id),o.getRegisteredByList(b,c,{orgLocPermission:a.orgLocPermission})},a.getRegisteredOnBehalfOfList=function(b){var c=null;return m.isEmpty(a.WSComplaint.orgLocation)||m.isNullOrEmpty(a.WSComplaint.orgLocation.id)||(c=a.WSComplaint.orgLocation.id),o.getRegisteredOnBehalfOfList(b,c,{orgLocPermission:a.orgLocPermission})},a.selectRegisteredByChanged=function(b){a.WSComplaint.registeredBy=b},a.selectRegisteredOnBehalfOfChanged=function(b){a.WSComplaint.registeredOnBehalfOf=b},a.getForUserHomeAddress=function(b,c){m.isNullOrEmpty(b)||o.getForUserHomeAddress(b,c,function(b){if(b&&b.data){var c=b.data,d="";m.isNullOrEmpty(c.addressLine1)||(d+=c.addressLine1+", "),m.isNullOrEmpty(c.addressLine2)||(d+=c.addressLine2+", "),m.isNullOrEmpty(c.addressLine3)||(d+=c.addressLine3+", "),m.isNullOrEmpty(c.landmark)||(d+=c.landmark+", "),m.isEmpty(c.city)||m.isNullOrEmpty(c.city.value)||(d+=c.city.value+", "),m.isEmpty(c.district)||m.isNullOrEmpty(c.district.value)||(d+=c.district.value+", "),m.isEmpty(c.state)||m.isNullOrEmpty(c.state.value)||(d+=c.state.value+", "),m.isEmpty(c.country)||m.isNullOrEmpty(c.country.value)||(d+=c.country.value+", "),m.isNullOrEmpty(c.postalCode)||(d+=c.postalCode+", "),d=d.substring(0,d.length-2),a.WSComplaint.addressOfComplainant=d}else a.WSComplaint.addressOfComplainant=null},function(b){a.WSComplaint.addressOfComplainant=null})},a.getUserStatusList=function(){o.getUserStatusList(function(b){for(var d=0;d<b.length;d++)"add"===c.type?"COMPLAINT_USER_STATUS_OPEN"===b[d].code&&(a.userStatusList.push(b[d]),a.userStatusDisplayId=b[d].id):"edit"===c.type?"COMPLAINT_USER_STATUS_CANCELLED"!==b[d].code&&a.userStatusList.push(b[d]):a.userStatusList.push(b[d])},function(a){})},a.getSystemStatusList=function(){o.getSystemStatusList(function(b){for(var d=0;d<b.length;d++)"add"===c.type?"COMPLAINT_SYSTEM_STATUS_OPEN"===b[d].code&&(a.systemStatusList.push(b[d]),a.systemStatusDisplayId=b[d].id):a.systemStatusList.push(b[d])},function(a){})},
// save complaints
a.saveRaiseComplaints=function(b){b.$valid&&(a.complaintFormSpinner=!0,o.saveRaiseComplaints(a.WSComplaint,c.type,function(b){a.complaintFormSpinner=!1,f("success",g.instant(b.successMessage)),c=j.getStateParamsFromLocalStarage(c,"complaintsList"),m.isEmpty(c)||"complaintsList"!==c.navigateFrom?d.go("home.view"):d.go("complaintsList",c)},function(b){a.complaintFormSpinner=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))}))},
// Get selected complaints data
a.getRaiseComplaintDetails=function(b,c){m.isNullOrEmpty(b)||(a.complaintFormSpinner=!0,o.getRaiseComplaintDetails(b,function(b){a.complaintFormSpinner=!1,a.setDataToComplaintForm(b)}))},a.isLoggedInUserClient=function(c,d){m.isNullOrEmpty(c)||o.isLoggedInUserClient(c,d,function(c){c.data?a.WSComplaint.registeredOnBehalfOf={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName+"-"+b.loggedInUserDetails.userCode}:a.WSComplaint.registeredOnBehalfOf={}})},
// set selected complaint data
a.setDataToComplaintForm=function(c){m.isEmpty(c)||(
//delete responseData.organizationLocationId;
m.isNullOrEmpty(c.id)||(a.WSComplaint.id=c.id),m.isNullOrEmpty(c.complaintCode)||(a.WSComplaint.complaintCode=c.complaintCode),m.isNullOrEmpty(c.version)||(a.WSComplaint.version=c.version),m.isEmpty(c.orgLocation)||(a.WSComplaint.orgLocation={},a.WSComplaint.orgLocation={id:c.orgLocation.id,value:c.orgLocation.value}),m.isEmpty(c.recordedBy)||(a.WSComplaint.recordedBy=c.recordedBy,a.WSComplaint.recordedBy.id===b.loggedInUserDetails.id&&(a.isRecordedBy=!0)),m.isEmpty(c.registeredBy)?m.isNullOrEmpty(c.registeredByName)||(a.WSComplaint.registeredBy=c.registeredByName):(a.WSComplaint.registeredBy=c.registeredBy,a.WSComplaint.registeredBy.id===b.loggedInUserDetails.id&&(a.isRegisterdBy=!0)),m.isEmpty(c.registeredOnBehalfOf)?m.isNullOrEmpty(c.registeredOnBehalfOfName)||(a.WSComplaint.registeredOnBehalfOf=c.registeredOnBehalfOfName):a.WSComplaint.registeredOnBehalfOf=c.registeredOnBehalfOf,m.isNullOrEmpty(c.complaintRef)||(a.WSComplaint.complaintRef=c.complaintRef),m.isNullOrEmpty(c.userStatus)||(a.WSComplaint.userStatus=c.userStatus,a.userStatusDisplayId=c.userStatus.id),m.isNullOrEmpty(c.systemStatus)||(a.WSComplaint.systemStatus=c.systemStatus,a.systemStatusDisplayId=c.systemStatus.id),m.isEmpty(c.currentlyAssignedTo)||(a.WSComplaint.currentlyAssignedTo=c.currentlyAssignedTo,a.WSComplaint.currentlyAssignedTo.id===b.loggedInUserDetails.id&&(a.isAssignedBy=!0)),m.isEmpty(c.complaintType)||(a.WSComplaint.complaintType=c.complaintType),m.isEmpty(c.serviceTypeGroup)||(a.WSComplaint.serviceTypeGroup={id:c.serviceTypeGroup,value:g.instant(c.serviceTypeGroup)}),m.isEmpty(c.serviceType)||(a.WSComplaint.serviceType=c.serviceType),c.dateRegistered&&(a.WSComplaint.dateRegistered=h("timestampToDate")(c.dateRegistered,"MM/dd/yyyy")),c.reopenedDate?(a.isReopenedStatus=!0,a.WSComplaint.reopenedDate=h("timestampToDate")(c.reopenedDate,"MM/dd/yyyy")):a.isReopenedStatus=!1,c.closedDate?(a.WSComplaint.closedDate=h("timestampToDate")(c.closedDate,"MM/dd/yyyy"),a.isShowClosureDetails=!0):a.isShowClosureDetails=!1,m.isNullOrEmpty(c.complaintDescription)||(a.WSComplaint.complaintDescription=c.complaintDescription),m.isNullOrEmpty(c.addressOfComplainant)||(a.WSComplaint.addressOfComplainant=c.addressOfComplainant),m.isNullOrEmpty(c.closureRemarks)||(a.WSComplaint.closureRemarks=c.closureRemarks),m.isEmpty(c.closureReason)||(a.WSComplaint.closureReason=c.closureReason))},a.reOpenComplaintRequest=function(b,c){var d=i.confirm().title(g.instant("WARNING")).textContent(g.instant("REOPEN_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));i.show(d).then(function(){a.complaintFormSpinner=!0,o.reOpenComplaintRequest(a.WSComplaint,function(b){a.complaintFormSpinner=!1,f("success",g.instant(b.successMessage)),a.cancel()},function(b){a.complaintFormSpinner=!1,a.cancel(),m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))})},function(){})},
// on cancel forward to search list
a.cancel=function(){m.goBackToPrevState()},
//Init Method
a.init=function(){if(b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1,a.getSystemStatusList(),a.getUserStatusList(),"add"===c.type){a.orgLocPermission=p.COMPLAINT_ADD,a.isRecordedBy=!0,a.WSComplaint.recordedBy={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName+"-"+b.loggedInUserDetails.userCode},a.WSComplaint.registeredBy={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName+"-"+b.loggedInUserDetails.userCode},/*$scope.WSComplaint.registeredOnBehalfOf = {
                    id: $rootScope.loggedInUserDetails.id,
                    value: $rootScope.loggedInUserDetails.displayName
                };*/
a.WSComplaint.dateRegistered=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.pageState="add";var d=j.getDefaultOrgLocation();m.isFieldEmpty(d)||(a.WSComplaint.orgLocation={id:d.orgLoc.id,value:d.orgLoc.value}),0==a.whetherOrgUser&&(a.WSComplaint.registeredOnBehalfOf={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName+"-"+b.loggedInUserDetails.userCode})}else"edit"===c.type?(a.orgLocPermission=p.COMPLAINT_EDIT,a.complaintCode={queryUrl:"FIND_CODE_REF_BY_LOGGED_USER",queryParameter:{},jsonParameter:{userId:b.loggedInUserDetails.id,whetherOrgUser:a.whetherOrgUser,whetherCode:!0,whetherActive:!0}},a.isUserStatusDisabled=!0,a.pageState="edit",a.searchCriteria.complaintCode={id:c.complaintId,value:c.complaintCode}):"view"===c.type&&(a.orgLocPermission=p.COMPLAINT_VIEW,a.complaintCode={queryUrl:"FIND_CODE_REF_BY_LOGGED_USER",queryParameter:{},jsonParameter:{userId:b.loggedInUserDetails.id,whetherOrgUser:a.whetherOrgUser,whetherCode:!0}},a.pageState="view",a.disabledFormFields=!0,a.isUserStatusDisabled=!0,a.isDescriptionFieldDisabled=!0,a.searchCriteria.complaintCode={id:c.complaintId,value:c.complaintCode})},a.init()}]),angular.module("paripal.complaintsModule").controller("ManageFollowUpCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageFollowUpService","manageComplaintsService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.WSComplaintFollowUp={},a.WSComplaintFollowUp.assignedFrom={},a.WSComplaintFollowUp.reassignedTo={},a.WSComplaintFollowUp.systemStatus={},a.WSComplaintFollowUp.whetherEditable=!1,a.searchCriteria={},a.searchCriteria.complaintCode={},a.WSComplaint={},a.WSComplaint.version=null,a.WSComplaint.complaintCode=null,a.WSComplaint.registeredBy={},a.WSComplaint.currentlyAssignedTo={},a.WSComplaint.orgLocation={},a.WSComplaint.systemStatus=null,a.WSComplaint.closureReason={},a.disabledFormFields=!1,a.whetherOrgUser=!1,a.isSystemStatusDisabled=!0,a.isShowClosureDetails=!1,a.isActionDateRequired=!1,a.systemStatusDisplayId=null,a.systemStatusList=[],a.followUpFormSpinner=!1,a.closureReason={queryUrl:"FIND_ALL_CLOSURE_REASON"},a.$watch("searchCriteria.complaintCode",function(c){l.isEmpty(c)?(a.WSComplaint={},a.systemStatusDisplayId=null,a.WSComplaintFollowUp={},a.WSComplaintFollowUp.reassignedTo={}):c.id&&(a.getRaiseComplaintDetails(c.id,"add"),a.getComplaintLatestAssignedDate(c.id,b.loggedInUserDetails.id,"add"))},!0),a.$watch("WSComplaint.orgLocation",function(b){l.isEmpty(b)||b.id&&(a.assignedFrom={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{organizationLocationId:b.id,whetherSubscriber:!0},jsonParameter:{}},a.reassignedTo={queryUrl:"FIND_ASSIGNED_BY_LOCATION_ID",queryParameter:{organizationLocationId:b.id,whetherSubscriber:!0},jsonParameter:{}})},!0),a.$watch("WSComplaint.registeredBy",function(b){l.isEmpty(b)?a.WSComplaint.registeredBy=null:a.followUpform.registeredBy.$setValidity("required",!0,null)},!0),a.$watch("WSComplaintFollowUp.actionTaken",function(b){l.isNullOrEmpty(b)?a.isActionDateRequired=!1:a.isActionDateRequired=!0},!0),a.$watch("WSComplaintFollowUp.reassignedTo",function(b){b&&b.id?(a.WSComplaintFollowUp.complaintClosed=!1,a.WSComplaintFollowUp.reassignedOn=h("timestampToDate")(new Date,"MM/dd/yyyy")):a.WSComplaintFollowUp.reassignedOn=null},!0),a.$watch("WSComplaintFollowUp.complaintClosed",function(b){!l.isNullOrEmpty(b)&&b?(a.WSComplaintFollowUp.reassignedTo={},a.isShowClosureDetails=!0,l.isNullOrEmpty(a.WSComplaint.closedDate)&&(a.WSComplaint.closedDate=h("timestampToDate")(new Date,"MM/dd/yyyy"))):(a.isShowClosureDetails=!1,a.WSComplaint.closureReason={},a.WSComplaint.closedDate=null,a.WSComplaint.closureRemarks=null)},!0),a.getRegisteredByList=function(b){/*if (!utilService.isEmpty($scope.WSComplaint.orgLocation) && !utilService.isNullOrEmpty($scope.WSComplaint.orgLocation.id)) {
                return manageComplaintsService.getRegisteredByList(searchText, $scope.WSComplaint.orgLocation.id);

            } else {
                notify("warning", $translate.instant("SELECT_ORG_LOC_FIRST"));
            }*/
return o.getRegisteredByList(b,WSComplaint.orgLocation.id,{orgLocPermission:a.orgLocPermission})},a.selectRegisteredByChanged=function(b){a.WSComplaint.registeredBy=b},a.getSystemStatusList=function(){o.getSystemStatusList(function(b){a.systemStatusList=b},function(a){})},
// save complaints
a.saveFollowUpDetails=function(b){return l.isEmpty(a.WSComplaintFollowUp.assignedFrom)||l.isEmpty(a.WSComplaintFollowUp.reassignedTo)||a.WSComplaintFollowUp.assignedFrom.id!==a.WSComplaintFollowUp.reassignedTo.id?void(b.$valid&&(a.followUpFormSpinner=!0,n.saveFollowUpDetails(a.WSComplaintFollowUp,a.WSComplaint,c.type,function(b){a.followUpFormSpinner=!1,f("success",g.instant(b.successMessage)),/*$state.go("followUpList", $stateParams);*/
l.goBackToPrevState()},function(b){a.followUpFormSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))}))):(f("Warning",g.instant("REASSIGNED_TO_NOT_SAME")),void(a.WSComplaintFollowUp.reassignedTo={}))},
// Get selected complaints assigned data
a.getComplaintLatestAssignedDate=function(b,c,d){l.isNullOrEmpty(b)||l.isNullOrEmpty(c)||(a.followUpFormSpinner=!0,o.getComplaintLatestAssignedDate(b,c,function(b){a.followUpFormSpinner=!1,l.isNullOrEmpty(b)||(a.WSComplaintFollowUp.assignedOn=h("timestampToDate")(b,"MM/dd/yyyy"),a.minDate=h("timestampToDate")(b,"MM/dd/yyyy"))}))},
// Get selected complaints data
a.getRaiseComplaintDetails=function(b,c){l.isNullOrEmpty(b)||(a.followUpFormSpinner=!0,o.getRaiseComplaintDetails(b,function(b){a.followUpFormSpinner=!1,a.setDataToFollowUpForm(b,c)}))},
// Get selected complaints data
a.getFollowUpDetails=function(b,c){l.isNullOrEmpty(b)||(a.followUpFormSpinner=!0,n.getFollowUpDetails(b,function(b){a.followUpFormSpinner=!1,a.setDataToFollowUpForm(b,c)}))},
// set selected complaint data
a.setDataToFollowUpForm=function(d,e){var f={};"add"===e?f=d:(f=d.complaint,l.isNullOrEmpty(d.id)||(a.WSComplaintFollowUp.id=d.id),l.isNullOrEmpty(d.version)||(a.WSComplaintFollowUp.version=d.version),l.isEmpty(d.assignedFrom)||(a.WSComplaintFollowUp.assignedFrom=d.assignedFrom),l.isEmpty(d.reassignedTo)||(a.WSComplaintFollowUp.reassignedTo=d.reassignedTo),l.isEmpty(d.systemStatus)||(a.WSComplaintFollowUp.systemStatus=d.systemStatus),d.assignedOn&&(a.WSComplaintFollowUp.assignedOn=h("timestampToDate")(d.assignedOn,"MM/dd/yyyy"),a.minDate=h("timestampToDate")(a.WSComplaintFollowUp.assignedOn,"MM/dd/yyyy")),d.reassignedOn&&(a.WSComplaintFollowUp.reassignedOn=h("timestampToDate")(d.reassignedOn,"MM/dd/yyyy")),d.actionTakenDate&&(a.WSComplaintFollowUp.actionTakenDate=h("timestampToDate")(d.actionTakenDate,"MM/dd/yyyy")),l.isNullOrEmpty(d.complaintClosed)||(a.WSComplaintFollowUp.complaintClosed=d.complaintClosed),l.isNullOrEmpty(d.actionTaken)||(a.WSComplaintFollowUp.actionTaken=d.actionTaken),l.isNullOrEmpty(d.whetherEditable)||(a.WSComplaintFollowUp.whetherEditable=d.whetherEditable)),l.isEmpty(f)||(
//delete complaint.organizationLocationId;
l.isNullOrEmpty(f.id)||(a.WSComplaint.id=f.id),l.isNullOrEmpty(f.version)||(a.WSComplaint.version=f.version),l.isNullOrEmpty(f.complaintCode)||(a.WSComplaint.complaintCode=f.complaintCode),l.isNullOrEmpty(f.complaintRef)||(a.WSComplaint.complaintRef=f.complaintRef),l.isNullOrEmpty(f.userStatus)||(a.WSComplaint.userStatus=f.userStatus),l.isNullOrEmpty(f.systemStatus)||("add"===c.type?(a.systemStatusDisplayId=f.systemStatus.id,a.WSComplaint.systemStatus=f.systemStatus):(a.systemStatusDisplayId=a.WSComplaintFollowUp.systemStatus.id,a.WSComplaint.systemStatus=a.WSComplaintFollowUp.systemStatus)),l.isEmpty(f.orgLocation)||(a.WSComplaint.orgLocation={},a.WSComplaint.orgLocation={id:f.orgLocation.id,value:f.orgLocation.value}),l.isEmpty(f.registeredBy)?l.isNullOrEmpty(f.registeredByName)||(a.WSComplaint.registeredBy=f.registeredByName):a.WSComplaint.registeredBy={id:f.registeredBy.id,value:f.registeredByName},l.isEmpty(f.recordedBy)||(a.WSComplaint.recordedBy=f.recordedBy),l.isEmpty(f.currentlyAssignedTo)?(a.WSComplaintFollowUp.assignedFrom={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName},a.WSComplaintFollowUp.assignedOn=h("timestampToDate")(new Date,"MM/dd/yyyy")):(a.WSComplaint.currentlyAssignedTo=f.currentlyAssignedTo,l.isEmpty(a.WSComplaintFollowUp.assignedFrom)&&(a.WSComplaintFollowUp.assignedFrom=f.currentlyAssignedTo)),l.isEmpty(f.complaintType)||(a.WSComplaint.complaintType=f.complaintType),l.isEmpty(f.serviceType)||(a.WSComplaint.serviceType=f.serviceType),f.dateRegistered&&(a.WSComplaint.dateRegistered=h("timestampToDate")(f.dateRegistered,"MM/dd/yyyy")),/*if (complaint.reopenedDate) {
                    $scope.isReopenedStatus = true;
                    $scope.WSComplaint.reopenedDate = $filter('timestampToDate')(complaint.reopenedDate, 'MM/dd/yyyy');

                }*/
f.closedDate&&(a.WSComplaint.closedDate=h("timestampToDate")(f.closedDate,"MM/dd/yyyy")),l.isNullOrEmpty(f.complaintDescription)||(a.WSComplaint.complaintDescription=f.complaintDescription),l.isNullOrEmpty(f.addressOfComplainant)||(a.WSComplaint.addressOfComplainant=f.addressOfComplainant),l.isNullOrEmpty(f.closureRemarks)||(a.WSComplaint.closureRemarks=f.closureRemarks),l.isEmpty(f.closureReason)||"view"!=a.pageState||(a.WSComplaint.closureReason=f.closureReason))},
// on cancel forward to search list
a.cancel=function(){l.isEmpty(c)||l.goBackToPrevState()},
//Init Method
a.init=function(){b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1,a.getSystemStatusList(),"add"===c.type?(a.orgLocPermission=p.COMPLAINT_FOLLOW_UP_ADD,a.userId=b.loggedInUserDetails.id,a.searchCriteria.complaintCode={id:c.complaintId,value:c.complaintCode},a.complaintCode={queryUrl:"FIND_ASSIGNED_COMPLAINT_CODE",queryParameter:{},jsonParameter:{userId:b.loggedInUserDetails.id,whetherOrgUser:a.whetherOrgUser,whetherCode:!0,whetherActive:!0}},a.WSComplaintFollowUp.whetherEditable=!0,a.pageState="add",a.WSComplaint.closureReason={}):"edit"===c.type?(a.orgLocPermission=p.COMPLAINT_FOLLOW_UP_EDIT,
//$scope.WSComplaint.reopenedDate = $filter('timestampToDate')(new Date(), 'MM/dd/yyyy');
a.pageState="edit",a.getFollowUpDetails(c.complaintFollowUpId,c.type),a.WSComplaint.closureReason={}):"view"===c.type&&(a.orgLocPermission=p.COMPLAINT_FOLLOW_UP_VIEW,a.pageState="view",a.getFollowUpDetails(c.complaintFollowUpId,c.type),a.disabledFormFields=!0,a.isUserStatusDisabled=!0,a.isDescriptionFieldDisabled=!0)},a.init()}]),angular.module("paripal.complaintsModule").controller("ManageServiceLevelCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageServiceLevelService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.WSComplaintServiceLevel={},a.WSComplaintServiceLevel.id=null,a.WSComplaintServiceLevel.version=null,a.WSComplaintServiceLevel.complaintType={},a.WSComplaintServiceLevel.orgLocation={},a.WSComplaintServiceLevel.dateServiceLevelSet=null,a.WSComplaintServiceLevel.periodType=g.instant("DAYS"),a.WSComplaintServiceLevel.complaintServiceLevel=null,a.disabledFormFields=!1,a.serviceLevelFormSpinner=!1,
//$rootScope.loggedInUserDetails = baseService.getLoggedInUser();
a.orgLocation={queryUrl:"FIND_SUBSCRIBER_LOCATION",queryParameter:{whetherSubscriber:!0}},a.complaintType={queryUrl:"FIND_ALL_COMPLAINT_TYPE"},a.$watch("WSComplaintServiceLevel.complaintServiceLevel",function(b,c){l.isNullOrEmpty(b)||"0"!==b||(f("warning",g.instant("SERVICE_LEVEL_MORE_THAN_ZERO")),a.WSComplaintServiceLevel.complaintServiceLevel="")}),
// save complaints service level
a.saveComplaintServiceLevel=function(b){b.$valid&&(a.serviceLevelFormSpinner=!0,n.saveComplaintServiceLevel(a.WSComplaintServiceLevel,c.type,function(b){a.serviceLevelFormSpinner=!1,f("success",g.instant(b.successMessage)),d.go("serviceLevelList",c)},function(b){a.serviceLevelFormSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))}))},
// Get selected complaints data
a.getComplaintServiceLevelDetails=function(b,c){l.isNullOrEmpty(b)||(a.serviceLevelFormSpinner=!0,n.getComplaintServiceLevelDetails(b,function(b){a.serviceLevelFormSpinner=!1,a.setDataToServiceLevelForm(b)}))},
// set selected complaint service level data
a.setDataToServiceLevelForm=function(b){l.isEmpty(b)||(a.WSComplaintServiceLevel.id=b.id,a.WSComplaintServiceLevel.version=b.version,l.isEmpty(b.complaintType)||(a.WSComplaintServiceLevel.complaintType=b.complaintType),l.isEmpty(b.orgLocation)||(a.WSComplaintServiceLevel.orgLocation=b.orgLocation),b.dateServiceLevelSet&&(a.WSComplaintServiceLevel.dateServiceLevelSet=h("timestampToDate")(b.dateServiceLevelSet,"MM/dd/yyyy")),l.isEmpty(b.periodType)||(a.WSComplaintServiceLevel.periodType=b.periodType),l.isNullOrEmpty(b.complaintServiceLevel)||(a.WSComplaintServiceLevel.complaintServiceLevel=b.complaintServiceLevel))},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()},
//Init Method
a.init=function(){b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?a.whetherOrgUser=!0:a.whetherOrgUser=!1,"add"===c.type?(a.orgLocPermission=o.COMPLAINT_SRVCLVL_ADD,l.isEmpty(c.organizationLocation)||(a.WSComplaintServiceLevel.orgLocation=c.organizationLocation),a.minDate=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.dateServiceLevelSet=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.pageState="add"):"view"===c.type&&(a.orgLocPermission=o.COMPLAINT_SRVCLVL_VIEW,a.pageState="view",a.disabledFormFields=!0,a.getComplaintServiceLevelDetails(c.complaintServiceLevelId,c.type))},a.init()}]),angular.module("paripal.complaintsModule").controller("ServiceLevelListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","serverSidePagination","baseService","utilService","serviceLevelListService","manageServiceLevelService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.searchCriteria.complaintType={},a.searchCriteria.organizationLocation={},a.WSServiceLevelList=[],a.serviceLevelSpinner=!1,a.criteriaForm={},a.complaintObj={},a.orgLocPermission=n.COMPLAINT_SRVCLVL_VIEW,a.postHeader={headers:{orgLocPermission:a.orgLocPermission}},a.$watch("searchCriteria.organizationLocation",function(b,c){a.searchCriteria.complaintType={},b&&b.id?(a.isComplaintTypeDisabled=!1,a.complaintType={queryUrl:"FIND_COMPLAINT_TYPE_BY_LOCATION_ID",queryParameter:{orgLocationId:b.id}},a.$broadcast("loadSearchCriteriaComplaintType",a.complaintType)):a.isComplaintTypeDisabled=!0},!0),a.setForm=function(b){a.criteriaForm=b.listForm,a.searchComplaintSerivceLevel()},
//Search complaints service level
a.searchComplaintSerivceLevel=function(){a.criteriaForm.$valid&&(a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,k.isFieldEmpty(d.params.organizationLocation)||(a.searchCriteria.organizationLocation=d.params.organizationLocation),a.serviceLevelSpinner=!0,l.searchComplaintSerivceLevel(a.searchCriteria,a.postHeader,function(b){a.serviceLevelSpinner=!1,a.WSServiceLevelList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.serviceLevelSpinner=!1}))},
//clear search
a.clear=function(){a.searchCriteria={},a.WSServiceLevelList=[]},
//Dispaly add/edit/view complaints service level
a.manageComplaintServiceLevel=function(b,c){if(!a.whetherOrgUser&&"add"===c)return void f("Warning",g.instant("INDIVIDUAL_CANNOT_ADD_SL"));var e={type:c,complaintServiceLevelId:b,organizationLocation:a.searchCriteria.organizationLocation};d.go("manageServiceLevel",e)},a.inactiveComplaintServiceLevel=function(b,c){if(!a.whetherOrgUser)return void f("Warning",g.instant("INDIVIDUAL_CANNOT_INACTIVE_SL"));var d=h.confirm().title(g.instant("WARNING")).textContent(g.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(d).then(function(){m.inactiveComplaintServiceLevel(c,function(b){f("success",g.instant(b.successMessage)),k.isEmpty(a.searchCriteria.organizationLocation)||a.searchComplaintSerivceLevel()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},function(){})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchComplaintSerivceLevel()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchComplaintSerivceLevel()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?(a.whetherOrgUser=!0,a.organizationLocation={queryUrl:"FIND_SUBSCRIBER_LOCATION",queryParameter:{whetherSubscriber:!0}}):(a.whetherOrgUser=!1,a.organizationLocation={queryUrl:"FIND_SL_ORG_LOCATION_FOR_INDIVIDUAL",queryParameter:{}})},a.init()}]),angular.module("paripal.complaintsModule").service("attachmentListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchAttachmentDetails=function(c,d,f,g,h){var i={};//JSON.parse(JSON.stringify(searchCriteria));
/*if (!utilService.isNullOrEmpty(userId)) {
				filterCriteria.userId = userId;
			}

			if (!utilService.isNullOrEmpty(whetherOrgUser)) {
				filterCriteria.whetherOrgUser = whetherOrgUser;
			}*/
e.isEmpty(c.complaintCode)||(i.complaintId=c.complaintCode.id),i.pageNumber=c.pageNumber,i.recordsPerPage=c.recordsPerPage,c.sorters&&(i.sorters=c.sorters),a.postData(b.getUrl("SEARCH_COMPLAINT_ATTACHMENT_LIST"),i,function(a){g(a.data)},function(a){h(a)})}}]),angular.module("paripal.complaintsModule").service("complaintsListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchComplaints=function(d,f,g,h,i,j){var k=new Object;e.isNullOrEmpty(f)||(k.userId=f),e.isNullOrEmpty(g)||(k.whetherOrgUser=g),e.isEmpty(d.complaintType)||(k.complaintTypeId=d.complaintType.id),e.isNullOrEmpty(d.registeredFromDate)||(k.registeredFromDate=c.convertToServerDate(d.registeredFromDate)),e.isNullOrEmpty(d.registeredTillDate)||(k.registeredTillDate=c.convertToServerDate(d.registeredTillDate)),e.isEmpty(d.registeredOnBehalfOf)||(e.isNullOrEmpty(d.registeredOnBehalfOf.id)?k.registeredOnBehalfOfName=d.registeredOnBehalfOf:(k.registeredOnBehalfOfId=d.registeredOnBehalfOf.id,k.registeredOnBehalfOfName=d.registeredOnBehalfOf.value)),e.isEmpty(d.organizationLocation)||(k.orgLocationId=d.organizationLocation.id),e.isEmpty(d.serviceType)||(k.serviceTypeId=d.serviceType.id),e.isEmpty(d.serviceGroup)||(k.serviceTypeGroup=d.serviceGroup.id),e.isEmpty(d.userStatus)||(k.userStatus=d.userStatus),e.isEmpty(d.systemStatus)||(k.systemStatus=d.systemStatus),e.isNullOrEmpty(d.beyondServiceLevelBy)||(k.beyondServiceLevelBy=d.beyondServiceLevelBy),k.pageNumber=d.pageNumber,k.recordsPerPage=d.recordsPerPage,d.sorters&&(k.sorters=d.sorters),a.postDataWithHeader(b.getUrl("SEARCH_COMPLAINT_LIST"),k,h,function(a){i(a.data)},function(a){j(a)})}}]),angular.module("paripal.complaintsModule").service("followUpListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchFollowUpDetails=function(d,f,g,h,i,j){var k={};//JSON.parse(JSON.stringify(searchCriteria));
e.isNullOrEmpty(f)||(k.userId=f),e.isNullOrEmpty(g)||(k.whetherOrgUser=g),e.isEmpty(d.complaintCode)||(k.complaintId=d.complaintCode.id),e.isEmpty(d.complaintType)||(k.complaintTypeId=d.complaintType.id),e.isNullOrEmpty(d.registeredFromDate)||(k.registeredFromDate=c.convertToServerDate(d.registeredFromDate)),e.isNullOrEmpty(d.registeredTillDate)||(k.registeredTillDate=c.convertToServerDate(d.registeredTillDate)),e.isEmpty(d.currentlyAssignedTo)||(k.assignedFromId=d.currentlyAssignedTo.id),e.isEmpty(d.organizationLocation)||(k.orgLocationId=d.organizationLocation.id),e.isEmpty(d.userStatus)||(k.userStatus=d.userStatus),e.isEmpty(d.systemStatus)||(k.systemStatus=d.systemStatus),k.pageNumber=d.pageNumber,k.recordsPerPage=d.recordsPerPage,d.sorters&&(k.sorters=d.sorters),a.postDataWithHeader(b.getUrl("SEARCH_COMPLAINT_FOLLOW_UP_LIST"),k,h,function(a){i(a.data)},function(a){j(a)})}}]),angular.module("paripal.complaintsModule").service("manageAttachmentService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveAttachmentDetails=function(c,d,e,f,g){var h=angular.copy(c);"add"===e?(h.version=null,h.complaint.id=d.id,h.complaint.orgLocation=d.orgLocation,a.postData(b.getUrl("ADD_COMPLAINT_ATTACHEMNT"),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)})):a.putData(b.getUrl("UPDATE_COMPLAINT_ATTACHEMNT"),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)})},this.getAttachmentDetails=function(c,d){var e={};e.complaintAttachmentId=c,a.getData(b.getParameterizedUrl("FIND_COMPLAINT_ATTACHMENT_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.saveDocumentDetails=function(c,d,e,f){"edit"===d&&null!=c.id?a.putData(b.getUrl("UPDATE_DOCUMENT_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)}):a.postData(b.getUrl("SAVE_DOCUMENT_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.inactiveComplaintAttachment=function(c,d,e){var f={};f.complaintAttachmentId=c,a.putData(b.getParameterizedUrl("INACTIVE_COMPLAINT_ATTACHEMNT_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.complaintsModule").service("manageComplaintsService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveRaiseComplaints=function(e,f,g,h){var i=angular.copy(e);d.isEmpty(e.registeredBy)||d.isNullOrEmpty(e.registeredBy.id)?(i.registeredByName=e.registeredBy,i.registeredBy=null):(i.registeredByName=e.registeredBy.value,i.registeredBy={id:e.registeredBy.id,value:e.registeredBy.value}),d.isEmpty(e.registeredOnBehalfOf)||d.isNullOrEmpty(e.registeredOnBehalfOf.id)?(i.registeredOnBehalfOfName=e.registeredOnBehalfOf,i.registeredOnBehalfOf=null):(i.registeredOnBehalfOfName=e.registeredOnBehalfOf.value,i.registeredOnBehalfOf={id:e.registeredOnBehalfOf.id,value:e.registeredOnBehalfOf.value}),d.isNullOrEmpty(e.dateRegistered)?i.dateRegistered=null:i.dateRegistered=c.convertToServerDate(e.dateRegistered),d.isNullOrEmpty(e.closedDate)?i.closedDate=null:i.closedDate=c.convertToServerDate(e.closedDate),d.isNullOrEmpty(e.reopenedDate)?i.reopenedDate=null:i.reopenedDate=c.convertToServerDate(e.reopenedDate),(d.isEmpty(e.recordedBy)||d.isNullOrEmpty(e.recordedBy.id))&&(i.recordedBy=null),(d.isEmpty(e.currentlyAssignedTo)||d.isNullOrEmpty(e.currentlyAssignedTo.id))&&(i.currentlyAssignedTo=null),(d.isEmpty(e.closureReason)||d.isNullOrEmpty(e.closureReason.id))&&(i.closureReason=null),d.isEmpty(e.serviceTypeGroup)||d.isNullOrEmpty(e.serviceTypeGroup.id)||(i.serviceTypeGroup=e.serviceTypeGroup.id),d.isNullOrEmpty(e.closureRemarks)&&(i.closureRemarks=null),"add"===f?a.postData(b.getUrl("ADD_RAISE_COMPLAINT"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)}):a.putData(b.getUrl("UPDATE_RAISE_COMPLAINT"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)})},this.inactiveRaiseComplaint=function(c,d,e){a.putData(b.getParameterizedUrl("INACTIVE_RAISE_COMPLAINT",null),c,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.reOpenComplaintRequest=function(c,d,e){var f={id:c.id,version:c.version,complaintDescription:c.complaintDescription,orgLocation:c.orgLocation};a.putData(b.getParameterizedUrl("REOPEN_RAISE_COMPLAINT",null),f,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getRaiseComplaintDetails=function(c,d){var e={};e.complaintId=c,a.getData(b.getParameterizedUrl("FIND_RAISE_COMPLAINT_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.getComplaintLatestAssignedDate=function(c,d,e){var f={};f.complaintId=c,f.userId=d,a.getData(b.getQueryParameterizedUrl("FIND_FOLLOWUP_LATEST_ASSIGNED_DATE",f),null,function(a){a&&a.data&&e(a.data)},function(a){})},this.isLoggedInUserClient=function(c,d,e){var f={};f.orgLocId=c,f.userId=d,a.getData(b.getQueryParameterizedUrl("IS_LOGGED_USER_CLIENT_BY_LOC_ID",f),null,function(a){a&&e(a)},function(a){})},this.getForUserHomeAddress=function(c,d,e,f){var g={};g.userId=c,g.addressType=d,a.getData(b.getParameterizedUrl("FIND_USER_ADDRESS_BY_USER_ID",null),g,function(a){e(a)},function(a){f(a)})},this.getRegisteredByList=function(c,e,f){var g={};return g.keyWord=c,d.isNullOrEmpty(e)||(g.orgLocationId=e),g.whetherSubscriber=!0,a.getData(b.getQueryParameterizedUrl("FIND_REGISTER_BY_LOCATION_ID",g),null,function(a){if(a&&a.data)return a.data},function(a){},f)},this.getRegisteredOnBehalfOfList=function(c,e,f){var g={};return g.searchKeyWord=c,d.isNullOrEmpty(e)||(g.organizationLocationId=e),g.whetherSubscriber=!0,a.getData(b.getParameterizedUrl("FIND_REGISTER_ON_BEHALF_BY_LOCATION_ID",g),null,function(a){if(a&&a.data)return a.data},function(a){},f)},this.getComplaintCodeRefByLoggedInUser=function(c,e,f,g,h){if(!(d.isNullOrEmpty(c)||d.isNullOrEmpty(e)||d.isNullOrEmpty(f)||d.isNullOrEmpty(h)||d.isNullOrEmpty(g))){var i={};return i.searchString=c,i.userId=e,i.whetherOrgUser=f,i.whetherOrgUser=f,i.whetherCode=h,i.whetherAssignedTo=g,a.postData(b.getParameterizedUrl("FIND_CODE_REF_BY_LOGGED_USER",null),i,function(a){if(a&&a.data)return a.data},function(a){})}},this.getUserStatusList=function(c,d){var e={};e.type="complaint_user_status",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getSystemStatusList=function(c,d){var e={};e.type="complaint_system_status",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.updateComplaint=function(c,d,e){a.putData(b.getUrl("MARK_COMPLAINT_AS_CLOSED"),c,function(a){d(a&&a.data?a.data:a)},function(a){e(a)})}}]),angular.module("paripal.complaintsModule").service("manageFollowUpService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveFollowUpDetails=function(e,f,g,h,i){var j=angular.copy(e),k=angular.copy(f);d.isNullOrEmpty(j.complaintClosed)&&(j.complaintClosed=!1),d.isNullOrEmpty(j.assignedOn)?j.assignedOn=null:j.assignedOn=c.convertToServerDate(j.assignedOn),d.isNullOrEmpty(j.reassignedOn)?j.reassignedOn=null:j.reassignedOn=c.convertToServerDate(j.reassignedOn),d.isNullOrEmpty(j.actionTakenDate)?j.actionTakenDate=null:j.actionTakenDate=c.convertToServerDate(j.actionTakenDate),d.isEmpty(j.reassignedTo)&&(j.reassignedTo=null),d.isEmpty(j.systemStatus)&&(j.systemStatus=k.systemStatus),d.isEmpty(k.registeredBy)||d.isNullOrEmpty(k.registeredBy.id)?k.registeredByName=k.registeredBy:k.registeredByName=k.registeredBy.value,d.isEmpty(k.registeredOnBehalfOf)||d.isNullOrEmpty(k.registeredOnBehalfOf.id)?k.registeredOnBehalfOfName=k.registeredOnBehalfOf:k.registeredOnBehalfOfName=k.registeredOnBehalfOf.value,d.isNullOrEmpty(k.dateRegistered)?k.dateRegistered=null:k.dateRegistered=c.convertToServerDate(k.dateRegistered),d.isNullOrEmpty(k.closedDate)?k.closedDate=null:k.closedDate=c.convertToServerDate(k.closedDate),(d.isEmpty(k.closureReason)||d.isNullOrEmpty(k.closureReason.id))&&(k.closureReason=null),d.isNullOrEmpty(k.closureRemarks)&&(k.closureRemarks=null),"add"===g?(j.version=null,j.complaint=k,a.postData(b.getUrl("ADD_COMPLAINT_FOLLOW_UP"),j,function(a){h(a&&a.data?a.data:a)},function(a){i(a)},{organizationLocationId:f.orgLocation.id})):(j.complaint=k,a.putData(b.getUrl("UPDATE_COMPLAINT_FOLLOW_UP"),j,function(a){h(a&&a.data?a.data:a)},function(a){i(a)},{organizationLocationId:f.orgLocation.id}))},this.getFollowUpDetails=function(c,d){var e={};e.complaintFollowUpId=c,a.getData(b.getParameterizedUrl("FIND_COMPLAINT_FOLLOW_UP_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.getWhetherAssignedToUser=function(c,d){var e={};e.userId=c,a.getData(b.getParameterizedUrl("FIND_WHETHER_COMPLAINT_ASSIGNED",e),null,function(a){a&&d(a.data)},function(a){})}}]),angular.module("paripal.complaintsModule").service("manageServiceLevelService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveComplaintServiceLevel=function(e,f,g,h){var i=angular.copy(e);d.isNullOrEmpty(i.dateServiceLevelSet)||(i.dateServiceLevelSet=c.convertToServerDate(i.dateServiceLevelSet)),"add"===f?a.postData(b.getUrl("ADD_COMPLAINT_SERVICE_LEVELS"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)}):a.putData(b.getUrl("UPDATE_COMPLAINT_SERVICE_LEVELS"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)})},this.inactiveComplaintServiceLevel=function(c,d,e){var f={};f.complaintServiceLevelId=c,a.putData(b.getParameterizedUrl("INACTIVE_COMPLAINT_SERVICE_LEVELS",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getComplaintServiceLevelDetails=function(c,d){var e={};e.complaintServiceLevelId=c,a.getData(b.getParameterizedUrl("FIND_COMPLAINT_SERVICE_LEVEL_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}}]),angular.module("paripal.complaintsModule").service("serviceLevelListService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.searchComplaintSerivceLevel=function(c,e,f,g){var h={};d.isEmpty(c.complaintType)||(h.complaintTypeId=c.complaintType.id),d.isEmpty(c.organizationLocation)||(h.orgLocationId=c.organizationLocation.id),h.pageNumber=c.pageNumber,h.recordsPerPage=c.recordsPerPage,c.sorters&&(h.sorters=c.sorters),a.postDataWithHeader(b.getUrl("SEARCH_COMPLAINT_SERVICE_LEVELS_LIST"),h,e,function(a){f(a.data)},function(a){g(a)})}}]),angular.module("paripal.dataSettingsModule").controller("AssociateFeeHeadCtrl",["$scope","$state","$rootScope","notify","utilService","$stateParams","$translate","associateFHService","commonConstants","$timeout","datatableconfig",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";a.associateFeeHeadObj={},a.associateFeeHeadObj.amount=null,a.isFormulaGenerater=!1,a.query={},a.formula={},a.formula.suffix="FH_",a.queryBuilder={},a.whetherColumnData=!1,a.whetherAddConditionDisabled=!0;var l=!1;a.associateFeeHeadObj.whetherMandatory=!1,a.addressValues=[],a.feeScheduleFeeHeadOptions=[{amount:"",conditionDesc:""}];var m=0,n=function(){a.commonConstants=i,o(),s(),a.findRoundOffAlgo(),f&&f.data&&t()},o=function(){a.pageState=e.isFieldEmpty(f.type)?"add":f.type,e.isFieldEmpty(f.data)?b.go("feeschedulesearch"):("edit"!==f.type&&"view"!==f.type||(
// setQueryParam();
a.associateFeeHeadObj=f.data,w(f.data.feeHeadId),B()),"add"===a.pageState&&(a.associateFeeHeadObj=f.data))};a.$on("form",function(b,c){a.conditionform=c.form}),a.feeHead={queryUrl:"GET_CURRENCY_FOR_ASSOCIATE_FEE_HEAD"},a.onCurrencyChanged=function(){a.feeHead.jsonParameter={keyword:"",locationIds:[f.data.orgLocId],currencyId:a.associateFeeHeadObj.currency.dataValue.id,feeScheduleId:f.data.feeSchedule.id},"add"===f.type&&(a.associateFeeHeadObj.feeHead={})};var p=function(){"edit"!==f.type&&"view"!==f.type||(a.associateFeeHeadObj.whetherComputed||a.associateFeeHeadObj.whetherLinked||a.associateFeeHeadObj.hasCondition?a.associateFeeHeadObj.whetherComputed||a.associateFeeHeadObj.whetherLinked||!a.associateFeeHeadObj.hasCondition?a.associateFeeHeadObj.whetherComputed&&a.associateFeeHeadObj.whetherLinked&&!a.associateFeeHeadObj.hasCondition?q("FORMULA_FEE_HEAD",!1,!0):a.associateFeeHeadObj.whetherComputed&&a.associateFeeHeadObj.whetherLinked&&a.associateFeeHeadObj.hasCondition&&(a.showCondition=!0,q("CONDITIONAL_FOLRMULA_FEE_HEAD",!1,!0),a.associateFeeHeadObj.feeScheduleFeeHeadOptions=e.checkNullProp(a.associateFeeHeadObj.feeScheduleFeeHeadOptions),r()):(q("CONDITIONAL_FIXED_AMOUNT_FEE_HEAD",!0,!1),r(),delete a.associateFeeHeadObj.formulae,delete a.associateFeeHeadObj.uiFormula):(q("FIXED_AMOUNT_FEE_HEAD",!1,!1),delete a.associateFeeHeadObj.formulae,delete a.associateFeeHeadObj.uiFormula))},q=function(b,c,d){a.selcetedCalculatable=b,a.isCondition=c,a.isFormulaGenerater=d},r=function(){e.isEmpty(a.associateFeeHeadObj.feeScheduleFeeHeadOptions)||(a.feeScheduleFeeHeadOptions=a.associateFeeHeadObj.feeScheduleFeeHeadOptions);for(var b in a.associateFeeHeadObj.feeScheduleFeeHeadOptions)a.feeScheduleFeeHeadOptions[b].conditionUIDef=JSON.parse(a.associateFeeHeadObj.feeScheduleFeeHeadOptions[b].conditionUIDef);"edit"===a.pageState&&"CONDITIONAL_FOLRMULA_FEE_HEAD"==a.selcetedCalculatable&&(a.feeScheduleFeeHead=a.feeScheduleFeeHeadOptions[0]),m=a.feeScheduleFeeHeadOptions[0].prioritySequence},s=function(){var b={isResidualOrAdhoc:a.associateFeeHeadObj.whetherResidual||a.associateFeeHeadObj.whetherAdhoc};h.findAllFeeStructures(b,function(b){a.calculatable=b},function(a){})},t=function(){var b={feeTypeId:f.data.selectedFeeType.id};h.getFeeTypeDetailsById(b,function(b){a.feeTypeDetails=b},function(a){})};a.findFormulaFeeHeads=function(){var b=e.isFieldEmpty(a.associateFeeHeadObj.currency.dataValue)?a.associateFeeHeadObj.currency.id:a.associateFeeHeadObj.currency.dataValue.id,c={feeScheduleId:a.associateFeeHeadObj.feeSchedule.id,currencyId:b,feeHeadId:a.associateFeeHeadObj.feeHead.id};h.findFormulaFeeHeads(c,function(b){a.columns=b,e.isEmpty(a.columns)?a.whetherColumnData=!1:a.whetherColumnData=!0,v()},function(a){})};var u=1,v=function(){a.whetherColumnData&&l&&1==u&&(a.$broadcast("buildTemplate",a.columns,a.query),u++)},w=function(b){h.findfeeScheduleFeeHead(b,function(b){
//added changes for cityId stateId districtId countryId
angular.forEach(b.feeScheduleFeeHeadOptions,function(a,b){var c=JSON.parse(a.conditionUIDef);angular.forEach(c.group.rules,function(a,b){if("City"==a.entityField.fieldName||"District"==a.entityField.fieldName||"State"==a.entityField.fieldName||"Country"==a.entityField.fieldName){var c=a.entityField.fieldId,d={};"cityId"==c?d.cityId=a.operand1:"stateId"==c?d.stateId=a.operand1:"districtId"==c?d.districtId=a.operand1:"countryId"==c&&(d.countryId=a.operand1),
// var reqObj = {
// [fieldName] : value.operand1  
// };
console.log(d);x(d)}})});
//var operant1Json = JSON.parse(sucessResponse.feeScheduleFeeHeadOptions[0].conditionUIDef);
for(var c in b)a.associateFeeHeadObj[c]=b[c];a.query=JSON.parse(a.associateFeeHeadObj.uiFormula),
//$scope.$broadcast('buildTemplate', null, $scope.query);
l=!0,v(),a.findFormulaFeeHeads(),p()},function(a){})},x=function(b){h.getWSObjectForAddressFields("GET_WSNAMEVALUE_ADDRESS",b,function(b){null!=b.city?a.addressValues.push(b.city):null!=b.district?a.addressValues.push(b.district):null!=b.state?a.addressValues.push(b.state):null!=b.country&&a.addressValues.push(b.country)},function(a){})};a.$watchCollection("addressValues",function(b,c){b.length>0&&angular.forEach(a.associateFeeHeadObj.feeScheduleFeeHeadOptions[0].conditionUIDef.group.rules,function(a,c){"object"!=typeof a.operand1&&angular.forEach(b,function(b,c){a.operand1==b.id&&(a.operand1=b)})})}),a.sortableOptions={stop:function(b,c){var d=[];angular.forEach(a.feeScheduleFeeHeadOptions,function(a,b){a.prioritySequence=m+b,d.push(a)}),a.feeScheduleFeeHeadOptions=d},activate:function(){},update:function(){}},a.saveAssociateFeeHead=function(b){a.feeScheduleFeeHeadOptions.length>0&&y(a.feeScheduleFeeHeadOptions),a.associateFeeHeadObj.hasCondition&&e.conditionBuilderNullCheck(a.feeScheduleFeeHeadOptions)?(a.conditionform.$submitted=!0,d("Error",g.instant("INVALID_CONDITION"))):(b.$valid&&!e.isFieldEmpty(a.conditionform)&&a.conditionform.$valid||b.$valid&&e.isFieldEmpty(a.conditionform))&&(a.associateFeeHeadObj.whetherComputed&&a.associateFeeHeadObj.whetherLinked&&!e.isFieldEmpty(a.associateFeeHeadObj.formulae)||!a.associateFeeHeadObj.whetherComputed&&!a.associateFeeHeadObj.whetherLinked?z():d("Error",g.instant("INVALID_FORMULA")))};var y=function(a){angular.forEach(a,function(a,b){a.conditionUIDef&&a.conditionUIDef.group&&a.conditionUIDef.group.rules&&a.conditionUIDef.group.rules.length>0&&angular.forEach(a.conditionUIDef.group.rules,function(a,b){"City"!=a.entityField.fieldName&&"State"!=a.entityField.fieldName&&"Country"!=a.entityField.fieldName&&"District"!=a.entityField.fieldName||"Select"!=a.entityField.fieldType||"object"!=typeof a.operand1||(a.operand1=a.operand1.id)})})},z=function(){var b={};if(c.showSpinner=!0,angular.copy(a.associateFeeHeadObj,b),b.uiFormula=angular.copy(a.query),b.organizationLocationId=f.data.orgLocId,b.feeStructure=a.selcetedCalculatable,
//added changes for update issue for conditional formula fee head
"add"===a.pageState&&(b.feeScheduleFeeHeadLinkeds=[]),e.isFieldEmpty(b.uiFormula))b.feeScheduleFeeHeadLinkeds=[];else for(var g in b.uiFormula.operands)if(!e.isFieldEmpty(b.uiFormula.operands)&&"custom"!=b.uiFormula.operands.type&&!e.isFieldEmpty(b.uiFormula.operands[g].column.colKeyId)){var i={
//id: angular.copy(response.uiFormula.operands[operand].column.colKeyId)
linkedFeeScheduleFeeHeadId:b.uiFormula.operands[g].column.feeScheduleFeeHeadId},j=$.grep(b.feeScheduleFeeHeadLinkeds,function(a){return a.linkedFeeScheduleFeeHeadId===i.linkedFeeScheduleFeeHeadId});0==j.length&&b.feeScheduleFeeHeadLinkeds.push(i)}if(e.isFieldEmpty(a.associateFeeHeadObj.currency)||(b.currency={id:a.associateFeeHeadObj.currency.dataValue.id}),a.associateFeeHeadObj.hasCondition)for(var k in a.feeScheduleFeeHeadOptions)e.isFieldEmpty(a.feeScheduleFeeHeadOptions[k])||(a.feeScheduleFeeHeadOptions[k].conditionSubCategory="DEFAULT_CATEGORY",a.feeScheduleFeeHeadOptions[k].conditionUIDef=JSON.stringify(a.feeScheduleFeeHeadOptions[k].conditionUIDef));else a.feeScheduleFeeHeadOptions=[];b.feeScheduleFeeHeadOptions=angular.copy(a.feeScheduleFeeHeadOptions),h.saveAssociateFeeHead(b,function(b){d("success",b.successMessage),c.showSpinner=!1,a.cancel()},function(a){d("error",a.data.message[0])})};a.setCalculatable=function(b){"FIXED_AMOUNT_FEE_HEAD"==b?A(!1,!1,!1,!1,!1,!1):"CONDITIONAL_FIXED_AMOUNT_FEE_HEAD"==b?(A(!0,!1,!1,!1,!1,!0),a.displayCondition(null,0),B()):"FORMULA_FEE_HEAD"==b?A(!1,!1,!0,!0,!0,!1):"CONDITIONAL_FOLRMULA_FEE_HEAD"==b&&(A(!1,!0,!0,!0,!0,!0),a.displayCondition(null,0),B()),a.associateFeeHeadObj.amount=null},a.findRoundOffAlgo=function(){h.findRoundOffAlgo(function(b){a.associateFeeHeadObj.roundOffAlgoList=angular.fromJson(b)},function(a){})};var A=function(b,c,d,e,f,g){a.isCondition=b,a.showCondition=c,a.isFormulaGenerater=d,a.associateFeeHeadObj.whetherComputed=e,a.associateFeeHeadObj.whetherLinked=f,a.associateFeeHeadObj.hasCondition=g},B=function(){c.showSpinner=!0;var b={};"CONDITIONAL_FOLRMULA_FEE_HEAD"!=a.selcetedCalculatable&&"CONDITIONAL_FIXED_AMOUNT_FEE_HEAD"!=a.selcetedCalculatable||"Pharmacy Order"!=a.feeTypeDetails.transactionType.value?(b.category="BILLING",b.subCategory="DEFAULT_CATEGORY"):(b.category="BILLING",b.subCategory="PHARMACY_ORDER"),h.getQueryBuilderColumnConf("GET_QUERY_BUILDER_GROUP_DEF",b,function(b){a.queryMetaData=b,c.showSpinner=!1},function(a){}),h.getQueryBuilderColumnConf("GET_QUERY_BUILDER_ENTITY_DEF",b,function(b){a.entityFields=b,c.showSpinner=!1},function(a){})};a.cancel=function(){e.goBackToPrevState()};var C=1;a.checkConditionValidity=function(b){a.whetherAddConditionDisabled=!1,a.displayCondition(null,b)},a.feeScheduleFeeHeadOptions=[{conditionDesc:"",amount:"",prioritySequence:C}];var D={conditionDesc:"",prioritySequence:C};a.addCondition=function(){a.whetherAddConditionDisabled=!0,
//feeScheduleFeeHead.prioritySequence = ++prioritySequence;
a.feeScheduleFeeHeadOptions.push({conditionDesc:"",amount:"",prioritySequence:++C}),a.displayCondition(null,a.feeScheduleFeeHeadOptions.length-1)},a.displayCondition=function(b,c){a.showCondition=!0,"CONDITIONAL_FOLRMULA_FEE_HEAD"==a.selcetedCalculatable&&(a.feeScheduleFeeHeadOptions=[],a.feeScheduleFeeHeadOptions.push(D)),a.feeScheduleFeeHead=a.feeScheduleFeeHeadOptions[c]};/* Data table configurations */
var E=i.gridConfigurations;a.options=k.setOptionProperties(E),n()}]),angular.module("paripal.dataSettingsModule").controller("ChangeFeeScheduleFeeHeadPriorityCtrl",["$scope","$mdDialog","filterCriteria","FeeScheduleFeeHeadService","utilService","commonConstants","datatableconfig","$translate","notify",function(a,b,c,d,e,f,g,h,i){function j(a){e.isFieldEmpty(a)||(l=a[0].scheduleSequenceOrder)}function k(){a.WSFeeScheduleFeeHead.currency.id=1}a.feeScheduleFeeHeadPriorityList=[],a.WSFeeScheduleFeeHead={},a.WSFeeScheduleFeeHead.currency={};var l,m=[],n=[];angular.copy(c,a.WSFeeScheduleFeeHead),a.enableSave=!1,a.changeCurrency=function(){d.getFeeScheduleFeeHeads(null,null,a.WSFeeScheduleFeeHead,"changePriorityScreen",function(b){angular.copy(b.data.data,m),a.feeScheduleFeeHeadPriorityList=b.data.data,n=angular.copy(b.data.data),e.isFieldEmpty(b.data)||j(b.data.data)},function(){})};var o=function(b,c,d,f){var g=!0;if(e.isEmpty(b.feeScheduleFeeHeadLinkeds))for(var j=d;j<=f&&d<f||j>=f&&d>f||d==j;j=d<f?j+1:j-1)angular.forEach(c[j].feeScheduleFeeHeadLinkeds,function(a,d){if(g&&a.linkedFeeScheduleFeeHeadId==b.id){g=!1;var e={feeHead1:c[j].feeHead.value,feeHead2:b.feeHead.value};i("error",h.instant("FEE_HEAD_DEPENDENT",e))}});else angular.forEach(b.feeScheduleFeeHeadLinkeds,function(c,e){for(var j=d;j<=f&&d<f||j>=f&&d>f||d==j;j=d<f?j+1:j-1)if(g&&c.linkedFeeScheduleFeeHeadId==a.feeScheduleFeeHeadPriorityList[j].id){g=!1;var k={feeHead1:b.feeHead.value,feeHead2:a.feeScheduleFeeHeadPriorityList[j].feeHead.value};i("error",h.instant("FEE_HEAD_DEPENDENT",k))}});return g};a.sortableOptions={stop:function(b,c){var d=[],e=c.item.sortable.index,f=c.item.sortable.dropindex,g=c.item.sortable.sourceModel,h=c.item.sortable.model;j(a.feeScheduleFeeHeadPriorityList);var i;if(i=o(h,g,e,f))angular.forEach(a.feeScheduleFeeHeadPriorityList,function(a,b){a.scheduleSequenceOrder=l+b,d.push(a)}),a.feeScheduleFeeHeadPriorityList=d,n=angular.copy(a.feeScheduleFeeHeadPriorityList);else for(var k=0;k<a.feeScheduleFeeHeadPriorityList.length;k++){var p=a.feeScheduleFeeHeadPriorityList[k];
//     index = $scope.feeScheduleFeeHeadPriorityList.indexOf(value);
k==e&&e>f?(d.push(p),d.push(a.feeScheduleFeeHeadPriorityList[f])):k==e&&e<f?(d.push(a.feeScheduleFeeHeadPriorityList[f]),d.push(p)):k==f||d.push(p)}/*angular.forEach($scope.feeScheduleFeeHeadPriorityList, function (value, key) {
                    value.scheduleSequenceOrder = startingPriority + key;
                    b.push(value);
                });*/
a.feeScheduleFeeHeadPriorityList=d,a.enableSave=!angular.equals(a.feeScheduleFeeHeadPriorityList,m)},activate:function(){},update:function(){}},a.updatePriorities=function(){d.updatePriorities(a.feeScheduleFeeHeadPriorityList,function(){b.hide()})},a.cancel=function(){b.cancel()};/* Data table configurations */
var p=f.gridConfigurations;a.options=g.setOptionProperties(p),k()}]),angular.module("paripal.billingSetupModule").controller("feeScheduleFeeHeadListCtrl",["$scope","$rootScope","datatableconfig","$state","utilService","commonConstants","featurePrivilegeConstants","serverSidePagination","httpService","$stateParams","urlService","$mdDialog","FeeScheduleFeeHeadService","notify","$mdDialog","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,l,o){a.commonConstants=f,a.filterCriteria={},/*
     * For Pagination defaults value
     * Default records per page
     */
a.currentPage=f.defaultPageNo,a.itemPerPage=f.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.status={},a.feeScheduleFeeHead={},a.today=new Date,a.mandatoryCount=0;var p=function(){a.setParamObject()};a.setParamObject=function(){e.isFieldEmpty(j.callingUrl)||"/feeschedulesearch"!==j.callingUrl&&"/associatefeehead"!==j.callingUrl||e.isFieldEmpty(j.data)?d.go("feeschedulesearch"):(a.status.open=!0,a.filterCriteria=j.data,a.filterCriteria.whetherAdhoc="ADHOC"==j.data.relationship,a.filterCriteria.feeScheduleName=j.data.scheduleName+" ( "+j.data.feeScheduleCode+" ) ",a.isEditable=s(),q(),r(),a.applyFilters())};var q=function(){a.feeHead={queryUrl:"GET_ASSOCIATE_FEE_HEAD",queryParameter:{orgLocId:j.data.organizationLocation.id}}},r=function(){var b={feescheduleId:a.filterCriteria.id};i.getData(k.getParameterizedUrl("GET_FEE_TYPE_DETAILS",b),null,function(b){e.isNullOrEmpty(b.data)||(a.filterCriteria.selectedFeeType=b.data)},function(a){})};a.applyFilters=function(){a.showSpinner=!0,m.getFeeScheduleFeeHeads(a.currentPage,a.itemPerPage,a.filterCriteria,"listingScreen",function(b){a.mandatoryCount=0,a.showSpinner=!1,a.totalItems=b.data.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.feeScheduleFeeHeads=b.data.data,angular.forEach(a.feeScheduleFeeHeads,function(b,c){b.whetherMandatory&&(a.mandatoryCount+=1)})},function(b){a.showSpinner=!1})},/*Add new Button function*/
a.addFeeHead=function(){d.go("associatefeehead",{type:"add",data:{selectedFeeType:a.filterCriteria.selectedFeeType,feeScheduleName:a.filterCriteria.feeScheduleName,feeSchedule:{id:a.filterCriteria.id},whetherAdhoc:a.filterCriteria.whetherAdhoc,whetherResidual:a.filterCriteria.whetherResidual,orgLocId:a.filterCriteria.organizationLocation.id,feeScheduleFeeHead:a.filterCriteria}})};var s=function(){return!e.isFieldEmpty(a.filterCriteria.validTill)&&e.dateComparator(a.filterCriteria.validTill,a.today,"lt")};a.editAssociatedFeeHead=function(b){d.go("associatefeehead",{type:"edit",data:{selectedFeeType:a.filterCriteria.selectedFeeType,feeScheduleName:a.filterCriteria.feeScheduleName,feeSchedule:{id:a.filterCriteria.id},whetherAdhoc:a.filterCriteria.whetherAdhoc,whetherResidual:a.filterCriteria.whetherResidual,orgLocId:a.filterCriteria.organizationLocation.id,feeScheduleFeeHead:a.filterCriteria,feeHeadId:b.id}})},a.viewAssociatedFeeHead=function(b){d.go("associatefeehead",{type:"view",data:{selectedFeeType:a.filterCriteria.selectedFeeType,feeScheduleName:a.filterCriteria.feeScheduleName,feeSchedule:{id:a.filterCriteria.id},whetherAdhoc:a.filterCriteria.whetherAdhoc,whetherResidual:a.filterCriteria.whetherResidual,orgLocId:a.filterCriteria.organizationLocation.id,feeScheduleFeeHead:a.filterCriteria,feeHeadId:b.id}})},a.changePriority=function(){l.show({controller:"ChangeFeeScheduleFeeHeadPriorityCtrl",templateUrl:"app/modules/data-settings/views/change-priority.html",parent:angular.element(document.body),locals:{filterCriteria:a.filterCriteria},clickOutsideToClose:f.dialogBox.clickOutsideToClose}).then(function(){a.applyFilters()},function(){})},a.clear=function(){d.reload()},/* Server side pagination module */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.applyFilters()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.applyFilters()},a.removeFeeHead=function(b){var c={feeHeadId:b.id};i.deleteData(k.getParameterizedUrl("DELETE_FEE_SHEDULE_FEE_HEAD",c),null,function(c){n("success",c.data.successMessage),b.whetherMandatory&&(a.mandatoryCount-=1),a.applyFilters()},function(a){/*error.data.messages.push("asdas");
error.data.messages.push("asdas");*/
/*var confirm = $mdDialog.alert()
                    .title($translate.instant('DELETE_RECORD_LABEL'))
                    .textContent(utilService.generateErrorMessage(error.data))
                    .ok($translate.instant('OK'));*/
l.show(l.alert().clickOutsideToClose(!0).title(o.instant("DELETE_RECORD_LABEL")).htmlContent(e.generateErrorMessage(a.data)).ok(o.instant("OK"))).then(function(){},function(){})},{handleError:!1})},p();/* Data table configurations */
var t=f.gridConfigurations;a.options=c.setOptionProperties(t)}]),angular.module("paripal.dataSettingsModule").controller("ManageFeeScheduleCtrl",["$scope","$state","$filter","httpService","urlService","$mdDialog","$mdMedia","notify","utilService","featurePrivilegeConstants","dateconvertor","$stateParams","$translate","commonConstants","associateFHService","$rootScope","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(){if("edit"!==l.type&&"view"!==l.type||(a.pageState=l.type,t()),"add"===l.type||i.isNullOrEmpty(l.type)){a.pageState="add",a.isValidFromDisabled=!1,a.feeScheduleObj={},a.feeScheduleObj.conditionSubCategory="DEFAULT_CATEGORY",a.feeScheduleObj.whetherActive=!1,a.feeScheduleObj.whetherResidual=!1,a.feeScheduleObj.whetherPermanent="true";var b=q.getDefaultOrgLocation();i.isFieldEmpty(b)||(a.feeScheduleObj.orgLoc={data:b.orgLoc},a.setOrgLocId())}}a.feeScheduleObj={},a.feeScheduleObj.whetherPermanent="true",a.feeScheduleObj.conditionEntityDef=null,a.feeScheduleObj.feeSchedulePaymentModes=[],a.dateObj={},a.paymentModes=[],a.isDateRquired=!1,a.currentDate=new Date,a.feeScheduleObj.conditionUIDef={},a.condition={},a.queryMetaData={entities:[{entityName:"User",entityId:"user",id:1},{entityName:"Professional",entityId:"professional",id:2}]};var s=function(){a.commonConstants=n,w(),r()},t=function(){var b={feeScheduleId:l.data.id};d.getData(e.getParameterizedUrl("GET_FEE_SCHEDULE_BY_ID",b),null,function(b){i.isNullOrEmpty(b.data)||(a.feeScheduleObj=b.data,i.dateComparator(a.feeScheduleObj.validFrom,a.currentDate,"lt")?a.isValidFromDisabled=!0:a.isValidFromDisabled=!1,a.feeScheduleObj.orgLoc={},a.feeScheduleObj.whetherPermanent=a.feeScheduleObj.whetherPermanent.toString(),a.feeScheduleObj.orgLoc.data=l.data.organizationLocation,a.feeScheduleObj.conditionUIDef=JSON.parse(a.feeScheduleObj.conditionUIDef),a.dateObj.fromDate=k.convertToViewDate(angular.copy(a.feeScheduleObj.validFrom)),a.dateObj.tillDate=k.convertToViewDate(angular.copy(a.feeScheduleObj.validTill)),a.feeScheduleObj.whetherConditional&&(a.condition.open=!0),B(),u(),a.setOrgLocId())},function(a){})},u=function(){var b={id:a.feeScheduleObj.id};d.getData(e.getParameterizedUrl("GET_FEE_SHEDULE_PAYMENT_MODES",b),null,function(b){i.isNullOrEmpty(b.data)||(a.feeScheduleObj.feeSchedulePaymentModes=b.data,v())},function(a){})},v=function(b){if(!i.isNullOrEmpty(a.feeScheduleObj.feeSchedulePaymentModes))for(var c in a.feeScheduleObj.feeSchedulePaymentModes)a.paymentModes.push(a.feeScheduleObj.feeSchedulePaymentModes[c].paymentMode)},w=function(){d.getData(e.getUrl("GET_ALL_FEE_SCHEDULE_RELATIONSHIPS"),null,function(b){i.isNullOrEmpty(b.data)||(a.relationships=b.data)},function(a){})};a.setOrgLocId=function(){i.isNullOrEmpty(a.feeScheduleObj.orgLoc)||i.isNullOrEmpty(a.feeScheduleObj.orgLoc.data)?a.orgLocId=null:(a.orgLocId=a.feeScheduleObj.orgLoc.data.id,x())},a.setFeeTypeDetails=function(b){i.isEmpty(b)||(a.feeScheduleObj.serviceType=i.isEmpty(b.serviceType)||i.isEmpty(b.serviceType.value)?null:b.serviceType.value,/* #### IMP : Hot fix for issue related to serviceGroup and serviceType #### */
"add"==a.pageState&&(a.feeScheduleObj.serviceTypeGroupEnum=i.isEmpty(b.serviceType)||i.isEmpty(b.serviceType.code)?null:i.nameConvertor(b.serviceType.code)),"add"!=a.pageState&&(i.isNullOrEmpty(b.serviceTypeGroup)||(a.feeScheduleObj.serviceTypeGroupEnum=b.serviceTypeGroup),i.isNullOrEmpty(b.feeTypeCode)||(a.feeScheduleObj.selectedFeeType=b.feeTypeCode)),a.feeScheduleObj.transactionType=b.transactionType)};var x=function(){/* #### IMP : Hot fix for issue related to serviceGroup and serviceType #### */
if("add"==a.pageState){var b={};b.locationId=a.orgLocId,/* #### IMP : Hot fix for issue related to serviceGroup and serviceType #### */
d.getData(e.getParameterizedUrl("GET_ALL_FEE_TYPE_DETAILS_BY_LOCATION",b),null,function(b){i.isEmpty(b.data)||(a.feeScheduleObj.feeTypes=b.data,"add"!=a.pageState&&y())},function(a){})}if("add"!=a.pageState){var c={};c.id=a.feeScheduleObj.feeType.id,d.getData(e.getParameterizedUrl("GET_FEE_TYPE_BY_ID",c),null,function(b){i.isEmpty(b.data)||(a.feeScheduleObj.feeTypes={},i.isNullOrEmpty(b.data.feeTypeCode)||(a.feeScheduleObj.feeTypes.feeTypeCode=b.data.feeTypeCode),i.isNullOrEmpty(b.data.id)||(a.feeScheduleObj.feeTypes.id=b.data.id),i.isNullOrEmpty(b.data.serviceType)||(a.feeScheduleObj.feeTypes.serviceType=b.data.serviceType),i.isNullOrEmpty(b.data.serviceTypeGroup)||(a.feeScheduleObj.feeTypes.serviceTypeGroup=b.data.serviceTypeGroup),i.isNullOrEmpty(b.data.transactionType)||(a.feeScheduleObj.feeTypes.transactionType=b.data.transactionType),"add"!=a.pageState&&y())},function(a){})}},y=function(){/* #### IMP : Hot fix for issue related to serviceGroup and serviceType #### */
if("add"==a.pageState){var b=jQuery.grep(a.feeScheduleObj.feeTypes,function(b){return b.feeTypeCode==a.feeScheduleObj.feeType.value});a.feeScheduleObj.selectedFeeType=b[0]}/* #### IMP : Hot fix for issue related to serviceGroup and serviceType #### */
"add"==a.pageState&&a.setFeeTypeDetails(a.feeScheduleObj.selectedFeeType),"add"!=a.pageState&&a.setFeeTypeDetails(a.feeScheduleObj.feeTypes)};a.setValidationForDate=function(){a.feeScheduleObj.whetherPermanent?a.isDateRquired=!1:a.isDateRquired=!0},a.onChangeWhetherCondition=function(){a.feeScheduleObj.whetherConditional?a.condition.open=!0:a.condition.open=!1};var z=function(b){if(b.feeSchedulePaymentModes=[],!i.isNullOrEmpty(a.paymentModes))for(var c in a.paymentModes){if(b.feeSchedulePaymentModes[c]={},i.isNullOrEmpty(a.feeScheduleObj.feeSchedulePaymentModes))b.feeSchedulePaymentModes[c].id=null,b.feeSchedulePaymentModes[c].feeScheduleId=null;else{var d=jQuery.grep(a.feeScheduleObj.feeSchedulePaymentModes,function(b){return b.paymentMode.id==a.paymentModes[c].id});i.isEmpty(d)?b.feeSchedulePaymentModes[c].feeScheduleId=a.feeScheduleObj.id:(b.feeSchedulePaymentModes[c].id=d[0].id,b.feeSchedulePaymentModes[c].feeScheduleId=d[0].feeScheduleId)}b.feeSchedulePaymentModes[c].paymentMode=a.paymentModes[c]}};a.$on("form",function(b,c){a.conditionform=c.form}),a.saveFeeSchedule=function(b){if("PARAMETER"==a.feeScheduleObj.relationship&&i.conditionBuilderNullCheck(a.feeScheduleObj.conditionUIDef.group))
//$scope.conditionform.$submitted = true;
h("Error",m.instant("INVALID_CONDITION"));else if(b.$valid&&"PARAMETER"==a.feeScheduleObj.relationship&&a.conditionform.$valid||b.$valid&&"PARAMETER"!=a.feeScheduleObj.relationship){p.showSpinner=!0,a.feeScheduleObj.validFrom=k.convertToServerDate(a.dateObj.fromDate),i.isNullOrEmpty(a.dateObj.tillDate)?a.feeScheduleObj.validTill=null:a.feeScheduleObj.validTill=k.convertToServerDate(a.dateObj.tillDate);var c=angular.copy(a.feeScheduleObj);c.serviceTypeGroupEnum=i.isEmpty(c.serviceTypeGroupEnum)?null:c.serviceTypeGroupEnum.toUpperCase(),i.isNullOrEmpty(a.feeScheduleObj.orgLoc)||i.isNullOrEmpty(a.feeScheduleObj.orgLoc.data)||(c.organizationLocationId=a.feeScheduleObj.orgLoc.data.id,c.organizationLocation=a.feeScheduleObj.orgLoc.data),i.isFieldEmpty(c.conditionUIDef)||(c.conditionUIDef=JSON.stringify(c.conditionUIDef)),c.feeType={},i.isNullOrEmpty(a.feeScheduleObj)||(i.isNullOrEmpty(a.feeScheduleObj.selectedFeeType)?i.isNullOrEmpty(a.feeScheduleObj.feeType.id)||(c.feeType.id=a.feeScheduleObj.feeType.id):i.isNullOrEmpty(a.feeScheduleObj.selectedFeeType.id)?i.isNullOrEmpty(a.feeScheduleObj.feeType.id)||(c.feeType.id=a.feeScheduleObj.feeType.id):c.feeType.id=a.feeScheduleObj.selectedFeeType.id),z(c),c.whetherPermanent="true"===c.whetherPermanent,"PARAMETER"!=c.relationship&&delete c.conditionSubCategory,delete c.orgLoc,delete c.feeSchedulePaymentModesList,delete c.serviceType,delete c.feeTypes,delete c.selectedFeeType,A(c)}};var A=function(b){"add"==a.pageState?(b.id=null,d.postData(e.getUrl("ADD_NEW_FEE_SHEDULE"),b,function(b){i.isNullOrEmpty(b.data)||(h("success",m.instant("ADDED_SUCCESS")),a.cancel()),p.showSpinner=!1},function(a){p.showSpinner=!1})):"edit"==a.pageState&&d.putData(e.getUrl("EDIT_NEW_FEE_SHEDULE"),b,function(b){i.isNullOrEmpty(b.data)||(h("success",m.instant("RECORD_EDITED_SUCESS")),a.cancel()),p.showSpinner=!1},function(a){p.showSpinner=!1})};a.setDateValidation=function(){"true"==a.feeScheduleObj.whetherPermanent&&(a.dateObj.tillDate=null,a.setResidual())},a.setResidual=function(){"true"==a.feeScheduleObj.whetherPermanent&&"NONE"==a.feeScheduleObj.relationship&&(a.feeScheduleObj.whetherResidual=!0,a.feeScheduleObj.whetherConditional=!1,a.condition.open=!1),("NONE"==a.feeScheduleObj.relationship||a.feeScheduleObj.whetherResidual)&&(a.feeScheduleObj.whetherConditional=!1,C(),a.condition.open=!1),"ADHOC"!=a.feeScheduleObj.relationship||a.feeScheduleObj.whetherResidual||(a.feeScheduleObj.whetherConditional=!1,a.feeScheduleObj.whetherPermanent="true",C(),a.condition.open=!1),"PARAMETER"==a.feeScheduleObj.relationship&&(a.feeScheduleObj.whetherConditional=!0,a.condition.open=!0,B())};var B=function(){var b={category:"BILLING",subCategory:"DEFAULT_CATEGORY"};i.isNullOrEmpty(a.feeScheduleObj)||i.isNullOrEmpty(a.feeScheduleObj.selectedFeeType)||i.isNullOrEmpty(a.feeScheduleObj.selectedFeeType.transactionType)||i.isNullOrEmpty(a.feeScheduleObj.selectedFeeType.transactionType.code)||"Pharmacy_Order"==a.feeScheduleObj.selectedFeeType.transactionType.code&&(b={category:"BILLING",subCategory:"PHARMACY_ORDER"},a.feeScheduleObj.conditionSubCategory="PHARMACY_ORDER"),o.getQueryBuilderColumnConf("GET_QUERY_BUILDER_GROUP_DEF",b,function(b){a.queryMetaData=b},function(a){}),o.getQueryBuilderColumnConf("GET_QUERY_BUILDER_ENTITY_DEF",b,function(b){a.entityFields=b},function(a){})},C=function(){a.feeScheduleObj.conditionDesc=null,a.feeScheduleObj.conditionUIDef=null,a.feeScheduleObj.sqlQueryWhereDef=null,a.feeScheduleObj.conditionEntityDef=null};a.setPermanancy=function(){if(a.feeScheduleObj.whetherResidual){a.feeScheduleObj.whetherPermanent="true";var b=jQuery.grep(a.relationships,function(a){return"NONE"==a});a.feeScheduleObj.relationship=b[0],a.setDateValidation()}else a.feeScheduleObj.whetherPermanent="false"},a.cancel=function(){i.goBackToPrevState()},s()}]),angular.module("paripal.dataSettingsModule").controller("ManageServiceTypeCtrl",["$scope","$rootScope","$state","$filter","httpService","urlService","$mdDialog","$mdMedia","notify","utilService","stateParams","featurePrivilegeConstants","parentScope","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){"edit"!==k.type&&"view"!==k.type||(a.pageState=k.type,a.serviceTypeObj=angular.copy(k.data),a.serviceTypeObj.orgLoc={},a.serviceTypeObj.orgLoc.data=k.data.ownerLocation),("add"===k.type||j.isNullOrEmpty(k.type))&&(a.pageState="add",a.serviceTypeObj={},a.serviceTypeObj.serviceGroup={},a.serviceTypeObj.serviceTypeGroup="OTHERS")}function p(){e.getData(f.getUrl("GET_ALL_SERVICE_TYPE_GROUP"),null,function(b){a.serviceGroups=angular.fromJson(b.data),console.log(b.data)},function(a){})}function q(){e.getData(f.getUrl("GET_ALL_CREATION_TYPE"),null,function(b){a.creationTypes=angular.fromJson(b.data)},function(a){})}a.featurePrivilegeConstants=l;var r=function(){/*if (stateParams.type === 'add' || utilService.isNullOrEmpty(stateParams.type)) {
    $scope.pageState = 'add';
    $scope.serviceTypeObj.serviceGroup = "OTHERS";
};*/
if(o(),q(),p(),"add"===a.pageState||"add"===k.type){var b=n.getDefaultOrgLocation();j.isFieldEmpty(b)||(a.serviceTypeObj={},a.serviceTypeObj.orgLoc={},a.serviceTypeObj.orgLoc={data:b.orgLoc})}};a.cancel=function(){g.cancel()},a.saveServiceType=function(){var b={};
//            delete requestObject.serviceTypeGroup;
/*  delete requestObject.name;*/
if(b=a.serviceTypeObj,j.isFieldEmpty(a.serviceTypeObj.orgLoc)?delete b.orgLoc:(b.ownerLocation={},b.ownerLocation.id=a.serviceTypeObj.orgLoc.data.id,delete b.orgLoc),delete b.serviceGroup,j.isFieldEmpty(k.data))e.postData(f.getUrl("ADD_NEW_SERVICE_TYPE"),b,function(a){j.isFieldEmpty(a.data.messages)&&(i("success",a.data.successMessage),g.hide(),m.applyFilters())});else{var c={};c.id=k.data.id,e.putData(f.getParameterizedUrl("UPDATE_SERVICE_TYPE",c.id),b,function(a){j.isFieldEmpty(a.data.messages)&&(i("success",a.data.successMessage),g.hide(),m.applyFilters())})}},r()}]),angular.module("paripal.dataSettingsModule").controller("PriceListSearchCtrl",["$scope","$rootScope","datatableconfig","commonConstants","httpService","priceListService","urlService","utilService","$mdDialog","userStatusService","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,b,c,e,f,g,h){a.feeSchedules=e,a.feeScheduleName=f;/* Data table configurations */
var j=d.gridConfigurations;a.options=g.setOptionProperties(j),h.recomputeBillItems(a.feeSchedules),/*priceListService.getAdhocBillItems().success(function (response) {
                    console.log(response);
                    $scope.billItems = response;
                });*/
a.cancel=function(){i.cancel()}}l.$inject=["$scope","$http","$mdToast","feeSchedules","feeScheduleName","datatableconfig","priceListService"],a.priceListObj={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchCriteria()},a.orgLocation={whetherOrgUser:j.isOrgUser},a.city={queryUrl:"FIND_ALL_CITIES",queryParameter:{}};var m=function(){n(),a.searchCriteria()},n=function(){a.showSpinner=!0,f.getTypeLocationList(function(b){a.typeLocationList=b,a.showSpinner=!1},function(b){a.showSpinner=!1})};a.searchCriteria=function(){a.showSpinner=!0,a.priceListObj.pageNumber=a.currentPage,a.priceListObj.recordsPerPage=a.itemPerPage;var b=angular.copy(a.priceListObj);f.findPriceListByCriteria(b,function(b){a.priceList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.showSpinner=!1},function(b){a.showSpinner=!1})},a.getServiceTypeList=function(b){a.showSpinner=!0;var c={nameCode:b};return e.getData(g.getParameterizedUrl("GET_PRICE_LIST_SERVICE_TYPES",c),null,function(b){return a.showSpinner=!1,console.log(b),b.data},function(b){a.showSpinner=!1})},a.serviceTypeSelected=function(){},a.getCityList=function(b){a.showSpinner=!0;var c={nameCode:b};return e.getData(g.getParameterizedUrl("GET_PRICE_LIST_SERVICE_TYPES",c),null,function(b){return a.showSpinner=!1,console.log(b),b.data},function(b){a.showSpinner=!1})},a.setOrgLocId=function(){h.isNullOrEmpty(a.priceListObj.orgLoc)||h.isNullOrEmpty(a.priceListObj.orgLoc.data)?a.priceListObj.orgLocId=null:a.priceListObj.orgLocId=a.priceListObj.orgLoc.data.id},a.feeHeadBreakDownPopUp=function(a){
//feeSchedule.id = 55;
f.findFeeHeadsByFeeSchedule(a.id,function(b){o(b,a)},function(a){})};var o=function(b,c){i.show({templateUrl:"app/modules/data-settings/views/feeHeadBreakDownList.html",controller:l,parent:angular.element(document.body),locals:{feeSchedules:b,feeScheduleName:c.value},
//targetEvent: ev,
clickOutsideToClose:d.dialogBox.clickOutsideToClose}).then(function(b){a.searchCriteria()})};a.clear=function(){a.priceListObj={},a.priceListObj.orgLoc={},a.orgLocId=null,a.searchCriteria()};/* Data table configurations */
var p=d.gridConfigurations;a.options=c.setOptionProperties(p),a.dtColumnDefs=c.setColumnProperties({}),m()}]),angular.module("paripal.dataSettingsModule").controller("ViewFeeScheduleListCtrl",["datatableconfig","serverSidePagination","$state","$scope","httpService","urlService","$rootScope","notify","dataSettingsService","utilService","$timeout","dateconvertor","$mdDialog","$translate","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";d.currentPage=1,d.itemPerPage=10,d.dateObj={},d.startRecord=(d.currentPage-1)*d.itemPerPage+1,d.endRecord=d.itemPerPage,d.pagingInfo={},d.filterCriteria={},d.redidualTypes=["Yes","No","Both"],d.permanancyTypes=["Permanent","Temporary","Both"],d.today=new Date,d.setOrgLocId=function(){j.isNullOrEmpty(d.filterCriteria.orgLoc)||j.isNullOrEmpty(d.filterCriteria.orgLoc.data)?d.orgLocId=null:d.orgLocId=d.filterCriteria.orgLoc.data.id},d.init=function(){j.isFieldEmpty(o.callingUrl)||"/feetypelist"!==o.callingUrl||(d.filterCriteria.feeTypeId=o.data.feeTypeId,d.filterCriteria.feeTypeCode=o.data.feeTypeCode,d.status={open:!0}),d.applyFilters(),p()},d.applyFilters=function(){d.showSpinner=!0,d.filterCriteria.pageNumber=d.currentPage,d.filterCriteria.recordsPerPage=d.itemPerPage;var a=angular.copy(d.filterCriteria);j.isNullOrEmpty(d.filterCriteria.serviceTypeGroupEnum)||(a.serviceTypeGroupEnum=d.filterCriteria.serviceTypeGroupEnum.id),j.isNullOrEmpty(a.orgLoc)||j.isNullOrEmpty(a.orgLoc.data)||(a.organizationLocationId=a.orgLoc.data.id),j.isNullOrEmpty(a.serviceType)||(a.serviceTypeId=a.serviceType.id),/*if (!utilService.isNullOrEmpty(requestObj.currency) && !utilService.isNullOrEmpty(requestObj.currency.dataValue)) {
    requestObj.currencyId = $scope.filterCriteria.currency.dataValue.id;
}*/
j.isNullOrEmpty(a.feeTypeCode)&&delete a.feeTypeCode,j.isNullOrEmpty(a.feeScheduleCode)&&delete a.feeScheduleCode,j.isNullOrEmpty(a.whetherActive)&&(a.whetherActive=null),delete a.redidualType,delete a.serviceType,delete a.permanancyType,delete a.orgLoc,
//delete requestObj.currency;
a.validFrom=l.convertToServerDate(d.dateObj.fromDate),a.validTill=l.convertToServerDate(d.dateObj.tillDate),e.postData(f.getUrl("GET_FEE_SCHEDULES"),a,function(a){var c=angular.fromJson(a.data);j.isFieldEmpty(c.data)?d.feeScheduleList=[]:d.feeScheduleList=c.data,d.totalItems=a.data.totalRecords,d.pagingInfo=b(d.currentPage,d.itemPerPage,d.totalItems),d.showSpinner=!1},function(a){d.showSpinner=!1})},d.isResidualChanged=function(a){"Yes"==a?d.filterCriteria.whetherResidual=!0:"No"==a?d.filterCriteria.whetherResidual=!1:"Both"==a&&(d.filterCriteria.whetherResidual=null)},d.isPermanencyChanged=function(a){"Permanent"==a?d.filterCriteria.whetherPermanent=!0:"Temporary"==a?d.filterCriteria.whetherPermanent=!1:"Both"==a&&(d.filterCriteria.whetherPermanent=null)};var p=function(){e.getData(f.getUrl("GET_ALL_TRANSACTION_TYPES"),null,function(a){j.isFieldEmpty(a.data)?d.transactionTypes=[]:d.transactionTypes=a.data},function(a){})};/*
                $scope.isDisable = function (row) {
                    if (utilService.isFieldEmpty(row) && typeof row !== "object") {
                        return true;
                    }

                    if (row.whetherActive && row.whetherResidual) {

                        return true;
                    }
                    if (!utilService.isFieldEmpty(row.validFrom) && (utilService.dateComparator($scope.today, row.validFrom, 'lt'))) {

                        return true;
                    }
                    if (!utilService.isFieldEmpty(row.validTill) && utilService.dateComparator(row.validTill, $scope.today, 'lt')) {

                        return true;
                    }
                    return false;

                };*/
d.isDisable=function(a){return a.whetherActive&&a.whetherResidual?(q("RESIDUAL_FEE_SCHEDULE_CAN_NOT_BE_INACTIVATED"),!1):!j.isFieldEmpty(a.validFrom)&&j.dateComparator(d.today,a.validFrom,"lt")?(q("VALID_FROM_DATE_IS_FUTURE_DATE"),!1):!(!j.isFieldEmpty(a.validTill)&&j.dateComparator(a.validTill,d.today,"lt"))||(q("SELECTED_FEE_SCHEDULE_IS_EXPIRED"),!1)};var q=function(a){var b=m.alert().title(n.instant("COMMON_CONFIRMATION_BOX_TITLE")).textContent(n.instant(a)).ok(n.instant("OK"));m.show(b).then(function(){},function(){})};d.clear=function(){d.dateObj={},d.filterCriteria={},d.filterCriteria.orgLoc={},d.orgLocId=null,d.applyFilters()},d.addNewServiceType=function(){c.go("manageFeeSchedule",{type:"add",data:""})},d.editFeeSchedule=function(a){c.go("manageFeeSchedule",{type:"edit",data:a})},d.viewFeeSchedule=function(a){c.go("manageFeeSchedule",{type:"view",data:a})},d.gotoFeeHeadList=function(a){c.go("feeSchedulefeehead",{type:null,data:a,callingUrl:"/feeschedulesearch"})},d.pageChanged=function(){d.pagingInfo=b(d.currentPage,d.itemPerPage,d.totalItems),d.applyFilters()},d.setMaxRecords=function(a){d.pageNumber=1,d.itemPerPage=a,d.applyFilters()};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};d.options=a.setOptionProperties(r),d.dtColumnDefs=a.setColumnProperties({}),d.init()}]),angular.module("paripal.dataSettingsModule").controller("ViewServiceTypeListCtrl",["datatableconfig","serverSidePagination","$state","$scope","httpService","urlService","$rootScope","notify","dataSettingsService","utilService","$timeout","$mdDialog","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";/*function getOrganizationCategorySuccessHandler(data) {
            $scope.organizationCategories = data;
        };*/
function n(){e.getData(f.getUrl("GET_ALL_SERVICE_TYPE_GROUP"),null,function(a){d.serviceGroups=angular.fromJson(a.data)},function(a){})}function o(){e.getData(f.getUrl("GET_ALL_CREATION_TYPE"),null,function(a){d.creationTypes=angular.fromJson(a.data)},function(a){})}d.currentPage=1,d.itemPerPage=10,d.startRecord=(d.currentPage-1)*d.itemPerPage+1,d.endRecord=d.itemPerPage,d.pagingInfo={},d.filterCriteria={},d.disableLoc=!0,d.init=function(){n(),o(),d.filterCriteria.serviceGroup="OTHERS",
// $scope.filterCriteria.organizationCategory = "GLOBAL";
d.applyFilters()},d.clear=function(){/*$scope.filterCriteria.organizationCategory = {};
            $scope.filterCriteria.orgLoc = {};
            $scope.filterCriteria.serviceType = {};
            $scope.filterCriteria.creationType = {};
            $scope.filterCriteria.whetherActive = {};*/
c.reload()},d.whetherOptionAccessible=function(a){var b=!1;return"AUTO"===a&&(b=!0),b},d.manageServiceType=function(a,b){/*$state.go("manageServiceType", {
                type: 'add',
                data: ''
            });*/
l.show({templateUrl:"app/modules/data-settings/views/manage-service-type.html",controller:"ManageServiceTypeCtrl",parent:angular.element(document.body),/*targetEvent: ev,*/
locals:{stateParams:{type:b,data:a},parentScope:d},clickOutsideToClose:m.dialogBox.clickOutsideToClose}).then(function(){})},/* $scope.manageServiceType = function (obj, pageType) {
            $state.go("manageServiceType", {
                type: pageType,
                data: obj
            });
        };

        $scope.viewServiceType = function (obj) {
            $state.go("manageServiceType", {
                type: 'view',
                data: obj
            });
        };
*/
d.applyFilters=function(){d.serviceTypeSearchSpinner=!0,d.filterCriteria.pageNumber=d.currentPage,d.filterCriteria.recordsPerPage=d.itemPerPage,j.isNullOrEmpty(d.filterCriteria.orgLoc)||j.isNullOrEmpty(d.filterCriteria.orgLoc.data)||(d.filterCriteria.locationId=d.filterCriteria.orgLoc.data.id);var a=angular.copy(d.filterCriteria);j.isNullOrEmpty(a.whetherActive)&&(a.whetherActive=null),delete a.orgLoc,delete a.organizationCategory,e.postData(f.getUrl("GET_SERVICE_TYPE_LIST"),a,function(a){var c=angular.fromJson(a.data);d.serviceTypeList=c.data,d.totalItems=a.data.totalRecords,d.pagingInfo=b(d.currentPage,d.itemPerPage,d.totalItems),d.serviceTypeSearchSpinner=!1},function(a){d.serviceTypeSearchSpinner=!1})},d.pageChanged=function(){d.pagingInfo=b(d.currentPage,d.itemPerPage,d.totalItems),d.applyFilters()},d.setMaxRecords=function(a){d.pageNumber=1,d.itemPerPage=a,d.applyFilters()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};d.options=a.setOptionProperties(p),d.dtColumnDefs=a.setColumnProperties({}),d.init()}]),angular.module("paripal.dataSettingsModule").service("associateFHService",["httpService","urlService","utilService",function(a,b,c){"use strict";var d=function(a,b){c.isFieldEmpty(a.feeHead)||(b.feeHead={id:a.feeHead.id}),c.isFieldEmpty(a.feeSchedule)||(b.feeSchedule={id:a.feeSchedule.id}),b.formulae=a.formulae,c.isFieldEmpty(b.formulae)||(b.uiFormula=JSON.stringify(a.uiFormula)),b.whetherMandatory=a.whetherMandatory,b.whetherAdhoc=a.whetherAdhoc,b.whetherComputed=a.whetherComputed,b.whetherActive=!0,b.whetherLinked=a.whetherLinked,b.hasCondition=a.hasCondition,b.feeStructure=a.feeStructure,
//if (!utilService.isEmpty(associateObj.feeScheduleFeeHeadLinkeds)) {
b.feeScheduleFeeHeadLinkeds=a.feeScheduleFeeHeadLinkeds,
//}
b.feeScheduleFeeHeadOptions=a.feeScheduleFeeHeadOptions,b.amount=a.amount,b.allowNegative=!1,b.currency=a.currency,b.organizationLocationId=a.organizationLocationId,b.roundOff=a.roundOff,a.defaultFeeScheduleFeeHeadOption&&null!=a.defaultFeeScheduleFeeHeadOption&&(b.defaultFeeScheduleFeeHeadOption=a.defaultFeeScheduleFeeHeadOption,b.defaultFeeScheduleFeeHeadOption.conditionUIDef=JSON.stringify(b.defaultFeeScheduleFeeHeadOption.conditionUIDef))};this.saveAssociateFeeHead=function(e,f,g){var h={};d(e,h),null==e.id?(c.isFieldEmpty(e.whetherMandatory)||(h.whetherMandatory=e.whetherMandatory),a.postData(b.getUrl("ADD_NEW_ASSOCIATE_FEE_HEAD"),h,function(a){f(a.data)},function(a){g(a)})):(h.id=e.id,h.scheduleSequenceOrder=e.scheduleSequenceOrder,h.version=e.version,c.isNullOrEmpty(e.whetherAmountAutoGenerated)||(1==e.whetherAmountAutoGenerated?h.whetherAmountAutoGenerated=!0:0==e.whetherAmountAutoGenerated&&(h.whetherAmountAutoGenerated=!1)),a.putData(b.getUrl("UPDATE_NEW_ASSOCIATE_FEE_HEAD"),h,function(a){f(a.data)},function(a){g(a)}))},this.getQueryBuilderColumnConf=function(c,d,e,f){a.getData(b.getParameterizedUrl(c,d),null,function(a){e(a.data)},function(a){f(a)})},
//new APi to get the wsObj for cityId,stateId,DistrictId,countryId
this.getWSObjectForAddressFields=function(c,d,e,f){a.postData(b.getParameterizedUrl("GET_WSNAMEVALUE_ADDRESS"),d,function(a){e(a.data)},function(a){f(a)})},this.findAllFeeStructures=function(c,d,e){a.getData(b.getUrl("GET_ALL_FEE_HEAD_TYPE"),null,function(a){d(a.data)},function(a){e(a)})},this.findFormulaFeeHeads=function(c,d,e){a.getData(b.getParameterizedUrl("GET_FORMULA_FEE_HEADS",c),null,function(a){d(a.data)},function(a){e(a)})},this.findfeeScheduleFeeHead=function(c,d,e){var f={feeHeadId:c};a.getData(b.getParameterizedUrl("GET_FEE_SCHEDULES_FEE_HEADS",f),null,function(a){d(a.data)},function(a){e(a)})},this.findRoundOffAlgo=function(c,d){a.getData(b.getUrl("FIND_ROUNDOFF_ALGO"),null,function(a){c(a.data)},function(a){d(a)})},this.getFeeTypeDetailsById=function(c,d,e){a.getData(b.getParameterizedUrl("GET_BY_FEE_TYPE_ID",c),null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.dataSettingsModule").service("dataSettingsService",["httpService","urlService","utilService","$rootScope",function(a,b,c,d){"use strict";this.getOrganizationCategory=function(a){/*httpService.getJsonData(urlService.getJsonFileUrl('ORGANIZATION_CATEGORY_LIST', null),
                function (response) {
                    successFunction(response.data);
                },
                function () {});*/
var b=[];c.isFieldEmpty(d.loggedInUserDetails)||(b.push("GLOBAL"),"SYSTEM"===d.loggedInUserDetails.userOrganizationCategoryType&&b.push("FRANCHISER"),"ANY"===d.loggedInUserDetails.userOrganizationCategoryType&&b.push("FRANCHISER","SERVICE_PROVIDER")),a(b)}}]),angular.module("paripal.dataSettingsModule").service("FeeScheduleFeeHeadService",["httpService","urlService","utilService","$rootScope","notify",function(a,b,c,d,e){"use strict";this.getFeeScheduleFeeHeads=function(d,e,f,g,h,i){var j=new Object;c.isFieldEmpty(d)||(j.pageNumber=d),c.isFieldEmpty(d)||(j.recordsPerPage=e),j.feeScheduleId=f.id,c.isFieldEmpty(f.feeScheduleFeeHead)||(j.feeHeadId=f.feeScheduleFeeHead.id),c.isFieldEmpty(f.currency)||(j.currencyId=f.currency.dataValue.id),"changePriorityScreen"===g?(j.whetherSearchScreen=!1,j.whetherChangePriorityScreen=!0):"listingScreen"===g&&(j.whetherSearchScreen=!0,j.whetherChangePriorityScreen=!1),a.postData(b.getUrl("GET_FEE_SHEDULE_FEE_HEAD_SEARCH"),j,function(a){h(a)},function(a){i(a)})},this.updatePriorities=function(c,d){var f=[];angular.forEach(c,function(a,b){var c={};c.id=a.id,c.prioritySequence=a.scheduleSequenceOrder,f.push(c)}),a.putData(b.getUrl("UPDATE_FEE_SCHEDULE_FEE_HEAD_PRIORITY_SEQUENCE"),f,function(a){d(),a.data.successMessage&&e("success",a.data.successMessage)})}}]),angular.module("paripal.dataSettingsModule").service("priceListService",["httpService","urlService","utilService",function(httpService,urlService,utilService){"use strict";this.findPriceListByCriteria=function(a,b,c){utilService.isFieldEmpty(a.city)||(a.cityId=a.city.id),delete a.city,utilService.isFieldEmpty(a.serviceType)||(a.serviceTypeId=a.serviceType.id),delete a.serviceType,utilService.isFieldEmpty(a.currency)||(a.currencyId=a.currency.dataValue.id),delete a.currency,utilService.isFieldEmpty(a.typeLocation)||(a.locationTypeId=a.typeLocation.id),delete a.typeLocation,delete a.orgLoc,httpService.postData(urlService.getUrl("FIND_PRICE_LIST_BY_CRITERIA"),a,function(a){b(a.data)},function(a){c(a)})},this.findFeeHeadsByFeeSchedule=function(a,b,c){var d={feeScheduleId:a};httpService.getData(urlService.getParameterizedUrl("GET_FEE_HEADS_BY_FEE_SCHEDULE",d),null,function(a){b(a.data)},function(a){c(a)})},this.getTypeLocationList=function(a,b){httpService.getData(urlService.getParameterizedUrl("FIND_TYPE_LOCATION"),null,function(b){a(b.data)},function(a){b(a)})},this.recomputeBillItems=function(a){for(var b=0,c=0;c<a.length;c++)utilService.isNullOrEmpty(a[c].formulae)||(a[c].amount=this.evaluateFormulae(a,a[c])),b++},this.evaluateFormulae=function(billItems,billItem){/*var value = $.grep(billItems, function (obj) {
                 return obj.feeScheduleFeeHead.feeHead.value === uiValues.ID;
             });*/
for(var formulae=billItem.formulae,j=0;j<billItems.length;j++){var formulaeHeadVarName="FH_"+billItems[j].feeHead.id;formulae=formulae.replace(formulaeHeadVarName,billItems[j].amount)}return console.log("Formulae--->"+formulae),eval(formulae)},this.getAdhocBillItems=function(){return $http.get("js/adhocbillData.json")}}]),angular.module("paripal.userTestDocumentModule").controller("UserTestDocumentsListCtrl",["$scope","httpService","urlService","commonConstants","datatableconfig","$mdDialog","utilService","notify","$filter","manageAttachmentService","fileOperations","serverSidePagination","userIdDocumentService","$stateParams","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.currentPage=d.defaultPageNo,a.itemPerPage=d.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=d,a.userTestDocObject={},a.diagnosticTestList=[];/**
     * Get users list
     * @param   {string} viewValue Name of the user being searched.
     * @returns {Array} [[Description]]
     */
var p=function(){if(o.isUserLoggedIn()){var d=o.userStatus();a.isUserDisable=!d.isOrgUser,g.isFieldEmpty(d.userData)||0!=d.isOrgUser||(a.userTestDocObject.user=d.userData)}if(!g.isFieldEmpty(n.data)&&(a.userTestDocObject.diagnosticTestUser=n.data.diagnosticTest,a.userTestDocObject.user=n.data.user,"linkCalled"===n.type&&(a.disabledAddEdit=!0),a.loadDocumentsList(n.data.diagnosticTest.id),!g.isNullOrEmpty(n.data.orderId))){var e={};e.id=n.data.orderId,b.getData(c.getParameterizedUrl("FIND_DIAGNOSTIC_TEST_ORDER_BY_ID",e),null,function(b){a.orderCode=b.data.value})}g.isFieldEmpty(a.userTestDocObject.user)||a.loadDiagnosticUserTest(a.userTestDocObject.user.id)};a.loadDiagnosticUserTest=function(d){var e={};g.isNullOrEmpty(n.data)||g.isNullOrEmpty(n.data.orderId)||(e.orderId=n.data.orderId),e.userId=d,g.isNullOrEmpty(e.orderId)?(e.userTestTrName="",b.getData(c.getParameterizedUrl("FIND_USERTESTBYUSERID",e),null,function(b){var c=angular.fromJson(b.data);angular.forEach(c,function(a,b){a.value=a.value+"_"+a.code,c[b]=a}),angular.copy(c,a.diagnosticTestList)})):b.getData(c.getParameterizedUrl("FIND_USERTESTBYUSERID_ORDER_ID",e),null,function(b){var c=angular.fromJson(b.data);/*angular.forEach(data, function (value, key) {
        value.value = value.value + '_' + value.code;
        data[key] = value;
    });*/
angular.copy(c,a.diagnosticTestList)})},a.getUsersList=function(d){a.userNameAutoCmp=!0;var e={};return e.searchString=d,b.getData(c.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",e),null,function(b){return a.userNameAutoCmp=!1,a.userList=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},/*$scope.getUserTestList = function (userObject, viewValue) {
        var requestData = {};
        requestData.userId = userObject.id;
        requestData.userTestTrName = viewValue;
        $scope.userTestNameAutoCmp = true;
        return httpService.getData(urlService.getParameterizedUrl('FIND_USERTESTBYUSERID', requestData), null, function (response) {
                $scope.userTestNameAutoCmp = false;
                return $scope.diagnosticTestUserList = angular.fromJson(response.data);
            },
            function (error) {
                $scope.userTestNameAutoCmp = false;
            });
    };
*/
a.loadDocumentsList=function(){var d={};if(d.pageNumber=a.currentPage,d.recordsPerPage=a.itemPerPage,"string"==typeof a.userTestDocObject.diagnosticTestUser){var e=angular.fromJson(a.userTestDocObject.diagnosticTestUser);d.id=e.id}else d.id=a.userTestDocObject.diagnosticTestUser.id;a.userTestDocumentsListSpinner=!0,b.postData(c.getUrl("GET_USERTESTDOCSBYCRITERIA"),d,function(b){a.userTestDocumentsListSpinner=!1,a.WSUserTestReportList=b.data.data,a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.userTestDocumentsListSpinner=!1})},a.addUserTestDocument=function(b,c,e){g.isEmpty(c)||g.isEmpty(e)?h("Warning",i("translate")("USER_TEST_ERROR")):f.show({templateUrl:"app/modules/user-tests/views/prescription-file-uploader.html",controller:"PrescriptionFileUploaderCtrl",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:d.dialogBox.clickOutsideToClose,locals:{docType:"TEST",docSubType:"REPORT",isMultipleFileUpload:!0},clickOutsideToClose:d.dialogBox.clickOutsideToClose}).then(function(b){a.saveDocumentIdInDocumentTable(b)})},a.saveDocumentIdInDocumentTable=function(b){if(!g.isEmpty(b)){a.fileUploadSpinner=!0;var c=b.selectedFileArray,d={};d.documentType=b.documentType,k.saveAllDocuments(d,!1,c,function(d){a.manageUserTestSpiner=!1,!g.isEmpty(c)&&c.length>0&&a.uploadFile(c,b,d)},function(){a.fileUploadSpinner=!1,a.manageUserTestSpiner=!1})}},a.uploadFile=function(b,c,d){var e=new Object;e.docType=c.documentType.type,e.docSubType=c.documentType.subType,"string"==typeof a.userTestDocObject.diagnosticTestUser?(a.tempTestObject=angular.fromJson(a.userTestDocObject.diagnosticTestUser),e.recordId=a.tempTestObject.id):e.recordId=a.userTestDocObject.diagnosticTestUser.id,e.userId=a.userTestDocObject.user.id,g.isNullOrEmpty(d.response)||(e.resourceDetails=JSON.stringify(d.response)),k.uploadMultipleFiles(e,b,function(b){var e=d.response;a.saveUserTestDocument(c,e)},function(b){a.fileUploadSpinner=!1,h("Error",$translate.instant("ERROR_WHILE_UPLOADING"))})},a.saveUserTestDocument=function(d,e){var f={};"string"==typeof a.userTestDocObject.diagnosticTestUser?(a.tempTestObject=angular.fromJson(a.userTestDocObject.diagnosticTestUser),f={diagnosticTestUser:a.tempTestObject.id,documents:e,uploadedBy:{id:o.userStatus().userData.id}}):f={diagnosticTestUser:a.userTestDocObject.diagnosticTestUser.id,documents:e,uploadedBy:{id:o.userStatus().userData.id}},b.postData(c.getUrl("UPLOAD_USERTESTDOCUMENT"),f,function(b){a.fileUploadSpinner=!1,b.data.successMessage&&(h("success",b.data.successMessage),"string"==typeof a.userTestDocObject.diagnosticTestUser?(a.tempTestObject=angular.fromJson(a.userTestDocObject.diagnosticTestUser),a.loadDocumentsList(a.tempTestObject.id)):a.loadDocumentsList(a.userTestDocObject.diagnosticTestUser.id))},function(b){a.fileUploadSpinner=!1})},a.deleteUserTestDocument=function(b){if(!g.isEmpty(b)){var c=new Object;c.fileName=b.fileName,c.resourceId=b.id,c.docType=b.documentType.type,c.docSubType=b.documentType.subType,m.deleteUserIdDocFileDetails(c,function(c){m.deleteUserIdDocDetails(b.id,function(b){g.isNullOrEmpty(b.successMessage)||h("success",b.successMessage),"string"==typeof a.userTestDocObject.diagnosticTestUser?(a.tempTestObject=angular.fromJson(a.userTestDocObject.diagnosticTestUser),a.loadDocumentsList(a.tempTestObject.id)):a.loadDocumentsList(a.userTestDocObject.diagnosticTestUser.id)},function(a){})},function(a){})}},a.downloadFile=function(b){if(!g.isEmpty(b)){var c=new Object;c.fileName=b.fileName,c.resourceId=b.id,"string"==typeof a.userTestDocObject.diagnosticTestUser?(a.tempTestObject=angular.fromJson(a.userTestDocObject.diagnosticTestUser),c.recordId=a.tempTestObject.id):c.recordId=a.userTestDocObject.diagnosticTestUser.id,c.docType=b.documentType.type,c.docSubType=b.documentType.subType,k.downloadFile(c,function(a){},function(a){})}},a.viewPrintFile=function(b,c){if(!g.isEmpty(c)){var d=new Object;d.fileName=c.fileName,d.resourceId=c.id,"string"==typeof a.userTestDocObject.diagnosticTestUser?(a.tempTestObject=angular.fromJson(a.userTestDocObject.diagnosticTestUser),d.recordId=a.tempTestObject.id):d.recordId=a.userTestDocObject.diagnosticTestUser.id,d.docType=c.documentType.type,d.docSubType=c.documentType.subType,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!1}},a.pageChanged=function(){a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems),a.loadDocumentsList()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.loadDocumentsList()};var q=d.gridConfigurations;a.options=e.setOptionProperties(q),p()}]),angular.module("paripal.labCRM").controller("diseaseBasedDiagnosticListCtrl",["$scope","$rootScope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$mdDialog","$filter","$stateParams","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,d.getData(e.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,c.isEmpty(b.data)||c.isEmpty(b.data.messages[0])?f("error",n.instant("RECORD_SEARCH_FAILURE")):f("Alert",n.instant(b.data.messages[0]))})}function p(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.disease?(a.searchKeyWord.diseaseId=a.filter.disease.id,a.diseaseVariantLoad=!0,d.getData(e.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,c.isEmpty(b.data)||c.isEmpty(b.data.messages[0])?f("error",n.instant("RECORD_SEARCH_FAILURE")):f("Alert",n.instant(b.data.messages[0]))})):void f("error",n.instant("Select Disease"))}a.filterObject={},a.addTestDiseaseLinkObj={},a.addTestDiseaseLinkObj.whetherActive=!0,a.currentPage=j.defaultPageNo,a.itemPerPage=j.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=j,a.getDisease=o,a.getDiseaseVariant=p,a.init=function(){"diseaseVariant"===m.from&&(a.filter={},a.filter.diseaseVariant={},a.filter.disease={},a.filter.disease.id=m.diseaseId,a.filter.disease.value=m.diseaseName,a.filter.diseaseVariant.id=m.diseaseVariantId,a.filter.diseaseVariant.value=m.diseaseVariantName,a.searchData(a.filter))},a.searchData=function(b,c){
// if(testObject && testObject.disease){
//    delete testObject.disease;
// }
var f={};f.diseaseVariantId=b.diseaseVariant.id,d.postData(e.getUrl("GET_TEST_BY_DISEASE_LIST"),f,function(b){a.testDiseaseListSpinner=!1,a.data=angular.fromJson(b.data),a.totalItems=a.data.totalRecords,a.testDiseaseList=a.data.data,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.testDiseaseListSpinner=!1})},a.cancel=function(){a.addTestDiseaseLinkObj={},k.cancel()},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData(a.filterObject)},a.setMaxRecords=function(b){c.isEmpty(a.filterObject)?f("Warning",l("translate")("INVALID_TEST_NAME")):(a.currentPage=1,a.itemPerPage=b,a.searchData(a.filterObject))};/**
     *datatble config json
     */
var q=j.gridConfigurations;a.options=g.setOptionProperties(q),a.init(),a.dtColumnDefs=g.setColumnProperties({notSoratbleCol:[0,1,2]})}]),angular.module("paripal.diseaseManagementModule").controller("diseaseManagementCtrl",["$scope","utilService","$rootScope",function(a,b,c){"use strict";if(!b.isNullOrEmpty(c.dashboardMenu)){a.parentMenus=c.dashboardMenu.children;for(var d=0;d<=a.parentMenus.length;d++)null!=a.parentMenus[d]&&"DISEASE"==a.parentMenus[d].name&&(a.childMenus=a.parentMenus[d].children)}}]),angular.module("paripal.diseaseManagementModule").controller("incidentStatisticsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","incidentStatisticsService","httpService","urlService","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.incidentstat&&a.incidentstat.diseaseId?(a.searchKeyWord.diseaseId=a.incidentstat.diseaseId.id,a.diseaseVariantLoad=!0,i.getData(j.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,utilService.isEmpty(b.data)||utilService.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SERACH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})):void f("error",g.instant("Select Disease"))}function m(a,b,c){var d=a.concat(b),e=d.concat(c);return e}function n(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Total Users by "+a.incidentType,c.count=a.totUser,b.push(c)}),b}function o(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Active Users by "+a.incidentType,c.count=a.totActiveUser,b.push(c)}),b}function p(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Cases This Year by "+a.incidentType,c.count=a.casesThisYear,b.push(c)}),b}function q(a,b,c){var d=a.concat(b),e=d.concat(c);return e}function r(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Total Users by "+a.variantName,c.count=a.totUser,b.push(c)}),b}function s(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Active Users by "+a.variantName,c.count=a.totActiveUser,b.push(c)}),b}function t(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Cases This Year by "+a.variantName,c.count=a.casesThisYear,b.push(c)}),b}function u(a){var b=[];return a.forEach(function(a){var c={};c.attribute=a.incidentType,c.count=a.totCount,b.push(c)}),b}a.analysis={},a.incident="",a.analysisType="",
//$scope.incidentTypes =[{'Name':'User Reported By Disease Variant(Bar-Chart)','key':'Chart-1','value':'Bar-Chart'},{'Name':'User Reported By Incident Types(Bar-Chart)','key':'Chart-2','value':'Bar-Chart'},{'Name':'Incident Types(Pie-Chart)','key':'Chart-3','value':'Pie-Chart'}];	
a.incidentstat={},a.filter=!0;/*****    from disease incident page  *****/
if(a.getTotalUser=r,a.getTotalUserActive=s,a.getcasesThisYear=t,a.getDiseaseVariant=l,a.getChartName=function(){a.incidentTypes=[{Name:"User Reported By Disease Variant(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"},{Name:"User Reported By Incident Types(Bar-Chart)",key:"Chart-2",value:"Bar-Chart"},{Name:"Incident Types(Pie-Chart)",key:"Chart-3",value:"Pie-Chart"}]},a.setDirectiveFn=function(b){console.log("in setDirectiveFn"),a.barChartCreateFunction=b},a.setDirectiveFnForPie=function(b){a.pieChartCreateFunction=b},a.getIncidentAnalysis=function(b,c){if(b.incidentType&&!b.incidentType.id)return b.incidentType="",void f("error",g.instant("Select Specific Incident Type"));if(b.diseaseId&&!b.diseaseId.id)return b.diseaseId="",void f("error",g.instant("Select Specific Disease"));if(b.variantId&&!b.variantId.id)return b.variantId="",void f("error",g.instant("Select Specific Disease Variant"));var d=angular.copy(b);d&&d.variantId&&(d.variantId=d.variantId.id),d&&d.diseaseId&&(d.diseaseId=d.diseaseId.id),d&&d.incidentType&&d.incidentType.id&&(d.incidentType=d.incidentType.id),
// if(filterRecords && filterRecords.dateFrom)
//    {
// 	filterRecords.dateFrom = dateconvertor.convertToServerDate(filterRecords.dateFrom);
//    }
//    if(filterRecords && filterRecords.tillDate)
//    {
//    	filterRecords.tillDate = dateconvertor.convertToServerDate(filterRecords.tillDate);
//    }
h.getIncidentAnalysis(d,c,function(d){d&&(0==d.length?(a.norecordfound=!0,a.chart=!1):"Bar-Chart"==c.value?(a.getBarChart(b,d,c),a.norecordfound=!1):(a.getPieChart(b,d,c),a.norecordfound=!1),
//var totalRequest = sucessResponse.data.length;
a.chartType=c,a.chart=!0)},function(a){})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=j.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){utilService.isEmpty(a.data)||utilService.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getIncidentType=function(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.incidentTypeLoad=!0,i.getData(j.getParameterizedUrl("GET_INCIDENT_TYPE",a.searchKeyWord),null,function(b){return a.incidentTypeLoad=!1,a.incidentTypeLoad=angular.fromJson(b.data)},function(b){a.incidentTypeLoad=!1,utilService.isEmpty(b.data)||utilService.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SERACH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})},a.clear=function(b,c){a.incidentstat={},a.incident="",a.analysisType="",a.labels=[],a.data=[],a.labelss=[],a.datas=[],a.chartType="",a.getChartName(),a.chart=!1},a.getChartName(),a.getBarChart=function(b,c,d){if("Chart-1"===d.key&&"Bar-Chart"===d.value){var e=r(c),f=s(c),g=t(c);a.chartData=q(e,f,g),a.barChartCreateFunction()}if("Chart-2"===d.key&&"Bar-Chart"===d.value){var e=n(c),f=o(c),g=p(c);a.chartData=m(e,f,g),a.barChartCreateFunction()}},a.getPieChart=function(b,c,d){"Chart-3"===d.key&&"Pie-Chart"===d.value&&(a.chartData=u(c),a.pieChartCreateFunction())},c.from&&"diseaseIncident"==c.from){var v={};c.incidentTypeId&&c.diseaseId&&c.diseaseVariantId?(v.diseaseId={},v.diseaseId.id=c.diseaseId,v.variantId={},v.variantId.id=c.diseaseVariantId,v.incidentType={},v.incidentType.id=c.incidentTypeId,a.incidentstat=v,
// $scope.incidentstat.diseaseId.id = $stateParams.diseaseId;
a.incidentstat.diseaseId.value=c.diseaseName,
// $scope.incidentstat.variantId = {};
// $scope.incidentstat.variantId.id = $stateParams.diseaseVariantId;
a.incidentstat.variantId.value=c.diseaseVariantName,
// $scope.incidentstat.variantId.value = "sample";
// $scope.incidentstat.incidentType = {};
// $scope.incidentstat.incidentType.id = $stateParams.incidentTypeId;
a.incidentstat.incidentType.value=c.incidentTypeName):c.incidentTypeId&&c.diseaseId&&(v.diseaseId={},v.diseaseId.id=c.diseaseId,v.incidentType={},v.incidentType.id=c.incidentTypeId,a.incidentstat=v,
// $scope.incidentstat.diseaseId.id = $stateParams.diseaseId;
a.incidentstat.diseaseId.value=c.diseaseName,
// $scope.incidentstat.incidentType = {};
// $scope.incidentstat.incidentType.id = $stateParams.incidentTypeId;
a.incidentstat.incidentType.value=c.incidentTypeName);var w={Name:"User Reported By Incident Types(Bar-Chart)",key:"Chart-2",value:"Bar-Chart"};a.chartName=w,a.getIncidentAnalysis(v,w)}/*****    from disease varient page  *****/
if(c.from&&"diseaseVariant"==c.from){var v={};c.diseaseId&&c.diseaseVariantId&&(v.diseaseId={},v.diseaseId.id=c.diseaseId,v.variantId={},v.variantId.id=c.diseaseVariantId,a.incidentstat=v,
//$scope.incidentstat.diseaseId.id = $stateParams.diseaseId;
a.incidentstat.diseaseId.value=c.diseaseName,
//$scope.incidentstat.variantId = {};
//$scope.incidentstat.variantId.id = $stateParams.diseaseVariantId;
a.incidentstat.variantId.value=c.diseaseVariantName);var w={Name:"User Reported By Disease Variant(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"};a.chartName=w,a.getIncidentAnalysis(v,w)}/**********************************from user incident page ****************************/
if(c.from&&"userIncident"==c.from){var v={};c.diseaseId&&c.diseaseVariantId&&c.incidentTypeId&&(v.diseaseId={},v.diseaseId.id=c.diseaseId,v.variantId={},v.variantId.id=c.diseaseVariantId,v.incidentType={},v.incidentType.id=c.incidentTypeId,a.incidentstat=v,a.incidentstat.diseaseId.value=c.diseaseName,a.incidentstat.variantId.value=c.diseaseVariantName,a.incidentstat.incidentType.value=c.incidentTypeName);var w={Name:"User Reported By Incident Types(Bar-Chart)",key:"Chart-2",value:"Bar-Chart"};a.chartName=w,a.getIncidentAnalysis(v,w)}}]),angular.module("paripal.diseaseManagementModule").controller("manageDiseaseIncidentsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$q","$timeout","$filter","dateconvertor","utilService","httpService","urlService","serverSidePagination","manageDiseaseIncidentsService","fileOperations","commonConstants","searchDiseaseIncidentService","manageAttachmentService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";function w(b){a.diseaseId=b}function x(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseIncident&&a.diseaseIncident.disease?(a.searchKeyWord.diseaseId=a.diseaseIncident.disease.id,a.diseaseVariantLoad=!0,n.getData(o.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}a.getDiseaseVariant=x,a.getDiseaseId=w,a.diseaseId={},a.orgLocPermission=v.DISEASE_INCIDENT_ADD,a.incidentFileDetail={},a.incidentFileDetail.fileToBeUpload=null,a.documentUpload={},a.documentUpload.document={},a.diseaseIncident={incidentCategory1:{},incidentCategory2:{},incidentCategory3:{},whetherActive:!0},a.init=function(){"edit"===c.type&&(a.IsVisible=!0,a.printBtn=!0,a.orgLocPermission=v.DISEASE_INCIDENT_EDIT),"view"===c.type&&(a.pageState="view",a.viewmode=!0,a.IsVisible=!0,a.printBtn=!0),c.data?a.diseaseIncident=c.data:c.id&&t.getIncidentById(c.id,function(b){a.manageOrgLocSpinner=!1,a.diseaseIncident=b},function(b){a.manageOrgLocSpinner=!1,a.error=b})},a.saveIncidents=function(){a.diseaseIncident&&a.diseaseIncident.incidentCategory1&&!a.diseaseIncident.incidentCategory1.id&&delete a.diseaseIncident.incidentCategory1,a.diseaseIncident&&a.diseaseIncident.incidentCategory2&&!a.diseaseIncident.incidentCategory2.id&&delete a.diseaseIncident.incidentCategory2,a.diseaseIncident&&a.diseaseIncident.incidentCategory3&&!a.diseaseIncident.incidentCategory3.id&&delete a.diseaseIncident.incidentCategory3,a.incidentFileDetail.fileToBeUpload?(a.documentUpload.document.fileName=a.incidentFileDetail.fileToBeUpload.name,a.documentUpload.document.fileSize=a.incidentFileDetail.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.diseaseIncident.creatingOrganization.id,a.documentUpload.document.documentType={subType:s.documentSubTypes.diseaseIncident},"add"!=c.type&&(a.documentUpload.document.id=a.diseaseIncident.documentId),u.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.incidentFileDetail.fileToBeUpload&&(
//$scope.uploadFile($scope.documentUploadFile, response);
a.incidentFileDetail&&a.incidentFileDetail.fileToBeUpload&&a.incidentFileDetail.fileToBeUpload.name&&a.uploadFile(a.diseaseIncident,a.incidentFileDetail,b),a.diseaseIncident&&a.diseaseIncident.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):q.saveIncidents(a.diseaseIncident,function(b){b&&(d.go("searchDiseaseIncidents"),a.diseaseIncident&&a.diseaseIncident.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.cancel=function(){m.goBackToPrevState()},a.getIncidentCategoryType1=function(){var b={};b.code="DISEASE_INCIDENT_1",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.incidentTypes1=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getIncidentCategoryType2=function(){var b={};b.code="DISEASE_INCIDENT_2",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.incidentTypes2=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getIncidentCategoryType3=function(){var b={};b.code="DISEASE_INCIDENT_3",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.incidentTypes3=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},/* function getDiseaseVariant(viewValue){
   				$scope.searchKeyWord = {};
   				$scope.searchKeyWord.searchKeyWord = viewValue;
   				$scope.diseaseVariantLoad = true;
   				return httpService.getData(urlService.getParameterizedUrl('GET_DISEASE_VARIANT_LIST',$scope.searchKeyWord), null, function (response) {
   					$scope.diseaseVariantLoad = false;
   					return $scope.diseaseVariantLoad = angular.fromJson(response.data);
   				}, function (error) {
   					$scope.diseaseVariantLoad = false;
   					if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
              	       notify("error", $translate.instant(error.data.messages[0]));
              	 }
   				});
   			}*/
a.getIncidentType=function(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.incidentTypeLoad=!0,n.getData(o.getParameterizedUrl("GET_INCIDENT_TYPE",a.searchKeyWord),null,function(b){return a.incidentTypeLoad=!1,a.incidentTypeLoad=angular.fromJson(b.data)},function(b){a.incidentTypeLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})},a.getCreatingLocation=function(b){var c={};return c.keyword=b,n.getData(o.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.creatingOrganization=b.data,a.creatingOrganization},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=o.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.uploadFile=function(b,c,e){var g=new Object;g.file=c.fileToBeUpload,g.orgLocId=a.diseaseIncident.creatingOrganization.id,g.docType=s.documentTypes.disease,g.docSubType=s.documentSubTypes.diseaseIncident,g.isThumbnailRequired=!1,m.isNullOrEmpty(e.response)||(
//paramObject.recordId = successParentResponse.response;
g.resourceId=e.response),r.uploadFile(g,function(b){m.isNullOrEmpty(e.successMessage)||(a.diseaseIncident.documentId=e.response,q.saveIncidents(a.diseaseIncident,function(b){b&&(d.go("searchDiseaseIncidents"),a.diseaseIncident&&a.diseaseIncident.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},function(b){m.isNullOrEmpty(successParentResponse.response)||t.deleteIncidentById(successParentResponse.response,function(b){f("Error",h.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()},function(b){f("Error",h.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()})})},a.viewPrintFile=function(b,c){if(!m.isEmpty(c)){var d=new Object;d.fileName=c.sampleImageFile,d.orgLocId=c.creatingOrganization.id,d.resourceId=c.documentId,d.docType=s.documentTypes.disease,d.docSubType=s.documentSubTypes.diseaseIncident,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable}},a.init(),a.getIncidentCategoryType1(),a.getIncidentCategoryType2(),a.getIncidentCategoryType3()}]),angular.module("paripal.diseaseManagementModule").controller("manageDiseaseMedicationCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageDiseaseMedicationService","searchDiseaseMedicationService","httpService","urlService","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(b){return a.searchKeyWord={},a.searchKeyWord.medication=b,a.medicationLoad=!0,l.getData(m.getParameterizedUrl("SEARCH_MEDICATION",a.searchKeyWord),null,function(b){return a.medicationLoad=!1,a.medication=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function q(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,l.getData(m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function r(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseMedication&&a.diseaseMedication.disease?(a.searchKeyWord.diseaseId=a.diseaseMedication.disease.id,a.diseaseVariantLoad=!0,l.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function s(b){a.queryObj={},a.queryObj.keyword=b;var c=m.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",a.queryObj);if(c)return l.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function t(b){a.queryObj={},a.queryObj.id=b;var c=m.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&l.getData(c,null,function(b){b&&b.data&&(a.medicationVariants=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function u(){
//$state.go('searchDiseaseMedication', { type: '' });
n.goBackToPrevState()}function v(){a.diseaseMedication?(a.diseaseMedication.diseaseMedicationCategory1?
//if ($scope.diseaseMedication.diseaseMedicationCategory1.dataValue) {
a.diseaseMedication.diseaseMedicationCategory1.id&&(a.diseaseMedication.diseaseMedicationCategory1.id=a.diseaseMedication.diseaseMedicationCategory1.id):delete a.diseaseMedication.diseaseMedicationCategory1,a.diseaseMedication.diseaseMedicationCategory2&&a.diseaseMedication.diseaseMedicationCategory2.id&&(a.diseaseMedication.diseaseMedicationCategory2.id=a.diseaseMedication.diseaseMedicationCategory2.id)):delete a.diseaseMedication.diseaseMedicationCategory2,a.diseaseMedication.diseaseMedicationCategory3?
//	if ($scope.diseaseMedication.diseaseMedicationCategory3.dataValue) {
a.diseaseMedication.diseaseMedicationCategory3.id&&(a.diseaseMedication.diseaseMedicationCategory3.id=a.diseaseMedication.diseaseMedicationCategory3.id):delete a.diseaseMedication.diseaseMedicationCategory3,void 0==a.diseaseMedication.requiresIisolation&&(a.diseaseMedication.requiresIisolation=!1),void 0==a.diseaseMedication.communicable&&(a.diseaseMedication.communicable=!1),void 0==a.diseaseMedication.active&&(a.diseaseMedication.active=!1),j.saveDiseaseMedication(a.diseaseMedication,function(b){b&&(d.go("searchDiseaseMedication"),null!=a.diseaseMedication.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.diseaseMedication={},a.getMedication=p,a.getDisease=q,a.getDiseaseVariant=r,a.getMedicationVariant=t,a.getCreatingOrganization=s,a.saveDiseaseMedication=v,a.cancel=u,a.orgLocPermission=o.DISEASE_MEDICATION_ADD,a.diseaseMedication={active:!0},a.initDiseaseMedicationById=function(){c.data?(a.diseaseMedication=c.data,a.diseaseMedication.medication&&a.diseaseMedication.medication.id&&t(a.diseaseMedication.medication.id)):c.id&&k.getDiseaseMedicationById(c.id,function(b){a.diseaseMedication=b,a.diseaseMedication.medication&&a.diseaseMedication.medication.id&&t(a.diseaseMedication.medication.id)}),"view"===c.type&&(a.pageState="view",a.viewmode=!0,a.IsVisible=!0),"edit"===c.type&&(a.pageState="edit",a.viewmode=!1,a.IsVisible=!0,a.orgLocPermission=o.DISEASE_MEDICATION_EDIT)},a.initDiseaseMedicationById(),a.getDiseaseCategoryType1=function(){var b={};b.code="DISEASE_MEDICATION_CATEGORY_1",l.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseCategory1=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getDiseaseCategoryType2=function(){var b={};b.code="DISEASE_MEDICATION_CATEGORY_2",l.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseCategory2=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getDiseaseCategoryType3=function(){var b={};b.code="DISEASE_MEDICATION_CATEGORY_3",l.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseCategory3=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getDiseaseCategoryType1(),a.getDiseaseCategoryType2(),a.getDiseaseCategoryType3()}]),angular.module("paripal.diseaseManagementModule").controller("manageDiseaseProtocolCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","diseaseProtocolService","httpService","urlService","utilService","commonConstants","fileOperations","featurePrivilegeConstants","manageAttachmentService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function s(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseProtocol&&a.diseaseProtocol.disease?(a.searchKeyWord.diseaseId=a.diseaseProtocol.disease.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function t(b){a.queryObj={},a.queryObj.keyword=b;var c=l.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function u(){
// $state.go('searchDiseaseProtocols', { type: '' });
m.goBackToPrevState()}function v(b,c,e){var g=new Object;g.file=b.fileToBeUpload,g.orgLocId=a.diseaseProtocol.creatingOrgLoc.id,g.docType=n.documentTypes.disease,g.docSubType=n.documentSubTypes.diseaseProtocol,g.isThumbnailRequired=!1,m.isNullOrEmpty(e.response)||(g.resourceId=e.response),o.uploadFile(g,function(b){m.isNullOrEmpty(e)||(a.diseaseProtocol.documentId=e.response,j.save(a.diseaseProtocol,function(a){a&&(f("success",a.successMessage),d.go("searchDiseaseProtocols"))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},function(a){m.isNullOrEmpty(e.response)||
//				TODO: Implement disease protocol delete 
j.inActivate(e.response,function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))},function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))})})}function w(b,c){if(!m.isEmpty(c)){var d={};d.fileName=c.protocolFile,d.orgLocId=a.diseaseProtocol.creatingOrgLoc.id,d.resourceId=c.documentId,d.docType=n.documentTypes.disease,d.docSubType=n.documentSubTypes.diseaseProtocol,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable,o.viewFileContent(d,function(a){},function(a){})}}function x(){void 0==a.diseaseProtocol.whetherActive&&(a.diseaseProtocol.whetherActive=!1),!m.isEmpty(a.diseaseProtocol)&&a.diseaseProtocolFile&&a.diseaseProtocolFile.fileToBeUpload&&(a.diseaseProtocol.protocolFile=a.diseaseProtocolFile.fileToBeUpload.name),a.diseaseProtocolFile.fileToBeUpload?(a.documentUpload.document.fileName=a.diseaseProtocolFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.diseaseProtocolFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.diseaseProtocol.creatingOrgLoc.id,a.documentUpload.document.documentType={subType:n.documentSubTypes.diseaseProtocol},"add"!=c.type&&(a.documentUpload.document.id=a.diseaseProtocol.documentId),q.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.diseaseProtocolFile.fileToBeUpload&&(
//$scope.uploadFile($scope.documentUploadFile, response);
a.diseaseProtocolFile&&a.diseaseProtocolFile.fileToBeUpload&&a.diseaseProtocolFile.fileToBeUpload.name&&a.uploadFile(a.diseaseProtocolFile,a.diseaseProtocol,b),a.diseaseProtocol&&a.diseaseProtocol.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):j.save(a.diseaseProtocol,function(b){b&&(d.go("searchDiseaseProtocols"),null!=a.diseaseProtocol.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.diseaseProtocol={},a.documentUpload={},a.documentUpload.document={},a.diseaseProtocolFile={},a.diseaseProtocolFile.fileToBeUpload=null,a.getDisease=r,a.getDiseaseVariant=s,a.getCreatingOrgLoc=t,a.save=x,a.cancel=u,a.uploadFile=v,a.viewPrintFile=w,a.IsVisible=!1,a.editMode=!1,a.viewMode=!1,a.orgLocPermission=p.DISEASE_PROTOCOL_ADD,a.initDiseaseProtocolById=function(){c.data?(a.diseaseProtocol=c.data,"view"===c.type?(a.pageState="view",a.IsVisible=!0,a.viewMode=!0,a.editMode=!1):"edit"===c.type&&(a.pageState="edit",a.viewMode=!1,a.IsVisible=!0,a.editMode=!0,a.orgLocPermission=p.DISEASE_PROTOCOL_EDIT)):c.id&&("view"===c.type?(a.pageState="view",a.IsVisible=!0,a.viewMode=!0,a.editMode=!1):"edit"===c.type&&(a.pageState="edit",a.viewMode=!1,a.IsVisible=!0,a.editMode=!0),j.getDiseaseProtocolById(c.id,function(b){a.manageOrgLocSpinner=!1,a.diseaseProtocol=b}))},a.initDiseaseProtocolById()}]),angular.module("paripal.diseaseManagementModule").controller("manageDiseaseReqCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$q","$timeout","$filter","dateconvertor","utilService","httpService","urlService","serverSidePagination","manageDiseaseReqService","searchDiseaseReqService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(){a.updatedDisease=angular.copy(a.disease),a.disease&&a.disease.diseaseNameCode&&(a.disease.diseaseNameCode.id||(a.updatedDisease.diseaseNameCode=a.oldDisease),delete a.updatedDisease.diseaseNameCode.mutable),a.disease&&a.disease.picklistItemByDiseaseCategory1&&!a.disease.picklistItemByDiseaseCategory1.id&&delete a.updatedDisease.picklistItemByDiseaseCategory1,a.disease&&a.disease.picklistItemByDiseaseCategory2&&!a.disease.picklistItemByDiseaseCategory2.id&&delete a.updatedDisease.picklistItemByDiseaseCategory2,a.disease&&a.disease.picklistItemByDiseaseCategory3&&!a.disease.picklistItemByDiseaseCategory3.id&&delete a.updatedDisease.picklistItemByDiseaseCategory3,a.disease&&a.disease.picklistItemByDiseaseCategory4&&!a.disease.picklistItemByDiseaseCategory4.id&&delete a.updatedDisease.picklistItemByDiseaseCategory4,a.disease&&a.disease.picklistItemByDiseaseCategory5&&!a.disease.picklistItemByDiseaseCategory5.id&&delete a.updatedDisease.picklistItemByDiseaseCategory5,q.updateRequest(a.updatedDisease,function(a){a&&(d.go("searchDiseases"),f("success",h.instant("RECORD_UPDATED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function t(){var b={};b.code="DISEASE_CATEGORY_1",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseTypes1=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function u(){var b={};b.code="DISEASE_CATEGORY_2",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseTypes2=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function v(){var b={};b.code="DISEASE_CATEGORY_3",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseTypes3=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function w(){var b={};b.code="DISEASE_CATEGORY_4",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseTypes4=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function x(){var b={};b.code="DISEASE_CATEGORY_5",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.diseaseTypes5=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function y(c){var d={};return d.keyword=c,d.orgId=b.loggedInUserDetails.organizationId,n.getData(o.getParameterizedUrl("GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD",d),null,function(b){if(b&&b.data)return a.creatingOrganization=b.data,a.creatingOrganization},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}a.DiseaseRequest={},b.pageData={},a.disease={picklistItemByDiseaseCategory1:{},picklistItemByDiseaseCategory2:{},picklistItemByDiseaseCategory3:{},picklistItemByDiseaseCategory4:{},picklistItemByDiseaseCategory5:{}},a.oldDisease={},a.updateDiseaseRequest=s,a.getDiseaseCategoryType1=t,a.getDiseaseCategoryType2=u,a.getDiseaseCategoryType3=v,a.getDiseaseCategoryType4=w,a.getDiseaseCategoryType5=x,a.getCreatingLocation=y,a.cancel=function(){m.goBackToPrevState()},a.initDiseaseById=function(){a.getDiseaseCategoryType1(),a.getDiseaseCategoryType2(),a.getDiseaseCategoryType3(),a.getDiseaseCategoryType4(),a.getDiseaseCategoryType5(),/*if($stateParams.data){
			$scope.disease=$stateParams.data;
			$scope.oldDisease = $scope.disease.diseaseNameCode;
			$scope.disease.diseaseNameCode = $scope.disease.diseaseNameCode.value;
		}else*/
c.id&&
//searchDiseaseReqService.getDiseaseById($stateParams.id, function(sucessResponse){
q.getDiseaseById(c.id,function(b){a.disease=b,a.oldDisease=a.disease.diseaseNameCode,a.disease.diseaseNameCode=a.disease.diseaseNameCode.value},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}),"edit"===c.type&&(a.pageState="edit",a.viewmode=!1),"view"===c.type&&(a.pageState="view",a.viewmode=!0)},a.initDiseaseById()}]),angular.module("paripal.diseaseManagementModule").controller("manageDiseaseSymptomCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageDiseaseSymptomService","httpService","urlService","utilService","fileOperations","commonConstants","searchDiseaseSymptomsService","manageAttachmentService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(b){
//$scope.symptomName = {};
//$scope.symptomName.symptomName = viewValue;
//$scope.symptomLoad = true;
return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,k.getData(l.getParameterizedUrl("GET_SYMPTOMS_BY_SEARCH_CRITERIA",a.searchKeyWord),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function t(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function u(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseSymptom&&a.diseaseSymptom.disease?(a.searchKeyWord.diseaseId=a.diseaseSymptom.disease.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function v(b){a.queryObj={},a.queryObj.keyword=b;var c=l.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function w(){
//$state.go('searchDiseaseSymptoms', { type: '' });
m.goBackToPrevState()}function x(b,c,e){var g=new Object;g.file=c.fileToBeUpload,g.orgLocId=a.diseaseSymptom.creatingOrganization.id,g.docType=o.documentTypes.disease,g.docSubType=o.documentSubTypes.diseaseSymptoms,g.isThumbnailRequired=!1,m.isNullOrEmpty(e)||m.isNullOrEmpty(e.response)||(
//paramObject.recordId = successParentResponse.data.response;
//paramObject.resourceId=successParentResponse.data.response;
g.resourceId=e.response),n.uploadFile(g,function(b){m.isNullOrEmpty(e.successMessage)||(A.documentId=e.response,j.saveDiseaseSymptom(A,function(b){b&&(d.go("searchDiseaseSymptoms"),a.diseaseSymptom&&a.diseaseSymptom.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},function(a){m.isNullOrEmpty(e.response)||j.deleteBySymptomId(e.response.id,function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))},function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))})})}function y(b,c){if(!m.isEmpty(c)){var d=new Object;d.fileName=c.symptomHandling,d.orgLocId=a.diseaseSymptom.creatingOrganization.id,
//fileObject.recordId = resource.id;
d.resourceId=c.documentId,d.docType=o.documentTypes.disease,d.docSubType=o.documentSubTypes.diseaseSymptoms,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable}}function z(){A=angular.copy(a.diseaseSymptom);var b={};b.id=a.diseaseSymptom.symptom.id,A.symptom=b,a.diseaseSymptom&&(a.diseaseSymptom.category1?
//if($scope.diseaseSymptom.category1.dataValue){
a.diseaseSymptom.category1.id&&(A.category1.id=a.diseaseSymptom.category1.id):delete A.category1,a.diseaseSymptom.category2?
//if($scope.diseaseSymptom.category2.dataValue){
a.diseaseSymptom.category2.id&&(A.category2.id=a.diseaseSymptom.category2.id):delete A.category2,void 0==a.diseaseSymptom.measurable&&(A.measurable=!1),void 0==a.diseaseSymptom.whetherActive&&(A.whetherActive=!1)),a.diseaseSymptomFile.fileToBeUpload?(a.documentUpload.document.fileName=a.diseaseSymptomFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.diseaseSymptomFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.diseaseSymptom.creatingOrganization.id,a.documentUpload.document.documentType={subType:o.documentSubTypes.diseaseSymptoms},"add"!=c.type&&(a.documentUpload.document.id=a.diseaseSymptom.documentId),q.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.diseaseSymptomFile.fileToBeUpload&&a.diseaseSymptomFile&&a.diseaseSymptomFile.fileToBeUpload&&a.diseaseSymptomFile.fileToBeUpload.name&&a.uploadFile(A,a.diseaseSymptomFile,b)},function(b){a.attachmentFormSpinner=!1})):j.saveDiseaseSymptom(A,function(b){b&&(d.go("searchDiseaseSymptoms"),a.diseaseSymptom&&a.diseaseSymptom.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}a.viewmode=!1,a.resource={},a.diseaseSymptom={},a.diseaseSymptomFile={},a.diseaseSymptomFile.fileToBeUpload=null,a.documentUpload={};var A;a.documentUpload.document={},a.getSymptom=s,a.getDisease=t,a.getDiseaseVariant=u,a.getCreatingOrganization=v,a.saveDiseaseSymptom=z,a.cancel=w,a.uploadFile=x,a.viewPrintFile=y,a.orgLocPermission=r.DISEASE_SYMPTOM_ADD,a.getSymptomCategory1=function(){var b={};b.code="DISEASE_SYMPTOM_CATOGORY_1",k.getData(l.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.symptomCategory1=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getSymptomCategory1(),a.getSymptomCategory2=function(){var b={};b.code="DISEASE_SYMPTOM_CATOGORY_2",k.getData(l.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.symptomCategory2=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getSymptomCategory2(),a.initDiseaseSymptomById=function(){c.data?(a.diseaseSymptom=c.data,a.diseaseSymptom.symptom&&(a.diseaseSymptom.symptom.name=a.diseaseSymptom.symptom.value,a.diseaseSymptom.symptom.id=a.diseaseSymptom.symptom.id)):c.id&&p.getDiseaseSymptomById(c.id,function(b){a.diseaseSymptom=b,a.diseaseSymptom.symptom&&(a.diseaseSymptom.symptom.name=a.diseaseSymptom.symptom.value,a.diseaseSymptom.symptom.id=a.diseaseSymptom.symptom.id)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))}),"view"===c.type&&(a.pageState="view",a.viewmode=!0,a.IsVisible=!0),"edit"===c.type&&(a.pageState="edit",a.IsVisible=!0,a.orgLocPermission=r.DISEASE_SYMPTOM_EDIT)},a.initDiseaseSymptomById()}]),angular.module("paripal.diseaseManagementModule").controller("manageDiseaseSymptomsIncidentsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageDiseaseSymptomsIncidentsService","httpService","urlService","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}/*function getSymptom(viewValue){
		$scope.symptomName = {};
		$scope.symptomName.searchKeyWord = viewValue;
		$scope.symptomLoad = true;
		return httpService.getData(urlService.getParameterizedUrl('GET_SYMPTOMS', 
				$scope.searchKeyWord), null, function (response) {
			$scope.symptomLoad = false;
			return $scope.symptomLoad = angular.fromJson(response.data);
		}, function (errorResponse) {
			$scope.symptomLoad = false;
			if (!utilService.isEmpty(errorResponse.data) && 
					!utilService.isEmpty(errorResponse.data.messages[0])) {
				notify("Alert", $translate.instant(errorResponse.data.messages[0]));
			} else {
				notify("error", $translate.instant("RECORD_SEARCH_FAILURE"));
			}
		});
	}*/
function p(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,k.getData(l.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function q(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.linkTypeLoad=!0,k.getData(l.getParameterizedUrl("GET_LINK_TYPE",a.searchKeyWord),null,function(b){return a.linkTypeLoad=!1,a.linkTypeLoad=angular.fromJson(b.data)},function(b){a.linkTypeLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function r(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.incidentTypeLoad=!0,k.getData(l.getParameterizedUrl("GET_INCIDENT_TYPE",a.searchKeyWord),null,function(b){return a.incidentTypeLoad=!1,a.incidentTypeLoad=angular.fromJson(b.data)},function(b){a.incidentTypeLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function s(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseSymLink&&a.diseaseSymLink.disease?(a.searchKeyWord.diseaseId=a.diseaseSymLink.disease.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function t(b){a.queryObj={},a.queryObj.keyword=b;var c=l.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function u(){
//$state.go('searchDiseaseSymptomsIncidents', { type: '' });
m.goBackToPrevState()}function v(){var b=angular.copy(a.diseaseSymLink),c={};c.id=a.diseaseSymLink.symptom.id,b.symptom=c,/*if($scope.diseaseSymLink.isActive == undefined){
			newRecord.isActive = false;
		}*/
j.save(b,function(b){b&&(d.go("searchDiseaseSymptomsIncidents"),null!=a.diseaseSymLink.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.diseaseSymLink={},a.getIncidentType=r,a.getDisease=o,a.getDiseaseVariant=s,a.getSymptom=p,a.getLinkType=q,a.getCreatingOrgLoc=t,a.save=v,a.cancel=u,a.orgLocPermission=n.DISEASE_SYMPTOM_INCIDENT_ADD,a.diseaseSymLink={isActive:!0},a.initDiseaseSymIncById=function(){c.data&&(a.diseaseSymLink=c.data,a.diseaseSymLink.symptom&&(a.diseaseSymLink.symptom.name=a.diseaseSymLink.symptom.value,a.diseaseSymLink.symptom.id=a.diseaseSymLink.symptom.id),"view"===c.type&&(a.pageState="view",a.viewmode=!0,a.IsVisible=!0),"edit"===c.type&&(a.pageState="edit",a.viewmode=!1,a.IsVisible=!0,a.orgLocPermission=n.DISEASE_SYMPTOM_ADD))},a.initDiseaseSymIncById()}]),angular.module("paripal.diseaseManagementModule").controller("manageDiseaseVariantsReqCtrl",["$scope","$rootScope","httpService","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageDiseaseVariantsReqService","utilService","urlService","searchDiseaseVariantsReqService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseSymptom&&a.diseaseSymptom.disease?(a.searchKeyWord.diseaseId=a.diseaseSymptom.disease.id,a.diseaseVariantLoad=!0,c.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?g("error",i.instant("RECORD_SEARCH_FAILURE")):g("Alert",i.instant(b.data.messages[0]))})):void g("error",i.instant("Select Disease"))}a.getDiseaseVariant=o,/* $scope.variant={
            		picklistItemByDiseaseCategory1:{},
            		picklistItemByDiseaseCategory2:{},
            		picklistItemByDiseaseCategory3:{},
            		picklistItemByDiseaseCategory4:{},
            		picklistItemByDiseaseCategory5:{}
            };
            */
a.saveDieaseVariant=function(){a.diseaseVariant&&a.diseaseVariant.variantNameCode&&(delete a.diseaseVariant.variantNameCode.mutable,delete a.diseaseVariant.variantNameCode.id,delete a.diseaseVariant.variantNameCode.organizationLocationId),k.saveDieaseVariant(a.diseaseVariant,function(b){b&&(e.go("searchDiseaseVariants"),a.variant&&a.variant.id?g("success",i.instant("RECORD_UPDATED_SUCCESS")):g("success",i.instant("RECORD_SAVED_SUCCESS")))},function(a){l.isEmpty(a.data)||l.isEmpty1z(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.init=function(){"edit"===d.type,"view"===d.type&&(a.pageState="view",a.viewmode=!0),d.data?a.diseaseVariant=d.data:d.id&&n.getVariantById(d.id,function(b){a.manageOrgLocSpinner=!1,a.diseaseVariant=b},function(b){a.manageOrgLocSpinner=!1,a.error=b})},a.cancel=function(){l.goBackToPrevState()},a.getCreatingLocation=function(b){var d={};
//userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return d.keyword=b,c.getData(m.getParameterizedUrl("GET_ORG_LIST_BY_KEYWORD",d),null,function(b){if(b&&b.data)return a.creatingOrganization=b.data,a.creatingOrganization},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDiseaseCategoryType1=function(){var b={};b.code="DISEASE_VARIANT_CATEGORY_1",c.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.categoryType1=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDiseaseCategoryType2=function(){var b={};b.code="DISEASE_VARIANT_CATEGORY_2",c.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.categoryType2=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDiseaseCategoryType3=function(){var b={};b.code="DISEASE_VARIANT_CATEGORY_3",c.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.categoryType3=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDiseaseCategoryType4=function(){var b={};b.code="DISEASE_VARIANT_CATEGORY_4",c.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.categoryType4=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDiseaseCategoryType5=function(){var b={};b.code="DISEASE_VARIANT_CATEGORY_5",c.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.categoryType5=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDiseaseCategoryType1(),a.getDiseaseCategoryType2(),a.getDiseaseCategoryType3(),a.getDiseaseCategoryType4(),a.getDiseaseCategoryType5(),a.init()}]),angular.module("paripal.diseaseManagementModule").controller("medicationStatisticsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","medicationStatisticsService","searchDiseaseVariantsReqService","httpService","urlService","dateconvertor","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Value of order by "+a.brand,c.count=a.valueOfOrder,b.push(c)}),b}function q(a,b,c){var d=a.concat(b),e=d.concat(c);return e}function r(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Prescirption Raised by "+a.brand,c.count=a.noOfPrescribtionRaised,b.push(c)}),b}function s(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Total Users by "+a.variantName,c.count=a.totUser,b.push(c)}),b}function t(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Total Users by "+a.brand,c.count=a.totUser,b.push(c)}),b}function u(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Active Users by "+a.variantName,c.count=a.totActiveUser,b.push(c)}),b}function v(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Active Users by "+a.brand,c.count=a.totUser,b.push(c)}),b}function w(b){return a.searchKeyWord={},a.searchKeyWord.medication=b,a.medicationLoad=!0,l.getData(m.getParameterizedUrl("SEARCH_MEDICATION",a.searchKeyWord),null,function(b){return a.medicationLoad=!1,a.medication=angular.fromJson(b.data)},function(b){a.medicationLoad=!1})}function x(b){a.queryObj={},a.queryObj.id=b;var c=m.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&l.getData(c,null,function(b){b&&b.data&&(a.variantList=b.data)},function(a){})}function y(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseMedication&&a.diseaseMedication.diseaseId?(a.searchKeyWord.diseaseId=a.diseaseMedication.diseaseId.id,a.diseaseVariantLoad=!0,l.getData(m.getParameterizedUrl("GET_DISEASE_VARIANTS",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,utilService.isEmpty(b.data)||utilService.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}a.diseaseMedication={},a.getVariant=x,a.getMedication=w,
//$scope.getvariantId=variantId;
//$scope.chartTypes =[{'Name':'User By Brand(Bar-Chart)','key':'Chart-1','value':'Bar-Chart'},{'Name':'Value of Order by Brand(Bar-Chart)','key':'Chart-2','value':'Bar-Chart'},{'Name':'User By Disease Variant(Bar-Chart)','key':'Chart-3','value':'Bar-Chart'}];
a.variantList={},a.getDiseaseVariant=y,a.maxDate=new Date,a.minDate=new Date,
//            $scope.chart = {};
a.medicationAnalysisData={},a.getTotalUser=t,a.getTotalUserActive=v,a.getTotalUserByDiseaseVariant=s,a.getTotalUserActiveByDiseaseVariant=u,a.getvalueOfOrderByBrand=p;/*****    from disease medication/ user medication page  *****/
if(a.getChartName=function(){a.chartTypes=[{Name:"User By Brand(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"},{Name:"Value of Order by Brand(Bar-Chart)",key:"Chart-2",value:"Bar-Chart"},{Name:"User By Disease Variant(Bar-Chart)",key:"Chart-3",value:"Bar-Chart"}]},a.setDirectiveFn=function(b){
// console.log('in setDirectiveFn');
a.barChartCreateFunction=b},a.getTillDate=function(b){a.minDate=b},a.getmedicationAnalysis=function(b,c){var d=angular.copy(b);
//         if(medicationAnalysisData.variantId && !medicationAnalysisData.variantId.id ){
//     medicationAnalysisData.variantId = '';
//     notify("error", $translate.instant("Select Specific Disease Variant"));
//     return;
// }
//    if(medicationAnalysisData.dateFrom != null){
//    	medicationAnalysisData.dateFrom = dateconvertor.convertToServerDate(medicationAnalysisData.dateFrom);
//    }
// if(medicationAnalysisData.tillDate !=null){
// 	medicationAnalysisData.tillDate = dateconvertor.convertToServerDate(medicationAnalysisData.tillDate);	
// }
return b.diseaseId&&!b.diseaseId.id?(b.diseaseId="",void f("error",h.instant("Select Specific Disease"))):b.variantId&&!b.variantId.id?(b.variantId="",void f("error",h.instant("Select Specific Disease Variant"))):(d.medicationId&&d.medicationId.id&&(d.medicationId=d.medicationId.id),d.medicationVariantId&&(a.medicationVariantId=[],d.medicationVariantId.forEach(function(b){a.medicationVariantId.push(b.id)}),d.medicationVariantId=a.medicationVariantId),d.diseaseId&&d.diseaseId.id&&(d.diseaseId=d.diseaseId.id),d.variantId&&d.variantId.id&&(d.variantId=d.variantId.id),void j.getmedicationAnalysis(d,c,function(b){b&&(0==b.length?(a.norecordfound=!0,a.chart=!1):"Bar-Chart"==c.value&&(a.getBarChart(d,b,c),a.norecordfound=!1),a.chart=!0,a.chartType=c)},function(a){}))},a.getBarChart=function(b,c,d){if("Chart-1"===d.key&&"Bar-Chart"===d.value){var e=t(c),f=v(c),g=r(c);a.chartData=q(e,f,g),a.barChartCreateFunction()}if("Chart-2"===d.key&&"Bar-Chart"===d.value&&(a.chartData=p(c),a.barChartCreateFunction()),"Chart-3"===d.key&&"Bar-Chart"===d.value){var e=s(c),f=u(c);a.chartData=e.concat(f),a.barChartCreateFunction()}},c.from&&"searchMedication"==c.from){var z={};if(c.medicationId&&c.diseaseId&&c.diseaseVariantId){
// $scope.getVariant($stateParams.medicationId);
z.diseaseId={},z.diseaseId.id=c.diseaseId,z.variantId={},z.medicationVariantId=[];var A={};A.id=c.medicationVariantId,A.value=c.medicationVariantName,a.variantList=[],a.variantList.push(A),z.medicationVariantId.push(A),z.variantId.id=c.diseaseVariantId,z.medicationId={},z.medicationId.id=c.medicationId,a.diseaseMedication=z,a.diseaseMedication.diseaseId.value=c.diseaseName,a.diseaseMedication.variantId.value=c.diseaseVariantName,a.diseaseMedication.medicationId.value=c.medicationName}else c.medicationId&&c.diseaseId&&(z.diseaseId={},z.diseaseId.id=c.diseaseId,z.medicationId={},z.medicationId.id=c.medicationId,a.diseaseMedication=z,a.diseaseMedication.diseaseId.value=c.diseaseName,a.diseaseMedication.medicationId.value=c.medicationName);var B={Name:"User By Disaese Variant(Bar-Chart)",key:"Chart-3",value:"Bar-Chart"};a.chart=B,a.getmedicationAnalysis(z,B)}/*****    from disease varient page  *****/
if(c.from&&"diseaseVariant"==c.from){var C={};c.diseaseId&&c.diseaseVariantId&&(C.diseaseId={},C.diseaseId.id=c.diseaseId,C.variantId={},C.variantId.id=c.diseaseVariantId,a.diseaseMedication.diseaseId={},a.diseaseMedication.diseaseId.id=c.diseaseId,a.diseaseMedication.diseaseId.value=c.diseaseName,a.diseaseMedication.variantId={},a.diseaseMedication.variantId.id=c.diseaseVariantId,a.diseaseMedication.variantId.value=c.diseaseVariantName);var B={Name:"User By Disaese Variant(Bar-Chart)",key:"Chart-3",value:"Bar-Chart"};a.chart=B,a.getmedicationAnalysis(C,B)}
//data table config
var D=o.gridConfigurations;a.options=g.setOptionProperties(D),a.dtColumnDefs=g.setColumnProperties({}),a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return l.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){utilService.isEmpty(a.data)||utilService.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.clear=function(){a.diseaseMedication={},a.datas=[],a.data=[],a.chart="",a.chartType="",a.getChartName(),a.chart=!1},a.getChartName()}]),angular.module("paripal.diseaseManagementModule").controller("searchDiseaseIncidentsCtrl",["$scope","$rootScope","$stateParams","$state","$location","$cookies","fileReader","notify","datatableconfig","$translate","serverSidePagination","commonConstants","httpService","urlService","utilService","searchDiseaseIncidentService","resourceListService","ForumService","baseConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){a.forum.pageNumber=a.currentPage,a.forum.recordsPerPage=a.itemPerPage,a.user.organizationId&&a.user.isOrganizationUserMode&&(a.forum.orgId=a.user.organizationId),r.getForumsByUser(a.forum,function(b){a.forumList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.forumList.forEach(function(b){a.userForumIds.push(b.jforumId),a.isOrgUser?b.userId==a.userId?(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Organisation Specific"==b.forumType&&b.userId!=a.userId?u("org_forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Public"==b.forumType&&b.userId!=a.userId&&u("forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):!a.isOrgUser&&b.admin&&b.admin==a.userId&&"Interest Group"==b.forumType&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId))}),f.put("adminForums",a.adminForumIds.toString(),{path:"/"}),f.put("forumIds",a.userForumIds.toString(),{path:"/"}),f.put("categoryIds",a.userCategIds.toString(),{path:"/"}),f.put("userToken",localStorage.getItem("paripal_token"),{path:"/"})})}function u(a){var c=!1;if(!o.isEmpty(b.loggedInUserDetails.locationConsolidatedPrivileges)){var d=b.loggedInUserDetails.locationConsolidatedPrivileges;o.isEmpty(d)||d.indexOf(a)>-1&&(c=!0)}return c}
//getting accessabel system locations
function v(){m.getData(n.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||h("error",j.instant(a.data.messages[0]))})}function w(b){var c=!1;return a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){if(a&&b&&a.id==b)return c=!0}),c}function x(b){var c={};return c.searchKeyWord=b,a.searchDiseaseInc&&a.searchDiseaseInc.disease?(c.diseaseId=a.searchDiseaseInc.disease.id,a.diseaseVariantLoad=!0,m.getData(n.getParameterizedUrl("GET_DISEASE_VARIANTS",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||h("error",j.instant(b.data.messages[0]))})):void h("error",j.instant("Select Disease"))}function y(b,c){var d={};d.id=b,p.toggleChangeStatus(d,function(b){b&&(a.searchDiseaseIncident[c].whetherActive=!a.searchDiseaseIncident[c].whetherActive,h("success",j.instant("RECORD_UPDATED_SUCCESS")))},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])?h("error",j.instant("RECORD_UPDATE_FAILURE")):h("Alert",j.instant(a.data.messages[0]))})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.getDiseaseVariant=x,a.searchDiseaseInc={},a.searchDiseaseIncident={},a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.forum={},a.forumList=[],a.userForumIds=[],a.userCategIds=[],a.adminForumIds=[],a.toggleChangeStatus=y,a.getAccessabelSystemLocation=v,a.checkOrganizationLocationAccess=w,a.checkPermission=u,a.getForumsByUser=t,a.redirectTO=function(){d.go("manageDiseaseIncidents")},f.put("username",a.user.displayName,{path:"/"}),f.put("emailId",a.email1,{path:"/"}),a.user.organizationId&&a.user.isOrganizationUserMode?(a.isOrgUser=!0,f.put("userMode","orgUser",{path:"/"})):f.put("userMode","indUser",{path:"/"}),a.redirectToForumPost=function(a){var b=s.jforumUrl+"/jforum.page?module=search&action=search&search_keywords="+a+"&match_type=all&search_forum=&sort_by=relevance";window.open(b),f.put("searchkeyword",a,{path:"/"})},t(),a.redirectToViewIncidentStatistics=function(a){a&&a.incidentType&&a.disease&&a.diseaseVariant?d.go("viewIncidentStatistics",{incidentTypeId:a.incidentType.id,incidentTypeName:a.incidentType.value,diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,from:"diseaseIncident"}):a&&a.incidentType&&a.disease&&d.go("viewIncidentStatistics",{incidentTypeId:a.incidentType.id,incidentTypeName:a.incidentType.value,diseaseId:a.disease.id,diseaseName:a.disease.value,from:"diseaseIncident"})},a.redirectToSearchSymptomsIncidents=function(a){d.go("searchDiseaseSymptomsIncidents",{incidentOrSymptomId:a.id,value:"incident"})},a.redirectToForum=function(){},a.redirectToChecklist=function(a){q.getCheckListTypeByCode("INCIDENT",function(b){b&&d.go("resourcelist",{checklistTypeId:b.id,resourceNameContains:a.incidentType.value})},function(a){})},v();
// apply filter when calling from disease variant page
var z;c.diseaseVariantId&&(z||(z={}),z.diseaseVariant||(z.diseaseVariant={}),z.diseaseVariant.id=c.diseaseVariantId),a.getIncidentList=function(){o.isFieldEmpty(a.searchDiseaseInc)||(z=angular.copy(a.searchDiseaseInc));var b={};o.isFieldEmpty(z)||(z.disease&&z.disease.id&&(b.diseaseId=z.disease.id),z.diseaseVariant&&z.diseaseVariant.id&&(b.variantId=z.diseaseVariant.id)),c.diseaseVariantId&&(b.variantId=c.diseaseVariantId,a.searchDiseaseInc.disease=c.diseaseName,a.searchDiseaseInc.diseaseVariant=c.diseaseVariantName),/********* from user incident************/
c.from&&"userIncident"==c.from&&(b.variantId=c.diseaseVariantId,b.diseaseId=c.diseaseId,a.searchDiseaseInc.disease=c.diseaseName,a.searchDiseaseInc.diseaseVariant=c.diseaseVariantName),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,p.getIncidentList(b,function(b){b&&(a.searchDiseaseIncident=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems))},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||h("error",j.instant(a.data.messages[0]))})},a.getIncidentList(),a.curdIncident=function(a,b){p.getIncidentById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageDiseaseIncidents",{id:a,type:e,data:f})},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||h("error",j.instant(a.data.messages[0]))})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=n.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||h("error",j.instant(a.data.messages[0]))})},a.clear=function(){a.searchDiseaseInc={},z={},e.$$url&&c.diseaseVariantId&&(c.diseaseVariantId=null,delete e.$$url,e.$$url="/searchDiseaseIncidents/",e.path("/searchDiseaseIncidents/"),
//$location.replace();
e.$$compose()),c.incidentTypeId=null,c.incidentTypeName=null,c.diseaseId=null,c.diseaseName=null,c.diseaseVariantId=null,c.diseaseVariantName=null,d.go("searchDiseaseSymptoms",{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1}),a.getIncidentList()},a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.getIncidentList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getIncidentList()};var A=l.gridConfigurations;a.options=i.setOptionProperties(A),a.dtColumnDefs=i.setColumnProperties({})}]),angular.module("paripal.diseaseManagementModule").controller("searchDiseaseMedicationCtrl",["$scope","$rootScope","$stateParams","$state","$http","fileReader","notify","datatableconfig","$location","$translate","$cookies","serverSidePagination","searchDiseaseMedicationService","httpService","urlService","utilService","ForumService","commonConstants","baseConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";
// view forum post
function t(){a.forum.pageNumber=a.currentPage,a.forum.recordsPerPage=a.itemPerPage,a.user.organizationId&&a.user.isOrganizationUserMode&&(a.forum.orgId=a.user.organizationId),q.getForumsByUser(a.forum,function(b){a.forumList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems),a.forumList.forEach(function(b){a.userForumIds.push(b.jforumId),a.isOrgUser?b.userId==a.userId?(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Organisation Specific"==b.forumType&&b.userId!=a.userId?u("org_forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Public"==b.forumType&&b.userId!=a.userId&&u("forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):!a.isOrgUser&&b.admin&&b.admin==a.userId&&"Interest Group"==b.forumType&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId))}),k.put("adminForums",a.adminForumIds.toString(),{path:"/"}),k.put("forumIds",a.userForumIds.toString(),{path:"/"}),k.put("categoryIds",a.userCategIds.toString(),{path:"/"}),k.put("userToken",localStorage.getItem("paripal_token"),{path:"/"})})}function u(a){var c=!1;if(!p.isEmpty(b.loggedInUserDetails.locationConsolidatedPrivileges)){var d=b.loggedInUserDetails.locationConsolidatedPrivileges;p.isEmpty(d)||d.indexOf(a)>-1&&(c=!0)}return c}function v(){p.isFieldEmpty(a.filter)||(F=angular.copy(a.filter));
//var filterdata = $scope.filter;
var b={};p.isFieldEmpty(F)||(F.disease&&F.disease.id&&(b.diseaseId=F.disease.id),F.variant&&F.variant.id&&(b.variantId=F.variant.id),c.diseaseVariantId&&(b.variantId=c.diseaseVariantId,a.filter.disease=c.disease,a.filter.variant=c.diseaseVariant)),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,m.fetchDiseaseMedications(b,function(b){b&&(a.diseaseMedications=b.data,a.totalItems=b.totalRecords,a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems))})}function w(){d.go("manageDiseaseMedication",{type:""})}function x(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,n.getData(o.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",j.instant("RECORD_SEARCH_FAILURE")):g("Alert",j.instant(b.data.messages[0]))})}function y(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.disease?(a.searchKeyWord.diseaseId=a.filter.disease.id,a.diseaseVariantLoad=!0,n.getData(o.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",j.instant("RECORD_SEARCH_FAILURE")):g("Alert",j.instant(b.data.messages[0]))})):void g("error",j.instant("Select Disease"))}
//getting accessabel system locations
function z(){n.getData(o.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||g("error",j.instant(a.data.messages[0]))})}function A(b,c){m.getDiseaseMedicationById(b,function(e){a.diseaseMedication=e;var f;f=c?"edit":"view",d.go("manageDiseaseMedication",{id:b,type:f,data:a.diseaseMedication})},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?g("error",j.instant("RECORD_SEARCH_FAILURE")):g("Alert",j.instant(a.data.messages[0]))})}function B(b,c){var d={};d.id=b,m.toggleDiseaseMedication(d,function(b){b&&(a.diseaseMedications[c].active=!a.diseaseMedications[c].active,g("success",j.instant("RECORD_UPDATED_SUCCESS")))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?g("error",j.instant("RECORD_UPDATE_FAILURE")):g("Alert",j.instant(a.data.messages[0]))})}/*function statDiseaseMedication() {
		$state.go('viewMedicationStatistics');
	}
	*/
function C(a){a&&a.medication&&a.disease&&a.diseaseVariant?d.go("viewMedicationStatistics",{medicationId:a.medication.id,medicationName:a.medication.value,medicationVariantId:a.medicationVariant.id,medicationVariantName:a.medicationVariant.value,diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,from:"searchMedication"}):a&&a.medication&&a.disease&&d.go("viewMedicationStatistics",{medication:a.medication.id,medicationName:a.medication.value,diseaseId:a.disease.id,diseaseName:a.disease.value,from:"searchMedication"})}function D(){a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems),a.fetchDiseaseMedications()}function E(b){a.pageNumber=1,a.itemPerPage=b,a.fetchDiseaseMedications()}a.searchMedication={},a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.filter={},a.forum={},a.forumList=[],a.userForumIds=[],a.userCategIds=[],a.adminForumIds=[],a.accessabelSystemLocation={},a.whetherSystemUser=!1,a.getForumsByUser=t,a.fetchDiseaseMedications=v,a.getDisease=x,a.getDiseaseVariant=y,a.crudDiseaseMedication=A,a.addNewDiseaseMedication=w,a.pageChanged=D,a.setMaxRecords=E,a.toggleDiseaseMedication=B,a.statDiseaseMedication=C,a.getAccessabelSystemLocation=z,a.checkPermission=u,k.put("username",a.user.displayName,{path:"/"}),k.put("emailId",a.email1,{path:"/"}),a.user.organizationId&&a.user.isOrganizationUserMode?(a.isOrgUser=!0,k.put("userMode","orgUser",{path:"/"})):k.put("userMode","indUser",{path:"/"}),a.viewForumDiseaseMedication=function(a){var b=s.jforumUrl+"/jforum.page?module=search&action=search&search_keywords="+a+"&match_type=all&search_forum=&sort_by=relevance";window.open(b),k.put("searchkeyword",a,{path:"/"})},a.clear=function(){a.filter={},F={},a.varFilter={},c.diseaseVariantId=null,c.diseaseVariant=null,c.disease=null,d.go("searchDiseaseMedication",{notify:!1},{notify:!1},{notify:!1}),a.fetchDiseaseMedications(),i.$$url&&c.diseaseVariantId&&(
//remove disease Variant Id from state params 
c.diseaseVariantId=null,delete i.$$url,i.$$url="/searchDiseaseMedication/",i.path("/searchDiseaseMedication/"),
//$location.replace();
i.$$compose())};
// apply filter when calling from disease variant page
var F;c.diseaseVariantId&&(F||(F={}),F.variant||(F.variant={}),F.variant.id=c.diseaseVariantId),v(),
//check weather the record created by this users organization
a.checkOrganizationLocationAccess=function(b){var c=!1;return a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){if(a&&b&&a.id==b)return c=!0}),c},a.initLoader=function(){t(),
//fetchDiseaseMedications();
z()},a.initLoader();
//data table config
var G=r.gridConfigurations;a.options=h.setOptionProperties(G),a.dtColumnDefs=h.setColumnProperties({})}]),angular.module("paripal.diseaseManagementModule").controller("searchDiseaseProtocolCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","diseaseProtocolService","httpService","urlService","utilService","commonConstants","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(){d.go("manageDiseaseProtocols",{type:""})}function q(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function r(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.disease?(a.searchKeyWord.diseaseId=a.filter.disease.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function s(b){a.queryObj={},a.queryObj.keyword=b;var c=l.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}
//getting accessabel system locations
function t(){k.getData(l.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!m.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function u(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.fetch()}function v(b){a.pageNumber=1,a.itemPerPage=b,a.fetch()}function w(b,c){j.getDiseaseProtocolById(b,function(e){a.protocol=e;var f;f=c?"edit":"view",d.go("manageDiseaseProtocols",{id:b,type:f,data:a.protocol})},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}function x(b,c){var b={id:b};j.inActivate(b,function(b){b&&(a.searchDiseaseProtocols.splice(c,1),a.fetch(),f("success",h.instant("RECORD_INACTIVATED_SUCCESSFULLY")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.addNew=p,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.filter={},a.getDiseaseVariant=r,a.getCreatingOrgLoc=s,a.getDisease=q,a.crud=w,a.pageChanged=u,a.setMaxRecords=v,a.inActivate=x,a.orgLocPermission=o.DISEASE_PROTOCOL_ADD,/*$scope.userOrganizationCategoryType =false;
    if($rootScope.loggedInUserDetails){
	if ($rootScope.loggedInUserDetails.userOrganizationCategoryType == "PRODUCT") {
		$scope.userOrganizationCategoryType = false;
	}else if ($rootScope.loggedInUserDetails.userOrganizationCategoryType == "SYSTEM") {
		$scope.userOrganizationCategoryType = true;
	}
    }*/
a.clear=function(){d.go("searchDiseaseProtocols"),a.filter={},a.fetch()},a.fetch=function(){var b=(a.filter,{});a.filter.diseaseVariant&&a.filter.diseaseVariant.id&&(b.diseaseVariantId=a.filter.diseaseVariant.id),a.filter.disease&&a.filter.disease.id&&(b.diseaseId=a.filter.disease.id),a.filter.creatingOrgLoc&&a.filter.creatingOrgLoc.id&&(b.creatingOrgLocId=a.filter.creatingOrgLoc.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,j.fetch(b,function(b){b&&(a.searchDiseaseProtocols=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))})};
//data table config
var y=n.gridConfigurations;a.options=g.setOptionProperties(y),a.dtColumnDefs=g.setColumnProperties({}),t(),
//check weather the record created by this users organization
a.checkOrganizationLocationAccess=function(b){var c=!1;return a.accessabelSystemLocation&&!m.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){if(a&&b&&a.id==b)return c=!0}),c},a.fetch()}]),angular.module("paripal.diseaseManagementModule").controller("searchDiseaseReqCtrl",["$scope","$rootScope","$stateParams","$state","$cookies","fileReader","notify","datatableconfig","$translate","serverSidePagination","commonConstants","searchDiseaseReqService","dateconvertor","urlService","httpService","utilService","ForumService","baseConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(){a.forum.pageNumber=a.currentPage,a.forum.recordsPerPage=a.itemPerPage,a.user&&a.user.organizationId&&a.user.isOrganizationUserMode&&(a.forum.orgId=a.user.organizationId,q.getForumsByUser(a.forum,function(b){a.forumList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.forumList.forEach(function(b){a.userForumIds.push(b.jforumId),a.isOrgUser?b.userId==a.userId?(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Organisation Specific"==b.forumType&&b.userId!=a.userId?t("org_forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Public"==b.forumType&&b.userId!=a.userId&&t("forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):!a.isOrgUser&&b.admin&&b.admin==a.userId&&"Interest Group"==b.forumType&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId))}),e.put("adminForums",a.adminForumIds.toString(),{path:"/"}),e.put("forumIds",a.userForumIds.toString(),{path:"/"}),e.put("categoryIds",a.userCategIds.toString(),{path:"/"}),e.put("userToken",localStorage.getItem("paripal_token"),{path:"/"})}))}function t(a){var c=!1;if(!p.isEmpty(b.loggedInUserDetails.locationConsolidatedPrivileges)){var d=b.loggedInUserDetails.locationConsolidatedPrivileges;p.isEmpty(d)||d.indexOf(a)>-1&&(c=!0)}return c}function u(a,b){l.getDiseaseById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageDiseases",{id:a,type:e,data:f})},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})}function v(){var b=(a.searchDisease,{});a.searchDisease.category&&(b.category=a.searchDisease.category.id),a.searchDisease.disContains&&(b.disease=a.searchDisease.disContains.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,l.getDiseaseList(b,function(b){b&&(a.searchDiseaseList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})}function w(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,o.getData(n.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",i.instant("RECORD_SEARCH_FAILURE")):g("Alert",i.instant(b.data.messages[0]))})}function x(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseCategoryLoad=!0,o.getData(n.getParameterizedUrl("GET_DISEASE_CATEGORY_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseCategoryLoad=!1,a.diseaseCategory=angular.fromJson(b.data)},function(b){a.diseaseCategoryLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",i.instant("RECORD_SEARCH_FAILURE")):g("Alert",i.instant(b.data.messages[0]))})}function y(a){var b={};b.id=a,l.toggleChangeStatus(b,function(a){a&&(d.go("searchDiseases"),
//$scope.searchDiseaseList[index].whetherActive = !$scope.searchDiseaseList[index].whetherActive;
g("success",i.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?g("error",i.instant("RECORD_UPDATE_FAILURE")):g("Alert",i.instant(a.data.messages[0]))})}
//getting accessabel system locations
function z(){o.getData(n.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})}
//check weather the record created by this users organization
function A(b){var c=!1;return a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){a&&b&&a.id==b&&(c=!0)}),c}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.searchDisease={},a.searchDiseaseList={},a.forum={},a.forumList=[],a.userForumIds=[],a.userCategIds=[],a.adminForumIds=[],a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.crudDisease=u,a.getDiseaseList=v,a.toggleChangeStatus=y,a.getDisease=w,a.getDiseaseCategory=x,a.getAccessabelSystemLocation=z,a.checkOrganizationLocationAccess=A,a.checkPermission=t,a.getForumsByUser=s,/*$scope.userOrganizationCategoryType =false;
	if($rootScope.loggedInUserDetails){
		if ($rootScope.loggedInUserDetails.userOrganizationCategoryType == "PRODUCT") { //individual user mode case
			$scope.userOrganizationCategoryType = true;
		}else if($rootScope.loggedInUserDetails.userOrganizationCategoryType == "SYSTEM"){
			$scope.userOrganizationCategoryType = true;
			
		}
	    }
*/
a.redirectToForumPost=function(b){if(a.user){var c=r.jforumUrl+"/jforum.page?module=search&action=search&search_keywords="+b+"&match_type=all&search_forum=&sort_by=relevance";window.open(c),e.put("searchkeyword",b,{path:"/"})}},a.user&&(e.put("username",a.user.displayName,{path:"/"}),e.put("emailId",a.email1,{path:"/"})),a.user&&a.user.organizationId&&a.user.isOrganizationUserMode?(a.isOrgUser=!0,e.put("userMode","orgUser",{path:"/"})):e.put("userMode","indUser",{path:"/"}),s(),a.clear=function(){a.searchDisease={},v()},a.redirectToSearchDiseaseVariant=function(a){d.go("searchDiseaseVariants",{diseaseId:a.id})},a.redirectToViewDiseaseStatistics=function(a){d.go("viewDiseaseStatistics",{diseaseId:a.id,diseaseName:a.diseaseNameCode.value,from:"disease"})},a.initLoad=function(){v(),z()},a.initLoad(),a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),v()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,v()};
//data table config
var B=k.gridConfigurations;a.options=h.setOptionProperties(B),a.dtColumnDefs=h.setColumnProperties({})}]),angular.module("paripal.diseaseManagementModule").controller("searchDiseaseSymptomsCtrl",["$scope","$rootScope","$stateParams","$state","$location","$cookies","fileReader","notify","datatableconfig","$translate","serverSidePagination","searchDiseaseSymptomsService","urlService","httpService","utilService","resourceListService","commonConstants","baseConfig","ForumService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){d.go("manageDiseaseSymptoms",{type:""})}function u(){a.forum.pageNumber=a.currentPage,a.forum.recordsPerPage=a.itemPerPage,a.user.organizationId&&a.user.isOrganizationUserMode&&(a.forum.orgId=a.user.organizationId),s.getForumsByUser(a.forum,function(b){a.forumList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.forumList.forEach(function(b){a.userForumIds.push(b.jforumId),a.isOrgUser?b.userId==a.userId?(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Organisation Specific"==b.forumType&&b.userId!=a.userId?v("org_forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Public"==b.forumType&&b.userId!=a.userId&&v("forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):!a.isOrgUser&&b.admin&&b.admin==a.userId&&"Interest Group"==b.forumType&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId))}),f.put("adminForums",a.adminForumIds.toString(),{path:"/"}),f.put("forumIds",a.userForumIds.toString(),{path:"/"}),f.put("categoryIds",a.userCategIds.toString(),{path:"/"}),f.put("userToken",localStorage.getItem("paripal_token"),{path:"/"})})}function v(a){var c=!1;if(!o.isEmpty(b.loggedInUserDetails.locationConsolidatedPrivileges)){var d=b.loggedInUserDetails.locationConsolidatedPrivileges;o.isEmpty(d)||d.indexOf(a)>-1&&(c=!0)}return c}function w(){o.isFieldEmpty(a.filter)||(H=a.filter);
//var filterdata=$scope.filter;
var b={};o.isFieldEmpty(H)||(H.disease&&H.disease.id&&(b.diseaseId=H.disease.id),H.variant&&H.variant.id&&(b.diseaseVariantId=H.variant.id),c.symptomId&&(b.symptomId=c.symptomId),c.diseaseVariantId&&(b.diseaseVariantId=c.diseaseVariantId,a.filter.disease=c.disease,a.filter.variant=c.diseaseVariant)),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,l.fetchDiseaseSymptoms(b,function(b){b&&(a.diseaseSymptoms=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems))})}function x(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,n.getData(m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])?h("error",j.instant("RECORD_SEARCH_FAILURE")):h("Alert",j.instant(b.data.messages[0]))})}function y(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.disease?(a.searchKeyWord.diseaseId=a.filter.disease.id,a.diseaseVariantLoad=!0,n.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])?h("error",j.instant("RECORD_SEARCH_FAILURE")):h("Alert",j.instant(b.data.messages[0]))})):void h("error",j.instant("Select Disease"))}function z(b,c){l.getDiseaseSymptomById(b,function(e){a.diseaseSymptom=e;var f;f=c?"edit":"view",d.go("manageDiseaseSymptoms",{id:b,type:f,data:a.diseaseSymptom})},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])?h("error",j.instant("RECORD_SEARCH_FAILURE")):h("Alert",j.instant(a.data.messages[0]))})}function A(b,c){var d={};d.id=b,l.toggleDiseaseSymptom(d,function(b){b&&(a.diseaseSymptoms[c].whetherActive=!a.diseaseSymptoms[c].whetherActive,h("success",j.instant("RECORD_UPDATED_SUCCESS")))},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])?h("error",j.instant("RECORD_UPDATE_FAILURE")):h("Alert",j.instant(a.data.messages[0]))})}function B(a){a&&a.symptom&&a.disease&&a.diseaseVariant?d.go("viewSymptomsStatistics",{symptomId:a.symptom.id,symptomName:a.symptom.value,diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,from:"diseaseSymptom"}):a.symptom&&a.disease&&d.go("viewSymptomsStatistics",{symptomId:a.symptom.id,symptomName:a.symptom.value,diseaseId:a.disease.id,diseaseName:a.disease.value,from:"diseaseSymptom"})}function C(a){d.go("searchDiseaseSymptomsIncidents",{incidentOrSymptomId:a.id,value:"symptom"})}
//getting accessabel system locations
function D(){n.getData(m.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||h("error",j.instant(a.data.messages[0]))})}
//check weather the record created by this users organization
function E(b){var c=!1;return a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){if(a&&b&&a.id==b)return c=!0}),c}function F(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.fetchDiseaseSymptoms()}function G(b){a.pageNumber=1,a.itemPerPage=b,a.fetchDiseaseSymptoms()}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.filter={},a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.forum={},a.forumList=[],a.userForumIds=[],a.userCategIds=[],a.adminForumIds=[];var H;a.addNew=t,a.fetchDiseaseSymptoms=w,a.getDisease=x,a.getDiseaseVariant=y,a.crudDiseaseSymptom=z,a.toggleDiseaseSymptom=A,a.statDiseaseSymptom=B,a.symInciDisLink=C,a.pageChanged=F,a.setMaxRecords=G,a.getAccessabelSystemLocation=D,a.checkOrganizationLocationAccess=E,a.checkPermission=v,a.getForumsByUser=u,
// view forum post
a.viewForumDiseaseSymptom=function(a){var b=r.jforumUrl+"/jforum.page?module=search&action=search&search_keywords="+a+"&match_type=all&search_forum=&sort_by=relevance";window.open(b),f.put("searchkeyword",a,{path:"/"})},f.put("username",a.user.displayName,{path:"/"}),f.put("emailId",a.email1,{path:"/"}),a.user.organizationId&&a.user.isOrganizationUserMode?(a.isOrgUser=!0,f.put("userMode","orgUser",{path:"/"})):f.put("userMode","indUser",{path:"/"}),u(),a.clear=function(){a.filter={},H={},e.$$url&&c.diseaseVariantId&&(c.diseaseVariantId=null,delete e.$$url,e.$$url="/searchDiseaseSymptoms/",e.path("/searchDiseaseSymptoms/"),
//$location.replace();
e.$$compose()),c.diseaseVariantId=null,c.diseaseVariant=null,c.disease=null,d.go("searchDiseaseSymptoms",{notify:!1},{notify:!1},{notify:!1}),a.fetchDiseaseSymptoms()},
// apply filter when calling from disease variant page
c.diseaseVariantId&&(H||(H={}),H.variant||(H.variant={}),H.variant.id=c.diseaseVariantId),a.fetchDiseaseSymptoms(),a.initLoad=function(){
//fetchDiseaseSymptoms();
D()},a.initLoad();
//data table config
var I=q.gridConfigurations;a.options=i.setOptionProperties(I),a.dtColumnDefs=i.setColumnProperties({}),a.redirectToChecklist=function(a){p.getCheckListTypeByCode("SYMPTOM",function(b){b&&d.go("resourcelist",{checklistTypeId:b.id,resourceNameContains:a.symptom.value})},function(a){})}}]),angular.module("paripal.diseaseManagementModule").controller("searchDiseaseSymptomsIncidentsCtrl",["$scope","$rootScope","$stateParams","$state","$location","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageDiseaseSymptomsIncidentsService","resourceListService","httpService","commonConstants","urlService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(){d.go("manageDiseaseSymptomsIncidents",{type:""})}function r(){p.isFieldEmpty(a.filter)||(C=angular.copy(a.filter));
//var filterdata=$scope.filter;
var b={};p.isFieldEmpty(C)||(C.disease&&C.disease.id&&(b.diseaseId=C.disease.id),C.variant&&C.variant.id&&(b.diseaseVariantId=C.variant.id),C.symptom&&C.symptom.id&&(b.symptomId=C.symptom.id),C.incidentType&&C.incidentType.id&&(b.incidentTypeId=C.incidentType.id)),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,k.fetchRecords(b,function(b){b&&(a.incilinks=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems))})}function s(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,m.getData(o.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",i.instant("RECORD_SEARCH_FAILURE")):g("Alert",i.instant(b.data.messages[0]))})}function t(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.disease?(a.searchKeyWord.diseaseId=a.filter.disease.id,a.diseaseVariantLoad=!0,m.getData(o.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",i.instant("RECORD_SEARCH_FAILURE")):g("Alert",i.instant(b.data.messages[0]))})):void g("error",i.instant("Select Disease"))}function u(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.incidentTypeLoad=!0,m.getData(o.getParameterizedUrl("GET_INCIDENT_TYPE",a.searchKeyWord),null,function(b){return a.incidentTypeLoad=!1,a.incidentTypeLoad=angular.fromJson(b.data)},function(b){a.incidentTypeLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",i.instant("RECORD_SERACH_FAILURE")):g("Alert",i.instant(b.data.messages[0]))})}function v(b){return a.symptomName={},a.symptomName.searchKeyWord=b,a.symptomLoad=!0,m.getData(o.getParameterizedUrl("GET_SYMPTOMS",a.searchKeyWord),null,function(b){return a.symptomLoad=!1,a.symptomLoad=angular.fromJson(b.data)},function(b){a.symptomLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?g("error",i.instant("RECORD_SEARCH_FAILURE")):g("Alert",i.instant(b.data.messages[0]))})}function w(b,c){k.getDiseaseSymInciById(b,function(e){a.disSymInci=e;var f;f=c?"edit":"view",d.go("manageDiseaseSymptomsIncidents",{id:b,type:f,data:a.disSymInci})},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?g("error",i.instant("RECORD_SEARCH_FAILURE")):g("Alert",i.instant(a.data.messages[0]))})}function x(b,c){var d={};d.id=b,k.toggleDiseaseSymptomLink(d,function(b){b&&(a.incilinks[c].isActive=!a.incilinks[c].isActive,g("success",i.instant("RECORD_UPDATED_SUCCESS")))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?g("error",i.instant("RECORD_UPDATE_FAILURE")):g("Alert",i.instant(a.data.messages[0]))})}
//getting accessabel system locations
function y(){m.getData(o.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})}
//check weather the record created by this users organization
function z(b){var c=!1;return a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){if(a&&b&&a.id==b)return c=!0}),c}function A(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()}function B(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.filter={};var C;a.addNew=q,a.fetchRecords=r,a.getDisease=s,a.getDiseaseVariant=t,a.getSymptom=v,a.getIncidentType=u,a.crud=w,a.pageChanged=A,a.setMaxRecords=B,a.toggleDiseaseSymptomLink=x,a.getAccessabelSystemLocation=y,a.checkOrganizationLocationAccess=z,a.clear=function(){a.filter={},C={},e.$$url&&c.incidentOrSymptomId&&(c.incidentOrSymptomId=null,delete e.$$url,e.$$url="/searchDiseaseSymptomsIncidents//",e.path("/searchDiseaseSymptomsIncidents//"),
//$location.replace();
e.$$compose()),a.fetchRecords()},
// apply filter when calling from disease incident page
c.incidentOrSymptomId&&(C||(C={}),"incident"==c.value&&(C.incidentType||(C.incidentType={}),C.incidentType.id=c.incidentOrSymptomId),"symptom"==c.value&&(C.symptom||(C.symptom={}),C.symptom.id=c.incidentOrSymptomId)),a.initLoad=function(){r(),y()},a.initLoad();
//data table config
var D=n.gridConfigurations;a.options=h.setOptionProperties(D),a.dtColumnDefs=h.setColumnProperties({}),a.redirectToChecklist=function(a){l.getCheckListTypeByCode("DISEASE",function(b){b&&d.go("resourcelist",{checklistTypeId:b.id,resourceNameContains:a.diseaseVariant.value})},function(a){})}}]),angular.module("paripal.diseaseManagementModule").controller("searchDiseaseVariantsReqCtrl",["$scope","$rootScope","$stateParams","$state","$location","fileReader","notify","datatableconfig","$translate","$cookies","commonConstants","serverSidePagination","urlService","httpService","utilService","baseConfig","ForumService","searchDiseaseVariantsReqService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(){a.forum.pageNumber=a.currentPage,a.forum.recordsPerPage=a.itemPerPage,a.user.organizationId&&a.user.isOrganizationUserMode&&(a.forum.orgId=a.user.organizationId),q.getForumsByUser(a.forum,function(b){a.forumList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems),a.forumList.forEach(function(b){a.userForumIds.push(b.jforumId),a.isOrgUser?b.userId==a.userId?(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Organisation Specific"==b.forumType&&b.userId!=a.userId?t("org_forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Public"==b.forumType&&b.userId!=a.userId&&t("forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):!a.isOrgUser&&b.admin&&b.admin==a.userId&&"Interest Group"==b.forumType&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId))}),j.put("adminForums",a.adminForumIds.toString(),{path:"/"}),j.put("forumIds",a.userForumIds.toString(),{path:"/"}),j.put("categoryIds",a.userCategIds.toString(),{path:"/"}),j.put("userToken",localStorage.getItem("paripal_token"),{path:"/"})})}function t(a){var c=!1;if(!o.isEmpty(b.loggedInUserDetails.locationConsolidatedPrivileges)){var d=b.loggedInUserDetails.locationConsolidatedPrivileges;o.isEmpty(d)||d.indexOf(a)>-1&&(c=!0)}return c}
//getting accessabel system locations
function u(){n.getData(m.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})}function v(b,c){var d={};d.id=b,r.toggleChangeStatus(d,function(b){b&&(a.searchDiseaseVariants[c].whetherActive=!a.searchDiseaseVariants[c].whetherActive,g("success",i.instant("RECORD_UPDATED_SUCCESS")))},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])?g("Alert",i.instant("RECORD_UPDATE_FAILURE")):g("error",i.instant(a.data.messages[0]))})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.searchVariantList={},a.diseaseVariant={},a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.forum={},a.forumList=[],a.userForumIds=[],a.userCategIds=[],a.adminForumIds=[],a.getAccessabelSystemLocation=u,a.accessabelSystemLocation={},a.toggleChangeStatus=v,a.checkPermission=t,a.getForumsByUser=s,a.redirectTO=function(){d.go("manageDiseaseVariants")},
// view forum post
a.redirectToForumPost=function(a){var b=p.jforumUrl+"/jforum.page?module=search&action=search&search_keywords="+a+"&match_type=all&search_forum=&sort_by=relevance";window.open(b),j.put("searchkeyword",a,{path:"/"})},j.put("username",a.user.displayName,{path:"/"}),j.put("emailId",a.email1,{path:"/"}),a.user.organizationId&&a.user.isOrganizationUserMode?(a.isOrgUser=!0,j.put("userMode","orgUser",{path:"/"})):j.put("userMode","indUser",{path:"/"}),s(),/*$scope.redirectToMedicationSatistics=function(diseaseId){
            	$state.go('viewMedicationStatistics',{'diseaseId':diseaseId.id});	
            }*/
a.redirectToMedicationSatistics=function(a){a&&a.disease&&a.variantNameCode?d.go("viewMedicationStatistics",{diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.id,diseaseVariantName:a.variantNameCode.value,from:"diseaseVariant"}):a&&a.disease&&d.go("viewMedicationStatistics",{diseaseId:a.disease.id,diseaseName:a.disease.value,from:"diseaseVariant"})},a.redirectToSysmptomSatistics=function(a){d.go("viewSymptomsStatistics",{diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.id,diseaseVariantName:a.variantNameCode.value,from:"diseaseVariant"})},a.redirectToIncidentSatistics=function(a){d.go("viewIncidentStatistics",{diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.id,diseaseVariantName:a.variantNameCode.value,from:"diseaseVariant"})},a.redirectToDiagnosticTest=function(a){d.go("diagnosticListOnDisease",{diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.id,diseaseVariantName:a.variantNameCode.value,from:"diseaseVariant"})},a.redirectToDiseaseSatistics=function(a){d.go("viewDiseaseStatistics",{diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.id,diseaseVariantName:a.variantNameCode.value,from:"diseaseVariant"})},a.redirectToDiseaseMedication=function(a){d.go("searchDiseaseMedication",{diseaseVariantId:a.id})},a.redirectToDiseaseSymptom=function(a){d.go("searchDiseaseSymptoms",{diseaseVariantId:a.id})},a.redirectToDiseaseIncident=function(a){d.go("searchDiseaseIncidents",{diseaseVariantId:a.id})},u(),a.checkOrganizationLocationAccess=function(b){var c=!1;return a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){a&&b&&a.id==b&&(c=!0)}),c};
// apply filter when calling from disease page
var w;c.diseaseId&&(w||(w={}),w.diseaseId||(w.diseaseId={}),w.diseaseId.id=c.diseaseId),a.getDiseaseVariantList=function(){o.isFieldEmpty(a.diseaseVariant)||(w=angular.copy(a.diseaseVariant)),a.filterRecords={},a.filterRecords||(a.filterRecords={}),o.isFieldEmpty(w)||(w.diseaseId&&w.diseaseId.id&&(a.filterRecords.diseaseId=w.diseaseId.id),w.diseaseVariantCategoryId&&w.diseaseVariantCategoryId.id&&(a.filterRecords.diseaseVariantCategoryId=w.diseaseVariantCategoryId.id)),a.filterRecords.pageNumber=a.currentPage,a.filterRecords.recordsPerPage=a.itemPerPage,r.getDiseaseVariantList(a.filterRecords,function(b){b&&(a.searchVariantList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems))},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDiseaseVariantList(),a.crudDiseaseVariant=function(a,b){r.getVariantById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageDiseaseVariants",{id:a,type:e,data:f})},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.getVariantCategory=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_DISEASE_VARIANT_CATEGORY_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.clear=function(){a.diseaseVariant={},w={},e.$$url&&c.diseaseId&&(c.diseaseId=null,delete e.$$url,e.$$url="/searchDiseaseVariants/",e.path("/searchDiseaseVariants/"),
//$location.replace();
e.$$compose()),a.getDiseaseVariantList()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=l(a.currentPage,a.itemPerPage,a.totalItems),a.getDiseaseVariantList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getDiseaseVariantList()};
//data table config
var x=k.gridConfigurations;a.options=h.setOptionProperties(x),a.dtColumnDefs=h.setColumnProperties({})}]),angular.module("paripal.diseaseManagementModule").controller("symptomsStatisticsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","symptomsStatisticsService","searchDiseaseVariantsReqService","httpService","urlService","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l){
// if($stateParams.diseaseId){
//                searchDiseaseVariantsReqService.getVariantById($stateParams.diseaseId,function(sucessResponse){
//                 $scope.diseaseSymptom.diseaseId = sucessResponse.disease.value;
//                 $scope.diseaseSymptom.variantId = sucessResponse.variantNameCode.value;
//                 //$scope.disease.diseaseNameCode.id
//                 $scope.dischart=[{'Name':'User By Disaese Variant(Bar-Chart)','key':'Chart-3','value':'Bar-Chart'}];
//          }, function (errorResponse) {
//             if (!utilService.isEmpty(errorResponse.data) && !utilService.isEmpty(errorResponse.data.messages[0])) {
//                 notify("error", $translate.instant(errorResponse.data.messages[0]));
//             }
//         });
//     }
function m(b){/*return httpService.getData(urlService.getParameterizedUrl('GET_SYMPTOMS', 
				$scope.searchKeyWord), null, function (response) {*/
return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,j.getData(k.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptomLoad=!1,a.symptomLoad=angular.fromJson(b.data)},function(b){a.symptomLoad=!1,utilService.isEmpty(b.data)||utilService.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SEARCH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})}function n(b,d){var e=angular.copy(b);if(b.symptomId&&!b.symptomId.id)return b.symptomId="",void f("error",g.instant("Select Specific Symptom"));if(b.diseaseId&&!b.diseaseId.id)return b.diseaseId="",void f("error",g.instant("Select Specific Disease"));if(b.diseaseVariant&&!b.diseaseVariant.id)return b.diseaseVariant="",void f("error",g.instant("Select Specific Disease Variant"));/* var diseaseVariant = [];
                diseaseVariant.push('id',diseaseVariant.id);*/
if(e.diseaseVariant&&e.diseaseVariant.id){var i=[];i.push("id",i.id)}if(e.symptomId&&e.symptomId.id?e.symptomId=e.symptomId.id:e.symptomId&&!e.symptomId.id&&(e.symptomId=c.symptomId),e.diseaseId&&e.diseaseId.id&&(e.diseaseId=e.diseaseId.id),e.diseaseVariant&&e.diseaseVariant.id){e.diseaseVariant=e.diseaseVariant.id;var j=[];j.push(e.diseaseVariant),e.diseaseVariant=j}
//    if(symptomAnalysisData.dateFrom != null){
//    	symptomAnalysisData.dateFrom = dateconvertor.convertToServerDate(symptomAnalysisData.dateFrom);
//    }
// if(symptomAnalysisData.tillDate !=null){
// 	symptomAnalysisData.tillDate = dateconvertor.convertToServerDate(symptomAnalysisData.tillDate);	
// }
h.getSymptomsStatistics(e,d,function(b){b&&(0==b.length?(a.norecordfound=!0,a.chart=!1):"Bar-Chart"==d.value?(a.norecordfound=!1,a.getBarChart(e,b,d)):(a.norecordfound=!1,a.getPieChart(e,b,d)),a.chartType=d,a.chart=!0)},function(a){})}function o(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=k.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return j.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){utilService.isEmpty(a.data)||utilService.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function p(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseSymptom&&a.diseaseSymptom.diseaseId?(a.searchKeyWord.diseaseId=a.diseaseSymptom.diseaseId.id,a.diseaseVariantLoad=!0,j.getData(k.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,utilService.isEmpty(b.data)||utilService.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SEARCH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})):void f("error",g.instant("Select Disease"))}function q(b,c,d){if("Chart-1"===d.key&&"Bar-Chart"===d.value){var e=v(c),f=w(c),g=x(c),h=u(c);a.chartData=z(e,f,g,h),a.barChartCreateFunction()}if("Chart-2"===d.key&&"Bar-Chart"===d.value){var e=v(c),f=w(c),i=y(c);a.chartData=A(e,f,i),a.barChartCreateFunction()}}function r(b,c,d){"Chart-3"===d.key&&"Pie-Chart"===d.value&&(a.chartData=s(c),a.pieChartCreateFunction())}function s(a){var b=[];return a.forEach(function(a){var c={};c.attribute=a.symptomName,c.count=a.totCount,b.push(c)}),b}function t(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Total Users by "+a.variantName,c.count=a.totalActiveUser,b.push(c)}),b}function u(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Total Users by "+a.variantName,c.count=a.totalUser,b.push(c)}),b}function v(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Total Users",//+group.totalUser;
c.count=a.totalUser,b.push(c)}),b}function w(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Active Users ",//+group.totalUser;
c.count=a.totalUser,b.push(c)}),b}function x(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Active Users by "+a.symptomName,c.count=a.totalActiveUser,b.push(c)}),b}function y(a){var b=[];return a.forEach(function(a){var c={};c.attribute="Active Users by Incident ",c.count=a.totalUser,b.push(c)}),b}function z(a,b,c,d){var e=a.concat(b),f=e.concat(c),g=f.concat(d);return g}function A(a,b,c){var d=a.concat(b),e=d.concat(c);return e}a.diseaseSymptom={},a.getSymptom=m,a.getSymptomsStatistics=n,a.getDiseaseVariant=p,a.getDisease=o,a.getBarChart=q,a.getPieChart=r,a.symptomAnalysisData={},a.getTotalUser=v,a.getTotalUserActive=w,a.getTotalSymptom=x,a.getSymptomByDiseaseVariant=u,a.getTotalIncident=y,a.getIncidentByDiseaseVariant=t;/*****    from disease symptom page  *****/
if(a.getChartName=function(){a.chartTypes=[{Name:"Symptom By Disease Variants(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"},{Name:"Incidents by Symptom(Bar-Chart)",key:"Chart-2",value:"Bar-Chart"},{Name:"Symptoms By Disaese Variant(Pie-Chart)",key:"Chart-3",value:"Pie-Chart"}]},a.setDirectiveFn=function(b){console.log("in setDirectiveFn"),a.barChartCreateFunction=b},a.setDirectiveFnForPie=function(b){console.log("in setDirectiveFnForPie"),a.pieChartCreateFunction=b},a.getTillDate=function(b){a.minDate=b},a.clear=function(){
//$scope.incident = '';				
a.labels=[],a.diseaseSymptom={},a.data=[],a.datas=[],a.chartType="",a.getChartName(),a.chart=!1},a.getChartName(),c.from&&"diseaseSymptom"==c.from){var B={};c.symptomId&&c.diseaseId&&c.diseaseVariantId?(B.diseaseId={},B.diseaseId.id=c.diseaseId,B.diseaseVariant={},B.diseaseVariant.id=c.diseaseVariantId,B.symptomId={},B.symptomId.id=c.symptomId,a.diseaseSymptom=angular.copy(B),a.diseaseSymptom.diseaseId.value=c.diseaseName,a.diseaseSymptom.diseaseVariant.value=c.diseaseVariantName,a.diseaseSymptom.symptomId=c.symptomName):c.symptomId&&c.diseaseId&&(B.diseaseId={},B.diseaseId.id=c.diseaseId,B.symptomId={},B.symptomId.id=c.symptomId,a.diseaseSymptom=B,a.diseaseSymptom.diseaseId.value=c.diseaseName,a.diseaseSymptom.symptomId=c.symptomName);var C={Name:"Symptom By Disease Variants(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"};a.chart=C,a.getSymptomsStatistics(B,C)}/*****    from disease varient page  *****/
if(c.from&&"diseaseVariant"==c.from){var B={};c.diseaseId&&c.diseaseVariantId&&(B.diseaseId={},B.diseaseId.id=c.diseaseId,B.diseaseVariant={},B.diseaseVariant.id=c.diseaseVariantId,a.diseaseSymptom=B,a.diseaseSymptom.diseaseId.value=c.diseaseName,a.diseaseSymptom.diseaseVariant.value=c.diseaseVariantName);var C={Name:"Symptom By Disease Variants(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"};a.chart=C,a.getSymptomsStatistics(B,C)}}]),angular.module("paripal.diseaseManagementModule").controller("viewDiseaseStatisticsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","viewDiseaseStatisticsService","searchDiseaseReqService","dateconvertor","urlService","httpService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(b,d){if(!d)return void f("error",g.instant("Select Chart"));if("Bar-Chart For Specific Variants"==d.Name&&!b.diseaseVariantId)return void f("error",g.instant("Select Variant"));var e=angular.copy(b);return c.diseaseId&&c.diseaseVariantId?(e={},e.diseaseId=c.diseaseId,e.diseaseVariantId=c.diseaseVariantId):(e={},e.diseaseId=c.diseaseId),b.diseaseId&&b.diseaseId.id&&(e.diseaseId=b.diseaseId.id),b.diseaseId&&!b.diseaseId.id?(b.diseaseId="",void f("error",g.instant("Select Specific Disease"))):b.diseaseVariantId&&!b.diseaseVariantId.id?(b.diseaseVariantId="",void f("error",g.instant("Select Specific Disease Variant"))):(b.diseaseVariantId&&b.diseaseVariantId.id&&("Bar-Chart For Specific Variants"===d.Name?e.diseaseVariantId=b.diseaseVariantId.id:"Bar-Chart For All Variants"===d.Name?delete e.diseaseVariantId:e.diseaseVariantId=b.diseaseVariantId.id),null!=b.dateFrom&&(e.dateFrom=j.convertToServerDate(b.dateFrom)),null!=b.tillDate&&(e.tillDate=j.convertToServerDate(b.tillDate)),void h.getDiseaseStatistics(e,function(b){if(b){0==b.data.length?(a.norecordfound=!0,a.chartShow=!1):"Bar-Chart"==d.value?(a.norecordfound=!1,q(b.data,d)):(a.norecordfound=!1,t(b.data,d));b.data.length;a.chartType=d,a.chartShow=!0}},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))}))}function o(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=k.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return l.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function p(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseStatistics&&a.diseaseStatistics.diseaseId?(a.searchKeyWord.diseaseId=a.diseaseStatistics.diseaseId.id,a.diseaseVariantLoad=!0,l.getData(k.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SEARCH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})):void f("error",g.instant("Select Disease"))}function q(b,c){if("Chart-1"===c.key&&"Bar-Chart"===c.value){var d=r(b),e=s(b);a.chartData=d.concat(e),a.barChartCreateFunction()}if("Chart-2"===c.key&&"Bar-Chart"===c.value){var d=r(b),e=s(b);a.chartData=d.concat(e),a.barChartCreateFunction()}}function r(a){var b=[];return a.forEach(function(a){if(null!=a.currentSubscribersAffected){var c={};c.attribute=a.variantNameCode.value,c.count=a.currentSubscribersAffected,b.push(c)}}),b}function s(a){var b=[];return a.forEach(function(a){if(null!=a.totalSubscribersAffected){var c={};c.attribute=a.variantNameCode.value,c.count=a.totalSubscribersAffected,b.push(c)}}),b}/*	function getBarChart(variants){
		$scope.data = [];
		var totalAffected = [];
		var currAffected =[];
		var req=[];
		$scope.labels = [];
		
		variants.forEach(function(data){
			$scope.labels.push(data.variantNameCode.value);
			currAffected.push(data.currentSubscribersAffected);
			totalAffected.push(data.totalSubscribersAffected);
		});
		$scope.series = ['Users Currently Affected', 'Total User Affected'];
		$scope.data.push(currAffected);
		$scope.data.push(totalAffected);

	}*/
function t(b,c){if("Chart-3"===c.key&&"Pie-Chart"===c.value){
//var currentlyAffected = getUserCurrentlyAffected(sucessResponse);
var d=s(b);a.chartData=d,a.pieChartCreateFunction()}}/*****    from disease varient page  *****/
if(a.diseaseStatistics={},a.norecordfound=!0,a.getDiseaseStatistics=n,a.getDiseaseVariant=p,a.getDisease=o,a.getBarChart=q,a.getPieChart=t,
// if($stateParams.diseaseId && ){
// 	searchDiseaseReqService.getDiseaseById($stateParams.diseaseId, function(sucessResponse){
// 		{
// 			$scope.diseaseStatistics.diseaseId = sucessResponse.diseaseNameCode;
// 			//$scope.disease.diseaseNameCode.id
// 			$scope.dischart=[{'Name':'Bar-Chart For All Variants','key':'Chart-1','value':'Bar-Chart'}];
// 		}
// 	}, function (errorResponse) {
// 		if (!utilService.isEmpty(errorResponse.data) && !utilService.isEmpty(errorResponse.data.messages[0])) {
// 			notify("error", $translate.instant(errorResponse.data.messages[0]));
// 		}
// 	});
// }
a.getChartName=function(){a.chartTypes=[{Name:"Bar-Chart For All Variants",key:"Chart-1",value:"Bar-Chart"},{Name:"Bar-Chart For Specific Variants",key:"Chart-2",value:"Bar-Chart"},{Name:"Pie-Chart",key:"Chart-3",value:"Pie-Chart"}]},a.setDirectiveFn=function(b){console.log("in setDirectiveFn"),a.barChartCreateFunction=b},a.setDirectiveFnForPie=function(b){a.pieChartCreateFunction=b},a.clear=function(){a.incident="",a.labels=[],a.data=[],a.labelss=[],a.datas=[],a.chart="",a.chartType="",a.getChartName(),a.diseaseStatistics.dateFrom=void 0,a.diseaseStatistics.tillDate=void 0,a.diseaseStatistics.diseaseVariantId=void 0,a.chart=void 0},a.getChartName(),c.from&&"diseaseVariant"==c.from){var u={};c.diseaseId&&c.diseaseVariantId&&(u.diseaseId={},u.diseaseId.id=c.diseaseId,u.diseaseVariantId={},u.diseaseVariantId.id=c.diseaseVariantId,a.diseaseStatistics=u,a.diseaseStatistics.diseaseId.value=c.diseaseName,a.diseaseStatistics.diseaseVariantId.value=c.diseaseVariantName);var v={Name:"Bar-Chart For Specific Variants",key:"Chart-2",value:"Bar-Chart"};a.chart=v,a.getDiseaseStatistics(u,v)}/*****    from disease page  *****/
if(c.from&&"disease"==c.from){var u={};c.diseaseId&&(u.diseaseId={},u.diseaseId.id=c.diseaseId,a.diseaseStatistics=u,a.diseaseStatistics.diseaseId.value=c.diseaseName);var v={Name:"Bar-Chart For All Variants",key:"Chart-1",value:"Bar-Chart"};a.chart=v,a.getDiseaseStatistics(u,v)}}]),angular.module("paripal.diseaseManagementModule").service("diseaseProtocolService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";this.save=function(c,d,e){
//diseaseProtocol.dateAdded = dateconvertor.convertToServerDate(diseaseProtocol.dateAdded);
var f="SAVE_DISEASE_PROTOCOL";null!=c.id&&(f="UPDATE_DISEASE_PROTOCOL"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetch=function(c,d,e){
//   	if(filter.dateAdded){
//   		filter.dateAdded = dateconvertor.convertToServerDate(filter.dateAdded);
// }
a.postData(b.getUrl("GET_DISEASE_PROTOCOL_BY_CRITERIA"),c,function(a){a&&a.data?
//convertListOfDate(response.data.data);
d(a.data):e(a)},function(a){e(a)})},this.getDiseaseProtocolById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_DISEASE_PROTOCOL_BY_ID",f),null,function(a){
//var dateFormat = 'MM/dd/yyyy';
a&&a.data?
//response.data.dateAdded = $filter('timestampToDate')(response.data.dateAdded, dateFormat);
d(a.data):e(a)},function(a){e(a)})},/*var convertListOfDate = function(data){
    		var dateFormat = 'MM/dd/yyyy';
    		angular.forEach(data, function(value,key) {
    			//value.dateAdded = $filter('timestampToDate')(value.dateAdded, dateFormat);
    		});
    	}*/
this.inActivate=function(c,d,e){a.deleteData(b.getParameterizedUrl("DELETE_DISEASE_PROTOCOL",c),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("incidentStatisticsService",["httpService","urlService","$timeout","$filter","dateconvertor",function(a,b,c,d,e){"use strict";this.getIncidentAnalysis=function(c,d,e,g){var h;d&&"Chart-1"==d.key&&(h="SEARCH_INCIDENT_STATISTICS_USER_BY_DISEASE_VARIANT"),d&&"Chart-2"==d.key&&(h="SEARCH_INCIDENT_STATISTICS_USER_BY_INCIDENT_TYPE"),d&&"Chart-3"==d.key&&(h="SEARCH_INCIDENT_STATISTICS_BY_INCIDENT_TYPE"),a.postData(b.getUrl(h),c,function(a){a&&a.data?(f(a.data.data),e(a.data)):g(a)},function(a){g(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateRequestCreated=d("timestampToDate")(a.dateRequestCreated,b),a.whenNeeded=d("timestampToDate")(a.whenNeeded,b)})}}]),angular.module("paripal.diseaseManagementModule").service("manageDiseaseIncidentsService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.saveIncidents=function(c,d,e){var f="";f=null!=c.id?"UPDATE_DISEASE_INCIDENTS":"SAVE_DISEASE_INCIDENTS",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("manageDiseaseMedicationService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.saveDiseaseMedication=function(c,d,e){var f="SAVE_DISEASE_MEDICATION";null!=c.id&&(f="UPDATE_DISEASE_MEDICATION"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("manageDiseaseReqService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.updateRequest=function(c,d,e){a.postData(b.getUrl("UPDATE_DISEASE_REQUEST"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDiseaseById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_DISEASE_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("manageDiseaseSymptomService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.saveDiseaseSymptom=function(c,d,e){var f="SAVE_DISEASE_SYMPTOM";null!=c.id&&(f="UPDATE_DISEASE_SYMPTOM"),a.postData(b.getUrl(f),c,function(a){a&&200==a.status?d(a):e(a)},function(a){e(a)})},this.deleteBySymptomId=function(c,d,e){var f={};f.id=Integer.parseInt(c),a.deleteData(b.getParameterizedUrl("DISEASE_SYMPTOM_DELETE"),f,function(a){a&&a.data?(convertListOfDate(a.data.data),d(a.data)):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("manageDiseaseSymptomsIncidentsService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.save=function(c,d,e){var f="SAVE_DIS_SYM_INCI";null!=c.id&&(f="UPDATE_DIS_SYM_INCI"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchRecords=function(c,d,e){a.postData(b.getUrl("SEARCH_BY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDiseaseSymInciById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_DIS_SYM_INCI_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleDiseaseSymptomLink=function(c,d,e){a.getData(b.getParameterizedUrl("TOGGLE_DIS_SYM_INCI",c),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("manageDiseaseVariantsReqService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.saveDieaseVariant=function(c,d,e){var f="";f=null!=c.id?"UPDATE_DISEASE_VARIANT":"SAVE_DISEASE_VARIANT",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("medicationStatisticsService",["httpService","urlService","$timeout","$filter","dateconvertor",function(a,b,c,d,e){"use strict";this.getmedicationAnalysis=function(c,d,e,g){
// if(medicationAnalysisData.dateFrom !=null )
//  {
//  medicationAnalysisData.dateFrom = dateconvertor.convertToServerDate(medicationAnalysisData.dateFrom);
//  }
//  if(medicationAnalysisData.tillDate !=null)
//  {
//  medicationAnalysisData.tillDate = dateconvertor.convertToServerDate(medicationAnalysisData.tillDate);
//  }
var h;!d||"Chart-1"!=d.key&&"Chart-2"!=d.key||(h="DISEASE_MEDICATION_CHART_FOR_USER_BY_BRAND"),d&&"Chart-3"==d.key&&(h="DISEASE_MEDICATION_CHART_FOR_USER_BY_DISEASE_VARIANT"),a.postData(b.getUrl(h),c,function(a){a&&a.data?(f(a.data.data),e(a.data)):g(a)},function(a){g(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateRequestCreated=d("timestampToDate")(a.dateRequestCreated,b),a.whenNeeded=d("timestampToDate")(a.whenNeeded,b)})}}]),angular.module("paripal.diseaseManagementModule").service("searchDiseaseIncidentService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getIncidentList=function(b,d,e){a.postData(c.getUrl("SEARCH_INCIDENT_FINDBY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteIncidentById=function(b,d,e){var f={};f.id=b,a.deleteData(c.getParameterizedUrl("DELETE_DISEASE_INCIDENT_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getIncidentById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("GET_DISEASE_INCIDENT_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleChangeStatus=function(b,d,e){a.getData(c.getParameterizedUrl("DISEASE_INCIDENT_CHANGE_STATUS",b),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("searchDiseaseMedicationService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.fetchDiseaseMedications=function(b,d,e){a.postData(c.getUrl("DISEASE_MEDICATION_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDiseaseMedicationById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("GET_DISEASE_MEDICATION_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleDiseaseMedication=function(b,d,e){a.getData(c.getParameterizedUrl("DISEASE_MEDICATION_TOGGLE",b),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("searchDiseaseReqService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getDiseaseById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("GET_DISEASE_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDiseaseList=function(b,d,e){a.postData(c.getUrl("SEARCH_DISEASE_FINDBY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleChangeStatus=function(b,d,e){a.getData(c.getParameterizedUrl("DISEASE_MANAGEMENT_CHANGE_STATUS",b),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("searchDiseaseSymptomsService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getSymptomStatistics=function(b,d,e){a.postData(c.getUrl("SYSMPTOM_STATISTICS_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchDiseaseSymptoms=function(b,d,e){a.postData(c.getUrl("GET_DISEASE_SYMPTOM_BY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDiseaseSymptomById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("GET_DISEASE_SYMPTOM_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleDiseaseSymptom=function(b,d,e){a.getData(c.getParameterizedUrl("DISEASE_SYMPTOM_TOGGLE",b),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.fetchDiseaseSymptoms=function(b,d,e){a.postData(c.getUrl("GET_DISEASE_SYMPTOM_BY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDiseaseSymptomById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("GET_DISEASE_SYMPTOM_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleDiseaseSymptom=function(b,d,e){a.getData(c.getParameterizedUrl("DISEASE_SYMPTOM_TOGGLE",b),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("searchDiseaseVariantsReqService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getDiseaseVariantList=function(b,d,e){a.postData(c.getUrl("SEARCH_DISEASE_VARIANT_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getVariantById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("GET_DISEASE_VARIANT_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleChangeStatus=function(b,d,e){a.getData(c.getParameterizedUrl("DISEASE_VARIANT_CHANGE_STATUS",b),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseManagementModule").service("symptomsStatisticsService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getSymptomsStatistics=function(b,d,e,f){var g;d&&"Chart-2"==d.key&&(g="SEARCH_SYMPTOM_STATISTICS_USER_BY_DISEASE_VARIANT"),d&&"Chart-1"==d.key&&(g="SEARCH_SYMPTOM_STATISTICS_USER_BY_SYMPTOM"),d&&"Chart-3"==d.key&&(g="SEARCH_SYMPTOM_STATISTICS_SYMPTOM_BY_DISEASE"),a.postData(c.getUrl(g),b,function(a){a&&a.data?
//convertListOfDate(response.data.data);
e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.diseaseManagementModule").service("viewDiseaseStatisticsService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getDiseaseStatistics=function(b,d,e){a.postData(c.getUrl("SEARCH_DISEASE_VARIANT_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseTreatmentModule").controller("manageDiseaseTreatmentTypeCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageDiseaseTreatmentTypeService","searchDiseaseTreatmentTypeService","httpService","urlService","utilService","$window","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,l.getData(m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function r(b){return a.searchKeyWord={},"edit"===c.type&&void 0==b&&(a.treatment.diseaseVariantId=""),a.searchKeyWord.searchKeyWord=b,a.treatment&&a.treatment.disease?(a.searchKeyWord.diseaseId=a.treatment.disease.id,a.diseaseVariantLoad=!0,l.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):(a.treatment.diseaseVariantId="",void f("error",h.instant("Select Disease")))}function s(){a.getDiseaseVariant()}function t(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,l.getData(m.getParameterizedUrl("TREATMENT_DESCRIPTION",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function u(b){a.treatment.description=a.treatment.treatmentTypeId.description}function v(b){var c={};c.keyword=b;var d=m.getParameterizedUrl("FIND_ACCESSIBLE_LOCATION_BY_KEYWORD",c);if(d)return l.getData(d,null,function(b){if(b&&b.data)return a.orgLocId=b.data,a.orgLocId},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function w(){/*$state.go('searchDiseaseTreatmentType', { type: '' });*/
n.goBackToPrevState()}function x(){void 0==a.treatment.whetherActive&&(a.treatment.whetherActive=!1),void 0==a.treatment.usersUndergoingTreatmentTotal&&(a.treatment.usersUndergoingTreatmentTotal=0),void 0==a.treatment.usersUndergoingTreatmentThisYear&&(a.treatment.usersUndergoingTreatmentThisYear=0),a.treatment.treatmentTypeId.id&&delete a.treatment.treatmentTypeId.description,j.save(a.treatment,function(b){b&&(d.go("searchDiseaseTreatmentType"),null!=a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){return a.treatment&&a.treatment.orgLocId&&!a.treatment.orgLocId.id?void f("error",h.instant("INVALID_ORGANIZATION")):a.treatment&&a.treatment.disease&&!a.treatment.disease.id?void f("error",h.instant("INVALID_DISEASE")):a.treatment&&a.treatment.diseaseVariantId&&!a.treatment.diseaseVariantId.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):a.treatment&&a.treatment.treatmentTypeId&&!a.treatment.treatmentTypeId.id?void f("error",h.instant("INVALID_TREATMENT")):void(n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(b.data.messages[0])))})}a.treatment={},a.orgLocPermission=p.DISEASE_TREATMENT_TYPE_ADD,a.getDisease=q,a.getDiseaseVariant=r,a.getTreatmentTypeId=t,a.getCreatingOrgLocId=v,a.save=x,a.cancel=w,a.checkVariant=s,a.getTreatmentTypeDesc=u,a.treatment.treatmentTypeId={},a.treatment={treatmentBranch:{},treatmentSubBranch:{}},a.initDiseaseTreatmentsById=function(){c.data&&(a.treatment=c.data,"view"===c.type?(a.pageState="view",a.viewmode=!0,a.disabled=!0,a.IsVisible=!0):"edit"===c.type&&(a.pageState="edit",a.orgLocPermission=p.DISEASE_TREATMENT_TYPE_ADD,a.IsVisible=!0,a.disabled=!0),c&&c.id&&("view"===c.type||"edit"===c.type)&&k.getDiseaseTreatmentById(c.id,function(b){a.treatment=b,a.setData(a.treatment),a.setData()},function(b){a.manageOrgLocSpinner=!1,a.error=b,n.isEmpty(b.data)||n.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))}))},a.setData=function(b){a.branchId=b.treatmentBranch.id,a.subBranchId=b.treatmentSubBranch.id},a.initDiseaseTreatmentsById(),a.branch=function(){var b={};b.code="treatmentTypeBranch",l.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.treatmentBranch=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.branch(),a.subBranch=function(){var b={};b.code="treatmentTypeSubBranch",l.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.treatmentSubBranch=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.subBranch()}]),angular.module("paripal.diseaseTreatmentModule").controller("manageUserTreatmentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$log","$q","$timeout","serverSidePagination","manageUserTreatmentService","httpService","urlService","utilService","commonConstants","fileOperations","featurePrivilegeConstants","viewUserTreatmentService","manageAttachmentService","baseService","$mdDialog","appointmentsListService","manageUserIssueService","MakePrescriptionFactory","emergencyUploadListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";function B(b){a.endDate=b}function C(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,n.getData(o.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.treatment.creatingOrgLoc=b.data[0],N(a.treatment.user.id,a.treatment.creatingOrgLoc.id),R(a.treatment.user.id,a.treatment.creatingOrgLoc.id),a.treatment.creatingOrgLoc},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function D(){var b={};return b.recId=parseInt(c.id),n.getData(o.getParameterizedUrl("GET_APPOINTMENT_FOR_TREATMENT",b),null,function(b){b&&b.data&&(a.AppointmentList=b.data,a.getclinicalForAppointmentId(),a.getDocumentAttachmentsList(),a.getTreatmentDocumentList(),a.getPrescriptionForAppointmentId(),a.viewPrescriptionForTreatment())},function(a){!p.isEmpty(a.data)&&!p.isEmpty(a.data.messages[0])})}
// newly added function for getting emergency transaction 
function E(){ga(),I()}function F(){var b={};return b.recId=parseInt(c.id),n.getData(o.getParameterizedUrl("GET_CLINICAL_NOTES_BY_APPOINTMENT_ID",b),null,function(b){b&&b.data&&(a.clinicalAptList=[],b.data.forEach(function(b){for(var c in b){var d=b[c];d.length>0&&a.clinicalAptList.push(d)}}),a.clinAptNts=a.clinicalAptList)},function(a){!p.isEmpty(a.data)&&!p.isEmpty(a.data.messages[0])})}function G(){var b={};return b.recId=parseInt(c.id),n.getData(o.getParameterizedUrl("GET_DOCUMENTS_FOR_APPOINTMENT_ID",b),null,function(b){b&&b.data&&(a.attachmentList=[],b.data.forEach(function(b){for(var c in b){var d=b[c];d.length>0&&a.attachmentList.push(d)}}),a.apptAttachLst=a.attachmentList)},function(a){!p.isEmpty(a.data)&&!p.isEmpty(a.data.messages[0])})}function H(){var b=parseInt(c.id);x.getPrescriptionByTreatmentId(b,function(b){b&&b.data&&(a.prescriptionList=b.data)},function(a){})}function I(){
//var treatId = parseInt($stateParams.id);
if(a.treatment&&a.treatment.lastTransactionId){var b=a.treatment.lastTransactionId;x.getPrescriptionByTransactionId(b,function(b){b&&b.data&&(a.transactionPrescriptionList=b.data)},function(a){})}}function J(){var b={};return b.recId=parseInt(c.id),n.getData(o.getParameterizedUrl("GET_PRESCRIPTION_BY_APPOINTMENT_ID",b),null,function(b){b&&b.data&&(a.apptPrescriptionList=[],b.data.forEach(function(b){for(var c in b){var d=b[c];d.length>0&&a.apptPrescriptionList.push(d)}}),a.presRef=a.apptPrescriptionList)},function(a){!p.isEmpty(a.data)&&!p.isEmpty(a.data.messages[0])})}function K(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,n.getData(o.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&L()},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function L(){a.pageState="view",a.viewmode=!0,a.disabled=!0,a.IsVisible=!0,t.getUserTreatmentById(c.id,function(b){a.treatment=b,M(a.treatment),
// $scope.setData();
a.disable=!1,a.stateParamValue=c.id;var d={};d.userId=a.treatment.user.id,d.locationId=a.treatment.creatingOrgLoc.id,
//$scope.getMainProfessionalAssociated($viewValue,$scope.treatment.treatmentLocation.id);
a.getIncidentId(a.treatment.user.id,a.treatment.creatingOrgLoc.id),a.getCliniclList()},function(b){a.manageOrgLocSpinner=!1,a.error=b,p.isEmpty(b.data)||p.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}function M(b){a.diseaseVariantId=b.diseaseVariant.id,a.getDisease(b.diseaseVariant.id),a.getDiseaseVariant(b.user.id,b.creatingOrgLoc.id)}function N(b,c){var d={};d.userId=b,d.locationId=c;var e=o.getParameterizedUrl("GET_INCIDENT_ID_FOR_TREATMENT",d);if(e)return n.getData(e,null,function(b){if(b&&b.data)return a.incidentId=b.data,a.incidentId},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function O(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.currencyLoad=!0,n.getData(o.getParameterizedUrl("GET_CURRENCYLIST_DATA",a.searchKeyWord),null,function(b){return a.currencyLoad=!1,a.currencyLoad=angular.fromJson(b.data)},function(b){a.currencyLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function P(b){a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=b;var c=o.getParameterizedUrl("FIND_DISEASE_BY_VARIANT_ID",a.searchKeyWord);if(c)return n.getData(c,null,function(b){b&&b.data&&(a.treatment.disease=b.data)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function Q(b){y.getIcd10DetailsById(b,function(b){b&&(a.treatment.icd10CodeDescription=b.icd10CodeDescription)},function(b){a.manageOrgLocSpinner=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}function R(b,c){if(a.whethersub){var d={};d.userId=b,d.creatingOrgId=c;var e=o.getParameterizedUrl("FIND_DISEASEVARIANT_FOR_IND_SUB_WITH_ICD10",d)}else{var d={};d.userId=b,
//searchKeyWord.locId=locId;
d.creatingOrgId=c;
//var url = urlService.getParameterizedUrl('FIND_DISEASE_VARIANT_BY_USER_AND_LOCATION',searchKeyWord);
var e=o.getParameterizedUrl("FIND_DISEASEVARIANT_FOR_IND_SUB_WITH_ICD10",d)}if(e)return n.getData(e,null,function(b){if(b&&b.data)return a.diseaseVariant=b.data,a.diseaseVariant},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function S(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,n.getData(o.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function T(b){
//$scope.clinicalProtocolLoad = true;
//            		FIND_DISEASE_PROTOCOL_BY_SEARCH_KEYWORD
return a.searchKeyWord={},a.searchKeyWord.searchKeyword=b,a.searchKeyWord.diseaseId=a.treatment.disease.id,n.getData(o.getParameterizedUrl("FIND_DISEASE_PROTOCOL_BY_DISEASE_ID_AND_SEARCH_KEYWORD",a.searchKeyWord),null,function(b){return a.clinicalProtocolLoad=!1,a.clinicalProtocol=angular.fromJson(b.data)},function(b){a.clinicalProtocolLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function U(b){var c={};return c.searchKeyword=b,n.getData(o.getParameterizedUrl("GET_ORG_LOC_BY_ALL",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function V(b){
//             if($scope.loginDetails.userAccountStatusDTO.whetherSubscriber = true && !$rootScope.loggedInUserDetails.isOrganizationUserMode){
//                   $scope.userData = {};
//     $scope.userData.searchKeyWord = value;
//     $scope.userNameAutoCmpLoading = true;
//     return httpService.getData(urlService.getParameterizedUrl('FIND_ORGANIZATION_LOCATION_ALL', $scope.userData), null, function (response) {
//         $scope.userNameAutoCmpLoading = false;
//         $scope.valid = false;
//         return $scope.users = angular.fromJson(response.data);
//     }, function (error) {
//         $scope.userNameAutoCmpLoading = false;
//     });
// }
// else{
var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,n.getData(o.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function W(b,c){a.queryObj={},a.queryObj.searchString=b;var d=o.getParameterizedUrl("GET_ADVISED_BY_SEACRH_KEY",a.queryObj);if(d)return n.getData(d,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}
//        function getMainProfessionalAssociated(viewValue,locId){
//            if($scope.loginDetails.userAccountStatusDTO.whetherSubscriber == true && !$rootScope.loggedInUserDetails.isOrganizationUserMode){
//              $scope.queryObj = {};
//           $scope.queryObj.name=viewValue;
//          var url = urlService.getParameterizedUrl('FIND_ALL_PROFSSIONAL_BY_USER', $scope.queryObj);
//          if (url) {
//               return httpService.getData(url, null, function (response) {
//                   if (response && response.data) {
//                       $scope.doctor = response.data;
//                       return $scope.doctor;
//                   }
//               }, function (error) {
//                  if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                           notify("error", $translate.instant(error.data.messages[0]));
//                     }
//               });
//           }
//          }else{
//            var userData = {};
// userData.searchKeyword = viewValue;
// userData.orgLocationId = locId;
//            $scope.userNameAutoCmpLoading = true;
//            return httpService.getData(urlService.getParameterizedUrl('FIND_HEALTHPROFESSION_BY_ORGLOCATION', userData),
//                    null, function (response) {
//                $scope.userNameAutoCmpLoading = false;
//                $scope.mainProfessionalAssociated = response.data;
//                return $scope.mainProfessionalAssociated;
//            }, function (error) {
//                $scope.userNameAutoCmpLoading = false;
//                 if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                         notify("Alert", $translate.instant(error.data.messages[0]));
//                     }
//            });
//        }
//     }
function X(b){if(a.loginDetails.userAccountStatusDTO.whetherSubscriber=!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,n.getData(o.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,n.getData(o.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function Y(){/*$state.go('viewUserTreatment', { type: '' });*/
p.goBackToPrevState()}function Z(b,d,e){var g=new Object;g.file=b.fileToBeUpload,g.orgLocId=a.treatment.creatingOrgLoc.id,g.docType=q.documentTypes.treatment,g.docSubType=q.documentSubTypes.userTreatments,g.isThumbnailRequired=!1,p.isNullOrEmpty(e.response)||(g.resourceId=e.response),r.uploadFile(g,function(b){p.isNullOrEmpty(e)||(a.treatment.documentId=e.response,a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload?(a.documentUpload2.document.fileName=a.userTreatmentScanFile.fileToBeUpload.name,a.documentUpload2.document.fileSize=a.userTreatmentScanFile.fileToBeUpload.size,a.documentUpload2.document.organizationLocationId=a.treatment.creatingOrgLoc.id,a.documentUpload2.document.documentType={subType:q.documentSubTypes.userTreatments},"add"!=c.type&&a.treatment.feedbackDocumentId&&(a.documentUpload2.document.id=a.treatment.feedbackDocumentId),m.saveDocumentDetails(a.documentUpload2.document,c.type,function(b){a.attachmentFormSpinner=!1,a.userTreatmentScanFile.fileToBeUpload&&(a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload&&a.userTreatmentScanFile.fileToBeUpload.name&&a.uploadFile2(a.userTreatmentScanFile,a.treatment,b),a.treatment&&a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):m.save(a.treatment,function(b){b&&(c.id?(a.stateParamValue=c.id,a.disable=!1):(c.id=b.response,a.stateParamValue=c.id,a.disable=!1),f("success",b.successMessage))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},function(a){p.isNullOrEmpty(e.response)||t.inActivate(e.response,function(a){},function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))})})}function $(b,d,e){var g=new Object;g.file=b.fileToBeUpload,g.orgLocId=a.treatment.creatingOrgLoc.id,g.docType=q.documentTypes.treatment,g.docSubType=q.documentSubTypes.userTreatments,g.isThumbnailRequired=!1,p.isNullOrEmpty(e.response)||(g.resourceId=e.response),r.uploadFile(g,function(b){p.isNullOrEmpty(e)||(a.treatment.feedbackDocumentId=e.response,m.save(a.treatment,function(b){b&&(c.id?(a.stateParamValue=c.id,a.disable=!1):(c.id=b.response,a.stateParamValue=c.id,a.disable=!1),f("success",b.successMessage))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},function(a){p.isNullOrEmpty(e.response)||t.inActivate(e.response,function(a){},function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))})})}function _(b,c){if(!p.isEmpty(c)){var d=new Object;d.fileName=c.treatmentSummaryFile,d.orgLocId=c.creatingOrgLoc.id,d.resourceId=c.documentId,d.docType=q.documentTypes.treatment,d.docSubType=q.documentSubTypes.userTreatments,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable,r.viewFileContent(d,function(a){},function(a){})}}function aa(b,c){if(!p.isEmpty(c)){var d=new Object;d.fileName=c.feedbackFromScan,d.orgLocId=c.creatingOrgLoc.id,d.resourceId=c.feedbackDocumentId,d.docType=q.documentTypes.treatment,d.docSubType=q.documentSubTypes.userTreatments,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable,r.viewFileContent(d,function(a){},function(a){})}}function ba(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.documentId,c.recordId=b.appointmentId,c.docType=q.documentTypes.transaction,c.docSubType=q.documentSubTypes.appointment_transaction,a.fileResource=c,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0}function ca(b,c){if(!p.isEmpty(c)){var d=new Object;d.fileName=c.clinicalProtocol.protocolFile,d.orgLocId=c.clinicalProtocol.creatingOrgLoc.id,d.resourceId=c.clinicalProtocol.documentId,d.docType=q.documentTypes.disease,d.docSubType=q.documentSubTypes.userTreatments,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!resource.whetherDownloadable,r.viewFileContent(d,function(a){},function(a){})}}function da(){
//$scope.treatment.insuranceClaimCurrency.value=$scope.treatment.insuranceClaimCurrency.dataValue.value;
return a.treatment&&a.treatment.currencyOnTreatment&&a.treatment.currencyOnTreatment.dataValue&&(a.treatment.currencyOnTreatment.id=a.treatment.currencyOnTreatment.dataValue.id,a.treatment.currencyOnTreatment.value=a.treatment.currencyOnTreatment.dataValue.value,delete a.treatment.currencyOnTreatment.dataValue),a.treatment&&a.treatment.insuranceClaimCurrency&&a.treatment.insuranceClaimCurrency.dataValue&&(a.treatment.insuranceClaimCurrency.id=a.treatment.insuranceClaimCurrency.dataValue.id,a.treatment.insuranceClaimCurrency.value=a.treatment.insuranceClaimCurrency.dataValue.value,delete a.treatment.insuranceClaimCurrency.dataValue),a.treatment.clinicalProtocol&&!a.treatment.clinicalProtocol.id?void f("error",h.instant("INVALID_PROTOCOL")):(a.treatment&&a.treatment.treatmentLocation&&!a.treatment.treatmentLocation.id&&(a.treatment.treatmentLocationValue=a.treatment.treatmentLocation,delete a.treatment.treatmentLocation),a.treatment&&a.treatment.prescriptionRef&&(a.treatment.prescriptionRef=a.treatment.prescriptionRef.value),a.treatment&&a.treatment.mainProfessionalAssociated&&a.treatment.mainProfessionalAssociated.id&&(delete a.treatment.mainProfessionalAssociated.version,delete a.treatment.mainProfessionalAssociated.displayName,delete a.treatment.mainProfessionalAssociated.professionalId),a.treatment&&""==a.treatment.mainProfessionalAssociated&&delete a.treatment.mainProfessionalAssociated,a.treatment&&""==a.treatment.clinicalProtocol&&delete a.treatment.clinicalProtocol,a.treatment&&a.treatment.diseaseVariant&&delete a.treatment.diseaseVariant.icdId,a.treatment&&a.treatment.mainProfessionalAssociated&&!a.treatment.mainProfessionalAssociated.id&&(a.treatment.professionalName=a.treatment.mainProfessionalAssociated,delete a.treatment.mainProfessionalAssociated),a.treatment&&a.treatment.clinicalProtocol&&a.treatment.clinicalProtocol.id&&(a.treatment.clinicalProtocol.id=a.treatment.clinicalProtocol.id,a.treatment.clinicalProtocol.value=a.treatment.clinicalProtocol.protocol,a.treatment.clinicalProtocol.organizationLocationId=a.treatment.clinicalProtocol.organizationLocationId,delete a.treatment.clinicalProtocol.version,delete a.treatment.clinicalProtocol.creatingOrgLoc,delete a.treatment.clinicalProtocol.disease,delete a.treatment.clinicalProtocol.diseaseVariant,delete a.treatment.clinicalProtocol.documentId,delete a.treatment.clinicalProtocol.protocolFile,delete a.treatment.clinicalProtocol.whetherActive,delete a.treatment.clinicalProtocol.dateAdded,delete a.treatment.clinicalProtocol.description,delete a.treatment.clinicalProtocol.protocol),!p.isEmpty(a.treatment)&&a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload&&(a.treatment.treatmentSummaryFile=a.userTreatmentFile.fileToBeUpload.name),!p.isEmpty(a.treatment)&&a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload&&(a.treatment.feedbackFromScan=a.userTreatmentScanFile.fileToBeUpload.name),void(a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload?(a.documentUpload.document.fileName=a.userTreatmentFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.userTreatmentFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.treatment.creatingOrgLoc.id,a.documentUpload.document.documentType={subType:q.documentSubTypes.userTreatments},"add"!=c.type&&a.treatment.documentId&&(a.documentUpload.document.id=a.treatment.documentId),m.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.userTreatmentFile.fileToBeUpload&&(a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload&&a.userTreatmentFile.fileToBeUpload.name&&a.uploadFile1(a.userTreatmentFile,a.treatment,b),a.treatment&&a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload?(a.documentUpload2.document.fileName=a.userTreatmentScanFile.fileToBeUpload.name,a.documentUpload2.document.fileSize=a.userTreatmentScanFile.fileToBeUpload.size,a.documentUpload2.document.organizationLocationId=a.treatment.creatingOrgLoc.id,a.documentUpload2.document.documentType={subType:q.documentSubTypes.userTreatments},"add"!=c.type&&a.treatment.feedbackDocumentId&&(a.documentUpload2.document.id=a.treatment.feedbackDocumentId),m.saveDocumentDetails(a.documentUpload2.document,c.type,function(b){a.attachmentFormSpinner=!1,a.userTreatmentScanFile.fileToBeUpload&&(a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload&&a.userTreatmentScanFile.fileToBeUpload.name&&a.uploadFile2(a.userTreatmentScanFile,a.treatment,b),a.treatment&&a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):m.save(a.treatment,function(b){b&&(w.cancel(),c.id?(a.stateParamValue=c.id,a.disable=!1):(c.id=b.response,a.stateParamValue=c.id,a.disable=!1),
//$state.go('viewUserTreatment');
null!=a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})))}function ea(){if(c.id||(a.clinicalNotes=[]),c.treatmentRecId){var b={};b.recordId=c.treatmentRecId}else{var b={};b.recordId=c.id}var d=o.getParameterizedUrl("TREATMENT_CLINICAL_NOTE_BY_REC_ID",b);if(d)return n.getData(d,null,function(b){if(b&&b.data)return a.treatClinicalNotes=b.data,a.treatClinicalNotes},function(a){})}function fa(){var b={};return b.treatmentId=parseInt(c.id),n.getData(o.getParameterizedUrl("GET_DOCUMENTS_FOR_TREATEMENT_ID",b),null,function(b){b&&b.data&&(a.attachmentList=[],b.data.forEach(function(b){for(var c in b){var d=b[c];d.length>0&&a.attachmentList.push(d)}}),a.treatmentDocList=a.attachmentList)},function(a){!p.isEmpty(a.data)&&!p.isEmpty(a.data.messages[0])})}function ga(){var b={};return b.treatmentId=parseInt(c.id),n.getData(o.getParameterizedUrl("GET_DOCUMENTS_FOR_TRANSACTION_ID",b),null,function(b){b&&b.data&&(a.attachmentList=[],b.data.forEach(function(b){for(var c in b){var d=b[c];d.length>0&&a.attachmentList.push(d)}}),a.transactionDocList=a.attachmentList)},function(a){!p.isEmpty(a.data)&&!p.isEmpty(a.data.messages[0])})}function ha(c){var d={documentId:c.documentId},e=o.getParameterizedUrl("DELETE_TRANSACTION_DOC_ID",d);n.deleteData(e,null,function(e){A.deleteDocument(d.documentId,function(d){var e={};e.fileName=c.fileName,e.resourceId=c.documentId,e.docType=c.documentTypeCode,e.docSubType=c.documentSubTypeCode,e.recordId=c.treatmentRecordId,e.orgLocId=c.orgLocId,A.deleteFileFromSystem(e,function(c){f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")),a.getTreatmentDocumentList(),b.showSpinner=!1},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1})},function(a){errorCallback(a)})}function ia(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.documentId,c.recordId=b.treatmentRecordId,c.docType=q.documentTypes.treatment,c.docSubType=q.documentSubTypes.userTreatments,c.docSubType=q.documentSubTypes.userTreatments,c.orgLocId=b.orgLocId,a.fileResource=c,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0}a.treatment={},a.clinical={},a.treatment.currencyOnTreatment={},a.treatment.insuranceClaimCurrency={},a.IsVisible=!1,a.editMode=!1,a.viewMode=!1,a.orgLocPermission=s.USER_TREATMENT_ADD,a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,a.step5=!1,a.step6=!1,a.iconStep1=!0,a.iconStep2=!0,a.iconStep3=!0,a.iconStep4=!0,a.iconStep5=!0,a.iconStep6=!0,a.editmode=!1,a.minDate=new Date,
//$scope.clinicalNotes = [];
a.clinical={},a.field=!1,a.disable=!0,a.stateType=c.type,a.documentUpload={},a.documentUpload.document={},a.documentUpload2={},a.documentUpload2.document={},a.loginDetails=b.loggedInUserDetails,a.getDisease=P,a.getDiseaseVariant=R,a.getTreatmentTypeId=S,a.getCreatingOrgLoc=V,a.getUserNamesForRoleHistory=X,a.getMainProfessionalAssociated=W,a.getCurrencyOnTreatment=O,a.save=da,a.cancel=Y,a.uploadFile1=Z,a.uploadFile2=$,a.viewPrintFile1=_,a.viewPrintFile2=aa,a.apptViewPrintFile=ba,a.viewPrintProtocol=ca,a.getClinicalProtocol=T,a.getCliniclList=ea,a.getIncidentId=N,a.getTillDate=B,a.getSystemOrg=C,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=K,a.allowAccessOTP=L,a.getCreatingOrgTreatLoc=U,a.setData=M,a.getAppointmentForTreatment=D,a.getclinicalForAppointmentId=F,a.getPrescriptionForAppointmentId=J,a.getDocumentAttachmentsList=G,a.viewPrescriptionForTreatment=H,a.getIcd10Details=Q,a.deleteTreatmentAttachment=ha,a.treatmentViewPrintFile=ia,a.getTreatmentDocumentList=fa;var ja=v.getLoggedInUser();!ja||0!=ja.isOrganizationUserMode||ja&&ja.userAccountStatusDTO.whetherSubscriber||k(function(){w.show(w.alert().title(h.instant("INFORMATION")).textContent(h.instant("CREATE_TREATMENT_RECORD_SUB")).ok(h.instant("OK")))},2e3),
//for individual user subscription
// $scope.checkWhetherSubscriber = function(){
//            if($scope.loginDetails && $scope.loginDetails.whetherSubscriber == true ){
//                getSystemOrg();
//            }else{
//                function getCreatingOrgLoc();
//            }
//        }
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.whethersub=!0,a.treatment.user={},a.treatment.user.value=a.loginDetails.displayName,a.treatment.user.id=a.loginDetails.id,C()),a.initUserTreatmentsById=function(){"add"===c.type&&(c.data&&(a.treatment=c.data,c.data.diseaseVariant&&M(a.treatment)),a.orgLocPermission=s.USER_TREATMENT_ADD,/*manageUserTreatmentService.getTreatmentRecordId(function (successResponse) {
                    if (!utilService.isNullOrEmpty(successResponse)) {
                        $scope.treatment.treatmentRecordId = successResponse;
                    }
                },
                function (errorResponse) {
                    if (!utilService.isEmpty(errorResponse.data) &&
                            !utilService.isEmpty(errorResponse.data.messages[0])) {
                          notify("Alert", $translate.instant(errorResponse.data.messages[0]));
                         } else {
                          notify("error", $translate.instant("RECORD_GENERATE_FAILURE"));
                         }

                });*/
// $scope.queryObj = {};
// $scope.queryObj.userId = $rootScope.loggedInUserDetails.id;
// var url = urlService.getParameterizedUrl('FIND_USER_BY_ID', $scope.queryObj);
// if (url) {
//     return httpService.getData(url, null, function (response) {
//         if (response && response.data) {
//             $scope.currencyData = response.data;
//             $scope.treatment.currencyOnTreatment.id = $scope.currencyData.walletCurrencyId;
//             $scope.treatment.insuranceClaimCurrency.id = $scope.currencyData.walletCurrencyId;
//         }
//     }, function (error) {
//         if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//             notify("error", $translate.instant(error.data.messages[0]));
//         }
//     });
// }
// manageUserTreatmentService.getTreatmentId(function (successResponse) {
//         if (!utilService.isNullOrEmpty(successResponse)) {
//             $scope.treatment.treatmentId = successResponse;
//         }
//     },
//     function (errorResponse) {
//         if (!utilService.isEmpty(errorResponse.data) &&
//             !utilService.isEmpty(errorResponse.data.messages[0])) {
//             notify("Alert", $translate.instant(errorResponse.data.messages[0]));
//         } else {
//             notify("error", $translate.instant("RECORD_GENERATE_FAILURE"));
//         }
//     });
a.getCliniclList()),c.data&&(a.treatment=c.data,"view"===c.type&&b.loggedInUserDetails?(a.pageState="view",
//getAppointmentForTreatment();
a.viewmode=!0,a.disabled=!0,a.IsVisible=!0):"edit"===c.type&&b.loggedInUserDetails&&(a.orgLocPermission=s.USER_TREATMENT_ADD,a.pageState="edit",a.IsVisible=!0,a.editmode=!0)),c&&c.id&&("view"===c.type||"edit"===c.type||"viewmode"===c.type)&&(a.stateParamValue=c.id,
//getclinicalForAppointmentId();
t.getUserTreatmentById(c.id,function(b){a.treatment=b,a.treatment.lastTransactionId?E():D(),null!=b.amountSpent&&(a.treatment.amountSpent=parseInt(b.amountSpent)),b&&null!=b.treatmentLocationValue&&(a.treatment.treatmentLocation=b.treatmentLocationValue),b&&null!=b.professionalName&&(a.treatment.mainProfessionalAssociated=b.professionalName),"toAppointmentsTab"==c.stateFlag&&a.goToStep3(),"toPrescriptionTab"==c.stateFlag&&a.goToStep5(),
//                    if(sucessResponse && sucessResponse.clinicalProtocol){
//                    	$scope.treatment.clinicalProtocol=sucessResponse.clinicalProtocol;
//                    	getClinicalProtocol($scope.treatment.clinicalProtocol.value);
//                    }
M(a.treatment),
// $scope.setData();
a.disable=!1,a.stateParamValue=c.id;var d={};d.userId=a.treatment.user.id,d.locationId=a.treatment.creatingOrgLoc.id,
//$scope.getMainProfessionalAssociated($viewValue,$scope.treatment.treatmentLocation.id);
a.getIncidentId(a.treatment.user.id,a.treatment.creatingOrgLoc.id),a.getCliniclList()},function(b){a.manageOrgLocSpinner=!1,a.error=b,p.isEmpty(b.data)||p.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})),"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||K()},c.treatmentRecId&&t.getUserTreatmentById(c.treatmentRecId,function(b){a.treatment=b,M(a.treatment);
//$scope.setData();
var c={};c.userId=a.treatment.user.id,c.locationId=a.treatment.creatingOrgLoc.id,
//$scope.getMainProfessionalAssociated($viewValue,$scope.treatment.treatmentLocation.id);
a.getIncidentId(a.treatment.user.id,a.treatment.creatingOrgLoc.id),a.getCliniclList(),a.disable=!1,a.viewmode=!0,a.disabled=!0,a.IsVisible=!0,a.pageState="view"},function(b){a.manageOrgLocSpinner=!1,a.error=b,p.isEmpty(b.data)||p.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))}),a.initUserTreatmentsById(),a.checkMandatory1=function(){
// if(!$scope.treatment.dateEnd){
//     document.forms["addUserTreatment"]["dateEnd"].focus();
//     return true;
// }
return a.treatment.user?a.treatment.creatingOrgLoc?a.treatment.disease?a.treatment.diseaseVariant?a.treatment.dateStart?a.treatment.treatmentLocation?!a.treatment.treatmentType&&(document.forms.addUserTreatment.treatmentType.focus(),!0):(document.forms.addUserTreatment.treatmentLocation.focus(),!0):(document.forms.addUserTreatment.dateStart.focus(),!0):(document.forms.addUserTreatment.diseaseVariant.focus(),!0):(document.forms.addUserTreatment.disease.focus(),!0):(document.forms.addUserTreatment.creatingOrgLoc.focus(),!0):(document.forms.addUserTreatment.user.focus(),!0)},a.checkMandatory2=function(){
//if(document.forms["addUserTreatment"]["user"].validity.valueMissing){
//if(document.forms["addUserTreatment"]["user"].validity.valueMissing){
return a.treatment.user?a.treatment.creatingOrgLoc?a.treatment.disease?a.treatment.diseaseVariant?a.treatment.clinicalProtocol&&!a.treatment.clinicalProtocol.id?void f("error",h.instant("INVALID_PROTOCOL")):void 0:(document.forms.addUserTreatment.diseaseVariant.focus(),!0):(document.forms.addUserTreatment.disease.focus(),!0):(document.forms.addUserTreatment.creatingOrgLoc.focus(),!0):(document.forms.addUserTreatment.user.focus(),!0)},a.checkMandatory3=function(){return c.treatmentRecId?c.treatmentRecId:c.id?c.id:"edit"==c.type?c.type:void 0};var ka=angular.element(document.querySelector("#wizard1")),la=angular.element(document.querySelector("#wizard2")),ma=angular.element(document.querySelector("#wizard3")),na=angular.element(document.querySelector("#wizard4")),oa=angular.element(document.querySelector("#wizard5")),pa=angular.element(document.querySelector("#wizard6"));a.goToStep1=function(){a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,a.step5=!1,a.step6=!1,ka.addClass("btn-primary").removeClass("btn-default"),la.addClass("btn-default").removeClass("btn-primary"),ma.addClass("btn-default").removeClass("btn-primary"),na.addClass("btn-default").removeClass("btn-primary"),oa.addClass("btn-default").removeClass("btn-primary"),pa.addClass("btn-default").removeClass("btn-primary")},a.goToStep2=function(){if(!a.checkMandatory1()){if(a.treatment&&a.treatment.user&&!a.treatment.user.id)return void f("error",h.instant("INVALID_USER"));if(a.treatment&&a.treatment.creatingOrgLoc&&!a.treatment.creatingOrgLoc.id)return void f("error",h.instant("INVALID_ORGANIZATION"));if(a.treatment&&a.treatment.disease&&!a.treatment.disease.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.treatment&&a.treatment.diseaseVariant&&!a.treatment.diseaseVariant.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));
// if($scope.treatment && $scope.treatment.treatmentLocation && !$scope.treatment.treatmentLocation.id){
//     notify("error", $translate.instant("INVALID_LOCATION"));
//     return;
// }
// if($scope.treatment && $scope.treatment.mainProfessionalAssociated && !$scope.treatment.mainProfessionalAssociated.id){
//     notify("error", $translate.instant("INVALID_PROF"));
//     return;
// }
if(a.treatment&&a.treatment.treatmentType&&!a.treatment.treatmentType.id)return void f("error",h.instant("INVALID_TREATMENT"));
// if($scope.treatment && $scope.treatment.amountSpent){
// if($scope.treatment && $scope.treatment.currencyOnTreatment && !$scope.treatment.currencyOnTreatment.dataValue){
//     notify("error", $translate.instant("INVALID_CURRENCY"));
//     return;
// }
// }
if(a.treatment&&a.treatment.amountClaimedFromInsurance&&a.treatment&&!a.treatment.insuranceClaimCurrency)return void f("error",h.instant("INVALID_CURRENCY"));a.step1=!1,a.step2=!0,a.step3=!1,a.step4=!1,a.step5=!1,a.step6=!1,la.addClass("btn-primary").removeClass("btn-default"),ka.addClass("btn-default").removeClass("btn-primary"),ma.addClass("btn-default").removeClass("btn-primary"),na.addClass("btn-default").removeClass("btn-primary"),oa.addClass("btn-default").removeClass("btn-primary"),pa.addClass("btn-default").removeClass("btn-primary")}},a.goToStep3=function(){if(!a.checkMandatory2()){if(a.treatment&&a.treatment.user&&!a.treatment.user.id)return void f("error",h.instant("INVALID_USER"));if(a.treatment&&a.treatment.creatingOrgLoc&&!a.treatment.creatingOrgLoc.id)return void f("error",h.instant("INVALID_ORGANIZATION"));if(a.treatment&&a.treatment.disease&&!a.treatment.disease.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.treatment&&a.treatment.diseaseVariant&&!a.treatment.diseaseVariant.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));if(a.treatment&&a.treatment.clinicalProtocol&&!a.treatment.clinicalProtocol.id)return void f("error",h.instant("INVALID_PROTOCOL"));a.step1=!1,a.step2=!1,a.step3=!0,a.step4=!1,a.step5=!1,a.step6=!1,ma.addClass("btn-primary").removeClass("btn-default"),ka.addClass("btn-default").removeClass("btn-primary"),la.addClass("btn-default").removeClass("btn-primary"),na.addClass("btn-default").removeClass("btn-primary"),oa.addClass("btn-default").removeClass("btn-primary"),pa.addClass("btn-default").removeClass("btn-primary")}},a.goToStep4=function(){if(!a.checkMandatory2()&&a.checkMandatory3()){if(a.treatment&&a.treatment.user&&!a.treatment.user.id)return void f("error",h.instant("INVALID_USER"));if(a.treatment&&a.treatment.creatingOrgLoc&&!a.treatment.creatingOrgLoc.id)return void f("error",h.instant("INVALID_ORGANIZATION"));if(a.treatment&&a.treatment.disease&&!a.treatment.disease.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.treatment&&a.treatment.diseaseVariant&&!a.treatment.diseaseVariant.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));a.step1=!1,a.step2=!1,a.step3=!1,a.step4=!0,a.step5=!1,a.step6=!1,na.addClass("btn-primary").removeClass("btn-default"),ka.addClass("btn-default").removeClass("btn-primary"),la.addClass("btn-default").removeClass("btn-primary"),ma.addClass("btn-default").removeClass("btn-primary"),oa.addClass("btn-default").removeClass("btn-primary"),pa.addClass("btn-default").removeClass("btn-primary")}},a.goToStep5=function(){if(!a.checkMandatory2()&&a.checkMandatory3()){if(a.treatment&&a.treatment.user&&!a.treatment.user.id)return void f("error",h.instant("INVALID_USER"));if(a.treatment&&a.treatment.creatingOrgLoc&&!a.treatment.creatingOrgLoc.id)return void f("error",h.instant("INVALID_ORGANIZATION"));if(a.treatment&&a.treatment.disease&&!a.treatment.disease.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.treatment&&a.treatment.diseaseVariant&&!a.treatment.diseaseVariant.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));a.step1=!1,a.step2=!1,a.step3=!1,a.step4=!1,a.step5=!0,a.step6=!1,oa.addClass("btn-primary").removeClass("btn-default"),ka.addClass("btn-default").removeClass("btn-primary"),la.addClass("btn-default").removeClass("btn-primary"),ma.addClass("btn-default").removeClass("btn-primary"),na.addClass("btn-default").removeClass("btn-primary"),pa.addClass("btn-default").removeClass("btn-primary")}},a.goToStep6=function(){if(!a.checkMandatory2()&&a.checkMandatory3()){if(a.treatment&&a.treatment.user&&!a.treatment.user.id)return void f("error",h.instant("INVALID_USER"));if(a.treatment&&a.treatment.creatingOrgLoc&&!a.treatment.creatingOrgLoc.id)return void f("error",h.instant("INVALID_ORGANIZATION"));if(a.treatment&&a.treatment.disease&&!a.treatment.disease.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.treatment&&a.treatment.diseaseVariant&&!a.treatment.diseaseVariant.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));a.step1=!1,a.step2=!1,a.step3=!1,a.step4=!1,a.step5=!1,a.step6=!0,pa.addClass("btn-primary").removeClass("btn-default"),ka.addClass("btn-default").removeClass("btn-primary"),la.addClass("btn-default").removeClass("btn-primary"),ma.addClass("btn-default").removeClass("btn-primary"),na.addClass("btn-default").removeClass("btn-primary"),oa.addClass("btn-default").removeClass("btn-primary")}},new Def.Autocompleter.Search("icd10","https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code,name",{tableFormat:!1,valueCols:[0][1],colHeaders:["Code","Name"]}),a.fileChange=function(b){a.files=[];var b=angular.element(b);if(null===b){var c=angular.element(document.querySelector("input#fileInput")),d=c[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)}),c.val(null)}else{var d=b[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)})}a.files&&a.files.length>0&&qa(a.files)};var qa=function(b){var c={};c.documentType={},c.documentType.type="TREATMENT",c.documentType.subType="USER_TREATMENTS",c.documentType.id=24,a.fileUploadSpinner=!0,r.saveAllDocuments(c,!1,b,function(a){b&&b.length>0&&a&&ra(b,c,a)},function(b){a.fileUploadSpinner=!1})},ra=function(b,d,e){var f={};f.documentIds=[];for(var g=0;g<e.response.length;g++)f.documentIds.push(e.response[g].id);p.isFieldEmpty(c.id)||(f.treatmentRecordId=c.id),A.saveTransactionAttachment(f,function(a){b&&b.length>0&&e&&sa(b,d,e,f)},function(b){a.fileUploadSpinner=!1,A.deleteAllDocument(f.documentIds,function(a){},function(a){})})},sa=function(b,d,e,g){var i=new Object;i.docType=d.documentType.type,i.docSubType=d.documentType.subType,i.recordId=c.id,i.orgLocId=a.treatment.creatingOrgLoc.id,e.response&&(i.resourceDetails=JSON.stringify(e.response)),r.uploadMultipleFiles(i,b,function(b){a.fileUploadSpinner=!1,f("success",h.instant("RECORD_SAVED_SUCCESS")),fa()},function(b){a.fileUploadSpinner=!1,f("Error",h.instant("ERROR_WHILE_UPLOADING")),A.deleteByTransactionIdAndDocIds(g,function(a){A.deleteAllDocument(g.documentIds,function(a){},function(a){})},function(a){})})};
// for  user treatment summary popup 
a.cancel1=function(){w.cancel()},a.callManageTreatment=function(b){a.newTreatment=b,w.cancel(),d.go("manageUserTreatment",{type:"add",data:a.newTreatment})},a.treatViewPrintFile=function(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.documentId,c.recordId=b.treatmentRecordId,c.orgLocId=b.orgLocId,c.docType=q.documentTypes.treatment,c.docSubType=q.documentSubTypes.userTreatments,a.fileResource=c,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0},a.transactionViewPrintFile=function(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.documentId,c.recordId=b.transactionId,c.orgLocId=b.orgLocId,c.docType=q.documentTypes.transaction,c.docSubType=q.documentSubTypes.emergencyTransaction,a.fileResource=c,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0};
//data table config
var ta=q.gridConfigurations;a.options=g.setOptionProperties(ta),a.dtColumnDefs=g.setColumnProperties({}),
//data table config2
a.options2=g.setOptionProperties(ta),a.dtColumnDefs2=g.setColumnProperties({}),
//data table config3
a.options3=g.setOptionProperties(ta),a.dtColumnDefs3=g.setColumnProperties({}),a.makePrescription1=z.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="viewUserTreatment";var h=void 0;a.makePrescription1(b,c,d,e,g,h,f)},a.$on("getTreatmentDocumentList",function(){a.getTreatmentDocumentList()}),a.getPrescriptionRef=function(b,c){return a.reqObj={},a.reqObj.userId=b,a.reqObj.searchKeyWord=c,n.getData(o.getParameterizedUrl("GET_PAST_PRESCRIPTION_BY_USER_AND_KEYWORD",a.reqObj),null,function(b){return a.treatmentTypeLoad=angular.fromJson(b.data)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}}]),angular.module("paripal.diseaseTreatmentModule").controller("searchDiseaseTreatmentType",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","searchDiseaseTreatmentTypeService","httpService","urlService","commonConstants","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";
//$scope.viewTreatmentStatistics=viewTreatmentStatistics;
function p(a){d.go("searchTreatmentIssue",{treatmentTypeId:a.treatmentTypeId.id,treatmentType:a.treatmentTypeId.value})}function q(){d.go("manageDiseaseTreatmentType",{type:""})}function r(){k.getData(l.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!n.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function s(b){var c=!1;return a.accessabelSystemLocation&&!n.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){if(a&&b&&a.id==b)return c=!0}),c}function t(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.diseaseId=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function u(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.diseaseId?(a.searchKeyWord.diseaseId=a.filter.diseaseId.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function v(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,k.getData(l.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function w(b){var c={};c.keyword=b;var d=l.getParameterizedUrl("FIND_ACCESSIBLE_LOCATION_BY_KEYWORD",c);if(d)return k.getData(d,null,function(b){if(b&&b.data)return a.orgLocId=b.data,a.orgLocId},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function x(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()}function y(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()}function z(b,c){j.getDiseaseTreatmentById(b,function(e){a.diseaseTreatment=e;var f;f=c?"edit":"view",d.go("manageDiseaseTreatmentType",{id:b,type:f,data:a.diseaseTreatment})},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}function A(b,c){var d={};d.id=b,j.inactivate(d,function(b){b&&(a.treatments[c].whetherActive=!a.treatments[c].whetherActive,f("success",h.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.addNew=q,a.orgLocPermission=o.DISEASE_TREATMENT_TYPE_ADD,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.filter={},a.whetherAccessable=!1,a.getDisease=t,a.getDiseaseVariant=u,a.getTreatmentTypeId=v,a.getCreatingOrgLocId=w,a.crud=z,a.pageChanged=x,a.setMaxRecords=y,a.inactivate=A,a.treatmentIssues=p,a.checkAccess=s,a.getAccessabelSystemLocation=r,
//            function viewTreatmentStatistics(){
//            	$state.go('searchTreatmentIssue');
//            }
a.clear=function(){d.go("searchDiseaseTreatmentType"),a.filter={},a.fetchRecords()},a.fetchRecords=function(){if(a.filter&&a.filter.diseaseId&&!a.filter.diseaseId.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.filter&&a.filter.diseaseVariantId&&!a.filter.diseaseVariantId.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));if(a.filter&&a.filter.orgLocId&&!a.filter.orgLocId.id)return void f("error",h.instant("INVALID_LOCATION"));if(a.filter&&a.filter.treatmentTypeId&&!a.filter.treatmentTypeId.id)return void f("error",h.instant("INVALID_TREATMENT"));var b=(a.filter,{});a.filter.diseaseId&&a.filter.diseaseId.id&&(b.diseaseId=a.filter.diseaseId.id),a.filter.diseaseVariantId&&a.filter.diseaseVariantId.id&&(b.diseaseVariantId=a.filter.diseaseVariantId.id),a.filter.treatmentTypeId&&a.filter.treatmentTypeId.id&&(b.treatmentTypeId=a.filter.treatmentTypeId.id),a.filter.orgLocId&&a.filter.orgLocId.id&&(b.orgLocId=a.filter.orgLocId.id),a.filter.branch&&a.filter.branch.id&&(b.branch=a.filter.branch.id),a.filter.subBranch&&a.filter.subBranch.id&&(b.subBranch=a.filter.subBranch.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,j.fetchRecords(b,function(b){b&&(a.treatments=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))})};
//data table config
var B=m.gridConfigurations;a.options=g.setOptionProperties(B),a.dtColumnDefs=g.setColumnProperties({}),a.branch=function(){var b={};b.code="treatmentTypeBranch",k.getData(l.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.branch=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.branch(),a.subBranch=function(){var b={};b.code="treatmentTypeSubBranch",k.getData(l.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranch=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.subBranch(),r(),a.fetchRecords()}]),angular.module("paripal.diseaseTreatmentModule").controller("viewUserTreatmentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","MakePrescriptionFactory","viewUserTreatmentService","httpService","urlService","utilService","commonConstants","featurePrivilegeConstants","baseService","$mdDialog","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(a){d.go("viewUserTreatmentIssue",{treatmentRecId:a})}function u(a){d.go("viewUserTreatmentImages",{treatmentRecId:a})}function v(a){d.go("viewUserTreatmentQueries",{treatmentRecId:a})}/*function treatmentRelatedStatistics(){
        $state.go('viewUserTreatmentQueries');
        }
        function treatmentTransactions(){
        $state.go('viewUserTreatmentQueries');
        }*/
function w(a){d.go("searchUserFamilyHistory",{userId:a.user.id,userName:a.user.value})}function x(a){r.show({templateUrl:"app/modules/disease-treatment/views/user-treatment-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{type:"add",userId:a.userId},controller:["$scope","$mdDialog","locals","manageUserTreatmentService",function(a,e,g,i){function j(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,l.getData(m.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.treatment.creatingOrgLoc=b.data[0],k(a.treatment.user.id,a.treatment.creatingOrgLoc.id),p(a.treatment.user.id,a.treatment.creatingOrgLoc.id),a.treatment.creatingOrgLoc},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function k(b,c){var d={};d.userId=b,d.locationId=c;var e=m.getParameterizedUrl("GET_INCIDENT_ID_FOR_TREATMENT",d);if(e)return l.getData(e,null,function(b){if(b&&b.data)return a.incidentId=b.data,a.incidentId},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function p(b,c){if(a.whethersub){var d={};d.userId=b,d.creatingOrgId=c;var e=m.getParameterizedUrl("FIND_DISEASEVARIANT_FOR_IND_SUB",d)}else{var d={};d.userId=b,
//searchKeyWord.locId=locId;
d.creatingOrgId=c;
//var url = urlService.getParameterizedUrl('FIND_DISEASE_VARIANT_BY_USER_AND_LOCATION',searchKeyWord);
var e=m.getParameterizedUrl("FIND_DISEASEVARIANT_FOR_IND_SUB",d)}if(e)return l.getData(e,null,function(b){if(b&&b.data)return a.diseaseVariant=b.data,a.diseaseVariant},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function q(b){a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=b;var c=m.getParameterizedUrl("FIND_DISEASE_BY_VARIANT_ID",a.searchKeyWord);if(c)return l.getData(c,null,function(b){b&&b.data&&(a.treatment.disease=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function r(b){if(a.loginDetails.userAccountStatusDTO.whetherSubscriber=!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function s(b){var c={};return c.keyword=b,l.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function t(b){var c={};return c.searchKeyword=b,l.getData(m.getParameterizedUrl("GET_ORG_LOC_BY_ALL",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||
//notify("error", $translate.instant(error.data.messages[0]));
f("error","Please enter valid data")},{orgLocPermission:a.orgLocPermission})}function u(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,l.getData(m.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function v(){
//$scope.treatment.insuranceClaimCurrency.value=$scope.treatment.insuranceClaimCurrency.dataValue.value;
return a.treatment&&a.treatment.currencyOnTreatment&&a.treatment.currencyOnTreatment.dataValue&&(a.treatment.currencyOnTreatment.id=a.treatment.currencyOnTreatment.dataValue.id,a.treatment.currencyOnTreatment.value=a.treatment.currencyOnTreatment.dataValue.value,delete a.treatment.currencyOnTreatment.dataValue),a.treatment&&a.treatment.insuranceClaimCurrency&&a.treatment.insuranceClaimCurrency.dataValue&&(a.treatment.insuranceClaimCurrency.id=a.treatment.insuranceClaimCurrency.dataValue.id,a.treatment.insuranceClaimCurrency.value=a.treatment.insuranceClaimCurrency.dataValue.value,delete a.treatment.insuranceClaimCurrency.dataValue),a.treatment.clinicalProtocol&&!a.treatment.clinicalProtocol.id?void f("error",h.instant("INVALID_PROTOCOL")):(a.treatment&&a.treatment.treatmentLocation&&!a.treatment.treatmentLocation.id&&(a.treatment.treatmentLocationValue=a.treatment.treatmentLocation,delete a.treatment.treatmentLocation),a.treatment&&a.treatment.mainProfessionalAssociated&&a.treatment.mainProfessionalAssociated.id&&(delete a.treatment.mainProfessionalAssociated.version,delete a.treatment.mainProfessionalAssociated.displayName,delete a.treatment.mainProfessionalAssociated.professionalId),a.treatment&&""==a.treatment.mainProfessionalAssociated&&delete a.treatment.mainProfessionalAssociated,a.treatment&&""==a.treatment.clinicalProtocol&&delete a.treatment.clinicalProtocol,a.treatment&&a.treatment.mainProfessionalAssociated&&!a.treatment.mainProfessionalAssociated.id&&(a.treatment.professionalName=a.treatment.mainProfessionalAssociated,delete a.treatment.mainProfessionalAssociated),a.treatment&&a.treatment.clinicalProtocol&&a.treatment.clinicalProtocol.id&&(a.treatment.clinicalProtocol.id=a.treatment.clinicalProtocol.id,a.treatment.clinicalProtocol.value=a.treatment.clinicalProtocol.protocol,a.treatment.clinicalProtocol.organizationLocationId=a.treatment.clinicalProtocol.organizationLocationId,delete a.treatment.clinicalProtocol.version,delete a.treatment.clinicalProtocol.creatingOrgLoc,delete a.treatment.clinicalProtocol.disease,delete a.treatment.clinicalProtocol.diseaseVariant,delete a.treatment.clinicalProtocol.documentId,delete a.treatment.clinicalProtocol.protocolFile,delete a.treatment.clinicalProtocol.whetherActive,delete a.treatment.clinicalProtocol.dateAdded,delete a.treatment.clinicalProtocol.description,delete a.treatment.clinicalProtocol.protocol),!n.isEmpty(a.treatment)&&a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload&&(a.treatment.treatmentSummaryFile=a.userTreatmentFile.fileToBeUpload.name),!n.isEmpty(a.treatment)&&a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload&&(a.treatment.feedbackFromScan=a.userTreatmentScanFile.fileToBeUpload.name),void(a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload?(a.documentUpload.document.fileName=a.userTreatmentFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.userTreatmentFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.treatment.creatingOrgLoc.id,a.documentUpload.document.documentType={subType:o.documentSubTypes.userTreatments},"add"!=c.type&&a.treatment.documentId&&(a.documentUpload.document.id=a.treatment.documentId),i.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.userTreatmentFile.fileToBeUpload&&(a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload&&a.userTreatmentFile.fileToBeUpload.name&&a.uploadFile1(a.userTreatmentFile,a.treatment,b),a.treatment&&a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload?(a.documentUpload2.document.fileName=a.userTreatmentScanFile.fileToBeUpload.name,a.documentUpload2.document.fileSize=a.userTreatmentScanFile.fileToBeUpload.size,a.documentUpload2.document.organizationLocationId=a.treatment.creatingOrgLoc.id,a.documentUpload2.document.documentType={subType:o.documentSubTypes.userTreatments},"add"!=c.type&&a.treatment.feedbackDocumentId&&(a.documentUpload2.document.id=a.treatment.feedbackDocumentId),i.saveDocumentDetails(a.documentUpload2.document,c.type,function(b){a.attachmentFormSpinner=!1,a.userTreatmentScanFile.fileToBeUpload&&(a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload&&a.userTreatmentScanFile.fileToBeUpload.name&&a.uploadFile2(a.userTreatmentScanFile,a.treatment,b),a.treatment&&a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):i.save(a.treatment,function(b){b&&(e.cancel(),c.id?(a.stateParamValue=c.id,a.disable=!1):(c.id=b.response,a.stateParamValue=c.id,a.disable=!1),
//$state.go('viewUserTreatment');
null!=a.treatment.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})))}a.treatment={},a.getSystemOrg=j,a.getDiseaseVariant=p,a.getDisease=q,a.getTreatmentTypeId=u,a.getUserNamesForRoleHistory=r,a.getCreatingOrgLoc=s,a.getCreatingOrgTreatLoc=t,a.loginDetails=b.loggedInUserDetails,a.getIncidentId=k,a.save=v,
// for  user treatment summary popup 
a.cancel1=function(){e.cancel()},a.callManageTreatment=function(b){a.newTreatment=b,e.cancel(),d.go("manageUserTreatment",{type:"add",data:a.newTreatment})},a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.whethersub=!0,a.treatment.user={},a.treatment.user.value=a.loginDetails.displayName,a.treatment.user.id=a.loginDetails.id,j());var w=angular.fromJson(localStorage.getItem("defaultOrgLoc"));g.userId&&(a.treatment.user=g.userId),null!=w&&(a.treatment.treatmentLocation={id:w.id,value:w.value},a.treatment.creatingOrgLoc={id:w.id,value:w.value},p(a.treatment.user.id,a.treatment.creatingOrgLoc.id))}]})}
//check access for managing data
function y(b){var c=!1;return a.accessibleSubscriberLocation&&!n.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}function z(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,l.getData(m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.diseaseId=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function A(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.diseaseId?(a.searchKeyWord.diseaseId=a.filter.diseaseId.id,a.diseaseVariantLoad=!0,l.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function B(c){var d={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return d.keyword=c,a.loginDetails&&a.loginDetails.isOrganizationUserMode?d.userId=a.filter.userId.id:d.userId=b.loggedInUserDetails.id,l.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD",d),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}
//   function getUserNamesForRoleHistory(viewValue) {
//       var userData = {};
//       userData.searchString = viewValue;
//       $scope.userNameAutoCmpLoading = true;
//       return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_LIST_BY_SEACRH_KEY', userData),
//               null, function (response) {
//           $scope.userNameAutoCmpLoading = false;
//           return $scope.users = response.data;
//       }, function (error) {
//           $scope.userNameAutoCmpLoading = false;
//            if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//     notify("Alert", $translate.instant(error.data.messages[0]));
// }
//       });
//   }
function C(b){if(a.loginDetails.userAccountStatusDTO.whetherSubscriber=!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function D(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()}function E(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()}function F(b,c){k.getUserTreatmentById(b,function(e){a.userTreatment=e;var f;f=c?"edit":"view",d.go("manageUserTreatment",{id:b,type:f,data:a.userTreatment})},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.addNew=x,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.disable=!0,a.filter={},a.hasAccessibleSubscriberLocation=!1,a.accessibleSubscriberLocation={},a.orgLocPermission=p.USER_TREATMENT_ADD,a.checkOrganizationLocationAccess=y,a.getDiseaseVariant=A,a.getUserNamesForRoleHistory=C,a.getDisease=z,a.crud=F,a.loginDetails=b.loggedInUserDetails,a.pageChanged=D,a.setMaxRecords=E,a.treatmentRelatedIssues=t,a.treatmentRelatedImages=u,a.treatmentQueries=v,a.getCreatingOrgLoc=B,
//$scope.treatmentRelatedStatistics=treatmentRelatedStatistics;
// $scope.treatmentTransactions=treatmentTransactions;
a.userFamilyHistory=w,
//$scope.viewTreatmentStatistics=viewTreatmentStatistics;
q.validateListing("CREATE_TREATMENT_RECORD_SUB"),a.listView=!0,a.cardView=!1,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1):(a.cardView=!1,a.listView=!0),"Card view"===c?"List View":"Card view"})}),
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.filter.userId={},a.filter.userId.value=b.loggedInUserDetails.displayName,a.filter.userId.id=b.loggedInUserDetails.id),b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode&&(a.filter.userId={},a.filter.userId.value=c.userName,a.filter.userId.id=c.userId),a.clear=function(){d.go("viewUserTreatment"),a.filter={},a.treatments=[],a.disable=!1,a.filterRecords={},c.userId=null,c.diseaseId=null,c.diseaseVariantId=null,c.creatingOrgLoc=null,c.userName=null,c.diseaseVariantName=null,c.diseaseName=null,c.locationName=null,d.go("usersideeffectlist",{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1})},/*Here we have user redirect from user issue page*/
c.userId&&c.diseaseVariantId&&c.diseaseId&&(a.filter||(a.filter={}),a.filter.userId||(a.filter.userId={}),a.filter.diseaseId||(a.filter.diseaseId={}),a.filter.diseaseVariantId||(a.filter.diseaseVariantId={}),a.filter.creatingOrganization||(a.filter.creatingOrgLoc={}),a.filter.userId.id=c.userId,a.filter.diseaseId.id=c.diseaseId,a.filter.diseaseVariantId.id=c.diseaseVariantId),"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,c.userName&&c.locationId&&(a.filter={},a.filter.userId={},a.filter.creatingOrganization={},a.filter.creatingOrganization.id=c.locationId,a.filter.creatingOrganization.value=c.locationName,a.filter.userId.id=c.userId,a.filter.userId.value=c.userName),c.userName&&c.userId&&c.diseaseVariantId&&c.diseaseVariantName&&(a.filter={},a.filter.userId={},a.filter.creatingOrganization={},a.filter.diseaseVariantId={},a.filter.diseaseId={},a.filter.creatingOrganization.id=c.locationId,a.filter.creatingOrganization.value=c.locationName,a.filter.userId.id=c.userId,a.filter.userId.value=c.userName,a.filter.diseaseVariantId.id=c.diseaseVariantId,a.filter.diseaseVariantId.value=c.diseaseVariantName,a.filter.diseaseId.id=c.diseaseId,a.filter.diseaseId.value=c.diseaseName),
//$scope.filter.diseaseVariantId = {};
//$scope.filter.diseaseVariantId.id = $stateParams.diseaseVariantId;
//$scope.filter.diseaseVariantId.value=$stateParams.diseaseVariantName;
//$scope.filter.diseaseId = {};
//$scope.filter.diseaseId.id = $stateParams.diseaseId;
//$scope.filter.diseaseId.value=$stateParams.diseaseName;
//$scope.filter.creatingOrganization.id= $stateParams.locationId;
//$scope.filter.creatingOrganization.value=$stateParams.locationName;
// }
a.fetchRecords=function(){if(a.filter&&a.filter.userId&&!a.filter.userId.id)return void f("error",h.instant("INVALID_USER"));if(a.filter&&a.filter.diseaseId&&!a.filter.diseaseId.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.filter&&a.filter.diseaseVariantId&&!a.filter.diseaseVariantId.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));if(a.filter&&a.filter.creatingOrganization&&!a.filter.creatingOrganization.id)return void f("error",h.instant("INVALID_ORGANIZATION"));var b=(a.filter,{});a.filter.diseaseVariantId&&a.filter.diseaseVariantId.id&&(b.diseaseVariantId=a.filter.diseaseVariantId.id),a.filter.diseaseId&&a.filter.diseaseId.id&&(b.diseaseId=a.filter.diseaseId.id),a.filter.userId&&a.filter.userId.id&&(b.userId=a.filter.userId.id),a.filter.creatingOrganization&&a.filter.creatingOrganization.id&&(b.creatingOrganization=a.filter.creatingOrganization.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,k.fetchRecords(b,function(b){b&&(a.treatments=b.data,a.treatmentCopy=angular.copy(a.treatments),a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))})},(a.filter.userId&&a.filter.userId.id||b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode||!b.loggedInUserDetails)&&a.fetchRecords();
// if($rootScope.loggedInUserDetails && !$rootScope.loggedInUserDetails.isOrganizationUserMode){
//  $scope.fetchRecords();
// }
// if(!$rootScope.loggedInUserDetails){
//    $scope.fetchRecords();
// }
//data table config
var G=o.gridConfigurations;a.options=g.setOptionProperties(G),a.dtColumnDefs=g.setColumnProperties({}),a.getAccessibleSubscriberLocation=function(b){return l.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.inActivate=function(b,c){k.inActivate(b,function(b){b&&(a.treatments.splice(c,1),f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")),a.fetchRecords())},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_DELETED_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})},a.makePrescription1=j.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="viewUserTreatment";var h=void 0;a.makePrescription1(b,c,d,e,g,h,f)},a.goToAppointmentsTab=function(a){var b="edit";d.go("manageUserTreatment",{id:a.id,type:b,data:a,stateFlag:"toAppointmentsTab"})},a.goToPrescriptionTab=function(a){var b="edit";d.go("manageUserTreatment",{id:a.id,type:b,data:a,stateFlag:"toPrescriptionTab"})}}]),angular.module("paripal.diseaseTreatmentModule").service("manageDiseaseTreatmentTypeService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.save=function(c,d,e){var f="SAVE_DISEASE_TREATMENT_TYPE";null!=c.id&&(f="UPDATE_DISEASE_TREATMENT_TYPE"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseTreatmentModule").service("manageUserTreatmentService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.save=function(c,e,f){c.dateStart=d.convertToServerDate(c.dateStart),c.dateEnd=d.convertToServerDate(c.dateEnd);var g="SAVE_USER_TREATMENT";null!=c.id&&(g="UPDATE_USER_TREATMENT"),a.postData(b.getUrl(g),c,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})};this.getTreatmentRecordId=function(c,d){a.getData(b.getUrl("GET_TREATMENT_RECORD_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.getTreatmentId=function(c,d){a.getData(b.getUrl("GET_TREATMENT_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.getTreatmentClinicalById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_TREATMENT_CLINICAL_NOTE_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveTreatmentClinical=function(c,d,e){var f="TREATMENT_CLINICAL_NOTE_SAVE";null!=c.id&&(f="TREATMENT_CLINICAL_NOTE_UPDATE"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.updateTreatmentClinical=function(c,d,e){
//var url='TREATMENT_CLINICAL_NOTE_SAVE';
if(null!=c.id)var f="TREATMENT_CLINICAL_NOTE_UPDATE";a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteTreatmentClinical=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("TREATMENT_CLINICAL_NOTE_DELETE",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getClinicalListByRecId=function(c,d,e){var f={};f.recordId=c,a.getData(b.getParameterizedUrl("TREATMENT_CLINICAL_NOTE_BY_REC_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveDocumentDetails=function(c,d,e,f){"edit"===d&&a.putData(b.getUrl("UPDATE_DOCUMENT_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)}),("edit"!==d||c.id)&&"add"!==d&&c.id||a.postData(b.getUrl("SAVE_DOCUMENT_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)})}}]),angular.module("paripal.diseaseTreatmentModule").service("searchDiseaseTreatmentTypeService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.fetchRecords=function(c,d,e){a.postData(b.getUrl("GET_DISEASE_TREATMENT_TYPE_BY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDiseaseTreatmentById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_DISEASE_TREATMENT_TYPE_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.inactivate=function(c,d,e){a.getData(b.getParameterizedUrl("INACTIVE_DISEASE_TREATMENT_TYPE",c),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseTreatmentModule").service("viewUserTreatmentService",["httpService","$filter","urlService","dateconvertor","utilService","$timeout",function(a,b,c,d,e,f){"use strict";this.fetchRecords=function(b,d,e){
//   	if(filter.dateStart){
//   		filter.dateStart = dateconvertor.convertToServerDate(filter.dateStart);
// }
a.postData(c.getUrl("GET_USER_TREATMENT_BY_CRITERIA"),b,function(a){a&&a.data?(g(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.getUserTreatmentById=function(d,e,f){var g={};g.id=d,a.getData(c.getParameterizedUrl("GET_USER_TREATMENT_BY_ID",g),null,function(a){var c="MM/dd/yyyy";a&&a.data?(a.data.dateStart=b("timestampToDate")(a.data.dateStart,c),a.data.dateEnd=b("timestampToDate")(a.data.dateEnd,c),e(a.data)):f(a)},function(a){f(a)})};var g=function(a){var c="MM/dd/yyyy";angular.forEach(a,function(a,d){a.dateStart=b("timestampToDate")(a.dateStart,c),a.dateEnd=b("timestampToDate")(a.dateEnd,c)})};this.inActivate=function(b,d,e){var f={};f.id=b,a.deleteData(c.getParameterizedUrl("DELETE_USER_TREATMENT",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.fullCalendarModule").controller("DocumentInstancesListCtrl",["datatableconfig","serverSidePagination","$state","utilService","commonCalendarService","$scope","$filter","httpService","urlService","$compile","$timeout","createCalendarService","uiCalendarConfig","$mdDialog","$mdMedia","$rootScope","notify","userStatusService","baseService","$translate","docMgntService","orbeonFormRunner","commonConstants","fileOperations","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.filterCriteria={},f.user={},f.formTemplate={},f.fromIndDashboard,/*$scope.calendars=commonCalendarService.trial2();*/
f.onEntitySelect=function(a){f.calendarSearchCriteria.entityId=a.id},f.getFormTemplates=function(a){return f.requestData={},f.requestData.form=a,f.userNameAutoCmpLoading=!0,h.getData(i.getParameterizedUrl("GET_FORM_TEMPLATES",f.requestData),null,function(a){return f.userNameAutoCmpLoading=!1,angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.getUserNameData=function(a){return f.userData={},f.userData.userName=a,f.userNameAutoCmpLoading=!0,h.getData(i.getParameterizedUrl("FIND_USERBYNAME",f.userData),null,function(a){return f.userNameAutoCmpLoading=!1,f.users=angular.fromJson(a.data)},function(a){f.userNameAutoCmpLoading=!1})},f.templateNameSelected=function(a){f.filterCriteria.dynamicFormTemplateId=a.id},f.userNameSelected=function(a){f.filterCriteria.userId=a.id},f.populateData=function(a){var b={};b.id=a.id,u.populateDocumentInstances(b,function(a){q("success",a.successMessage),c.reload()},function(a){q("error",a.errorCode)})},f.viewForm=function(a){var b=a.orbeonFormName,c=a.orbeonDataDocumentId,d=a.referenceEntityId,e={};e.stateName="documentInstances",v.viewForm(b,c,d,e)},f.downloadPDF=function(a){var b=new Object;b.fileName=a.orbeonFormName+a.referenceEntityId+a.createdFor.id+".pdf",b.resourceId=a.pdfDocumentId,b.recordId=a.orbeonDocumentId,b.docType=w.documentTypes.orbeon,b.docSubType=w.documentSubTypes.OrbeonSubType,b.orgLocId=a.orgLocationId,b.userId=a.createdFor.id,x.downloadFile(b,function(a){},function(a){})},f.downloadXML=function(a){var b={};b.fileName=a.orbeonFormName,b.dataDocumentId=a.orbeonDataDocumentId,v.downloadXMLFile(b,function(a){},function(a){})},f.getDocumentInstanceList=function(){var a={};f.formTemplate.templateId&&(a.dynamicFormTemplateId=f.formTemplate.templateId.id),f.user.userId&&(a.userId=f.user.userId.id),a.pageNumber=f.currentPage,a.recordsPerPage=f.itemPerPage,u.filterDocumentInstances(a,function(a){f.instanceList=a,f.totalItems=a.totalRecords,f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems)},function(a){})},f.pageChanged=function(){f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems),f.getDocumentInstanceList()},f.setMaxRecords=function(a){f.pageNumber=1,f.itemPerPage=a,f.getDocumentInstanceList()},f.clear=function(){f.formTemplate.templateId=null,f.user.userId=null,f.getDocumentInstanceList()};
//datatble config json
var z={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(z),f.dtColumnDefs=a.setColumnProperties({}),f.shareDoc=function(){},f.init=function(){d.isNullOrEmpty(y.data)||"fromIndDashboard"==y.data&&(f.fromIndDashboard=!0,f.user.userId={id:angular.fromJson(s.getLoggedInUser()).id,displayName:angular.fromJson(s.getLoggedInUser()).displayName},f.userNameSelected(f.user.userId)),f.getDocumentInstanceList()},f.init()}]),angular.module("paripal.documentManagementModule").controller("DocumentManagementCtrl",["$scope","$rootScope","$filter","$stateParams","$state","$location","datatableconfig","$uibModal","httpService","urlService","service","dateconvertor","notify","$translate","serverSidePagination","docMgntService","$sce","$cookieStore","$cookies","orbeonFormRunner","utilService","baseService","baseConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){
///join video function
function x(c){"audio"==c?(a.audioViewAg=!0,a.agoraCallType="Audio"):"video"==c&&(a.videoViewAg=!0,a.disableVideoButton=!0,a.videoCallDisable=!0,a.agoraCallType="Video"),"APPOINTMENT"==d.convType?a.hideCallButton=!0:"EMERGENCY"!=d.convType&&"DIRECT_CALL"!=d.convType||(a.hideCallButton=!0),a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1;var e=null;a.appId={},
//$scope.appId.value = "edefc5ac273443d589bf440627ff7789";
a.appId.value=w.agoraAppId.toString(),
//$scope.appId.value = "4c950f2af4a9458c9907a427e203796b";
//$scope.appId.value ="3efe9975e0e8435f8b6867560764d57a";
a.channel={},a.channel.value="1000",console.log("Init AgoraRTC client with App ID: "+a.appId.value),
//appId.value = edefc5ac273443d589bf440627ff7789;
b.$broadcast("ngWebcam_on");var f=AgoraRTC.createClient({mode:"live"});f.init(a.appId.value,function(){console.log("AgoraRTC client initialized"+f),f.join(e,a.channel.value,null,function(a){console.log("User "+a+" join channel successfully")},function(a){console.log("Join channel failed",a)})},function(a){console.log("AgoraRTC client init failed",a)});var g="";f.on("error",function(a){console.log("Got error msg:",a.reason),"DYNAMIC_KEY_TIMEOUT"===a.reason&&f.renewChannelKey(g,function(){console.log("Renew channel key successfully")},function(a){console.log("Renew channel key failed: ",a)})}),f.on("stream-added",function(a){var b=a.stream;console.log("New stream added: "+b.getId()),console.log("Subscribe ",b),f.subscribe(b,function(a){console.log("Subscribe stream failed",a)})}),f.on("stream-subscribed",function(a){var c=a.stream;console.log("stream--->"+c),console.log("Subscribe remote stream successfully: "+c.getId()),b.showSpinner=!1,0===$("div#video #agora_remote"+c.getId()).length&&$("div#video").append('<div id="agora_remote'+c.getId()+'" style="float:left; width:500px;height:500px;display:inline-block;zoom:100%"></div>'),c.play("agora_remote"+c.getId())}),f.on("stream-removed",function(a){var b=a.stream;b.stop(),localStream.close(),$("#agora_remote"+b.getId()).remove(),console.log("Remote stream is removed "+b.getId())}),f.on("peer-leave",function(a){var b=a.stream;b&&(b.stop(),localStream.close(),$("#agora_remote"+b.getId()).remove(),console.log(a.uid+" leaved from this channel"))})}a.documentFormTemplatesList=[],
//$scope.documentFormTemplatesList=[{id:1,organizationLocationName:"org1",formName:"test",transactionTypeName:{code:"c1",value:"c1"},whetherActive:true,language:"EN",isCustomizable:true,isDefault:true}];
a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.error={},a.org={},a.orgLoc={},a.orgLoc.data={},/**************************************************LIST****************************************************************/
a.searchDynamicFormTemplates=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,p.searchDynamicFormTemplates(a.searchCriteria,function(b){a.documentFormTemplatesList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.error=b,m("error",n.instant("DOC_TEMPLATE_LIST_FAILURE"))})},a.fetchRecords=function(){
// $scope.searchCriteria.transactionTypeId=1;
// $scope.searchCriteria.serviceTypeId=1;
a.orgLoc&&a.orgLoc.data&&(a.searchCriteria.organizationLocationId=a.orgLoc.data.id),a.searchDynamicFormTemplates()},a.clear=function(){a.searchCriteria={},a.orgLoc={}},a.cancel=function(){u.goBackToPrevState()},a.isEditPermission=function(a){var b=v.getLoggedInUser()?v.getLoggedInUser().id:0;return!!a.whetherCustomizable||a.createdByUserId==b},a.loadFormBuilder=function(b,c,d,f){
// http://localhost:8080/paripal-web/rest/user/findUserById/{xxf:get-request-parameter('recordId')}?access_token={xxf:get-request-parameter('access_token')}$cookies.get('token1')
//            $scope.iframeURL = $sce.trustAsResourceUrl(urlService.getOrbeonUrl('FORM_BUILDER_NEW_TEMPLATE_URL') + documentId + "?access_token=" + localStorage.getItem('paripal_token') + "&recordId=" + recordId + "&docType=" + referenceEntityType);
a.iframeURL=j.getOrbeonUrl("FORM_BUILDER_NEW_TEMPLATE_URL")+c+"?access_token="+localStorage.getItem("paripal_token")+"&recordId="+b+"&docType="+d,e.go("formBuilder",{type:"iframe",url:a.iframeURL,savedRecordId:b,readonly:f})},a.loadFormRunner=function(b,c,d,f){
// http://localhost:8080/paripal-web/rest/user/findUserById/{xxf:get-request-parameter('recordId')}?access_token={xxf:get-request-parameter('access_token')}
s.put("formName",d,{path:"/"}),
//            $scope.iframeURL = $sce.trustAsResourceUrl(urlService.getOrbeonUrl('FORM_RUNNER_BASE_URL') + formName + "/new" + "?access_token=" + localStorage.getItem('paripal_token') + "&recordId=" + recordId + "&orgLocationId=" + orgLocationId);
a.iframeURL=j.getOrbeonUrl("FORM_RUNNER_BASE_URL")+d+"/new?access_token="+localStorage.getItem("paripal_token")+"&recordId="+b+"&orgLocationId="+f,e.go("formRunner",{type:"iframe",url:a.iframeURL,savedRecordId:b})},a.onMyFrameLoad=function(a){var b=a.contentWindow.document.body.innerHTML;cnsole.log(b)},a.moveToPreviousStep=function(){
//added for agora redirection 
"tabClose"==a.prevStateParam&&window.close(),a.prevStateParam&&a.prevStateParam.stateName&&(a.prevStateParam.params?e.go(a.prevStateParam.stateName,a.prevStateParam.params):e.go(a.prevStateParam.stateName))},/**************************************************ADD/EDIT****************************************************************/
//Add new addNewDocumentTemplate
a.addNewDocumentTemplate=function(){e.go("addDocTemplate",{type:"add"})},
//Edit new DocumentTemplate
a.editDocumentTemplate=function(b,c){p.getDynamicFormTemplateById(b,function(a){var c=a;e.go("editDocTemplate",{type:"edit",data:c,documentTemplateId:b})},function(b){a.error=b,m("error",n.instant("FORM_TEMPLATE_FETCH_FAILURE"))})},a.editDocumentTemplateContent=function(b,c,d){p.findIfDataPopulationRecordsPending(b,function(e){e.data?a.loadFormBuilder(b,c,d,"false"):m("error",n.instant("FORM_DATA_POPULATION_PENDING_TEMPLATE_CANT_BE_EDIT"))},function(b){a.error=b,m("error",n.instant("SERVER_ERROR"))})},a.viewDocumentTemplateContent=function(b,c,d){a.loadFormBuilder(b,c,d,"true")},a.runDocumentTemplateForm=function(a,b,c,d){
//$scope.loadFormRunner(id,documentId,formName,orgLocationId);
// orbeonFormRunner.loadOrbFormRunner(id,formName,documentId,orgLocationId);
t.loadFormRunner(a,"DEFAULT_EMERGENCY_FORM",3)},
//View new DocumentTemplate
a.viewDocumentTemplate=function(b){p.getDynamicFormTemplateById(b,function(a){var c=a;e.go("viewDocTemplate",{type:"view",data:c,documentTemplateId:b})},function(b){a.error=b})},a.saveAndLoadDocumentTemplate=function(b){a.WSDocTemplate.organizationLocation=a.orgLoc,p.saveDynamicFormTemplate(a.WSDocTemplate,function(b){console.log(b),m("success",n.instant("DOC_TEMPLATE_CREATE_SUCCESS")),a.loadFormBuilder(b.response.id,b.response.documentId,"false")},function(b){a.error=n.instant(b)})},a.updateDocumentTemplateDetails=function(b){a.WSDocTemplate.organizationLocation=a.orgLoc,p.updateDynamicFormTemplate(b,function(a){console.log(a),m("success",n.instant("DOC_TEMPLATE_UPDATE_SUCCESS")),e.go("documentManagement",{type:"list"})},function(b){a.error=b})},a.setData=function(b){a.loadTransactionTypes(),a.loadLanguages(),
// $scope.languages=[{id:1,value:'English'},{id:2,value:'Hindi'},{id:2,value:'Arabic'}];
a.whetherActive={},a.whetherActive.ACTIVE=!0,a.whetherActive.INACTIVE=!1,a.WSDocTemplate={},a.WSDocTemplate=b,b.organization&&(a.org={},a.org.data=b.organization),b.organizationLocation&&b.organizationLocation.id&&(a.orgLoc={},a.orgLoc.data=b.organizationLocation),b.transactionType&&b.transactionType.id&&(a.transactionTypeId=b.transactionType.id,a.loadServiceTypes(b.transactionType.id)),b.serviceType&&b.serviceType.id&&(a.serviceTypeId=b.serviceType.id),b.systemLanguage&&(a.selectedLanguage=b.systemLanguage),b.validFrom&&(a.WSDocTemplate.validFrom=b.validFrom),b.validTill&&(a.WSDocTemplate.validTill=b.validTill)},a.loadDocTemplateForm=function(){d.data?a.setData(d.data):d.documentTemplateId&&p.getDynamicFormTemplateById(d.documentTemplateId,function(b){a.setData(b)},function(b){a.error=b,m("error",n.instant("FORM_TEMPLATE_FETCH_FAILURE"))})},a.loadLanguages=function(){return p.getSystemLanguages(function(b){a.languages=b},function(b){a.error=b,m("error",n.instant("SYSTEM_LANGUAGES_FETCH_FAILURE"))})},a.loadTransactionTypes=function(){return p.getTransactionTypes(function(b){a.transactionTypes=b},function(b){a.error=b,m("error",n.instant("TRANSACTION_TYPES_FETCH_FAILURE"))})},a.loadServiceTypes=function(b){return p.getServiceTypes(b,function(b){a.serviceTypes=b},function(b){a.error=b,m("error",n.instant("SERVICE_TYPES_FETCH_FAILURE"))})},/**************************************************GRID SPECIFIC****************************************************************/
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems),a.searchDynamicFormTemplates()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchDynamicFormTemplates()};
//datatble config json
var y={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=g.setOptionProperties(y),a.dtColumnDefs=g.setColumnProperties({}),/************************************************** INIT ****************************************************************/
a.init=function(){if("add"==d.type){a.whetherActive={},a.whetherActive.ACTIVE=!0,a.whetherActive.INACTIVE=!1,a.WSDocTemplate={},a.WSDocTemplate.whetherActive=!0,a.WSDocTemplate.whetherCustomizable=!1,a.WSDocTemplate.validFrom=null,a.WSDocTemplate.validTill=null;var b=v.getDefaultOrgLocation();u.isFieldEmpty(b)||(a.org={data:b.org},a.orgLoc={data:b.orgLoc}),a.loadTransactionTypes(),a.loadLanguages()}if("edit"==d.type&&(a.disabled=!1,a.pageState="edit",a.loadDocTemplateForm()),"view"==d.type&&(a.disabled=!0,a.pageState="view",a.loadDocTemplateForm()),"list"==d.type&&a.searchDynamicFormTemplates(),"iframe"==d.type)if(d.url){
//added for video show in the case of agora video call
if(a.iframeURL=q.trustAsResourceUrl(d.url),a.readonly=d.readonly,a.prevStateParam=d.prevStateParam,localStorage.videoHtmlElement){var c=localStorage.getItem("videoHtmlElement");
//console.log(includeHtmlElement);
document.getElementById("videoTag").innerHTML=c,x("video")}}else p.getDynamicFormTemplateById(d.savedRecordId,function(b){a.iframeURL=q.trustAsResourceUrl(j.getOrbeonUrl("FORM_BUILDER_NEW_TEMPLATE_URL")+b.documentId+"?access_token="+localStorage.getItem("paripal_token")+"&recordId="+d.savedRecordId)},function(b){a.error=b,m("error",n.instant("FORM_TEMPLATE_FETCH_FAILURE"))})},a.init()}]),angular.module("paripal.documentManagementModule").controller("HelpDocumentListCtrl",["$scope","$translate","$rootScope","datatableconfig","$mdDialog","utilService","httpService","urlService","commonConstants","serverSidePagination","featurePrivilegeConstants","$state","registerService","notify",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.helpDocObj={},b.helpDocObj.userType="",b.languages=[],b.selectedLanguage={code:null},b.resourceFileDetail={},b.resourceDetail={};var p=l.getDefaultOrgLocation();i.isFieldEmpty(p)||(b.organization={},b.organization.data=p.org);var q=l.getDefaultOrgLocation();i.isFieldEmpty(q)||(b.organizationLocation={},b.organizationLocation.data=q.orgLoc),i.isNullOrEmpty(k)||(b.state=k),null!=b.selectedLanguage.code&&"en"!=b.selectedLanguage.code||(b.selectedLanguage={code:"en"}),b.cancel=function(b){a.hide(b)},b.loadLanguages=function(){f.loadListOfLanguages(function(a){b.languages=a},function(a){})},b.loadLanguages(),i.isNullOrEmpty(j)||(b.helpDocObj=angular.copy(j),b.rowObj=angular.copy(j),/* $scope.resourceFileDetail.fileToBeUpload = row.documentObj; */
b.resourceDetail.fileName=j.documentObj.fileName,b.selectedLanguage={code:j.language.code}),b.screenChanged=function(){b.resourceFileDetail={},b.resourceDetail={}},b.manageHelpDoc=function(a){c.showSpinner=!0;var f={};i.isNullOrEmpty(b.helpDocObj)||(i.isNullOrEmpty(b.helpDocObj.screenName)||(f.screenName=b.helpDocObj.screenName),i.isNullOrEmpty(b.helpDocObj.language)||(f.language=angular.fromJson(b.helpDocObj.language)),i.isNullOrEmpty(b.helpDocObj.userType)||("INDIVIDUAL_USER"==b.helpDocObj.userType?(f.isOrganizationUser=!1,f.isIndividualUser=!0):(f.isOrganizationUser=!0,f.isIndividualUser=!1)),i.isNullOrEmpty(a)||(f.documentId=a)),"add"==b.state&&d.postData(e.getUrl("SAVE_HELP_DOC"),f,function(a){c.showSpinner=!1,a.data.successMessage&&(g("success",a.data.successMessage),b.cancel("true"))},function(a){c.showSpinner=!1}),"edit"==b.state&&(f.id=j.id,d.postData(e.getUrl("UPDATE_HELP_DOC"),f,function(a){c.showSpinner=!1,a.data.successMessage&&(g("success",a.data.successMessage),b.cancel("true"))},function(a){c.showSpinner=!1}))},/* UPLOAD LOGIC START */
b.saveResourceDetails=function(a){c.showSpinner=!0,b.resourceFileDetail&&b.resourceFileDetail.fileToBeUpload?(b.documentUpload={},b.documentUpload.document={},b.documentUpload.document.fileName=b.resourceFileDetail.fileToBeUpload.name,b.documentUpload.document.fileSize=b.resourceFileDetail.fileToBeUpload.size,b.documentUpload.document.documentType={subType:m.documentSubTypes.helpData},"add"!=b.state&&(b.documentUpload.document.id=b.helpDocObj.id),o.saveDocumentDetails(b.documentUpload.document,b.state,function(a){c.showSpinner=!1,b.resourceFileDetail&&b.uploadHelpDataFile(b.helpDocObj,b.resourceFileDetail,a)},function(a){c.showSpinner=!1})):i.isNullOrEmpty(b.helpDocObj)||i.isNullOrEmpty(b.helpDocObj.documentId)||b.manageHelpDoc(b.helpDocObj.documentId),b.uploadHelpDataFile=function(a,d,e){c.showSpinner=!0;var f=new Object;f.file=d.fileToBeUpload,f.docType=m.documentTypes.help,f.docSubType=m.documentSubTypes.helpData,f.isThumbnailRequired=!1,f.screenName=a.screenName,i.isNullOrEmpty(e.response)||(f.resourceId=e.response),n.uploadHelpDataFile(f,function(a){c.showSpinner=!1,i.isNullOrEmpty(a)||b.manageHelpDoc(e.response)},function(a){i.isNullOrEmpty(a.response)||(c.showSpinner=!1,viewUserVaccinationServices.deleteUserVaccinationById(a.response,function(a){g("Error",h.instant("ERROR_WHILE_UPLOADING"))},function(a){c.showSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING"))}))})}}}o.$inject=["$mdDialog","$scope","$rootScope","httpService","urlService","registerService","notify","$translate","utilService","row","state","baseService","commonConstants","fileOperations","manageAttachmentService"],a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.chartList=[],a.filterObject={},a.status={open:!0},a.loadLanguages=function(){m.loadListOfLanguages(function(b){a.languages=b},function(a){})},a.loadLanguages();var p=function(){a.loadUsageList()};a.deleteHelpRec=function(d){var f=e.confirm().title(b.instant("DELETE_RECORD_LABEL")).textContent(b.instant("DELETE_CONFIRM_MESSAGE")).ok(b.instant("OK")).cancel(b.instant("CANCEL"));e.show(f).then(function(){c.showSpinner=!0;var b={};b.id=d.id,g.deleteData(h.getParameterizedUrl("DELETE_HELP_DATA",b),null,function(b){c.showSpinner=!1,b.data.successMessage&&/* notify('success', response.data.successMessage); */
a.deleteHelpDoc(d)},function(a){c.showSpinner=!1})},function(){})},a.deleteHelpDoc=function(d){c.showSpinner=!0;var e={};e.fileName=d.documentObj.fileName,e.screenName=d.screenName,e.resourceId=d.documentId,e.docType=i.documentTypes.help,e.docSubType=i.documentSubTypes.helpData,g.postData(h.getUrl("DELETE_HELP_DATA_DOC"),e,function(d){c.showSpinner=!1,n("success",b.instant("RECORD_DELETED_SUCCESSFULLY")),a.loadUsageList()},function(a){c.showSpinner=!1})},a.manageHelpDoc=function(b,c){e.show({templateUrl:"app/modules/document-management/views/manage-help-doc-popup.html",controller:o,parent:angular.element(document.body),clickOutsideToClose:i.dialogBox.clickOutsideToClose,locals:{row:b,state:c},clickOutsideToClose:i.dialogBox.clickOutsideToClose}).then(function(b){b&&a.loadUsageList()})},a.loadUsageList=function(){var b={};f.isNullOrEmpty(a.filterObject)||f.isNullOrEmpty(a.filterObject.userType)||("INDIVIDUAL_USER"==a.filterObject.userType?(a.filterObject.isOrganizationUser=!1,a.filterObject.isIndividualUser=!0):(a.filterObject.isOrganizationUser=!0,a.filterObject.isIndividualUser=!1)),angular.copy(a.filterObject,b),delete b.userType,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,a.spinner=!0,g.postData(h.getUrl("HELP_DOC_CRITERIA"),b,function(b){a.spinner=!1,a.listItems=b.data.data,angular.forEach(a.listItems,function(a,b){1==a.isOrganizationUser&&0==a.isIndividualUser?a.userType="ORGANIZATION_USER":0==a.isOrganizationUser&&1==a.isIndividualUser&&(a.userType="INDIVIDUAL_USER")}),a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.spinner=!1})},a.clear=function(){a.filterObject={},l.reload()},a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.loadUsageList()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.loadUsageList()};var q=i.gridConfigurations;a.options=d.setOptionProperties(q),p()}]),angular.module("paripal.documentManagementModule").controller("ManageDoucumentCtrl",["$scope","utilService","$rootScope",function(a,b,c){"use strict";if(!b.isNullOrEmpty(c.dashboardMenu)){a.parentMenus=c.dashboardMenu.children;for(var d=0;d<=a.parentMenus.length;d++)null!=a.parentMenus[d]&&"DOCUMENT_MANAGEMENT"==a.parentMenus[d].name&&(a.childMenus=a.parentMenus[d].children)}}]),angular.module("paripal.documentManagementModule").controller("ManageFormCtrl",["$scope","$rootScope","$filter","$stateParams","$state","$location","datatableconfig","$uibModal","httpService","urlService","service","dateconvertor","notify","$translate","serverSidePagination","docMgntService","$sce","$cookieStore","$cookies","orbeonFormRunner",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){
// $stateParams = stateParams;
a.documentFormTemplatesList=[],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},/**************************************************LIST****************************************************************/
a.searchDynamicFormTemplates=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.searchCriteria.organizationLocationIds=d.recordUserOrgLocIds,a.searchCriteria.referenceEntityType=d.referenceEntityType,p.searchDynamicFormTemplates(a.searchCriteria,function(b){m("success",n.instant("FORM_DETAILS_ADDED_SUCESSFULLY")),a.documentFormTemplatesList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.error=b,m("error",n.instant("DOC_TEMPLATE_LIST_FAILURE"))})},/**************************************************ADD/EDIT****************************************************************/
a.runDocumentTemplateForm=function(a,b,c,e){t.loadFormRunner(a,d.recordId,d.referenceEntityType,e)},/**************************************************GRID SPECIFIC****************************************************************/
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems),a.searchDynamicFormTemplates()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchDynamicFormTemplates()};
//datatble config json
var u={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=g.setOptionProperties(u),a.dtColumnDefs=g.setColumnProperties({}),/************************************************** INIT ****************************************************************/
a.init=function(){a.searchDynamicFormTemplates()},a.init()}]),angular.module("paripal.documentManagementModule").service("docMgntService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchDynamicFormTemplates=function(c,d,e){a.postData(b.getUrl("SEARCH_DOC_FORM_TEMPLATES"),c,function(a){a.data&&a.data.data?d(a.data):e(a)},function(a){e(a)})},this.saveDynamicFormTemplate=function(d,e,f){d.language&&(d.language=d.language.value),d.organizationLocation&&(d.organizationLocation=d.organizationLocation.data),d.validFrom&&(d.validFrom=c.convertToServerDate(d.validFrom)),d.validTill&&(d.validTill=c.convertToServerDate(d.validTill)),d.whetherDefault=!1,a.postData(b.getUrl("CREATE_DOC_FORM_TEMPLATE"),d,function(a){a.data&&a.data.response?e(a.data):f(a)},function(a){f(a)})},this.updateDynamicFormTemplate=function(d,e,f){d.language&&(d.language=d.language.value),d.organizationLocation&&(d.organizationLocation=d.organizationLocation.data),d.validFrom&&(d.validFrom=c.convertToServerDate(d.validFrom)),d.validTill&&(d.validTill=c.convertToServerDate(d.validTill));var g={};g.id=d.id,a.putData(b.getParameterizedUrl("UPDATE_DOC_FORM_TEMPLATE",g),d,function(a){a.data&&a.data.response?e(a.data):f(a)},function(a){f(a)})},this.findIfDataPopulationRecordsPending=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("FIND_IF_DATA_POPULATION_RECORDS_PENDING",f),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.getDynamicFormTemplateById=function(c,e,f){var g={},h="MM/dd/yyyy";g.id=c,a.getData(b.getParameterizedUrl("FIND_FORM_TEMPLATE_BY_ID",g),null,function(a){a&&a.data?(a.data.validFrom=d("timestampToDate")(a.data.validFrom,h),a.data.validTill=d("timestampToDate")(a.data.validTill,h),e(a.data)):f(a)},function(a){f(a)})},this.getFormInstanceDetails=function(c,d,e,f,g,h,i,j,k){var l={};l.templateId=c,l.languageId=g,l.recordId=d,l.serviceTypeId=h,l.referenceEntityType=e,l.orgLocationId=f,a.getData(b.getParameterizedUrl("GET_FORM_INSTANCE_DETAILS",l),null,function(a){a&&a.data?i(a.data):j(a)},function(a){j(a)},k)},this.getTransactionTypes=function(c,d){a.getData(b.getUrl("FIND_ALL_TRANSACTION_TYPES")+"?code=transactionType",null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.getServiceTypes=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("FIND_ALL_SERVICE_TYPES",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getSystemLanguages=function(c,d){a.getData(b.getUrl("GET_LANGUAGES"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.filterDocumentInstances=function(c,d,e){a.postData(b.getUrl("GET_DOCUMENT_INSTANCES"),c,function(a){d(a.data)},function(a){e(a)})},this.populateDocumentInstances=function(c,d,e){a.putData(b.getParameterizedUrl("POPULATE_FORM_DATA",c),null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.emergencyAutomateModule").controller("EmergencyAutomateCtrl",["$scope","$rootScope","$mdDialog","$state","utilService","commonConstants","$translate","$stateParams","EmergencyAutomateService","NgMap","GeoCoder","httpService","urlService","baseService","placeAmbulanceRequestService","loginPopupService","GoogleMap",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.currentLocation="current-location",a.filter={},a.filter.radius="10000",a.filter.slider=a.filter.radius/1e3,a.wsEmergencyAutomate={},a.wsEmergencyAutomate.whetherAmbulanceNeeded=!0,a.wsEmergencyAutomate.whetherLifeInThreat=!0,a.wsEmergencyAutomate.noOfPeopleAffected=1;var r=n.getLoggedInUser(),s={};a.userInfo={},e.isEmpty(r)?a.isLoggedIn=!1:(a.requester=r.id,a.userInfo.requesterName=r.displayName,a.userInfo.requesterContact=r.cell1,a.userInfo.requesterEmail=r.email1,localStorage.setItem("emergencyAutomateUser",angular.toJson(a.userInfo)),a.isLoggedIn=!0),a.notExistingUser=!0,j.getMap().then(function(b){a.map=b}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.back=function(){e.goBackToPrevState()};var t=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){u(b.coords.latitude,b.coords.longitude),a.getEmergencyAddress(b.coords.latitude,b.coords.longitude)})},function(b){if(console.log(b),2==b.code&&"application does not have sufficient geolocation permissions."==b.message){var d=c.confirm().title(g.instant("CHECK_GPS")).textContent(g.instant("PLEASE_TURN_LOCATION_ON")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));c.show(d).then(function(){c.hide()},function(){c.hide()})}q.getUsersCoordinates(b,function(b){u(b.coords.latitude,b.coords.longitude),a.getEmergencyAddress(b.coords.latitude,b.coords.longitude),e.isFieldEmpty(b.errorMessage)||(a.mapErrorMessage=b.errorMessage)})})},u=function(b,c){a.filter.addressLattitudes=b,a.filter.addressLongitudes=c;({latLng:new google.maps.LatLng(b,c)});a.emergencyMap=[],a.currentLocationObject={orgLocId:0,id:0,location:[a.filter.addressLattitudes,a.filter.addressLongitudes],isDraggable:!0,ambulanceIcon:"app/images/pointers/male.png",isSelected:!1,organizationLocationName:"You are here"},a.emergencyMap.push(a.currentLocationObject)};a.getEmergencyAddress=function(b,c){var d=new google.maps.LatLng(b,c),e=e=new google.maps.Geocoder;e.geocode({latLng:d},function(b,c){c==google.maps.GeocoderStatus.OK&&b[1]&&(a.wsEmergencyAutomate.emergencyAddress=b[1].formatted_address,a.userAddressInfo={},a.userAddressInfo.userAddress=a.wsEmergencyAutomate.emergencyAddress,angular.forEach(b[1].address_components,function(b,c){"country"==b.types[0]?a.userAddressInfo.countryName=b.long_name:"administrative_area_level_1"==b.types[0]?a.userAddressInfo.stateName=b.long_name:"administrative_area_level_2"==b.types[0]&&(a.userAddressInfo.cityName=b.long_name)}))})},t(),a.changeLocation=function(b,c){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filter.addressLattitudes=b.latLng.lat(),a.filter.addressLongitudes=b.latLng.lng(),a.wsPlaceRequestCriteria?(a.wsPlaceRequestCriteria.requesterLattitude=a.filter.addressLattitudes,a.wsPlaceRequestCriteria.requesterLongitude=a.filter.addressLongitudes):(a.wsPlaceRequestCriteria={},a.wsPlaceRequestCriteria.requesterLattitude=a.filter.addressLattitudes,a.wsPlaceRequestCriteria.requesterLongitude=a.filter.addressLongitudes),u(a.filter.addressLattitudes,a.filter.addressLongitudes),a.getEmergencyAddress(a.filter.addressLattitudes,a.filter.addressLongitudes),a.getALLAmbulanceList()},a.cellNumberChanged=function(b,c){!a.isLoggedIn&&c.$valid?(s={},s.cell=b,a.findUserWithMobileAndEmail(s,"CELL")):a.isLoggedIn||c.$valid||(a.notExistingUser=!0,a.userInfo.requesterEmail=null)},a.emailChanged=function(b,c){!a.isLoggedIn&&c.$valid?(s={},s.email=b,a.findUserWithMobileAndEmail(s,"EMAIL")):a.isLoggedIn||c.$valid||(a.userInfo.requesterName=null,a.notExistingUser=!0)},a.findUserWithMobileAndEmail=function(b,c){a.nameObjects=[],a.emailObjects=[],a.notExistingUser=!0,i.findUserWithMobileAndEmail(b,function(b){if(!e.isEmpty(b)&&b.length>1)a.notExistingUser=!1,angular.forEach(b,function(b,c){a.nameObjects.push({value:b.displayName,id:c}),a.emailObjects.push({value:b.email,id:c})});else if(!e.isEmpty(b)){a.userInfo.requesterName=b[0].displayName,a.userInfo.requesterContact=b[0].cell,a.userInfo.requesterEmail=b[0].email;var c={};c.loginParam=b[0].email,p.showLoginConformationPopup(c)}},function(a){})},a.$watch("filter.ambulanceType",function(b){e.isEmpty(b)||e.isEmpty(b.dataValue)||a.getALLAmbulanceList()},!0),a.$watch("wsEmergencyAutomate.requesterEmail",function(b){if(!e.isEmpty(b)&&!e.isNullOrEmpty(b.value)){a.userInfo.requesterEmail=b.value;var c={};c.loginParam=a.userInfo.requesterEmail,p.showLoginConformationPopup(c)}},!0),a.$watch("wsEmergencyAutomate.requesterName",function(b){e.isEmpty(b)||e.isNullOrEmpty(b.value)||(a.userInfo.requesterName=b.value)},!0),a.getALLAmbulanceList=function(){a.wsPlaceRequestCriteria={},a.wsPlaceRequestCriteria.requesterLattitude=a.filter.addressLattitudes,a.wsPlaceRequestCriteria.requesterLongitude=a.filter.addressLongitudes,e.isEmpty(a.userAddressInfo)||(a.wsPlaceRequestCriteria.cityName=a.userAddressInfo.cityName,a.wsPlaceRequestCriteria.stateName=a.userAddressInfo.stateName,a.wsPlaceRequestCriteria.countryName=a.userAddressInfo.countryName),a.wsPlaceRequestCriteria.ambulanceType=angular.copy(a.filter.ambulanceType.dataValue),a.wsPlaceRequestCriteria.radius=40,o.getAmbulanceList(a.wsPlaceRequestCriteria,function(b){e.isEmpty(b)||angular.forEach(b,function(a,b){a.isSelected=!0}),a.allAmbulanceList=b},function(a){})},a.placeAmbulanceRequest=function(b){a.orgLocIds=[],a.ambulanceIds=[],a.totalCount=0,angular.forEach(a.allAmbulanceList,function(b,c){b.isSelected&&a.orgLocIds.push(b.locationId)}),a.wsPlaceRequestCriteria.emergency={id:b},o.placeAmbulanceRequest(a.wsPlaceRequestCriteria,a.orgLocIds,a.userAddressInfo,a.requester,a.userInfo,a.wsEmergencyAutomate.noOfPeopleAffected,null,function(b){a.getMyCurrentRequestDetails(!0)},function(a){})},a.getEmergencyTypeList=function(b){var c="GET_EMERGENCY_TYPE";l.getData(m.getUrl(c),null,function(b){a.emergencyTypeList=angular.fromJson(b.data)},function(a){})},a.getEmergencyTypeList(),a.submitEmergencyAutomate=function(c){b.showSpinner=!0,i.submitEmergencyAutomate(a.wsPlaceRequestCriteria,a.userInfo,a.userAddressInfo,a.wsEmergencyAutomate,function(b){localStorage.setItem("emergencyAutomateUser",angular.toJson(a.userInfo)),a.wsEmergencyAutomate.whetherAmbulanceNeeded?a.placeAmbulanceRequest(b):/*$state.go('emergencyrequeststatus');*/
a.getMyCurrentRequestDetails(!0)},function(a){})},a.getMyCurrentRequestDetails=function(c){var f=angular.fromJson(localStorage.getItem("emergencyAutomateUser"));a.isLoggedIn&&e.isEmpty(f)&&(f=a.userInfo),e.isFieldEmpty(f)||i.getMyCurrentRequestDetails(f,function(a){if(b.showSpinner=!1,!e.isFieldEmpty(a.data)){var f={};f.sequenceId=a.data[0].id,localStorage.setItem("sequenceId",f.sequenceId),c&&d.go("emergencyrequeststatus",f)}},function(a){b.showSpinner=!1})},a.getMyCurrentRequestDetails()}]),angular.module("paripal.emergencyAutomateModule").controller("EmergencyAutomateStatusCtrl",["$scope","$rootScope","$mdDialog","$state","utilService","commonConstants","$translate","$stateParams","EmergencyAutomateService","httpService","urlService","baseService","EmergencyTransactionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b,c){a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.getAmbulanceList=function(){i.getAmbulanceList(c.emergencyRequestDetails,function(b){a.ambulanceList=b.data},function(a){})},a.getAmbulanceList(),a.mapAmbulanceToRequest=function(b){c.emergencyRequestDetails.ambulance={id:b.ambulanceId},c.emergencyRequestDetails.ambulanceDriverName=b.driverName,c.emergencyRequestDetails.ambulanceDriverNumber=b.mobileNumber,c.updateEmergencyRequest(),a.cancel()}}n.$inject=["$scope","$mdDialog","parentScope"];var o=l.getLoggedInUser();a.userInfo={},a.emergencyRequestDetails={},e.isEmpty(o)?a.isLoggedIn=!1:(a.requester=o.id,a.userInfo.requesterName=o.displayName,a.userInfo.requesterContact=o.cell1,a.userInfo.requesterEmail=o.email1,localStorage.setItem("emergencyAutomateUser",angular.toJson(a.userInfo)),a.isLoggedIn=!0),localStorage.removeItem("isEmergencyRequest"),localStorage.removeItem("emergencyRequestObject"),localStorage.getItem("emergencyRequestScreen")&&(localStorage.removeItem("WSEmergencyTransaction"),localStorage.removeItem("emergencyRequestScreen")),a.mapEmergencyRequestData=function(){a.sequenceIdArray=[];var b=localStorage.getItem("sequenceId");if(!b&&a.wsEmergencyRequestArray[0]){var b=a.wsEmergencyRequestArray[0].id;localStorage.setItem("sequenceId",b)}angular.forEach(a.wsEmergencyRequestArray,function(c,d){a.sequenceIdArray.push(c.id),b==c.id&&(a.emergencyRequestDetails=c,a.emergencyRequestDetails.emergency&&a.emergencyRequestDetails.emergency.emergencyType&&(a.emergencyType=a.emergencyRequestDetails.emergency.emergencyType.value),a.emergencyRequestDetails.emergency&&a.emergencyRequestDetails.emergency.ambulanceType&&(a.ambulanceType=a.emergencyRequestDetails.emergency.ambulanceType.value),e.isEmpty(a.hospitalSelected)||(a.emergencyRequestDetails.hospitalSelected=a.hospitalSelected,a.emergencyRequestDetails.hospitalAddress=a.hospitalAddress,a.updateEmergencyRequest()),e.isFieldEmpty(a.ambulanceRequestId)||(a.emergencyRequestDetails.ambulanceRequest={id:a.ambulanceRequestId},a.emergencyRequestDetails.whetherAmbulanceNeeded=!0,a.updateEmergencyRequest()),e.isFieldEmpty(a.patientDetails)||(a.emergencyRequestDetails.affectedPerson=a.patientDetails,a.updateEmergencyRequest()))});var c=a.sequenceIdArray.indexOf(parseInt(localStorage.getItem("sequenceId")));if(0==c?a.disablePreviousButton=!0:a.disablePreviousButton=!1,c==a.sequenceIdArray.length-1?a.disableNextButton=!0:a.disableNextButton=!1,b){var d=a.sequenceIdArray.indexOf(parseInt(b));a.currentPage=d+1}},a.getMyCurrentRequestDetails=function(){var b=angular.fromJson(localStorage.getItem("emergencyAutomateUser"));a.isLoggedIn&&e.isEmpty(b)&&(b=a.userInfo),e.isFieldEmpty(b)||i.getMyCurrentRequestDetails(b,function(b){if(e.isEmpty(b.data)){var d=c.alert().title(g.instant("EMERGENCY_REQUESTS_NOT_FOUND")).textContent(g.instant("NO_EMERGENCY_REQUEST_FOUND")).ok(g.instant("OK"));c.show(d).then(function(){e.goBackToPrevState()},function(){})}else a.wsEmergencyRequestArray=b.data,a.totalPages=b.data.length,a.totalPages>0&&(a.currentPage=1),a.mapEmergencyRequestData()},function(a){})},a.getMyCurrentRequestDetails(),a.updateEmergencyRequest=function(){i.updateEmergencyRequest(a.emergencyRequestDetails,function(b){a.getMyCurrentRequestDetails(),a.hospitalSelected={},a.patientDetails={},a.ambulanceRequestId=null},function(a){})},a.callScreen=function(b,c,f){var g={type:"calledFromEmergencyRequest",callBackURL:"emergencyrequeststatus"};g.data=a.emergencyRequestDetails,e.isFieldEmpty(c)||(g.callingScreen=c),d.go(b,g)},a.uploadVideoPicture=function(){if(!e.isFieldEmpty(a.emergencyRequestDetails.transactionId)){var b={transactionId:a.emergencyRequestDetails.transactionId,affectedPerson:a.emergencyRequestDetails.affectedPerson,accompanyingPerson:a.emergencyRequestDetails.accompanyingPerson};d.go("emergencyuploadlist",b)}},a.consultEmergencyDoctor=function(){e.isFieldEmpty(a.emergencyRequestDetails.transactionId)||m.consultDoctor(a.emergencyRequestDetails.transactionId,function(b){var c={};c.userId="",c.convId=b.response,c.convType=f.conversationType.emergency,c.userName=a.emergencyRequestDetails.affectedPerson.firstName+" "+a.emergencyRequestDetails.affectedPerson.lastName,d.go("skypeHome",c)})},a.selectHospital=function(){if(e.isFieldEmpty(a.emergencyRequestDetails.transactionId)){var b={emergencyId:a.emergencyRequestDetails.emergency.id,whetherAccepted:!0,callBackURL:"emergencyrequeststatus",callingScreen:"emergencyrequeststatus"};d.go("acceptedhospitals",b)}},a.intimateStakholder=function(){var b={};b.transactionId=a.emergencyRequestDetails.transactionId,b.mode="automate",d.go("intimatestakeholders",b)},a.registerWithHospital=function(){if(e.isFieldEmpty(a.emergencyRequestDetails.transactionId)){var b={callbackUrl:"emergencyrequeststatus",callingUrl:"emergencyrequeststatus",data:a.emergencyRequestDetails};localStorage.setItem("isEmergencyRequest",!0),localStorage.setItem("emergencyRequestObject",angular.toJson(a.emergencyRequestDetails)),d.go("emergencytransaction",b)}},a.paymentCall=function(){if(!e.isFieldEmpty(a.emergencyRequestDetails.transactionId)&&!a.emergencyRequestDetails.whetherPaid){var b={transactionId:a.emergencyRequestDetails.transactionId},c=angular.fromJson(localStorage.getItem("sequenceId"));m.getWhetherBillDetails(b,function(b){localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"EMERGENCY_ADMISSION",EMERGENCY_ADMISSION:"EMERGENCY_ADMISSION",sequenceId:c})),d.go("billsummaryview",{transactionId:a.emergencyRequestDetails.transactionId,data:{data:null,sequenceId:c,callingUrl:"fromBillSummaryView",callbackUrl:"fromBillSummaryView"},type:d.current.name})},function(a){},{handleError:!1})}},a.mapAmbulance=function(b){c.show({controller:n,templateUrl:"app/modules/emergency-automate/views/map-ambulance-popup.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,locals:{parentScope:a}}).then(function(){},function(){})},a.nextRequest=function(){var b=a.sequenceIdArray.indexOf(parseInt(localStorage.getItem("sequenceId")));b+1<a.sequenceIdArray.length&&(b+=1,a.currentPage=b+1);var c={};c.sequenceId=a.sequenceIdArray[b],localStorage.setItem("sequenceId",c.sequenceId),a.mapEmergencyRequestData()},a.previousRequest=function(){var b=a.sequenceIdArray.indexOf(parseInt(localStorage.getItem("sequenceId")));b-1!=-1&&(b-=1,a.currentPage=b+1);var c={};c.sequenceId=a.sequenceIdArray[b],localStorage.setItem("sequenceId",c.sequenceId),a.mapEmergencyRequestData()};var p=function(){if("userIdentifyList"==h.callbackUrl){var b=angular.fromJson(localStorage.getItem("WSUserIdentification"));e.isFieldEmpty(b)||b.emergencyPatient&&(a.patientDetails=b.emergencyPatient)}"callambulance"==h.callbackUrl&&(e.isFieldEmpty(h.data)||(a.ambulanceRequestId=h.data)),"acceptedhospitals"==h.callbackUrl&&(e.isFieldEmpty(h.data)||(console.log(h.data),a.hospitalSelected={},a.hospitalSelected.id=h.data.organizationLocationId,a.hospitalSelected.value=h.data.orgDisplayName,a.hospitalAddress=h.data.addressLine1))};p()}]),angular.module("paripal.emergencyAutomateModule").service("EmergencyAutomateService",["$mdDialog","urlService","httpService","utilService","notify","$translate","$state",function(a,b,c,d,e,f,g){this.findUserWithMobileAndEmail=function(a,d,e){var f=angular.copy(a);c.postData(b.getUrl("CHECK_USER_BY_EMAIL_AND_CELL"),f,function(a){d(a.data)},function(){e()})},this.submitEmergencyAutomate=function(a,e,f,g,h,i){var j={};d.isEmpty(f)||(j.address=f.userAddress,j.city=f.cityName,j.state=f.stateName,j.country=f.countryName),d.isEmpty(g)||(j.noOfPeopleAffected=g.noOfPeopleAffected,j.whetherAmbulanceNeeded=g.whetherAmbulanceNeeded,j.whetherToCallPolice=g.whetherToCallPolice,j.selfAffected=g.selfAffected,j.whetherLifeInThreat=g.whetherLifeInThreat,d.isEmpty(g.emergencyType)||(j.emergencyType=g.emergencyType)),d.isEmpty(e)||(j.requesterName=e.requesterName,j.email=e.requesterEmail,j.contact=e.requesterContact),d.isEmpty(a)||(j.lattitude=a.requesterLattitude,j.longitude=a.requesterLongitude,j.radius=40,d.isFieldEmpty(a.ambulanceType)||(j.ambulanceType=a.ambulanceType)),c.postData(b.getUrl("CONFIRM_EMERGENCY"),j,function(a){h(a.data)},function(){i()})},this.getMyCurrentRequestDetails=function(a,e,f){var g={};d.isNullOrEmpty(a.requesterName)||(g.requesterName=a.requesterName,g.email=a.requesterEmail,g.contact=a.requesterContact);var h=b.getUrl("GET_MY_EMERGENCY_REQUEST_DETAILS");c.postData(h,g,function(a){e(a)},function(a){f()})},this.updateEmergencyRequest=function(a,d,e){c.postData(b.getUrl("UPDATE_PATIENT_RECORD"),a,function(a){d(a)},function(a){e()})},this.getAmbulanceList=function(a,d,e){var f={};f.ambulanceRequestId=a.ambulanceRequest.id,c.getData(b.getParameterizedUrl("GET_EMERGENCY_AMBULANCE_LIST",f),null,function(a){d(a)},function(a){e()})}}]),angular.module("paripal.emergencyTransactionModule").controller("AcceptedHospitalsCtrl",["$scope","$rootScope","$state","utilService","$translate","$mdDialog","commonConstants","dateconvertor","NgMap","GeoCoder","urlService","httpService","$stateParams","SearchHospitalService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.commonConstants=g,a.currentLocation="current-location";var o={},p=[],q={};a.filter={},a.filter.whetherAccepted="true",a.filter.radius="5000",a.filter.slider=a.filter.radius/1e3,a.currentLocationObject={},a.hospitalList=new Array,a.whetherPrioriyCalls=!1,a.treatment={queryUrl:"GET_EMERGENCY_TYPES",queryParameter:{},jsonParameter:{}},i.getMap().then(function(b){a.map=b}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.city={queryUrl:"FIND_CITY_BY_NAME",queryParameter:{},jsonParameter:{}};var r=function(){s(),a.emergencyId=m.emergencyId,a.data={modes:[{value:"DRIVING",text:e.instant("DRIVING")},{value:"WALKING",text:e.instant("WALKING")},{value:"BICYCLING",text:e.instant("BICYCLING")},{value:"TRANSIT",text:e.instant("TRANSIT")}],travelMode:{value:"DRIVING",text:e.instant("DRIVING")}}},s=function(b){l.getJsonData(k.getJsonFileUrl("ORGANIZATION_TYPE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),t())},function(a){})},t=function(){a.whetherPrioriyCalls=!1,navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.whetherPrioriyCalls=!0,u(b.coords.latitude,b.coords.longitude,!0),a.mapErrorMessage=null})},function(b){if(2==b.code&&"application does not have sufficient geolocation permissions."==b.message){var c=f.confirm().title(e.instant("CHECK_GPS")).textContent(e.instant("PLEASE_TURN_LOCATION_ON")).ok(e.instant("OK")).cancel(e.instant("CANCEL"));f.show(c).then(function(){f.hide()},function(){f.hide()})}GoogleMap.getUsersCoordinates(b,function(b){u(b.coords.latitude,b.coords.longitude,!0),d.isFieldEmpty(b.errorMessage)||(a.mapErrorMessage=b.errorMessage)}),console.log(b)})},u=function(b,c,d){a.filter.addressLattitudes=b,a.filter.addressLongitudes=c;var e={latLng:new google.maps.LatLng(b,c)};a.changeLocation(e,d)};/*$scope.findHospitalByLocation = function (priority) {
    angular.copy(emptyList, $scope.hospitalList);
    $scope.hospitalList = [];
    $scope.hospitalList.push($scope.currentLocationObject);
    $scope.findNearByHospitals(priority);

};*/
a.showDetails=function(b,c){c.organizationLocationId!==a.selectedId?(a.address=c,a.map.showInfoWindow("foo-iw","id_"+c.organizationLocationAddressId),a.map.hideInfoWindow("bar")):(a.selectHospital(b,c),a.hideDetail())},a.hideDetail=function(){a.map.hideInfoWindow("foo-iw")},a.selectHospital=function(b,c){a.map.setZoom(12),a.destination=c.location[0]+","+c.location[1],0!==c.organizationLocationAddressId&&(a.selectedId=c.organizationLocationId,o.organizationLocationId=c.organizationLocationId,a.selectedHospital=c,a.map.showInfoWindow("bar","id_"+c.organizationLocationAddressId)),a.hideDetail()};var v=function(a){var b=null;if(!d.isFieldEmpty(m.callBackURL)){b=c.current.name;var e=angular.fromJson(localStorage.getItem("sequenceId"));c.go(m.callBackURL,{callbackUrl:c.current.name,callingUrl:b,data:a,sequenceId:e})}};a.confirmSelection=function(a,b,c){/*SearchHospitalService.storeInLocalStorage(selectedHospital, userLocation);*/
v(b)},a.confirmEmergencyLocation=function(b){n.changeEmergencyLocation(b),a.map.hideInfoWindow("foo-iw")},a.unconfirm=function(){a.selectedId=null,o.organizationLocationId=null,a.selectedAddress=null,a.map.hideInfoWindow("bar"),a.destination=null},a.changeRadius=function(){a.filter.radius=1e3*a.filter.slider,d.isFieldEmpty(a.filter.whetherAccepted)||(q.whetherAccepted=a.filter.whetherAccepted),d.isFieldEmpty(a.emergencyId)||(q.emergencyId=a.emergencyId),a.findNearByHospitals(q)},a.changeLocation=function(b,c){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filter.addressLattitudes=b.latLng.lat(),a.filter.addressLongitudes=b.latLng.lng(),a.locationChanged=!0,n.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,addressLattitudes:b.latLng.lat(),addressLongitudes:b.latLng.lng()}}),a.currentLocationObject={organizationLocationAddressId:0,organizationLocationId:0,location:[a.filter.addressLattitudes,a.filter.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,organizationLocationName:"You are here"},a.applyFilter()},a.applyFilter=function(){d.isFieldEmpty(a.filter.whetherAccepted)||(q.whetherAccepted=a.filter.whetherAccepted),d.isFieldEmpty(a.emergencyId)||(q.emergencyId=a.emergencyId),a.findNearByHospitals(q)},a.findNearByHospitals=function(b){a.searchHospSpinner=!0,angular.copy(p,a.hospitalList),a.hospitalList=[],a.hospitalList.push(a.currentLocationObject),n.findAcceptedHospitals(b,function(b){a.searchHospSpinner=!1;for(var c=b.data,e=0;e<c.length;e++)d.isFieldEmpty(c[e].addressLattitudes)||d.isFieldEmpty(c[e].addressLongitudes)||(c[e].location=[c[e].addressLattitudes,c[e].addressLongitudes],c[e].isDraggable=!1,c[e].organizationTypeIcon=a.iconsList.ICONS[c[e].organizationTypeIconsEnum],c[e].isSelected=!1,a.hospitalList.push(c[e]))},function(){a.searchHospSpinner=!1})},a.clear=function(){c.reload()},r()}]),angular.module("paripal.emergencyTransactionModule").controller("DischargePatientPopupCtrl",["$scope","$mdDialog","EmergencyCallManagementService","rowData","$rootScope","notify","httpService","urlService","commonConstants",function(a,b,c,d,e,f,g,h,i){a.commonConstants=i,a.cancel=function(){b.cancel()},a.init=function(){d&&d.locationId&&(e.showSpinner=!0,a.getDoctors(d.locationId))},a.dischargePatient=function(g){e.showSpinner=!0,d&&a.dischargeRequest&&(a.dischargeRequest.id=d.emergencyAdmissionId,a.dischargeRequest.emergencyStatusEnum="E_STATUS_DISCHARGED",c.dischargePatient(a.dischargeRequest,function(a){e.showSpinner=!1,f("success",a.successMessage),b.cancel("SUCCESS")},function(a){e.showSpinner=!1}))},a.getDoctors=function(b){var b={locationId:b};g.getData(h.getParameterizedUrl("GET_PROFESSIONALS_BY_LOCATION",b),null,function(b){a.doctorList=b.data,e.showSpinner=!1},function(a){e.showSpinner=!1})},a.getDisease=function(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,g.getData(h.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseList=angular.fromJson(b.data)},function(a){})},a.getDiseaseVariant=function(b){var c={};return c.diseaseId=b.id,g.getData(h.getParameterizedUrl("GET_VARIANT_BY_DISEASE_ID",c),null,function(b){return a.diseaseVariantList=b.data},function(a){})},a.init()}]),angular.module("paripal.emergencyTransactionModule").controller("EmergencyCallManagementListCtrl",["$scope","$rootScope","$mdDialog","$state","userStatusService","datatableconfig","serverSidePagination","utilService","commonConstants","$translate","$stateParams","EmergencyCallManagementService","dateconvertor","httpService","urlService","notify","orbeonFormRunner","MakePrescriptionFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(a,b,c){a.cancel=function(){c.cancel()},a.additionalDetails={},b.convStart&&(a.additionalDetails.requestRaisedAt=b.convStart),b.assignedDoctor&&(a.additionalDetails.assignedDoctor=b.assignedDoctor.value),b.callRequestMadeBy&&(a.additionalDetails.callingPerson=b.callRequestMadeBy),b.callRequestMadeByRole&&(a.additionalDetails.callingPersonRole=b.callRequestMadeByRole)}function t(a,c,d){if(a.assignToDocObj=new Object,d.recordData.affectedPerson?a.assignToDocObj.patient=d.recordData.affectedPerson:a.assignToDocObj.patient=d.recordData.accompanyingPerson,/*****  Url and params for 'ASSIGNING TO DOCTOR'  *****/
a.assignToDoctor={queryUrl:"FIND_EMERGENCY_REGISTERED_DOCTORS",queryParameter:{locationId:d.recordData.locationId},jsonParameter:{}},/**
         * Assign to a doctor
         * @param {object} doctor  Doctor's data
         */
a.assigningToDoctor=function(b){l.assignToDoctor(a.assignToDocObj.doctor,d.recordData.id,function(a){c.hide()})},"seeConvHistory"===d.type){a.popupCurrentPage=i.defaultPageNo,a.popupItemPerPage=i.itemPerPage,a.popupPagingInfo={};var e=function(){var c={transactionId:d.recordData.id,pageNumber:a.popupCurrentPage,recordsPerPage:a.popupItemPerPage};b.showSpinner=!0,l.getConversationHistory(c,function(c){b.showSpinner=!1,/*successResponse.data = [{
                        "requestMadeAt": "2017-04-26",
                        "status": "COMPLETED",
                        "doctor": "Mallinath",
                        "convStart": "11:01:15",
                        "convEnd": "12:00:20"
}, {
                        "requestMadeAt": "2017-04-25",
                        "status": "CANCELLED",
                        "doctor": null,
                        "convStart": null,
                        "convEnd": null
}];
                    successResponse.totalRecords = 150;*/
a.conversationHistory=c.data,a.popupTotalItems=c.totalRecords,a.popupPagingInfo=g(a.popupCurrentPage,a.popupItemPerPage,a.popupTotalItems)})};a.popupPageChanged=function(){a.pagingInfo=g(a.popupCurrentPage,a.popupItemPerPage,a.popupTotalItems),e()},a.popupSetMaxRecords=function(b){a.popupCurrentPage=1,a.popupItemPerPage=b,e()},e()}a.hide=function(){c.hide()},a.cancel=function(){c.cancel()}}t.$inject=["$scope","$mdDialog","data"],s.$inject=["$scope","detailsObj","$mdDialog"],a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=i,a.filterObject={},a.filterObject.dateFrom=m.convertToViewDate(new Date),a.filterObject.dateTill=m.convertToViewDate(new Date),a.filterObject.callRequestMade=!1,/***********************************************************************************/
/*$scope.emergencyCallList = [{
        "transactionCode": "EMER00011",
        "reportingPerson": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "affectedPerson": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "accompanyingPerson": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "assignedDoctor": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "numberInQueue": 1,
        "status": "NOT_YET_STARTED",
        "convStart": "11:22",
        "locationId": 1,
        "id": 2

}, {
        "transactionCode": "EMER00011",
        "reportingPerson": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "affectedPerson": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "accompanyingPerson": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "assignedDoctor": {
            "id": 1,
            "code": "asdna",
            "value": "asdsad"
        },
        "numberInQueue": 1,
        "status": "NOT_YET_STARTED",
        "convStart": "11:22",
        "locationId": 1,
        "id": 2

}];*/
/*****  Url and params for 'FINDING DOCTORS'  *****/
a.assignedToDoctor={queryUrl:"GET_LIST_OF_EMERGENCY_DOCTORS",queryParameter:{},jsonParameter:{}},a.callPopup=function(b,d,e){var f;"assignToDoctor"===e?f="app/modules/emergency-transaction-management/views/assign-to-doctor.html":"seeConvHistory"===e&&(f="app/modules/emergency-transaction-management/views/conversation-history.html"),c.show({clickOutsideToClose:i.dialogBox.clickOutsideToClose,scope:a,preserveScope:!0,parent:angular.element(document.body),targetEvent:d,templateUrl:f,controller:t,locals:{data:{recordData:b,type:e}}}).then(function(){"assignToDoctor"==e&&a.searchData()})},a.updatePatientDetails=function(a){c.show({controller:"UpdatePatientDetailsCtrl",templateUrl:"app/modules/emergency-transaction-management/views/update-patient-details.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{detailsObj:a}}).then(function(){},function(a){a&&d.reload()})},a.showEmergencyNotes=function(a){d.go("emergencyNotes",{type:"add",transactionId:a.id})},a.showAdditionalDetails=function(a){c.show({controller:s,templateUrl:"app/modules/emergency-transaction-management/views/show-additional-details.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{detailsObj:a}}).then(function(){},function(a){})},a.updateCallRequest=function(e,f){a.emergencyRequestObj={},"DISCHARGE"==f?(a.emergencyRequestObj.id=e.emergencyAdmissionId,a.emergencyRequestObj.emergencyStatusEnum="E_STATUS_DISCHARGED",c.show({controller:"DischargePatientPopupCtrl",templateUrl:"app/modules/emergency-transaction-management/views/discharge-patient-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{rowData:e}}).then(function(){},function(a){"SUCCESS"==a&&d.reload()})):"REJECT"==f?(a.emergencyRequestObj.id=e.emergencyAdmissionId,a.emergencyRequestObj.emergencyStatusEnum="E_STATUS_REJECTED",c.show({controller:"RejectEmergencyRequestPopupCtrl",templateUrl:"app/modules/emergency-transaction-management/views/reject-emergency-request.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{parentScope:a}}).then(function(){},function(b){"SUCCESS"==b&&d.reload(),a.unAcceptedCancel=!1})):"REACHED"==f&&(b.showSpinner=!0,a.emergencyRequestObj.id=e.emergencyAdmissionId,a.emergencyRequestObj.emergencyStatusEnum="E_STATUS_REACHED",l.updateEmergencyCallStatus(a.emergencyRequestObj,function(a){b.showSpinner=!1,p("success",a.successMessage),d.reload()},function(a){b.showSpinner=!1}))},a.getCallStatus=function(){b.showSpinner=!0,n.getData(o.getUrl("GET_CALL_STATUSES"),null,function(b){a.callStatusList=b.data},function(a){b.showSpinner=!1})},a.assignToMyself=function(a){localStorage.setItem("emergencyData",angular.toJson(a));var b={id:e.userData().userId};l.assignToDoctor(b,a.id,function(a){var b={};b.userId=e.userData().userId,b.convId=a.response.convId.id,b.convType=i.conversationType.emergency,b.userName=e.userStatus().userData.value;
//$state.go('agoraHome', params);
var c=d.href("agoraHome",b),f=window.open(c,"_blank");null==f||"undefined"==typeof f?alert('Please disable your pop-up blocker and click the "Open" link again.'):f.focus()})},a.searchData=function(){a.filterObject.pageNumber=a.currentPage,a.filterObject.recordsPerPage=a.itemPerPage,b.showSpinner=!0,l.searchData(a.filterObject,function(c){b.showSpinner=!1,a.emergencyCallList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)})},a.emergencyUploadDownload=function(a){var b={};b.transactionId=a.id,b.affectedPerson=a.affectedPerson,b.accompanyingPerson=a.accompanyingPerson,d.go("emergencyuploadlist",b)},a.userTest=function(a){var b={};b.userName=a.affectedPerson.value,b.userId=a.affectedPerson.id,d.go("usertestlist",b)},a.makePrescription1=r.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="usermedication",a.makePrescription1(c,d,e,f,g,null,null,null,b.id)},a.intimateStakeholder=function(a){var b={};b.transactionId=a.id,b.mode="doctor",d.go("intimatestakeholders",b)},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.clear=function(){d.reload()},a.callRequestMadeChanged=function(){a.filterObject.callRequestStatusEnum=null},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};/**
     *datatble config json
     */
var u=i.gridConfigurations;a.options=f.setOptionProperties(u);var v=function(){a.searchData(),a.getCallStatus(),a.assignedToDoctor={queryUrl:"FIND_EMERGENCY_REGISTERED_DOCTORS",queryParameter:{locationId:0},jsonParameter:{}}};a.viewOrbeonForm=function(a,b){var c="EMERGENCY_FORM",d={};d.stateName="emergencycallmanagementlist",
//         prevStateParam.data = {
//         };
q.loadNewFormRunner(b.emergencyAdmissionId,c,b.locationId,1,d,null,0,null)},v()}]),angular.module("paripal.emergencyTransactionModule").controller("EmergencyManagementCtrl",["$scope","userStatusService","$mdDialog","$state","baseService","utilService","commonConstants","$translate","SearchHospitalService","$timeout","$stateParams","EmergencyTransactionService","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.isUserLoggedIn=b.isUserLoggedIn(),a.isOrgUser=b.isOrgUser(),a.stateReference={},a.menuList=[];var o=null;a.transactionId=null,a.isUserLoggedIn&&a.isOrgUser&&m.getData(n.getUrl("FIND_SUBSCRIPTION_DETAILS_BY_USER"),null,function(b){a.WSSubscriptionList=angular.fromJson(b.data)},function(a){}),l.getEmergencyMenu(function(b){a.menuList=b,o=angular.fromJson(localStorage.getItem("WSEmergencyTransaction")),f.isFieldEmpty(o)||f.isFieldEmpty(o.transactionId)||(a.transactionId=o.transactionId)}),a.callPage=function(b,e){if(b.preventDefault(),!e.whetherTransIdReq||!f.isFieldEmpty(a.transactionId))if(a.isUserLoggedIn&&a.isOrgUser){if("AMBULANCE_LIST"===e.name)a.WSSubscriptionList.whetherAmbulanceProviderSubscribed?a.goToPage(e):a.getSubscription(e);else if("EMERGENCY_REQUESTS"===e.name)a.goToPage(e);else if("AMBULANCE_REQUEST"===e.name)a.WSSubscriptionList.whetherAmbulanceProviderSubscribed?a.goToPage(e):a.getSubscription(e);else if("EMERGENCY_CALL_MANAGEMENT_LIST"===e.name)a.WSSubscriptionList.whetherEmergencyManagementSubscribed?a.goToPage(e):a.getSubscription(e);else if("INTIMATION_LIST"===e.name)a.WSSubscriptionList.whetherEmergencyManagementSubscribed?a.goToPage(e):a.getSubscription(e);else if("CONSULT_EMERGENCY_DOCTOR"===e.name)if(a.WSSubscriptionList.whetherAmbulanceProviderSubscribed)f.isFieldEmpty(a.transactionId)||l.consultDoctor(a.transactionId,function(a){var b={};b.userId=f.isFieldEmpty(o.WSEmergencyTransaction.affectedPerson.userId)?o.WSEmergencyTransaction.accompanyingPerson.userId:o.WSEmergencyTransaction.affectedPerson.userId,b.convId=a.response,b.convType=g.conversationType.emergency,b.userName=f.isFieldEmpty(o.WSEmergencyTransaction.affectedPerson.firstName)?o.WSEmergencyTransaction.accompanyingPerson.firstName+" "+o.WSEmergencyTransaction.accompanyingPerson.lastName:o.WSEmergencyTransaction.affectedPerson.firstName+" "+o.WSEmergencyTransaction.affectedPerson.lastName,
//$state.go('skypeHome', params);
d.go("agoraHome",b)});else if(!a.WSSubscriptionList.whetherAmbulanceProviderSubscribed){var i=c.alert().title(h.instant("INFO")).textContent(h.instant("SUBSCRIBE_FOR_THIS_SERVICE1")+" "+h.instant("AMBULANCE_PROVIDER")+" "+h.instant("SUBSCRIBE_FOR_THIS_SERVICE2")).ok(h.instant("OK"));c.show(i).then(function(){},function(){})}}else if("CONSULT_EMERGENCY_DOCTOR"===e.name){if(!f.isFieldEmpty(a.transactionId)){var j=o.WSEmergencyTransaction;j.id=a.transactionId,localStorage.setItem("emergencyData",angular.toJson(j)),l.consultDoctor(a.transactionId,function(a){var b={};b.userId=f.isFieldEmpty(o.WSEmergencyTransaction.affectedPerson.userId)?o.WSEmergencyTransaction.accompanyingPerson.userId:o.WSEmergencyTransaction.affectedPerson.userId,b.convId=a.response,b.convType=g.conversationType.emergency,b.userName=f.isFieldEmpty(o.WSEmergencyTransaction.affectedPerson.firstName)?o.WSEmergencyTransaction.accompanyingPerson.firstName+" "+o.WSEmergencyTransaction.accompanyingPerson.lastName:o.WSEmergencyTransaction.affectedPerson.firstName+" "+o.WSEmergencyTransaction.affectedPerson.lastName,
//$state.go('skypeHome', params);
d.go("agoraHome",b)})}}else a.goToPage(e)},a.goToPage=function(a){f.isFieldEmpty(a.params)?d.go(a.href):d.go(a.href,a.params)},a.getSubscription=function(a){var b=c.alert().title(h.instant("INFO")).textContent(h.instant("SUBSCRIBE_FOR_THIS_SERVICE1")+" "+h.instant(a.subscriptionRequired)+" "+h.instant("SUBSCRIBE_FOR_THIS_SERVICE2")).ok(h.instant("OK"));c.show(b).then(function(){},function(){})}}]),angular.module("paripal.emergencyTransactionModule").controller("EmergencyNotesCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","serverSidePagination","userStatusService","httpService","urlService","utilService","commonConstants","EmergencyTransactionService","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.WSApptUserDetails={},a.commonConstants=l;var o=function(){/*checkPageState();*/
var b=n.getLoggedInUser();if(b){a.stateType=c.type,"view"==a.stateType&&(a.isViewMode=!0),a.stateParamValue=c.transactionId;var d={transactionId:c.transactionId};m.getPaymentStatusForTransaction(d,function(b){a.emergencyDetails=b,console.log(b)},function(a){})}};a.getCliniclList=function(){if(c.appointmentId||(a.clinicalNotes=[]),c.treatmentRecId){var d={};d.recordId=c.treatmentRecId}else{var d={};d.transactionId=c.transactionId}var e=j.getParameterizedUrl("GET_CLINICAL_NOTES_FOR_EMERGENCY",d);if(e)return i.getData(e,null,function(c){if(c&&c.data)return a.clinicalNotes=c.data,b.showSpinner=!1,a.clinicalNotes},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||(f("error",$translate.instant(a.data.messages[0])),b.showSpinner=!1)})},a.selectedUser=function(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")},o()}]),angular.module("paripal.emergencyTransactionModule").controller("EmergencyRequestsCtrl",["$scope","$rootScope","datatableconfig","serverSidePagination","notify","$translate","$state","httpService","urlService","commonConstants","$stateParams","$filter","$mdDialog","jobListService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.commonConstants=j,a.filterObject={},a.filterObject.fromDate=new Date,a.filterObject.toDate=new Date,a.requestListSpinner=!1,a.disableAccept=!1,a.requestList=[],a.status={open:!0},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.getFilteredValues=function(){a.getListOfJobs()};var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=c.setOptionProperties(p),a.dtColumnDefs=c.setColumnProperties({}),a.clear=function(){a.filterObject=new Object,a.requestList=new Array,a.totalItems=0,a.pagingInfo={}},a.acceptEmergency=function(b){b.noOfAccepted&&(a.noOfAccepted=angular.fromJson(b.noOfAccepted)),o.isFieldEmpty(b.emergencyId)||(a.emergencyRequestId=b.emergencyId),o.isFieldEmpty(b.orgLocId)||(a.orgLocId=b.orgLocId),o.isFieldEmpty(b.vecantEmergencyADay)||(a.vecantEmergencyADay=b.vecantEmergencyADay),o.isFieldEmpty(b.noOfPeopleNotAllocated)||(a.noOfPeopleNotAllocated=b.noOfPeopleNotAllocated),o.isFieldEmpty(b.noOfPeopleNotAllocated)||(a.noOfPeopleAffected=b.noOfPeopleAffected),o.isFieldEmpty(b.whetherLifeInThreat)||(a.whetherLifeInThreat=b.whetherLifeInThreat),m.show({clickOutsideToClose:j.dialogBox.clickOutsideToClose,scope:a,preserveScope:!0,parent:angular.element(document.body),templateUrl:"app/modules/emergency-transaction-management/views/accept-patients.html"})},a.validateNoOfAccepted=function(b){a.noOfAccepted<=0?(e("error",f.instant("INVALID_NUMBER")),delete a.noOfAccepted):a.noOfAccepted>a.noOfPeopleAffected?(e("error",f.instant("ACCEPTED_PATIENTS_GREATER_THAN_AFFECTED")),delete a.noOfAccepted):a.noOfAccepted>a.vecantEmergencyADay&&1==a.whetherLifeInThreat&&(e("error",f.instant("ACCEPTED_PATIENTS_GREATER_THAN_LIMIT")),delete a.noOfAccepted)},a.acceptPatients=function(){b.showSpinner=!0;var c={};o.isNullOrEmpty(a.noOfAccepted)||(c.noOfPatients=a.noOfAccepted),o.isNullOrEmpty(a.emergencyRequestId)||(c.emergencyId=a.emergencyRequestId),o.isNullOrEmpty(a.orgLocId)||(c.orgLocId=a.orgLocId),h.putData(i.getParameterizedUrl("EMERGENCY_ACCEPT_REQUEST",c),null,function(c){b.showSpinner=!1,m.hide(),delete a.noOfAccepted,e("info",f.instant(c.data)),a.getEmergencyRequestsByCriteria()},function(a){})},
// get emergency types
a.getListOfEmergencyTypes=function(){return h.getData(i.getUrl("EMERGENCY_TYPE"),null,function(b){a.emergencyTypes=angular.fromJson(b.data)},function(a){})},a.getEmergencyRequestsByCriteria=function(){b.showSpinner=!0;var c={};return o.isNullOrEmpty(a.filterObject)||angular.copy(a.filterObject,c),o.isNullOrEmpty(a.orgLocIdFromFilter)||(c.orgLocId=a.orgLocIdFromFilter),o.isNullOrEmpty(a.emergencyTypeId)||(c.emergencyTypeId=a.emergencyTypeId),c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,h.postData(i.getUrl("EMERGENCY_REQUEST_BY_CRITERIA"),c,function(c){b.showSpinner=!1,a.emergencyRequestList=angular.fromJson(c.data.data),a.totalItems=c.data.totalRecords,a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})},a.getOrgID=function(b){o.isFieldEmpty(b)||(a.orgLocIdFromFilter=b)},a.emergencySelected=function(b){o.isNullOrEmpty(b)||(a.emergencyTypeId=b.id)};var q=function(){a.getListOfEmergencyTypes(),a.getEmergencyRequestsByCriteria()};q(),a.cancel=function(){delete a.noOfAccepted,m.hide()},a.pageChanged=function(){a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems),a.getEmergencyRequestsByCriteria()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems),a.getEmergencyRequestsByCriteria()}}]),angular.module("paripal.emergencyTransactionModule").controller("EmergencyTransactionCtrl",["$scope","$rootScope","EmergencyTransactionService","userStatusService","$mdDialog","$state","utilService","commonConstants","$translate","SearchHospitalService","$timeout","$stateParams","notify","orbeonFormRunner","$mdMedia","featurePrivilegeConstants","docMgntService","messaging","IntimateStakeholderService","orgLocListService","loginPopupService","baseService","httpService","urlService","callAmbulanceService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(){var b=angular.fromJson(localStorage.getItem("WSEmergencyTransaction"));a.isEmergencyRequest=localStorage.getItem("isEmergencyRequest"),a.isEmergencyRequest&&"emergencyrequeststatus"==l.callingUrl?(localStorage.setItem("emergencyRequestScreen",!0),a.WSEmergencyTransaction=l.data):localStorage.removeItem("isEmergencyRequest"),a.isUserLoggedIn=d.isUserLoggedIn(),/*Load current location of user as emergency loactaion */
j.getEventObject(function(c){a.WSEmergencyTransaction.emergencyLocation=c,a.tempVariable=c,a.$apply(),B(b)},function(a){B(b)},a),a.getMyCurrentRequestDetails()}function A(a,b,c,d){a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.language={},a.orgLocPermission=b.ORGANIZATION_USER_HEALTH_PROFESSIONAL_VIEW,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.loadForm=function(b){var d="EMERGENCY_FORM",f={};f.data={id:"1",params:{callingUrl:"fromOrbeonForm"}},n.loadNewFormRunner(c.recordId,d,c.orgLoc.id,a.language.id,f,c.formTemplate),e.hide()},a.hide=function(){e.hide()},a.cancel=function(){e.cancel()}}A.$inject=["$scope","featurePrivilegeConstants","dialogParams","parentScope"],a.WSEmergencyTransaction={},a.intimationDetails={},a.flags={},a.WSEmergencyTransaction.whetherAdmissionRequired=!1,a.WSEmergencyTransaction.whetherOPD=!1,a.WSEmergencyTransaction.whetherAmbulanceNeeded=!1,a.WSEmergencyTransaction.forgotUHID=!1,a.WSEmergencyTransaction.newUHID=!1,a.commonConstants=h,a.WSEmergencyTransaction.reportedFor="FOR_OTHERS",a.treatment={queryUrl:"TREATMENT_TYPE_PUBLIC_COMBO",queryParameter:{},jsonParameter:{}},a.disableTreatmentType=!1,a.paymentCall=function(){var b={transactionId:a.transactionId};c.getWhetherBillDetails(b,function(a){localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"EMERGENCY_ADMISSION",EMERGENCY_ADMISSION:"EMERGENCY_ADMISSION"})),f.go("billsummaryview",{transactionId:angular.fromJson(localStorage.getItem("WSEmergencyTransaction")).transactionId,data:{data:null,type:"step4",callingUrl:"fromBillSummaryView",callbackUrl:"fromBillSummaryView"},type:f.current.name})},function(a){var b=e.confirm().title(i.instant("FEE_TYPE_ERROR")).textContent(i.instant(a.data.messages[0])).ok(i.instant("OK")).cancel(i.instant("CANCEL"));e.show(b).then(function(){},function(){f.go("emergencymanagement")})},{handleError:!1})},a.getMyCurrentRequestDetails=function(){var b=v.getLoggedInUser();g.isEmpty(b)||(a.userInfo={},a.userInfo.requesterName=b.displayName,a.userInfo.requesterContact=b.cell1,a.userInfo.requesterEmail=b.email1);var c=angular.fromJson(localStorage.getItem("requesterInfo"));g.isEmpty(c)&&(c=a.userInfo),g.isEmpty(b)||y.getMyCurrentRequestDetails(c,function(b){b.data&&(a.currentRequestData=b.data[0],g.isEmpty(a.currentRequestData)||g.isNullOrEmpty(a.currentRequestData.allocationStatus)||"ALLOCATED"!=a.currentRequestData.allocationStatus&&"PATIENT_PICKED_UP"!=a.currentRequestData.allocationStatus||(a.ambulanceDriverName=a.currentRequestData.driverName,a.ambulanceDriverNumber=a.currentRequestData.driverContact))},function(a){})},a.treatment={queryUrl:"GET_EMERGENCY_TYPES",queryParameter:{},jsonParameter:{}},a.$watch("tempVariable",function(b,c){g.isFieldEmpty(b)||(a.WSEmergencyTransaction.emergencyLocation=b)});var B=function(b){if(g.isFieldEmpty(b)&&(b={}),
//        loadEmergencyForm(localStorageData);
/*$timeout(function () {*/
a.isUserLoggedIn&&(a.WSEmergencyTransaction.reportingPerson=angular.copy(d.userData(!0)),a.WSEmergencyTransaction.accompanyingPerson=angular.copy(d.userData(!0))),g.isFieldEmpty(b))D(b);else if(g.isFieldEmpty(l.callingUrl)){var c=e.confirm().title(i.instant("POPULATE_DATA")).textContent(i.instant("PREVIOUS_DATA")).ariaLabel("Lucky day").ok(i.instant("YES")).cancel(i.instant("NO"));e.show(c).then(function(){b={},D(b),E()},function(){C(b)})}else C(b)},C=function(b){g.isFieldEmpty(b)&&(b={}),angular.copy(b.WSEmergencyTransaction,a.WSEmergencyTransaction),a.ambulanceDriverName&&(a.WSEmergencyTransaction.ambulanceDriverName=a.ambulanceDriverName,a.WSEmergencyTransaction.ambulanceDriverNumber=a.ambulanceDriverNumber);var f=angular.fromJson(localStorage.getItem("emergencyRequestObject"));if(g.isEmpty(f)||(!g.isEmpty(f.hospitalSelected)&&g.isEmpty(a.WSEmergencyTransaction.hospitalSelected)&&(a.WSEmergencyTransaction.hospitalSelected={},a.WSEmergencyTransaction.hospitalSelected.organizationLocationId=f.hospitalSelected.id,a.WSEmergencyTransaction.hospitalSelected.displayName=f.hospitalSelected.value,a.WSEmergencyTransaction.hospitalLocation=f.hospitalAddress),!g.isEmpty(f.affectedPerson)&&g.isEmpty(a.WSEmergencyTransaction.affectedPerson)&&(a.WSEmergencyTransaction.affectedPerson=f.affectedPerson),g.isEmpty(f.emergency)||(a.WSEmergencyTransaction.emergencyLocation=f.emergency.address),g.isEmpty(f.ambulance)||(a.WSEmergencyTransaction.ambulanceDriverName=f.ambulanceDriverName,a.WSEmergencyTransaction.ambulanceDriverNumber=f.ambulanceDriverNumber),g.isEmpty(f.treatmentType)||(a.WSEmergencyTransaction.treatmentType={},a.WSEmergencyTransaction.treatmentType=f.treatmentType,a.disableTreatmentType=!0)),g.isFieldEmpty(a.WSEmergencyTransaction.reportingPerson)&&a.isUserLoggedIn&&(a.WSEmergencyTransaction.reportingPerson=angular.copy(d.userData(!0)),a.WSEmergencyTransaction.accompanyingPerson=angular.copy(d.userData(!0))),g.isFieldEmpty(b.transactionId)?(a.disabledFormFields=!1,a.transactionId=null,D(b)):(a.transactionId=b.transactionId,a.disabledFormFields=!0),!g.isFieldEmpty(a.transactionId)){var h={transactionId:a.transactionId};c.getPaymentStatusForTransaction(h,function(c){if(a.isPaid=c.whetherPaid,c.status&&"E_STATUS_REJECTED"==c.status.code){var d=e.confirm().title(i.instant("DO_YOU_WANT_TO_CHANGE_LOCATION")).textContent(i.instant("EMERGENCY_REQUEST_REJECTED_MSG")).ariaLabel("Lucky day").ok(i.instant("YES")).cancel(i.instant("NO"));e.show(d).then(function(){a.disabledFormFields=!1,a.transactionId=null,a.isPaid=null,a.WSEmergencyTransaction.status=null,a.WSEmergencyTransaction.id=null,a.WSEmergencyTransaction.hospitalSelected=null,a.WSEmergencyTransaction.version=null,a.WSEmergencyTransaction.transactionId=null},function(){b={},D(b),E()})}},function(a){})}angular.copy(b.flags,a.flags),(g.isFieldEmpty(a.WSEmergencyTransaction.affectedPerson)||g.isFieldEmpty(a.WSEmergencyTransaction.affectedPerson.userId))&&"FOR_SELF"!=a.WSEmergencyTransaction.reportedFor||(a.flags.disableAffectedPerson=!0),k(function(){if(!g.isFieldEmpty(l.type)){var a=document.getElementById(l.type);angular.element(a).triggerHandler("click")}},300),a.emergencyTransactionSpinner=!1},D=function(b){g.isFieldEmpty(b)&&(b={});var c=angular.fromJson(localStorage.getItem("WSGoogleMap")),d=angular.fromJson(localStorage.getItem("WSUserIdentification"));if(g.isFieldEmpty(b.WSEmergencyTransaction)&&(b.WSEmergencyTransaction={}),"userIdentifyList"==l.callbackUrl&&(g.isFieldEmpty(d)||(d.affectedPerson?(b.WSEmergencyTransaction.affectedPerson=d.affectedPerson,a.WSEmergencyTransaction.affectedPerson=d.affectedPerson,g.isFieldEmpty(a.WSEmergencyTransaction.affectedPerson.userId)||F(a.WSEmergencyTransaction.affectedPerson.userId),G(a.WSEmergencyTransaction.affectedPerson.userId)):(b.WSEmergencyTransaction.accompanyingPerson=d.accompanyingPerson,a.WSEmergencyTransaction.accompanyingPerson=d.accompanyingPerson))),"search-hospitals"==l.callbackUrl&&!g.isFieldEmpty(c))for(var e in c)b.WSEmergencyTransaction[e]=c[e],a.WSEmergencyTransaction[e]=c[e];a.ambulanceDriverName&&(a.WSEmergencyTransaction.ambulanceDriverName=a.ambulanceDriverName,a.WSEmergencyTransaction.ambulanceDriverNumber=a.ambulanceDriverNumber);var f=angular.fromJson(localStorage.getItem("emergencyRequestObject"));g.isEmpty(f)||(!g.isEmpty(f.hospitalSelected)&&g.isEmpty(a.WSEmergencyTransaction.hospitalSelected)&&(a.WSEmergencyTransaction.hospitalSelected={},a.WSEmergencyTransaction.hospitalSelected.organizationLocationId=f.hospitalSelected.id,a.WSEmergencyTransaction.hospitalSelected.displayName=f.hospitalSelected.value,a.WSEmergencyTransaction.hospitalLocation=f.hospitalAddress),!g.isEmpty(f.affectedPerson)&&g.isEmpty(a.WSEmergencyTransaction.affectedPerson)&&(a.WSEmergencyTransaction.affectedPerson=f.affectedPerson),g.isEmpty(f.emergency)||(a.WSEmergencyTransaction.emergencyLocation=f.emergency.address),g.isEmpty(f.ambulance)||(a.WSEmergencyTransaction.ambulanceDriverName=f.ambulanceDriverName,a.WSEmergencyTransaction.ambulanceDriverNumber=f.ambulanceDriverNumber),g.isEmpty(f.treatmentType)||(a.WSEmergencyTransaction.treatmentType={},a.WSEmergencyTransaction.treatmentType=f.treatmentType,a.disableTreatmentType=!0))},E=function(){a.emergencyTransactionSpinner=!1,j.getEventObject(function(b){a.WSEmergencyTransaction.emergencyLocation=b},null,a),localStorage.removeItem("WSEmergencyTransaction"),"search-hospitals"!=l.callbackUrl&&localStorage.removeItem("WSGoogleMap"),"userIdentifyList"!=l.callbackUrl&&localStorage.removeItem("WSUserIdentification")};a.callLoginPage=function(a){c.callLoginPage()},a.getHospitals=function(c,d){/*$scope.hospitalListSpinner = true;*/
var e={};e.keyword=c,e.treatmentTypeId=d.id;var f=x.getParameterizedUrl("GET_ORG_LOCATION_BY_EMERGENCY_TYPE",e),h=angular.fromJson(localStorage.getItem("emergencyRequestObject"));if(g.isEmpty(h)){var i=b.getSmartSearchMinLength("orgMinLength");if(g.isFieldEmpty(c))return;if(c.length<i)return}else e.emergencyId=h.emergency.id,
//TODO: remove this hardcoding when the api id changed [Pravin]
e.keyword="test",f=x.getParameterizedUrl("GET_ACCEPTED_HOSPITALS_BY_EMERGENCY_ID",e);return w.getData(f,null,function(b){return a.hospitalListSpinner=!1,b.data},function(b){a.hospitalListSpinner=!1})},a.checkIfOrgUser=function(){if(g.isFieldEmpty(a.orgLocId)||g.isFieldEmpty(a.WSEmergencyTransaction.reportingPerson.userId))a.isreportingUserOrgUser=!1;else{var b={};b.userId=a.WSEmergencyTransaction.reportingPerson.userId,b.locationId=a.orgLocId;var c=x.getParameterizedUrl("CHECK_IF_ORG_USER",b);w.getData(c,null,function(b){a.isreportingUserOrgUser=b.data},function(a){})}},a.selectedHospital=function(b){a.WSEmergencyTransaction.hospitalLocation=c.returnAddress(b),g.isFieldEmpty(b)||(a.orgLocId=b.organizationLocationId),a.checkIfOrgUser()},a.reset=function(){a.WSEmergencyTransaction.affectedPerson={},a.WSEmergencyTransaction.affectedPerson.userEmail=null,a.WSEmergencyTransaction.uhid=null,a.flags.disableAffectedPerson=!1},a.callScreen=function(b,c,d){a.storeInLocalStorage();var e={type:"calledFromEmergencyTransaction",callBackURL:"emergencytransaction"};e.data={},"userIdentifyList"===b&&("affectedPerson"!=c||g.isFieldEmpty(a.WSEmergencyTransaction.affectedPerson)||(e.data={firstName:a.WSEmergencyTransaction.affectedPerson.firstName,lastName:a.WSEmergencyTransaction.affectedPerson.lastName,userPhone:a.WSEmergencyTransaction.affectedPerson.userPhone}),"accompanyingPerson"!=c||g.isFieldEmpty(a.WSEmergencyTransaction.accompanyingPerson)||(e.data={firstName:a.WSEmergencyTransaction.accompanyingPerson.firstName,lastName:a.WSEmergencyTransaction.accompanyingPerson.lastName,userPhone:a.WSEmergencyTransaction.accompanyingPerson.userPhone})),"changeEmergencyLocation"===d&&(e.caller=d),g.isFieldEmpty(c)||(e.callingScreen=c),"search-hospitals"==b&&(g.isEmpty(a.WSEmergencyTransaction.treatmentType)||(e.emergencyType=a.WSEmergencyTransaction.treatmentType)),f.go(b,e)},a.storeInLocalStorage=function(){/*if ($scope.isUserLoggedIn && $scope.WSEmergencyTransaction.reportingPerson.userPhone != userStatusService.userData(true).userPhone) {
    $scope.WSEmergencyTransaction.reportingPerson.userId = null;
    $scope.changeAffectedPerson();
}*/
a.emergencyTransaction={WSEmergencyTransaction:a.WSEmergencyTransaction,flags:a.flags,transactionId:a.transactionId},localStorage.setItem("WSEmergencyTransaction",angular.toJson(a.emergencyTransaction))},a.changeAffectedPerson=function(){"FOR_SELF"===a.WSEmergencyTransaction.reportedFor?(a.WSEmergencyTransaction.affectedPerson=a.WSEmergencyTransaction.reportingPerson,a.WSEmergencyTransaction.accompanyingPerson={},a.flags.disableAffectedPerson=!0):a.isEmergencyRequest||(a.WSEmergencyTransaction.affectedPerson={},a.flags.disableAffectedPerson=!1)},a.changeEmergencyReason=function(){"NEEDED_TO_BE_ADMITTED"===a.WSEmergencyTransaction.emergencyReason?(a.WSEmergencyTransaction.whetherAdmissionRequired=!0,a.WSEmergencyTransaction.whetherOPD=!1):"IS_AN_OPD_EMERGENCY"===a.WSEmergencyTransaction.emergencyReason&&(a.WSEmergencyTransaction.whetherOPD=!0,a.WSEmergencyTransaction.whetherAdmissionRequired=!1)},a.validateHospitalLocation=function(){g.isFieldEmpty(a.WSEmergencyTransaction.hospitalSelected)&&(a.WSEmergencyTransaction.hospitalLocation="")},a.accompanyingPersonClicked=function(){"FOR_SELF"!==a.WSEmergencyTransaction.reportedFor&&g.isEmpty(a.WSEmergencyTransaction.accompanyingPerson)&&(a.WSEmergencyTransaction.accompanyingPerson=angular.copy(a.WSEmergencyTransaction.reportingPerson))},/*$scope.$watch('WSEmergencyTransaction.reportingPerson', function (newVal) {
            if (!utilService.isEmpty(newVal)) {
                if ($scope.WSEmergencyTransaction.reportedFor !== 'FOR_SELF' && utilService.isEmpty($scope.WSEmergencyTransaction.accompanyingPerson)) {
                    $scope.WSEmergencyTransaction.accompanyingPerson = $scope.WSEmergencyTransaction.reportingPerson;
                }
            }
        }, true);*/
a.intimateStakeholder=function(b){a.intimationDetails.transactionId=b,g.isEmpty(a.intimationDetails.stakeholderLists)||g.isFieldEmpty(a.intimationDetails.transactionId)||s.intimateStakeholder(a.WSEmergencyTransaction,a.intimationDetails,function(a){},function(a){})};var F=function(b){s.getEmergencyStakeholderList(b,function(b){a.intimationDetails.stakeholderLists=b},function(a){})};a.$watch("WSEmergencyTransaction.uhid",function(b){a.WSEmergencyTransaction.newUHID=g.isFieldEmpty(b)}),a.registerHospital=function(b,d){if(d.$valid){if(a.emergencyTransactionSpinner=!0,g.isFieldEmpty(a.WSEmergencyTransaction.accompanyingPerson)&&g.isFieldEmpty(a.WSEmergencyTransaction.affectedPerson))return a.emergencyTransactionSpinner=!1,void m(i.instant("WARNING"),i.instant("ATLEAST_ONE_PERSON_DETAIL"));a.storeInLocalStorage(),c.registerHospital(a.WSEmergencyTransaction,a.isEmergencyRequest,function(c){a.emergencyTransactionSpinner=!1,m("success",i.instant("ADDED_SUCCESS")),a.emergencyTransactionSpinner=!1;var d=angular.fromJson(localStorage.WSEmergencyTransaction);d.transactionId=c.data.transactionId,g.isFieldEmpty(c.data)||g.isFieldEmpty(c.data.affectedPerson)||(d.WSEmergencyTransaction.affectedPerson.userId=c.data.affectedPerson.id),a.transactionId=c.data.transactionId,a.disabledFormFields=!0,localStorage.setItem("WSEmergencyTransaction",angular.toJson(d)),a.intimateStakeholder(a.transactionId),a.selectOrbeonForm(b,c.data.emergencyAdmissionId,c.data.hospitalSelected),a.isEmergencyRequest&&/*localStorage.removeItem("WSEmergencyTransaction");*/
localStorage.setItem("emergencyRequestScreen",!0)},function(){a.emergencyTransactionSpinner=!1})}else m("warning",i.instant("FILL_MANDATORY_FIELDS"))};/* Function to get UHID*/
var G=function(b){c.getUHID(b,a.WSEmergencyTransaction.hospitalSelected,function(b){a.WSEmergencyTransaction.uhid=b.code},function(){})};/*Function to find user by mobile number*/
a.findUserByPhoneNoOrEmail=function(b,d,e){var f={};"MOBILE"==e&&(f.mobile=b),"EMAIL"==e&&(f.email=b),c.findUserByMobileOrEmail(f,function(b){if(b.data.length>0){var c=angular.fromJson(b.data)[0];if("affectedPerson"==d)G(c.userId),a.WSEmergencyTransaction.affectedPerson.userId=c.userId,a.WSEmergencyTransaction.affectedPerson.isSubscriber=c.whetherSubscriber,a.WSEmergencyTransaction.affectedPerson.firstName=c.firstName,a.WSEmergencyTransaction.affectedPerson.lastName=c.lastName,a.WSEmergencyTransaction.affectedPerson.userEmail=c.email,a.WSEmergencyTransaction.affectedPerson.userPhone=c.cell;else if("accompanyingPerson"==d)a.WSEmergencyTransaction.accompanyingPerson.userId=c.userId,a.WSEmergencyTransaction.accompanyingPerson.isSubscriber=c.whetherSubscriber,a.WSEmergencyTransaction.accompanyingPerson.firstName=c.firstName,a.WSEmergencyTransaction.accompanyingPerson.lastName=c.lastName,a.WSEmergencyTransaction.accompanyingPerson.userEmail=c.email,a.WSEmergencyTransaction.accompanyingPerson.userPhone=c.cell;else if(b.data.length>1)a.displayName={},a.showDisplayName=!0,a.displayNameList=b.data;else{var e={};e.loginParam=c.email,g.isEmpty(v.getLoggedInUser())&&u.showLoginConformationPopup(e,a),a.WSEmergencyTransaction.reportingPerson.userId=c.userId,a.WSEmergencyTransaction.reportingPerson.isSubscriber=c.whetherSubscriber,a.WSEmergencyTransaction.reportingPerson.firstName=c.firstName,a.WSEmergencyTransaction.reportingPerson.lastName=c.lastName,a.WSEmergencyTransaction.reportingPerson.userEmail=c.email,a.WSEmergencyTransaction.reportingPerson.userPhone=c.cell,g.isFieldEmpty(a.orgLocId)||g.isFieldEmpty(a.WSEmergencyTransaction.reportingPerson.userId)||a.checkIfOrgUser()}}},function(a){})},a.$on("UserLoggedIn",function(b,c){1==c&&(a.isUserLoggedIn=!0)}),a.displayNameSelected=function(b){a.WSEmergencyTransaction.reportingPerson.userId=b.userId,a.WSEmergencyTransaction.reportingPerson.isSubscriber=b.whetherSubscriber,a.WSEmergencyTransaction.reportingPerson.firstName=b.firstName,a.WSEmergencyTransaction.reportingPerson.lastName=b.lastName,a.WSEmergencyTransaction.reportingPerson.userEmail=b.email;var c={};c.loginParam=b.email,g.isEmpty(v.getLoggedInUser())&&u.showLoginConformationPopup(c,a)},a.cancel=function(){g.goBackToPrevState()},a.selectOrbeonForm=function(c,d,f){var i=(o("sm")||o("xs"))&&a.customFullscreen,i=o("gt-sm"),j="EMERGENCY_FORM",k={};k.stateName="emergencytransaction",k.params={data:null,type:"step4",callingUrl:"fromOrbeonForm",callbackUrl:"fromOrbeonForm"},q.getFormInstanceDetails(0,d,j,f.id,b.userSelectedLanguage.id,0,function(l){if(l)if(r.triggerMessageEvent(j,d,f.id,function(a){},function(a){}),g.isFieldEmpty(b.userSelectedLanguage.id))e.show({controller:A,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:h.dialogBox.clickOutsideToClose,fullscreen:i,locals:{dialogParams:{recordId:d,orgLoc:f,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){});else{/*prevStateParam.params= {
                                   type: 'iframe',
                                   url:iframeURL,
                                   savedRecordId:recordId,
                                   readonly: readonly,
                                   prevStateParam:prevStateParam,
                               };*/
var m=angular.fromJson(localStorage.WSEmergencyTransaction),o=g.isFieldEmpty(m.WSEmergencyTransaction.affectedPerson)?0:m.WSEmergencyTransaction.affectedPerson.userId,p=g.isFieldEmpty(m.WSEmergencyTransaction.reportingPerson)?0:m.WSEmergencyTransaction.reportingPerson.userId;n.loadNewFormRunner(d,j,f.id,b.userSelectedLanguage.id,k,l,0,o,p)}else
// triggerMsgevent only
r.triggerMessageEvent(j,d,f.id,function(a){},function(a){})},function(b){r.triggerMessageEvent(j,d,f.id,function(b){a.paymentCall()},function(a){})},{handleError:!1})},z()}]),angular.module("paripal.emergencyTransactionModule").controller("IntimateStakeholderCtrl",["$scope","$rootScope","userStatusService","$mdDialog","$state","baseService","utilService","commonConstants","$translate","$timeout","$stateParams","notify","$mdMedia","featurePrivilegeConstants","IntimateStakeholderService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(b){g.isEmpty(b.hospitalSelected)||(a.WSEmergencyTransaction.hospitalSelected={organizationLocationId:b.hospitalSelected.id,displayName:b.hospitalSelected.value}),a.intimationDetails.transactionId=b.transactionId,a.intimationDetails.whetherFirstAidGiven=b.whetherFirstAidGiven,a.intimationDetails.intimationFirstAidDescription=b.firstAidDescription,a.intimationDetails.intimationRemark=b.intimationRemark,a.WSEmergencyTransaction.transactionId=b.transactionId,a.WSEmergencyTransaction.emergencyDescription=b.emergencyRemark,"doctor"==k.mode?(a.intimationDetails.needPatientRecord=!0,a.disableClass="disabledSelectUser"):a.intimationDetails.needPatientRecord=b.needPatientRecord,g.isEmpty(b.reportingPerson)||(a.WSEmergencyTransaction.reportingPerson=b.reportingPerson),g.isEmpty(b.accompanyingPerson)||(a.WSEmergencyTransaction.accompanyingPerson=b.accompanyingPerson),g.isEmpty(b.affectedPerson)||(a.WSEmergencyTransaction.affectedPerson=b.affectedPerson,g.isFieldEmpty(b.affectedPerson.userId)||s(b.affectedPerson.userId)),g.isEmpty(b.treatmentType)||(a.WSEmergencyTransaction.treatmentType=b.treatmentType),a.WSEmergencyTransaction.reportedFor=b.reportedFor,a.WSEmergencyTransaction.hospitalLocation=b.hospitalAddress,a.WSEmergencyTransaction.emergencyLocation=b.emergencyLocation,b.whetherAdmissionRequired?a.WSEmergencyTransaction.emergencyReason="NEEDED_TO_BE_ADMITTED":b.whetherOPD&&(a.WSEmergencyTransaction.emergencyReason="IS_AN_OPD_EMERGENCY"),a.WSEmergencyTransaction.emergencyDescription=b.emergencyDescription,a.WSEmergencyTransaction.firstAidDescription=b.firstAidDescription,a.WSEmergencyTransaction.ambulanceDriverName=b.ambulanceDriverName,a.WSEmergencyTransaction.ambulanceDriverNumber=b.ambulanceDriverNumber}function q(){a.isUserLoggedIn=c.isUserLoggedIn();var b;r&&1!=r.isOrganizationUserMode&&(a.isIndividualUser=!0),"view"==k.mode?(a.viewMode=!0,a.pageState="view",o.getIntimationDetails(k,"view",function(a){p(a)},function(a){})):"doctor"==k.mode?(a.isDoctor=!0,a.intimationDetails.needPatientRecord=!0,g.isEmpty(r)||(a.intimationDetails.orgUser=r.id),k.id=0,o.getIntimationDetails(k,"doctor",function(a){p(a)},function(a){})):"automate"==k.mode?(a.isDoctor=!0,g.isEmpty(r)||(a.intimationDetails.orgUser=r.id),k.id=0,o.getIntimationDetails(k,"automate",function(a){p(a)},function(a){})):(b=angular.fromJson(localStorage.getItem("WSEmergencyTransaction")),t(b))}a.intimateScreen=!0,a.disabledFormFields=!0,a.intimationDetails={},a.WSEmergencyTransaction={},a.flags={},a.commonConstants=h,a.intimationDetails.stakeholderLists=[];var r=f.getLoggedInUser(),s=function(b){o.getEmergencyStakeholderList(b,function(b){a.intimationDetails.stakeholderLists=b},function(a){})},t=function(a){g.isFieldEmpty(a)&&(a={}),g.isFieldEmpty(a)?v(a):u(a)},u=function(b){if(g.isFieldEmpty(b)&&(b={}),angular.copy(b.WSEmergencyTransaction,a.WSEmergencyTransaction),g.isFieldEmpty(b.transactionId)||(a.transactionId=b.transactionId,v(b)),a.isUserLoggedIn&&!g.isFieldEmpty(a.transactionId)){({transactionId:a.transactionId})}angular.copy(b.flags,a.flags),j(function(){if(!g.isFieldEmpty(k.type)){var a=document.getElementById(k.type);angular.element(a).triggerHandler("click")}},300),a.emergencyTransactionSpinner=!1},v=function(b){g.isFieldEmpty(b)&&(b={});var c=angular.fromJson(localStorage.getItem("WSUserIdentification")),d=angular.fromJson(localStorage.getItem("intimationDetails"));g.isEmpty(c)||g.isFieldEmpty(c.affectedPerson.userId)||s(c.affectedPerson.userId),g.isFieldEmpty(b.WSEmergencyTransaction)&&(b.WSEmergencyTransaction={}),b&&b.WSEmergencyTransaction&&null!=b.WSEmergencyTransaction.firstAidDescription&&(a.intimationDetails.whetherFirstAidGiven=!0,a.intimationDetails.intimationFirstAidDescription=b.WSEmergencyTransaction.firstAidDescription),"userIdentifyList"==k.callbackUrl?(g.isFieldEmpty(d)||(a.intimationDetails=d),g.isFieldEmpty(c)||(b.WSEmergencyTransaction.affectedPerson=c.affectedPerson,a.WSEmergencyTransaction.affectedPerson=c.affectedPerson,!g.isFieldEmpty(a.WSEmergencyTransaction.affectedPerson.userId))):b.WSEmergencyTransaction&&b.WSEmergencyTransaction.affectedPerson&&b.WSEmergencyTransaction.affectedPerson.userId&&s(b.WSEmergencyTransaction.affectedPerson.userId)};a.reset=function(){a.WSEmergencyTransaction.affectedPerson={},a.WSEmergencyTransaction.affectedPerson.userEmail=null,a.flags.disableAffectedPerson=!1},a.callScreen=function(b,c){a.storeInLocalStorage();var d={type:"calledFromEmergencyTransaction",callBackURL:"intimatestakeholders"};d.data={},"userIdentifyList"===b&&(g.isFieldEmpty(a.WSEmergencyTransaction.affectedPerson)||(d.data={firstName:a.WSEmergencyTransaction.affectedPerson.firstName,lastName:a.WSEmergencyTransaction.affectedPerson.lastName,userPhone:a.WSEmergencyTransaction.affectedPerson.userPhone})),e.go(b,d)},a.cancel=function(){g.goBackToPrevState()},a.intimateStakeholder=function(){g.isEmpty(a.intimationDetails.stakeholderLists)?l("error",i.instant("NO_STAKEHOLDER_FOR_AFFECTED_PERSON")):(a.intimationDetails.transactionId=a.WSEmergencyTransaction.transactionId,o.intimateStakeholder(a.WSEmergencyTransaction,a.intimationDetails,function(b){a.cancel(),l("success",i.instant("INTIMATION_SUCCESS_MESSAGE"))},function(a){}))},a.storeInLocalStorage=function(){localStorage.setItem("intimationDetails",angular.toJson(a.intimationDetails))},q()}]),angular.module("paripal.emergencyTransactionModule").controller("IntimationListCtrl",["$scope","$rootScope","$mdDialog","$state","baseService","IntimateStakeholderService","utilService","commonConstants","$translate","$stateParams","notify","datatableconfig","httpService","urlService","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.shareObject={},a.filterObject={};var p=e.getLoggedInUser(),q=function(){m.getData(n.getUrl("GET_ON_BEHALF_OF_USER"),null,function(b){a.onBehalfOfLists=angular.fromJson(b.data)},function(a){})};q(),a.getIntimationList=function(){f.getIntimationList(a.filterObject,function(b){a.intimationList=b,g.isEmpty(a.intimationList)||(a.totalItems=a.intimationList.length,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems))},function(a){})},a.getIntimationList(),a.clear=function(){a.filterObject={},a.getIntimationList()},a.viewIntimation=function(a){var b={};b.id=a.id,b.transactionId=a.transactionId,b.mode="view",d.go("intimatestakeholders",b)},a.viewMessage=function(a,b){var d=c.alert({title:i.instant("INTIMATION_MESSAGE"),textContent:a.intimationRemark,ok:i.instant("CLOSE")});c.show(d).then(function(){d=void 0})},a.shareDetails=function(b,c){if(!g.isEmpty(b)){var d=new Object;d.shareType="DPR",d.advanceShareType="ALL",d.sharedWith=b.userWhoSent,g.isEmpty(p)||(d.sharedBy={id:p.id}),d.onBehalfOf=b.onBehalfOf,d.shareValidTill=b.shareValidTill,d.mode="add",d.intimation=!0,d.callBackFun=function(){},a.shareObject.init(d)}},a.shareOtherDoc=function(a,b){var c={};c.documentType="OTHER",c.onBehalfOf=a.onBehalfOf,c.userWhoSent=a.userWhoSent,c.canBeShared=a.whetherSharingAllowed,d.go("shareotherdocument",c)},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems),a.getIntimationList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getIntimationList()};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=l.setOptionProperties(r),a.dtColumnDefs=l.setColumnProperties({})}]),angular.module("paripal.emergencyTransactionModule").controller("LoginPopupCtrl",["$scope","utilService","authenticationService","$auth","$cookieStore","$cookies","storageService","baseService","$rootScope","$mdDialog","dialogParams",function(a,b,c,d,e,f,g,h,i,j,k){a.user={login:{idEmailCellIdentity:k.loginParam}},a.login=function(d){b.isEmpty(a.user)||b.isEmpty(a.user.login.idEmailCellIdentity)||b.isEmpty(a.user.login.password)||(i.showSpinner=!0,c.login(a.user.login,function(c){i.showSpinner=!1,b.isNullOrEmpty(c)||a.loginProcess(c)},function(b){i.showSpinner=!1,a.user.login.idEmailCellIdentity="",a.user.login.password=""}))},a.cancel=function(){j.cancel()},a.loginProcess=function(k){d.setToken(k.access_token),
// to be used for orbeon forms
e.put("token",k.access_token),f.put("token",k.access_token,{path:"/"}),i.isLoggedIn=!0,localStorage.setItem("isLoggedIn",!0),c.getUserDetails(a.user.login,function(c){if(i.showSpinner=!1,!b.isEmpty(c)){g.setPrivileges(c),h.setLoggedInUser(c),delete c.individualFeaturePrivileges,delete c.locationConsolidatedPrivileges,delete c.locationFeaturePrivileges,i.loggedInUserDetails=c,i.userDateFormat=c.userDateFormat,localStorage.setItem("userDateFormat",i.userDateFormat),a.user.login={},j.cancel("SUCCESS");h.getLoggedInUser;"undefined"!=typeof FCMPlugin&&getNotificationToken(c)}},function(b){i.showSpinner=!1,a.user.login.password=""})}}]),angular.module("paripal.emergencyTransactionModule").controller("RejectEmergencyRequestPopupCtrl",["$scope","$mdDialog","EmergencyCallManagementService","parentScope","$rootScope","notify",function(a,b,c,d,e,f){a.selectedReason={},a.cancel=function(){b.cancel()},a.init=function(){e.showSpinner=!0,c.getListOfRejectionReasons(function(b){a.rejectionReasonList=b,e.showSpinner=!1},function(a){e.showSpinner=!1})},a.saveCancelReason=function(g){e.showSpinner=!0,a.emergencyRequestObj={},a.emergencyRequestObj.id=d.emergencyRequestObj.id,a.emergencyRequestObj.emergencyStatusEnum=d.emergencyRequestObj.emergencyStatusEnum,a.emergencyRequestObj.rejectionReason=a.selectedReason,c.updateEmergencyCallStatus(a.emergencyRequestObj,function(a){e.showSpinner=!1,f("success",a.successMessage),b.cancel("SUCCESS")},function(a){e.showSpinner=!1})},a.init()}]),angular.module("paripal.emergencyTransactionModule").controller("ShareOtherDocCtrl",["$scope","$rootScope","$mdDialog","$state","baseService","utilService","commonConstants","$translate","$stateParams","datatableconfig","httpService","urlService","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.shareObject={},a.filterObject={};var n=e.getLoggedInUser();f.isFieldEmpty(i)||(a.requestObj={},a.requestObj.documentType=i.documentType,a.requestObj.canBeShared=i.canBeShared,f.isFieldEmpty(i.onBehalfOf)||(a.requestObj.loggedInUserId=i.onBehalfOf.id,a.onBehalfOf=i.onBehalfOf),f.isFieldEmpty(i.userWhoSent)||(a.userWhoSent=i.userWhoSent)),/* list/grid call */
a.getOtherDocList=function(){if(b.showSpinner=!0,a.requestObj)var c=a.requestObj;k.postData(l.getUrl("FIND_OTHER_SHARABLE_DOCUMENTS"),c,function(c){c.data&&(a.otherDocList=angular.fromJson(c.data.data),a.totalItems=a.otherDocList.length,a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems)),b.showSpinner=!1},function(a){b.showSpinner=!1})},a.getOtherDocList(),a.clear=function(){a.filterObject={},a.getIntimationList()},a.shareOtherDocument=function(b){if(!f.isEmpty(b)){var c=new Object;c.shareType="DOCUMENT",c.advanceShareType="ALL",c.sharedWith=a.userWhoSent,f.isEmpty(n)||(c.sharedBy={id:n.id}),c.onBehalfOf=a.onBehalfOf,c.shareValidTill=b.shareValidTill,c.mode="add",c.intimation=!0,c.entityId=b.id,c.docType="OTHER",c.callBackFun=function(){},a.shareObject.init(c)}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems),a.getIntimationList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getIntimationList()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=j.setOptionProperties(o),a.dtColumnDefs=j.setColumnProperties({})}]),angular.module("paripal.emergencyTransactionModule").controller("UpdatePatientDetailsCtrl",["$scope","$mdDialog","EmergencyCallManagementService","$rootScope","notify","EmergencyTransactionService","detailsObj","utilService",function(a,b,c,d,e,f,g,h){a.UpdatePatientDetails={},a.cancel=function(){b.cancel()},a.findUserByPhoneNoOrEmail=function(b,c){var d={};"MOBILE"==c&&(d.mobile=b),"EMAIL"==c&&(d.email=b),f.findUserByMobileOrEmail(d,function(b){if(b.data.length>0){var c=angular.fromJson(b.data)[0];/*getUHID(userDetails.userId);*/
a.UpdatePatientDetails.userId=c.userId,a.UpdatePatientDetails.isSubscriber=c.whetherSubscriber,a.UpdatePatientDetails.firstName=c.firstName,a.UpdatePatientDetails.lastName=c.lastName,a.UpdatePatientDetails.userEmail=c.email,b.data.length>1&&(a.displayName={},a.showDisplayName=!0,a.displayNameList=b.data)}},function(a){})},a.updatePatientDetails=function(){f.updatePatientDetails(a.UpdatePatientDetails,g.emergencyAdmissionId,function(a){e("success",a.successMessage),b.cancel("SUCCESS")},function(a){})},a.displayNameSelected=function(b){a.UpdatePatientDetails.userId=b.userId,a.UpdatePatientDetails.isSubscriber=b.whetherSubscriber,a.UpdatePatientDetails.firstName=b.firstName,a.UpdatePatientDetails.lastName=b.lastName,a.UpdatePatientDetails.userEmail=b.email};a.init=function(){h.isFieldEmpty(g)||h.isFieldEmpty(g.patientDetails)||(a.UpdatePatientDetails.userPhone=g.patientDetails.cell1,a.UpdatePatientDetails.userEmail=g.patientDetails.email1,a.UpdatePatientDetails.firstName=g.patientDetails.firstName,a.UpdatePatientDetails.lastName=g.patientDetails.lastName,a.UpdatePatientDetails.isSubscriber=g.patientDetails.whetherSubscriber,a.UpdatePatientDetails.userId=g.patientDetails.id)},a.init()}]),angular.module("paripal.emergencyTransactionModule").service("EmergencyTransactionService",["$mdDialog","urlService","httpService","utilService","notify","$translate","$state",function(a,b,c,d,e,f,g){function h(a,b,g,h){console.log(b);var i=angular.fromJson(localStorage.getItem("emergencyRequestObject"));d.isFieldEmpty(i)&&(i={}),d.isEmpty(b.reportingPerson)||(i.reportingPerson=b.reportingPerson),d.isEmpty(b.accompanyingPerson)||(i.accompanyingPerson=b.accompanyingPerson),d.isEmpty(b.affectedPerson)||(i.affectedPerson=b.affectedPerson),d.isEmpty(b.treatmentType)||(i.treatmentType=b.treatmentType),d.isEmpty(b.hospitalSelected)||(i.hospitalSelected=b.hospitalSelected),i.emergencyDescription=b.emergencyDescription,i.emergencyLatitude=b.emergencyLatitude,i.emergencyLongitude=b.emergencyLongitude,i.emergencyLocation=b.emergencyLocation,i.firstAidDescription=b.firstAidDescription,i.reportedFor=b.reportedFor,i.whetherAdmissionRequired=b.whetherAdmissionRequired,i.whetherOPD=b.whetherOPD,i.forgotUHID=b.forgotUHID,i.newUHID=b.newUHID,i.whetherPatientIsSubscriber=b.whetherPatientIsSubscriber,i.uhid=b.uhid,i.whetherPaid=b.whetherPaid,i.ambulanceDriverName=b.ambulanceDriverName,i.ambulanceDriverNumber=b.ambulanceDriverNumber,c.postData(a,i,function(a){e("success",f.instant("ADDED_SUCCESS")),g(a)},function(){h()})}this.callLoginPage=function(){g.go("login",{callbackState:"emergencytransaction"})},this.getEmergencyMenu=function(a){c.getJsonData(b.getJsonFileUrl("EMERGENCY_MENU",null),function(b){b&&b.data&&a(b.data)},function(a){})},this.registerHospital=function(a,g,i,j){var k={};angular.copy(a,k),d.isFieldEmpty(k.reportingPerson)||delete k.reportingPerson.isSubscriber,k.affectedPerson&&k.affectedPerson.isSubscriber&&(k.whetherPatientIsSubscriber=k.affectedPerson.isSubscriber,delete k.affectedPerson.isSubscriber),d.isFieldEmpty(k.hospitalSelected)||(k.hospitalSelected={id:k.hospitalSelected.organizationLocationId,value:k.hospitalSelected.displayName}),delete k.hospitalLocation,d.isFieldEmpty(k.selectedHospitalLocation)||delete k.selectedHospitalLocation,delete k.emergencyReason;var l;g?(l=b.getUrl("UPDATE_PATIENT_RECORD"),h(l,k,i,j)):(l=b.getUrl("REGISTER_HOSPITAL"),c.postData(l,k,function(a){e("success",f.instant("ADDED_SUCCESS")),i(a)},function(){j()}))},this.getHospitals=function(a,d,e,f){var g=b.getUrl("SEARCH_HOSPITALS");return g+=a,c.getData(g,null,function(a){return e(angular.fromJson(a.data))},function(){return f()})},this.returnAddress=function(a){var b="";return d.isFieldEmpty(a.addressLine1)||(b=a.addressLine1),d.isFieldEmpty(a.addressLine2)||(b=b+", "+a.addressLine2),d.isFieldEmpty(a.addressLine3)||(b=b+", "+a.addressLine3),d.isFieldEmpty(a.postalCode)||(b=b+", "+a.postalCode),b},this.findUserByPhoneNo=function(a,e,f){if(!d.isFieldEmpty(a)){var g={mobileNo:a};c.getData(b.getParameterizedUrl("FIND_USER_BY_MOBLE_NO",g),null,function(a){e(a)},function(a){f()})}},this.findUserByMobileOrEmail=function(a,e,f){if(!d.isFieldEmpty(a)){var g={};d.isFieldEmpty(a.mobile)||(g.cell=a.mobile),d.isFieldEmpty(a.email)||(g.email=a.email),c.postData(b.getUrl("CHECK_USER_BY_EMAIL_AND_CELL"),g,function(a){e(a)},function(a){f()})}},this.getUHID=function(a,e,f,g){var h={};if(!d.isFieldEmpty(a)&&!d.isFieldEmpty(e)){h.userId=a,h.orgLocId=e.organizationLocationId;var i=b.getParameterizedUrl("GET_CLIENT_BY_USER_ID_LOC_ID");i=i+"?userId="+a+"&orgLocId="+e.organizationLocationId,c.getData(i,null,function(a){f(a.data)},function(a){g(a)},{handleError:!1})}},this.consultDoctor=function(a,d){var e={};e.linkedToTransaction=a,c.postData(b.getUrl("CONSULT_DOCTOR_AGORA"),e,function(a){d(a.data)},function(){})},this.directCallConsultDoctor=function(a,d){var e={};e.user=a.user,e.organizationLocation=a.organizationLocation,c.postData(b.getUrl("DIRECT_CALL_PATIENT"),e,function(a){d(a.data)},function(){})},/*this.getAutoBillDetails = function (transactionId, successCallback, errorCallback) {
        if (!utilService.isFieldEmpty(transactionId)) {
            httpService.getData(urlService.getParameterizedUrl('BUILD_AUTO_BILL', transactionId), null, function (response) {
                successCallback(response.data);
            }, function (error) {
                errorCallback(error);
            });
        }
    };*/
this.getAutoBillDetails=function(a,e,f,g,h){if(!d.isFieldEmpty(a)&&!d.isFieldEmpty(e)){var i={transactionId:a.transactionId,transactionType:e};c.getData(b.getParameterizedUrl("BUILD_AUTO_BILL",i),null,function(a){f(a.data)},function(a){g(a)},h)}},this.getWhetherBillDetails=function(a,e,f,g){if(!d.isFieldEmpty(a)){var a={transactionId:a.transactionId};c.getData(b.getParameterizedUrl("WHETHER_BILL_AVAILABLE",a),null,function(a){e(a.data)},function(a){f(a)},g)}},this.getPaymentStatusForTransaction=function(a,e,f){d.isFieldEmpty(a)||c.getData(b.getParameterizedUrl("GET_PAYMENT_STATUS_FOR_TRANSACTION",a),null,function(a){e(a.data)},function(a){f(a)})},this.updatePatientDetails=function(a,e,f,g){var h={};h.affectedPerson=a;var i={};i.id=e,d.isFieldEmpty(a)||c.putData(b.getParameterizedUrl("UPDATE_PATIENT_DETAILS",i),h,function(a){f(a.data)},function(a){g(a)})},this.getAddressTypeByCode=function(a,e,f){if(!d.isFieldEmpty(a)){var g={typeCode:a};c.getData(b.getParameterizedUrl("GET_ADDRESS_TYPE_BY_CODE",g),null,function(a){e(a.data)},function(a){f(a)})}}}]),angular.module("paripal.emergencyTransactionModule").service("EmergencyCallManagementService",["$mdDialog","urlService","httpService","utilService","notify","$translate","$state","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i){this.searchData=function(a,e){var f={};angular.copy(a,f),d.isFieldEmpty(f.assignedToDoctor)||(f.assignedToDoctor=a.assignedToDoctor.id),d.isFieldEmpty(f.dateFrom)||(f.dateFrom=h.convertToServerDate(a.dateFrom)),d.isFieldEmpty(f.dateTill)||(f.dateTill=h.convertToServerDate(a.dateTill)),c.postData(b.getUrl("FIND_EMERGENCY_CALLS_BY_SEARCH_CRITERIA"),f,function(a){e(a.data)},function(){})},this.searchDirectCallQueueList=function(a,e){var f={};angular.copy(a,f),d.isFieldEmpty(f.assignedToDoctor)||(f.assignedToDoctor=a.assignedToDoctor.id),d.isFieldEmpty(f.dateFrom)||(f.dateFrom=h.convertToServerDate(a.dateFrom)),d.isFieldEmpty(f.dateTill)||(f.dateTill=h.convertToServerDate(a.dateTill)),c.postData(b.getUrl("FIND_DIRECT_CALL_QUEUE_LIST"),f,function(a){e(a.data)},function(){})},this.assignToDoctor=function(a,d,f){var g={};g.userId=a.id,g.transactionId=d,c.putData(b.getUrl("ALLOCATE_PATIENT_TO_DOCTOR_AGORA"),g,function(a){e("success",a.data.successMessage),f(a.data)},function(){})},this.directCallAssignToDoctor=function(a,d){var f={};f.userId=a.userId,f.conversationLogId=a.convId,f.directCallPingInterval=a.directCallPingInterval,f.appointmentId=a.appointmentId,c.putData(b.getUrl("DIRECT_CALL_DOCTOR"),f,function(a){"Already assigned to Someother Doctor"==a.data.successMessage?e("alert",a.data.successMessage):"Patient Not Available"==a.data.successMessage?e("alert",a.data.successMessage):"Patient cancelled the request"==a.data.successMessage?e("alert",a.data.successMessage):e("success",a.data.successMessage),d(a.data)},function(){})},this.getConversationHistory=function(a,d){c.postData(b.getUrl("GET_CONV_HISTORY_OF_PATIENT"),a,function(a){d(a.data)},function(){})},this.getListOfRejectionReasons=function(a,d){c.getData(b.getUrl("GET_EMERGENCY_REJECTION_REASONS"),null,function(b){a(b.data)},function(a){d(a)})},this.updateEmergencyCallStatus=function(a,d,e){c.putData(b.getUrl("UPDATE_EMERGENCY_ADMITION_STATUS"),a,function(a){d(a.data)},function(a){e(a)})},this.dischargePatient=function(a,d,e){c.putData(b.getUrl("DISCHARGE_PATIENT"),a,function(a){d(a.data)},function(a){e(a)})},this.getSkypeId=function(a){if(i.isUserLoggedIn()){var d={userId:i.userData().userId};c.getData(b.getParameterizedUrl("GET_SKYPE_ID",d),null,function(b){a(b.data)},function(){})}}}]),angular.module("paripal.emergencyTransactionModule").service("IntimateStakeholderService",["urlService","httpService","utilService","notify","$translate","dateconvertor",function(a,b,c,d,e,f){this.getEmergencyStakeholderList=function(c,d,e){var f={};f.userId=c;var g=a.getParameterizedUrl("EMERGENCY_STAKEHOLDER_LIST",f);b.getData(g,null,function(a){a.data?d(a.data):e(a)},function(a){e(a)})},this.intimateStakeholder=function(d,e,f,g){var h={};c.isFieldEmpty(d.hospitalSelected)||(h.organizationLocation={id:d.hospitalSelected.organizationLocationId}),c.isFieldEmpty(e.orgUser)||(h.orgUser={id:e.orgUser}),c.isEmpty(d.affectedPerson)||(h.affectedPerson={id:d.affectedPerson.userId}),h.transactionId=e.transactionId,h.whetherFirstAidGiven=e.whetherFirstAidGiven,h.intimationFirstAidDescription=e.intimationFirstAidDescription,h.intimationRemark=e.intimationRemark,c.isNullOrEmpty(h.intimationRemark)&&(h.intimationRemark=d.affectedPerson.firstName+" has been registered with "+d.hospitalSelected.displayName+" at location "+d.hospitalLocation),h.emergencyRemark=d.emergencyDescription,h.needPatientRecord=e.needPatientRecord,c.isEmpty(e.stakeholderLists)||(h.stakeholders=e.stakeholderLists),b.postData(a.getUrl("INTIMATE_STAKEHOLDER"),h,function(a){a.data?f(a.data):g(a)},function(a){g(a)})},this.getIntimationList=function(d,e,g){var h={};c.isEmpty(d.dateFrom)||(h.dateFrom=f.convertToServerDate(d.dateFrom)),c.isEmpty(d.dateTill)||(h.dateTill=f.convertToServerDate(d.dateTill)),c.isEmpty(d.onBehalfOf)||(h.onBehalfOf={id:d.onBehalfOf.id}),d.needPatientRecord&&(h.dataAccessRequired=d.needPatientRecord),b.postData(a.getUrl("INTIMATE_STAKEHOLDER_LIST"),h,function(a){a.data&&e(a.data.data)},function(a){g(a)})},this.getIntimationDetails=function(c,d,e,f){var g={};g.transactionId=c.transactionId,g.id=c.id,b.getData(a.getParameterizedUrl("INTIMATE_STAKEHOLDER_DETAILS",g),null,function(a){a.data?e(a.data):errorCallBack(a)},function(a){errorCallBack(a)})}}]),angular.module("paripal.emergencyTransactionModule").service("loginPopupService",["$translate","$mdDialog","commonConstants",function(a,b,c){"use strict";this.isPopupOpen={$$state:{status:1}};var d=this;this.showLoginConformationPopup=function(e,f){var g=b.confirm().title(a.instant("LOGIN_CONFORMATION_TITLE")).textContent(a.instant("LOGIN_CONFORMATION_MSG")+e.loginParam+"?").ok(a.instant("OK")).cancel(a.instant("CANCEL"));1==d.isPopupOpen.$$state.status&&(d.isPopupOpen=b.show(g).then(function(){b.cancel(),b.show({controller:"LoginPopupCtrl",templateUrl:"app/modules/emergency-transaction-management/views/login-popup.html",parent:angular.element(document.body),clickOutsideToClose:c.dialogBox.clickOutsideToClose,locals:{dialogParams:{loginParam:e.loginParam}}}).then(function(a){},function(a){"SUCCESS"==a&&f&&f.$broadcast("UserLoggedIn",!0)})},function(){}))}}]),angular.module("paripal.emergencyUploadModule").controller("EmergencyUploadListCtrl",["$scope","$rootScope","$stateParams","$state","baseService","emergencyUploadListService","fileOperations","notify","$translate","utilService","commonConstants","fileExtensionConstants",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){j.isFieldEmpty(c.transactionId)?j.isNullOrEmpty(localStorage.getItem("WSEmergencyTransaction"))||(a.WSEmergencyTransaction=JSON.parse(localStorage.getItem("WSEmergencyTransaction")),j.isEmpty(a.WSEmergencyTransaction)||(a.WSEmergencyTransaction.transactionId&&(a.isTransactionId=!1,a.transactionId=a.WSEmergencyTransaction.transactionId),j.isEmpty(a.WSEmergencyTransaction.WSEmergencyTransaction)||j.isEmpty(a.WSEmergencyTransaction.WSEmergencyTransaction.affectedPerson)||(a.affectedPerson=a.WSEmergencyTransaction.WSEmergencyTransaction.affectedPerson.firstName+" "+a.WSEmergencyTransaction.WSEmergencyTransaction.affectedPerson.lastName),j.isEmpty(a.WSEmergencyTransaction.WSEmergencyTransaction)||j.isEmpty(a.WSEmergencyTransaction.WSEmergencyTransaction.accompanyingPerson)||(a.accompanyingPerson=a.WSEmergencyTransaction.WSEmergencyTransaction.accompanyingPerson.firstName+" "+a.WSEmergencyTransaction.WSEmergencyTransaction.accompanyingPerson.lastName))):(a.isTransactionId=!1,a.transactionId=c.transactionId)}a.isTransactionId=!0,m(),/*$scope.affectedPerson = "Sumit Dhage";
            $scope.accompanyingPerson = "Pravin Surve";*/
a.files=new Array,/*$scope.transactionId =1;*/
a.mediaPageNo=1,a.noMediaResultFound=!1,a.deleteDialogBox={},a.viewPrintFile=function(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.documentId,c.recordId=b.transactionId,c.docType=k.documentTypes.transaction,c.docSubType=k.documentSubTypes.emergencyTransaction,a.fileResource=c,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0},a.getTransactionAttachment=function(b){var c={};a.mediaPageNo=b,c.transactionId=a.transactionId,c.pageNo=b,a.fileUploadSpinner=!0,f.getTransactionAttachment(c,function(b){a.fileUploadSpinner=!1,a.WSTransactionAttachments=b,b.length>0?(a.noMediaResultFound=!0,a.noTransactionAttachment=!1):(a.noMediaResultFound=!1,a.noTransactionAttachment=!0)},function(b){a.fileUploadSpinner=!1})},a.getTransactionAttachment(a.mediaPageNo),a.previousTransactionAttachment=function(){1!=a.mediaPageNo&&(a.mediaPageNo=a.mediaPageNo-1),a.getTransactionAttachment(a.mediaPageNo)},a.nextTransactionAttachment=function(){a.mediaPageNo=a.mediaPageNo+1,a.getTransactionAttachment(a.mediaPageNo)},a.fileChange=function(b){a.files=[];var b=angular.element(b);if(b){var c=angular.element(document.querySelector("input#fileInput")),d=c[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)}),c.val(null)}a.files&&a.files.length>0&&a.saveAllDocuments(a.files)},a.checkFileExtensionWRTResourceType=function(a){var b=!1,c=!0,d=null,e=null,f=l.IMAGE,g=l.VIDEO;return angular.forEach(a,function(a,h){if(c){if(d=a.fileName,e=d.substring(d.lastIndexOf(".")+1,d.length).toLowerCase(),j.checkStringInArray(f,e))return b=!0;if(j.checkStringInArray(g,e))return b=!0;c=!1}}),b||h("Error",i.instant("INVALID_EMERGENCY_FILE_SELECTION")),b},a.saveAllDocuments=function(b){var c=!1;if(c=a.checkFileExtensionWRTResourceType(b)){var d={};d.documentType={},d.documentType.type=k.documentTypes.transaction,d.documentType.subType=k.documentSubTypes.emergencyTransaction,d.documentType.id=24,a.fileUploadSpinner=!0,g.saveAllDocuments(d,!1,b,function(c){b&&b.length>0&&c&&a.saveTransactionAttachment(b,d,c)},function(b){a.fileUploadSpinner=!1})}},a.saveTransactionAttachment=function(b,c,d){var e={};e.transactionId=a.transactionId,e.documentIds=[];for(var g=0;g<d.response.length;g++)e.documentIds.push(d.response[g].id);f.saveTransactionAttachment(e,function(f){b&&b.length>0&&d&&a.uploadFile(b,c,d,e)},function(b){a.fileUploadSpinner=!1,f.deleteAllDocument(e.documentIds,function(a){},function(a){})})},a.uploadFile=function(b,c,d,e){var j=new Object;j.docType=c.documentType.type,j.docSubType=c.documentType.subType,j.recordId=a.transactionId,d.response&&(j.resourceDetails=JSON.stringify(d.response)),g.uploadMultipleFiles(j,b,function(b){a.fileUploadSpinner=!1,a.getTransactionAttachment(1)},function(b){a.fileUploadSpinner=!1,h("Error",i.instant("ERROR_WHILE_UPLOADING")),f.deleteByTransactionIdAndDocIds(e,function(a){f.deleteAllDocument(e.documentIds,function(a){},function(a){})},function(a){})})},a.deleteTransactionAttachment=function(b){a.deleteDialogBox.header=i.instant("DELETE_RESOURCE"),a.deleteDialogBox.onOkBtnClick=function(){a.fileUploadSpinner=!0,f.deleteEmergencyTransactionByDocId(b,function(c){f.deleteDocument(b.documentId,function(c){var d={};d.fileName=b.fileName,d.resourceId=b.documentId,d.recordId=b.transactionId,d.docType=k.documentTypes.transaction,d.docSubType=k.documentSubTypes.emergencyTransaction,f.deleteFileFromSystem(d,function(b){h("success",i.instant("RECORD_DELETED_SUCCESSFULLY")),a.fileUploadSpinner=!1,a.getTransactionAttachment(1)},function(b){a.fileUploadSpinner=!1})},function(b){a.fileUploadSpinner=!1})},function(b){a.fileUploadSpinner=!1})},a.deleteDialogBox.init()},a.downloadTransactionAttachment=function(a){var b=new Object;b.fileName=a.fileName,b.resourceId=a.documentId,b.recordId=a.transactionId,b.docType=k.documentTypes.transaction,b.docSubType=k.documentSubTypes.emergencyTransaction,g.downloadFile(b,function(a){},function(a){})},a.init=function(){c.affectedPerson&&c.affectedPerson.firstName&&c.affectedPerson.lastName?a.affectedPerson=c.affectedPerson.firstName+" "+c.affectedPerson.lastName:c.affectedPerson&&c.affectedPerson.value&&(a.affectedPerson=c.affectedPerson.value),c.accompanyingPerson&&c.accompanyingPerson.firstName&&c.accompanyingPerson.lastName?a.accompanyingPerson=c.accompanyingPerson.firstName+" "+c.accompanyingPerson.lastName:c.accompanyingPerson&&c.accompanyingPerson.value&&(a.accompanyingPerson=c.accompanyingPerson.value)},a.init()}]),angular.module("paripal.emergencyUploadModule").service("emergencyUploadListService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.getTransactionAttachment=function(c,e,f,g){var h=null;h=d.isFieldEmpty(g)?b.getParameterizedUrl("GET_TRANSACTION_ATTACHMENT_BY_ID",c):b.getParameterizedUrl(g,c),a.getData(h,null,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.saveTransactionAttachment=function(c,d,e){a.postData(b.getUrl("SAVE_TRANSACTION_EMERGENCY"),c,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.deleteAllDocument=function(c,d,e){var f={};f.ids=c,a.postData(b.getUrl("DELETE_ALL_DOCUMENT_DETAILS"),f,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.deleteDocument=function(c,d,e){var f=b.getUrl("DELETE_DOCUMENT_DETAILS");f&&(f=f+"?documentId="+c),a.deleteData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.deleteEmergencyTransaction=function(c,d,e){var f={};f.transactionId=c,a.deleteData(b.getParameterizedUrl("DELETE_EMERGENCY_TRANSACTION",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.deleteEmergencyTransactionByDocId=function(c,e,f,g,h){var i={},j="";d.isFieldEmpty(g)?(i.transactionId=c.transactionId,i.documentId=c.documentId,j=b.getParameterizedUrl("DELETE_EMERGENCY_TRANSACTION_BY_DOC_ID",i)):d.isFieldEmpty(h)||(h.documentId=c.documentId,j=b.getParameterizedUrl(g,h)),a.deleteData(j,null,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.deleteByTransactionIdAndDocIds=function(c,d,e){a.postData(b.getUrl("DELETE_TRANSACTION_BY_TRANS_ID_DOC_IDS"),c,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.deleteFileFromSystem=function(c,d,e){var f=b.getUrl("PUBLIC_DELETE_FILE");a.postData(f,c,function(a){a&&d(a)},function(a){e(a)})}}]),angular.module("paripal.eventModule").controller("EventListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.eventListSpinner=!1,a.WSEventList=[],a.postHeader=null,a.orgLocPermission=p.EVENT_VIEW,a.postHeader={headers:{orgLocPermission:a.orgLocPermission}},a.venderList=function(){var a={to:"Care User2",from:"Care Admin",fromUserId:505,toUserId:508,topicType:"TEST",topic:"TEST",subject:"ABC"};d.go("msgconversation",{data:a})},a.eventName={queryUrl:"SEARCH_EVENT_BY_EVENT_NAME",queryParameter:{}},a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.eventType={queryUrl:"FIND_ALL_EVENT_TYPE",queryParameter:{}},a.city={queryUrl:"FIND_ALL_CITIES",queryParameter:{}},a.getStatusTypes=function(){a.getListOfStatusTypes()},a.getListOfStatusTypes=function(){return k.getData(l.getUrl("FIND_ALL_EVENT_SESSION_STATUS"),null,function(b){a.statusList=angular.fromJson(b.data)},function(a){})},a.searchEvents=function(b){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.eventListSpinner=!0;var c="";c="SEARCH_EVENT_LIST";var d={};d=angular.copy(a.searchCriteria),n.searchEvents(d,c,a.postHeader,function(b){a.eventListSpinner=!1,a.WSEventList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.eventListSpinner=!1},a.eventIds)},a.viewBookingCounts=function(a){d.go("viewBookingCounts",{eventId:a?a.id:null})},a.viewFeedback=function(a){var b={dateFrom:q.convertToViewDate(a.startDate),conductedBy:a.conductedBy,eventName:{id:a?a.id:null,value:a.eventName}};d.go("viewFeedback",{data:b})},a.clear=function(){a.searchCriteria={},a.searchEvents()},/*Rdirect to Session List Screen*/
a.manageEventSessions=function(a){d.go("sessionList",{eventId:a?a.id:null,data:a})},a.manageEvents=function(a,b){var c={type:b,eventId:a?a.id:null};d.go("manageEvents",c)},/*redirect to Event Details*/
a.redirectToEventDetials=function(a){var b={eventId:a?a.id:null};d.go("showeventdetails",b)},a.inactiveEvent=function(a){var b={eventId:a.id};n.inactivateEvent(b,a.conductedBy.id,function(a){f("success",a.successMessage),d.reload()},function(a){})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchEvents("search")},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchEvents("search")};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(r),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){if(a.upComingEvent="upComingEvent",a.cancelledEvent="cancelledEvent",a.completedEvent="completedEvent","professionalwall"===c.type){a.fromProfessionalWall=!0;var b=c.user.id;n.getProfEventIds(b,function(b){a.eventIds=b,m.isFieldEmpty(a.eventIds)||0==a.eventIds.length||a.searchEvents()})}else a.searchEvents();a.getStatusTypes()},a.init()}]),angular.module("paripal.eventModule").controller("EventManagementCtrl",["$scope","$state","baseService","utilService","$rootScope",function(a,b,c,d,e){"use strict";/*$scope.showMyCalendars = function () {
            if (baseService.getLoggedInUser().isOrganizationUserMode == true) {
                $state.go("calendarlistview");
            } else {
                $state.go("individualcalendarlist");
            }
        };

        $scope.showMyAppointments = function () {
            if (baseService.getLoggedInUser().isOrganizationUserMode == true) {
                $state.go("appointmentsList");
            } else {
                $state.go("individualAppointmentsList");
            }
        };*/
if(!d.isNullOrEmpty(e.dashboardMenu)){a.parentMenus=e.dashboardMenu.children;for(var f=0;f<=a.parentMenus.length;f++)null!=a.parentMenus[f]&&("EVENTS"!=a.parentMenus[f].name&&"EVENTS_FOR_ME"!=a.parentMenus[f].name||(a.childMenus=a.parentMenus[f].children))}}]),angular.module("paripal.eventModule").controller("ManageBookingCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageEventService","featurePrivilegeConstants","dateconvertor","GoogleMap","NgMap","$timeout","sessionListService","manageSessionService","bookingService","$mdDialog","EmergencyTransactionService","$mdMedia","docMgntService","orbeonFormRunner","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){"use strict";function C(a){var b={};return b.BILL_FOR="EVENT",b.EVENT_NAME=a.eventInfo.eventName,b.SESSION_NAME=a.eventSession.value,b.BOOKING_DATE=p.convertToViewDate(a.bookedDate),b}function D(b){a.eventObj=angular.copy(b.eventInfo),delete b.eventInfo,a.bookingObj=angular.copy(b),a.onSessionSelect(a.bookingObj.eventSession),a.isViewMode=!0}function E(a,b,c,d){a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.language={},a.orgLocPermission=b.ORGANIZATION_USER_HEALTH_PROFESSIONAL_VIEW,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.loadForm=function(b){var d="EVENT_BOOKING_FORM",e={};e.data={id:"1"},A.loadNewFormRunner(c.recordId,d,c.orgLoc.id,a.searchCriteria.language.id,e,c.formTemplate),w.hide()},a.hide=function(){w.hide()},a.cancel=function(){w.cancel()}}E.$inject=["$scope","featurePrivilegeConstants","dialogParams","parentScope"],a.bookingObj={},a.WSSessionList=[],a.disabledFormFields=!1,a.manageEventSpinner=!1,a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.currency={queryUrl:"GET_CURRENCYLIST_DATA",queryParameter:{}},a.paymentCall=function(a){v.isBookingCapacity(a,function(a){if(a){var b={};if(angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId){var b={transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId};x.getWhetherBillDetails(b,function(a){d.go("billsummaryview",{transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId})},function(a){var b=w.confirm().title(g.instant("EVENT_FEE_TYPE_ERROR")).textContent(g.instant("EVENT_FEE_TYPE_NOT_FOUND")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));w.show(b).then(function(){},function(){d.go("eventList")})},{handleError:!1})}}},function(a){})},a.getSessionName=function(b){var d={};d.eventId=c.eventId,d.searchKeyword=b;var e=[];return t.getSessionNameForBooking(d,function(a){return e=a},function(a){},a.orgLocPermission)},a.saveBooking=function(b,d){if(d.$valid){a.manageEventSpinner=!0;var e=angular.copy(a.bookingObj);l.isFieldEmpty(c.bookingId)||(e.id=c.bookingId),e.bookedDate=p.convertToServerDate(a.bookedDate),a.eventObj.whetherFeeApplicable?e.boookingStatus="PENDING":e.boookingStatus="CONFIRMED",v.saveBookingDetails(e,a.eventObj.conductedBy.data.id,c.type,function(c){var d=e;d.eventInfo=a.eventObj,angular.fromJson(c).response&&(d.transactionId=angular.fromJson(c).response.transactionId),localStorage.setItem("EventBookingDetails",angular.toJson(d)),localStorage.setItem("BillDetails",angular.toJson(C(d))),a.manageEventSpinner=!1,f("success",g.instant(c.successMessage)),a.hidePaymentButton=!1,a.isViewMode=!0,/*$state.go("viewBookingDetails", $stateParams);*/
a.selectOrbeonForm(b,angular.fromJson(c).response.id,a.eventObj)},function(b){a.manageEventSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))})}},a.getProfessionalUsers=function(a,b){var c={};return c.userName=a,c.eventSessionId=b,u.getProfessionals(c,"GET_USER_BY_SESSION_ID",function(a){return a})},/*on cancel forward to search list*/
a.cancel=function(){var a=angular.fromJson(localStorage.getItem("manageBooking"));d.go(a.parentState,a)},/*Map Integration Start*/
a.getStatusTypes=function(){a.getListOfStatusTypes()},a.onSessionSelect=function(b){v.getSessionWSById(b.id,function(b){a.sessionObj.code=b.code},function(a){}),v.getSessionDateById(b.id,function(b){a.sessionDate=p.convertToViewDate(b.startDate)},function(a){}),a.bookingObj.attendee=null},a.getListOfStatusTypes=function(){return j.getData(k.getUrl("FIND_ALL_EVENT_SESSION_STATUS"),null,function(b){a.statusList=b.data},function(a){})},/*Map Integration End*/
/*Init Method*/
a.init=function(){if(a.sessionObj={},a.getStatusTypes(),!l.isFieldEmpty(localStorage.getItem("EventBookingDetails"))&&"add"===c.type){var b=w.confirm().title(g.instant("EVENT_BOOKING")).textContent(g.instant("EVENT_BOOKING_WR_MSG")).ariaLabel("Lucky day").ok(g.instant("NO")).cancel(g.instant("YES"));w.show(b).then(function(){D(angular.fromJson(localStorage.getItem("EventBookingDetails")))},function(){localStorage.removeItem("EventBookingDetails"),a.hidePaymentButton=!0,a.hideSave=!1,l.isFieldEmpty(c.eventId)||n.getEventDetails(c.eventId,function(b){a.eventObj=angular.copy(b),a.eventObj.conductedBy={data:b.conductedBy}}),l.isFieldEmpty(c.sessionId)||(v.getSessionWSById(c.sessionId,function(b){a.sessionObj=angular.copy(b),a.bookingObj.eventSession=angular.copy(a.sessionObj)},function(a){}),v.getSessionDateById(c.sessionId,function(b){a.sessionDate=p.convertToViewDate(b.startDate)},function(a){}))})}"add"===c.type?(l.isFieldEmpty(localStorage.getItem("EventBookingDetails"))&&(l.isFieldEmpty(c.eventId)||n.getEventDetails(c.eventId,function(b){a.eventObj=angular.copy(b),a.eventObj.conductedBy={data:b.conductedBy}}),l.isFieldEmpty(c.sessionId)||(v.getSessionWSById(c.sessionId,function(b){a.sessionObj=angular.copy(b),a.bookingObj.eventSession=angular.copy(a.sessionObj)},function(a){}),v.getSessionDateById(c.sessionId,function(b){a.sessionDate=p.convertToViewDate(b.startDate)},function(a){}))),l.isFieldEmpty(localStorage.getItem("EventBookingDetails"))?(a.hidePaymentButton=!0,a.hideSave=!1):(a.hidePaymentButton=!1,a.hideSave=!0),a.orgLocPermission=o.SESSION_BOOKING_ADD,a.bookedDate=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.pageState="add"):"edit"===c.type?(l.isFieldEmpty(c.eventId)||n.getEventDetails(c.eventId,function(b){a.eventObj=angular.copy(b),a.eventObj.conductedBy={data:b.conductedBy}}),l.isFieldEmpty(c.sessionId)||(v.getSessionWSById(c.sessionId,function(b){a.sessionObj=angular.copy(b),a.bookingObj.eventSession=angular.copy(a.sessionObj)},function(a){}),v.getSessionDateById(c.sessionId,function(b){a.sessionDate=p.convertToViewDate(b.startDate)},function(a){})),a.orgLocPermission=o.SESSION_BOOKING_ADD,a.pageState="edit",l.isFieldEmpty(c.bookingId)?d.go("eventList"):v.getBookingById(c.bookingId,function(b){a.bookingObj=angular.copy(b),a.bookedDate=h("timestampToDate")(b.bookedDate,"MM/dd/yyyy")},function(a){})):"view"===c.type&&(l.isFieldEmpty(c.eventId)||n.getEventDetails(c.eventId,function(b){a.eventObj=angular.copy(b),a.eventObj.conductedBy={data:b.conductedBy}}),l.isFieldEmpty(c.sessionId)||(v.getSessionWSById(c.sessionId,function(b){a.sessionObj=angular.copy(b),a.bookingObj.eventSession=angular.copy(a.sessionObj)},function(a){}),v.getSessionDateById(c.sessionId,function(b){a.sessionDate=p.convertToViewDate(b.startDate)},function(a){})),a.orgLocPermission=o.SESSION_BOOKING_ADD,a.pageState="view",a.isViewMode=!0,l.isFieldEmpty(c.bookingId)?d.go("eventList"):v.getBookingById(c.bookingId,function(b){a.bookingObj=angular.copy(b),a.bookedDate=h("timestampToDate")(b.bookedDate,"MM/dd/yyyy")},function(a){}))},a.selectOrbeonForm=function(d,e,f){var g=f.conductedBy.data,h=(y("sm")||y("xs"))&&a.customFullscreen,h=y("gt-sm"),i="EVENT_BOOKING_FORM",j={};j.stateName=angular.fromJson(localStorage.getItem("manageBooking")).parentState,j.params={type:"edit",eventId:c.eventId,sessionId:c.sessionId,bookingId:e},z.getFormInstanceDetails(0,e,i,g.id,b.userSelectedLanguage.id,f.serviceType.id,function(c){c&&(l.isFieldEmpty(b.userSelectedLanguage.id)?w.show({controller:E,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:B.dialogBox.clickOutsideToClose,fullscreen:h,locals:{dialogParams:{recordId:e,orgLoc:g,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):A.loadNewFormRunner(e,i,g.id,b.userSelectedLanguage.id,j,c))},function(a){})},a.init()}]),angular.module("paripal.eventModule").controller("ManageEventCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageEventService","featurePrivilegeConstants","dateconvertor","GoogleMap","NgMap","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.WSEvent={},a.WSSessionList=[],a.currentPosition="current-location",a.disabledFormFields=!1,a.manageEventSpinner=!1,a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.eventType={queryUrl:"FIND_ALL_EVENT_TYPE",queryParameter:{}},a.city={queryUrl:"FIND_ALL_CITIES",queryParameter:{}},/* $scope.eventStatus = {
             queryUrl: "FIND_ALL_EVENT_STATUS",
             queryParameter: {}
         };*/
a.eventRestriction={queryUrl:"GET_EVENT_RESTRICTIONS",queryParameter:{}},a.currency={queryUrl:"GET_CURRENCYLIST_DATA",queryParameter:{}},/*$scope.$watch('WSEvent.complaintServiceLevel', function (newValue, oldValue) {

        });*/
/* $scope.$watchGroup(['WSEvent.numberOfSessionsInDay', 'WSEvent.numberOfSessionsInEvent'], function (newValue, oldValue) {
             if (parseInt($scope.WSEvent.numberOfSessionsInDay) > parseInt($scope.WSEvent.numberOfSessionsInEvent)) {
                 notify("error", $translate.instant("INVALID_EVENT_COUNT"));
             }
         });*/
a.onMapLoaded=function(){s(function(){r.getMap({id:"my_map"}).then(function(a){google.maps.event.trigger(a,"resize")})},500)},a.saveEventDetails=function(b){if(b.$valid){a.manageEventSpinner=!0;var e=angular.copy(a.WSEvent);e.conductedBy=e.conductedBy.data.id,e.startDate=p.convertToServerDate(e.startDate),e.endDate=p.convertToServerDate(e.endDate),e.eventStatus="UPCOMING",delete e.displayAmount,n.saveEventDetails(e,c.type,function(b){a.manageEventSpinner=!1,f("success",g.instant(b.successMessage)),d.go("eventList",c)},function(b){a.manageEventSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):"size must be between 3 and 100"==b.data.messages[0]?f("error",g.instant("EVENT_NAME_SIZE_MUST_BE_BETWEEN_3_AND_100")):f("error",g.instant(b.data.messages[0]))})}},a.getEventDetails=function(b,c){l.isNullOrEmpty(b)||(a.manageEventSpinner=!0,n.getEventDetails(b,function(b){a.manageEventSpinner=!1,a.setDataToEventForm(b)}))},a.setDataToEventForm=function(b){l.isEmpty(b)||(a.WSEvent=angular.copy(b),/*$scope.WSEvent.id = responseData.id;*/
/*$scope.WSEvent.version = responseData.version;*/
a.WSEvent.conductedBy={},a.WSEvent.conductedBy.data=b.conductedBy,a.WSEvent.startDate=p.convertToViewDate(a.WSEvent.startDate),a.WSEvent.endDate=p.convertToViewDate(a.WSEvent.endDate),a.minDateValidFrom=h("timestampToDate")(angular.copy(a.WSEvent.startDate),"MM/dd/yyyy"),a.minDateValidTill=h("timestampToDate")(angular.copy(a.WSEvent.startDate),"MM/dd/yyyy"),l.isEmpty(b.complaintType)||(a.WSEvent.complaintType=b.complaintType),l.isEmpty(b.orgLocation)||(a.WSEvent.orgLocation=b.orgLocation),l.isEmpty(b.cityName)||(a.WSEvent.city.value=b.cityName),b.dateServiceLevelSet&&(a.WSEvent.dateServiceLevelSet=h("timestampToDate")(b.dateServiceLevelSet,"MM/dd/yyyy")),l.isEmpty(b.periodType)||(a.WSEvent.periodType=b.periodType),l.isNullOrEmpty(b.complaintServiceLevel)||(a.WSEvent.complaintServiceLevel=b.complaintServiceLevel),l.isFieldEmpty(b.cityName)||(a.WSEvent.city.value=b.cityName))},/*To calculate number of sessions in event */
a.dayCaluculation=function(b,c,d){if(d){var e=864e5,f=new Date(b),g=new Date(c),h=Math.round(Math.abs((f.getTime()-g.getTime())/e));a.WSEvent.numberOfSessionsInEvent=h?(h+1)*d:d}},/* on cancel forward to search list*/
a.cancel=function(){l.goBackToPrevState()},/*Map Integration Start*/
/*$scope.currentPosition = [18.51954370906854, 73.85534405708313];*/
a.$watch("WSEvent.city",function(b){l.isFieldEmpty(b)&&(a.WSEvent.heldAt=""),b&&(a.currentPosition=b.value)}),a.$watch("WSEvent.heldAt",function(b){b&&(a.currentPosition=b)}),a.getPosition=function(b){if(!a.disabledFormFields&&(a.currentPosition=q.getCoordinates(b),!l.isFieldEmpty(b))){/*$scope.WSEvent.googleMapLink = "http://maps.google.com/?ll=" + event.latLng.lat() + "," + event.latLng.lng();*/
var c=new google.maps.Geocoder;c.geocode({latLng:b.latLng},function(b,c){if(c==google.maps.GeocoderStatus.OK)if(b[1]){var d=b[1].formatted_address;a.WSEvent.heldAt=angular.copy(d),angular.forEach(b[1].address_components,function(b,c){c>=0&&"administrative_area_level_2"==b.types[0]&&(a.zoom=12,a.WSEvent.city=angular.copy({id:1,value:b.long_name}),s(function(){angular.element(document.getElementById("clickHere")).trigger("click")},0))})}else console.log("Location not found");else console.log("Geocoder failed due to: "+c)})}},/*Map Integration End*/
a.getStatusTypes=function(){a.getListOfStatusTypes()},a.getListOfStatusTypes=function(){return j.getData(k.getUrl("FIND_ALL_EVENT_SESSION_STATUS"),null,function(b){a.statusList=b.data},function(a){})},/*To get Organization address as event address by default*/
a.getOrgAddress=function(b){n.getOrganizationAddress(b,function(b){a.currentPosition=[b.addressLattitudes,b.addressLongitudes],a.WSEvent.heldAt=(b.addressLine1?b.addressLine1:"")+(b.addressLine2?b.addressLine2:"")+(b.addressLine3?b.addressLine3:""),a.WSEvent.city=b.city},function(a){})},/*Init Method*/
a.init=function(){if(a.getStatusTypes(),"add"===c.type){a.WSEvent.eventStatus="UPCOMING",a.orgLocPermission=o.EVENT_ADD,a.minDateValidFrom=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.minDateValidTill=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.pageState="add";var b=i.getDefaultOrgLocation();l.isFieldEmpty(b)||(a.WSEvent.conductedBy={},a.WSEvent.conductedBy.data={},a.WSEvent.conductedBy.data={id:b.orgLoc.id,value:b.orgLoc.value},a.getOrgAddress(a.WSEvent.conductedBy.data.id))}else"edit"===c.type?(a.orgLocPermission=o.EVENT_EDIT,a.pageState="edit",a.disabledFormFields=!1,a.getEventDetails(c.eventId,c.type),a.minDateValidFrom=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.minDateValidTill=h("timestampToDate")(new Date,"MM/dd/yyyy")):"view"===c.type&&(a.orgLocPermission=o.EVENT_VIEW,a.pageState="view",a.disabledFormFields=!0,a.getEventDetails(c.eventId,c.type),a.minDateValidFrom=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.minDateValidTill=h("timestampToDate")(new Date,"MM/dd/yyyy"))},a.init()}]),angular.module("paripal.eventModule").controller("ManageSessionCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageSessionService","sessionListService","featurePrivilegeConstants","GoogleMap","NgMap","datatableconfig","$timeout","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";a.WSEvent={},a.WSSessionList=[],a.WSEventSession={},a.disabledFormFields=!1,a.unEditable=!1,a.sessionRestrictionList=[],a.sessionSatusList=[],a.sessionFormSpinner=!1;var v;/* $scope.conductedBy = {
             queryUrl: "GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",
             queryParameter: {
                 orgId: 0
             }
         };*/
a.eventType={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"eventType"}},/*$scope.eventName = {
            queryUrl: "SEARCH_EVENT_BY_EVENT_NAME",
            queryParameter: {}
        };*/
a.eventRestriction={queryUrl:"GET_SESSION_RESTRICTION",queryParameter:{}},a.city={queryUrl:"FIND_ALL_CITIES",queryParameter:{}},/*$scope.$watch('WSEvent.complaintServiceLevel', function (newValue, oldValue) {

        });*/
a.onMapLoaded=function(){t(function(){r.getMap({id:"my_map"}).then(function(a){google.maps.event.trigger(a,"resize")})},500)};var w=function(a){var b=new Date;return b.setHours(a.substring(0,2)),b.setMinutes(a.substring(3,5)),b};a.saveSession=function(b){b.$valid&&(a.sessionFormSpinner=!0,delete a.WSEventSession.eventSessionProfessional,delete a.WSEventSession.displayAmount,delete a.WSEventSession.transactionId,n.saveEventDetails(a.WSEventSession,c.type,function(b){a.sessionFormSpinner=!1,b.response?v=b.response:v,v&&(angular.element(document.getElementById("nextTab")).trigger("click"),x()),f("success",g.instant(b.successMessage)),c=i.getStateParamsFromLocalStarage(c,"eventList"),!l.isEmpty(c)},function(b){a.sessionFormSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):"size must be between 3 and 100"==b.data.messages[0]?f("error",g.instant("SESSION_NAME_SIZE_MUST_BE_BETWEEN_3_AND_100")):f("error",g.instant(b.data.messages[0]))}))},a.getSessionDetails=function(b,c){l.isFieldEmpty(b)||(a.sessionFormSpinner=!0,n.getSessionDetails(b,function(b){a.sessionFormSpinner=!1,a.setDataToServiceLevelForm(b)},function(a){}))},a.setDataToServiceLevelForm=function(b){l.isFieldEmpty(b)||(a.WSEventSession=b,l.isFieldEmpty(a.WSEventSession.startDate)||(a.WSEventSession.startDate=h("timestampToDate")(b.startDate,"MM/dd/yyyy")),l.isFieldEmpty(a.WSEventSession.endDate)||(a.WSEventSession.endDate=h("timestampToDate")(b.endDate,"MM/dd/yyyy")),l.isFieldEmpty(b.startsAt)||(a.WSEventSession.startsAt=w(b.startsAt)),l.isFieldEmpty(b.endsAt)||(a.WSEventSession.endsAt=w(b.endsAt)),l.isFieldEmpty(b.cityName)||(a.WSEventSession.city.value=b.cityName)),v=c.sessionId,x()},
// on cancel forward to search list
a.cancel=function(){c=i.getStateParamsFromLocalStarage(c,"eventList"),l.goBackToPrevState()},/*Map Integration Start*/
a.currentPosition=[18.51954370906854,73.85534405708313],a.$watch("WSEventSession.city",function(b){b&&(a.currentPosition=b.value)}),a.$watch("WSEventSession.heldAt",function(b){b&&(a.currentPosition=b)}),a.getPosition=function(b){if(!a.disabledFormFields&&(a.currentPosition=q.getCoordinates(b),!l.isFieldEmpty(b))){/* $scope.WSEventSession.googleMapLink = "http://maps.google.com/?ll=" + event.latLng.lat() + "," + event.latLng.lng();*/
var c=new google.maps.Geocoder;c.geocode({latLng:b.latLng},function(b,c){c==google.maps.GeocoderStatus.OK?b[1]?angular.forEach(b[1].address_components,function(c,d){d>=0&&"administrative_area_level_2"==c.types[0]&&(a.zoom=15,a.WSEventSession.city=angular.copy({id:1,value:c.long_name}),a.WSEventSession.heldAt=b[1].formatted_address,t(function(){angular.element(document.getElementById("clickHere")).trigger("click")},0))}):console.log("Location not found"):console.log("Geocoder failed due to: "+c)})}},/*Map Integration End*/
/*Linked Professional code -- start*/
a.userType=[{value:"ORGANIZATION_USER",url:"GET_ORG_USER_BY_ORG_LOC_ID_USER_NAME"},{value:"PARIPAL_USER",url:"GET_ALL_PARIPAL_USERS"},{value:"OTHER_USER",url:null}],a.linkUser=function(b,d,e){l.isFieldEmpty(d)||n.linkProfessional(c.orgLocId,v,b,d,e,function(b){f("success",g.instant(b.successMessage)),x(),a.linkProfObj={}},function(a){f("error",g.instant(a.errorCode))})},a.unLinkUser=function(a){n.unLinkProfessional(a,function(a){f("success",g.instant(a.successMessage)),x()})},a.getProfessionalUsers=function(a,b){if(!l.isFieldEmpty(b)){var c={};return c.userName=a,n.getProfessionals(c,b,function(a){return angular.forEach(a,function(a,b){a.displayName=a.value?a.value:a.displayName}),a})}};var x=function(){a.professionalListSpinner=!0;var b={eventSessionId:v};n.searchProfessionals(b,function(b){a.professionalListSpinner=!1,a.profList=b}),a.professionalListSpinner=!1},y={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=s.setOptionProperties(y),a.dtColumnDefs=s.setColumnProperties({}),/*Linked Professional code -- end*/
/*Init Method*/
a.init=function(){a.step1Css="btn btn-primary btn-circle",l.isFieldEmpty(c.sessionId)||(a.WSEventSession.sessionId=c.sessionId,v=c.sessionId),/* Get session Status list onload*/
o.getStatuslist(function(b){a.sessionSatusList=b},function(a){}),/* Get Session Restriction List onload*/
o.getRestrictionlist(function(b){a.sessionRestrictionList=b},function(a){}),"add"===c.type?(a.orgLocPermission=p.COMPLAINT_SRVCLVL_ADD,a.WSEventSession.eventSessionStatus="UPCOMING",a.pageState="add",l.isFieldEmpty(c.data)||(a.WSEventSession.city=c.data.city,a.WSEventSession.heldAt=c.data.heldAt),/* Get Event Name onload*/
n.getEventById(c.eventId,function(b){a.WSEventSession.event=b},function(a){})):"view"===c.type?(a.orgLocPermission=p.COMPLAINT_SRVCLVL_VIEW,a.pageState="view",a.disabledFormFields=!0,a.getSessionDetails(c,c.type)):"edit"===c.type&&(a.orgLocPermission=p.COMPLAINT_SRVCLVL_EDIT,a.pageState="edit",a.unEditable=!0,a.getSessionDetails(c,c.type)),/* Get Event Detail onload by eventId*/
o.getEventData(c.eventId,function(b){a.eventDetail=b,a.WSEventSession.whetherFeeApplicable=b.whetherFeeApplicable,a.minDateValidFrom=u.convertToViewDate(b.startDate),a.maxDateValidFrom=u.convertToViewDate(b.endDate)},function(a){})},a.init()}]),angular.module("paripal.eventModule").controller("MyBookingCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","serverSidePagination","utilService","sessionListService","bookingService","featurePrivilegeConstants","$mdDialog","$translate","dateconvertor","notify","EmergencyTransactionService","docMgntService","orbeonFormRunner","$mdMedia","commonConstants","baseService","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(a){var b=Date.parse(a);return b/1e3}/* controller for MarkAttendancePopup */
function w(a,b,c,d,e,f,g,h){a.ShowRating=!0,a.isReadonly=!1,a.viewMode=!1,a.hide=function(){g.hide()},a.cancel=function(){g.cancel()};/*Maz and min time functionality*/
var j=function(b,c){var d=h("serverTimeToTimePicker")(f.data.eventSession.startsAt),g=h("serverTimeToTimePicker")(f.data.eventSession.endsAt.substring(0,2)+":"+f.data.eventSession.endsAt.substring(3,5)+":60");return b.getTime()>=d.getTime()&&b.getTime()<=g.getTime()&&c.getTime()>=d.getTime()&&c<=g.getTime()||(e("error","Time is invalid! please enter time between "+h("time24to12Hour")(f.data.eventSession.startsAt)+" to "+h("time24to12Hour")(f.data.eventSession.endsAt)),a.markAttendanceObj.timeIn="",a.markAttendanceObj.timeOut="",!1)};/* To add mark attendance */
a.addMarkAttendance=function(a){j(a.timeIn,a.timeOut)&&i.saveMarkAttendance(a,f.data.eventSession.event.conductedBy,function(a){e("success",l.instant(a.successMessage)),g.hide()},function(a){})};var k=function(){b.isFieldEmpty(f.data)||(b.isFieldEmpty(f.data.id)||(a.markAttendanceObj={id:f.data.id}),f.data.whetherAttended&&(a.viewMode=f.data.whetherAttended,a.markAttendanceObj.whetherAttended=f.data.whetherAttended,a.markAttendanceObj.rating=f.data.rating,a.markAttendanceObj.timeIn=h("serverTimeToTimePicker")(f.data.timeIn),a.markAttendanceObj.timeOut=h("serverTimeToTimePicker")(f.data.timeOut)))};k()}w.$inject=["$scope","utilService","httpService","urlService","notify","stateParams","$mdDialog","$filter"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.eventListSpinner=!1,a.WSEventList=[];var x=null,y=null;x={headers:{orgLocPermission:y}},a.eventName={queryUrl:"SEARCH_EVENT_BY_EVENT_NAME",queryParameter:{}},/* Get session name as per event id*/
a.getSessionName=function(b){var d={};d.eventId=c.eventId,d.searchKeyword=b;var e=[];return h.getSessionName(d,function(a){return e=a},function(a){},a.orgLocPermission)},a.searchMyBooking=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.eventListSpinner=!0;var b={};b=angular.copy(a.searchCriteria),g.isFieldEmpty(b.eventName)||(b.eventName=b.eventName.value),i.searchMyBooking(b,x,function(b){a.eventListSpinner=!1,angular.forEach(b.data,function(a,b){var c=z(a.eventSession.endDate,a.eventSession.endsAt),d=v(new Date);c<d&&(a.eventSession.eventSessionStatus="COMPLETED")}),a.MyBookingList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.eventListSpinner=!1})};var z=function(a,b){var c=new Date(a);if(g.isFieldEmpty(b))return null;var d=b.split(":");return c.setHours(d[0]),c.setMinutes(d[1]),c.setSeconds(d[2]),v(c)};a.viewSessionDetails=function(a){d.go("showSessionDetails",{eventId:a.eventSession.event.id,sessionId:a.eventSession.id})},a.manageFeedback=function(c,d){var e=d.eventSession.event.conductedBy,f=(r("sm")||r("xs"))&&a.customFullscreen,f=r("gt-sm"),h="EVENT_REVIEW_FORM",i={};i.stateName="myBookings",i.params={eventId:d.eventSession.event.id},p.getFormInstanceDetails(0,d.id,h,e,b.userSelectedLanguage.id,d.eventSession.event.serviceType.id,function(j){j&&(g.isFieldEmpty(b.userSelectedLanguage.id)?k.show({controller:feedbackDailogCtrl,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:s.dialogBox.clickOutsideToClose,fullscreen:f,locals:{dialogParams:{recordId:d.id,orgLoc:e,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):q.loadNewFormRunner(d.id,h,e,b.userSelectedLanguage.id,i,j))},function(a){})},a.viewBookingCounts=function(a){d.go("showsessionbooking",{eventId:a?a.eventSession.event.id:null,sessionId:a?a.eventSession.id:null})},/*redirect to  mark attendance */
a.manageMarkAttendance=function(b,c){k.show({scope:a,preserveScope:!0,controller:w,templateUrl:"app/modules/events/views/mark-attendance-popup.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:s.dialogBox.clickOutsideToClose,locals:{stateParams:{data:b}}}).then(function(){a.searchMyBooking()},function(){})},/*Make payment functionality*/
a.paymentCall=function(a){i.isBookingCapacity(a.eventSession.id,function(b){if(b){var c={};if(a.transaction.id){var c={transactionId:a.transaction.id},e={};e.BILL_FOR="EVENT",e.CALLER_SCREEN="MY_BOOKING",e.EVENT_NAME=a.eventSession.event.eventName,e.SESSION_NAME=a.eventSession.sessionName,e.BOOKING_DATE=m.convertToViewDate(new Date),localStorage.setItem("BillDetails",angular.toJson(e));o.getWhetherBillDetails(c,function(b){d.go("billsummaryview",{transactionId:a.transaction.id})},function(a){var b=k.confirm().title(l.instant("EVENT_FEE_TYPE_ERROR")).textContent(l.instant("EVENT_FEE_TYPE_NOT_FOUND")).ok(l.instant("OK")).cancel(l.instant("CANCEL"));k.show(b).then(function(){},function(){d.go("myBookings")})},{handleError:!1})}}},function(a){})},/*Booking cancel functionality*/
a.cancelBooking=function(b){var c={};c.id=b.id,c.cancelledOn=m.convertToServerDate(new Date),i.cancelBooking(c,b.eventSession.event.conductedBy,function(b){n("success",l.instant(b.data.successMessage)),a.searchMyBooking()},function(a){})},a.pageChanged=function(){a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems),a.searchMyBooking()},/*clear button function*/
a.clear=function(){a.searchCriteria={},a.searchMyBooking()},/*set page record*/
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchMyBooking()};/*datatble config json*/
var A={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(A),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.statusList=["UPCOMING","COMPLETED","CANCELLED"],a.searchMyBooking()},a.selectOrbeonForm=function(c,d,e){var f=e.eventSession.event.conductedBy,h=(r("sm")||r("xs"))&&a.customFullscreen,h=r("gt-sm"),i="EVENT_BOOKING_FORM",j={};j.stateName="myBookings",j.params={type:"edit",eventId:e.eventSession.event.id,sessionId:e.eventSession.id,bookingId:d},p.getFormInstanceDetails(0,d,i,f,b.userSelectedLanguage.id,e.eventSession.event.serviceType.id,function(e){e&&(g.isFieldEmpty(b.userSelectedLanguage.id)?k.show({controller:dailogCtrl,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:s.dialogBox.clickOutsideToClose,fullscreen:h,locals:{dialogParams:{recordId:d,orgLocId:f,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):q.loadNewFormRunner(d,i,f,b.userSelectedLanguage.id,j,e))},function(a){})},a.init()}]),angular.module("paripal.eventModule").controller("MyEventsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageEventService","featurePrivilegeConstants","dateconvertor","eventListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.buttonCount=1,a.getButtonCount=function(){return new Array(a.buttonCount)},a.getEventRecords=function(b){a.pageNumber=b,a.searchEvents()};var r={headers:{orgLocPermission:o.MY_EVENT_VIEW}};a.getEventRecords=function(b){a.pageNumber=b,a.searchEvents(),a.selected=b},a.isActive=function(b){return a.selected===b},a.searchEvents=function(){a.eventListSpinner=!0;var b="GET_EVENT_SESSION_BOOKING_DETILS",c={pageNumber:a.pageNumber,recordsPerPage:12};q.searchEvents(c,b,r,function(b){a.eventListSpinner=!1,a.WSEventList=b.data,l.isFieldEmpty(a.WSEventList)||angular.forEach(a.WSEventList[0].eventDTOs,function(b,c){angular.forEach(a.WSEventList[0].eventAvgViewFeedbackDTOs,function(a,c){b.id==a.eventId&&(a.avgRating?b.avgRating=a.avgRating:b.avgRating=0)})}),a.buttonCount=b.totalPages},function(b){a.eventListSpinner=!1})},a.viewEventDetails=function(a){d.go("showeventdetails",{eventId:a.id})},a.viewBookings=function(a){d.go("showeventbooking",{eventId:a.id})},a.viewLinkedProfessionals=function(a){d.go("showLinkedProfessionals",{eventId:a.id})},a.viewSessionals=function(a){d.go("showSessions",{eventId:a.id})},a.Init=function(){a.pageNumber=1,a.searchEvents()},a.Init()}]),angular.module("paripal.eventModule").controller("SessionListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","sessionListService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.eventListSpinner=!1,a.WSSessionList=[],a.sessionSatusList=[],a.orgLocPermission=o.EVENT_SESSION_VIEW;var p={headers:{orgLocPermission:a.orgLocPermission}};a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.setSearchAPI=function(b){a.api=b},/* Get session name as per event id*/
a.getSessionName=function(b){var d={};d.eventId=c.eventId,d.searchKeyword=b;var e=[];return n.getSessionName(d,function(a){return e=a},function(a){},a.orgLocPermission)},a.searchSessions=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.eventListSpinner=!0,n.searchSessions(a.searchCriteria,p,function(b){a.eventListSpinner=!1,a.WSSessionList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.eventListSpinner=!1},a.api)},a.clear=function(){a.searchCriteria={},a.searchCriteria.eventId=c.eventId,a.searchSessions()},a.manageSessions=function(b,e){var f={type:e,eventId:c.eventId,sessionId:b?b.id:null,orgLocId:a.eventDetail.conductedBy.id,data:{city:b.city,heldAt:b.heldAt}};d.go("manageSessions",f)},a.inactiveSessionEvent=function(b,c,d){var e=g.confirm().title(h.instant("WARNING")).textContent(h.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(b).ok(h.instant("OK")).cancel(h.instant("CANCEL"));g.show(e).then(function(){n.inactiveEventSession(c,d,function(b){f("success",h.instant(b.successMessage)),a.searchSessions()},function(a){})},function(){})},a.viewBokingDetails=function(a,b){d.go("viewBookingDetails",{sessionId:a?a:null,eventId:b?b:null})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchSessions()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchSessions()};
//datatble config json
var q={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(q),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.setSearchAPI("SEARCH_SESSION_LIST"),m.isFieldEmpty(c.eventId)?d.go("eventList"):(a.searchCriteria.eventId=c.eventId,/*   $scope.eventDetail = $stateParams.data;*/
/* Get Event Detail onload by eventId*/
n.getEventData(c.eventId,function(b){a.eventDetail=b},function(a){}),a.searchSessions()),/* Get session Status list onload*/
n.getStatuslist(function(b){a.sessionSatusList=b},function(a){})},a.init()}]),angular.module("paripal.eventModule").controller("ShowEventBookingCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","utilService","manageEventService","bookingService","featurePrivilegeConstants","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.eventDetails={},a.orgLocPermission=l.EVENT_SESSION_VIEW;({headers:{orgLocPermission:a.orgLocPermission}});a.getEventDetails=function(b){i.isNullOrEmpty(b)||(a.manageEventSpinner=!0,j.getEventDetails(b,function(b){a.manageEventSpinner=!1,a.eventObj=b},function(b){a.manageEventSpinner=!1}),a.manageEventSpinner=!1)},a.viewEventDetails=function(a){d.go("showeventdetails",{eventId:a.id})},a.viewLinkedProfessionals=function(a){d.go("showLinkedProfessionals",{eventId:a.id})},a.viewSessionDetails=function(a){d.go("showSessions",{eventId:a.id})},a.getEventsAvgRating=function(b){j.getEventAvgRatings(b,function(b){a.ratings=b.avgRating,a.noOfRating=b.noOfRating},function(a){})},/*$scope.ratingSelected = function () {};*/
a.Init=function(){i.isFieldEmpty(c.eventId)||(a.getEventDetails(c.eventId),a.getEventsAvgRating(c.eventId),/*get event details like total capacity and total booking*/
k.getEventTotalCapacityAndBooking(c.eventId,function(b){a.eventDetails=b},function(a){}))},a.Init()}]),angular.module("paripal.eventModule").controller("ShowEventDetailCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","utilService","manageEventService","featurePrivilegeConstants","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.orgLocPermission=k.EVENT_SESSION_VIEW;({headers:{orgLocPermission:a.orgLocPermission}});a.viewSessionDetails=function(a){d.go("showSessions",{eventId:a.id})},a.viewEventBooking=function(a){d.go("showeventbooking",{eventId:a.id})},a.viewLinkedProfessionals=function(a){d.go("showLinkedProfessionals",{eventId:a.id})},a.getEventDetails=function(b){i.isNullOrEmpty(b)||(a.manageEventSpinner=!0,j.getEventDetails(b,function(b){a.manageEventSpinner=!1,a.eventObj=b},function(b){a.manageEventSpinner=!1}),a.manageEventSpinner=!1)},a.getEventsAvgRating=function(b){j.getEventAvgRatings(b,function(b){a.ratings=b.avgRating,a.noOfRating=b.noOfRating},function(a){})},a.Init=function(){i.isFieldEmpty(c.eventId)||(a.getEventDetails(c.eventId),a.getEventsAvgRating(c.eventId))},a.Init()}]),angular.module("paripal.eventModule").controller("ShowEventsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageEventService","featurePrivilegeConstants","dateconvertor","eventListService","$timeout","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.buttonCount=1,a.searchCriteria={},a.getButtonCount=function(){return new Array(a.buttonCount)},a.getEventRecords=function(b){a.pageNumber=b,a.searchEvents(),a.selected=b},a.isActive=function(b){return a.selected===b},a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.searchEvents=function(){a.eventListSpinner=!0;var b="GET_EVENT_FOR_INDIVIDUAL",c={pageNumber:a.pageNumber,recordsPerPage:12,eventStatus:"UPCOMING"};l.isFieldEmpty(a.searchCriteria.conductedBy)||(c.conductedBy={},c.conductedBy=a.searchCriteria.conductedBy.data),l.isFieldEmpty(a.searchCriteria.searchText)||(c.searchKeyword=a.searchCriteria.searchText),l.isFieldEmpty(a.searchCriteria.startDate)||(c.startDate=a.searchCriteria.startDate),/*searchObj.eventStatus = "UPCOMING";*/
q.searchEvents(c,b,a.postHeader,function(b){a.eventListSpinner=!1,a.WSEventList=b.data,l.isFieldEmpty(a.WSEventList)||angular.forEach(a.WSEventList[0].eventDTOs,function(b,c){angular.forEach(a.WSEventList[0].eventAvgViewFeedbackDTOs,function(a,c){b.id==a.eventId&&(a.avgRating?b.avgRating=a.avgRating:b.avgRating=0,b.noOfRating=a.noOfRating,b.whetherSessionBooked=a.whetherSessionBooked)})}),a.buttonCount=b.totalPages},function(b){a.eventListSpinner=!1})},a.viewEventDetails=function(a){d.go("showeventdetails",{eventId:a.id})},a.viewBookings=function(a){d.go("showeventbooking",{eventId:a.id})},a.viewLinkedProfessionals=function(a){d.go("showLinkedProfessionals",{eventId:a.id})},a.viewSessionals=function(a){d.go("showSessions",{eventId:a.id})},a.Init=function(){a.pageNumber=1,a.searchEvents(),a.isActive(1),a.selected=1},a.Init()}]),angular.module("paripal.eventModule").controller("ShowLinkedProfessionalsCtrl",["datatableconfig","serverSidePagination","$state","utilService","$scope","$filter","httpService","urlService","$compile","$timeout","$mdDialog","$mdMedia","$rootScope","commonConstants","dateconvertor","$stateParams","featurePrivilegeConstants","userStatusService","notify","$translate","manageEventService","sessionListService","bookingService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";e.orgLocPermission=q.EVENT_SESSION_VIEW;({headers:{orgLocPermission:e.orgLocPermission}});e.viewEventDetails=function(a){c.go("showeventdetails",{eventId:a.id})},e.searchLinkedProfessionals=function(a){u.getLinkedProfessionals(a,function(a){e.WSLinkedProfessionalList=angular.copy(a),e.TempProfessionalsList=[],angular.forEach(e.WSLinkedProfessionalList,function(a,b){if(a.logoDocumentId){var c=new Object;c.fileName=a.logoFileName,c.resourceId=value1.logoDocumentId,c.docType=n.documentTypes.userIdDocument,c.docSubType=n.documentSubTypes.profilePhoto,c.userId=a.id,c.isCompressedVersion=!0,fileOperations.getImageUrl(c,function(b){a.logoUrl=b},function(){})}else a.logoUrl="app/images/user.jpg"})},function(a){})},e.getEventDetails=function(a,b){d.isNullOrEmpty(a)||(e.manageEventSpinner=!0,u.getEventDetails(a,function(a){e.manageEventSpinner=!1,e.eventObj=a,e.eventObj.avgRating=angular.copy(e.avgRating)}))},e.getEventsAvgRating=function(a){u.getEventAvgRatings(a,function(a){e.avgRating=a.avgRating,e.noOfRating=a.noOfRating},function(a){})},e.Init=function(){d.isFieldEmpty(p.eventId)?c.go("showEvents"):(e.getEventDetails(p.eventId),e.getEventsAvgRating(p.eventId),e.searchLinkedProfessionals(p.eventId))},e.Init()}]),angular.module("paripal.eventModule").controller("ShowSessionBookingCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","utilService","manageSessionService","bookingService","sessionListService","featurePrivilegeConstants","dateconvertor","$mdDialog","$mdMedia","manageEventService","EmergencyTransactionService","docMgntService","orbeonFormRunner","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(a){var b=Date.parse(a);return b/1e3}/* controller for Book Session */
function w(a,d,e,h,j){a.hide=function(){h.hide()},a.cancel=function(){h.cancel()},a.bookedSessionList.indexOf(e.data.sessionObj.id)==-1?a.hideSave=!1:a.hideSave=!0,a.hidePaymentButton=!0,a.showObj=e.data;var l={id:e.data.sessionObj.id,value:e.data.sessionObj.sessionName},m={id:angular.fromJson(localStorage.getItem("loggedInUser")).id,displayName:angular.fromJson(localStorage.getItem("loggedInUser")).displayName},o=n.convertToServerDate(new Date),q={eventSession:l,attendee:m,bookedDate:o};a.bookEvent=function(b){a.manageEventSpinner=!0,e.data.sessionObj.whetherFeeApplicable?q.boookingStatus="PENDING":q.boookingStatus="CONFIRMED",k.saveBookingDetails(q,e.data.eventObj.conductedBy.id,"add",function(c){var h=q;h.eventInfo=e.data.eventObj,h.sessionCode=e.data.sessionObj.sessionCode,h.transactionId=angular.fromJson(c).response.transactionId,localStorage.setItem("EventBookingDetails",angular.toJson(h));var i={};i.BILL_FOR="EVENT",i.EVENT_NAME=h.eventInfo.eventName,i.SESSION_NAME=h.eventSession.value,i.BOOKING_DATE=n.convertToViewDate(h.bookedDate),localStorage.setItem("BillDetails",angular.toJson(i)),a.manageEventSpinner=!1,f("success",g.instant(c.successMessage)),1==e.data.sessionObj.whetherFeeApplicable?a.hidePaymentButton=!1:d.reload(),a.isViewMode=!0,a.selectOrbeonForm(b,angular.fromJson(c).response.id,a.eventObj.conductedBy,e.data.eventObj,e.data.sessionObj.whetherFeeApplicable)},function(b){a.manageEventSpinner=!1,i.isEmpty(b.data)||i.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))})},a.paymentCall=function(){k.isBookingCapacity(e.data.sessionObj.id,function(a){if(a){var b={};if(angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId){var b={transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId};j.getWhetherBillDetails(b,function(a){d.go("billsummaryview",{transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId})},function(a){var b=h.confirm().title(g.instant("FEE_TYPE_ERROR")).textContent(g.instant("FEE_TYPE_NOT_FOUND")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(b).then(function(){},function(){})},{handleError:!1})}}},function(a){})},a.selectOrbeonForm=function(d,e,f,g,j){var k=(p("sm")||p("xs"))&&a.customFullscreen,k=p("gt-sm"),l="EVENT_BOOKING_FORM",m={};m.stateName="showSessions",m.params={type:"edit",eventId:c.eventId},s.getFormInstanceDetails(0,e,l,f.id,b.userSelectedLanguage.id,g.serviceType.id,function(c){c&&(i.isFieldEmpty(b.userSelectedLanguage.id)?h.show({controller:dailogCtrl,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:u.dialogBox.clickOutsideToClose,fullscreen:k,locals:{dialogParams:{recordId:e,orgLoc:f,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):t.loadNewFormRunner(e,l,f.id,b.userSelectedLanguage.id,m,c))},function(b){j&&a.paymentCall()},{handleError:!1})}}w.$inject=["$scope","$state","stateParams","$mdDialog","EmergencyTransactionService"],a.eventDetails={};var x=[],y=!i.isFieldEmpty(localStorage.isLoggedIn)&&"false"!=localStorage.isLoggedIn;a.orgLocPermission=m.EVENT_SESSION_VIEW;var z={headers:{orgLocPermission:a.orgLocPermission}};a.getSessionDetails=function(b){i.isNullOrEmpty(b)||(a.manageEventSpinner=!0,j.getSessionDetails(b,function(b){a.manageEventSpinner=!1,a.sessionObj=b},function(b){a.manageEventSpinner=!1}),a.manageEventSpinner=!1)},a.viewSessionDetails=function(a){d.go("showSessionDetails",{eventId:a.event.id,sessionId:a.id})},a.viewSessions=function(){d.go("showSessions",{eventId:c.eventId})},a.viewEventDetails=function(){d.go("showeventdetails",{eventId:c.eventId})},a.boookingStatus=function(a){var b=x.filter(function(b){return b.eventSessionId==a});return i.isFieldEmpty(b)?"Nope":b[0].boookingStatus};var A=function(a,b){var c=new Date(a);if(i.isFieldEmpty(b))return null;var d=b.split(":");return c.setHours(d[0]),c.setMinutes(d[1]),c.setSeconds(d[2]),v(c)};a.isBookingAvailable=function(a){var b=x.filter(function(b){return b.eventSessionId==a.id});if(b.length>0){var c=a.capacity-b[0].noOfBookings;return c>0}return!0},a.displaySmilyStyle=function(b){return"I_BOOKED_THIS"!=a.getButtonText(b)||a.isBookingAvailable(b)?"":"fa fa-smile-o"},a.getButtonStyle=function(b){var c=a.getButtonText(b);return"BOOKING_NOT_CONFIRM_PLEASE_DO_PAYMENT"==c||"SESSION_CANCELED"==c||"SESSION_COMPLETED"==c||"BOOKING_IS_FULL"==c?"completed-event":y?"I_BOOKED_THIS"==c?"booked-event":"available-event":"md-raised md-raised-login md-warn md-button md-ink-ripple"},a.getButtonText=function(b){if(b){if("CANCELLED"==b.eventSessionStatus)return"SESSION_CANCELED";var c=A(b.endDate,b.endsAt),d=(A(b.endDate,b.startsAt),v(new Date));return c<d?"SESSION_COMPLETED":"PENDING"==a.boookingStatus(b.id)?"BOOKING_NOT_CONFIRM_PLEASE_DO_PAYMENT":"CONFIRMED"==a.boookingStatus(b.id)?"I_BOOKED_THIS":y?a.isBookingAvailable(b)?"BOOK_NOW":"BOOKING_IS_FULL":"SIGN_UP_OR_SIGN_IN"}},a.getListOfBookedSessions=function(){k.getBookedSessions(c.eventId,function(b){angular.forEach(b,function(b,c){a.bookedSessionList.push(b.eventSessionId)})},function(a){})},a.Init=function(){i.isFieldEmpty(c.sessionId)||(a.bookedSessionList=[],a.getListOfBookedSessions(),a.getSessionDetails(c),B(c.eventId),/*get event details like total capacity and total booking*/
k.getSessionTotalCapacityAndBooking(c.sessionId,function(b){a.sessionDetails=b},function(a){}),a.searchdata={sessionId:c.sessionId,eventId:c.eventId},l.searchSessions(a.searchdata,z,function(b){i.isFieldEmpty(b.data[0].avgViewFeedbackDTOs[0])||(x=b.data[0].avgViewFeedbackDTOs,a.ratings=b.data[0].avgViewFeedbackDTOs[0].avgRating,a.noOfRating=b.data[0].avgViewFeedbackDTOs[0].noOfRating)},function(a){},"SEARCH_SESSION_LIST"))};/*get event detail by event id*/
var B=function(b){i.isNullOrEmpty(b)||q.getEventDetails(b,function(b){a.eventObj=b},function(a){f("error",g.instant("ERROR"))})};a.bookThisSession=function(b,c,e){y?o.show({scope:a,preserveScope:!0,controller:w,templateUrl:"app/modules/events/views/book-session-popup.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:u.dialogBox.clickOutsideToClose,locals:{stateParams:{data:{sessionName:c.sessionName,eventName:b.eventName,sessionObj:c,eventObj:b}}}}).then(function(){},function(){}):d.go("login")},a.Init()}]),angular.module("paripal.eventModule").controller("ShowSessionDetailsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageEventService","featurePrivilegeConstants","dateconvertor","sessionListService","manageSessionService","bookingService","$mdDialog","$mdMedia","EmergencyTransactionService","docMgntService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";function y(a){var b=Date.parse(a);return b/1e3}function y(a){var b=Date.parse(a);return b/1e3}/* controller for booking */
function z(a,d,e,h,i){a.hide=function(){h.hide()},a.cancel=function(){h.cancel()},a.bookedSessionList.indexOf(e.data.sessionObj.id)==-1?a.hideSave=!1:a.hideSave=!0,a.hidePaymentButton=!0,a.showObj=e.data;var j={id:e.data.sessionObj.id,value:e.data.sessionObj.sessionName},k={id:angular.fromJson(localStorage.getItem("loggedInUser")).id,displayName:angular.fromJson(localStorage.getItem("loggedInUser")).displayName},m=p.convertToServerDate(new Date),n={eventSession:j,attendee:k,bookedDate:m};a.bookEvent=function(b){a.manageEventSpinner=!0,e.data.sessionObj.whetherFeeApplicable?n.boookingStatus="PENDING":n.boookingStatus="CONFIRMED",s.saveBookingDetails(n,e.data.eventObj.conductedBy.id,"add",function(c){var h=n;h.eventInfo=e.data.eventObj,h.sessionCode=e.data.sessionObj.sessionCode,h.transactionId=angular.fromJson(c).response.transactionId,localStorage.setItem("EventBookingDetails",angular.toJson(h));var i={};i.BILL_FOR="EVENT",i.EVENT_NAME=h.eventInfo.eventName,i.SESSION_NAME=h.eventSession.value,i.BOOKING_DATE=p.convertToViewDate(h.bookedDate),localStorage.setItem("BillDetails",angular.toJson(i)),a.manageEventSpinner=!1,f("success",g.instant(c.successMessage)),1==e.data.sessionObj.whetherFeeApplicable?a.hidePaymentButton=!1:d.reload(),a.isViewMode=!0,a.selectOrbeonForm(b,angular.fromJson(c).response.id,a.eventObj.conductedBy,e.data.eventObj,e.data.sessionObj.whetherFeeApplicable)},function(b){a.manageEventSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))})},a.paymentCall=function(){s.isBookingCapacity(e.data.sessionObj.id,function(a){if(a){var b={};if(angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId){var b={transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId};i.getWhetherBillDetails(b,function(a){d.go("billsummaryview",{transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId})},function(a){var b=h.confirm().title(g.instant("FEE_TYPE_ERROR")).textContent(g.instant("FEE_TYPE_NOT_FOUND")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(b).then(function(){},function(){})})}}},function(a){},{handleError:!1})},a.selectOrbeonForm=function(d,e,f,g,i){var j=(u("sm")||u("xs"))&&a.customFullscreen,j=u("gt-sm"),k="EVENT_BOOKING_FORM",m={};m.stateName="showSessions",m.params={type:"edit",eventId:c.eventId},w.getFormInstanceDetails(0,e,k,f.id,b.userSelectedLanguage.id,g.serviceType.id,function(c){c&&(l.isFieldEmpty(b.userSelectedLanguage.id)?h.show({controller:dailogCtrl,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:x.dialogBox.clickOutsideToClose,fullscreen:j,locals:{dialogParams:{recordId:e,orgLoc:f,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):orbeonFormRunner.loadNewFormRunner(e,k,f.id,b.userSelectedLanguage.id,m,c))},function(b){i&&a.paymentCall()},{handleError:!1})}}z.$inject=["$scope","$state","stateParams","$mdDialog","EmergencyTransactionService"];var A=!l.isFieldEmpty(localStorage.isLoggedIn)&&"false"!=localStorage.isLoggedIn,B=[];a.orgLocPermission=o.EVENT_SESSION_VIEW;var C={headers:{orgLocPermission:a.orgLocPermission}};a.viewLinkedProfessionals=function(a){},a.viewSessionals=function(a){},a.getSessionDetails=function(b,c){if(!l.isNullOrEmpty(b)&&!l.isNullOrEmpty(c)){a.manageEventSpinner=!0;var d={sessionId:b,eventId:c};r.getSessionDetails(d,function(b){a.manageEventSpinner=!1,a.sessionObj=b,l.isFieldEmpty(a.sessionObj.eventSessionProfessional)||angular.forEach(a.sessionObj.eventSessionProfessional,function(a,b){if(a.user.logoDocumentId){var c=new Object;c.fileName=a.user.logoFileName,c.resourceId=a.user.logoDocumentId,c.docType=x.documentTypes.userIdDocument,c.docSubType=x.documentSubTypes.profilePhoto,c.userId=a.user.id,c.isCompressedVersion=!0,fileOperations.getImageUrl(c,function(b){a.logoUrl=b},function(){})}else a.logoUrl="app/images/user.jpg"})}),a.manageEventSpinner=!1}},a.ratingSelected=function(){alert(a.ratings)},a.viewSessions=function(){d.go("showSessions",{eventId:c.eventId})},a.viewEventDetails=function(){d.go("showeventdetails",{eventId:c.eventId})},a.viewSessionBooking=function(a){d.go("showsessionbooking",{eventId:a?a.event.id:null,sessionId:a?a.id:null})},a.boookingStatus=function(a){var b=B.filter(function(b){return b.eventSessionId==a});return l.isFieldEmpty(b)?"Nope":b[0].boookingStatus};var D=function(a,b){var c=new Date(a);if(l.isFieldEmpty(b))return null;var d=b.split(":");return c.setHours(d[0]),c.setMinutes(d[1]),c.setSeconds(d[2]),y(c)};a.isBookingAvailable=function(a){var b=B.filter(function(b){return b.eventSessionId==a.id});if(b.length>0){var c=a.capacity-b[0].noOfBookings;return c>0}return!0},a.displaySmilyStyle=function(b){return"I_BOOKED_THIS"!=a.getButtonText(b)||a.isBookingAvailable(b)?"":"fa fa-smile-o"},a.getButtonStyle=function(b){var c=a.getButtonText(b);return"BOOKING_NOT_CONFIRM_PLEASE_DO_PAYMENT"==c||"SESSION_CANCELED"==c||"SESSION_COMPLETED"==c||"BOOKING_IS_FULL"==c?"completed-event":A?"I_BOOKED_THIS"==c?"booked-event":"available-event":"md-raised md-raised-login md-warn md-button md-ink-ripple"},a.getButtonText=function(b){if(b){if("CANCELLED"==b.eventSessionStatus)return"SESSION_CANCELED";var c=D(b.endDate,b.endsAt),d=(D(b.endDate,b.startsAt),y(new Date));return c<d?"SESSION_COMPLETED":"PENDING"==a.boookingStatus(b.id)?"BOOKING_NOT_CONFIRM_PLEASE_DO_PAYMENT":"CONFIRMED"==a.boookingStatus(b.id)?"I_BOOKED_THIS":A?a.isBookingAvailable(b)?"BOOK_NOW":"BOOKING_IS_FULL":"SIGN_UP_OR_SIGN_IN"}},a.getListOfBookedSessions=function(){s.getBookedSessions(c.eventId,function(b){angular.forEach(b,function(b,c){a.bookedSessionList.push(b.eventSessionId)})},function(a){})},a.Init=function(){l.isFieldEmpty(c.sessionId)||l.isFieldEmpty(c.eventId)?d.go("showEvents"):(E(c.eventId),a.getSessionDetails(c.sessionId,c.eventId),a.bookedSessionList=[],A?a.getListOfBookedSessions():"",a.searchCriteria={sessionId:c.sessionId,eventId:c.eventId},q.searchSessions(a.searchCriteria,C,function(b){l.isFieldEmpty(b.data[0].avgViewFeedbackDTOs[0])||(B=b.data[0].avgViewFeedbackDTOs,a.ratings=b.data[0].avgViewFeedbackDTOs[0].avgRating,a.noOfRating=b.data[0].avgViewFeedbackDTOs[0].noOfRating)},function(a){},"SEARCH_SESSION_LIST"))};/*get event detail by event id*/
var E=function(b){l.isNullOrEmpty(b)||n.getEventDetails(b,function(b){a.eventObj=b},function(a){f("error",g.instant("ERROR"))})};a.bookThisSession=function(b,c,e){A?t.show({scope:a,preserveScope:!0,controller:z,templateUrl:"app/modules/events/views/book-session-popup.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:x.dialogBox.clickOutsideToClose,locals:{stateParams:{data:{sessionName:c.sessionName,eventName:b.eventName,sessionObj:c,eventObj:b}}}}).then(function(){},function(){}):d.go("login")},a.Init()}]),angular.module("paripal.eventModule").controller("ShowSessionsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","manageEventService","featurePrivilegeConstants","dateconvertor","sessionListService","commonConstants","fileOperations","bookingService","$mdDialog","EmergencyTransactionService","$timeout","userStatusService","$mdMedia","docMgntService","orbeonFormRunner",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";function A(a,b,c,d){function e(a){var b={};return b.BILL_FOR="EVENT",b.EVENT_NAME=a.eventInfo.eventName,b.SESSION_NAME=a.eventSession.value,b.BOOKING_DATE=o.convertToViewDate(a.bookedDate),b}a.hide=function(){d.hide()},a.cancel=function(){d.cancel()},a.hideSave=a.bookedSessionList.indexOf(c.data.sessionObj.id)!=-1,a.hidePaymentButton=!0,a.showObj=c.data;var h={id:c.data.sessionObj.id,value:c.data.sessionObj.sessionName},i={id:angular.fromJson(localStorage.getItem("loggedInUser")).id,displayName:angular.fromJson(localStorage.getItem("loggedInUser")).displayName},j=o.convertToServerDate(new Date),k={eventSession:h,attendee:i,bookedDate:j};a.bookEvent=function(d){a.manageEventSpinner=!0,c.data.sessionObj.whetherFeeApplicable?k.boookingStatus="PENDING":k.boookingStatus="CONFIRMED",s.saveBookingDetails(k,c.data.eventObj.conductedBy.id,"add",function(h){var i=k;i.eventInfo=c.data.eventObj,i.sessionCode=c.data.sessionObj.sessionCode,i.transactionId=angular.fromJson(h).response.transactionId,localStorage.setItem("EventBookingDetails",angular.toJson(i)),localStorage.setItem("BillDetails",angular.toJson(e(i))),a.manageEventSpinner=!1,f("success",g.instant(h.successMessage)),1==c.data.sessionObj.whetherFeeApplicable?a.hidePaymentButton=!1:b.reload(),a.isViewMode=!0,a.selectOrbeonForm(d,angular.fromJson(h).response.id,a.eventObj.conductedBy,c.data.eventObj,c.data.sessionObj.whetherFeeApplicable)},function(b){a.manageEventSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(b.data.messages[0]))})},a.paymentCall=function(){s.isBookingCapacity(c.data.sessionObj.id,function(a){if(a){var c={};if(angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId){var c={transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId};u.getWhetherBillDetails(c,function(a){b.go("billsummaryview",{transactionId:angular.fromJson(localStorage.getItem("EventBookingDetails")).transactionId})},function(a){var b=d.confirm().title(g.instant("EVENT_FEE_TYPE_ERROR")).textContent(g.instant("EVENT_FEE_TYPE_NOT_FOUND")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));d.show(b).then(function(){},function(){})},{handleError:!1})}}},function(a){})}}function B(a){var b=Date.parse(a);return b/1e3}/* controller for MarkAttendancePopup */
function C(a,b,c,d,e,f,h,i){a.ShowRating=!0,a.isReadonly=!1,a.viewMode=!1,a.hide=function(){h.hide()},a.cancel=function(){h.cancel()};var j=f.markAttendanceData.filter(function(a){return a.eventSessionId==f.data.id?a:null});j=j.whetherAttended?j:j[0],a.viewMode=j.whetherAttended,a.markAttendanceObj={rating:j.rating,timeIn:i("serverTimeToTimePicker")(j.timeIn),timeOut:i("serverTimeToTimePicker")(j.timeOut),whetherAttended:j.whetherAttended};/*Maz and min time functionality*/
var k=function(b,c){var d=i("serverTimeToTimePicker")(f.data.startsAt),g=i("serverTimeToTimePicker")(f.data.endsAt.substring(0,2)+":"+f.data.endsAt.substring(3,5)+":60");return b.getTime()>=d.getTime()&&b.getTime()<=g.getTime()&&c.getTime()>=d.getTime()&&c<=g.getTime()||(e("error","Time is invalid! please enter time between "+i("time24to12Hour")(f.data.startsAt)+" to "+i("time24to12Hour")(f.data.endsAt)),a.markAttendanceObj.timeIn="",a.markAttendanceObj.timeOut="",!1)};/* To add mark attendance */
a.addMarkAttendance=function(a){k(a.timeIn,a.timeOut)&&(a.attendeeId=w.userData(!0).userId,a.sessionId=f.data.id,a.bookingId=j.bookingId,s.saveMarkAttendance(a,f.orgLocId,function(a){e("success",g.instant(a.successMessage)),h.hide()},function(a){}))}}function D(a){var b=a.split(":");return new Date(1970,0,1,b[0],b[1],b[2])}function E(a,b,c,d){a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.language={},a.orgLocPermission=b.ORGANIZATION_USER_HEALTH_PROFESSIONAL_VIEW,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.loadForm=function(b){var d="EVENT_BOOKING_FORM",e={};e.data={id:"1"},z.loadNewFormRunner(c.recordId,d,c.orgLoc.id,a.searchCriteria.language.id,e,c.formTemplate),t.hide()},a.hide=function(){t.hide()},a.cancel=function(){t.cancel()}}function F(a,b,c,d){a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.language={},a.orgLocPermission=b.ORGANIZATION_USER_HEALTH_PROFESSIONAL_VIEW,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.loadForm=function(b){var d="EVENT_REVIEW_FORM",e={};e.data={id:"1"},z.loadNewFormRunner(c.recordId,d,c.orgLoc.id,a.searchCriteria.language.id,e,c.formTemplate),t.hide()},a.hide=function(){t.hide()},a.cancel=function(){t.cancel()}}A.$inject=["$scope","$state","stateParams","$mdDialog"],C.$inject=["$scope","utilService","httpService","urlService","notify","stateParams","$mdDialog","$filter"],E.$inject=["$scope","featurePrivilegeConstants","dialogParams","parentScope"],F.$inject=["$scope","featurePrivilegeConstants","dialogParams","parentScope"];var G=!l.isFieldEmpty(localStorage.isLoggedIn)&&"false"!=localStorage.isLoggedIn;a.orgLocPermission=n.EVENT_SESSION_VIEW;var H={headers:{orgLocPermission:a.orgLocPermission}};a.searchSessions=function(){a.eventListSpinner=!0;var b="SEARCH_SESSION_LIST",d={eventId:c.eventId};p.searchSessions(d,H,function(b){a.eventListSpinner=!1,a.WSSessionList=b.data,G&&a.getListOfBookedSessions(),l.isFieldEmpty(a.WSSessionList)||(angular.forEach(a.WSSessionList[0].eventSessionDTOs,function(a,b){l.isFieldEmpty(a.eventSessionProfessional)||angular.forEach(a.eventSessionProfessional,function(a,b){if(!l.isFieldEmpty(a.user))if(l.isFieldEmpty(a.user.logoDocumentId))a.logoUrl="app/images/user.jpg";else{var c=new Object;c.fileName=a.user.logoFileName,c.resourceId=a.user.logoDocumentId,c.docType=q.documentTypes.userIdDocument,c.docSubType=q.documentSubTypes.profilePhoto,c.userId=a.user.id,c.isCompressedVersion=!0,r.getImageUrl(c,function(b){a.logoUrl=b},function(){})}})}),angular.forEach(a.WSSessionList[0].eventSessionDTOs,function(b,c){angular.forEach(a.WSSessionList[0].avgViewFeedbackDTOs,function(a,c){b.id==a.eventSessionId&&(a.avgRating?(b.avgRating=a.avgRating,b.noOfRating=a.noOfRating):(b.avgRating=0,b.noOfRating=0))})}))},function(b){a.eventListSpinner=!1},b)},a.viewLinkedProfessionals=function(a){d.go("showLinkedProfessionals",{eventId:a.id})},a.viewSessionals=function(a){},a.viewSessionDetails=function(a){d.go("showSessionDetails",{eventId:a.event.id,sessionId:a.id})},a.getEventDetails=function(b,c){l.isNullOrEmpty(b)||(a.manageEventSpinner=!0,m.getEventDetails(b,function(b){a.manageEventSpinner=!1,a.eventObj=b,a.eventObj.avgRating=angular.copy(a.avgRating)},function(b){a.manageEventSpinner=!1,f("error",g.instant("ERROR"))}))},a.bookThisSession=function(b,c,e){G?t.show({scope:a,preserveScope:!0,controller:A,templateUrl:"app/modules/events/views/book-session-popup.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:q.dialogBox.clickOutsideToClose,locals:{stateParams:{data:{sessionName:c.sessionName,eventName:b.eventName,sessionObj:c,eventObj:b}}}}).then(function(){a.Init()},function(){}):d.go("login")},a.paymentCallForTransaction=function(a){s.isBookingCapacity(a.id,function(b){if(b&&a.transactionId){var c={transactionId:a.transactionId},e={};e.BILL_FOR="EVENT",e.EVENT_NAME=a.event.value,e.SESSION_NAME=a.sessionName,e.BOOKING_DATE=o.convertToViewDate(new Date);u.getWhetherBillDetails(c,function(a){localStorage.setItem("BillDetails",angular.toJson(e)),d.go("billsummaryview",c)},function(a){var b=t.confirm().title(g.instant("EVENT_FEE_TYPE_ERROR")).textContent(g.instant("EVENT_FEE_TYPE_NOT_FOUND")).ok(g.instant("OK")).cancel(g.instant("CANCEL"));t.show(b).then(function(){},function(){})},{handleError:!1})}},function(a){})},a.boookingStatus=function(b){var c=a.WSSessionList[0].avgViewFeedbackDTOs.filter(function(a){return a.eventSessionId==b});return l.isFieldEmpty(c)?"Nope":c[0].boookingStatus};var I=function(a,b){var c=new Date(a);if(l.isFieldEmpty(b))return null;var d=b.split(":");return c.setHours(d[0]),c.setMinutes(d[1]),c.setSeconds(d[2]),B(c)};a.isBookingAvailable=function(b){var c=a.WSSessionList[0].avgViewFeedbackDTOs.filter(function(a){return a.eventSessionId==b.id});if(c.length>0){var d=b.capacity-c[0].noOfBookings;return d>0}return!0},a.getButtonStyle=function(b){var c=a.getButtonText(b);return"BOOKING_NOT_CONFIRM_PLEASE_DO_PAYMENT"==c||"SESSION_CANCELED"==c||"SESSION_COMPLETED"==c||"BOOKING_IS_FULL"==c?"completed-event":G?"I_BOOKED_THIS"==c?"booked-event":"available-event":"md-raised md-raised-login md-warn md-button md-ink-ripple"},a.getButtonText=function(b){if(b){if("CANCELLED"==b.eventSessionStatus)return"SESSION_CANCELED";var c=I(b.endDate,b.endsAt),d=(I(b.endDate,b.startsAt),B(new Date));return c<d?"SESSION_COMPLETED":"PENDING"==a.boookingStatus(b.id)?"BOOKING_NOT_CONFIRM_PLEASE_DO_PAYMENT":"CONFIRMED"==a.boookingStatus(b.id)?"I_BOOKED_THIS":G?a.isBookingAvailable(b)?"BOOK_NOW":"BOOKING_IS_FULL":"SIGN_UP_OR_SIGN_IN"}},a.checkBookingDone=function(b){var c=I(b.endDate,b.endsAt),d=B(new Date);return!!(c<d&&"CONFIRMED"==a.boookingStatus(b.id)&&G)},a.displaySmilyStyle=function(b){return"I_BOOKED_THIS"!=a.getButtonText(b)||a.isBookingAvailable(b)?"":"fa fa-smile-o"},a.getListOfBookedSessions=function(){s.getBookedSessions(c.eventId,function(b){angular.forEach(b,function(b,c){a.bookedSessionList.push(b.eventSessionId)}),angular.forEach(b,function(b,c){angular.forEach(a.WSSessionList[0].eventSessionDTOs,function(a,c){a.id==b.eventSessionId&&(a.whetherBooked=!0,a.whetherPaid=b.whetherPaid,a.whetherOnlineBooking=b.whetherOnlineBooking,a.transactionId=b.transacctionId,a.reviewFormInstanceId=b.reviewFormInstanceId,a.bookingFormInstanceId=b.bookingFormInstanceId,a.serviceTypeId=b.serviceTypeId,a.eventSessionBookingId=b.eventSessionBookingId)})})},function(a){})},/*Manage Mark Attendance popup*/
a.manageMarkAttendance=function(b,c,e){t.show({scope:a,preserveScope:!0,controller:C,templateUrl:"app/modules/events/views/mark-attendance-popup.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:q.dialogBox.clickOutsideToClose,locals:{stateParams:{markAttendanceData:a.WSSessionList[0].avgViewFeedbackDTOs,data:b,orgLocId:e.id}}}).then(function(){d.reload()},function(){})},a.viewEventDetails=function(a){d.go("showeventdetails",{eventId:a.id})},a.viewEventBooking=function(a){d.go("showeventbooking",{eventId:a.id})},a.viewSessionBooking=function(a){w.isUserLoggedIn()?d.go("showsessionbooking",{eventId:a?a.event.id:null,sessionId:a?a.id:null}):d.go("login")},a.getEventsAvgRating=function(b){m.getEventAvgRatings(b,function(b){a.ratings=b.avgRating,a.noOfRating=b.noOfRating},function(a){})},a.formatTime=function(a){var b=D(a);return h("date")(b,"hh:mma")},a.Init=function(){l.isFieldEmpty(c.eventId)?d.go("showEvents"):(a.getEventDetails(c.eventId),a.getEventsAvgRating(c.eventId),a.searchSessions(),a.bookedSessionList=[])},a.selectOrbeonForm=function(d,e,f,g,h){var i=(x("sm")||x("xs"))&&a.customFullscreen,i=x("gt-sm"),j="EVENT_BOOKING_FORM",k={};k.stateName="showSessions",k.params={type:"edit",eventId:c.eventId},y.getFormInstanceDetails(0,e,j,f.id,b.userSelectedLanguage.id,g.serviceType.id,function(c){c&&(l.isFieldEmpty(b.userSelectedLanguage.id)?t.show({controller:E,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:q.dialogBox.clickOutsideToClose,fullscreen:i,locals:{dialogParams:{recordId:e,orgLoc:f,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):z.loadNewFormRunner(e,j,f.id,b.userSelectedLanguage.id,k,c))},function(b){h&&a.paymentCall()},{handleError:!1})},a.manageFeedback=function(d,e){var f=a.eventObj.conductedBy,g=(x("sm")||x("xs"))&&a.customFullscreen,g=x("gt-sm"),h="EVENT_REVIEW_FORM",i={};i.stateName="showSessions",i.params={eventId:c.eventId},y.getFormInstanceDetails(0,e.eventSessionBookingId,h,f.id,b.userSelectedLanguage.id,e.serviceTypeId,function(c){c&&(l.isFieldEmpty(b.userSelectedLanguage.id)?t.show({controller:F,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:q.dialogBox.clickOutsideToClose,fullscreen:g,locals:{dialogParams:{recordId:e.id,orgLoc:f,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):z.loadNewFormRunner(e.eventSessionBookingId,h,f.id,b.userSelectedLanguage.id,i,c))},function(a){})},a.Init()}]),angular.module("paripal.eventModule").controller("ViewBookingCountCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","sessionListService","featurePrivilegeConstants","dateconvertor","manageEventService","bookingService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.isDisabled=!0,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.eventListSpinner=!1,a.WSSessionList=[],a.postHeader=null,a.sessionSatusList=[],a.orgLocPermission=o.EVENT_VIEW,/*                $scope.postHeader = {
                    headers: {
                        "orgLocPermission": $scope.orgLocPermission
                    }
                }; */
a.manageBookings=function(a,b){var e={type:b,sessionId:c.sessionId?c.sessionId:null,eventId:c.eventId?c.eventId:null,bookingId:a?a.id:null,parentState:d.$current.self.name};localStorage.setItem("manageBooking",angular.toJson(e)),d.go("manageBooking",e)},a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.eventType={queryUrl:"FIND_ALL_EVENT_TYPE",queryParameter:{}},a.viewBookings=function(a){d.go("viewBookingDetails",{sessionId:a?a.sessionId:null,eventId:a?a.eventId:null})},a.viewAttendees=function(a){d.go("viewBookingDetails",{sessionId:a?a.sessionId:null,eventId:a?a.eventId:null,whetherAttended:!0})},a.getBookingCount=function(b){var c={};c=angular.copy(a.searchCriteria),m.isFieldEmpty(c.fromDate)||(c.fromDate=p.convertToServerDate(c.fromDate)),m.isFieldEmpty(c.tillDate)||(c.tillDate=p.convertToServerDate(c.tillDate)),m.isFieldEmpty(c.conductedBy)||(c.conductedById=c.conductedBy.id,delete c.conductedBy),m.isFieldEmpty(c.eventType)||(c.eventTypeId=c.eventType.id,delete c.eventType),m.isFieldEmpty(c.eventId)||(m.isFieldEmpty(c.eventId.id)?(c.eventName=c.eventId,delete c.eventId):c.eventId=c.eventId.id),a.searchCriteria.sorters&&(c.sorters=a.searchCriteria.sorters),c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,r.getBookingCount(c,function(b){a.bookingCountsList=b},function(a){},{orgLocPermission:o.BOOKING_LIST_VIEW})},a.getEventNameData=function(b){var c={};/*requestData.noOfSuggestions = commonConstants.smartSearchRecordLimit;*/
return c.searchKeyWord=b,c.orgLoctId=a.searchCriteria.conductedBy.id,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_EVENT_NAME_FOR_BOOKING_SEARCH",c),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1},{orgLocPermission:o.SESSION_BOOKING_VIEW})},a.getProfessionalNameData=function(b){var c={};/*requestData.orgLoctId = $scope.searchCriteria.conductedBy.id;*/
/*requestData.noOfSuggestions = commonConstants.smartSearchRecordLimit;*/
return c.searchKeyWord=b,m.isFieldEmpty(a.searchCriteria.eventId)||(m.isFieldEmpty(a.searchCriteria.eventId.id)?c.eventName=a.searchCriteria.eventId:c.eventId=a.searchCriteria.eventId.id),a.userNameAutoCmpLoading=!0,k.getData(l.getUrl("GET_PROFESSIONALS_BY_EVENT",null),c,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1},{orgLocPermission:o.SESSION_BOOKING_VIEW})},a.setSearchAPI=function(b){a.api=b},a.clear=function(){a.searchCriteria={},a.searchCriteria.eventId=c.eventId,a.getBookingCount()},a.manageSessions=function(a,b){var c={type:b,sessionId:a?a.id:null};d.go("manageSessions",c)},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getBookingCount()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getBookingCount()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){m.isFieldEmpty(c.eventId)?d.go("eventList",{}):(q.getEventDetails(c.eventId,function(b){m.isFieldEmpty(b)||(a.searchCriteria.conductedBy=b.conductedBy,a.searchCriteria.eventType=b.eventType,a.searchCriteria.eventId={id:b.id,value:b.eventName},a.getBookingCount())}),a.eventId=c.eventId)},a.init()}]),angular.module("paripal.eventModule").controller("ViewBookingsCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","sessionListService","featurePrivilegeConstants","dateconvertor","manageEventService","bookingService","$filter","EmergencyTransactionService","$mdMedia","docMgntService","orbeonFormRunner","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";/* controller for MarkAttendancePopup */
function y(a,b,c,d,e,f,g,i){a.ShowRating=!1,a.viewMode=!1,a.hide=function(){g.hide()},a.cancel=function(){g.cancel()},a.isReadonly=!1,a.hoveringOver=function(b){a.overStar=b,a.percent=100*(b/a.max)};/*Maz and min time functionality*/
var j=function(b,c){var d=i("serverTimeToTimePicker")(f.data.startsAt),g=i("serverTimeToTimePicker")(f.data.endsAt.substring(0,2)+":"+f.data.endsAt.substring(3,5)+":60");return b.getTime()>=d.getTime()&&b.getTime()<=g.getTime()&&c.getTime()>=d.getTime()&&c<=g.getTime()||(e("error","Time is invalid! please enter time between "+i("time24to12Hour")(f.data.startsAt)+" to "+i("time24to12Hour")(f.data.endsAt)),a.markAttendanceObj.timeIn="",a.markAttendanceObj.timeOut="",!1)};/* To add mark attendance */
a.addMarkAttendance=function(a){j(a.timeIn,a.timeOut)&&r.saveMarkAttendance(a,function(a){e("success",h.instant(a.successMessage)),g.hide()},function(a){})};var k=function(){b.isFieldEmpty(f.data)||(b.isFieldEmpty(f.data.id)||(a.markAttendanceObj={id:f.data.id}),f.data.whetherAttended&&(a.markAttendanceObj.whetherAttended=f.data.whetherAttended,a.markAttendanceObj.rating=f.data.rating,a.markAttendanceObj.timeIn=i("serverTimeToTimePicker")(f.data.timeIn),a.markAttendanceObj.timeOut=i("serverTimeToTimePicker")(f.data.timeOut)))};k()}y.$inject=["$scope","utilService","httpService","urlService","notify","stateParams","$mdDialog","$filter"],a.isDisabled=!0,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.eventListSpinner=!1,a.WSSessionList=[],a.postHeader=null,a.sessionSatusList=[],a.orgLocPermission=o.EVENT_VIEW,/*
                $scope.postHeader = {
                    headers: {
                        "orgLocPermission": $scope.orgLocPermission
                    }
                }; */
a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.eventType={queryUrl:"FIND_ALL_EVENT_TYPE",queryParameter:{}},a.getBookingDetails=function(){var b={};b=angular.copy(a.searchCriteria),m.isFieldEmpty(b.fromDate)||(b.fromDate=p.convertToServerDate(b.fromDate)),m.isFieldEmpty(b.tillDate)||(b.tillDate=p.convertToServerDate(b.tillDate)),m.isFieldEmpty(b.conductedBy)||(b.conductedById=b.conductedBy.id,delete b.conductedBy),m.isFieldEmpty(b.eventType)||(b.eventTypeId=b.eventType.id,delete b.eventType),m.isFieldEmpty(b.eventId)||(m.isFieldEmpty(b.eventId.id)?(b.eventName=b.eventId,delete b.eventId):b.eventId=b.eventId.id),m.isFieldEmpty(b.sessionId)?b.sessionId=parseInt(c.sessionId):m.isFieldEmpty(b.sessionId.id)?(b.sessionName=b.sessionId,delete b.sessionId):b.sessionId=b.sessionId.id,c.whetherAttended&&(b.whetherAttended=!0),a.searchCriteria.sorters&&(b.sorters=a.searchCriteria.sorters),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,k.postData(l.getUrl("BOOKING_DETAILS_FILTER"),b,function(b){a.bookingCountsList=b.data,a.totalItems=b.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(a){},{orgLocPermission:o.BOOKING_DETAILS_VIEW})},a.cancelBooking=function(b){var c={};return c.id=b.id,c.cancelledOn=p.convertToServerDate(new Date),a.userNameAutoCmpLoading=!0,k.putData(l.getUrl("CANCEL_BOOKING"),c,function(b){a.userNameAutoCmpLoading=!1,f("success",h.instant(b.data.successMessage)),a.getBookingDetails()},function(b){a.userNameAutoCmpLoading=!1},{orgLocPermission:o.SESSION_BOOKING_CANCEL,organizationLocationId:b.organizationLocationId})},a.getEventNameData=function(b){var c={};/*requestData.noOfSuggestions = commonConstants.smartSearchRecordLimit;*/
return c.searchKeyWord=b,c.orgLoctId=a.searchCriteria.conductedBy.id,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_EVENT_NAME_FOR_BOOKING_SEARCH",c),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1},{orgLocPermission:o.SESSION_BOOKING_VIEW})},a.getSessionNameData=function(b){var c={};/*requestData.noOfSuggestions = commonConstants.smartSearchRecordLimit;*/
return c.searchKeyword=b,c.eventId=a.eventId,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_SESSION_NAME",c),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1},{orgLocPermission:o.SESSION_BOOKING_VIEW})},/* $scope.paymentCall = function (sessiondata) {
             var transactionId = {};
             if (sessiondata.transactionId) {
                 var transactionId = {
                     transactionId: sessiondata.transactionId
                 };
                 var bookingObject = {};
                 bookingObject.BILL_FOR = "EVENT";
                 bookingObject.EVENT_NAME = sessiondata.eventName;
                 bookingObject.SESSION_NAME = sessiondata.sessionName;
                 bookingObject.BOOKING_DATE = dateconvertor.convertToViewDate(new Date());
                 localStorage.setItem("BillDetails", angular.toJson(bookingObject));
                 var transactionType = "EVENT";
                 EmergencyTransactionService.getAutoBillDetails(transactionId, transactionType, function (response) {
                     $state.go("billsummaryview", {
                         transactionId: sessiondata.transactionId
                     });
                 }, function (error) {
                     var confirm = $mdDialog.confirm()
                         .title($translate.instant('EVENT_FEE_TYPE_ERROR'))
                         .textContent($translate.instant('EVENT_FEE_TYPE_NOT_FOUND'))
                         .ok($translate.instant('OK'))
                         .cancel($translate.instant('CANCEL'));

                     $mdDialog.show(confirm).then(function () {

                     }, function () {
                         $state.go("eventList");
                     });
                 });
             }

         };*/
/*redirect to  mark attendance */
a.manageMarkAttendance=function(b,c){g.show({scope:a,preserveScope:!0,controller:y,templateUrl:"app/modules/events/views/mark-attendance-popup.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:x.dialogBox.clickOutsideToClose,locals:{stateParams:{data:b}}}).then(function(){a.getBookingDetails()},function(){})},a.setSearchAPI=function(b){a.api=b},a.clear=function(){a.searchCriteria={},a.searchCriteria.eventId=c.eventId,m.isFieldEmpty(c.eventId)||m.isFieldEmpty(c.sessionId)||(a.eventId=c.eventId,a.sessionId=c.sessionId,q.getEventDetails(c.eventId,function(b){m.isFieldEmpty(b)||(a.eventObj=b,a.searchCriteria.conductedBy=b.conductedBy,a.searchCriteria.eventType=b.eventType,a.searchCriteria.eventId={id:b.id,value:b.eventName},a.getBookingDetails())}))},a.manageSessions=function(a,b){var c={type:b,sessionId:a?a.id:null};d.go("manageSessions",c)},/*Redirect to Event Booking view*/
a.viewEventBooking=function(a){d.go("showeventbooking",{eventId:a?a:null})},a.manageBookings=function(a,b){var e={type:b,sessionId:c.sessionId?c.sessionId:null,eventId:c.eventId?c.eventId:null,bookingId:a?a.id:null,parentState:d.$current.self.name};localStorage.setItem("manageBooking",angular.toJson(e)),d.go("manageBooking",e)},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getBookingDetails()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getBookingDetails()};
//datatble config json
var z={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(z),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){m.isFieldEmpty(c.eventId)||m.isFieldEmpty(c.sessionId)?m.isFieldEmpty(c.eventId)?d.go("eventList",{}):d.go("viewBookingCounts",{eventId:c.eventId}):(a.eventId=c.eventId,a.sessionId=c.sessionId,q.getEventDetails(c.eventId,function(b){m.isFieldEmpty(b)||(a.eventObj=b,a.searchCriteria.conductedBy=b.conductedBy,a.searchCriteria.eventType=b.eventType,a.searchCriteria.eventId={id:b.id,value:b.eventName},a.getBookingDetails())})),/*to hide html screen content if wheather attended is true*/
a.isAttend=!1,c.whetherAttended&&(a.isAttend=!0)},a.viewFeedback=function(d,e){var g=a.eventObj.conductedBy,i=((u("sm")||u("xs"))&&a.customFullscreen,u("gt-sm"),"EVENT_REVIEW_FORM"),j={};j.stateName="viewBookingDetails",j.params={eventId:c.eventId,sessionId:c.sessionId},v.getFormInstanceDetails(0,e.id,i,g.id,b.userSelectedLanguage.id,a.eventObj.serviceType.id,function(a){a&&a.documentId&&null!=a.documentId?m.isFieldEmpty(b.userSelectedLanguage.id)?console.log("language not found"):w.loadNewFormRunner(e.id,i,g.id,b.userSelectedLanguage.id,j,a):f("warning",h.instant("FEEBACK_NOT_GIVEN"))},function(a){console.log(a)})},a.viewBookingForm=function(d,e){var f=a.eventObj.conductedBy.id,h=(u("sm")||u("xs"))&&a.customFullscreen,h=u("gt-sm"),i="EVENT_BOOKING_FORM",j={},k=e.id;j.stateName="viewBookingDetails",j.params={eventId:c.eventId,sessionId:c.sessionId,bookingId:k},v.getFormInstanceDetails(0,k,i,f,b.userSelectedLanguage.id,a.eventObj.serviceType.id,function(c){c&&(m.isFieldEmpty(b.userSelectedLanguage.id)?g.show({controller:dailogCtrl,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:x.dialogBox.clickOutsideToClose,fullscreen:h,locals:{dialogParams:{recordId:k,orgLocId:f,formTemplate:formTemplate},parentScope:a}}).then(function(){},function(){}):w.loadNewFormRunner(k,i,f,b.userSelectedLanguage.id,j,c))},function(a){})},a.init()}]),angular.module("paripal.eventModule").controller("ViewFeedbackCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","featurePrivilegeConstants","sessionListService","viewFeedbackService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.feedbackListSpinner=!1,a.feedbackList=[],a.orgLocPermission=i.EVENT_VIEW,a.eventName={queryUrl:"SEARCH_EVENT_BY_EVENT_NAME",queryParameter:{}},a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},/* Get session name as per event id*/
a.getSessionName=function(b,c){var d={};d.eventId=c,d.searchKeyword=b;var e=[];return j.getSessionName(d,function(a){return e=a},function(a){},a.orgLocPermission)},/* Get session Professional name as per conducted by id*/
a.getProfessionalUsers=function(b,c){var d={};return d.locationId=c,d.searchKeyWord=b,k.getSessionProfessionalName(d,function(a){return a},function(a){},a.orgLocPermission)},a.searchEvents=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.feedbackListSpinner=!0;var b={};b=angular.copy(a.searchCriteria),k.searchFeedback(b,a.orgLocPermission,function(b){a.feedbackListSpinner=!1,a.feedbackList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.feedbackListSpinner=!1})},a.clear=function(){a.searchCriteria={},a.searchEvents()},a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchEvents("search")},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchEvents("search")};
//datatble config json
var m={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(m),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){l.isFieldEmpty(c.data)||(a.searchCriteria=c.data,a.searchEvents())},a.init()}]),angular.module("paripal.eventModule").service("bookingService",["httpService","urlService","dateconvertor","utilService","featurePrivilegeConstants","$filter",function(a,b,c,d,e,f){"use strict";this.saveBookingDetails=function(c,d,f,g,h){var i=angular.copy(c);if("add"===f)i.attendee={id:c.attendee.id,value:c.attendee.displayName},delete i.conductedBy,a.postData(b.getUrl("MAKE_BOOKING"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)},{orgLocPermission:e.SESSION_BOOKING_ADD,organizationLocationId:d});else{var j={bookingId:c.id};a.putData(b.getParameterizedUrl("UPDATE_BOOKING",j),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)},{orgLocPermission:e.SESSION_BOOKING_EDIT,organizationLocationId:d})}},this.getBookingById=function(c,d,e){var f={};f.bookingId=c,a.getData(b.getParameterizedUrl("FIND_BOOKING_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getBookedSessions=function(c,d,e){var f={};f.eventId=c,a.getData(b.getParameterizedUrl("GET_BOOKED_SESSIONS",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.saveMarkAttendance=function(c,e,g,h){var i={};i.timeIn=f("date")(c.timeIn,"HH:mm:ss"),i.timeOut=f("date")(c.timeOut,"HH:mm:ss"),i.whetherAttended=c.whetherAttended,i.id=c.id,c.bookingId&&(i.id=c.bookingId),d.isFieldEmpty(c.rating)||(i.rating=c.rating),a.putData(b.getUrl("MARK_ATTENDANCE"),i,function(a){g(a&&a.data?a.data:a)},function(a){h(a)},{organizationLocationId:e})},/*this.saveMarkAttendanceForIndividual = function (object, successCallback, errorCallback) {
    var response = {}
    response.timeIn = $filter('date')(object.timeIn, 'hh:mm:ss');
    response.timeOut = $filter('date')(object.timeOut, 'hh:mm:ss');
    response.whetherAttended = object.whetherAttended;
    response.attendee = {
        id: object.attendeeId
    };
    response.eventSession = {
        id: object.sessionId
    };
    response.rating = object.rating;
    httpService.putData(urlService.getUrl('GIVE_FEEDBACK_FOR_INDIVIDUAL'), response, function (response) {
        if (response && response.data) {
            successCallback(response.data);
        } else {
            successCallback(response);
        }
    }, function (error) {
        errorCallback(error);
    });
}*/
this.getSessionWSById=function(c,d,e){var f={};f.eventSessionId=c,a.getData(b.getParameterizedUrl("GET_WS_BY_SESSION_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getSessionDateById=function(c,d,e){var f={};f.eventSessionId=c,a.getData(b.getParameterizedUrl("GET_SESSION_DATE_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getBookingCount=function(c,d,e,f){a.postData(b.getUrl("GET_BOOKING_COUNTS"),c,function(a){d(a.data)},function(a){e(a)},f)},this.getEventTotalCapacityAndBooking=function(c,d,e){var f={};f.eventId=c,a.getData(b.getParameterizedUrl("GET_EVENT_TOTAL_BOOKING_AND_CAPACITY",f),null,function(a){d(a.data)},function(a){e(a)})},this.getSessionTotalCapacityAndBooking=function(c,d,e){var f={};f.sessionId=c,a.getData(b.getParameterizedUrl("GET_SESSION_TOTAL_BOOKING_AND_CAPACITY",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.searchMyBooking=function(e,f,g,h){var i={};d.isEmpty(e.eventSessionName)||(i.eventSessionName=e.eventSessionName),d.isEmpty(e.eventStatus)||(i.eventStatus=e.eventStatus),d.isNullOrEmpty(e.startDate)||(i.startDate=c.convertToServerDate(e.startDate)),d.isNullOrEmpty(e.eventName)||(i.eventName=e.eventName),i.pageNumber=e.pageNumber,i.recordsPerPage=e.recordsPerPage,e.sorters&&(i.sorters=e.sorters),a.postData(b.getUrl("GET_MY_BOOKING_SERACH"),i,function(a){g(a.data)},function(a){h(a)})},/*Booking cancel functionality*/
this.cancelBooking=function(c,d,f,g){a.putData(b.getUrl("CANCEL_BOOKING"),c,function(a){f(a)},function(a){g(a)},{orgLocPermission:e.SESSION_BOOKING_CANCEL,organizationLocationId:d})},/*Booking capcity check functionality*/
this.isBookingCapacity=function(c,d,e){var f={sessionId:c};a.getData(b.getParameterizedUrl("GET_CAPACITY_INFO",f),null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.eventModule").service("eventListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchEvents=function(d,f,g,h,i,j){var k={};k.whetherIndividual=d.whetherIndividual,k.whetherLctnClient=d.whetherLctnClient,k.whetherLctnUser=d.whetherLctnUser,k.whetherOrgClient=d.whetherOrgClient,k.whetherOrgUser=d.whetherOrgUser,k.whetherPublic=d.whetherPublic,e.isNullOrEmpty(d.eventName)||(k.eventName=d.eventName),e.isEmpty(d.conductedBy)||(k.conductedBy=d.conductedBy.id),e.isEmpty(d.city)||(k.cityId=d.city.id),e.isEmpty(d.eventType)||(k.eventTypeId=d.eventType.id),e.isEmpty(d.eventStatus)||(k.eventStatus=d.eventStatus),e.isNullOrEmpty(d.startDate)||(k.startDate=c.convertToServerDate(d.startDate)),e.isNullOrEmpty(d.endDate)||(k.endDate=c.convertToServerDate(d.endDate)),e.isNullOrEmpty(d.eventId)||(k.eventId=d.eventId.id),e.isNullOrEmpty(d.searchKeyword)||(k.searchKeyword=d.searchKeyword),e.isFieldEmpty(d.searchText)||(k.searchKeyword=d.searchKeyword),e.isFieldEmpty(d.startDate)||(k.startDate=c.convertToServerDate(d.startDate)),k.pageNumber=d.pageNumber,k.recordsPerPage=d.recordsPerPage,d.sorters&&(k.sorters=d.sorters),/*if (!utilService.isFieldEmpty(eventIds)) {*/
k.eventIds=j,/*}*/
a.postDataWithHeader(b.getUrl(f),k,g,function(a){h(a.data)},function(a){i(a)})},this.inactivateEvent=function(c,d,e,f){a.getData(b.getParameterizedUrl("INACTIVATE_EVENT",c),null,function(a){e(a.data)},function(a){f(a)},{organizationLocationId:d})},this.getProfEventIds=function(c,d,e){var f=b.getUrl("GET_PROF_EVENT_IDS");f+=c,a.getData(f,null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.eventModule").service("manageEventService",["httpService","urlService","dateconvertor","utilService","featurePrivilegeConstants",function(a,b,c,d,e){"use strict";this.saveEventDetails=function(f,g,h,i){var j=angular.copy(f);d.isNullOrEmpty(j.dateServiceLevelSet)||(j.dateServiceLevelSet=c.convertToServerDate(j.dateServiceLevelSet)),d.isNullOrEmpty(j.startDate)||(j.startDate=c.convertToServerDate(j.startDate)),d.isNullOrEmpty(j.endDate)||(j.endDate=c.convertToServerDate(j.endDate));var k={};d.isNullOrEmpty(j.id)||(k.eventId=j.id),d.isFieldEmpty(j.city)||(j.cityName=j.city.value),"add"===g?a.postData(b.getUrl("CREATE_EVENT"),j,function(a){h(a&&a.data?a.data:a)},function(a){i(a)},{orgLocPermission:e.EVENT_ADD}):(delete j.displayAmount,a.putData(b.getParameterizedUrl("UPDATE_EVENT",k),j,function(a){h(a&&a.data?a.data:a)},function(a){i(a)},{orgLocPermission:e.EVENT_EDIT}))},this.inactiveComplaintServiceLevel=function(c,d,e){var f={};f.complaintServiceLevelId=c,a.putData(b.getParameterizedUrl("INACTIVE_COMPLAINT_SERVICE_LEVELS",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getEventDetails=function(c,d,e){var f={};f.eventId=c,a.getData(b.getParameterizedUrl("GET_EVENT_BY_ID_DTO",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getOrganizationAddress=function(c,d,e){var f={};f.organizationLocationId=c,a.getData(b.getParameterizedUrl("GET_ADDRESS_FROM_ORGID",f),null,function(a){a.data&&d(a.data)},function(a){})},this.getEventAvgRatings=function(c,d,e){var f={};f.eventId=c,a.getData(b.getParameterizedUrl("GET_AVG_RATINGS_BY_EVENT_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getLinkedProfessionals=function(c,d,e){var f={};f.eventId=c,a.getData(b.getParameterizedUrl("GET_LINKED_PROFESSIONALS_BY_EVENT_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.eventModule").service("manageSessionService",["httpService","urlService","dateconvertor","utilService","$filter","featurePrivilegeConstants",function(a,b,c,d,e,f){"use strict";this.saveEventDetails=function(f,g,h,i){var j={};if(angular.copy(f,j),j.startsAt=e("date")(j.startsAt,"H:mm"),j.endsAt=e("date")(j.endsAt,"H:mm"),/* if (!utilService.isFieldEmpty(WSComplaintServiceLevel.conductedBy)) {
                 WSComplaintServiceLevel.organizationLocationId = WSComplaintServiceLevel.conductedBy.data.id;
             }
             delete WSComplaintServiceLevel.conductedBy;*/
d.isFieldEmpty(j.event)||(j.event={id:f.event.id}),d.isFieldEmpty(j.currency)?delete j.currency:j.currency=j.currency.dataValue,d.isFieldEmpty(j.startDate)||(j.startDate=c.convertToServerDate(j.startDate)),d.isFieldEmpty(j.endDate)||(j.endDate=c.convertToServerDate(j.endDate)),d.isFieldEmpty(j.eventSessionProfessional)||delete j.eventSessionProfessional,d.isFieldEmpty(j.city)||(j.cityName=j.city.value),"add"===g)delete j.sessionId,a.postData(b.getUrl("CREATE_SESSION"),j,function(a){h(a&&a.data?a.data:a)},function(a){i(a)});else{var k={sessionId:j.id};a.putData(b.getParameterizedUrl("UPDATE_SESSION",k),j,function(a){h(a&&a.data?a.data:a)},function(a){i(a)})}},this.getSessionDetails=function(c,d,e){var f={};return f.eventSessionId=c.sessionId,f.eventId=c.eventId,a.getData(b.getParameterizedUrl("FIND_SESSION_DETAIL_BY_ID",f),null,function(a){d(a&&a.data?a.data:a)},function(a){})},this.getEventById=function(c,d){var e={eventId:c};return a.getData(b.getParameterizedUrl("GET_EVENT_BY_ID",e),null,function(a){if(a&&a.data)return d(a.data)},function(a){})},/*Session Professionals link api's*/
this.getProfessionals=function(c,d,e){return a.getData(b.getParameterizedUrl(d,c),null,function(a){return e(a&&a.data?a.data:a)},function(a){})},this.linkProfessional=function(c,d,e,g,h,i,j){var k={};k.remark=h,k.organizationLocationId=c,k.eventSession={id:d},"ORGANIZATION_USER"==e&&(k.organizationUser={id:g.id}),"PARIPAL_USER"==e&&(k.user={id:g.id}),"string"==typeof g&&(k.userName=g);var l=f.EVENT_LINKED_PROFESSIONAL_ADD;a.postData(b.getUrl("LINK_SESSION_PROFESSIONAL"),k,function(a){i(a&&a.data?a.data:a)},function(a){j(a.data)},l)},this.unLinkProfessional=function(c,d){var e={id:c},g=f.EVENT_LINKED_PROFESSIONAL_ADD;a.postData(b.getUrl("UNLINK_SESSION_PROFESSIONAL"),e,function(a){d(a&&a.data?a.data:a)},function(a){},g)},this.searchProfessionals=function(c,d){var e=f.EVENT_LINKED_PROFESSIONAL_VIEW;a.getData(b.getParameterizedUrl("FIND_LINK_PROFESSIONALS",c),null,function(a){d(a.data)},function(a){},e)}}]),angular.module("paripal.eventModule").service("sessionListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchSessions=function(f,g,h,i,j){var k={};e.isNullOrEmpty(f.sessionName)||("object"==typeof f.sessionName?k.sessionId=f.sessionName.id:k.eventSessionName=f.sessionName),e.isEmpty(f.professional)||(k.professionalId=f.professional.id),e.isEmpty(f.status)||(k.sessionStatus=f.status),e.isNullOrEmpty(f.startDate)||(k.startDate=c.convertToServerDate(f.startDate)),e.isNullOrEmpty(f.endDate)||(k.endDate=c.convertToServerDate(f.endDate)),e.isNullOrEmpty(f.startTime)||(k.sessionStartTime=d("date")(f.startTime,"HH:mm")),e.isNullOrEmpty(f.endTime)||(k.sessionEndTime=d("date")(f.endTime,"HH:mm")),e.isFieldEmpty(f.eventId)||(k.eventId=f.eventId),k.pageNumber=f.pageNumber,k.recordsPerPage=f.recordsPerPage,f.sorters&&(k.sorters=f.sorters),a.postDataWithHeader(b.getUrl(j),k,g,function(a){h(a.data)},function(a){i(a)})},this.getStatuslist=function(c,d){return a.getData(b.getUrl("FIND_ALL_EVENT_SESSION_STATUS"),null,function(a){return c(a.data)},function(a){d(a)})},this.getRestrictionlist=function(c,d){return a.getData(b.getUrl("GET_SESSION_RESTRICTION"),null,function(a){return c(a.data)},function(a){d(a)})},this.getSessionName=function(c,d,e,f){return a.getData(b.getParameterizedUrl("GET_SESSION_NAME",c),null,function(a){return d(a.data)},function(a){e(a)},f)},this.getSessionNameForBooking=function(c,d,e,f){return a.getData(b.getParameterizedUrl("GET_SESSION_FOR_BOOKINGS",c),null,function(a){return d(a.data)},function(a){e(a)},f)},this.getEventData=function(c,d,e){var f={eventId:c};return a.getData(b.getParameterizedUrl("GET_EVENT_BY_ID_DTO",f),null,function(a){return d(a.data)},function(a){e(a)})},this.inactiveEventSession=function(c,d,e,f){var g={};g.sessionId=c,a.getData(b.getParameterizedUrl("INACTIVATE_SESSION",g),null,function(a){a&&a.data&&e(a.data)},function(a){f(a)},{organizationLocationId:d})}}]),angular.module("paripal.eventModule").service("viewFeedbackService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.searchFeedback=function(e,f,g,h){var i={};d.isEmpty(e.conductedBy)||(i.conductedById=e.conductedBy.id),d.isNullOrEmpty(e.startDate)||(i.fromDate=c.convertToServerDate(e.startDate)),d.isNullOrEmpty(e.eventName)||("string"==typeof e.eventName&&(i.eventName=e.eventName),i.eventId=e.eventName.id),d.isNullOrEmpty(e.professional)||(i.professionalId=e.professional.id),d.isNullOrEmpty(e.sessionName)||(i.sessionId=e.sessionName.id),i.pageNumber=e.pageNumber,i.recordsPerPage=e.recordsPerPage,e.sorters&&(i.sorters=e.sorters),a.postData(b.getUrl("SEARCH_EVENT_FEEDBACK"),i,function(a){g(a.data)},function(a){h(a)},f)},this.getSessionProfessionalName=function(c,d,e,f){return a.getData(b.getParameterizedUrl("GET_SESSION_PROFESSIONAL",c),null,function(a){return d(a.data)},function(a){e(a)},f)}}]),angular.module("paripal.expressionOfInterest").controller("ExpressionFollowUpCtrl",["$scope","$rootScope","$stateParams","$state","expressionListService","expressionFollowUpService","notify","$translate","utilService","baseService","httpService","urlService","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.orgTypeFilter={},/*$scope.requestStatusId = {};
            $scope.closureReasonId = {};*/
a.ifCloseStatus=!1,a.closeFollowUp=!1,a.disabled=!1,a.maxDate=new Date,a.minDateValidFrom=new Date,a.requestStatusSelected=!1,a.disableStatus=!1,a.editFollowUp=!1,a.explressionFollowupSpinner=!1,i.isEmpty(j.getLoggedInUser())||(a.loggedInUser=j.getLoggedInUser().displayName),a.setData=function(){a.WSOrganizationExpressionOfInterest.organizationTypeId&&a.WSOrganizationExpressionOfInterest.organizationTypeId.id&&(a.orgTypeFilter.id=a.WSOrganizationExpressionOfInterest.organizationTypeId.id),a.WSOrganizationExpressionOfInterest.systemOrganizationId&&(a.systemOrganizationValueId=a.WSOrganizationExpressionOfInterest.systemOrganizationId),a.WSOrganizationExpressionOfInterest.requestStatusId&&a.WSOrganizationExpressionOfInterest.requestStatusId.id&&(a.requestStatusValueId=a.WSOrganizationExpressionOfInterest.requestStatusId.id,
//$scope.WSOrganizationExpressionOfInterest.requestStatusId = $scope.WSOrganizationExpressionOfInterest.requestStatusId.id;
"Completed"!==a.WSOrganizationExpressionOfInterest.requestStatusId.code&&"Rejected"!==a.WSOrganizationExpressionOfInterest.requestStatusId.code&&"Refused"!==a.WSOrganizationExpressionOfInterest.requestStatusId.code||(a.disabled=!0)),a.WSOrganizationExpressionOfInterest.closureReasonId&&a.WSOrganizationExpressionOfInterest.closureReasonId.id&&(a.closureReasonValueId=a.WSOrganizationExpressionOfInterest.closureReasonId.id,a.disableStatus=!0),i.isEmpty(j.getLoggedInUser())||(a.WSOrganizationExpressionOfInterest.userByRequestClosedById=j.getLoggedInUser().id),"closeFollopUp"===c.type,a.WSOrganizationExpressionOfInterest.requestClosureDate||(a.WSOrganizationExpressionOfInterest.requestClosureDate=m("timestampToDate")(new Date,"MM/dd/yyyy"))},a.loadListOfOrganizations=function(){e.loadListOfOrganizations(function(b){i.isEmpty(b)||(a.sysOrgList=b)},function(a){})},a.loadListOfOrganizations(),a.saveFollowUpDetails=function(){return"closeFollopUp"===c.type&&"Pending"==a.WSOrganizationExpressionOfInterest.requestStatusId.code?void g("error","Please select status other than Pending"):(a.explressionFollowupSpinner=!0,void f.saveExpressionFollowUp(a.WSOrganizationExpressionOfInterest,function(){a.explressionFollowupSpinner=!1,g("success",h.instant("ADDED_SUCCESS")),d.go("expressionlist",{type:""})},function(b){a.explressionFollowupSpinner=!1,a.error=b}))},a.cancel=function(){i.goBackToPrevState()},a.loadListOfRequestStatus=function(){k.getData(l.getUrl("GET_ORG_REQUEST_STATUS"),null,function(b){a.requestStatusList=angular.fromJson(b.data),"editFollopUp"===c.type&&a.requestStatusList.splice(0,2),"closeFollopUp"===c.type&&
//$scope.closeFollowUp = true;
angular.forEach(a.requestStatusList,function(a,b){"Completed"===a.code})},function(a){})},a.loadListOfRequestStatus(),a.requestStatusChanged=function(){if("Rejected"===a.WSOrganizationExpressionOfInterest.requestStatusId.code||"Refused"===a.WSOrganizationExpressionOfInterest.requestStatusId.code){a.requestStatusSelected=!0;
//$scope.ifCloseStatus = true;
var b=l.getUrl("GET_ORG_CLOSURE_REASON");b+=a.WSOrganizationExpressionOfInterest.requestStatusId.id,k.getData(b,null,function(b){a.closureReasonList=angular.fromJson(b.data)},function(a){})}else a.requestStatusSelected=!1,a.WSOrganizationExpressionOfInterest.closureReasonId=null},a.init=function(){a.explressionFollowupSpinner=!0,"editFollopUp"===c.type?(a.pageState="edit",a.editFollowUp=!0):"viewFollopUp"===c.type?(a.pageState="view",a.disabled=!0):"closeFollopUp"===c.type&&(a.pageState="close",a.ifCloseStatus=!0),c.data?(a.WSOrganizationExpressionOfInterest=c.data,a.setData(),a.explressionFollowupSpinner=!1):c.expressionId&&e.getExpressionOfInterestById(c.expressionId,function(b){a.explressionFollowupSpinner=!1,a.WSOrganizationExpressionOfInterest=b,"closeFollopUp"===c.type?a.setData(!0):a.setData(!1)},function(b){a.explressionFollowupSpinner=!1,a.error=b})},a.init()}]),angular.module("paripal.expressionOfInterest").controller("ExpressionListCtrl",["$scope","$rootScope","$stateParams","datatableconfig","$state","expressionListService","notify","$translate","serverSidePagination","httpService","urlService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WSOrgExpressionOfInterestSearchCriteria={},a.organizationType={},a.organizationTypeFilter={},a.organizationTypeFilter.dataValue={},/*$scope.requestStatus = {};
            $scope.requestStatusFilter = {};*/
a.filterCriteria={},a.explressionofintgerestSpinner=!1,a.followUpExpressionSpinner=!1,a.searchExpressionOfInterest=function(){a.explressionofintgerestSpinner=!0,a.WSOrgExpressionOfInterestSearchCriteria.pageNumber=a.currentPage,a.WSOrgExpressionOfInterestSearchCriteria.recordsPerPage=a.itemPerPage,f.searchExpressionOfInterest(a.WSOrgExpressionOfInterestSearchCriteria,a.organizationType,function(b){a.explressionofintgerestSpinner=!1,a.expressionOfInterestList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.explressionofintgerestSpinner=!1,a.error=b})},a.loadListOfRequestStatus=function(){j.getData(k.getUrl("GET_ORG_REQUEST_STATUS"),null,function(b){a.requestStatusList=angular.fromJson(b.data)},function(a){})},a.loadListOfRequestStatus(),a.clear=function(){a.WSOrgExpressionOfInterestSearchCriteria={},a.filterCriteria={},a.organizationType={},a.organizationTypeFilter={},a.organizationTypeFilter.dataValue={},/*$scope.requestStatus = {};
                $scope.requestStatusFilter = {};*/
a.$broadcast("clearPicklistData"),a.searchExpressionOfInterest()},a.fetchRecords=function(){a.WSOrgExpressionOfInterestSearchCriteria=a.filterCriteria,a.organizationType=a.organizationTypeFilter,l.isEmpty(a.organizationType.dataValue)&&delete a.organizationType,/*$scope.requestStatus = $scope.requestStatusFilter;*/
a.searchExpressionOfInterest()},a.addExpressionOfInterest=function(){e.go("manageexpression",{type:""})},a.followUpExpression=function(b,c){a.followUpExpressionSpinner=!0;var d=b;f.getExpressionOfInterestById(d,function(b){a.followUpExpressionSpinner=!1;var f=b;"view"===c||"edit"===c?e.go("manageexpression",{type:c,data:f,expressionId:d}):e.go("expressionfollowup",{type:c,data:f,expressionId:d})},function(b){a.followUpExpressionSpinner=!1,a.error=b})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchExpressionOfInterest()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchExpressionOfInterest()};
//datatble config json
var m={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=d.setOptionProperties(m),a.dtColumnDefs=d.setColumnProperties({}),a.init=function(){a.searchExpressionOfInterest()},a.init()}]),angular.module("paripal.expressionOfInterest").controller("ManageExpressionCtrl",["$scope","$rootScope","$stateParams","$state","manageExpressionService","expressionListService","notify","$translate","utilService","OrgSubscriptionListService","ManageOrgSubscriptionService","EmergencyTransactionService","$mdDialog","commonConstants","datatableconfig","$timeout","manageRequestService","httpService","urlService","calendarService","dateconvertor","$filter","commonCalendarService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(a){}/* Calendar functionality start */
x.$inject=["$scope"],a.calendarRequired=!1,a.disableAddAvailability=!1,a.minDateForStart=new Date,a.maxDateForStart=null,a.minDateForEnd=new Date,a.requiredValue=!1,a.disableRemoveAvailability=!0,/*$scope.minDate=new Date($scope.today.getFullYear(),$scope.today.getMonth() - 2,$scope.today.getDate()).toDateString();*/
a.availabilityDetails=[{}],a.calendarObj={},a.CalendarPopUpValues={},a.CalendarPopUpValues.requestStartDate=u.convertToServerDate(new Date),a.minDateValidFrom=u.convertToServerDate(new Date),a.addAvailability=function(){
//TODO check the length
a.availabilityDetails.length<=5&&(a.availabilityDetails.push({}),5==a.availabilityDetails.length&&(a.disableAddAvailability=!0)),a.availabilityDetails.length>1&&(a.disableRemoveAvailability=!1)},/* $scope.whetherAllDayLong = false;
        $scope.allDayLong = function () {
            for (var i = 0; i <= $scope.availabilityDetails.length; i++) {
                $scope.availabilityDetails[i].startTime = "00:00:00";
            }
        } */
a.checkBoxClicked=function(){a.requiredValue=t.checkBoxValidationCheck(a.availabilityDetails)},a.removeAvailability=function(b){a.availabilityDetails.splice(b,1),1==a.availabilityDetails.length&&(a.disableRemoveAvailability=!0),a.availabilityDetails.length<5&&(a.disableAddAvailability=!1)},/* Calendar functionality end */
a.subscriptionTypeRequired=!1,a.treatmentTypes=[],a.addressData={},a.selectedOrg={},a.selectedOrgLoc={},a.maxDate=new Date,a.disableOrgSubscription=!0,a.idGeneratorObject={codes:[{requestCode:"",disable:!1,value:"requestCode1"},{requestCode:"",disable:!1,value:"requestCode2"}]},a.WSOrganizationExpressionOfInterest={},a.orgAdditionalDetails={},a.orgAdditionalDetails.wsCalendarMaster={},a.WSSystemOrganization={},a.organizationType={},a.WSOrgSubscription={},a.orgMobileNumber1=null,a.orgEmail1=null,a.explressionOfIntgerestViewSpinner=!1,a.orgNameChanged=function(b){i.isFieldEmpty(b)||"ORG_SUBSCRIPTION"!=a.screenOptions||(a.CalendarPopUpValues.professional=b+" calendar")},a.validateAvailability=function(a){var b=!0;return angular.forEach(a,function(a,c){var d=angular.copy(a);angular.forEach(a.timings,function(a,c){var e=new Date,f=new Date;e.setHours(parseInt(a.startTime.substring(0,2))),e.setMinutes(parseInt(a.startTime.substring(3,5))),f.setHours(parseInt(a.endTime.substring(0,2))),f.setMinutes(parseInt(a.endTime.substring(3,5))),angular.forEach(d.timings,function(a,d){var g=new Date,h=new Date;g.setHours(parseInt(a.startTime.substring(0,2))),g.setMinutes(parseInt(a.startTime.substring(3,5))),h.setHours(parseInt(a.endTime.substring(0,2))),h.setMinutes(parseInt(a.endTime.substring(3,5))),(e.getTime()<g.getTime()&&f.getTime()>g.getTime()||e.getTime()<h.getTime()&&f.getTime()>h.getTime())&&c!=d&&(b=!1)})})}),b},a.saveExpressionOfInterest=function(c){if(b.showSpinner=!0,"SALES_PERSON_MEET"==a.screenOptions&&(a.CalendarPopUpValues={},a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[]),i.isFieldEmpty(a.orgMobileNumber1)||i.isFieldEmpty(a.orgEmail1)||(a.orgAdditionalDetails.email1=a.orgEmail1,a.orgAdditionalDetails.mobileNumber1=a.orgMobileNumber1,a.orgAdditionalDetails.landlineNumber1=a.orgMobileNumber1),a.orgAdditionalDetails.wsCalendarMaster.id=null,a.orgAdditionalDetails.wsCalendarMaster.version=0,a.orgAdditionalDetails.wsCalendarMaster.name=a.CalendarPopUpValues.professional,a.orgAdditionalDetails.wsCalendarMaster.startDate=a.CalendarPopUpValues.requestStartDate,a.orgAdditionalDetails.wsCalendarMaster.endDate=a.CalendarPopUpValues.requestEndDate,a.CalendarPopUpValues.defaultAvailablity=[],a.orgAdditionalDetails.wsCalendarMaster.nonWorkingDays=[],a.availabilityDetails){var f=a.availabilityDetails,j=!0;angular.forEach(f,function(b,c){var d=[],e={};b.monday&&d.push("Monday"),b.tuesday&&d.push("Tuesday"),b.wednesday&&d.push("Wednesday"),b.thursday&&d.push("Thursday"),b.friday&&d.push("Friday"),b.saturday&&d.push("Saturday"),b.sunday&&d.push("Sunday"),e.defaultWorkingDays=d;var f=b.startTime,g=b.endTime;e.defaultStartTime=v("date")(f,"HH:mm"),e.defaultEndTime=v("date")(g,"HH:mm"),a.CalendarPopUpValues.defaultAvailablity.push(e)}),angular.forEach(a.CalendarPopUpValues.defaultAvailablity,function(a,c){a.defaultStartTime>a.defaultEndTime&&(g("Error",h.instant("END_TIME_GREATER_THAN_START_TIME")),j=!1,b.showSpinner=!1)});var k=w.convertCalendarObject(a,a.CalendarPopUpValues,a.orgAdditionalDetails.wsCalendarMaster,"Server");k||errorCallBack(!0),a.orgAdditionalDetails.wsCalendarMaster.defaultAvailabilities=k,delete a.orgAdditionalDetails.wsCalendarMaster.nonWorkingDays,a.orgAdditionalDetails.wsCalendarMaster.startDate&&(a.orgAdditionalDetails.wsCalendarMaster.startDate=u.convertToServerDate(a.orgAdditionalDetails.wsCalendarMaster.startDate)),a.orgAdditionalDetails.wsCalendarMaster.endDate&&(a.orgAdditionalDetails.wsCalendarMaster.endDate=u.convertToServerDate(a.orgAdditionalDetails.wsCalendarMaster.endDate)),a.validateAvailability(a.orgAdditionalDetails.wsCalendarMaster.defaultAvailabilities)?j&&(a.orgAdditionalDetails.wsCalendarMaster.defaultAvailabilities=a.orgAdditionalDetails.wsCalendarMaster.defaultAvailabilities):g("error",h.instant("INVALID_AVAILABILITY_COMBINATIONS"))}a.CalendarPopUpValues.defaultAvailablity=[],a.orgAdditionalDetails.treatmentTypeIds=a.treatmentTypes,a.WSOrganizationExpressionOfInterest.interestedOrganizationAddresses=a.addressData,a.WSOrganizationExpressionOfInterest.organizationTypeId=a.organizationType.dataValue,e.saveExpressionOfInterest(a.WSOrganizationExpressionOfInterest,a.WSOrgSubscription,a.WSSystemOrganization,a.orgAdditionalDetails,function(c){b.showSpinner=!1,g("success",h.instant(c.successMessage)),i.isFieldEmpty(c.response)||i.isFieldEmpty(c.response.transactionId)?d.go("login"):(a.transactionId=c.response.transactionId,a.isPageDisable=!0)},function(d){if(b.showSpinner=!1,a.expressionSaveResponse=d,d.data&&1002==d.data.errorCodeValue&&!c){var e=m.confirm().title(h.instant("USER_ALREADY_EXIST")).textContent(h.instant("EOI_USER_ALREADY_EXIST_MSG")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));m.show(e).then(function(){a.saveExpressionOfInterest(!0)},function(){})}},c)},a.$watch("screenOptions",function(b){b&&"add"==a.pageState&&(a.WSOrganizationExpressionOfInterest.whetherInterestInSponsorship&&!a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider?(a.WSOrganizationExpressionOfInterest.whetherInterestInSponsorship=!1,/* $scope.CalendarPopUpValues = {}; */
a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[]):a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider&&!a.WSOrganizationExpressionOfInterest.whetherInterestInSponsorship?(a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider=!1,/* $scope.CalendarPopUpValues = {}; */
a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[]):a.WSOrganizationExpressionOfInterest.whetherInterestInSponsorship&&a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider&&(a.WSOrganizationExpressionOfInterest.whetherInterestInSponsorship=!1,a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider=!1,/* $scope.CalendarPopUpValues = {}; */
a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[]))},!0),a.$watch("WSOrganizationExpressionOfInterest.whetherInterestInSponsorship",function(b){if(b&&!i.isFieldEmpty(a.WSSystemOrganization.systemOrganizationId)&&angular.fromJson(a.WSSystemOrganization.systemOrganizationId).id){var c={};c.pickListCode="subscriptionFor",a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider?c.pickListItemCode="SUBSCRIPTION_TYPE_SERVICE_PROVIDER":c.pickListItemCode="SUBSCRIPTION_TYPE_SPONSOR",q.getPicklistWSByCode(c,function(b){j.getSubscriptionType(angular.fromJson(a.WSSystemOrganization.systemOrganizationId).id,b.data.id,function(b){a.subscriptionTypeList=b}),/* $scope.CalendarPopUpValues = {}; */
a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[],"ORG_SUBSCRIPTION"==a.screenOptions?(a.calendarRequired=!0,a.requiredValue=!0):"SALES_PERSON_MEET"==a.screenOptions&&(a.calendarRequired=!1,a.requiredValue=!1)},function(a){})}else if(a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider){var c={};c.pickListCode="subscriptionFor",c.pickListItemCode="SUBSCRIPTION_TYPE_SERVICE_PROVIDER",q.getPicklistWSByCode(c,function(b){j.getSubscriptionType(angular.fromJson(a.WSSystemOrganization.systemOrganizationId).id,b.data.id,function(b){a.subscriptionTypeList=b}),/* $scope.CalendarPopUpValues = {}; */
a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[],"ORG_SUBSCRIPTION"==a.screenOptions?(a.calendarRequired=!0,a.requiredValue=!0):"SALES_PERSON_MEET"==a.screenOptions&&(a.calendarRequired=!1,a.requiredValue=!1)},function(a){})}},!0),a.$watch("WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider",function(b){if(b&&!i.isFieldEmpty(a.WSSystemOrganization.systemOrganizationId)&&angular.fromJson(a.WSSystemOrganization.systemOrganizationId).id){var c={};c.pickListCode="subscriptionFor",c.pickListItemCode="SUBSCRIPTION_TYPE_SERVICE_PROVIDER",q.getPicklistWSByCode(c,function(b){j.getSubscriptionType(angular.fromJson(a.WSSystemOrganization.systemOrganizationId).id,b.data.id,function(b){a.subscriptionTypeList=b}),/* $scope.CalendarPopUpValues = {}; */
a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[],"ORG_SUBSCRIPTION"==a.screenOptions?(a.calendarRequired=!0,a.requiredValue=!0):"SALES_PERSON_MEET"==a.screenOptions&&(a.calendarRequired=!1,a.requiredValue=!1)},function(a){})}else if(a.WSOrganizationExpressionOfInterest.whetherInterestInSponsorship){var c={};c.pickListCode="subscriptionFor",a.WSOrganizationExpressionOfInterest.whetherInterestedAsAserviceProvider?c.pickListItemCode="SUBSCRIPTION_TYPE_SERVICE_PROVIDER":c.pickListItemCode="SUBSCRIPTION_TYPE_SPONSOR",q.getPicklistWSByCode(c,function(b){j.getSubscriptionType(angular.fromJson(a.WSSystemOrganization.systemOrganizationId).id,b.data.id,function(b){a.subscriptionTypeList=b}),/* $scope.CalendarPopUpValues = {}; */
a.availabilityDetails=[{}],i.isFieldEmpty(a.WSOrgSubscription)||i.isFieldEmpty(a.WSOrgSubscription.subscriptionType)||delete a.WSOrgSubscription.subscriptionType,a.treatmentTypes=[],"ORG_SUBSCRIPTION"==a.screenOptions?(a.calendarRequired=!0,a.requiredValue=!0):"SALES_PERSON_MEET"==a.screenOptions&&(a.calendarRequired=!1,a.requiredValue=!1)},function(a){})}},!0),a.setData=function(){a.WSOrganizationExpressionOfInterest.organizationTypeId&&a.WSOrganizationExpressionOfInterest.organizationTypeId.id&&(a.organizationType.id=a.WSOrganizationExpressionOfInterest.organizationTypeId.id),a.WSOrganizationExpressionOfInterest.interestedOrganizationAddresses&&(a.addressData=a.WSOrganizationExpressionOfInterest.interestedOrganizationAddresses),i.isEmpty(a.WSOrganizationExpressionOfInterest.requestStatusId)||"Completed"!==a.WSOrganizationExpressionOfInterest.requestStatusId.code&&"Rejected"!==a.WSOrganizationExpressionOfInterest.requestStatusId.code&&"Refused"!==a.WSOrganizationExpressionOfInterest.requestStatusId.code||(a.expressionDisabled=!0),a.WSOrganizationExpressionOfInterest.systemOrganizationId&&(a.systemOrganizationValueId=a.WSOrganizationExpressionOfInterest.systemOrganizationId)},a.changeScreen=function(a){var b;b="ORG_SUBSCRIPTION"==a?"step2":"step4",p(function(){if(!i.isFieldEmpty(b)){var a=document.getElementById(b);angular.element(a).triggerHandler("click")}},0)},a.changeToSecondScreen=function(){var b;a.subscriptionTypeRequired=!1,b="step2",p(function(){if(!i.isFieldEmpty(b)){var a=document.getElementById(b);angular.element(a).triggerHandler("click")}},0)},a.changeSecondScreen=function(b){var c;"ORG_SUBSCRIPTION"==b?(a.subscriptionTypeRequired=!0,c="step3"):"SALES_PERSON_MEET"==b&&(a.subscriptionTypeRequired=!1),p(function(){if(!i.isFieldEmpty(c)){var a=document.getElementById(c);angular.element(a).triggerHandler("click")}},0)},a.changeToPreviousScreen=function(a){var b;b="ORG_SUBSCRIPTION"==a?"step3":"step1",p(function(){if(!i.isFieldEmpty(b)){var a=document.getElementById(b);angular.element(a).triggerHandler("click")}},0)},a.loadListOfOrganizations=function(){f.loadListOfOrganizations(function(b){i.isEmpty(b)||(a.sysOrgList=b,a.sysOrgList.length>0&&(a.systemOrganizationValueId=a.sysOrgList[0].id))},function(a){})},a.getSubscriptionTypes=function(b){var c;a.systemOrganizationName,a.subscriptionTypeList=[],"string"==typeof b?(c=angular.fromJson(b).id,a.systemOrganizationName=angular.fromJson(b).value):(c=b.id,a.systemOrganizationName=b.value)},a.loadListOfOrganizations(),a.paymentCall=function(b){i.isFieldEmpty(b)&&(b={transactionId:a.transactionId});n.transactionTypes.SUBSCRIPTION_TYPE;l.getWhetherBillDetails(b,function(b){localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:n.transactionTypes.SUBSCRIPTION_TYPE})),d.go("billsummaryview",{transactionId:a.transactionId})},function(b){var c=m.confirm().title(h.instant("FEE_TYPE_NOT_FOUND_TITLE")).textContent(h.instant("FEE_TYPE_NOT_FOUND_BODY")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));m.show(c).then(function(){},function(){a.cancel()})},{handleError:!1})},a.cancel=function(){i.goBackToPrevState()},/*************************************** Organization Subscription : START **************************************/
a.getSubscriptionTypeById=function(b){"add"==a.pageState&&(a.WSOrgSubscription.subscriptionFrom="",a.WSOrgSubscription.subscriptionTill=""),a.subscriptionTypeId=angular.fromJson(b).id,k.getSubscriptionTypeById(a.subscriptionTypeId,function(b){a.WSSubscriptionType=b,a.noOfValidDays=a.WSSubscriptionType.noOfValidDays})},a.validFromChanged=function(b){a.WSOrgSubscription.subscriptionTill=k.validFromChanged(b,a.noOfValidDays)},a.close=function(){m.cancel()},a.viewSubscriptionTypeServices=function(b){if(a.WSSubscriptionType.subscriptionTypeServiceses.length>0)m.show({scope:a,preserveScope:!0,controller:x,templateUrl:"app/modules/billing-setup/views/view-subscription-type-services.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:n.dialogBox.clickOutsideToClose});else{var c=m.alert().title(h.instant("DETAILS")).htmlContent('<div class="padding-t-10"><b>'+h.instant("USER_LIMIT")+": </b>"+a.WSSubscriptionType.userLimit+"</div>").ok(h.instant("OK"));m.show(c).then(function(){},function(){})}};var y=n.gridConfigurations;a.options=o.setOptionProperties(y),/*************************************** Organization Subscription : END **************************************/
a.init=function(){a.step1Css="btn btn-primary btn-circle",a.pageState="add","edit"===c.type?a.pageState="edit":"view"===c.type&&(a.pageState="view",a.expressionDisabled=!0),"add"==a.pageState&&(a.screenOptions="ORG_SUBSCRIPTION",a.disableOrgSubscription=!1),c.data?(a.WSOrganizationExpressionOfInterest=c.data,a.setData(),a.screenOptions="Completed"==c.data.requestStatusId.code?"ORG_SUBSCRIPTION":"SALES_PERSON_MEET"):c.expressionId&&(a.explressionOfIntgerestViewSpinner=!0,f.getExpressionOfInterestById(c.expressionId,function(b){a.WSOrganizationExpressionOfInterest=b,a.explressionOfIntgerestViewSpinner=!1,a.setData()},function(b){a.explressionOfIntgerestViewSpinner=!1,a.error=b}))},a.init()}]),angular.module("paripal.expressionOfInterest").filter("checkNull",["$filter","utilService",function(a,b){return function(a){return b.isFieldEmpty(a)}}]),angular.module("paripal.expressionOfInterest").service("expressionListService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.searchExpressionOfInterest=function(e,f,g,h){d.isEmpty(f)||(e.organizationTypeId={},e.organizationTypeId.id=f.dataValue.id),e.requestFrom&&(e.requestFrom=c.convertToServerDate(e.requestFrom)),e.requestTill&&(e.requestTill=c.convertToServerDate(e.requestTill)),a.postData(b.getUrl("SEARCH_EXPRESSION_INTEREST"),e,function(a){a.data&&a.data.data?g(a.data):h(a)},function(a){h(a)})},this.getExpressionOfInterestById=function(c,d,f){var g={};g.expressionOfInterestId=c,a.getData(b.getParameterizedUrl("GET_EXPRESSION_OF_INTEREST_BY_ID",g),null,function(a){a&&a.data?(a.data.requestDate=e("timestampToDate")(a.data.requestDate,"MM/dd/yyyy"),a.data.requestClosureDate&&(a.data.requestClosureDate=e("timestampToDate")(a.data.requestClosureDate,"MM/dd/yyyy")),a.data.commencementDate&&(a.data.commencementDate=e("timestampToDate")(a.data.commencementDate,"MM/dd/yyyy")),d(a.data)):f(a)},function(a){f(a)})},this.loadListOfOrganizations=function(c,d){a.getData(b.getUrl("GET_SYSTEM_ORGANIZATIONS"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})}}]),angular.module("paripal.expressionOfInterest").service("expressionFollowUpService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveExpressionFollowUp=function(d,e,f){d.requestDate&&(d.requestDate=c.convertToServerDate(d.requestDate)),d.requestClosureDate&&(d.requestClosureDate=c.convertToServerDate(d.requestClosureDate)),d.commencementDate&&(d.commencementDate=c.convertToServerDate(d.commencementDate)),d.systemOrganizationId&&(d.systemOrganizationId=JSON.parse(d.systemOrganizationId).id);var g={};g.expressionOfInterestId=d.id,a.putData(b.getParameterizedUrl("SAVE_EXPRESSION_FOLLOW_UP",g),d,function(a){a.data?e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.expressionOfInterest").service("manageExpressionService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveExpressionOfInterest=function(e,f,g,h,i,j,k){var l={};if(l.wsOrganizationExpressionOfInterest=angular.copy(e),/******  Expression of interest object  *******/
l.wsOrganizationExpressionOfInterest.requestDate&&(l.wsOrganizationExpressionOfInterest.requestDate=c.convertToServerDate(e.requestDate)),l.wsOrganizationExpressionOfInterest.requestClosureDate&&(l.wsOrganizationExpressionOfInterest.requestClosureDate=c.convertToServerDate(e.requestClosureDate)),g.systemOrganizationId&&(l.wsOrganizationExpressionOfInterest.systemOrganizationId=JSON.parse(g.systemOrganizationId).id),d.isFieldEmpty(e.commencementDate)||(l.wsOrganizationExpressionOfInterest.commencementDate=c.convertToServerDate(e.commencementDate)),/******  Organization Subscription object  *******/
d.isFieldEmpty(f)||(l.wsOrganizationSubscriber=angular.copy(f),d.isFieldEmpty(f.subscriptionType)||(l.wsOrganizationSubscriber.subscriptionType=angular.fromJson(f.subscriptionType)),d.isFieldEmpty(f.subscriptionFrom)||(l.wsOrganizationSubscriber.subscriptionFrom=c.convertToServerDate(f.subscriptionFrom)),d.isFieldEmpty(f.subscriptionTill)||(l.wsOrganizationSubscriber.subscriptionTill=c.convertToServerDate(f.subscriptionTill))),/******  orgAdditionalDetails object  *******/
d.isFieldEmpty(h)||(l.orgAdditionalDetails=h),l.wsOrganizationExpressionOfInterest.id){var m={};m.id=e.id,a.putData(b.getParameterizedUrl("UPDATE_EXPRESSION_OF_INTEREST",m),l.wsOrganizationExpressionOfInterest,function(a){a&&a.data?i(a.data):j(a)},function(a){j(a)})}else{var n=b.getUrl("CREATE_EXPRESSION_OF_INTEREST");k&&(n+="?forceCreate=true"),a.postData(n,l,function(a){a&&a.data&&i(a.data)},function(a){j(a)},{handleError:!1})}}}]),angular.module("paripal.firstAidModule").controller("FirstAidListCtrl",["$scope","$rootScope","$stateParams","$state","baseService","firstAidListService","notify","$translate","utilService","commonConstants",function(a,b,c,d,e,f,g,h,i,j){"use strict";a.WSFirstAidMediaData={},a.WSFirstAidDocumentData={},a.searchString="Road",
//$scope.noMedia = false;
a.noDocument=!1,a.firstAidSpinner=!1,
//  $scope.firstNoMedia = false;
a.disableSearch=!0,a.otherTab=!1,a.firstAidVoteObj=[];var k=null,l=function(){a.mediaPageNo=1,a.documentPageNo=1};a.viewPrintFile=function(b){var c=new Object;c.fileName=b.fileName,c.orgLocId=b.orgLocId,c.resourceId=b.resourceId,c.docType=j.documentTypes.resource,c.docSubType=j.documentSubTypes.resource,c.isResource=!0,a.fileResource=c,a.viewFileContent=!0,"Document"==b.resourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0};var m=function(b){for(var c=0;c<b.length;c++)"ROAD_ACCIDENTS"==b[c].code&&(a.roadAccidentObj=b[c]),"HOME_EMERGENCIES"==b[c].code&&(a.homeEmergenciesObj=b[c]),"HEART_EMERRGENCIES"==b[c].code&&(a.heartEmergenciesObj=b[c]),"BURNS"==b[c].code&&(a.burnsObj=b[c]);n(a.roadAccidentObj,!1),o(a.roadAccidentObj,!1),k=a.roadAccidentObj};a.loadListOfFirstAidTypes=function(){f.loadListOfFirstAidTypes(function(b){i.isEmpty(b)||(a.firstAidTypeList=b,m(a.firstAidTypeList))},function(a){})};var n=function(c,d,e){a.WSFirstAidMediaData.pageNo=a.mediaPageNo,a.firstAidSpinner=!0,a.mediaResultFound=!1,
//  $scope.firstNoMedia = false;
a.otherTab&&!i.isNullOrEmpty(a.searchString)?a.WSFirstAidMediaData.searchString=a.searchString:a.WSFirstAidMediaData.searchString="",i.isEmpty(c)?a.WSFirstAidMediaData.firstAidTypeId=null:a.WSFirstAidMediaData.firstAidTypeId=c.id,a.multimediaModule=[],a.multimediaFirst=[],f.getMultimediaDetails(a.WSFirstAidMediaData,function(c){var d=c.data;a.firstAidSpinner=!1,a.multimediaFirst=d[0],a.mediaResultFound=7*a.mediaPageNo<c.count;
// $scope.noMedia = true;
//  $scope.firstNoMedia = true;
// if (sucessResponse.length >= 1) {
//$scope.noMedia = false;
//    $scope.firstNoMedia = false;
//  }
for(var e=0;e<d.length;e++)0!=e&&a.multimediaModule.push(d[e]);i.isEmpty(b.loggedInUserDetails)&&(angular.forEach(a.multimediaModule,function(a,c){angular.forEach(b.firstAidVotedObj,function(b,c){a.resourceId==b.resourceId&&1==b.vote?a.isVotedUp=!0:a.resourceId==b.resourceId&&0==b.vote&&(a.isVotedUp=!1)})}),angular.forEach(b.firstAidVotedObj,function(b,c){a.multimediaFirst.resourceId==b.resourceId&&1==b.vote?a.multimediaFirst.isVotedUp=!0:a.multimediaFirst.resourceId==b.resourceId&&0==b.vote&&(a.multimediaFirst.isVotedUp=!1)}))},function(b){a.firstAidSpinner=!1})},o=function(c,d,e){a.WSFirstAidDocumentData.pageNo=a.documentPageNo,a.noDocumentResultFound=!1,a.otherTab&&!i.isNullOrEmpty(a.searchString)?a.WSFirstAidDocumentData.searchString=a.searchString:a.WSFirstAidDocumentData.searchString="",i.isEmpty(c)?a.WSFirstAidDocumentData.firstAidTypeId=null:a.WSFirstAidDocumentData.firstAidTypeId=c.id,a.documentModule=[],f.getDocumentDetails(a.WSFirstAidDocumentData,function(c){var d=c.data;a.documentModule=d,a.documentModule.length>0?(a.noDocumentResultFound=5*a.mediaPageNo<c.count,a.noDocument=!1,i.isEmpty(b.loggedInUserDetails)&&angular.forEach(a.documentModule,function(a,c){angular.forEach(b.firstAidVotedObj,function(b,c){a.resourceId==b.resourceId&&1==b.vote?a.isVotedUp=!0:a.resourceId==b.resourceId&&0==b.vote&&(a.isVotedUp=!1)})})):(a.noDocumentResultFound=!1,a.noDocument=!0)},function(a){})};a.getMediaDocumentDetails=function(b){a.firstAidVoteObj=[],"ROAD_ACCIDENTS"==b.code&&(a.searchString="Road"),"HOME_EMERGENCIES"==b.code&&(a.searchString="Home"),"HEART_EMERRGENCIES"==b.code&&(a.searchString="Heart"),"BURNS"==b.code&&(a.searchString="Burns"),l(),k=b,a.disableSearch=!0,a.otherTab=!1,n(b,!1,!1),o(b,!1,!1)},a.enableSearch=function(){l(),a.disableSearch=!1,k="",a.multimediaModule=[],a.multimediaFirst=[],a.documentModule=[],a.otherTab=!0},a.previousMedia=function(b){1!=a.mediaPageNo&&(a.mediaPageNo=a.mediaPageNo-1),n(b,!0,!1)},a.nextMedia=function(b){a.mediaPageNo=a.mediaPageNo+1,n(b,!1,!1)},a.previousDocument=function(b){1!=a.documentPageNo&&(a.documentPageNo=a.documentPageNo-1),o(b,!0,!1)},a.nextDocument=function(b){a.documentPageNo=a.documentPageNo+1,o(b,!1,!1)},a.searchFirstAid=function(){l(),n(null,!1,!0),o(null,!1,!0)},a.updateVoteForResource=function(c,d,g){if(a.isVoted=!1,!i.isNullOrEmpty(c)&&!i.isNullOrEmpty(d)&&(i.isEmpty(b.loggedInUserDetails)||//use case for public user
!i.isEmpty(b.loggedInUserDetails)&&0==b.loggedInUserDetails.isOrganizationUserMode)){var h=new Object;h.vote=c,h.resource={id:d},h.user={},i.isEmpty(b.loggedInUserDetails)?(angular.forEach(b.firstAidVotedObj,function(b,e){b.resourceId==d&&b.vote==c?a.isVoted=!0:b.resourceId==d&&b.vote==!c}),a.isVoted||b.firstAidVotedObj.push({resourceId:d,vote:c})):(angular.forEach(a.firstAidVoteObj,function(b,e){b.resourceId==d&&b.vote==c?a.isVoted=!0:b.resourceId==d&&b.vote==!c}),a.isVoted||a.firstAidVoteObj.push({resourceId:d,vote:c}));var j=null;null!==e.getLoggedInUser()&&(j=e.getLoggedInUser().id,h.user={id:j}),a.isVoted||f.updateVoteForResource(h,j,function(a){
//$scope.setVariables();
//getMultimedia(searchObject, false, false);
//getDocument(searchObject, false, true);
c?(g.upVoteCount=g.upVoteCount+1,!g.isVotedUp&&0!=g.downVoteCount&&g.downVoteCount&&(g.downVoteCount=g.downVoteCount-1),g.isVotedUp=!0):(g.downVoteCount=g.downVoteCount+1,g.isVotedUp&&0!=g.upVoteCount&&g.upVoteCount&&(g.upVoteCount=g.upVoteCount-1),g.isVotedUp=!1)},function(a){})}},a.init=function(){l(),"firstaidlist"==d.current.name&&a.loadListOfFirstAidTypes(),a.isOrgUser=!i.isFieldEmpty(angular.fromJson(e.getLoggedInUser()))&&angular.fromJson(e.getLoggedInUser()).isOrganizationUser&&angular.fromJson(e.getLoggedInUser()).isOrganizationUserMode},a.init()}]),angular.module("paripal.firstAidModule").service("firstAidListService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.getMultimediaDetails=function(c,e,f){if(c.searchStrings=null,!d.isNullOrEmpty(c.searchString)){var g=this.createSearchString(c.searchString);c.searchString=g.searchString,c.searchStrings=g.searchStrings}a.postData(b.getUrl("GET_MULTIMEDIA_RESOURCE_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.getDocumentDetails=function(c,e,f){if(c.searchStrings=null,!d.isNullOrEmpty(c.searchString)){var g=this.createSearchString(c.searchString);c.searchString=g.searchString,c.searchStrings=g.searchStrings}a.postData(b.getUrl("GET_DOCUMENTS_RESOURCE_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.loadListOfFirstAidTypes=function(c,d){a.getData(b.getUrl("GET_FIRST_AID_TYPES"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.updateVoteForResource=function(c,d,e,f){a.putData(b.getUrl("UPDATE_RESOURCE_RATING"),c,function(a){a&&e(a)},function(a){f(a)})},this.createSearchString=function(a){var b={},c=a.split(/[ ,]+/);/*var searchString = "";
        	for( var i= 0; i< searchStrings.length;i++){
	        	if(i == 0){
	        		searchString = "'" +searchStrings[i];
	        	}else{
	        		searchString = searchString +"','" + searchStrings[i];
	        	}
        	}
        	Obj.searchString = searchString + "'";*/
return b.searchStrings=c,b}}]),angular.module("paripal.forumModule").controller("addForumController",["$scope","$state","$window","$stateParams","ForumService","$filter","CategoryService","httpService","urlService","utilService","notify","$translate","baseService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){g.getCategoryList(function(b){a.categories=b})}function p(){b.go("listofForums",d),b.go("listofForums",{type:null,data:null})}function q(c){if(c.$valid){/*if($scope.forum.forumValidFrom && $scope.forum.forumValidTo){
                    //$scope.forum.forumValidFrom = new Date($scope.forum.forumValidFrom);
                    //$scope.forum.forumValidTo = new Date($scope.forum.forumValidTo);
                    //$scope.forum.adminId={"id":1,"value":$scope.forum.adminId.id};
                    //$scope.forum.adminId=$scope.ownedBy;
                }*/
var f={};if(f.forumValidFrom=new Date(a.forum.forumValidFrom),f.forumValidTo=new Date(a.forum.forumValidTo),f.category=a.forum.category,f.forumDescription=a.forum.forumDescription,f.forumName=a.forum.forumName,f.forumType=a.forum.forumType,f.forumVisibility=a.forum.forumVisibility,f.adminId=a.ownedBy,a.user.isOrganizationUser&&a.user.isOrganizationUserMode){if(f.orgId=a.user.organizationId,"Organisation Specific"===a.forum.forumType){if(f.orgId=a.forum.orgId,!a.forum.forumVisibility)return void k("error",l.instant("PLEASE_SELECT_FORUM_VISIBILITY"));if(!a.forum.orgId)return void k("error",l.instant("SELECT_ATLEAST_ONE_ORGANIZATION"))}else f.orgId=a.user.organizationId;if(("Clients of Location"===a.forum.forumVisibility||"All Users With Access to Location"===a.forum.forumVisibility)&&0==a.orgLocIds.length)return void k("error",l.instant("SELECT_ATLEAST_ONE_LOCATION"));f.orgLocIds=a.orgLocIds}e.addForums(f,function(a){j.isEmpty(a.successMessage)?k("success",l.instant("RECORD_ADDED_SUCCESSFULLY")):k("success",l.instant(a.successMessage)),b.go("listofForums",d),b.go("listofForums",{type:null,data:null})},function(a){
//$scope.complaintFormSpinner = false;
j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])?k("error",l.instant("FAILED_TO_SAVE_RECORD")):k("error",l.instant(a.data.messages[0]))})}}function r(){var b={};b.userId=a.userId,e.getUserOrgLoc(b,function(b){a.orgLoc=b})}function s(){e.getUserAccessbleOrgLoc(function(b){a.orgList=b},function(){},{orgLocPermission:n.ORG_FORUM_ADD})}a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.userId=a.user.id,a.page1=!0,
//$scope.maxDate = new Date();
a.minDate=new Date,a.forum={},a.forumAddType=localStorage.getItem("AddForumType"),"orgForum"==a.forumAddType&&(a.forum.forumType="Organisation Specific"),a.types=["Public","Organisation Specific","Interest Group"],a.visiblities=["Clients of Organisation","Clients of Location","Internal Users","All Users With Access to Organization","All Users With Access to Location","Paripal Users"],a.registeredByList=[],a.ownedBy="",a.getCategoryList=o,a.addForums=q,a.back=p,a.getUserOrgLoc=r,a.getUserAccessbleOrgLoc=s,a.orgLocIds=[],a.getUserNamesForRoleHistory=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,h.getData(i.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.init=function(){a.user.isOrganizationUser&&a.user.isOrganizationUserMode&&(r(),s());var b=m.getDefaultOrgLocation();j.isFieldEmpty(b)||(a.forum.orgId=b.org.id),o()},a.init(),a.$watch("ownedBy",function(a){}),a.selectOwnedByChanged=function(b){a.ownedBySelect=b}}]),angular.module("paripal.forumModule").controller("categoryCtrl",["$scope","$state","$rootScope","$window","$stateParams","CategoryService","utilService","notify","$translate","baseService","serverSidePagination","datatableconfig",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.categorySearch={},a.categorySearch.pageNumber=a.currentPage,a.categorySearch.recordsPerPage=a.itemPerPage,f.getCategoryListWithPagination(a.categorySearch,function(b){a.categories=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)})}function n(b){a.category?f.saveCategory(a.category,function(a){a&&(g.isEmpty(a.data.successMessage)?h("success",i.instant("RECORD_ADDED_SUCCESSFULLY")):h("success",i.instant(a.data.successMessage)),m())},function(a){
//$scope.complaintFormSpinner = false;
g.isEmpty(a.data)||g.isEmpty(a.data.messages[0])?h("error",i.instant("FAILED_TO_SAVE_RECORD")):h("error",i.instant(a.data.messages[0]))}):h("failure","Required filed data is missing")}function o(b){a.category=b,a.status.open=!0}a.categories=[],a.category={},a.status={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.getCategoryList=m,a.addCategory=n,a.editSelected=o,m(),a.clear=function(){a.category={}};
//data table config
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:4,setDeafultColSortingOrder:"desc"};a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.getCategoryList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getCategoryList()},a.options=l.setOptionProperties(p),a.dtColumnDefs=l.setColumnProperties({})}]),angular.module("paripal.forumModule").controller("editForumCtrl",["$scope","$state","$window","$stateParams","$timeout","$filter","ForumService","CategoryService","utilService","httpService","urlService","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){h.getCategoryList(function(b){a.categories=b})}function o(){b.go("listofForums",d),b.go("listofForums",{type:null,data:null})}function p(){var b={};b.forumId=a.forumId,g.getForumById(b,function(b){a.forum=b,a.orgLocIds=b.orgLocIds,a.ownedBy=b.adminId.value,a.forum.forumValidFrom=f("date")(b.forumValidFrom,"MM/dd/yyyy"),a.forum.forumValidTo=f("date")(b.forumValidTo,"MM/dd/yyyy")})}function q(){var c=angular.copy(a.forum);if(c.forumValidFrom=new Date(a.forum.forumValidFrom),c.forumValidTo=new Date(a.forum.forumValidTo),c.id=a.forum.id,c.category=a.forum.category,c.forumDescription=a.forum.forumDescription,c.forumName=a.forum.forumName,c.forumType=a.forum.forumType,"Organisation Specific"==a.forum.forumType?c.forumVisibility=a.forum.forumVisibility:c.forumVisibility=null,a.ownedBy.id&&(c.adminId=a.ownedBy),a.user.isOrganizationUser&&a.user.isOrganizationUserMode){if(c.orgId=a.user.organizationId,"Organisation Specific"===a.forum.forumType){if(c.orgId=a.forum.orgId,!a.forum.orgId)return void l("error",m.instant("SELECT_ATLEAST_ONE_ORGANIZATION"))}else c.orgId=a.user.organizationId;if(("Clients of Location"===a.forum.forumVisibility||"All Users With Access to Location"===a.forum.forumVisibility)&&0==a.forum.orgLocIds.length)return void l("error",m.instant("SELECT_ATLEAST_ONE_LOCATION"));c.orgLocIds=a.orgLocIds}g.updateForum(c,function(c){c&&(a.forum={},l("success",m.instant("RECORD_UPDATED_SUCCESSFULLY")),b.go("listofForums"))})}function r(){var b={};b.userId=a.userId,g.getUserOrgLoc(b,function(b){a.orgLoc=b})}function s(){g.getUserAccessbleOrgLoc(function(b){a.orgList=b})}a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.userId=a.user.id,a.forumId=b.params.forumId,a.forum={},a.types=["Public","Organisation Specific","Interest Group"],a.visiblities=["Clients of Organisation","Clients of Location","Internal Users","All Users With Access to Organization","All Users With Access to Location","Paripal Users"],a.ownedBy="",a.orgList={},a.getUserAccessbleOrgLoc=s,a.getForumsById=p,a.getCategoryList=n,a.updateForum=q,a.back=o,a.getUserOrgLoc=r,a.getUserNamesForRoleHistory=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("FIND_ORG_CLIENT_USERSBYNAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.initLoad=function(){n(),p(),s()},a.initLoad(),a.user.isOrganizationUser&&a.user.isOrganizationUserMode&&r()}]),angular.module("paripal.forumModule").controller("forumlistController",["$scope","$rootScope","$state","$window","$location","$stateParams","$timeout","$cookies","$mdDialog","ForumService","CategoryService","RequestService","httpService","urlService","utilService","notify","$translate","baseService","serverSidePagination","datatableconfig","baseConfig","commonConstants","featurePrivilegeConstants","storageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function y(){a.hasForumAddPrivilege?localStorage.setItem("AddForumType","all"):a.hasOrgForumAddPrivilege&&localStorage.setItem("AddForumType","orgForum"),c.go("addforum")}function z(){a.forumSearch={},a.requestFields=!1,D()}function A(){if(1==b.loggedInUserDetails.isOrganizationUserMode){var c=x.getLocationConsolidatedPrivileges();if(!o.isEmpty(c)){var d=c;o.isEmpty(d)||(d.indexOf(w.FORUM_INACTIVE)>-1?(a.hasForumInActivePrivilege=!0,a.hasOrgForumInActivePrivilege=!1):d.indexOf(w.ORG_FORUM_INACTIVE)>-1&&(a.hasForumInActivePrivilege=!0,a.hasOrgForumInActivePrivilege=!1))}}}function B(){if(1==b.loggedInUserDetails.isOrganizationUserMode){var c=x.getLocationConsolidatedPrivileges();if(!o.isEmpty(c)){var d=c;o.isEmpty(d)||(d.indexOf(w.FORUM_EDIT)>-1?(a.hasForumEditPrivilege=!0,a.hasOrgForumEditPrivilege=!1):d.indexOf(w.ORG_FORUM_EDIT)>-1&&(a.hasOrgForumEditPrivilege=!0,a.hasForumEditPrivilege=!1))}}}function C(){if(1==b.loggedInUserDetails.isOrganizationUserMode){var c=x.getLocationConsolidatedPrivileges();if(!o.isEmpty(c)){var d=c;o.isEmpty(d)||(d.indexOf(w.FORUM_ADD)>-1?(a.hasForumAddPrivilege=!0,a.hasOrgForumAddPrivilege=!1):d.indexOf(w.ORG_FORUM_ADD)>-1&&(a.hasOrgForumAddPrivilege=!0,a.hasForumAddPrivilege=!1))}}}function D(){a.forum.pageNumber=a.currentPage,a.forum.recordsPerPage=a.itemPerPage,a.user.organizationId&&a.user.isOrganizationUserMode&&(a.forum.orgId=a.user.organizationId),j.getForumsByUser(a.forum,function(b){a.forumList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=s(a.currentPage,a.itemPerPage,a.totalItems),a.forumList.forEach(function(b){a.userForumIds.push(b.jforumId),a.isOrgUser?b.userId==a.userId?(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Organisation Specific"==b.forumType&&b.userId!=a.userId?L("org_forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Public"==b.forumType&&b.userId!=a.userId&&L("forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):!a.isOrgUser&&b.admin&&b.admin==a.userId&&"Interest Group"==b.forumType&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId))}),h.put("adminForums",a.adminForumIds.toString(),{path:"/"}),h.put("forumIds",a.userForumIds.toString(),{path:"/"}),h.put("categoryIds",a.userCategIds.toString(),{path:"/"}),h.put("userToken",localStorage.getItem("paripal_token"),{path:"/"})})}function E(){k.getCategoryList(function(b){a.categories=b},function(a){})}function F(b){return o.isFieldEmpty(f)||null!=f.type&&(a.forumSearch.forumType=f.type),K()?("Interest Group"==a.forumSearch.forumType?(a.requestFields=!0,a.forumSearch.subscribed?a.hideLink=!0:a.hideLink=!1):a.requestFields=!1,a.user.organizationId&&a.user.isOrganizationUserMode&&(a.forumSearch.orgId=a.user.organizationId),a.ownedBySelect&&(a.forumSearch.adminId=a.ownedBySelect.id),"Interest Group"==a.forumSearch.forumType&&a.isOrgUser&&!b||b&&!b.id?void p("error",q.instant("PLEASE_SELECT_USER")):(a.isOrgUser&&b&&(a.forumSearch.user={},a.forumSearch.user.id=b.id),a.forumSearch.pageNumber=a.currentPage,a.forumSearch.recordsPerPage=a.itemPerPage,void j.searchForum(a.forumSearch,function(b){a.forumList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=s(a.currentPage,a.itemPerPage,a.totalItems),a.forumList.forEach(function(b){a.userForumIds.push(b.jforumId),a.isOrgUser?b.userId==a.userId?(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Organisation Specific"==b.forumType&&b.userId!=a.userId?L("org_forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):"Public"==b.forumType&&b.userId!=a.userId&&L("forum_edit")&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId)):!a.isOrgUser&&b.admin&&b.admin==a.userId&&"Interest Group"==b.forumType&&(a.adminForumIds.push(b.jforumId),a.userCategIds.push(b.categoryId))}),h.put("adminForums",a.adminForumIds.toString(),{path:"/"}),h.put("forumIds",a.userForumIds.toString(),{path:"/"}),h.put("categoryIds",a.userCategIds.toString(),{path:"/"}),h.put("userToken",localStorage.getItem("paripal_token"),{path:"/"})}))):void D()}function G(a,b){"edit"==a?c.go("editforum",{forumId:b}):"view"==a&&c.go("viewforum",{forumId:b})}function H(b,c){var d={};d.id=b,d.isActive=0,j.inActivateForum(d,function(b){b&&(a.forumList.splice(c,1),p("success",q.instant("RECORD_INACTIVATED_SUCCESSFULLY")))})}function I(b,c){var d={};d.user={},d.user.id=a.userId,d.forum={},d.forum.id=b.id,l.sendRequest(d,function(b){b&&(a.forumList[c].requestStatus="Requested",p("success",q.instant("REQUEST_SENT")))})}function J(b,c){var d=a.userId;i.show({templateUrl:"app/modules/forum/views/excludeUser.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:v.dialogBox.clickOutsideToClose,controller:["$scope","UserService","notify",function(a,b,e){a.publicForum=!1,a.orgForum=!1,a.grpForum=!0,a.exclude={},a.exclude.forum=c,a.getUsersOfForum=function(){var e={forumId:c.id};b.getInculdedUsersOfForum(e,function(b){var c=b.data;0!=c.length&&c.forEach(function(a,b){a.user.id==d&&c.splice(b,1)}),a.userList=c})},a.getUsersOfForum(),a.excludeUserFromForum=function(){a.exclude.forum={},a.exclude.forum.id=c.id,b.excludeUserFromForum(a.exclude,function(a){a&&(i.cancel(),e("success",q.instant("USER_EXCLUDED_SUCCESSFULLY")))})},a.cancel=function(){i.cancel()}}]})}function K(){var b=!1;return a.forumSearch.forumType||a.forumSearch.forumCategory?b=!0:a.forumSearch.forumVisibility||a.forumSearch.user?b=!0:a.forumSearch.forumType&&a.forumSearch.subscribed?b=!0:a.ownedBySelect&&a.ownedBySelect.id&&(b=!0),b}function L(a){var c=!1;if(!o.isEmpty(b.loggedInUserDetails.locationConsolidatedPrivileges)){var d=b.loggedInUserDetails.locationConsolidatedPrivileges;o.isEmpty(d)||d.indexOf(a)>-1&&(c=!0)}return c}a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.userId=a.user.id,a.email1=a.user.email1,h.put("username",a.user.displayName,{path:"/"}),h.put("emailId",a.email1,{path:"/"}),a.selectedUser="",
//for jforum cpanel
//$cookies.put("username","Admin");
a.jforumUrl=u.jforumUrl+"/forums/show/",/*$location.protocol()+"://"+$location.host()+":8080/JForum/forums/show/";*/
a.forumList=[],a.types=["Public","Organisation Specific","Interest Group"],a.visiblities=["Clients of Organisation","Clients of Location","Internal Users","All Users With Access to Organization","All Users With Access to Location","Paripal Users"],a.forum={},a.forumSearch={},a.userForumIds=[],a.userCategIds=[],a.adminForumIds=[],a.requestFields=!1,a.hideLink=!1,a.isOrgUser=!1,a.sortType="forumType",// set the default sort type
a.sortReverse=!1,a.hasOrgForumAddPrivilege=!1,a.hasForumAddPrivilege=!1,a.hasForumEditPrivilege=!1,a.hasOrgForumEditPrivilege=!1,a.hasForumInActivePrivilege=!1,a.hasOrgForumInActivePrivilege=!1,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.user.organizationId&&a.user.isOrganizationUserMode?(a.isOrgUser=!0,h.put("userMode","orgUser",{path:"/"})):h.put("userMode","indUser",{path:"/"}),a.getForumsByUser=D,a.getCategoryList=E,a.searchForum=F,a.redirectTo=G,a.inActivateForum=H,a.sendRequest=I,a.openExcludePopup=J,a.registeredByList=[],
//$scope.getownedByList =getownedByList;
a.clear=z,a.checkSearchCriteria=K,a.redirectToAdd=y,a.checkPermission=L,a.checkForumAddPrivilege=C,a.checkForumEditPrivilege=B,a.checkForumInactivePrivilege=A,A(),B(),C(),a.initLoader=function(){a.isCordova="undefined"!=typeof cordova,o.isFieldEmpty(f)||null!=f.type&&(a.forumSearch.forumType=f.type),E(),o.isFieldEmpty(a.forumSearch.forumType)?D():F(null)},a.initLoader(),/****************function for cordova *********************/
$("#data-table").on("click",".clickCls",function(){a.user.organizationId&&a.user.isOrganizationUserMode?a.loguser="orgUser":a.loguser="indUser",a.userToken=localStorage.getItem("paripal_token");var b={};b.jforumId=$(this).attr("data").valueOf();var c=u.jforumUrl+"/forums/show/",d='<html><head></head><body><form id="loginForm" action="'+c+b.jforumId+'.page" method="post"><input type="hidden" name="username" value="'+a.user.displayName+'"><input type="hidden" name="emailId" value="'+a.email1+'"><input type="hidden" name="userMode" value="'+a.loguser+'"><input type="hidden" name="adminForums" value="'+a.adminForumIds+'"><input type="hidden" name="forumIds" value="'+a.userForumIds+'"><input type="hidden" name="categoryIds" value="'+a.userCategIds+'"><input type="hidden" name="userToken" value="'+a.userToken+'"></form> <script type="text/javascript">document.getElementById("loginForm").submit();</script></body></html>',e="data:text/html;base64,"+btoa(d);if("undefined"!=typeof cordova){cordova.InAppBrowser.open(e,"_blank","hidden=no,location=no,clearsessioncache=no,clearcache=no,zoom=yes")}}),a.redirectToRequest=function(a){c.go("forumRequests",{forumId:a})},a.$watch("ownedBy",function(a){}),a.selectOwnedByChanged=function(b){a.ownedBySelect=b},a.getUserNamesForRoleHistory=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("FIND_ORG_CLIENT_USERSBYNAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.getUserNamesForRoleHistoryAdmin=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})};
//data table config
var M=v.gridConfigurations;a.pageChanged=function(){return a.pagingInfo=s(a.currentPage,a.itemPerPage,a.totalItems),K()?void F():void D()},a.setMaxRecords=function(b){return a.pageNumber=1,a.itemPerPage=b,K()?void F():void D()},a.options=t.setOptionProperties(M),a.dtColumnDefs=t.setColumnProperties({})}]),angular.module("paripal.forumModule").controller("requestCtrl",["$scope","$state","$window","$stateParams","$timeout","$mdDialog","RequestService","httpService","urlService","utilService","serverSidePagination","datatableconfig","notify","$translate","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){var b={forumId:a.forumId};b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,g.searchRequests(b,function(b){a.requests=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)})}function q(a,b){f.show({templateUrl:"app/modules/forum/views/rejectrequest.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:o.dialogBox.clickOutsideToClose,controller:["$scope","UserService","notify",function(a,c,d){a.user=b,a.rejectUser=function(){g.rejectUser(a.user,function(a){a&&(f.cancel(),d("success",n.instant("USER_EXCLUDED_SUCCESSFULLY")))})},a.cancel=function(){f.cancel()}}]})}function r(b,c){g.includeUser(b,function(b){b&&(a.requests.splice(c,1),m("success",n.instant("USER_INCLUDED_SUCCESSFULLY")))})}function s(){var b=angular.copy(a.request);a.ownedBySelect&&a.ownedBySelect.id&&(b.adminId=a.ownedBySelect.id),a.request.forumId&&a.request.forumId.id&&(b.forumId=a.request.forumId.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,g.searchRequests(b,function(b){a.requests=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)})}function t(b){var c={};return c.forumName=b,a.userNameAutoCmpLoading=!0,h.getData(i.getParameterizedUrl("FIND_FORUMS_BYNAME",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})}a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.userId=a.user.id,a.forumId=b.params.forumId,a.request={},a.requests=[],a.selected={},a.index=-1,a.ownedby="",a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.openExcludePopup=q,a.getRequestsOfForumById=p,a.includeUser=r,a.searchRequests=s,a.getFourmsByName=t,a.forumId&&p(),a.getownedByList=function(b){var c=null,d={};return d.searchString=b,j.isNullOrEmpty(c)||(d.organizationLocationId=c),h.getData(i.getQueryParameterizedUrl("FIND_ALL_ACTIVE_USER",d),null,function(b){if(b&&b.data)return a.registeredByList=b.data,a.registeredByList},function(a){})},a.selectOwnedByChanged=function(b){a.ownedBySelect=b};
//data table config
var u=o.gridConfigurations;a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.getForumsByUser()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getForumsByUser()},a.options=l.setOptionProperties(u),a.dtColumnDefs=l.setColumnProperties({})}]),angular.module("paripal.forumModule").controller("viewForumCtrl",["$scope","$rootScope","$state","$window","$stateParams","$timeout","$filter","ForumService","UserService","CategoryService","$mdDialog","datatableconfig","serverSidePagination","notify","$translate","httpService","utilService","urlService","featurePrivilegeConstants","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){
// function inclusionList(){
// 	if ($scope.forum.forumType == "Organisation Specific") {
// 		if ($scope.forum.forumVisibility != "Paripal Users") {
// 			getOrgForumInclusionList();
// 		}
// 	} else if ($scope.forum.forumType) {
// 		getInclusionList();
// 	}
// }
// function getInclusionList(){
// 	var forum = {forumId:$scope.forumId};
// 	forum.pageNumber = $scope.currentPage;
// 	forum.recordsPerPage = $scope.itemPerPage;
// 	UserService.getInculdedUsersOfForum(forum, function(response){
// 		$scope.includedUser = response.data;
// 		$scope.totalItems = response.totalRecords;
// 		$scope.pagingInfo = serverSidePagination($scope.currentPage, $scope.itemPerPage, $scope.totalItems);
// 	})
// }
function u(){var b={forumId:a.forumId};h.getForumById(b,function(b){b.forumValidFrom=g("date")(b.forumValidFrom,"MM/dd/yyyy"),b.forumValidTo=g("date")(b.forumValidTo,"MM/dd/yyyy"),"Interest Group"==b.forumType?b.forumAdmin=b.adminId.value:b.forumAdmin="Organization Admin",a.forum=b})}function v(){var b={};b.userId=a.userId,h.getUserOrgLoc(b,function(b){a.orgLoc=b})}function w(){var b={forumId:a.forumId};b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,i.getExculsionListFromForum(b,function(b){a.excludedUser=b.data,a.totalItems=b.totalRecords,a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems)})}function x(b,c){i.reIncludeUserToForum(b,function(b){a.excludedUser.splice(c,1),n("success",o.instant("USER_INCLUDED_SUCCESSFULLY"))})}
// function getOrgForumInclusionList(){
// 	var forum = {forumId:$scope.forumId};
// 	forum.pageNumber = $scope.currentPage;
// 	forum.recordsPerPage = $scope.itemPerPage;
// 	UserService.getOrgForumInclusionList(forum, function(response){
// 		$scope.includedUser = response.data;
// 		$scope.totalItems = response.totalRecords;
// 		$scope.pagingInfo = serverSidePagination($scope.currentPage, $scope.itemPerPage, $scope.totalItems);
// 	})
// }
function y(){c.go("listofForums",e),c.go("listofForums",{type:null,data:null})}function z(c){var d=a.userId,e=a.forum,f=a.includedUser,g=w;k.show({templateUrl:"app/modules/forum/views/excludeUser.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:t.dialogBox.clickOutsideToClose,controller:["$scope","UserService","httpService","utilService","urlService",function(a,c,h,i,j){a.getUsersOfForum=function(){var b={forumId:e.id};c.getInculdedUsersOfForum(b,function(b){var c=b.data;0!=c.length&&c.forEach(function(a,b){a.user.id==d&&c.splice(b,1)}),a.userList=c})},"Public"==e.forumType||"Organisation Specific"==e.forumType&&"Paripal Users"==e.forumVisibility?(a.publicForum=!0,a.grpForum=!1,a.orgForum=!1):"Organisation Specific"==e.forumType?(a.orgForum=!0,a.grpForum=!1,a.publicForum=!1,0!=f.length&&f.forEach(function(a,b){a.user.id==d&&f.splice(b,1)}),a.userList=f):"Interest Group"==e.forumType&&(a.orgForum=!1,a.grpForum=!0,a.publicForum=!1,a.getUsersOfForum()),a.exclude={},a.exclude.forum=e,a.excludeUserFromForum=function(){a.exclude.excludeFromAll?(a.exclude.adminId=b.loggedInUserDetails.id,
//$scope.exclude.forumType = forum.forumType;
a.exclude.forum={}):(a.exclude.forum={},a.exclude.forum.id=e.id),c.excludeUserFromForum(a.exclude,function(a){a&&(n("success",o.instant("USER_EXCLUDED_SUCCESSFULLY")),k.cancel(),g())})},a.orgLocPermission=s.GET_FORUM_ACTIVE_USERS,a.getownedByList=function(b){var c=null,d={};return d.searchString=b,i.isNullOrEmpty(c)||(d.organizationLocationId=c),h.getData(j.getQueryParameterizedUrl("FIND_ALL_ACTIVE_USER",d),null,function(b){if(b&&b.data)return a.registeredByList=b.data,a.registeredByList},function(a){},{orgLocPermission:a.orgLocPermission})},a.cancel=function(){k.cancel()}}]})}a.page1=!0,
//$scope.user = angular.fromJson(localStorage.getItem("loggedInUser"));
a.user=b.loggedInUserDetails,a.userId=a.user.id,a.forumId=c.params.forumId,a.forum={},a.types=["Public","Organisation Specific","Interest Group"],a.visiblities=["Clients of Organisation","Clients of Location","Internal Users","All Users With Access to Organization","All Users With Access to Location","Paripal Users"],a.isOrgUser=!1,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgList={},a.getForumById=u,
//$scope.getInclusionList = getInclusionList;
a.getExclusionList=w,a.reIncludeUserToForum=x,a.back=y,
//$scope.getOrgForumInclusionList = getOrgForumInclusionList;
//$scope.inclusionList = inclusionList;
a.openExcludePopup=z,
//$scope.getUserAccessbleOrgLoc = getUserAccessbleOrgLoc;
a.getUserOrgLoc=v,a.user.organizationId&&a.user.isOrganizationUserMode&&(a.isOrgUser=!0),a.user.isOrganizationUser&&a.user.isOrganizationUserMode&&v(),a.initLoad=function(){u()},a.initLoad();
//data table config
var A={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:4,setDeafultColSortingOrder:"desc"};a.pageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems),a.getExclusionList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getExclusionList()},a.inclusionPageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems)},a.setUserMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b},a.options=l.setOptionProperties(A),a.dtColumnDefs=l.setColumnProperties({})}]),angular.module("paripal.forumModule").service("RequestService",["httpService","$filter","urlService",function(a,b,c){this.sendRequest=function(b,d,e){a.postData(c.getUrl("SEND_REQUEST"),b,function(a){d(a)},function(a){e(a)})},this.rejectUser=function(b,d,e){a.postData(c.getUrl("REJECT_USER"),b,function(a){d(a)},function(a){e(a)})},this.includeUser=function(b,d,e){a.postData(c.getUrl("INCLUDE_USER"),b,function(a){d(a)},function(a){e(a)})},this.searchRequests=function(b,d,e){a.postData(c.getUrl("SEARCH_REQUESTS"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.forumModule").service("CategoryService",["httpService","$filter","urlService",function(a,b,c){this.getCategoryList=function(b,d){a.getData(c.getUrl("GET_CATEGORY_LIST"),null,function(a){b(a.data)},function(a){d(a)})},this.getCategoryListWithPagination=function(b,d,e){a.postData(c.getUrl("GET_CATEGORY_LIST_PAGINATION"),b,function(a){d(a.data)},function(a){e(a)})},this.saveCategory=function(b,d,e){var f=c.getUrl("ADD_CATEGORY");b.id&&(f=c.getUrl("UPDATE_CATEGORY")),a.postData(f,b,function(a){d(a)},function(a){e(a)})}}]),angular.module("paripal.forumModule").service("ForumService",["httpService","$filter","urlService",function(a,b,c){this.addForums=function(b,d,e){a.postData(c.getUrl("ADD_FORUM"),b,function(a){d(a)},function(a){e(a)})},this.updateForum=function(b,d,e){a.putData(c.getUrl("UPDATE_FORUM"),b,function(a){d(a)},function(a){e(a)})},this.getForumsByUser=function(b,d,e){a.postData(c.getUrl("GET_FORUM_LIST"),b,function(a){d(a.data)},function(a){e(a)})},this.searchForum=function(b,d,e){a.postData(c.getUrl("SEARCH_FORUM"),b,function(a){d(a.data)},function(a){e(a)})},this.inActivateForum=function(b,d,e){a.putData(c.getUrl("INACTIVATE_FORUM"),b,function(a){d(a)},function(a){e(a)})},this.getForumById=function(b,d,e){a.getData(c.getParameterizedUrl("GET_FORUM_BY_ID",b),null,function(a){d(a.data)},function(a){e(a)})},this.getUserOrgLoc=function(b,d,e){a.getData(c.getParameterizedUrl("GET_USER_ORG_LOC",b),null,function(a){d(a.data)},function(a){e(a)})},this.getUserAccessbleOrgLoc=function(b,d,e){a.getData(c.getUrl("GET_USER_ACCESSBLE_ORG"),null,function(a){b(a.data)},function(a){d(a)},e)}}]),angular.module("paripal.forumModule").service("UserService",["httpService","$filter","urlService",function(a,b,c){this.getInculdedUsersOfForum=function(b,d,e){a.postData(c.getUrl("GET_INCLUSION_LIST"),b,function(a){d(a.data)},function(a){e(a)})},this.getExculsionListFromForum=function(b,d,e){a.postData(c.getUrl("GET_EXCLUSION_LIST"),b,function(a){d(a.data)},function(a){e(a)})},this.reIncludeUserToForum=function(b,d,e){a.postData(c.getUrl("REINCLUDE_USER"),b,function(a){d(a)},function(a){e(a)})},this.excludeUserFromForum=function(b,d,e){a.postData(c.getUrl("EXCLUDE_USER"),b,function(a){d(a)},function(a){e(a)})},this.getOrgForumInclusionList=function(b,d,e){a.postData(c.getUrl("GET_ORG_FORUM_INCLUSIONS"),b,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.fullCalendarModule").controller("createEventCtrl",["$scope","$mdDialog","date","calendarMasterId","entityId","createEventService","calendarRequestData","parentScope","featurePrivilegeConstants","$filter",function(a,b,c,d,e,f,g,h,i,j){a.calendarFeaturePrivilege=i.CALENDAR_EVENT_ADD,a.addEventTrue=!1,a.eventDay={},a.eventDay.entityId=e,a.eventDay.entityType=g.entityType,a.eventList={},a.orgLocationId=g.organizationLocationId,a.eventList.calendarMaster={},a.daily="active";var k=new CommonFunctions;a.currentDate=k.dateSeperator(c),a.eventDay.eventDate=k.dateFormatter(c);j("date")(k.dateFormatter(c),"dd MMMM yyyy");a.isWorkingDay=!0,a.onWorkingDayChange=function(b){b?(a.whetherNonWorkingDay=!1,a.whetherHoliday=!1,0==a.eventList.wsCalendarTimings.length&&a.eventList.wsCalendarTimings.push({})):a.eventList.wsCalendarTimings=[]},a.onNonWorkingDayChange=function(b){b&&(a.whetherWorkingDay=!1,a.eventList.wsCalendarTimings=[])},a.onHolidayChange=function(b){b&&(a.whetherWorkingDay=!1,a.eventList.wsCalendarTimings=[])},a.updateDayAvailability=function(c){var h={};h.calendarMaster={};var i=[];angular.forEach(c.wsCalendarTimings,function(a,b){var c=j("date")(a.startTime,"H:mm"),d=j("date")(a.endTime,"H:mm"),e={};e.startTime=c,e.endTime=d,i.push(e)}),h.calendarMaster.id=d,h.entityId=e,h.entityType=g.entityType,h.eventDate=a.eventDay.eventDate,h.wsCalendarTimings=i,h.whetherWorkingDay=a.whetherWorkingDay,h.whetherNonWorkingDay=a.whetherNonWorkingDay,h.whetherHoliday=a.whetherHoliday,h.organizationLocationId=g.organizationLocationId;var k=new Date(h.eventDate),l=new Array(7);l[0]="SUNDAY",l[1]="MONDAY",l[2]="TUESDAY",l[3]="WEDNESDAY",l[4]="THURSDAY",l[5]="FRIDAY",l[6]="SATURDAY";var m=l[k.getDay()];h.day=m,f.saveDateStatus(h,function(c){a.eventList.whetherWorkingDay&&(a.whetherNonWorkingDay||a.whetherHoliday)?notify("success",$translate.instant("WORKING_DAY_CHANGED_TO_NON_WORKING")):notify("success",$translate.instant("DAY_AVAILABILITY_CHANGED")),a.getListOfEventsByDate(),b.cancel()},function(a){})},a.cancel=function(){b.cancel()},a.cancelEvent=function(){a.addEventTrue=!a.addEventTrue,a.eventDay={},a.eventDay.entityType=g.entityType},a.clear=function(){document.eventData.reset()},a.changeWorkingSettings=function(){a.eventList.whetherWorkingDay?a.eventList.whetherNonWorkingDay=!1:a.eventList.whetherNonWorkingDay=!0},a.changeNonWorkingSettings=function(){a.eventList.whetherNonWorkingDay?a.eventList.whetherWorkingDay=!1:a.eventList.whetherWorkingDay=!0},a.getListOfEventsByDate=function(){f.getListOfEventsByDate(a.eventDay.eventDate,d,g,function(b){a.eventList=b,a.workingTimes=a.eventList.wsCalendarTimings,angular.forEach(a.workingTimes,function(a,b){var c=new Date;c.setHours(a.startTime.substring(0,2)),c.setMinutes(a.startTime.substring(3,5));var d=new Date;d.setHours(a.endTime.substring(0,2)),d.setMinutes(a.endTime.substring(3,5)),a.startTime=c,a.endTime=d}),a.whetherWorkingDay=a.eventList.whetherWorkingDay,a.whetherHoliday=a.eventList.whetherHoliday,a.whetherNonWorkingDay=a.eventList.whetherNonWorkingDay;var c=a.workingTimes;"object"==typeof c&&c.sort(function(a,b){return a.startTime>b.startTime}),a.eventList.wsCalendarTimings=c,a.twelveHrFormat=function(a){if(a>="12:00"){var b=a.replace(":","");return(b=1200)?(b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM")):(b-=1200,b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"))}return a+=" AM"},angular.forEach(b.wsCalendarDayEvent,function(b,c){b.entityType=g.entityType,b.st=b.startTime.substring(0,2)+":"+b.startTime.substring(3,5),b.et=b.endTime.substring(0,2)+":"+b.endTime.substring(3,5),b.st=a.twelveHrFormat(b.st),b.et=a.twelveHrFormat(b.et),null==b.calendarEventExceptionStatus?"CAL_EVENT_APPT"==b.eventType.code?b.panalStyle="panel-green":"CAL_EVENT_HOME_VISIT"==b.eventType.code?(b.panalStyle="panel-green",b.iconClass="fa fa-home"):"CAL_EVENT_ONLINE"==b.eventType.code?(b.panalStyle="panel-green",b.iconClass="fa fa-phone"):"CAL_EVENT_SELF_NORMAL"==b.eventType.code?b.panalStyle="panel-selfevent":"CAL_EVENT_FREE_SLOT_APPT"==b.eventType.code&&(b.panalStyle="panel-green"):(b.panalStyle="panel-exception",b.iconClass="fa fa-exclamation-triangle")})},function(b){a.explressionFollowupSpinner=!1,a.error=b}),a.addDayAvailability=function(){a.eventList.wsCalendarTimings.push({})},a.removeDayAvailability=function(b){a.eventList.wsCalendarTimings.splice(b,1)}},a.getListOfEventsByDate(),a.saveEvent=function(){
//$scope.addEventTrue = !$scope.addEventTrue;
return a.whetherHoliday||a.whetherNonWorkingDay?void notify("Error",$translate.instant("WORKING_NO_WORKING_MSG")):(a.eventDay.calendarMaster={},a.eventDay.calendarMaster.id=d,a.eventDay.eventDate=k.dateFormatter(c),a.eventDay.entityId=e,""==a.eventDay.repeatEnum&&(a.eventDay.repeatEnum=null),a.ste=a.eventDay.startTime,a.ete=a.eventDay.endTime,a.eventDay.eventDate=k.dateFormatter(c),a.eventDay.entityType=g.entityType,a.eventDay.organizationLocationId=g.organizationLocationId,void f.saveCreateEvent(a.eventDay,function(c){a.addEventTrue=!a.addEventTrue,a.eventDay.eventType={},a.eventDay.wsCalendarDayEventRepeatInformation={},a.eventDay.repeatEnum="",a.eventDay.startTime=new Date,a.eventDay.endTime=new Date,a.eventDay.eventName="",b.cancel(),notify("success",$translate.instant(c.code)),h.getCalendarData()},function(b){a.error=b,a.eventDay.startTime=a.ste,a.eventDay.endTime=a.ete}))},a.updateDayDetails=function(b){b.date=a.eventDay.eventDate,b.calendarMaster.id=d;var c=j("date")(b.startTime,"H:mm"),e=j("date")(b.endTime,"H:mm");b.startTime=c,b.endTime=e,delete b.id,delete b.wsCalendarDayEvent,/*eventList.startTime*/
/* var endTime=new Date(eventList.endTime);
             eventList.endTime=$filter('date')(endTime, "H:mm");*/
f.updateDayDetails(b,function(b){a.getListOfEventsByDate()},function(a){})},a.deleteEvent=function(b){f.deleteEvent(b,function(b){notify("success",$translate.instant("EVENT_DELETED")),a.getListOfEventsByDate(),h.getCalendarData()},function(a){})},a.updateEventDetails=function(c,d,e){delete c.iconClass,delete c.panalStyle,c.organizationLocationId=g.organizationLocationId,f.updateEventDetails(c,d,e,function(c){notify("success",$translate.instant(c.code)),a.getListOfEventsByDate(),b.cancel(),window.location.reload()},function(a){})}}]),angular.module("paripal.fullCalendarModule").controller("CustomAppointmentCtrl",["$scope","customAppointmentService","baseService","$mdDialog","notify","appointmentData","utilService","dateconvertor","$filter","mode",function(a,b,c,d,e,f,g,h,i,j){a.createAppointment=function(){a.appointment.user={},a.appointment.user.id=a.loggedInUserDetails.id,a.appointment.user.value=a.loggedInUserDetails.displayName,a.appointment.onBehalfOfName=a.loggedInUserDetails.displayName,b.createCustomAppointment(a.appointment,function(a){e("success",a.data.successMessage),d.cancel(!0)},function(a){})};var k=function(a){var b=new Date;return b.setHours(a.substring(0,2)),b.setMinutes(a.substring(3,5)),b};a.cancel=function(){d.cancel()},a.init=function(){a.loggedInUserDetails=c.getLoggedInUser(),a.appointment={},g.isFieldEmpty(j)||"view"!=j||(a.screenMode="view",a.appointment=f,a.appointment.apptStartTime=k(a.appointment.apptStartTime,"HH:mm:ss"),a.appointment.apptEndTime=k(a.appointment.apptEndTime,"HH:mm:ss"))},a.init()}]),angular.module("paripal.fullCalendarModule").controller("DayExceptionListCtrl",["datatableconfig","serverSidePagination","$state","utilService","commonCalendarService","$scope","$filter","httpService","urlService","$compile","$timeout","createCalendarService","uiCalendarConfig","$mdDialog","$mdMedia","$rootScope","notify","userStatusService","baseService","$translate","manageRequestService","checkPermissionService","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(a,b,c,d,e){a.decision={},a.cancel=function(){b.cancel()},a.exceptionDecision=function(){var f={};f.id=c.calendarEventExceptionStatuses.id,f.reason=a.decision.reason,d.rejectDayException(f,function(a){e("success",t.instant(a.successMessage)),b.cancel(!0)},function(a){})}}x.$inject=["$scope","$mdDialog","dayException","commonCalendarService","notify"],f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.clear=function(){},f.getCalendarExceptionStatus=function(){e.getCalendarExceptionStatus(function(a){f.exceptionStatuses=a},function(a){})},f.accept=function(a){var b={id:a.calendarEventExceptionStatuses.id};e.approveDayException(b,function(a){q("success",t.instant(a.successMessage)),c.reload()},function(a){})},f.reject=function(a){n.show({controller:x,templateUrl:"app/modules/fullCalendar/views/day-exception-approval.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{dayException:a}}).then(function(){},function(a){a&&c.reload()})},f.filterDayException=function(a){a.pageNumber=f.currentPage,a.recordsPerPage=f.itemPerPage,e.searchDayExceptions(a,function(a){f.dayExceptions=a.data,f.totalItems=a.totalRecords,f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems)},function(a){})},f.pageChanged=function(){f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems)},f.setMaxRecords=function(a){f.pageNumber=1,f.itemPerPage=a};
//datatble config json
var y={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(y),f.dtColumnDefs=a.setColumnProperties({}),f.init=function(){var a={};w.calendarId&&(a.calendarId=w.calendarId),w.entityId&&(a.entityId=w.entityId),w.organizationLocationId&&(a.organizationLocationId=w.organizationLocationId),w.entityTypeCode&&(a.entityTypeCode=w.entityTypeCode),w.entityType&&(a.entityType=w.entityType),f.getCalendarExceptionStatus(),f.filterDayException(a)},f.init()}]),//var calendarDemoApp = angular.module('fullCalendarModule', ['ui.calendar', 'ui.bootstrap','ngMaterial','ngMaterialDatePicker']);
angular.module("paripal.fullCalendarModule").controller("EquipmentCalendarCtrl",["$scope","$state","commonCalendarService","$stateParams","$compile","$timeout","$filter","uiCalendarConfig","$mdDialog","$mdMedia","createEventService","notify","$translate","featurePrivilegeConstants","calendarObjIteratorService","baseService","utilService","$rootScope","calendarMenuService","storageService","httpService","urlService","appointmentsListService","MakePrescriptionFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function y(a,d,e,f,g,h){a.decision={},a.decisionObject={},a.addEventTrue=!0,a.twelveHrFormat=function(a){if(a>="12:00"){var b=a.replace(":","");return(b=1200)?(b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM")):(b-=1200,b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"))}return a+=" AM"},a.getExceptionDetails=function(){k.getExceptionDetails(f,e,g,h,function(b){a.exceptionDetails=b,a.exceptionDetails.startTime=a.exceptionDetails.startTime.substring(0,5),a.exceptionDetails.endTime=a.exceptionDetails.endTime.substring(0,5),angular.forEach(a.exceptionDetails.wsCalendarTimings,function(a,b){var c=new Date,d=new Date;c.setHours(a.startTime.substring(0,2)),c.setMinutes(a.startTime.substring(3,5)),a.startTime=c,d.setHours(a.endTime.substring(0,2)),d.setMinutes(a.endTime.substring(3,5)),a.endTime=d})},function(a){})},a.getExceptionDetails(),a.cancel=function(){d.cancel()},a.validateReason=function(){"Approve"==a.decision.status?a.isReasonRequired=!1:a.isReasonRequired=!0},a.exceptionDecision=function(){"Approve"==a.decision.status?a.decisionObject.status="ACCEPTED":a.decisionObject.status="REJECTED",a.decisionObject.calendarDayEventId=e,a.decisionObject.reason=a.decision.reason,a.decisionObject.organizationLocationId=f.organizationLocationId,a.decisionObject.id=e,a.decisionObject.eventException=h,c.saveExceptionDecision(a.decisionObject,function(a){d.cancel(),b.reload()},function(a){})}}function z(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString(),e=c.split(""),f=d.split("");return b+"-"+(e[1]?c:"0"+e[0])+"-"+(f[1]?d:"0"+f[0])}function A(a,c,d,e,f,h,i,j,k,l,m){a.todaysDate=new Date,a.cancel=function(){m.cancel()},a.$watchGroup(["postponeAdhocObj.eventId","postponeAdhocObj.apptDate"],function(b){if(b[0]&&b[1]){a.availabilities=[];var c={};c.date=l.convertToServerDate(b[1]),c.eventId=angular.fromJson(b[0]).id,h.getAvailableTimings(c,function(b){angular.forEach(b,function(b){1!=b.isBooked&&a.availabilities.push(b)})},function(a){})}}),a.getAdhocEventList=function(){k.getCalendarEventDetails(d,function(b){var c={};c.entityId=b.entityId,c.entityType=b.entityType,c.appointmentType=b.appointmentType,h.getEventListByType(c,function(b){a.events=b},function(a){})},function(a){})},a.init=function(){a.getAdhocEventList()},a.init(),a.onAdhocPostpone=function(){i.showSpinner=!0;var d={};d.apptDate=a.postponeAdhocObj.apptDate,d.oldAppointmentId=c,d.apptStartTime=g("date")(a.postponeAdhocObj.startTime,"HH:mm:ss"),d.apptEndTime=g("date")(a.postponeAdhocObj.endTime,"HH:mm:ss"),d.slotId=a.availabilities[0].id,h.postponeAdhocAppointment(d,function(a){i.showSpinner=!1,j("success",a.successMessage),localStorage.setItem("isPostpond","false"),m.cancel(),b.reload()},function(a){i.showSpinner=!1})}}y.$inject=["$scope","$mdDialog","calendarDayEventId","calendarRequestData","eventDate","eventException"],A.$inject=["$scope","oldAppointmentId","eventId","userId","slotId","commonCalendarService","$rootScope","notify","manageCalendarEventService","dateconvertor","$mdDialog"],a.calendarMasterObject={},a.calendarMaster={},a.events=[],a.selectedEntityId=0,a.calendarMasterId=0,a.workingTimes=[{}],a.holidayArray=[],a.nonWorkingArray=[],a.calendarObjectData={},a.searchCriteria={},a.searchCriteria.orgLocation={},sessionStorage.setItem("isPostpond",!1),sessionStorage.setItem("oldAppointmentId",null),a.slotTime=15,q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek",a.menuVisible=!1,localStorage.setItem("isPopupOpen","false"),a.getCalendarData=function(b){a.calendarMasterObject.calendarId=a.calendarObjectData.id,a.calendarMasterObject.organizationLocationId=a.calendarObjectData.organizationLocationId,a.calendarMasterObject.entityId=a.calendarObjectData.entityId,b?(a.defaultRequestCall=!1,a.calendarMasterObject.startDate=b.start._d,a.calendarMasterObject.endDate=b.end._d,"agendaDay"==b.type&&(a.calendarMasterObject.endDate=b.start._d)):(a.defaultRequestCall=!0,a.calendarMasterObject.startDate=new Date,a.calendarMasterObject.endDate=new Date);var e="",f="";if(b)if("month"==b.type){var h=b.title.indexOf(" ");e=b.title.substring(0,h),f=b.title.substring(h+1)}else{var j=new Date;e=g("date")(c.dateFormatter(j),"MMMM"),f=g("date")(c.dateFormatter(j),"yyyy")}else{var j=new Date;e=g("date")(c.dateFormatter(j),"MMMM"),f=g("date")(c.dateFormatter(j),"yyyy")}a.calendarMasterObject.entityId=a.calendarObjectData.entityId,a.calendarMasterObject.entityType=a.calendarObjectData.entityType,"CAL_ORGANIZATION_USER"==a.calendarMasterObject.entityType.code&&(q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek"),r.showSpinner=!0,c.getCalendarData(a.calendarMasterObject,d.type,function(d){function h(b,d){var e=g("date")(c.dateFormatter(Date.parse(b+" 1,"+d)),"yyyy-MM-dd");e=new Date(e);for(var f=e.getMonth();e.getMonth()===f;){var h=g("date")(c.dateFormatter(new Date(e)),"yyyy-MM-dd");g("date")(c.dateFormatter(h),"dd");angular.isUndefined(a.holidayArray)||null==a.holidayArray||a.holidayArray.indexOf(h)!=-1&&$('*[data-date="'+h+'"].fc-day-number').addClass("holidayText"),angular.isUndefined(a.nonWorkingArray)||null==a.nonWorkingArray||a.nonWorkingArray.indexOf(h)!=-1&&$('td[data-date="'+h+'"]').css("background-color","#ececec"),e.setDate(e.getDate()+1)}}a.calendarMasterId=d.id,a.calendarMaster=d,a.scrollTime||(a.scrollTime=a.calendarMaster.eventTime),a.showObject={},a.showObject.orgLocId=d.organizationLocationId,a.showObject.entityTypeCode=d.entityType.code,a.showObject.entityType=d.entityType.value,a.showObject.entityName=d.entityName,a.showObject.calendarName=d.name,a.showObject.calendarOrg=d.organizationLocationName,d.slotSize&&(a.slotTime=d.slotSize),a.holidayArray=d.holidays,a.nonWorkingArray=d.nonWorkingDays,a.newEvents=[];if(h(e,f),angular.forEach(o.objIterator(a.calendarMaster.events),function(c,d){angular.forEach(c.dates,function(d,e){var f={};f.id=c.id,f.eventType=c.eventType,f.calendarId=c.calendarId,f.eventDate=c.eventDate;var h=new Date;h.setHours(c.eventStartTime.substring(0,2)),h.setMinutes(c.eventStartTime.substring(3,5));var i=new Date;i.setHours(c.eventEndTime.substring(0,2)),i.setMinutes(c.eventEndTime.substring(3,5));g("date")(h,"hh:mm a"),g("date")(i,"hh:mm a");f.start=d+" "+c.eventStartTime,f.end=d+" "+c.eventEndTime,b&&(f.viewType=b.type),f.exception=c.exception,f.eventStartTime=c.eventStartTime,f.eventEndTime=c.eventEndTime,f.eventException=c.eventException,f.eventSlots=c.eventSlots,f.eventId=c.id,f.appointmentType=c.appointmentType,f.slotSize=c.slotSize,f.offDay=c.offDay,f.eventName=c.title,f.entityType=a.calendarMaster.entityType,f.entityName=a.calendarMaster.entityName,f.entityId=a.calendarMaster.entityId,f.whetherAdminRoleAssigned=a.calendarMaster.whetherAdminRoleAssigned,f.slotId=c.slotId,f.isUserLinked=a.calendarMaster.whetherLinkedToEquipment,c.capacity&&(f.capacity=c.capacity),a.newEvents.push(f)})}),a.calendarMaster.events=a.newEvents,angular.forEach(a.calendarMaster.businessHours,function(b,c){angular.forEach(b.timeSlots,function(c,d){c.start=b.date+" "+c.start,c.end=b.date+" "+c.end,c.rendering="background",c.eventBackgroundColor="rgb(255,0,0)",a.calendarMaster.events.push(c)})}),a.uiConfig={calendar:{height:500,editable:!1,contentHeight:500,slotDuration:"00:"+a.slotTime+":00",customButtons:{myCustomButton:{text:"Define event",click:a.createEvent},myButton:{text:"Day Availability",click:a.showAvailability}},axisFormat:"hh:mm A",header:{left:"prev,next today",center:"title",right:"myButton,myCustomButton,month,agendaDay,agendaWeek"},buttonText:{today:"Today",month:"Month",week:"Week",day:"Day"},events:a.events,fixedWeekCount:!1,defaultView:a.defaultView,businessHours:{},eventLimit:!0,nowIndicator:!0,scrollTime:a.scrollTime,displayEventTime:!0,viewRender:a.viewRender,eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,eventRender:a.eventRender,dayClick:a.dayClick,eventClick:a.eventClick,slotEventOverlap:a.slotEventOverlap,dayRender:a.dayRender,eventAfterAllRender:a.eventAfterAllRender,viewDestroy:a.viewDestroy,columnHeaderFormat:"ddd DD/MMM",firstDay:(new Date).getDay()}},a.setCalendarData(f,e),a.isPostpond&&!a.defaultRequestCall&&!a.isPostponePopupShown){a.isPostponePopupShown=!0;var j=i.confirm().title(m.instant("POSTPONE_APPOINTMENT")).textContent(m.instant("SELECT_SLOT_TO_POSTPONT")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(j).then(function(){i.hide()},function(){q.goBackToPrevState()})}r.showSpinner=!1},function(a){r.showSpinner=!1}),0==a.loggedInUser.isOrganizationUserMode&&$(".fc-myCustomButton-button").hide()},a.showAvailability=function(){i.show({controller:"ShowCalendarAvailabilityCtrl",templateUrl:"app/modules/fullCalendar/views/working-day.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{calendarMasterId:a.calendarMasterObject.calendarId,entityId:a.calendarMasterObject.entityId,calendarRequestData:a.calendarObjectData,parentScope:a}}).then(function(){a.WSHealthProfessionalsValues={}},function(c){a.WSHealthProfessionalsValues={},c&&b.reload()})},a.$on("$destroy",function(){localStorage.getItem("viewCalendarFilterValues")&&localStorage.removeItem("viewCalendarFilterValues"),sessionStorage.getItem("samePageCall")&&sessionStorage.removeItem("samePageCall")}),a.init=function(){if(a.searchCriteria.entityName={},q.isNullOrEmpty(d.data)||localStorage.setItem("cmi",angular.toJson(d.data)),1==angular.fromJson(sessionStorage.getItem("samePageCall"))){if(localStorage.getItem("viewCalendarFilterValues")){var b=angular.fromJson(localStorage.getItem("viewCalendarFilterValues"));a.searchCriteria.orgLocation=b.orgLocation,a.searchCriteria.entityType=b.entityType,a.searchCriteria.entityName=b.entityName}}else q.isNullOrEmpty(angular.fromJson(sessionStorage.getItem("samePageCall")))?d.data=angular.fromJson(localStorage.getItem("cmi")):d.data=angular.fromJson(localStorage.getItem("cmi"));a.loggedInUser=p.getLoggedInUser(),localStorage.setItem("isPopupOpen","false"),a.individualFeaturePrivileges=t.getIndividualFeaturePrivileges(),a.locationConsolidatedPrivileges=t.getLocationConsolidatedPrivileges(),a.locationFeaturePrivileges=t.getLocationFeaturePrivileges(),d.data?(localStorage.setItem("cmi",angular.toJson(d.data)),a.calendarObjectData=d.data,d.data.slotId&&"true"==localStorage.getItem("isPostpond")&&(a.isPostpond=!0,localStorage.setItem("isPostpond","true"),sessionStorage.setItem("isPostpond","true"))):(a.trialCalendarObjectData=localStorage.getItem("cmi"),a.calendarObjectData=angular.fromJson(a.trialCalendarObjectData),d.data=angular.copy(a.calendarObjectData)),d.data&&!localStorage.getItem("viewCalendarFilterValues")&&(q.isFieldEmpty(d)||q.isFieldEmpty(d.data)||q.isFieldEmpty(d.data.organizationLocation)?q.isFieldEmpty(d)||q.isFieldEmpty(d.data)||q.isFieldEmpty(d.data.orgLocation)||(a.searchCriteria.orgLocation=d.data.orgLocation.id):a.searchCriteria.orgLocation=d.data.organizationLocation,q.isFieldEmpty(d)||q.isFieldEmpty(d.data)||q.isFieldEmpty(d.data.entityType)||(a.searchCriteria.entityType=d.data.entityType),q.isFieldEmpty(d)||q.isFieldEmpty(d.data)||q.isFieldEmpty(d.data.entityId)||(a.searchCriteria.entityName.id=d.data.entityId,a.searchCriteria.entityName.value=d.data.entityName)),a.getCalendarData()},a.createEvent=function(){b.go("manageEventCalendar",{type:"add",calendarData:a.calendarMaster,calendarState:d,callingPage:"equipmentcalendarview"})},a.init(),a.changeTo="Hungarian",/* event source that pulls from google.com */
a.eventSource={className:"gcal-event",// an option!
currentTimezone:"America/Chicago"},a.customFullscreen=j("xs")||j("sm"),a.dayClick=function(b,c,e){if("exception"!=d.type){(j("sm")||j("xs"))&&a.customFullscreen}},a.businessHours=function(){},a.eventClick=function(e,f){if(1==e.exception){(j("sm")||j("xs"))&&a.customFullscreen;i.show({controller:y,templateUrl:"app/modules/fullCalendar/views/exception-approval.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{calendarDayEventId:e.id,calendarRequestData:a.calendarMasterObject,eventDate:e.eventDate,eventException:e.eventException}}).then(function(a){},function(){a.WSHealthProfessionalsValues={}})}else{var h=m.instant("LIST_APPOINTMENTS"),k=m.instant("EDIT_EVENT"),n=m.instant("DEFINE_EVENT_EXCEPTION"),o=m.instant("FIX_APPOINTMENT"),t=m.instant("CANCEL_APPOINTMENTS"),u=m.instant("POSTPONE_APPOINTMENT"),v=m.instant("REGISTER_WALKIN"),w=m.instant("SHOW_STATUS"),x=m.instant("CHECK_IN"),A=m.instant("CHECK_OUT"),B=m.instant("VIEW_APPOINTMENT"),C=(m.instant("MAP_DISEASE"),m.instant("CONSULTATION_START")),D=m.instant("CONSULTATION_FINISH");if(d.data&&!angular.fromJson(sessionStorage.getItem("isPostpond")))if(1==a.menuVisible)$(".event-menu-list").remove(),a.menuVisible=!1;else if(444==f.target.id){var E=!1;if(angular.forEach(e.eventSlots,function(a){0==E&&a.appointmentSlots&&(E=!0)}),1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){var F=(Math.floor(501*Math.random()),$("#calendar").offset()),G=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),H=f.pageX-F.left+G,I=f.pageY-F.top+$(".calendarDetailsRow").height(),J=null;e.eventSlots&&(J=e.eventSlots[0].slotDate);var K="<div class='event-menu-list'><ul>";/*List Appointment menu*/
K=K+"<li class='calendar-event-menu-title-style'><div>"+e.eventName+"</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+J+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='listAppointmentMenu'>"+h+"</div></li>";var L=new Date,M=J.split("-"),N=e.eventEndTime.split(":"),O=parseInt(M[1])-1,P=O.toString(),Q=new Date(M[0],P,M[2],N[0],N[1],N[2]);Q.getTime()>=L.getTime()&&(s.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"calendar_event_edit",a.showObject.orgLocId)&&1==e.whetherAdminRoleAssigned&&(/*Edit event menu*/
K=K+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+J+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='editEventMenu'>"+k+"</div></li>"),s.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"event_excpetions",a.showObject.orgLocId)&&1==e.whetherAdminRoleAssigned&&(/*Event exception menu*/
K=K+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+J+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='eventExceptionMenu'>"+n+"</div></li>"),s.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_add",a.showObject.orgLocId)&&"FCFS"!=e.appointmentType&&1==e.isUserLinked&&(/*Fix appointment menu*/
K=K+"<li><div data-eventId='"+e.eventId+"' data-eventDate='"+J+"' data-entityName='"+e.entityName+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='fixAppointmentMenu'>"+o+"</div></li>"),s.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_cancel",a.showObject.orgLocId)&&1==E&&(/*Cancel bulk appointment menu*/
K=K+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+J+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='cancelAppointmentMenu'>"+t+"</div></li>"),s.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_postpone",a.showObject.orgLocId)&&Q.getDate()==L.getDate()&&Q.getMonth()==L.getMonth()&&Q.getYear()==L.getYear()&&1==E&&(/*Postpone appointment menu*/
K=K+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+J+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='postpondAppointmentMenu' >"+u+"</div></li>"));var R=g("date")(J,"yyyy-MM-dd"),S=g("date")(new Date,"yyyy-MM-dd");1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode&&R==S&&(/*Show status menu*/
K=K+"<li><div data-eventId='"+e.eventId+"' data-eventDate='"+J+"' class='calendar-event-menu-style' id='showStatusMenu'>"+w+"</div></li>",s.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_walk_in",a.showObject.orgLocId)&&(/*Register Walk-in menu*/
K=K+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+J+"' data-eventName='"+e.eventName+"' data-eventStartTime='"+e.eventStartTime+"' class='calendar-event-menu-style' id='registerWalkinMenu'>"+v+"</div></li>")),K+="</ul></div>",K.indexOf("</li>")!=-1&&($newdiv=$(K).css({left:H+"px",top:I+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}}else{var L=new Date,M=f.target.dataset.appointmentdate.split("-"),N=f.target.dataset.appointmentendtime.split(":"),O=parseInt(M[1])-1,P=O.toString(),Q=new Date(M[0],P,M[2],N[0],N[1],N[2]),T=!0;if("ADHOC"==f.target.dataset.appointmenttype&&p.getLoggedInUser().isOrganizationUserMode?T=!1:"ADHOC"!=f.target.dataset.appointmenttype&&(T=!1),"FCFS"!=f.target.dataset.appointmenttype&&0==T){var F=(Math.floor(501*Math.random()),$("#calendar").offset()),G="",H="",I="";q.mobilecheck()?(G=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),H=f.pageX-F.left+G-100,I=f.pageY-F.top+155):(G=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),H=f.pageX-F.left+G,I=f.pageY-F.top+$(".calendarDetailsRow").height());var U="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode)if("null"!=f.target.dataset.appointmentid){var S=z(new Date);"CHECKED_OUT"!=f.target.dataset.appointmentstatus&&"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus&&(/* cancel appointment menu */
U=U+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+t+"</div></li>",/* postpont appointment menu*/
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"),f.target.dataset.appointmentdate==S&&(/*Show status menu*/
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'>"+w+"</div></li>","NEW"!=f.target.dataset.appointmentstatus&&"POSTPONED"!=f.target.dataset.appointmentstatus||(/* Check in menu */
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkInRMenu'>"+x+"</div></li>"),"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus||(/* Checkout Menu */
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkOutRMenu'>"+A+"</div></li>"),"CHECKED_IN"==f.target.dataset.appointmentstatus&&(U=U+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='issueTokenRMenu'>"+issueTokenLable+"</div></li>"),"ISSUE_TOKEN"==f.target.dataset.appointmentstatus&&(U=U+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='consultationStartRMenu'>"+C+"</div></li>"),"CONSULTATION_STARTED"==f.target.dataset.appointmentstatus&&(U=U+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='consultationFinishRMenu'>"+D+"</div></li>")),U=U+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='viewAppointmentRMenu'>"+B+"</div></li>"}else 1==e.isUserLinked&&Q.getTime()>=L.getTime()&&(U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");else if("null"!=f.target.dataset.appointmentid){if("null"!=f.target.dataset.appointmentuserid&&f.target.dataset.appointmentuserid==angular.fromJson(p.getLoggedInUser()).id){var S=z(new Date);"ADHOC"!=f.target.dataset.appointmenttype&&"CHECKED_OUT"!=f.target.dataset.appointmentstatus&&"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus&&(/* cancel appointment menu */
U=U+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+t+"</div></li>",/* postpont appointment menu*/
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"),f.target.dataset.appointmentdate==S&&(/*Show status menu*/
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'>"+w+"</div></li>","NEW"!=f.target.dataset.appointmentstatus&&"POSTPONED"!=f.target.dataset.appointmentstatus||(/* Check in menu */
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkInRMenu'>"+x+"</div></li>"),"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus||(/* Checkout Menu */
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkOutRMenu'>"+A+"</div></li>")),U=U+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='viewAppointmentRMenu'>"+B+"</div></li>"}}else"ADHOC"!=f.target.dataset.appointmenttype&&1==e.isUserLinked&&Q.getTime()>=L.getTime()&&(U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");U+="</ul></div>",U.indexOf("</li>")!=-1&&($newdiv=$(U).css({left:H+"px",top:I+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}}else{var F=(Math.floor(501*Math.random()),$("#calendar").offset()),G="",H="",I="",L=new Date,M=f.target.dataset.appointmentdate.split("-"),N=f.target.dataset.appointmentendtime.split(":"),O=parseInt(M[1])-1,P=O.toString(),Q=new Date(M[0],P,M[2],N[0],N[1],N[2]);q.mobilecheck()?(G=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),H=f.pageX-F.left+G-100,I=f.pageY-F.top+155):(G=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),H=f.pageX-F.left+G,I=f.pageY-F.top+$(".calendarDetailsRow").height());var U="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){if(sessionStorage.getItem("oldAppointmentId")){r.showSpinner=!0;var V={};V.apptDate=e.eventSlots[0].slotDate,f.target.dataset&&!f.target.dataset.slotid||!f.target.dataset?f.target.firstElementChild&&f.target.firstElementChild.dataset&&f.target.firstElementChild.dataset.slotid&&(V.slotId=f.target.firstElementChild.dataset.slotid):f.target.dataset&&f.target.dataset.slotid&&(V.slotId=f.target.dataset.slotid),V.oldAppointmentId=sessionStorage.getItem("oldAppointmentId"),V.eventId=e.eventId,V.slotId&&V.eventId?c.postpondRegularAppointment(V,function(a){r.showSpinner=!1,l("success",a.successMessage),b.reload()},function(a){r.showSpinner=!1}):r.showSpinner=!1}else if("null"!=f.target.dataset.appointmentid)if("null"!=f.target.dataset.appointmentuserid){var S=z(new Date);"CHECKED_OUT"!=f.target.dataset.appointmentstatus&&"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus&&(/* cancel appointment menu */
U=U+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+t+"</div></li>",/* postpont appointment menu*/
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"),f.target.dataset.appointmentdate==S&&(/*Show status menu*/
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'>"+w+"</div></li>","NEW"!=f.target.dataset.appointmentstatus&&"POSTPONED"!=f.target.dataset.appointmentstatus||(/* Check in menu */
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkInRMenu'>"+x+"</div></li>"),"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus||(/* Checkout Menu */
U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkOutRMenu'>"+A+"</div></li>"))}else 1==e.isUserLinked&&Q.getTime()>=L.getTime()&&(U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");else 1==e.isUserLinked&&Q.getTime()>=L.getTime()&&(U=U+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");U+="</ul></div>",U.indexOf("</li>")!=-1&&($newdiv=$(U).css({left:H+"px",top:I+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}else{r.showSpinner=!0;var V={};V.apptDate=e.eventSlots[0].slotDate,f.target.dataset&&!f.target.dataset.slotid||!f.target.dataset?f.target.firstElementChild&&f.target.firstElementChild.dataset&&f.target.firstElementChild.dataset.slotid&&(V.slotId=f.target.firstElementChild.dataset.slotid):f.target.dataset&&f.target.dataset.slotid&&(V.slotId=f.target.dataset.slotid),d.data.appointmentId?V.oldAppointmentId=d.data.appointmentId:sessionStorage.getItem("oldAppointmentId")&&(V.oldAppointmentId=sessionStorage.getItem("oldAppointmentId")),V.eventId=e.eventId,V.oldAppointmentId&&V.slotId?c.postpondRegularAppointment(V,function(a){r.showSpinner=!1,l("success",a.successMessage),localStorage.setItem("isPostpond","false"),b.reload()},function(a){r.showSpinner=!1}):r.showSpinner=!1,r.showSpinner=!1}}}},a.slotEventOverlap=function(){return a.calendarObject.slotEventOverlap},/* add and removes an event source of choice */
a.addRemoveEventSource=function(a,b){var c=0;angular.forEach(a,function(d,e){a[e]===b&&(a.splice(e,1),c=1)}),0===c&&a.push(b)},/* Change View */
a.changeView=function(a,b){h.calendars[b].fullCalendar("changeView",a)},$(".container").click(function(e,f){if(e&&"equipmentcalendarview"==b.current.name){if(444!=e.target.id&&1111!=e.target.id)if("fixAppointmentMenu"==e.target.id)b.go("manageFixAppointment",{type:"add",eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.eventdate});else if("editEventMenu"==e.target.id)e.target.dataset.eventid&&b.go("manageEventCalendar",{type:"edit",eventId:e.target.dataset.eventid});else if("cancelAppointmentMenu"==e.target.id)b.go("cancelAppointmentList",{type:"cancel",eventId:e.target.dataset.eventid,date:e.target.dataset.eventdate});else if("postpondAppointmentMenu"==e.target.id)b.go("postponeAppointmentList",{type:"postpone",eventId:e.target.dataset.eventid});else if("listAppointmentMenu"==e.target.id)b.go("appointmentsList",{event:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.eventdate,entityName:e.target.dataset.entityname,loadFilter:!1});else if("showStatusMenu"==e.target.id)e.target.dataset.eventid&&e.target.dataset.eventdate&&b.go("userAppointmentStatus",{eventId:e.target.dataset.eventid,eventDate:e.target.dataset.eventdate,calendarState:d,callingPage:"equipmentcalendarview"});else if("registerWalkinMenu"==e.target.id)b.go("manageAppointmentWalkIn",{eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptStartTime:e.target.dataset.eventstarttime,apptDate:e.target.dataset.eventdate,appointmentType:"RECORDWALKIN",urlState:"manageAppointmentWalkIn",calendarState:d,callingPage:"equipmentcalendarview"});else if("eventExceptionMenu"==e.target.id)e.target.dataset.eventid&&b.go("manageEventCalendarException",{type:"add",eventId:e.target.dataset.eventid,calendarState:d,callingPage:"equipmentcalendarview"});else if("cancelAppointmentRMenu"==e.target.id){if(e.target.dataset.appointmentid&&"null"!=e.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")){var g={};if(a.oldAppointmentId=null,sessionStorage.setItem("oldAppointmentId","null"),g.apptDate=e.target.dataset.appointmentdate,$(".event-menu-list").remove(),a.menuVisible=!1,"true"!=localStorage.getItem("isPopupOpen")){localStorage.setItem("isPopupOpen","true");var h=i.confirm().title(m.instant("APPOINTMENT_CANCELATION_TITLE")).textContent(m.instant("APPOINTMENT_CANCELATION_MSG")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(h).then(function(){localStorage.setItem("isPopupOpen","false"),g.appointmentIds=[e.target.dataset.appointmentid],e.target.dataset.appointmentid=null,c.cancelAppointment(g,function(a){l("success",a.successMessage),b.reload()},function(a){})},function(){localStorage.setItem("isPopupOpen","false")})}}}else if("postpondAppointmentRMenu"==e.target.id){if("true"!=localStorage.getItem("isPopupOpen"))if(localStorage.setItem("isPopupOpen","true"),a.oldAppointmentId=null,sessionStorage.setItem("isPostpond","true"),sessionStorage.setItem("oldAppointmentId","null"),a.isPostpond=!0,$(".event-menu-list").remove(),a.menuVisible=!1,a.oldAppointmentId=e.target.dataset.appointmentid,sessionStorage.setItem("oldAppointmentId",e.target.dataset.appointmentid),localStorage.setItem("isPopupOpen","true"),"ADHOC"==e.target.dataset.appointmenttype)$(".event-menu-list").remove(),a.menuVisible=!1,i.show({controller:A,templateUrl:"app/modules/appointment/views/postpone-adhoc-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{oldAppointmentId:e.target.dataset.appointmentid,eventId:e.target.dataset.eventid,userId:p.getLoggedInUser().id,slotId:e.target.dataset.slotid}}).then(function(b){a.WSHealthProfessionalsValues={},localStorage.setItem("isPopupOpen","false"),a.isPostpond=!1,sessionStorage.setItem("isPostpond","false")},function(){a.WSHealthProfessionalsValues={},localStorage.setItem("isPopupOpen","false"),a.isPostpond=!1,sessionStorage.setItem("isPostpond","false")});else{var h=i.confirm().title(m.instant("POSTPONE_APPOINTMENT")).textContent(m.instant("SELECT_SLOT_TO_POSTPONT")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(h).then(function(){i.hide(),localStorage.setItem("isPopupOpen","false")},function(){i.hide(),localStorage.setItem("isPopupOpen","false"),sessionStorage.setItem("isPostpond",!1),a.isPostpond=!1})}}else if("showStatusRMenu"==e.target.id)e.target.dataset.appointmentid&&b.go("userAppointmentStatus",{appoinmentId:e.target.dataset.appointmentid,calendarState:d,callingPage:"equipmentcalendarview"});else if("viewAppointmentRMenu"==e.target.id)b.go("manageFixAppointment",{type:"view",appointmentId:e.target.dataset.appointmentid});else if("issueTokenRMenu"==e.target.id)e.target.dataset.appointmentid&&a.manageIssueToken(e.target.dataset.appointmentid);else if("consultationStartRMenu"==e.target.id){if(e.target.dataset.appointmentid&&e.target.dataset.appointmentdate&&e.target.dataset.eventid&&e.target.dataset.eventname&&"true"!=localStorage.getItem("isPopupOpen")){localStorage.setItem("isPopupOpen","true");var j={id:e.target.dataset.appointmentid,event:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate};a.manageConsultationStarted(j)}}else if("consultationFinishRMenu"==e.target.id)e.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),a.manageConsultationFinished({id:e.target.dataset.appointmentid}));else if("checkInRMenu"==e.target.id)e.target.dataset.appointmentid&&b.go("manageAppointmentCheckIn",{appointmentId:e.target.dataset.appointmentid,entityType:{id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypename,code:e.target.dataset.entitytypecode},entityName:{id:e.target.dataset.entityid,value:e.target.dataset.entityname},eventType:{id:e.target.dataset.eventtypeid,value:e.target.dataset.eventtypename},eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate,apptStartTime:e.target.dataset.appointmenttime,apptEndTime:e.target.dataset.appointmentendtime});else if("checkOutRMenu"==e.target.id)e.target.dataset.appointmentid&&b.go("manageAppointmentCheckOut",{appointmentId:e.target.dataset.appointmentid,entityType:{id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypename,code:e.target.dataset.entitytypecode},entityName:{id:e.target.dataset.entityid,value:e.target.dataset.entityname},eventType:{id:e.target.dataset.eventtypeid,value:e.target.dataset.eventtypename},eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate,apptStartTime:e.target.dataset.appointmenttime,apptEndTime:e.target.dataset.appointmentendtime});else if("fixAppointmentRMenu"==e.target.id){if($(".event-menu-list").remove(),a.menuVisible=!1,e.target.dataset.appointmentid){var k=null;"ADHOC"!=e.target.dataset.appointmenttype&&(k=e.target.dataset.appointmentendtime),"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),i.show({controller:"QuickFixAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/fix-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{fixApptObj:{appointmentEnd:k,type:"add",appointmentId:e.target.dataset.appointmentid,slotId:e.target.dataset.slotid,entityType:{id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypename,code:e.target.dataset.entitytypecode},entityName:{id:e.target.dataset.entityid,value:e.target.dataset.entityname},eventType:{id:e.target.dataset.eventtypeid,value:e.target.dataset.eventtypename},eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate,apptStartTime:e.target.dataset.appointmenttime,apptEndTime:k,eventExceptionId:e.target.dataset.eventexceptionid}}}).then(function(a){b.reload()},function(){a.WSHealthProfessionalsValues={}}))}}else $(".event-menu-list").remove(),a.menuVisible=!1}else 1==a.menuVisible&&($(".event-menu-list").remove(),a.menuVisible=!1)}),a.viewRender=function(b,c){b&&a.getCalendarData(b)},a.setCalendarData=function(b,c){var d=new Date;d.setYear(b),d.setMonth(c),h.calendars.myCalendar.fullCalendar("removeEvents"),angular.forEach(a.calendarMaster.events,function(a,b){h.calendars.myCalendar.fullCalendar("renderEvent",a)})},a.filterEvent=function(){h.calendars.myCalendar.fullCalendar("rerenderEvents")},/* Render Tooltip */
a.eventRender=function(b,d,e){c.setEventStyle(d,b,a.slotTime)},a.eventAfterAllRender=function(a){$(".fc-content .fc-time").hide()},a.manageIssueToken=function(a){a&&(r.showSpinner=!0,w.manageIssueToken(a,function(a){r.showSpinner=!1,l("success",m.instant("TOKEN_ISSUE_SUCCESS")),b.reload()},function(a){r.showSpinner=!1}))},a.manageConsultationStarted=function(a){a&&(r.showSpinner=!0,w.validateStartConsultation(a,function(c){if(r.showSpinner=!1,""==c.successMessage)w.manageConsultationStarted(a.id,function(a){r.showSpinner=!1,l("success",m.instant("CONSULT_START_SUCCESS")),b.reload()},function(a){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")});else{var d=i.confirm().title(m.instant("CONFIRM_START_CUNSULTATION")).textContent(c.successMessage).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(d).then(function(){r.showSpinner=!0,w.confirmStartConsultation(a,function(a){r.showSpinner=!1,l("success",m.instant("CONSULT_START_SUCCESS")),b.reload()},function(a){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")})},function(){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")})}},function(a){r.showSpinner=!1}))},a.manageConsultationFinished=function(a){a&&a.id&&(r.showSpinner=!0,w.manageConsultationCompleted(a.id,function(a){r.showSpinner=!1,l("success",m.instant("CONSULT_FINISHED_SUCCESS")),b.reload()},function(a){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")}))},/* config object */
a.events=a.calendarMaster.events,/* event sources array*/
a.eventSources=[a.eventSource],a.CalendarPopUpValues={},/* filter code start */
a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.entityType={queryUrl:"GET_ENTITY_TYPES_EXCEPT_ORG_LOC",queryParameter:{}},a.getCalendarName=function(){var b={};q.isNullOrEmpty(a.searchCriteria.entityType)||(b.entityTypeId=a.searchCriteria.entityType.id),q.isNullOrEmpty(a.searchCriteria.orgLocation)||(b.organizationLocationId=a.searchCriteria.orgLocation.id),q.isNullOrEmpty(a.searchCriteria.entityName)||(b.entityId=a.searchCriteria.entityName.id),u.postData(v.getUrl("CALENDAR_SMART_SEARCH"),b,function(b){b&&b.data&&(a.calendarNames=b.data)},function(a){errorCallback(a)})},a.$watch("searchCriteria.orgLocation",function(b,c){b&&b.id?(a.locationID=b.id,f(function(){a.getCalendarName()},0)):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.isEquipment=!1,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:a.searchCriteria.orgLocation.id}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.isProcess=!1,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:a.searchCriteria.orgLocation.data.id}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}}),f(function(){a.getCalendarName()},0)):(a.searchCriteria.entityName=null,a.searchCriteria.calendarObj=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.entityName",function(b,c){b&&b.id?a.entityNameID=b.id:a.searchCriteria.calendarObj=null;f(function(){a.getCalendarName()},0)}),a.filterCalendar=function(){if(!q.isFieldEmpty(a.searchCriteria.orgLocation)){r.showSpinner=!0;var d={calendarId:a.searchCriteria.calendarObj.id,entityTypeCode:a.searchCriteria.entityType.code,entityId:a.searchCriteria.entityName.id};c.getCalendarDetailsById(d,function(c){if(r.showSpinner=!1,c)if(localStorage.setItem("cmi",angular.toJson(c)),q.isNullOrEmpty(a.searchCriteria)||localStorage.setItem("viewCalendarFilterValues",angular.toJson(a.searchCriteria)),"CAL_ORGANIZATION_USER"==a.searchCriteria.entityType.code)localStorage.removeItem("viewCalendarFilterValues"),b.go("usercalendarview",{type:"regular",data:c,fromListPage:!0});else if("CAL_PROCESS"==a.searchCriteria.entityType.code)localStorage.removeItem("viewCalendarFilterValues"),b.go("processcalendarview",{type:"regular",data:c});else if("CAL_EQUIPMENT"==a.searchCriteria.entityType.code){sessionStorage.setItem("samePageCall",!0);var d={inherit:!1};b.go(".",{data:c,samePageCall:!0},d)}},function(a){r.showSpinner=!1})}},a.clear=function(){a.searchCriteria={}}}]),//var calendarDemoApp = angular.module('fullCalendarModule', ['ui.calendar', 'ui.bootstrap','ngMaterial','ngMaterialDatePicker']);
angular.module("paripal.fullCalendarModule").controller("IndividualCalendarCtrl",["$scope","$state","commonCalendarService","$stateParams","$compile","$timeout","$filter","uiCalendarConfig","$mdDialog","$mdMedia","createEventService","notify","$translate","featurePrivilegeConstants","calendarObjIteratorService","$rootScope","baseService","commonConstants","httpService","urlService","manageFixAppointmentService","utilService","EmergencyTransactionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){a.calendarMasterObject={},a.calendarMaster={},a.events=[],a.selectedEntityId=0,a.calendarMasterId=0,a.workingTimes=[{}],a.holidayArray=[],a.nonWorkingArray=[],a.calendarObjectData={},a.defaultView="agendaWeek",a.menuVisible=!1,localStorage.setItem("isPopupOpen","false"),a.loggedInUserDetails=p.loggedInUserDetails,a.getCalendarData=function(b){a.calendarMasterObject.calendarId=a.calendarObjectData.id,a.calendarMasterObject.organizationLocationId=a.calendarObjectData.organizationLocationId,a.calendarMasterObject.entityId=a.calendarObjectData.entityId,b?"agendaDay"==b.type?(a.calendarMasterObject.startDate=b.start._d,a.calendarMasterObject.endDate=b.start._d):(a.calendarMasterObject.startDate=b.start._d,a.calendarMasterObject.endDate=b.end._d):(a.calendarMasterObject.startDate=new Date,a.calendarMasterObject.endDate=new Date);var d="",e="";if(b)if("month"==b.type){var f=b.title.indexOf(" ");d=b.title.substring(0,f),e=b.title.substring(f+1)}else{var h=new Date;d=g("date")(c.dateFormatter(h),"MMMM"),e=g("date")(c.dateFormatter(h),"yyyy")}else{var h=new Date;d=g("date")(c.dateFormatter(h),"MMMM"),e=g("date")(c.dateFormatter(h),"yyyy")}a.calendarMasterObject.entityId=q.getLoggedInUser().id,c.getMyCalendar(a.calendarMasterObject,function(c){a.bookedEvents=c,a.eventArray=[];angular.forEach(a.bookedEvents,function(c,d){var e={};e.eventStartTime=c.startTime,e.eventEndTime=c.endTime,e.eventDate=c.apptDate,e.eventUserId=a.calendarMasterObject.entityId,e.event=c.event,e.appointmentId=c.appointmentId,b&&(e.viewType=b.type),e.start=c.apptDate+" "+c.startTime,e.end=c.apptDate+" "+c.endTime,e.organizationLocationId=c.organizationLocationId,e.slotId=c.slotId,e.userId=c.userId,e.calendarId=c.calendarId,e.entityId=c.entityId,e.entityType=c.entityType,e.eventType=c.eventType,e.doctorsAssoctiated=c.doctorsAssoctiated,e.entityName=c.entityName,e.nonParipalAppointment=c.nonParipalAppointment,e.appointmentStatus=c.appointmentStatus,c.doctorName&&(e.doctorName=c.doctorName),c.locationName&&(e.locationName=c.locationName),c.appointmentType&&(e.appointmentType=c.appointmentType),a.eventArray.push(e)}),a.uiConfig={calendar:{height:500,editable:!1,contentHeight:500,slotDuration:"00:05:00",customButtons:{myCustomButton:{text:"Custom appointment",click:a.createCustomAppointment}},header:{left:"prev,next today",center:"title",right:"myCustomButton,agendaWeek,agendaDay"},buttonText:{today:"Today",week:"Week",day:"Day"},events:a.events,fixedWeekCount:!1,defaultView:a.defaultView,businessHours:{},eventLimit:!0,views:{agenda:{eventLimit:1}},displayEventTime:!0,viewRender:a.viewRender,eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,eventRender:a.eventRender,dayClick:a.dayClick,eventClick:a.eventClick,slotEventOverlap:a.slotEventOverlap,dayRender:a.dayRender,eventAfterAllRender:a.eventAfterAllRender,viewDestroy:a.viewDestroy,firstDay:(new Date).getDay()}},a.setCalendarData(e,d)},function(a){}),1!=a.loggedInUser.whetherSubscriber&&$(".fc-myCustomButton-button").hide()},a.init=function(){localStorage.setItem("isCheckedIn","false"),a.loggedInUser=q.getLoggedInUser(),a.getCalendarData()},a.init(),a.createCustomAppointment=function(c,d){i.show({controller:"CustomAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/custom-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:r.dialogBox.clickOutsideToClose,
// fullscreen: useFullScreen,
locals:{calendarRequestData:a.calendarMasterObject,appointmentData:c,mode:d}}).then(function(b){a.WSHealthProfessionalsValues={}},function(c){a.WSHealthProfessionalsValues={},c&&b.reload()})},a.changeTo="Hungarian",/* event source that pulls from google.com */
a.eventSource={className:"gcal-event",// an option!
currentTimezone:"America/Chicago"},/* event source that contains custom events on the scope */
/*$scope.events = $scope.calendarObject.events;*/
/* event source that calls a function on every view switch */
a.customFullscreen=j("xs")||j("sm"),
//
// Controller for create Event
//
a.businessHours=function(){},a.eventClick=function(b,c){function d(){var d=(Math.floor(501*Math.random()),$("body").width(),$(".calendarRow").width(),$("body").height(),$("#calendar").offset()),e=($(".calendarRow").height(),""),f="";v.mobilecheck()?(calendarXPadding=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),e=c.pageX-d.left+calendarXPadding-100,f=c.pageY-d.top+155):(calendarXPadding=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),e=c.pageX-d.left+calendarXPadding,f=c.pageY-d.top+$(".calendarDetailsRow").height());var g="<div class='event-menu-list' style='margin-top: 0px !important'><ul>",h=new Date,i=new Date(b.eventDate+" "+b.eventEndTime);i.getTime()>=h.getTime()&&("ADHOC"!=b.appointmentType&&"NEW"==b.appointmentStatus&&(g=g+"<li><div class='calendar-event-menu-style' data-nonParipalAppointment='"+b.nonParipalAppointment+"' data-appointmentDate='"+c.target.dataset.appointmentdate+"' data-appointmentId='"+c.target.dataset.appointmentid+"' id='cancelAppointmentRMenu'> Cancel Appointment</div></li>"),0==b.nonParipalAppointment&&"ADHOC"!=b.appointmentType&&"NEW"==b.appointmentStatus&&(g=g+"<li><div class='calendar-event-menu-style' data-appointmentDate='"+c.target.dataset.appointmentdate+"' data-appointmentId='"+c.target.dataset.appointmentid+"' id='postPondAppointmentMenu'> Postpone Appointment</div></li>"),0==b.nonParipalAppointment&&(g=g+"<li><div data-appointmentId='"+c.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='showStatusRMenu'> Show Status</div></li>"),b.eventType&&"CAL_EVENT_ONLINE"==b.eventType.code&&(g=g+"<li><div data-entityTypeCode='"+b.entityType.code+"' data-entityTypeId='"+b.entityType.id+"' data-appointmentId='"+c.target.dataset.appointmentid+"' data-eventtypecode='"+b.eventType.code+"' data-eventid='"+b.event.id+"' class='calendar-event-menu-style' id='checkInRMenu'> Check-in</div></li>"),"ADHOC"!=b.appointmentType&&(g=g+"<li><div data-appointmentId='"+c.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='updateStatusRMenu'> Update status</div></li>")),g=g+"<li><div class='calendar-event-menu-style' data-appointmentDate='"+c.target.dataset.appointmentdate+"' data-nonParipalAppointment='"+b.nonParipalAppointment+"' data-appointmentId='"+c.target.dataset.appointmentid+"' id='viewAppointmentMenu'> View Appointment</div></li><li><div class='calendar-event-menu-style' data-appointmentId='"+c.target.dataset.appointmentid+"' id='viewUploadDownloadMenu'> Upload/Download</div></li><li><div class='calendar-event-menu-style' data-appointmentId='"+c.target.dataset.appointmentid+"'data-nonParipalAppointment='"+b.nonParipalAppointment+"' id='showNotesMenu'> Show notes</div></li>",g+="</ul></div>",$newdiv=$(g).css({left:e+"px",top:f+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0}if(1==b.exception){(j("sm")||j("xs"))&&a.customFullscreen;i.show({controller:exceptionApprovalCtrl,templateUrl:"app/modules/fullCalendar/views/exception-approval.html",parent:angular.element(document.body),clickOutsideToClose:r.dialogBox.clickOutsideToClose,
// fullscreen: useFullScreen,
locals:{calendarDayEventId:b.id,calendarRequestData:a.calendarMasterObject,eventDate:b.eventDate,eventException:b.eventException}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})}else if(1==a.menuVisible)$(".event-menu-list").remove(),a.menuVisible=!1;else if(444!=c.target.id){b.className&&delete b.className,b.end&&delete b.end,b.start&&delete b.start,b.source&&delete b.source;var e=angular.toJson(b);localStorage.setItem("selectedEvent",e),d()}},a.slotEventOverlap=function(){return a.calendarObject.slotEventOverlap},/* add and removes an event source of choice */
a.addRemoveEventSource=function(a,b){var c=0;angular.forEach(a,function(d,e){a[e]===b&&(a.splice(e,1),c=1)}),0===c&&a.push(b)},/* Change View */
a.changeView=function(a,b){h.calendars[b].fullCalendar("changeView",a)},/* Change View */
a.renderCalender=function(a){f(function(){h.calendars[a]})},$("body").click(function(d,e){if(d){if(444!=d.target.id&&1111!=d.target.id)if("fixAppointmentMenu"==d.target.id)b.go("manageFixAppointment",{type:"add"});else if("cancelAppointmentRMenu"==d.target.id){if(d.target.dataset.appointmentid&&"null"!=d.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")){$(".event-menu-list").remove(),a.menuVisible=!1,localStorage.setItem("isPopupOpen","true");var f=i.confirm().title(m.instant("APPOINTMENT_CANCELATION_TITLE")).textContent(m.instant("APPOINTMENT_CANCELATION_MSG")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(f).then(function(){if(localStorage.setItem("isPopupOpen","false"),"true"==d.target.dataset.nonparipalappointment){var a={appointmentId:d.target.dataset.appointmentid};c.cancelCustomAppointment(a,function(a){l("success",a.successMessage),b.reload()},function(a){})}else{var e={};e.appointmentIds=[d.target.dataset.appointmentid],e.apptDate=d.target.dataset.appointmentdate,d.target.dataset.appointmentid=null,c.cancelAppointment(e,function(a){l("success",a.successMessage),b.reload()},function(a){})}},function(){localStorage.setItem("isPopupOpen","false")})}}else if("postPondAppointmentMenu"==d.target.id){var g=JSON.parse(localStorage.getItem("selectedEvent"));g.isPostpond=!0,localStorage.setItem("isPostpond","true"),"CAL_ORGANIZATION_USER"==g.entityType.code?b.go("usercalendarview",{type:"regular",data:g}):"CAL_PROCESS"==g.entityType.code?b.go("processcalendarview",{type:"regular",data:g}):"CAL_EQUIPMENT"==g.entityType.code&&b.go("equipmentcalendarview",{type:"regular",data:g})}else if("showStatusRMenu"==d.target.id)b.go("userAppointmentStatus",{type:"view",appoinmentId:d.target.dataset.appointmentid});else if("viewAppointmentMenu"==d.target.id){if("true"!=localStorage.getItem("isPopupOpen"))if(a.menuVisible=!1,localStorage.setItem("isPopupOpen","true"),"true"==d.target.dataset.nonparipalappointment){p.showSpinner=!0;var h={appointmentId:d.target.dataset.appointmentid};a.menuVisible=!1,$(".event-menu-list").remove(),c.viewCustomAppointment(h,function(b){localStorage.setItem("isPopupOpen","false"),a.createCustomAppointment(b,"view"),p.showSpinner=!1},function(a){})}else b.go("manageFixAppointment",{type:"view",appointmentId:d.target.dataset.appointmentid})}else if("listAppointmentMenu"==d.target.id)b.go("appointmentsList",{});else if("viewUploadDownloadMenu"==d.target.id){var j={};j.appointmentId=d.target.dataset.appointmentid,s.getData(t.getParameterizedUrl("GET_USER_DETAILS_BY_APPT_ID",j),null,function(a){a.data.appointmentId=d.target.dataset.appointmentid,a.type="edit",b.go("appointmentsuploadlist",a)})}else if("showNotesMenu"==d.target.id)b.go("appointmentnotes",{appointmentId:d.target.dataset.appointmentid,type:"edit",callingUrl:"mycalendarview",isCustomAppointment:d.target.dataset.nonparipalappointment});else if("registerWalkinMenu"==d.target.id);else if("checkInRMenu"==d.target.id){if(d.target.dataset.appointmentid&&"CAL_EVENT_ONLINE"==d.target.dataset.eventtypecode){var k={appointmentId:d.target.dataset.appointmentid};s.getData(t.getParameterizedUrl("GET_CHECK_IN_OUT_DETAILS",k),null,function(c){if(c&&c.data)if(a.apptDetails=c.data,
//added for agora video call requirement
localStorage.setItem("appmentData",angular.toJson(a.apptDetails)),v.isNullOrEmpty(a.apptDetails.serviceType))$(".event-menu-list").remove(),a.menuVisible=!1,"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),i.show({controller:"UpdateServiceTypeCtrl",templateUrl:"app/modules/fullCalendar/views/update-service-type-popup.html",/*parent: angular.element(document.body),*/
clickOutsideToClose:r.dialogBox.clickOutsideToClose,locals:{apptDetails:a.apptDetails,apptId:d.target.dataset.appointmentid}}).then(function(){},function(a){if(!v.isNullOrEmpty(a)){d.target.dataset.appointmentid&&localStorage.setItem("appointmentId",d.target.dataset.appointmentid),d.target.dataset.eventid&&localStorage.setItem("eventId",d.target.dataset.eventid),a&&localStorage.setItem("whetherOnlineAppointment",!0);var c={transactionId:a};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"FIX_APPOINTMENTS"})),w.getWhetherBillDetails(c,function(c){b.go("billsummaryview",{transactionId:a})},function(a){var b="UNABLE_TO_FIX_ONLINE_APPOINTMENT",c="UNABLE_TO_FIX_ONLINE_APPOINTMENT_MESSAGE";1==q.getLoggedInUser().isOrganizationUserMode&&(c="APPOINTMENT_FEE_NOT_FOUND_BODY",b="FEE_TYPE_NOT_FOUND_TITLE");var d=i.confirm().title(m.instant(b)).textContent(m.instant(c)).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(d).then(function(){},function(){})},{handleError:!1})}}));else if(!v.isNullOrEmpty(a.apptDetails.transactionId)){d.target.dataset.appointmentid&&localStorage.setItem("appointmentId",d.target.dataset.appointmentid),d.target.dataset.eventid&&localStorage.setItem("eventId",d.target.dataset.eventid),a.apptDetails.transactionId&&localStorage.setItem("whetherOnlineAppointment",!0);var e={transactionId:a.apptDetails.transactionId};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"FIX_APPOINTMENTS"})),w.getWhetherBillDetails(e,function(c){b.go("billsummaryview",{transactionId:a.apptDetails.transactionId})},function(a){var b="UNABLE_TO_FIX_ONLINE_APPOINTMENT",c="UNABLE_TO_FIX_ONLINE_APPOINTMENT_MESSAGE";1==q.getLoggedInUser().isOrganizationUserMode&&(c="APPOINTMENT_FEE_NOT_FOUND_BODY",b="FEE_TYPE_NOT_FOUND_TITLE");var d=i.confirm().title(m.instant(b)).textContent(m.instant(c)).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(d).then(function(){},function(){})},{handleError:!1})}},function(a){})}}else"checkOutMenu"==d.target.id||("updateStatusRMenu"==d.target.id?($(".event-menu-list").remove(),a.menuVisible=!1,"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),i.show({controller:"UpdateStatusCtrl",templateUrl:"app/modules/fullCalendar/views/update-status-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{apptId:d.target.dataset.appointmentid}}).then(function(a){},function(){}))):($(".event-menu-list").remove(),a.menuVisible=!1))}else 1==a.menuVisible&&($(".event-menu-list").remove(),a.menuVisible=!1)}),a.viewRender=function(b,c){/*if (view.name == "month") {*/
b&&a.getCalendarData(b)},a.setCalendarData=function(b,c){var d=new Date;d.setYear(b),d.setMonth(c),h.calendars.myCalendar.fullCalendar("removeEvents"),/*renderDate.setDate(1);*/
angular.forEach(a.eventArray,function(a,b){h.calendars.myCalendar.fullCalendar("renderEvent",a)})},a.filterEvent=function(){h.calendars.myCalendar.fullCalendar("rerenderEvents")},/* Render Tooltip */
a.eventRender=function(a,b,d){c.setEventStyle(b,a)},a.eventAfterAllRender=function(a){$(".fc-content .fc-time").hide()},/* config object */
a.events=a.eventArray,/* event sources array*/
a.eventSources=[a.eventSource],a.CalendarPopUpValues={}}]),angular.module("paripal.fullCalendarModule").controller("IndividualCalendarListCtrl",["datatableconfig","serverSidePagination","$state","utilService","commonCalendarService","$scope","$filter","httpService","urlService","$compile","$timeout","createCalendarService","uiCalendarConfig","$mdDialog","$mdMedia","$rootScope","notify","userStatusService","baseService","$translate","manageRequestService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.calendarSearchCriteria={},f.calendarSpinner=!1,f.calendars={},f.filterCriteria={},f.orgLocDisabled=!0,f.entityHided=!0,/*$scope.calendars=commonCalendarService.trial2();*/
f.getOrganizationList=function(){h.getData(i.getUrl("GET_ORG"),null,function(a){f.organizationList=angular.fromJson(a.data)},function(a){})},r.isUserLoggedIn()&&f.getOrganizationList(),f.organizationSelected=function(){f.getOrgLocation(f.calendarSearchCriteria.organizationId),f.orgLocDisabled=!1},f.getOrgLocation=function(a){f.requestData={},f.requestData.orgId=a,h.getData(i.getParameterizedUrl("FIND_ORGLOCBYID",f.requestData),null,function(a){f.locations=angular.fromJson(a.data)},function(a){})},f.organizationLocationSelected=function(){},f.getEntityTypes=function(){return h.getData(i.getUrl("GET_ENTITY_TYPES"),null,function(a){f.entityTypes=angular.fromJson(a.data),"professionalwall"===c.params.type&&angular.forEach(f.entityTypes,function(a,b){"CAL_ORGANIZATION_USER"===a.code&&(
//$scope.filterCriteria.entityTypeId = value;
f.displayId=a.id)})},function(a){})},f.getEntityTypes(),f.entityTypesSelected=function(){f.calendarSearchCriteria.entityTypeId=f.filterCriteria.entityTypeId.id,f.displayId=f.filterCriteria.entityTypeId.id,f.selectedEntity=f.filterCriteria.entityTypeId,f.showEntityFilter(f.selectedEntity)},f.showEntityFilter=function(a){"CAL_ORGANIZATION_USER"==a.code?(f.entityHided=!1,f.orgUser=!0):"CAL_USER"==a.code?(f.entityHided=!1,f.orgUser=!1):"CAL_ORGANIZATION_LOCATION"==a.code?(f.calendarSearchCriteria.entityId=f.calendarSearchCriteria.organizationLocationId,f.filterCriteria.entityId=null,f.entityHided=!0):(f.calendarSearchCriteria.entityId=null,f.filterCriteria.entityId=null,f.entityHided=!0)},f.getEntityData=function(a){if(f.orgUser){var b={};return b.userName=a,f.filterCriteria.organizationLocation.data&&(b.orgLocId=f.filterCriteria.organizationLocation.data.id),h.getData(i.getParameterizedUrl("FIND_USERBYORGLOC",b),null,function(a){return f.entityData=angular.fromJson(a.data),f.entityData},function(a){})}var b={};return b.userName=a,h.getData(i.getParameterizedUrl("GET_ALL_USERS",b),null,function(a){return f.entityData=angular.fromJson(a.data),f.entityData},function(a){})},f.onEntitySelect=function(a){f.calendarSearchCriteria.entityId=a.id},f.filterCalendar=function(a,c,g){f.calendarSpinner=!0,d.isFieldEmpty(f.calendarSearchCriteria)&&(f.calendarSearchCriteria={}),f.filterCriteria.entityId&&!d.isFieldEmpty(c)&&(f.filterCriteria.entityId.displayName=c.value),f.calendarSearchCriteria.organizationId=f.filterCriteria.organization.data.id,f.calendarSearchCriteria.organizationLocationId=f.filterCriteria.organizationLocation.data.id,f.calendarSearchCriteria.pageNumber=f.currentPage,f.calendarSearchCriteria.recordsPerPage=f.itemPerPage,f.filterCriteria.entityTypeId&&(f.calendarSearchCriteria.entityTypeCode=f.filterCriteria.entityTypeId.code),f.filterCriteria.iAmClient&&f.filterCriteria.iAmNotClient?f.calendarSearchCriteria.whetherClient=null:f.filterCriteria.iAmClient?f.calendarSearchCriteria.whetherClient=!0:f.calendarSearchCriteria.whetherClient=!1,e.getIndividualCalendarList(f.calendarSearchCriteria,function(a){f.calendars=a,f.totalItems=a.length,f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems),f.calendarSpinner=!1},function(a){f.calendarSpinner=!1},g)},f.clear=function(){d.isFieldEmpty(f.calendarSearchCriteria)||(f.calendarSearchCriteria.entityId=null,f.calendarSearchCriteria.entityTypeId=null),f.calendarSearchCriteria=null,f.filterCriteria.entityTypeId=null,f.filterCriteria.entityId=null,f.filterCriteria={},f.orgLocDisabled=!0,f.entityHided=!0,f.init()},f.addNewCalendar=function(){c.go("createcalendarview",{type:"",data:""})},f.fixAppointment=function(a){h.postData(i.getUrl("FIND_CALENDARBYID"),a,function(a){c.go("manageFixAppointment",{type:"add",entityType:a.data.entityType,entityName:{id:a.data.entityId,value:a.data.entityName},fromState:"individualcalendarlist",orgLocation:a.data.organizationLocation})},function(a){})},/*
                   };*/
f.viewCalendar=function(a){"CAL_ORGANIZATION_USER"==a.entityType.code?c.go("usercalendarview",{type:"regular",data:a}):"CAL_PROCESS"==a.entityType.code?c.go("processcalendarview",{type:"regular",data:a}):"CAL_EQUIPMENT"==a.entityType.code?c.go("equipmentcalendarview",{type:"regular",data:a}):"CAL_ORGANIZATION_LOCATION"==a.entityType.code&&c.go("locationcalendarview",{type:"regular",data:a})},f.viewException=function(a){c.go("usercalendarview",{type:"exception",data:a})},f.linkCalendar=function(a){h.postData(i.getUrl("FIND_CALENDARBYID"),a,function(b){c.go("linkCalendar",{type:"link",entityId:a.entityId,entityData:a.entityType,data:angular.fromJson(b.data),calendarId:a.id})},function(a){})},f.editCalendar=function(a){h.postData(i.getUrl("FIND_CALENDARBYID"),a,function(b){c.go("editcalendarview",{type:"edit",entityId:a.entityId,entityData:a.entityType,data:angular.fromJson(b.data),calendarId:a.id})},function(a){})},f.pageChanged=function(){f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems)},f.validateCalendarMenu=function(a){f.endDate=new Date(a.endDate),f.isCalendarExpired=d.dateComparator(f.endDate,f.currentDate,"lt")},f.unLinkCalendar=function(a){h.postData(i.getUrl("UNLINK_CALENDAR"),a,function(a){q("success","Calendar unlinked successfully")},function(a){})},f.setMaxRecords=function(a){f.pageNumber=1,f.itemPerPage=a};
//datatble config json
var v={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(v),f.dtColumnDefs=a.setColumnProperties({}),f.init=function(){f.status={},f.filterCriteria.organization={},f.filterCriteria.organizationLocation={},f.filterCriteria.organization.data={},f.filterCriteria.organizationLocation.data={},f.isCalendarExpired=!1,f.filterCriteria.iAmClient=!0;var a={};a.pickListCode="calendarEntityType",a.pickListItemCode="CAL_ORGANIZATION_USER",/*$scope.displayId*/
f.currentDate=new Date;var b=null,e=null;"professionalwall"===c.params.type&&(b=c.params.data,e="SEARCH_CALENDAR_BY_PROFESSIONAL",f.fromProfessionalWall=!0),u.getPicklistWSByCode(a,function(a){f.displayId=a.data.id,f.filterCriteria.entityTypeId=a.data,f.filterCalendar(!0,b,e)},function(a){}),d.isFieldEmpty(p.loggedInUserDetails)||d.isFieldEmpty(p.loggedInUserDetails.userAccountStatusDTO)||(f.whetherClient=p.loggedInUserDetails.userAccountStatusDTO.whetherClient)},f.init()}]),//var calendarDemoApp = angular.module('fullCalendarModule', ['ui.calendar', 'ui.bootstrap','ngMaterial','ngMaterialDatePicker']);
angular.module("paripal.fullCalendarModule").controller("LocationCalendarCtrl",["$scope","$state","commonCalendarService","$stateParams","$compile","$timeout","$filter","uiCalendarConfig","$mdDialog","$mdMedia","createEventService","notify","$translate","featurePrivilegeConstants","calendarObjIteratorService","baseService","utilService","$rootScope","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(a,d,e,f,g,h){a.decision={},a.decisionObject={},a.addEventTrue=!0,a.twelveHrFormat=function(a){if(a>="12:00"){var b=a.replace(":","");return(b=1200)?(b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM")):(b-=1200,b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"))}return a+=" AM"},a.getExceptionDetails=function(){k.getExceptionDetails(f,e,g,h,function(b){a.exceptionDetails=b,a.exceptionDetails.startTime=a.twelveHrFormat(a.exceptionDetails.startTime.substring(0,5)),a.exceptionDetails.endTime=a.twelveHrFormat(a.exceptionDetails.endTime.substring(0,5)),angular.forEach(a.exceptionDetails.wsCalendarTimings,function(a,b){var c=new Date,d=new Date;c.setHours(a.startTime.substring(0,2)),c.setMinutes(a.startTime.substring(3,5)),a.startTime=c,d.setHours(a.endTime.substring(0,2)),d.setMinutes(a.endTime.substring(3,5)),a.endTime=d})},function(a){})},a.getExceptionDetails(),a.cancel=function(){d.cancel()},a.validateReason=function(){"Approve"==a.decision.status?a.isReasonRequired=!1:a.isReasonRequired=!0},a.exceptionDecision=function(){"Approve"==a.decision.status?a.decisionObject.status="ACCEPTED":a.decisionObject.status="REJECTED",a.decisionObject.calendarDayEventId=e,a.decisionObject.reason=a.decision.reason,a.decisionObject.organizationLocationId=f.organizationLocationId,a.decisionObject.id=e,a.decisionObject.eventException=h,c.saveExceptionDecision(a.decisionObject,function(a){d.cancel(),b.reload()},function(a){})}}function v(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString(),e=c.split(""),f=d.split("");return b+"-"+(e[1]?c:"0"+e[0])+"-"+(f[1]?d:"0"+f[0])}u.$inject=["$scope","$mdDialog","calendarDayEventId","calendarRequestData","eventDate","eventException"],a.calendarMasterObject={},a.calendarMaster={},a.events=[],a.selectedEntityId=0,a.calendarMasterId=0,a.workingTimes=[{}],a.holidayArray=[],a.nonWorkingArray=[],a.calendarObjectData={},a.searchCriteria={},a.searchCriteria.orgLocation={},a.slotTime=15,q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek",a.menuVisible=!1,localStorage.setItem("isPopupOpen","false"),r.showSpinner=!1,a.getCalendarData=function(b){a.calendarMasterObject.calendarId=a.calendarObjectData.id,a.calendarMasterObject.organizationLocationId=a.calendarObjectData.organizationLocationId,a.calendarMasterObject.entityId=a.calendarObjectData.entityId,b?(a.calendarMasterObject.startDate=b.start._d,a.calendarMasterObject.endDate=b.end._d,"agendaDay"==b.type&&(a.calendarMasterObject.endDate=b.start._d)):(a.calendarMasterObject.startDate=new Date,a.calendarMasterObject.endDate=new Date);var e="",f="";if(b)if("month"==b.type){var h=b.title.indexOf(" ");e=b.title.substring(0,h),f=b.title.substring(h+1)}else{var i=new Date;e=g("date")(c.dateFormatter(i),"MMMM"),f=g("date")(c.dateFormatter(i),"yyyy")}else{var i=new Date;e=g("date")(c.dateFormatter(i),"MMMM"),f=g("date")(c.dateFormatter(i),"yyyy")}a.calendarMasterObject.entityId=a.calendarObjectData.entityId,a.calendarMasterObject.entityType=a.calendarObjectData.entityType,q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek",c.getCalendarData(a.calendarMasterObject,d.type,function(d){function h(b,d){var e=g("date")(c.dateFormatter(Date.parse(b+" 1,"+d)),"yyyy-MM-dd");e=new Date(e);for(var f=e.getMonth();e.getMonth()===f;){var h=g("date")(c.dateFormatter(new Date(e)),"yyyy-MM-dd");g("date")(c.dateFormatter(h),"dd");angular.isUndefined(a.holidayArray)||null==a.holidayArray||a.holidayArray.indexOf(h)!=-1&&$('*[data-date="'+h+'"].fc-day-number').addClass("holidayText"),angular.isUndefined(a.nonWorkingArray)||null==a.nonWorkingArray||a.nonWorkingArray.indexOf(h)!=-1&&$('td[data-date="'+h+'"]').css("background-color","#ececec"),e.setDate(e.getDate()+1)}}a.calendarMasterId=d.id,d.events.length>0&&(a.scrollTime=d.events[0].eventStartTime),a.calendarMaster=d,a.showObject={},a.showObject.entityTypeCode=d.entityType.code,a.showObject.entityType=d.entityType.value,a.showObject.entityName=d.entityName,a.showObject.calendarName=d.name,a.showObject.calendarOrg=d.organizationLocationName,d.slotSize&&(a.slotTime=d.slotSize),a.holidayArray=d.holidays,a.nonWorkingArray=d.nonWorkingDays,a.newEvents=[];h(e,f),angular.forEach(o.objIterator(a.calendarMaster.events),function(c,d){angular.forEach(c.dates,function(d,e){var f={};f.id=c.id,f.eventType=c.eventType,f.calendarId=c.calendarId,f.eventDate=c.eventDate;var h=new Date;h.setHours(c.eventStartTime.substring(0,2)),h.setMinutes(c.eventStartTime.substring(3,5));var i=new Date;i.setHours(c.eventEndTime.substring(0,2)),i.setMinutes(c.eventEndTime.substring(3,5));g("date")(h,"hh:mm a"),g("date")(i,"hh:mm a");f.start=d+" "+c.eventStartTime,f.end=d+" "+c.eventEndTime,b&&(f.viewType=b.type),f.exception=c.exception,f.eventStartTime=c.eventStartTime,f.eventEndTime=c.eventEndTime,f.eventException=c.eventException,f.eventSlots=c.eventSlots,f.eventId=c.id,f.appointmentType=c.appointmentType,f.slotSize=c.slotSize,f.offDay=c.offDay,f.eventName=c.title,f.entityType=a.calendarMaster.entityType,f.entityName=a.calendarMaster.entityName,f.entityId=a.calendarMaster.entityId,f.slotId=c.slotId,c.capacity&&(f.capacity=c.capacity),a.newEvents.push(f)})}),a.calendarMaster.events=a.newEvents,angular.forEach(a.calendarMaster.businessHours,function(b,c){angular.forEach(b.timeSlots,function(c,d){c.start=b.date+" "+c.start,c.end=b.date+" "+c.end,c.rendering="background",c.eventBackgroundColor="rgb(255,0,0)",a.calendarMaster.events.push(c)})}),a.uiConfig={calendar:{height:500,editable:!1,contentHeight:500,slotDuration:"00:"+a.slotTime+":00",customButtons:{myButton:{text:"Day Availability",click:a.showAvailability}},header:{left:"prev,next today",center:"title",right:"myCustomButton,month,agendaWeek,agendaDay"},axisFormat:"hh:mm A",buttonText:{today:"Today",month:"Month",week:"Week",day:"Day"},scrollTime:"09:00:00",events:a.events,fixedWeekCount:!1,defaultView:a.defaultView,businessHours:{},eventLimit:!0,views:{agenda:{eventLimit:1}},displayEventTime:!0,viewRender:a.viewRender,eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,eventRender:a.eventRender,dayClick:a.dayClick,eventClick:a.eventClick,slotEventOverlap:a.slotEventOverlap,dayRender:a.dayRender,eventAfterAllRender:a.eventAfterAllRender,viewDestroy:a.viewDestroy}},a.setCalendarData(f,e),r.showSpinner=!1},function(a){r.showSpinner=!1}),0==a.loggedInUser.isOrganizationUserMode&&$(".fc-myCustomButton-button").hide()},a.showAvailability=function(){i.show({controller:"ShowCalendarAvailabilityCtrl",templateUrl:"app/modules/fullCalendar/views/working-day.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{calendarMasterId:a.calendarMasterObject.calendarId,entityId:a.calendarMasterObject.entityId,calendarRequestData:a.calendarObjectData,parentScope:a}}).then(function(){a.WSHealthProfessionalsValues={}},function(c){a.WSHealthProfessionalsValues={},c&&b.reload()})},a.init=function(){if(a.searchCriteria.entityName={},q.isNullOrEmpty(d.data)||localStorage.setItem("cmi",angular.toJson(d.data)),1==d.samePageCall){if(localStorage.getItem("viewCalendarFilterValues")){var b=angular.fromJson(localStorage.getItem("viewCalendarFilterValues"));a.searchCriteria.orgLocation=b.orgLocation,a.searchCriteria.entityType=b.entityType,a.searchCriteria.entityName=b.entityName}}else q.isNullOrEmpty(d.samePageCall)||(d.data=angular.fromJson(localStorage.getItem("cmi")));a.loggedInUser=p.getLoggedInUser(),d.data?(localStorage.setItem("cmi",angular.toJson(d.data)),a.calendarObjectData=d.data,d.data.slotId&&(a.isPostpond=!0)):(a.trialCalendarObjectData=localStorage.getItem("cmi"),a.calendarObjectData=angular.fromJson(a.trialCalendarObjectData),d.data=angular.copy(a.calendarObjectData)),d.data&&!localStorage.getItem("viewCalendarFilterValues")&&(q.isFieldEmpty(d.data.organizationLocation)?q.isFieldEmpty(d.data.orgLocation)||(a.searchCriteria.orgLocation=d.data.orgLocation.id):a.searchCriteria.orgLocation=d.data.organizationLocation,q.isFieldEmpty(d.data.entityType)||(a.searchCriteria.entityType=d.data.entityType),q.isFieldEmpty(d.data.entityId)||(a.searchCriteria.entityName.id=d.data.entityId,a.searchCriteria.entityName.value=d.data.entityName)),a.getCalendarData()},a.createEvent=function(){b.go("manageEventCalendar",{type:"add",calendarData:a.calendarMaster})},a.init(),a.changeTo="Hungarian",/* event source that pulls from google.com */
a.eventSource={className:"gcal-event",// an option!
currentTimezone:"America/Chicago"},a.customFullscreen=j("xs")||j("sm"),a.dayClick=function(a,b,c){},a.businessHours=function(){},a.eventClick=function(e,f){if(1==e.exception){(j("sm")||j("xs"))&&a.customFullscreen;i.show({controller:u,templateUrl:"app/modules/fullCalendar/views/exception-approval.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{calendarDayEventId:e.id,calendarRequestData:a.calendarMasterObject,eventDate:e.eventDate,eventException:e.eventException}}).then(function(a){},function(){a.WSHealthProfessionalsValues={}})}else if(d.data&&!a.isPostpond){if(1==a.menuVisible)$(".event-menu-list").remove(),a.menuVisible=!1;else if(444==f.target.id){if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){var h=(Math.floor(501*Math.random()),$("body").width()),k=$(".calendarRow").width(),m=$("body").height(),n=$(".calendarRow").height(),o=(h-k)/2,q=(m-n)/2,r=f.clientX-o+25,s=f.clientY-q-40,t=null;e.eventSlots&&(t=e.eventSlots[0].slotDate);var w="<div class='event-menu-list'><ul><li><div class='calendar-event-menu-title-style'>"+e.eventName+"</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+t+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='editEventMenu'> Edit event</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+t+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='eventExceptionMenu'> Define Event Exceptions</div></li><li><div data-eventId='"+e.eventId+"' data-eventDate='"+t+"' data-entityName='"+e.entityName+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='fixAppointmentMenu'> Fix appointment</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+t+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='cancelAppointmentMenu'> Cancel Appointment</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+t+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='postpondAppointmentMenu' > Postpone Appointment</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+t+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='listAppointmentMenu'> List Appointments</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+t+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='registerWalkinMenu'> Register walk-in</div></li>",x=g("date")(t,"yyyy-MM-dd"),y=g("date")(new Date,"yyyy-MM-dd");1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode&&x==y&&(w=w+"<li><div data-eventId='"+e.eventId+"' data-eventDate='"+t+"' class='calendar-event-menu-style' id='showStatusMenu'> Show Status</div></li>"),w+="</ul></div>",$newdiv=$(w).css({left:r+"px",top:s+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0}}else if("FCFS"!=f.target.dataset.appointmenttype){var h=(Math.floor(501*Math.random()),$("body").width()),k=$(".calendarRow").width(),m=$("body").height(),n=$(".calendarRow").height(),o=(h-k)/2,q=(m-n)/2,r=f.clientX-o+25,s=f.clientY-q+60,z="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode)if("null"!=f.target.dataset.appointmentid){var y=v(new Date);/* cancel appointment menu */
z=z+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'> Cancel Appointment</div></li>",/* postpont appointment menu*/
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'> Postpone Appointment</div></li>",f.target.dataset.appointmentdate==y&&"CAL_PROCESS"!=e.entityType.code&&(/*Show status menu*/
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'> Show Status</div></li>","CAL_EVENT_ONLINE"==e.eventType.code&&angular.fromJson(p.getLoggedInUser()).id==f.target.dataset.appointmentuserid&&(/* Check in menu */
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkInRMenu'> Check-in</div></li>"),/* Checkout Menu */
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkOutRMenu'> Check-out</div></li>")}else z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'> Fix appointment</div></li>";else if("null"!=f.target.dataset.appointmentid){if("null"!=f.target.dataset.appointmentuserid&&f.target.dataset.appointmentuserid==angular.fromJson(p.getLoggedInUser()).id){var y=v(new Date);/* cancel appointment menu */
z=z+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'> Cancel Appointment</div></li>",/* postpont appointment menu*/
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'> Postpone Appointment</div></li>",f.target.dataset.appointmentdate==y&&"CAL_PROCESS"!=e.entityType.code&&(/*Show status menu*/
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'> Show Status</div></li>",/* Check in menu */
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkInRMenu'> Check-in</div></li>",/* Checkout Menu */
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkOutRMenu'> Check-out</div></li>")}}else z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'> Fix appointment</div></li>";z+="</ul></div>",$newdiv=$(z).css({left:r+"px",top:s+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0}}else{var h=(Math.floor(501*Math.random()),$("body").width()),k=$(".calendarRow").width(),m=$("body").height(),n=$(".calendarRow").height(),o=(h-k)/2,q=(m-n)/2,r=f.clientX-o+25,s=f.clientY-q-40,z="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){if(a.oldAppointmentId){var A={};A.apptDate=e.eventSlots[0].slotDate,f.target.dataset.slotid?A.slotId=f.target.dataset.slotid:A.slotId=f.target.firstElementChild.dataset.slotid,A.oldAppointmentId=a.oldAppointmentId,A.eventId=e.eventId,c.postpondRegularAppointment(A,function(a){l("success",a.successMessage)},function(a){})}else if("null"!=f.target.dataset.appointmentid)if("null"==f.target.dataset.appointmentuserid||f.target.dataset.appointmentuserid!=angular.fromJson(p.getLoggedInUser()).id&&1!=angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode)z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'> Fix appointment</div></li>";else{var y=v(new Date);/* cancel appointment menu */
z=z+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'> Cancel Appointment</div></li>",/* postpont appointment menu*/
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'> Postpone Appointment</div></li>",f.target.dataset.appointmentdate==y&&"CAL_PROCESS"!=e.entityType.code&&(/*Show status menu*/
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'> Show Status</div></li>",/* Check in menu */
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkInRMenu'> Check-in</div></li>",/* Checkout Menu */
z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='checkOutRMenu'> Check-out</div></li>")}else z=z+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'> Fix appointment</div></li>";z+="</ul></div>",$newdiv=$(z).css({left:r+"px",top:s+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0}else{var A={};A.apptDate=e.eventSlots[0].slotDate,f.target.dataset.slotid?A.slotId=f.target.dataset.slotid:A.slotId=f.target.firstElementChild.dataset.slotid,A.oldAppointmentId=d.data.appointmentId,A.eventId=e.eventId,c.postpondRegularAppointment(A,function(a){l("success",a.successMessage),b.reload()},function(a){})}}},a.slotEventOverlap=function(){return a.calendarObject.slotEventOverlap},/* add and removes an event source of choice */
a.addRemoveEventSource=function(a,b){var c=0;angular.forEach(a,function(d,e){a[e]===b&&(a.splice(e,1),c=1)}),0===c&&a.push(b)},/* Change View */
a.changeView=function(a,b){h.calendars[b].fullCalendar("changeView",a)},/* Change View */
a.renderCalender=function(a){f(function(){h.calendars[a]})},$(".container").click(function(d,e){if(d){if(444!=d.target.id&&1111!=d.target.id)if("fixAppointmentMenu"==d.target.id)b.go("manageFixAppointment",{type:"add",eventName:{id:d.target.dataset.eventid,value:d.target.dataset.eventname},apptDate:d.target.dataset.eventdate});else if("editEventMenu"==d.target.id)d.target.dataset.eventid&&b.go("manageEventCalendar",{type:"edit",eventId:d.target.dataset.eventid});else if("cancelAppointmentMenu"==d.target.id)b.go("cancelAppointmentList",{type:"cancel"});else if("postpondAppointmentMenu"==d.target.id)b.go("postponeAppointmentList",{type:"postpone"});else if("listAppointmentMenu"==d.target.id)b.go("appointmentsList",{event:{id:d.target.dataset.eventid,value:d.target.dataset.eventname},apptDate:d.target.dataset.eventdate,entityName:d.target.dataset.entityname});else if("showStatusMenu"==d.target.id)d.target.dataset.eventid&&d.target.dataset.eventdate&&b.go("userAppointmentStatus",{eventId:d.target.dataset.eventid,eventDate:d.target.dataset.eventdate});else if("registerWalkinMenu"==d.target.id);else if("checkInMenu"==d.target.id);else if("checkOutMenu"==d.target.id);else if("eventExceptionMenu"==d.target.id)d.target.dataset.eventid&&b.go("manageEventCalendarException",{type:"add",eventId:d.target.dataset.eventid});else if("cancelAppointmentRMenu"==d.target.id){if(d.target.dataset.appointmentid&&"null"!=d.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")){var f={};if(a.oldAppointmentId=null,f.apptDate=d.target.dataset.appointmentdate,$(".event-menu-list").remove(),a.menuVisible=!1,"true"!=localStorage.getItem("isPopupOpen")){localStorage.setItem("isPopupOpen","true");var g=i.confirm().title(m.instant("APPOINTMENT_CANCELATION_TITLE")).textContent(m.instant("APPOINTMENT_CANCELATION_MSG")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(g).then(function(){localStorage.setItem("isPopupOpen","false"),f.appointmentIds=[d.target.dataset.appointmentid],d.target.dataset.appointmentid=null,c.cancelAppointment(f,function(a){l("success",a.successMessage),b.reload()},function(a){})},function(){localStorage.setItem("isPopupOpen","false")})}}}else if("postpondAppointmentRMenu"==d.target.id)"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),a.oldAppointmentId=null,a.isPostpond=!0,$(".event-menu-list").remove(),a.menuVisible=!1,localStorage.setItem("isPopupOpen","false"),l("info",m.instant("SELECT_SLOT_TO_POSTPONT")),a.oldAppointmentId=d.target.dataset.appointmentid);else if("showStatusRMenu"==d.target.id)d.target.dataset.appointmentid&&b.go("userAppointmentStatus",{appoinmentId:d.target.dataset.appointmentid});else if("checkInRMenu"==d.target.id){if(d.target.dataset.appointmentid&&"Online Appointment"==d.target.dataset.eventtypename){var h={};h.relatedtoCalendarEvent=d.target.dataset.eventid,h.appointmentId=d.target.dataset.appointmentid,c.getConversationIdForAppointment(h,function(a){b.go("skypeHome",{userId:angular.fromJson(p.getLoggedInUser()).id,convId:a.responce,convType:"APPOINTMENT"})},function(a){})}}else"checkOutRMenu"==d.target.id?d.target.dataset.appointmentid&&b.go("manageAppointmentCheckOut",{appointmentId:d.target.dataset.appointmentid,entityType:{id:d.target.dataset.entitytypeid,value:d.target.dataset.entitytypename,code:d.target.dataset.entitytypecode},entityName:{id:d.target.dataset.entityid,value:d.target.dataset.entityname},eventType:{id:d.target.dataset.eventtypeid,value:d.target.dataset.eventtypename},eventName:{id:d.target.dataset.eventid,value:d.target.dataset.eventname},apptDate:d.target.dataset.appointmentdate,apptStartTime:d.target.dataset.appointmenttime,apptEndTime:d.target.dataset.appointmentendtime}):"fixAppointmentRMenu"==d.target.id?d.target.dataset.appointmentid&&b.go("manageFixAppointment",{type:"add",appointmentId:d.target.dataset.appointmentid,slotId:d.target.dataset.slotid,entityType:{id:d.target.dataset.entitytypeid,value:d.target.dataset.entitytypename,code:d.target.dataset.entitytypecode},entityName:{id:d.target.dataset.entityid,value:d.target.dataset.entityname},eventType:{id:d.target.dataset.eventtypeid,value:d.target.dataset.eventtypename},eventName:{id:d.target.dataset.eventid,value:d.target.dataset.eventname},apptDate:d.target.dataset.appointmentdate,apptStartTime:d.target.dataset.appointmenttime,apptEndTime:d.target.dataset.appointmentendtime}):($(".event-menu-list").remove(),a.menuVisible=!1)}else 1==a.menuVisible&&($(".event-menu-list").remove(),a.menuVisible=!1)}),a.viewRender=function(b,c){b&&a.getCalendarData(b)},a.setCalendarData=function(b,c){var d=new Date;d.setYear(b),d.setMonth(c),h.calendars.myCalendar.fullCalendar("removeEvents"),angular.forEach(a.calendarMaster.events,function(a,b){h.calendars.myCalendar.fullCalendar("renderEvent",a)})},a.filterEvent=function(){h.calendars.myCalendar.fullCalendar("rerenderEvents")},/* Render Tooltip */
a.eventRender=function(b,d,e){c.setEventStyle(d,b,a.slotTime)},a.eventAfterAllRender=function(a){$(".fc-content .fc-time").hide()},/* config object */
a.events=a.calendarMaster.events,/* event sources array*/
a.eventSources=[a.eventSource],a.CalendarPopUpValues={},/* filter code start */
a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.entityType={queryUrl:"GET_ENTITY_TYPES_EXCEPT_ORG_LOC",queryParameter:{}},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.getCalendarName=function(){var b={};q.isNullOrEmpty(a.searchCriteria.entityType)||(b.entityTypeId=a.searchCriteria.entityType.id),q.isNullOrEmpty(a.searchCriteria.orgLocation)||(b.organizationLocationId=a.searchCriteria.orgLocation.id),q.isNullOrEmpty(a.searchCriteria.entityName)||(b.entityId=a.searchCriteria.entityName.id),s.postData(t.getUrl("CALENDAR_SMART_SEARCH"),b,function(b){b&&b.data&&(a.calendarNames=b.data)},function(a){errorCallback(a)})},a.$watch("searchCriteria.orgLocation",function(b,c){b&&b.id?(a.locationID=b.id,f(function(){a.getCalendarName()},0)):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.isEquipment=!1,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:a.searchCriteria.orgLocation.id}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.isProcess=!1,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:a.searchCriteria.orgLocation.data.id}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}}),f(function(){a.getCalendarName()},0)):(a.searchCriteria.entityName=null,a.searchCriteria.calendarObj=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.entityName",function(b,c){b&&b.id?a.entityNameID=b.id:a.searchCriteria.calendarObj=null;f(function(){a.getCalendarName()},0)}),a.filterCalendar=function(){if(!q.isFieldEmpty(a.searchCriteria.orgLocation)){r.showSpinner=!0;var d={calendarId:a.searchCriteria.calendarObj.id,entityTypeCode:a.searchCriteria.entityType.code,entityId:a.searchCriteria.entityName.id};c.getCalendarDetailsById(d,function(c){if(r.showSpinner=!1,c)if(localStorage.setItem("cmi",angular.toJson(c)),q.isNullOrEmpty(a.searchCriteria)||localStorage.setItem("viewCalendarFilterValues",angular.toJson(a.searchCriteria)),"CAL_ORGANIZATION_USER"==a.searchCriteria.entityType.code){var d={inherit:!1};b.go(".",{data:c,samePageCall:!0},d)}else"CAL_PROCESS"==a.searchCriteria.entityType.code?b.go("processcalendarview",{type:"regular",data:c}):"CAL_EQUIPMENT"==a.searchCriteria.entityType.code&&b.go("equipmentcalendarview",{type:"regular",data:c})},function(a){r.showSpinner=!1})}},a.clear=function(){a.searchCriteria={}}}]),angular.module("paripal.appointmentModule").controller("ManageCalendarEventCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","featurePrivilegeConstants","serverSidePagination","dateconvertor","manageCalendarEventService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.WSCalendarEvent={},a.calendarEvent={},a.disabledFormFields=!1,b.showSpinner=!1,a.isRoundRobinHide=!0,a.isAppointmentTypeHide=!1,a.isCapacityRequired=!1,a.isAutoRefundRequired=!1,a.isAutoRefundDisabled=!0,a.isSlotBased=!1,a.isRepeatChecked=!1,a.isWeekEnabled=!1,a.isFcfsDisabled=!1,a.isSlotDisabled=!1,a.isAdhocDisabled=!1,a.isRecordSaved=!1,a.showExceptionButton=!1,a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.entityType={queryUrl:"GET_ENTITY_TYPES_WITHOUT_LOCATION",queryParameter:{}},/*$scope.eventType = {
            queryUrl: "GET_EVENT_TYPE_BY_ORG_LOC",
            queryParameter: {}
        };*/
a.repeatFrequency={queryUrl:"EVENT_REPEAT_FREQUECY",queryParameter:{}},/*$scope.$watch('WSCalendarEvent.entityType', function (newValue, oldValue) {
            if(newValue && newValue.code){

            }else{
                $scope.searchCriteria.entityName = {};
                $scope.isEquipment = true;
                $scope.isOrgUser = false;
                $scope.isProcess = false;
                $scope.isEntityNameDisabled = true;
            }
        });*/
a.$watch("WSCalendarEvent.entityType",function(b,c){b&&b.code?("CAL_ORGANIZATION_USER"==b.code?a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES",queryParameter:{locationId:a.WSCalendarEvent.orgLocation.id,userId:a.WSCalendarEvent.entityName.id}}:"CAL_EQUIPMENT"==b.code?a.eventType={queryUrl:"GET_AVAILABLE_ENTITY_TYPES_FOR_EQUIPMENT",queryParameter:{entityType:"CAL_EQUIPMENT",equipmentId:a.WSCalendarEvent.entityName.id}}:a.eventType={queryUrl:"GET_EVENT_TYPE_BY_ENTITY_TYPE_ID",queryParameter:{entityType:b.code}},a.$broadcast("loadWSCalendarEventEventType",a.eventType),a.WSCalendarEvent.isRoundRobin=!1,"view"!=a.pageState&&"edit"!=a.pageState&&(a.WSCalendarEvent.capacity=null,a.WSCalendarEvent.roomName=null),"CAL_PROCESS"===b.code?(a.isCapacityRequired=!0,a.isRoundRobinHide=!1,a.WSCalendarEvent.slotSize=null,a.WSCalendarEvent.appointmentType=null,a.isAppointmentTypeHide=!0):(a.isRoundRobinHide=!0,a.isAppointmentTypeHide=!1),"view"!=a.pageState&&(a.isEquipment=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isCapacityRequired=!0,a.isProcess=!0,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:a.WSCalendarEvent.orgLocation.id}},a.$broadcast("loadWSCalendarEventEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{orgLocationId:a.WSCalendarEvent.orgLocation.id}},a.$broadcast("loadWSCalendarEventEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,/*$scope.entityName = {
                            queryUrl: "FIND_USER_BY_LOGGED_IN_USER",
                            queryParameter: {}
                        };*/
a.entityName={queryUrl:"GET_DOCTORS_FOR_SEARCH_CALENDAR",queryParameter:{orgLocId:a.WSCalendarEvent.orgLocation.id}}))):(a.isRoundRobinHide=!0,a.isAppointmentTypeHide=!1,a.WSCalendarEvent.entityName={},a.isEquipment=!0,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("WSCalendarEvent.appointmentType",function(b,c){b&&"SLOT_BASED"===b?a.isSlotBased=!0:(a.WSCalendarEvent.slotSize=null,a.isSlotBased=!1)}),a.$watch("WSCalendarEvent.isRoundRobin",function(b,c){b&&(a.isCapacityRequired=!0)}),a.$watch("WSCalendarEvent.isAutoRefund",function(b,c){b?(a.isAutoRefundRequired=!0,a.isAutoRefundDisabled=!1):(a.isAutoRefundRequired=!1,a.isAutoRefundDisabled=!0)}),a.$watch("WSCalendarEvent.isRepeat",function(b,c){b?a.isRepeatChecked=!0:(a.WSCalendarEvent.repeatFrequency=null,a.setDefaultWeeklyDays(),a.isRepeatChecked=!1)}),a.$watch("WSCalendarEvent.repeatFrequency",function(b,c){b&&"WEEKLY"===b.id?a.isWeekEnabled=!0:(a.setDefaultWeeklyDays(),a.isWeekEnabled=!1)}),a.setDefaultWeeklyDays=function(){a.WSCalendarEvent.isMondayRepeat=!1,a.WSCalendarEvent.isTuesdayRepeat=!1,a.WSCalendarEvent.isWednesdayRepeat=!1,a.WSCalendarEvent.isThursdayRepeat=!1,a.WSCalendarEvent.isFridayRepeat=!1,a.WSCalendarEvent.isSaturdayRepeat=!1,a.WSCalendarEvent.isSundayRepeat=!1},/*$scope.enableDisableAppointmentType = function(){
            if(($scope.entityType.code === 'CAL_ORGANIZATION_USER' && ($scope.eventType.code === 'IN_CLINIC' || $scope.eventType.code === 'ONLINE'))
                    || ($scope.entityType.code === 'CAL_EQUIPMENT' && $scope.eventType.code === 'IN_CLINIC')){

                $scope.isFcfsDisabled = false;
                $scope.isSlotDisabled = false;
                $scope.isAdhocDisabled = false;
            }else if($scope.entityType.code === 'CAL_ORGANIZATION_USER' && $scope.eventType.code === 'HOME_VISIT'){

                $scope.isFcfsDisabled = true;
                $scope.isSlotDisabled = false;
                $scope.isAdhocDisabled = false;
            }else if($scope.entityType.code === 'CAL_PROCESS' && $scope.eventType.code === 'IN_CLINIC'){

                $scope.isFcfsDisabled = true;
                $scope.isSlotDisabled = true;
                $scope.isAdhocDisabled = true;
            }else if($scope.entityType.code === 'CAL_EQUIPMENT' && $scope.eventType.code === 'HOME_VISIT'){

                $scope.isFcfsDisabled = true;
                $scope.isSlotDisabled = false;
                $scope.isAdhocDisabled = false;
            }

        };

        $scope.hideShowRoundRobin = function(){
            if($scope.entityType.code === 'CAL_PROCESS' && $scope.eventType.code === 'IN_CLINIC'){
                $scope.isRoundRobinDisabled = true;
            }else{
                $scope.isRoundRobinDisabled = false;
            }
        }*/
a.saveCalendarEvent=function(d){if(d.$valid){var e=!0;a.isWeekEnabled&&(a.WSCalendarEvent.isMondayRepeat||a.WSCalendarEvent.isTuesdayRepeat||a.WSCalendarEvent.isWednesdayRepeat||a.WSCalendarEvent.isThursdayRepeat||a.WSCalendarEvent.isFridayRepeat||a.WSCalendarEvent.isSaturdayRepeat||a.WSCalendarEvent.isSundayRepeat||(e=!1,g("error",h.instant("SELECT_DAY_CHOICE")))),e&&(b.showSpinner=!0,r.saveCalendarEvent(a.WSCalendarEvent,c.type,function(d){b.showSpinner=!1,"add"===c.type?(g("success",h.instant(d.code)),a.isRecordSaved=!0,c.type="view",a.pageState="edit",a.disabledFormFields=!0,a.showExceptionButton=!0):(a.isRecordSaved=!0,g("success",h.instant(d.code)),a.disabledFormFields=!0,a.showExceptionButton=!0),
//$state.go("calendarList", $stateParams);
a.getCalendarEventDetails(d.id)},function(a){b.showSpinner=!1,a.data&&a.data.messages&&a.data.messages.length>0?g("error",h.instant(a.data.messages[0])):g("error",h.instant("FAILED_TO_SAVE_RECORD"))}))}},a.getCalendarEventDetails=function(c,d){m.isNullOrEmpty(c)||(b.showSpinner=!0,r.getCalendarEventDetails(c,function(c){b.showSpinner=!1,a.setDataToEventForm(c)}))},a.validateEditView=function(){if("edit"==a.pageState){var b=new Date(a.WSCalendarEvent.eventStartDate),c=new Date(a.WSCalendarEvent.eventEndDate);a.WSCalendarEvent.eventEndDate=i("date")(a.WSCalendarEvent.eventEndDate,"MM/dd/yyyy"),b.getDate()==c.getDate()&&b.getMonth()==c.getMonth()&&b.getFullYear()==c.getFullYear()?(a.WSCalendarEvent.isRepeat=null,a.WSCalendarEvent.repeatFrequency=null,a.WSCalendarEvent.isMondayRepeat=null,a.WSCalendarEvent.isTuesdayRepeat=null,a.WSCalendarEvent.isWednesdayRepeat=null,a.WSCalendarEvent.isThursdayRepeat=null,a.WSCalendarEvent.isFridayRepeat=null,a.WSCalendarEvent.isSaturdayRepeat=null,a.WSCalendarEvent.isSundayRepeat=null,a.isEnabled=!1):a.isEnabled=!0}},a.setDataToEventForm=function(b){m.isEmpty(b)||(
//$scope.WSCalendarEvent = angular.copy(responseData);
b.id&&(a.WSCalendarEvent.id=b.id),b.version&&(a.WSCalendarEvent.version=b.version),b.entityTypeDetails&&b.entityTypeDetails.id&&(a.WSCalendarEvent.entityType=b.entityTypeDetails),b.entityId&&b.entityName&&(a.WSCalendarEvent.entityName={id:b.entityId,value:b.entityName}),b.organizationLocationId&&b.organizationLocationName&&(a.WSCalendarEvent.orgLocation={id:b.organizationLocationId,value:b.organizationLocationName}),b.eventName&&(a.WSCalendarEvent.eventName=b.eventName),b.appointmentType&&(a.WSCalendarEvent.appointmentType=b.appointmentType),b.slotSize&&(a.WSCalendarEvent.slotSize=b.slotSize),b.roomName&&(a.WSCalendarEvent.roomName=b.roomName),b.eventStartDate&&(a.WSCalendarEvent.eventStartDate=i("timestampToDate")(b.eventStartDate,"MM/dd/yyyy")),new Date(a.WSCalendarEvent.eventStartDate)<=new Date?a.disableStartDate=!0:a.disableStartDate=!1,b.eventEndDate&&(a.WSCalendarEvent.eventEndDate=i("timestampToDate")(b.eventEndDate,"MM/dd/yyyy")),b.eventStartTime&&(a.WSCalendarEvent.eventStartTime=new Date(a.WSCalendarEvent.eventStartDate+" "+b.eventStartTime)),b.eventEndTime&&(a.WSCalendarEvent.eventEndTime=new Date(a.WSCalendarEvent.eventStartDate+" "+b.eventEndTime)),b.isException?a.WSCalendarEvent.isException=b.isException:a.WSCalendarEvent.isException=!1,b.isRepeat?a.WSCalendarEvent.isRepeat=b.isRepeat:a.WSCalendarEvent.isRepeat=!1,b.repeatFrequency&&(a.WSCalendarEvent.repeatFrequency={id:b.repeatFrequency,value:h.instant(b.repeatFrequency)}),b.isMondayRepeat?a.WSCalendarEvent.isMondayRepeat=b.isMondayRepeat:a.WSCalendarEvent.isMondayRepeat=!1,b.isTuesdayRepeat?a.WSCalendarEvent.isTuesdayRepeat=b.isTuesdayRepeat:a.WSCalendarEvent.isTuesdayRepeat=!1,b.isWednesdayRepeat?a.WSCalendarEvent.isWednesdayRepeat=b.isWednesdayRepeat:a.WSCalendarEvent.isWednesdayRepeat=!1,b.isThursdayRepeat?a.WSCalendarEvent.isThursdayRepeat=b.isThursdayRepeat:a.WSCalendarEvent.isThursdayRepeat=!1,b.isFridayRepeat?a.WSCalendarEvent.isFridayRepeat=b.isFridayRepeat:a.WSCalendarEvent.isFridayRepeat=!1,b.isSaturdayRepeat?a.WSCalendarEvent.isSaturdayRepeat=b.isSaturdayRepeat:a.WSCalendarEvent.isSaturdayRepeat=!1,b.isSundayRepeat?a.WSCalendarEvent.isSundayRepeat=b.isSundayRepeat:a.WSCalendarEvent.isSundayRepeat=!1,b.isRoundRobin?a.WSCalendarEvent.isRoundRobin=b.isRoundRobin:a.WSCalendarEvent.isRoundRobin=!1,/*if (responseData.isAutoRefund) {
                    $scope.WSCalendarEvent.isAutoRefund = responseData.isAutoRefund;
                }else{
                    $scope.WSCalendarEvent.isAutoRefund = false;
                }*/
b.paymentToBeTaken&&(a.WSCalendarEvent.paymentToBeTaken=b.paymentToBeTaken),b.capacity&&(a.WSCalendarEvent.capacity=b.capacity),b.advanceBookingDaysLimit&&(a.WSCalendarEvent.advanceBookingDaysLimit=b.advanceBookingDaysLimit),b.autoRefundTimeLimit&&(a.WSCalendarEvent.autoRefundTimeLimit=b.autoRefundTimeLimit),b.eventType&&b.eventType.id&&(a.WSCalendarEvent.eventType=b.eventType),/*$scope.WSCalendarEvent.calendarMaster = {
                    "id": 1,
                    "value": "Calendar 1"
                };*/
/*$scope.WSCalendarEvent.entityName = {
                    "id": 1,
                    "value": "paripal_user"
                };*/
/*$scope.WSCalendarEvent.entity = {
                    "id": 1,
                    "value": "paripal_user"
                };
*/
a.calendarEvent=angular.copy(b))},
// on cancel forward to search list
a.cancel=function(){c.calendarState&&c.callingPage?d.go(c.callingPage,{data:c.calendarState.data}):m.goBackToPrevState()},
//Init Method
a.init=function(){localStorage.getItem("cmi")&&(a.calendarData=angular.fromJson(localStorage.getItem("cmi")),a.WSCalendarEvent.calendarMaster={id:a.calendarData.id,value:a.calendarData.name},a.WSCalendarEvent.entityName={id:a.calendarData.entityId,value:a.calendarData.entityName},a.WSCalendarEvent.orgLocation={id:a.calendarData.organizationLocationId,value:a.calendarData.organizationLocationName},a.WSCalendarEvent.entityType={id:a.calendarData.entityType.id,code:a.calendarData.entityType.code,value:a.calendarData.entityType.value},"add"===c.type&&k.postData(l.getUrl("FIND_CALENDARBYID"),angular.fromJson(localStorage.getItem("cmi")),function(b){a.WSCalendarEvent.entityName={id:b.data.entityId,value:b.data.entityName},a.WSCalendarEvent.orgLocation={id:b.data.organizationLocationId,value:b.data.organizationLocation.value}},function(a){})),
//$stateParams.type = 'add';
"add"===c.type?(a.WSCalendarEvent.appointmentType="FCFS",a.minDate=i("timestampToDate")(new Date,"MM/dd/yyyy"),a.WSCalendarEvent.dateMapped=i("timestampToDate")(new Date,"MM/dd/yyyy"),a.pageState="add"):"edit"===c.type?(a.today=new Date,c.eventId&&a.getCalendarEventDetails(c.eventId,c.type),a.disabledFormFields=!1,a.pageState="edit"):(c.eventId&&a.getCalendarEventDetails(c.eventId,c.type),a.disabledFormFields=!1,a.pageState="view",a.showExceptionButton=!0)},a.init(),
//Exception
a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSEventExceptionList=[],
//$scope.orgLocPermission = featurePrivilegeConstants.PROCESS_VIEW;
a.postHeader={},a.searchCalendarEventException=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0,a.searchCriteria.eventId=c.eventId,r.searchCalendarEventException(a.searchCriteria,a.postHeader,function(c){b.showSpinner=!1,a.WSEventExceptionList=c,a.totalItems=c.totalRecords,a.pagingInfo=p(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})},a.manageEventException=function(b,c){var e={type:c,eventId:a.calendarEvent.id,entityType:a.calendarEvent.entityType};b&&b.id&&(e.eventExceptionId=b.id),d.go("manageEventCalendarException",e)},a.clear=function(){a.searchCriteria={},a.searchCalendarEventException()},a.pageChanged=function(){a.pagingInfo=p(a.currentPage,a.itemPerPage,a.totalItems),a.searchCalendarEventException()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchCalendarEventException()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.searchCalendarEventException()}]),angular.module("paripal.appointmentModule").controller("ManageEventExceptionCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","featurePrivilegeConstants","dateconvertor","manageCalendarEventService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.WSEventException={},a.disabledFormFields=!1,b.showSpinner=!1,/*$scope.$watch('WSEventException.entityType', function (newValue, oldValue) {

        });*/
a.$watch("WSEventException.appointmentType",function(b,c){b&&"SLOT_BASED"===b?a.isSlotBased=!0:(a.WSEventException.slotSize=null,a.isSlotBased=!1)}),a.$watch("WSEventException.isRoundRobin",function(b,c){b?a.isCapacityRequired=!0:a.isCapacityRequired=!1}),a.saveCalendarEventException=function(d){d.$valid&&(b.showSpinner=!0,p.saveCalendarEventException(a.WSEventException,c.type,function(a){b.showSpinner=!1,f("success",g.instant("ADDED_SUCCESS")),l.goBackToPrevState()},function(a){b.showSpinner=!1,a.data&&a.data.messages&&a.data.messages.length>0?f("error",g.instant(a.data.messages[0])):f("error",g.instant("FAILED_TO_SAVE_RECORD"))}))},a.getCalendarEventException=function(c,d){l.isNullOrEmpty(c)||(b.showSpinner=!0,p.getCalendarEventException(c,function(c){b.showSpinner=!1,a.setDataToeventExceptionForm(c)}))},a.setDataToeventExceptionForm=function(b){l.isEmpty(b)||(
//$scope.WSEventException = angular.copy(responseData);
a.WSEventException.id=b.id,a.WSEventException.version=b.version,a.WSEventException.eventId=b.eventId,b.exceptionDate&&(a.WSEventException.exceptionDate=h("timestampToDate")(b.exceptionDate,"MM/dd/yyyy"),a.minDate=h("timestampToDate")(b.exceptionDate,"MM/dd/yyyy")),b.startTime&&(a.WSEventException.eventStartTime=new Date(a.WSEventException.exceptionDate+" "+b.startTime)),b.endTime&&(a.WSEventException.eventEndTime=new Date(a.WSEventException.exceptionDate+" "+b.endTime)),b.isCancelled?a.WSEventException.isCancelled=b.isCancelled:a.WSEventException.isCancelled=!1,b.appointmentType&&(a.WSEventException.appointmentType=b.appointmentType),/*else{
                                    $scope.WSEventException.appointmentType = false;
                                }*/
b.slotSize&&(a.WSEventException.slotSize=b.slotSize),b.isRoundRobin?a.WSEventException.isRoundRobin=b.isRoundRobin:a.WSEventException.isRoundRobin=!1,b.capacity&&(a.WSEventException.capacity=b.capacity),b.roomName&&(a.WSEventException.roomName=b.roomName))},a.setDataToEventForm=function(b){if(!l.isEmpty(b)){if(a.WSEventException.eventId=b.id,b.eventEndDate&&(a.maxDate=h("timestampToDate")(b.eventEndDate,"MM/dd/yyyy")),b.eventStartTime){var c=h("timestampToDate")(b.eventStartDate,"MM/dd/yyyy");a.WSEventException.eventStartTime=new Date(c+" "+b.eventStartTime)}if(b.eventEndTime){var c=h("timestampToDate")(b.eventEndDate,"MM/dd/yyyy");a.WSEventException.eventEndTime=new Date(c+" "+b.eventEndTime)}b.appointmentType&&(a.WSEventException.appointmentType=b.appointmentType),b.slotSize&&(a.WSEventException.slotSize=b.slotSize),b.isRoundRobin?a.WSEventException.isRoundRobin=b.isRoundRobin:a.WSEventException.isRoundRobin=!1,b.capacity&&(a.WSEventException.capacity=b.capacity),b.roomName&&(a.WSEventException.roomName=b.roomName)}},a.getCalendarEventDetails=function(c,d){l.isNullOrEmpty(c)||(b.showSpinner=!0,p.getCalendarEventDetails(c,function(c){b.showSpinner=!1,a.setDataToEventForm(c)}))},
// on cancel forward to search list
a.cancel=function(){c.calendarState&&c.callingPage?d.go(c.callingPage,{data:c.calendarState.data}):l.goBackToPrevState()},
//Init Method
a.init=function(){c.eventId&&(a.WSEventException.eventId=c.eventId),c.entityType&&(a.WSEventException.isRoundRobin=!1,a.WSEventException.capacity=null,a.WSEventException.roomName=null,"CAL_PROCESS"===c.entityType?(a.isRoundRobinHide=!1,a.isAppointmentTypeHide=!0,a.WSEventException.slotSize=null,a.WSEventException.appointmentType=null):(a.isRoundRobinHide=!0,a.isAppointmentTypeHide=!1)),"add"===c.type?(a.minDate=h("timestampToDate")(new Date,"MM/dd/yyyy"),a.disabledFormFields=!1,a.pageState="add",c.eventId&&a.getCalendarEventDetails(c.eventId)):"edit"===c.type?(a.disabledFormFields=!1,a.pageState="edit",a.getCalendarEventException(c.eventExceptionId,c.type)):"view"===c.type&&(a.disabledFormFields=!0,a.pageState="view",a.getCalendarEventException(c.eventExceptionId,c.type))},a.init()}]),//var calendarDemoApp = angular.module('fullCalendarModule', ['ui.calendar', 'ui.bootstrap','ngMaterial','ngMaterialDatePicker']);
angular.module("paripal.fullCalendarModule").controller("ProcessCalendarCtrl",["$scope","$state","commonCalendarService","$stateParams","$compile","$timeout","$filter","uiCalendarConfig","$mdDialog","$mdMedia","createEventService","notify","$translate","featurePrivilegeConstants","calendarObjIteratorService","baseService","utilService","$rootScope","storageService","calendarMenuService","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){
//
// Controller for create Event
//
function w(a,b,c,d,e,f){a.getUserNameData=function(b){a.requestData={},a.oldAppointmentId=null,sessionStorage.setItem("oldAppointmentId",null);return a.userNameAutoCmpLoading=!0,a.requestData.apptDate=f.target.dataset.appointmentdate,a.requestData.eventId=f.target.dataset.eventid,a.requestData.keyword=b,c.getData(d.getParameterizedUrl("GET_USERS_OF_APPOINTMENT",a.requestData),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.userNameSelected=function(b){a.oldAppointmentId=b.id,sessionStorage.setItem("oldAppointmentId",b.id)},a.selectUser=function(){var a={};a.oldAppointmentObj=sessionStorage.getItem("oldAppointmentId"),a.isCanceled=!0,b.hide(a)},a.cancel=function(){var a={};a.oldAppointmentObj=null,a.isCanceled=null,b.hide(a)}}function x(a,d,e,f,g,h){a.decision={},a.decisionObject={},a.addEventTrue=!0,a.twelveHrFormat=function(a){if(a>="12:00"){var b=a.replace(":","");return(b=1200)?(b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM")):(b-=1200,b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"))}return a+=" AM"},a.getExceptionDetails=function(){k.getExceptionDetails(f,e,g,h,function(b){a.exceptionDetails=b,a.exceptionDetails.startTime=a.exceptionDetails.startTime.substring(0,5),a.exceptionDetails.endTime=a.exceptionDetails.endTime.substring(0,5),angular.forEach(a.exceptionDetails.wsCalendarTimings,function(a,b){var c=new Date,d=new Date;c.setHours(a.startTime.substring(0,2)),c.setMinutes(a.startTime.substring(3,5)),a.startTime=c,d.setHours(a.endTime.substring(0,2)),d.setMinutes(a.endTime.substring(3,5)),a.endTime=d})},function(a){})},a.getExceptionDetails(),a.cancel=function(){d.cancel()},a.validateReason=function(){"Approve"==a.decision.status?a.isReasonRequired=!1:a.isReasonRequired=!0},a.exceptionDecision=function(){"Approve"==a.decision.status?a.decisionObject.status="ACCEPTED":a.decisionObject.status="REJECTED",a.decisionObject.calendarDayEventId=e,a.decisionObject.reason=a.decision.reason,a.decisionObject.organizationLocationId=f.organizationLocationId,a.decisionObject.id=e,a.decisionObject.eventException=h,c.saveExceptionDecision(a.decisionObject,function(a){d.cancel(),b.reload()},function(a){})}}/* function manageFixAppointment() {
            $state.go("manageFixAppointment", {
                type: "add"
            });
        } */
function y(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString(),e=c.split(""),f=d.split("");return b+"-"+(e[1]?c:"0"+e[0])+"-"+(f[1]?d:"0"+f[0])}x.$inject=["$scope","$mdDialog","calendarDayEventId","calendarRequestData","eventDate","eventException"],w.$inject=["$scope","$mdDialog","httpService","urlService","parentScope","eventData"],a.calendarMasterObject={},a.calendarMaster={},a.events=[],a.selectedEntityId=0,a.calendarMasterId=0,a.workingTimes=[{}],a.holidayArray=[],a.nonWorkingArray=[],a.calendarObjectData={},a.searchCriteria={},a.searchCriteria.orgLocation={},sessionStorage.setItem("isPostpond",!1),sessionStorage.setItem("oldAppointmentId",null),a.slotTime=15,q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek",a.menuVisible=!1,localStorage.setItem("isPopupOpen","false"),a.getCalendarData=function(b){a.calendarMasterObject.calendarId=a.calendarObjectData.id,a.calendarMasterObject.organizationLocationId=a.calendarObjectData.organizationLocationId,a.calendarMasterObject.entityId=a.calendarObjectData.entityId,b?(a.defaultRequestCall=!1,a.calendarMasterObject.startDate=b.start._d,a.calendarMasterObject.endDate=b.end._d,"agendaDay"==b.type&&(a.calendarMasterObject.endDate=b.start._d)):(a.defaultRequestCall=!0,a.calendarMasterObject.startDate=new Date,a.calendarMasterObject.endDate=new Date);var e="",f="";if(b)if("month"==b.type){var h=b.title.indexOf(" ");e=b.title.substring(0,h),f=b.title.substring(h+1)}else{var j=new Date;e=g("date")(c.dateFormatter(j),"MMMM"),f=g("date")(c.dateFormatter(j),"yyyy")}else{var j=new Date;e=g("date")(c.dateFormatter(j),"MMMM"),f=g("date")(c.dateFormatter(j),"yyyy")}a.calendarMasterObject.entityId=a.calendarObjectData.entityId,a.calendarMasterObject.entityType=a.calendarObjectData.entityType,"CAL_ORGANIZATION_USER"==a.calendarMasterObject.entityType.code&&(q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek"),r.showSpinner=!0,c.getCalendarData(a.calendarMasterObject,d.type,function(d){function h(b,d){var e=g("date")(c.dateFormatter(Date.parse(b+" 1,"+d)),"yyyy-MM-dd");e=new Date(e);
//                    = new Date(Date.parse(year, month, 1));
for(var f=e.getMonth();e.getMonth()===f;){var h=g("date")(c.dateFormatter(new Date(e)),"yyyy-MM-dd");g("date")(c.dateFormatter(h),"dd");angular.isUndefined(a.holidayArray)||null==a.holidayArray||a.holidayArray.indexOf(h)!=-1&&$('*[data-date="'+h+'"].fc-day-number').addClass("holidayText"),angular.isUndefined(a.nonWorkingArray)||null==a.nonWorkingArray||a.nonWorkingArray.indexOf(h)!=-1&&$('td[data-date="'+h+'"]').css("background-color","#ececec"),/*$('div[data-divNumber="' + number + '"]')*/
e.setDate(e.getDate()+1)}}a.calendarMasterId=d.id,a.calendarMaster=d,a.scrollTime||(a.scrollTime=a.calendarMaster.eventTime),a.showObject={},a.showObject.orgLocId=d.organizationLocationId,a.showObject.entityTypeCode=d.entityType.code,a.showObject.entityType=d.entityType.value,a.showObject.entityName=d.entityName,a.showObject.calendarName=d.name,a.showObject.calendarOrg=d.organizationLocationName,d.slotSize&&(a.slotTime=d.slotSize),a.holidayArray=d.holidays,a.nonWorkingArray=d.nonWorkingDays,a.newEvents=[];if(h(e,f),angular.forEach(o.objIterator(a.calendarMaster.events),function(c,d){/*angular.forEach(value.eventSlots, function (value2, key2) {*/
angular.forEach(c.dates,function(d,e){/*value.start=date+" "+value.start;
                        value.end=date+" "+value.end;*/
var f={};f.id=c.id,f.eventType=c.eventType,f.calendarId=c.calendarId,f.eventDate=c.eventDate;/* if(value.startTime && value.end)*/
var h=new Date;h.setHours(c.eventStartTime.substring(0,2)),h.setMinutes(c.eventStartTime.substring(3,5));var i=new Date;i.setHours(c.eventEndTime.substring(0,2)),i.setMinutes(c.eventEndTime.substring(3,5));g("date")(h,"hh:mm a"),g("date")(i,"hh:mm a");/*eventObject.title = strDate + "-" + endDt;*/
f.start=d+" "+c.eventStartTime,f.end=d+" "+c.eventEndTime,b&&(f.viewType=b.type),f.exception=c.exception,f.eventStartTime=c.eventStartTime,f.eventEndTime=c.eventEndTime,f.eventException=c.eventException,f.eventSlots=c.eventSlots,f.eventId=c.id,f.appointmentType=c.appointmentType,f.slotSize=c.slotSize,f.offDay=c.offDay,f.eventName=c.title,f.entityType=a.calendarMaster.entityType,f.entityName=a.calendarMaster.entityName,f.entityId=a.calendarMaster.entityId,f.doctorsAssoctiated=a.calendarMaster.doctorsAssoctiated,f.slotId=c.slotId,c.capacity&&(f.capacity=c.capacity),a.newEvents.push(f)})}),a.calendarMaster.events=a.newEvents,angular.forEach(a.calendarMaster.businessHours,function(b,c){angular.forEach(b.timeSlots,function(c,d){c.start=b.date+" "+c.start,c.end=b.date+" "+c.end,c.rendering="background",c.eventBackgroundColor="rgb(255,0,0)",a.calendarMaster.events.push(c)})}),a.uiConfig={calendar:{height:500,editable:!1,contentHeight:500,slotDuration:"00:"+a.slotTime+":00",customButtons:{myCustomButton:{text:"Define event",click:a.createEvent},myButton:{text:"Day Availability",click:a.showAvailability}},axisFormat:"hh:mm A",header:{left:"prev,next today",center:"title",right:"myButton,myCustomButton,month,agendaDay,agendaWeek"},buttonText:{today:"Today",month:"Month",week:"Week",day:"Day"},events:a.events,fixedWeekCount:!1,defaultView:a.defaultView,businessHours:{},eventLimit:!0,nowIndicator:!0,scrollTime:a.scrollTime,displayEventTime:!0,viewRender:a.viewRender,eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,eventRender:a.eventRender,dayClick:a.dayClick,eventClick:a.eventClick,slotEventOverlap:a.slotEventOverlap,dayRender:a.dayRender,eventAfterAllRender:a.eventAfterAllRender,viewDestroy:a.viewDestroy,columnHeaderFormat:"ddd DD/MMM",firstDay:(new Date).getDay()}},a.setCalendarData(f,e),a.isPostpond&&!a.defaultRequestCall&&!a.isPostponePopupShown){a.isPostponePopupShown=!0;var j=i.confirm().title(m.instant("POSTPONE_APPOINTMENT")).textContent(m.instant("SELECT_SLOT_TO_POSTPONT")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(j).then(function(){i.hide()},function(){q.goBackToPrevState()})}r.showSpinner=!1},function(a){r.showSpinner=!1}),0==a.loggedInUser.isOrganizationUserMode&&$(".fc-myCustomButton-button").hide()},a.showAvailability=function(){i.show({controller:"ShowCalendarAvailabilityCtrl",templateUrl:"app/modules/fullCalendar/views/working-day.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{calendarMasterId:a.calendarMasterObject.calendarId,entityId:a.calendarMasterObject.entityId,calendarRequestData:a.calendarObjectData,parentScope:a}}).then(function(){a.WSHealthProfessionalsValues={}},function(c){a.WSHealthProfessionalsValues={},c&&b.reload()})},a.init=function(){if(a.searchCriteria.entityName={},q.isNullOrEmpty(d.data)||localStorage.setItem("cmi",angular.toJson(d.data)),1==angular.fromJson(sessionStorage.getItem("samePageCall"))){if(localStorage.getItem("viewCalendarFilterValues")){var b=angular.fromJson(localStorage.getItem("viewCalendarFilterValues"));a.searchCriteria.orgLocation=b.orgLocation,a.searchCriteria.entityType=b.entityType,a.searchCriteria.entityName=b.entityName}}else q.isNullOrEmpty(angular.fromJson(sessionStorage.getItem("samePageCall")))?d.data=angular.fromJson(localStorage.getItem("cmi")):d.data=angular.fromJson(localStorage.getItem("cmi"));a.loggedInUser=p.getLoggedInUser(),a.individualFeaturePrivileges=s.getIndividualFeaturePrivileges(),a.locationConsolidatedPrivileges=s.getLocationConsolidatedPrivileges(),a.locationFeaturePrivileges=s.getLocationFeaturePrivileges(),d.data?(localStorage.setItem("cmi",angular.toJson(d.data)),a.calendarObjectData=d.data,d.data.slotId&&"true"==localStorage.getItem("isPostpond")&&(a.isPostpond=!0,sessionStorage.setItem("isPostpond","true"))):(a.trialCalendarObjectData=localStorage.getItem("cmi"),a.calendarObjectData=angular.fromJson(a.trialCalendarObjectData),d.data=angular.copy(a.calendarObjectData)),d.data&&!localStorage.getItem("viewCalendarFilterValues")&&(q.isFieldEmpty(d.data.organizationLocation)?q.isFieldEmpty(d.data.orgLocation)||(a.searchCriteria.orgLocation=d.data.orgLocation.id):a.searchCriteria.orgLocation=d.data.organizationLocation,q.isFieldEmpty(d.data.entityType)||(a.searchCriteria.entityType=d.data.entityType),q.isFieldEmpty(d.data.entityId)||(a.searchCriteria.entityName.id=d.data.entityId,a.searchCriteria.entityName.value=d.data.entityName)),a.getCalendarData()},a.createEvent=function(){b.go("manageEventCalendar",{type:"add",calendarData:a.calendarMaster,calendarState:d,callingPage:"processcalendarview"})},a.init(),/* event source that pulls from google.com */
a.eventSource={className:"gcal-event",// an option!
currentTimezone:"America/Chicago"},a.customFullscreen=j("xs")||j("sm"),a.dayClick=function(b,c,e){if("exception"!=d.type){(j("sm")||j("xs"))&&a.customFullscreen}},a.businessHours=function(){},a.eventClick=function(e,f){if(1==e.exception){(j("sm")||j("xs"))&&a.customFullscreen;i.show({controller:x,templateUrl:"app/modules/fullCalendar/views/exception-approval.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{calendarDayEventId:e.id,calendarRequestData:a.calendarMasterObject,eventDate:e.eventDate,eventException:e.eventException}}).then(function(a){},function(){a.WSHealthProfessionalsValues={}})}else if(d.data&&!angular.fromJson(sessionStorage.getItem("isPostpond")))if(1==a.menuVisible)$(".event-menu-list").remove(),a.menuVisible=!1;else if(444==f.target.id){var h=!1;angular.forEach(e.eventSlots,function(a){0==h&&a.appointmentSlots&&(h=!0)});var k=m.instant("LIST_APPOINTMENTS"),n=m.instant("EDIT_EVENT"),o=m.instant("DEFINE_EVENT_EXCEPTION"),q=m.instant("FIX_APPOINTMENT"),s=m.instant("CANCEL_APPOINTMENTS"),u=m.instant("POSTPONE_APPOINTMENT"),v=m.instant("REGISTER_WALKIN"),w=m.instant("SHOW_STATUS");if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){var z=(Math.floor(501*Math.random()),$("#calendar").offset()),A=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),B=f.pageX-z.left+A,C=f.pageY-z.top+$(".calendarDetailsRow").height(),D=null;e.eventSlots&&(D=e.eventSlots[0].slotDate);var E="<div class='event-menu-list'><ul>";E=E+"<li class='calendar-event-menu-title-style'><div class=''>"+e.eventName+"</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+D+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='listAppointmentMenu'>"+k+"</div></li>";var F=new Date,G=D.split("-"),H=e.eventEndTime.split(":"),I=parseInt(G[1])-1,J=I.toString(),K=new Date(G[0],J,G[2],H[0],H[1],H[2]);/*var appDate = new Date(slotDate + " " + event.eventEndTime);*/
K.getTime()>=F.getTime()&&(t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"calendar_event_edit",a.showObject.orgLocId)&&(/*Edit event menu*/
E=E+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+D+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='editEventMenu'>"+n+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"event_excpetions",a.showObject.orgLocId)&&(/*Event exception menu*/
E=E+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+D+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='eventExceptionMenu'>"+o+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_add",a.showObject.orgLocId)&&"FCFS"!=e.appointmentType&&(/*Fix appointment menu*/
E=E+"<li><div data-eventId='"+e.eventId+"' data-eventDate='"+D+"' data-entityName='"+e.entityName+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeValue='"+e.entityType.value+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='fixAppointmentMenu'>"+q+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_cancel",a.showObject.orgLocId)&&1==h&&(/*Cancel bulk appointment menu*/
E=E+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+D+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='cancelAppointmentMenu'>"+s+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_postpone",a.showObject.orgLocId)&&K.getDate()==F.getDate()&&K.getMonth()==F.getMonth()&&K.getYear()==F.getYear()&&1==h&&(/*Postpone appointment menu*/
E=E+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+D+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='postpondAppointmentMenu' >"+u+"</div></li>"));var L=g("date")(D,"yyyy-MM-dd"),M=g("date")(new Date,"yyyy-MM-dd");1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode&&L==M&&(E=E+"<li><div data-eventId='"+e.eventId+"' data-eventDate='"+D+"' class='calendar-event-menu-style' id='showStatusMenu'>"+w+"</div></li>",t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_walk_in",a.showObject.orgLocId)&&(/*Register Walk-in menu*/
E=E+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+D+"' data-eventName='"+e.eventName+"' data-eventStartTime='"+e.eventStartTime+"' class='calendar-event-menu-style' id='registerWalkinMenu'>"+v+"</div></li>")),E+="</ul></div>",E.indexOf("</li>")!=-1&&($newdiv=$(E).css({left:B+"px",top:C+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}}else{var q=m.instant("FIX_APPOINTMENT"),s=m.instant("CANCEL_APPOINTMENTS"),u=m.instant("POSTPONE_APPOINTMENT"),F=new Date,G=f.target.dataset.appointmentdate.split("-"),H=f.target.dataset.appointmentendtime.split(":"),I=parseInt(G[1])-1,J=I.toString(),K=new Date(G[0],J,G[2],H[0],H[1],H[2]);/*var appDate = new Date(element.target.dataset.appointmentdate + " " + event.eventEndTime);*/
if(K.getTime()>=F.getTime()&&"FCFS"!=f.target.dataset.appointmenttype){var z=(Math.floor(501*Math.random()),$("#calendar").offset()),A=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),B=f.pageX-z.left+A,C=f.pageY-z.top+2*$(".calendarDetailsRow").height()+20,N="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode)if("null"!=f.target.dataset.appointmentid){var M=y(new Date);M<=f.target.dataset.appointmentdate&&0!=e.eventSlots[0].capacityRemaining&&"CAL_PROCESS"==e.entityType.code&&(N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+q+"</div></li>"),/* cancel appointment menu */
N=N+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+s+"</div></li>",/* postpont appointment menu*/
N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"}else{var M=y(new Date);M<=f.target.dataset.appointmentdate&&(N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+q+"</div></li>")}else if("null"!=f.target.dataset.appointmentid)if("null"!=f.target.dataset.appointmentuserid&&f.target.dataset.appointmentuserid==angular.fromJson(p.getLoggedInUser()).id){var M=y(new Date);M<=f.target.dataset.appointmentdate&&0!=e.eventSlots[0].capacityRemaining&&"CAL_PROCESS"==e.entityType.code&&(N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+q+"</div></li>"),/* cancel appointment menu */
N=N+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+s+"</div></li>",/* postpont appointment menu*/
N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"}else{var M=y(new Date);M<=f.target.dataset.appointmentdate&&0!=e.eventSlots[0].capacityRemaining&&"CAL_PROCESS"==e.entityType.code&&(N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+q+"</div></li>")}else{var M=y(new Date);M<=f.target.dataset.appointmentdate&&(N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+q+"</div></li>")}N+="</ul></div>",N.indexOf("</li>")!=-1&&($newdiv=$(N).css({left:B+"px",top:C+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}}else{var z=(Math.floor(501*Math.random()),$("#calendar").offset()),A=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),B=f.pageX-z.left+A,C=f.pageY-z.top+2*$(".calendarDetailsRow").height()+20,N="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){if("CAL_PROCESS"==d.data.entityType.code){if(sessionStorage.getItem("oldAppointmentId")){r.showSpinner=!0;var O={};O.apptDate=e.eventSlots[0].slotDate,O.slotId=e.eventSlots[0].id,O.oldAppointmentId=sessionStorage.getItem("oldAppointmentId"),O.userId=null,O.eventId=e.eventId,O.slotId&&O.eventId?c.postpondProcessAppointment(O,function(a){r.showSpinner=!1,l("success",a.successMessage),localStorage.setItem("isPostpond","false"),b.reload()},function(a){r.showSpinner=!1}):r.showSpinner=!1}else if("null"!=f.target.dataset.appointmentid){var M=y(new Date);if(M<=f.target.dataset.appointmentdate&&0!=e.eventSlots[0].capacityRemaining&&"CAL_PROCESS"==e.entityType.code&&(N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'> Fix appointment</div></li>"),"null"!=f.target.dataset.appointmentuserid&&(f.target.dataset.appointmentuserid==angular.fromJson(p.getLoggedInUser()).id||1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode)){var M=y(new Date);/* cancel appointment menu */
N=N+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'> Cancel Appointment</div></li>",/* postpont appointment menu*/
N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'> Postpone Appointment</div></li>"}}else{var M=y(new Date);M<=f.target.dataset.appointmentdate&&(N=N+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'> Fix appointment</div></li>")}N+="</ul></div>",N.indexOf("</li>")!=-1&&($newdiv=$(N).css({left:B+"px",top:C+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}}else{r.showSpinner=!0;var O={};O.apptDate=e.eventSlots[0].slotDate,O.slotId=e.eventSlots[0].id,d.data.appointmentId?O.oldAppointmentId=d.data.appointmentId:sessionStorage.getItem("oldAppointmentId")&&(O.oldAppointmentId=sessionStorage.getItem("oldAppointmentId")),O.eventId=e.eventId,O.userId=angular.fromJson(p.getLoggedInUser()).id,O.oldAppointmentId&&O.slotId?c.postpondProcessAppointment(O,function(a){l("success",a.successMessage),r.showSpinner=!1,localStorage.setItem("isPostpond","false"),b.reload()},function(a){r.showSpinner=!1}):r.showSpinner=!1,r.showSpinner=!1}}},a.slotEventOverlap=function(){return a.calendarObject.slotEventOverlap},/* add and removes an event source of choice */
a.addRemoveEventSource=function(a,b){var c=0;angular.forEach(a,function(d,e){a[e]===b&&(a.splice(e,1),c=1)}),0===c&&a.push(b)},/* Change View */
a.changeView=function(a,b){h.calendars[b].fullCalendar("changeView",a)},/* Change View */
a.renderCalender=function(a){f(function(){h.calendars[a]})},$(".container").click(function(e,f){if(e&&"processcalendarview"==b.current.name){if(444!=e.target.id&&1111!=e.target.id)if("fixAppointmentMenu"==e.target.id)b.go("manageFixAppointment",{type:"add",eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},entityType:{id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypevalue,code:e.target.dataset.entitytypecode},apptDate:e.target.dataset.eventdate});else if("editEventMenu"==e.target.id)e.target.dataset.eventid&&b.go("manageEventCalendar",{type:"edit",eventId:e.target.dataset.eventid});else if("cancelAppointmentMenu"==e.target.id)b.go("cancelAppointmentList",{type:"cancel",eventId:e.target.dataset.eventid,date:e.target.dataset.eventdate});else if("postpondAppointmentMenu"==e.target.id)b.go("postponeAppointmentList",{type:"postpone",eventId:e.target.dataset.eventid});else if("listAppointmentMenu"==e.target.id)b.go("appointmentsList",{event:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.eventdate,entityName:e.target.dataset.entityname,loadFilter:!1});else if("showStatusMenu"==e.target.id)e.target.dataset.eventid&&e.target.dataset.eventdate&&b.go("userAppointmentStatus",{eventId:e.target.dataset.eventid,eventDate:e.target.dataset.eventdate,calendarState:d,callingPage:"processcalendarview"});else if("registerWalkinMenu"==e.target.id)b.go("manageAppointmentWalkIn",{eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptStartTime:e.target.dataset.eventstarttime,apptDate:e.target.dataset.eventdate,appointmentType:"RECORDWALKIN",urlState:"manageAppointmentWalkIn",calendarState:d,callingPage:"processcalendarview"});else if("eventExceptionMenu"==e.target.id)e.target.dataset.eventid&&b.go("manageEventCalendarException",{type:"add",eventId:e.target.dataset.eventid,calendarState:d,callingPage:"processcalendarview"});else if("cancelAppointmentRMenu"==e.target.id){if(e.target.dataset.appointmentid&&"null"!=e.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")){var g={};a.oldAppointmentId=null,sessionStorage.setItem("oldAppointmentId","null"),g.apptDate=e.target.dataset.appointmentdate,$(".event-menu-list").remove(),a.menuVisible=!1,"CAL_PROCESS"!=e.target.dataset.appointmenttype&&"CAL_PROCESS"!=e.target.dataset.entitytypecode||(localStorage.setItem("isPopupOpen","true"),a.dialogBox=i.show({controller:w,templateUrl:"app/modules/fullCalendar/views/cancel-postpond-appointment.html",parent:angular.element(document.body),targetEvent:e,multiple:!1,clickOutsideToClose:!1,locals:{parentScope:a,eventData:e}}).then(function(d){localStorage.setItem("isPopupOpen","false"),1==d.isCanceled&&(a.oldAppointmentId=d.oldAppointmentObj,g.appointmentIds=[a.oldAppointmentId],e.target.dataset.appointmentid=null,c.cancelAppointment(g,function(a){l("success",a.successMessage),b.reload()},function(a){}))},function(a){}))}}else if("postpondAppointmentRMenu"==e.target.id)"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),a.oldAppointmentId=null,sessionStorage.setItem("oldAppointmentId","null"),a.isPostpond=!0,sessionStorage.setItem("isPostpond","true"),$(".event-menu-list").remove(),a.menuVisible=!1,i.show({controller:w,templateUrl:"app/modules/fullCalendar/views/cancel-postpond-appointment.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1,locals:{parentScope:a,eventData:e}}).then(function(b){if(localStorage.setItem("isPopupOpen","false"),b.oldAppointmentObj){a.oldAppointmentId=b.oldAppointmentObj,sessionStorage.setItem("oldAppointmentId",b.oldAppointmentObj);var c=i.confirm().title(m.instant("POSTPONE_APPOINTMENT")).textContent(m.instant("SELECT_SLOT_TO_POSTPONT")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(c).then(function(){i.hide(),localStorage.setItem("isPopupOpen","false")},function(){i.hide(),localStorage.setItem("isPopupOpen","false"),a.isPostpond=!1,sessionStorage.setItem("isPostpond","false")})}else localStorage.setItem("isPopupOpen","false"),a.isPostpond=!1,sessionStorage.setItem("isPostpond","false")},function(a){localStorage.setItem("isPopupOpen","false")}));else if("fixAppointmentRMenu"==e.target.id){if($(".event-menu-list").remove(),a.menuVisible=!1,e.target.dataset.appointmentid){var h=null;"ADHOC"!=e.target.dataset.appointmenttype&&(h=e.target.dataset.appointmentendtime),"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),i.show({controller:"QuickFixAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/fix-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{fixApptObj:{appointmentEnd:h,type:"add",appointmentId:e.target.dataset.appointmentid,slotId:e.target.dataset.slotid,entityType:{id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypename,code:e.target.dataset.entitytypecode},entityName:{id:e.target.dataset.entityid,value:e.target.dataset.entityname},eventType:{id:e.target.dataset.eventtypeid,value:e.target.dataset.eventtypename},eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate,apptStartTime:e.target.dataset.appointmenttime,apptEndTime:h,eventExceptionId:e.target.dataset.eventexceptionid}}}).then(function(a){b.reload()},function(){a.WSHealthProfessionalsValues={}}))}}else $(".event-menu-list").remove(),a.menuVisible=!1}else 1==a.menuVisible&&($(".event-menu-list").remove(),a.menuVisible=!1)}),a.viewRender=function(b,c){b&&a.getCalendarData(b)},a.setCalendarData=function(b,c){var d=new Date;d.setYear(b),d.setMonth(c),h.calendars.myCalendar.fullCalendar("removeEvents"),angular.forEach(a.calendarMaster.events,function(a,b){h.calendars.myCalendar.fullCalendar("renderEvent",a)})},/* Render Tooltip */
a.eventRender=function(b,d,e){c.setEventStyle(d,b,a.slotTime)},a.eventAfterAllRender=function(a){$(".fc-content .fc-time").hide()},a.events=a.calendarMaster.events,/* event sources array*/
a.eventSources=[a.eventSource],a.CalendarPopUpValues={},a.$on("$destroy",function(){localStorage.getItem("viewCalendarFilterValues")&&localStorage.removeItem("viewCalendarFilterValues"),sessionStorage.getItem("samePageCall")&&sessionStorage.removeItem("samePageCall")}),/* filter code start */
a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.entityType={queryUrl:"GET_ENTITY_TYPES_EXCEPT_ORG_LOC",queryParameter:{}},a.getCalendarName=function(){var b={};q.isNullOrEmpty(a.searchCriteria.entityType)||(b.entityTypeId=a.searchCriteria.entityType.id),q.isNullOrEmpty(a.searchCriteria.orgLocation)||(b.organizationLocationId=a.searchCriteria.orgLocation.id),q.isNullOrEmpty(a.searchCriteria.entityName)||(b.entityId=a.searchCriteria.entityName.id),u.postData(v.getUrl("CALENDAR_SMART_SEARCH"),b,function(b){b&&b.data&&(a.calendarNames=b.data)},function(a){errorCallback(a)})},a.$watch("searchCriteria.orgLocation",function(b,c){b&&b.id?(a.locationID=b.id,f(function(){a.getCalendarName()},0)):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.isEquipment=!1,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:a.searchCriteria.orgLocation.id}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.isProcess=!1,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:a.searchCriteria.orgLocation.data.id}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}}),f(function(){a.getCalendarName()},0)):(a.searchCriteria.entityName=null,a.searchCriteria.calendarObj=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.entityName",function(b,c){b&&b.id?a.entityNameID=b.id:a.searchCriteria.calendarObj=null;f(function(){a.getCalendarName()},0)}),a.filterCalendar=function(){if(!q.isFieldEmpty(a.searchCriteria.orgLocation)){r.showSpinner=!0;var d={calendarId:a.searchCriteria.calendarObj.id,entityTypeCode:a.searchCriteria.entityType.code,entityId:a.searchCriteria.entityName.id};c.getCalendarDetailsById(d,function(c){if(r.showSpinner=!1,c)if(localStorage.setItem("cmi",angular.toJson(c)),q.isNullOrEmpty(a.searchCriteria)||localStorage.setItem("viewCalendarFilterValues",angular.toJson(a.searchCriteria)),"CAL_ORGANIZATION_USER"==a.searchCriteria.entityType.code)localStorage.removeItem("viewCalendarFilterValues"),b.go("usercalendarview",{type:"regular",data:c,fromListPage:!0});else if("CAL_PROCESS"==a.searchCriteria.entityType.code){sessionStorage.setItem("samePageCall",!0);var d={inherit:!1};b.go(".",{data:c,samePageCall:!0},d)}else"CAL_EQUIPMENT"==a.searchCriteria.entityType.code&&(localStorage.removeItem("viewCalendarFilterValues"),b.go("equipmentcalendarview",{type:"regular",data:c}))},function(a){r.showSpinner=!1})}},a.clear=function(){a.searchCriteria={}}}]),angular.module("paripal.fullCalendarModule").controller("ShowCalendarAvailabilityCtrl",["$scope","$filter","httpService","urlService","$compile","$timeout","createCalendarService","uiCalendarConfig","$mdDialog","$mdMedia","calendarMasterId","entityId","createEventService","calendarRequestData","parentScope","featurePrivilegeConstants","$rootScope","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){a.calendarFeaturePrivilege=p.CALENDAR_EVENT_ADD,a.addEventTrue=!1,a.eventDay={},a.eventDay.entityId=l,a.eventDay.entityType=n.entityType,a.eventList={},a.orgLocationId=n.organizationLocationId,a.eventList.calendarMaster={},a.daily="active";
//$scope.eventDay.eventType=calendarRequestData.entityType.code;
var t=new CommonFunctions;/*$scope.currentDate = commonObject.dateSeperator($scope.selectedDate);

        $scope.eventDay.eventDate = commonObject.dateFormatter($scope.selectedDate);


        var dateTrial = $filter('date')(commonObject.dateFormatter($scope.selectedDate), "dd MMMM yyyy");
*/
a.isWorkingDay=!0,a.onWorkingDayChange=function(b){b?(a.whetherNonWorkingDay=!1,a.whetherHoliday=!1,0==a.eventList.wsCalendarTimings.length&&a.eventList.wsCalendarTimings.push({})):a.eventList.wsCalendarTimings=[]},a.onNonWorkingDayChange=function(b){b&&(a.whetherWorkingDay=!1,a.eventList.wsCalendarTimings=[])},a.onHolidayChange=function(b){b&&(a.whetherWorkingDay=!1,a.eventList.wsCalendarTimings=[])},a.updateDayAvailability=function(c){var d={};d.calendarMaster={};var e=[];angular.forEach(c.wsCalendarTimings,function(a,c){var d=b("date")(a.startTime,"H:mm"),f=b("date")(a.endTime,"H:mm"),g={};g.startTime=d,g.endTime=f,e.push(g)}),d.calendarMaster.id=k,d.entityId=l,d.entityType=n.entityType,d.eventDate=a.availabilityDate,d.wsCalendarTimings=e,d.whetherWorkingDay=a.whetherWorkingDay,d.whetherNonWorkingDay=a.whetherNonWorkingDay,d.whetherHoliday=a.whetherHoliday,d.organizationLocationId=n.organizationLocationId;var f=new Date(d.eventDate),g=new Array(7);g[0]="SUNDAY",g[1]="MONDAY",g[2]="TUESDAY",g[3]="WEDNESDAY",g[4]="THURSDAY",g[5]="FRIDAY",g[6]="SATURDAY";var h=g[f.getDay()];d.day=h,m.saveDateStatus(d,function(b){a.eventList.whetherWorkingDay&&(a.whetherNonWorkingDay||a.whetherHoliday)?r("success",s.instant("WORKING_DAY_CHANGED_TO_NON_WORKING")):r("success",s.instant("DAY_AVAILABILITY_CHANGED")),a.getListOfEventsByDate(),i.cancel(!0)},function(a){})},a.cancel=function(){i.cancel()},a.cancelEvent=function(){a.addEventTrue=!a.addEventTrue,a.eventDay={},a.eventDay.entityType=n.entityType},a.clear=function(){document.eventData.reset()},a.changeWorkingSettings=function(){a.eventList.whetherWorkingDay?a.eventList.whetherNonWorkingDay=!1:a.eventList.whetherNonWorkingDay=!0},a.changeNonWorkingSettings=function(){a.eventList.whetherNonWorkingDay?a.eventList.whetherWorkingDay=!1:a.eventList.whetherWorkingDay=!0},a.getListOfEventsByDate=function(){q.showSpinner=!0,m.getListOfEventsByDate(a.availabilityDate,k,n,function(b){a.showUpdatableData=!0,a.eventList=b,a.workingTimes=a.eventList.wsCalendarTimings,angular.forEach(a.workingTimes,function(a,b){var c=new Date;c.setHours(a.startTime.substring(0,2)),c.setMinutes(a.startTime.substring(3,5));var d=new Date;d.setHours(a.endTime.substring(0,2)),d.setMinutes(a.endTime.substring(3,5)),a.startTime=c,a.endTime=d}),a.whetherWorkingDay=a.eventList.whetherWorkingDay,a.whetherHoliday=a.eventList.whetherHoliday,a.whetherNonWorkingDay=a.eventList.whetherNonWorkingDay;var c=a.workingTimes;"object"==typeof c&&c.sort(function(a,b){return a.startTime>b.startTime}),a.eventList.wsCalendarTimings=c,a.twelveHrFormat=function(a){if(a>="12:00"){var b=a.replace(":","");return(b=1200)?(b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM")):(b-=1200,b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"))}return a+=" AM"},angular.forEach(b.wsCalendarDayEvent,function(b,c){b.entityType=n.entityType,b.st=b.startTime.substring(0,2)+":"+b.startTime.substring(3,5),b.et=b.endTime.substring(0,2)+":"+b.endTime.substring(3,5),b.st=a.twelveHrFormat(b.st),b.et=a.twelveHrFormat(b.et),null==b.calendarEventExceptionStatus?"CAL_EVENT_APPT"==b.eventType.code?b.panalStyle="panel-green":"CAL_EVENT_HOME_VISIT"==b.eventType.code?(b.panalStyle="panel-green",b.iconClass="fa fa-home"):"CAL_EVENT_ONLINE"==b.eventType.code?(b.panalStyle="panel-green",b.iconClass="fa fa-phone"):"CAL_EVENT_SELF_NORMAL"==b.eventType.code?b.panalStyle="panel-selfevent":"CAL_EVENT_FREE_SLOT_APPT"==b.eventType.code&&(b.panalStyle="panel-green"):(b.panalStyle="panel-exception",b.iconClass="fa fa-exclamation-triangle")}),q.showSpinner=!1},function(b){q.showSpinner=!1,a.explressionFollowupSpinner=!1,a.error=b}),a.addDayAvailability=function(){a.eventList.wsCalendarTimings.push({})},a.removeDayAvailability=function(b){a.eventList.wsCalendarTimings.splice(b,1)}},/**/
a.getAvailabilityDate=function(){a.getListOfEventsByDate()},a.saveEvent=function(){
//$scope.addEventTrue = !$scope.addEventTrue;
return a.whetherHoliday||a.whetherNonWorkingDay?void r("Error",s.instant("WORKING_NO_WORKING_MSG")):(a.eventDay.calendarMaster={},a.eventDay.calendarMaster.id=k,a.eventDay.eventDate=t.dateFormatter(a.selectedDate),a.eventDay.entityId=l,""==a.eventDay.repeatEnum&&(a.eventDay.repeatEnum=null),a.ste=a.eventDay.startTime,a.ete=a.eventDay.endTime,a.eventDay.eventDate=t.dateFormatter(a.selectedDate),a.eventDay.entityType=n.entityType,a.eventDay.organizationLocationId=n.organizationLocationId,void m.saveCreateEvent(a.eventDay,function(b){a.addEventTrue=!a.addEventTrue,a.eventDay.eventType={},a.eventDay.wsCalendarDayEventRepeatInformation={},a.eventDay.repeatEnum="",a.eventDay.startTime=new Date,a.eventDay.endTime=new Date,a.eventDay.eventName="",i.cancel(),r("success",s.instant(b.code)),o.getCalendarData()},function(b){a.error=b,a.eventDay.startTime=a.ste,a.eventDay.endTime=a.ete}))},a.updateDayDetails=function(c){c.date=a.eventDay.eventDate,c.calendarMaster.id=k;var d=b("date")(c.startTime,"H:mm"),e=b("date")(c.endTime,"H:mm");c.startTime=d,c.endTime=e,delete c.id,delete c.wsCalendarDayEvent,/*eventList.startTime*/
/* var endTime=new Date(eventList.endTime);
             eventList.endTime=$filter('date')(endTime, "H:mm");*/
m.updateDayDetails(c,function(b){a.getListOfEventsByDate()},function(a){})},a.deleteEvent=function(b){m.deleteEvent(b,function(b){r("success",s.instant("EVENT_DELETED")),a.getListOfEventsByDate(),o.getCalendarData()},function(a){})},a.updateEventDetails=function(b,c,d){delete b.iconClass,delete b.panalStyle,b.organizationLocationId=n.organizationLocationId,m.updateEventDetails(b,c,d,function(b){r("success",s.instant(b.code)),a.getListOfEventsByDate(),i.cancel(),window.location.reload()},function(a){})}}]),angular.module("paripal.fullCalendarModule").controller("UpdateServiceTypeCtrl",["$scope","$rootScope","$state","baseService","$mdDialog","utilService","httpService","urlService","notify","$translate","apptDetails","apptId",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.WSAppointment={},console.log(k),a.serviceType={queryUrl:"GET_SERVICE_TREATMENT_TYPE",queryParameter:{calendarEventId:k.eventName.id}},a.cancel=function(){e.hide(),localStorage.setItem("isPopupOpen","false")},a.setServiceType=function(){if(b.showSpinner=!0,!f.isNullOrEmpty(k)){/* Parameters to be sent */
var c={};c.actionTaken="CHECKEDIN",f.isNullOrEmpty(k.allocatedTo)||f.isNullOrEmpty(k.allocatedTo.id)||(c.allocatedToId=k.allocatedTo.id),f.isNullOrEmpty(k.patientPhoneNumber)||f.isNullOrEmpty(k.patientPhoneNumber)||(c.cell1=k.patientPhoneNumber);var d=new Date;c.checkInTime=d.getHours()+":"+d.getMinutes()+":00",f.isNullOrEmpty(k.patient)||f.isNullOrEmpty(k.patient.value)||(c.displayName=k.patient.value,c.firstName=k.patient.value,c.lastName=k.patient.value),f.isNullOrEmpty(k.isBillable)||(c.isBillable=k.isBillable),f.isNullOrEmpty(k.followUp)||(c.isFollowUp=k.followUp),f.isNullOrEmpty(k.freeVisit)||(c.isFreeVisit=k.freeVisit),f.isNullOrEmpty(k.walkin)||(c.isWalkIn=k.walkin),f.isNullOrEmpty(k.wetherUserExist)||(c.whetherExistingUser=k.wetherUserExist),f.isNullOrEmpty(k.patient)||f.isNullOrEmpty(k.patient.id)||(c.onBehalfOfId=k.patient.id),f.isNullOrEmpty(k.location)||f.isNullOrEmpty(k.location.id)||(c.organizationLocationId=k.location.id),f.isNullOrEmpty(a.WSAppointment)||f.isNullOrEmpty(a.WSAppointment.serviceType)||(c.serviceType=a.WSAppointment.serviceType)}var m={};f.isNullOrEmpty(l)||(m.appointmentId=angular.fromJson(l)),g.putData(h.getParameterizedUrl("UPDATE_ONLINE_APPOINTMENT_FOR_CHECK_IN",m),c,function(a){b.showSpinner=!1,i("success",j.instant("CHECK_IN_SUCCESSFUL"));var c=a.data.transactionId;e.cancel(c)},function(a){b.showSpinner=!1})}}]),angular.module("paripal.fullCalendarModule").controller("UpdateStatusCtrl",["$scope","$rootScope","$state","baseService","$mdDialog","apptId","utilService","httpService","urlService","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";a.requestCriteria={},a.cancel=function(){e.cancel()},a.submitReason=function(){if(!g.isFieldEmpty(a.requestCriteria.reason)||!g.isFieldEmpty(f)){var b=angular.copy(a.requestCriteria);b.appointmentId=angular.fromJson(f),h.postData(i.getUrl("UPDATE_PATIENT_STATUS"),b,function(a){j("success",k.instant("REASON_UPDATED")),e.cancel()},function(a){})}}}]),//var calendarDemoApp = angular.module('fullCalendarModule', ['ui.calendar', 'ui.bootstrap','ngMaterial','ngMaterialDatePicker']);
angular.module("paripal.fullCalendarModule").controller("UserCalendarCtrl",["$scope","$state","commonCalendarService","$stateParams","$compile","$timeout","$filter","uiCalendarConfig","$mdDialog","$mdMedia","createEventService","notify","$translate","featurePrivilegeConstants","calendarObjIteratorService","baseService","utilService","$rootScope","storageService","calendarMenuService","httpService","urlService","appointmentsListService","MakePrescriptionFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function y(a,d,e,f,g,h){a.decision={},a.decisionObject={},a.addEventTrue=!0,a.twelveHrFormat=function(a){if(a>="12:00"){var b=a.replace(":","");return(b=1200)?(b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM")):(b-=1200,b=""+b,b.length<4?(b="0"+b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"):(b=b.toString(),b.substring(0,2)+":"+b.substring(2,4)+" PM"))}return a+=" AM"},a.getExceptionDetails=function(){k.getExceptionDetails(f,e,g,h,function(b){a.exceptionDetails=b,a.exceptionDetails.startTime=a.exceptionDetails.startTime.substring(0,5),a.exceptionDetails.endTime=a.exceptionDetails.endTime.substring(0,5),angular.forEach(a.exceptionDetails.wsCalendarTimings,function(a,b){var c=new Date,d=new Date;c.setHours(a.startTime.substring(0,2)),c.setMinutes(a.startTime.substring(3,5)),a.startTime=c,d.setHours(a.endTime.substring(0,2)),d.setMinutes(a.endTime.substring(3,5)),a.endTime=d})},function(a){})},a.getExceptionDetails(),a.cancel=function(){d.cancel()},a.validateReason=function(){"Approve"==a.decision.status?a.isReasonRequired=!1:a.isReasonRequired=!0},a.exceptionDecision=function(){"Approve"==a.decision.status?a.decisionObject.status="ACCEPTED":a.decisionObject.status="REJECTED",a.decisionObject.calendarDayEventId=e,a.decisionObject.reason=a.decision.reason,a.decisionObject.organizationLocationId=f.organizationLocationId,a.decisionObject.id=e,a.decisionObject.eventException=h,c.saveExceptionDecision(a.decisionObject,function(a){d.cancel(),b.reload()},function(a){})}}function z(a,c,d,e,f,h,i,j,k,l,m){a.todaysDate=new Date,a.cancel=function(){m.cancel()},a.$watchGroup(["postponeAdhocObj.eventId","postponeAdhocObj.apptDate"],function(b){if(b[0]&&b[1]){a.availabilities=[];var c={};c.date=l.convertToServerDate(b[1]),c.eventId=angular.fromJson(b[0]).id,h.getAvailableTimings(c,function(b){angular.forEach(b,function(b){1!=b.isBooked&&a.availabilities.push(b)})},function(a){})}}),a.getAdhocEventList=function(){k.getCalendarEventDetails(d,function(b){var c={};c.entityId=b.entityId,c.entityType=b.entityType,c.appointmentType=b.appointmentType,h.getEventListByType(c,function(b){a.events=b},function(a){})},function(a){})},a.init=function(){a.getAdhocEventList()},a.init(),a.onAdhocPostpone=function(){i.showSpinner=!0;var d={};d.apptDate=a.postponeAdhocObj.apptDate,d.oldAppointmentId=c,d.apptStartTime=g("date")(a.postponeAdhocObj.startTime,"HH:mm:ss"),d.apptEndTime=g("date")(a.postponeAdhocObj.endTime,"HH:mm:ss"),d.slotId=a.availabilities[0].id,h.postponeAdhocAppointment(d,function(a){i.showSpinner=!1,j("success",a.successMessage),localStorage.setItem("isPostpond","false"),m.cancel(),b.reload()},function(a){i.showSpinner=!1})}}function A(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString(),e=c.split(""),f=d.split("");return b+"-"+(e[1]?c:"0"+e[0])+"-"+(f[1]?d:"0"+f[0])}function B(a,b,c,e,f,g){console.log(angular.fromJson(c)),a.prescriptionList=c,a.cancel=function(){b.cancel()},a.viewPrescriptionCall=function(a){var c="PRESCRIPTION_REFERENCE_FORM",e=d;b.cancel(),g.loadNewFormRunner(a.id,c,a.organizationLocation.id,1,e,null,0,null)}}y.$inject=["$scope","$mdDialog","calendarDayEventId","calendarRequestData","eventDate","eventException"],z.$inject=["$scope","oldAppointmentId","eventId","userId","slotId","commonCalendarService","$rootScope","notify","manageCalendarEventService","dateconvertor","$mdDialog"],B.$inject=["$scope","$mdDialog","prescriptionList","$filter","baseService","orbeonFormRunner"],a.calendarMasterObject={},a.calendarMaster={},a.slotTime=15,a.events=[],a.selectedEntityId=0,a.calendarMasterId=0,a.workingTimes=[{}],a.holidayArray=[],a.nonWorkingArray=[],a.calendarObjectData={},a.searchCriteria={},a.searchCriteria.orgLocation={},sessionStorage.setItem("isPostpond",!1),sessionStorage.setItem("oldAppointmentId",null),q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek",a.menuVisible=!1,localStorage.setItem("isCheckedIn","false"),localStorage.setItem("isPopupOpen","false"),a.getCalendarData=function(b){a.calendarMasterObject.calendarId=a.calendarObjectData.id,a.calendarMasterObject.organizationLocationId=a.calendarObjectData.organizationLocationId,a.calendarMasterObject.entityId=a.calendarObjectData.entityId,b?(a.defaultRequestCall=!1,a.calendarMasterObject.startDate=b.start._d,a.calendarMasterObject.endDate=b.end._d,"agendaDay"==b.type&&(a.calendarMasterObject.endDate=b.start._d)):(a.defaultRequestCall=!0,a.calendarMasterObject.startDate=new Date,a.calendarMasterObject.endDate=new Date);var e="",f="";if(b)if("month"==b.type){var h=b.title.indexOf(" ");e=b.title.substring(0,h),f=b.title.substring(h+1)}else{var j=new Date;e=g("date")(c.dateFormatter(j),"MMMM"),f=g("date")(c.dateFormatter(j),"yyyy")}else{var j=new Date;e=g("date")(c.dateFormatter(j),"MMMM"),f=g("date")(c.dateFormatter(j),"yyyy")}a.calendarMasterObject.entityId=a.calendarObjectData.entityId,a.calendarMasterObject.entityType=a.calendarObjectData.entityType,q.mobilecheck()?a.defaultView="agendaDay":a.defaultView="agendaWeek",r.showSpinner=!0,c.getCalendarData(a.calendarMasterObject,d.type,function(d){function h(b,d){var e=g("date")(c.dateFormatter(Date.parse(b+" 1,"+d)),"yyyy-MM-dd");e=new Date(e);for(var f=e.getMonth();e.getMonth()===f;){var h=g("date")(c.dateFormatter(new Date(e)),"yyyy-MM-dd");g("date")(c.dateFormatter(h),"dd");angular.isUndefined(a.holidayArray)||null==a.holidayArray||a.holidayArray.indexOf(h)!=-1&&($('*[data-date="'+h+'"].fc-day-number').addClass("holidayText"),$('td[data-date="'+h+'"]').css("background-color","#ececec")),angular.isUndefined(a.nonWorkingArray)||null==a.nonWorkingArray||a.nonWorkingArray.indexOf(h)!=-1&&$('td[data-date="'+h+'"]').css("background-color","#ececec"),e.setDate(e.getDate()+1)}}a.calendarMasterId=d.id,a.calendarMaster=d,a.scrollTime||(a.scrollTime=a.calendarMaster.eventTime),a.showObject={},a.showObject.orgLocId=d.organizationLocationId,a.showObject.entityType=d.entityType.value,a.showObject.entityTypeCode=d.entityType.code,a.showObject.entityName=d.entityName,a.showObject.calendarName=d.name,a.showObject.calendarOrg=d.organizationLocationName,d.slotSize&&(a.slotTime=d.slotSize),a.holidayArray=d.holidays,a.nonWorkingArray=d.nonWorkingDays,a.newEvents=[];if(h(e,f),angular.forEach(o.objIterator(a.calendarMaster.events),function(c,d){angular.forEach(c.dates,function(d,e){var f={};f.id=c.id,f.eventType=c.eventType,f.calendarId=c.calendarId,f.eventDate=c.eventDate;var h=new Date;h.setHours(c.eventStartTime.substring(0,2)),h.setMinutes(c.eventStartTime.substring(3,5));var i=new Date;i.setHours(c.eventEndTime.substring(0,2)),i.setMinutes(c.eventEndTime.substring(3,5));g("date")(h,"hh:mm a"),g("date")(i,"hh:mm a");f.start=d+" "+c.eventStartTime,f.end=d+" "+c.eventEndTime,b&&(f.viewType=b.type),f.exception=c.exception,f.eventStartTime=c.eventStartTime,f.eventEndTime=c.eventEndTime,f.eventException=c.eventException,f.eventSlots=c.eventSlots,f.eventId=c.id,f.appointmentType=c.appointmentType,f.slotSize=c.slotSize,f.offDay=c.offDay,f.eventName=c.title,f.entityType=a.calendarMaster.entityType,f.entityName=a.calendarMaster.entityName,f.entityId=a.calendarMaster.entityId,f.slotId=c.slotId,f.eventExceptionId=c.eventExceptionId,f.organizationLocationId=a.calendarMaster.organizationLocationId,f.organizationLocationName=a.calendarMaster.organizationLocationName,c.capacity&&(f.capacity=c.capacity),a.newEvents.push(f)})}),a.calendarMaster.events=a.newEvents,angular.forEach(a.calendarMaster.businessHours,function(b,c){angular.forEach(b.timeSlots,function(c,d){c.start=b.date+" "+c.start,c.end=b.date+" "+c.end,c.rendering="background",c.eventBackgroundColor="rgb(255,0,0)",a.calendarMaster.events.push(c)})}),a.uiConfig={calendar:{height:500,editable:!1,contentHeight:500,slotDuration:"00:"+a.slotTime+":00",customButtons:{myCustomButton:{text:"Define event",click:a.createEvent},myButton:{text:"Day Availability",click:a.showAvailability}},axisFormat:"hh:mm A",header:{left:"prev,next today",center:"title",right:"myButton,myCustomButton,month,agendaDay,agendaWeek"},buttonText:{today:"Today",month:"Month",week:"Week",day:"Day"},events:a.events,fixedWeekCount:!1,defaultView:a.defaultView,businessHours:{},eventLimit:!0,nowIndicator:!0,scrollTime:a.scrollTime,displayEventTime:!0,viewRender:a.viewRender,eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,eventRender:a.eventRender,dayClick:a.dayClick,eventClick:a.eventClick,slotEventOverlap:a.slotEventOverlap,dayRender:a.dayRender,eventAfterAllRender:a.eventAfterAllRender,viewDestroy:a.viewDestroy,columnHeaderFormat:"ddd DD/MMM",firstDay:(new Date).getDay()}},a.setCalendarData(f,e),r.showSpinner=!1,angular.fromJson(sessionStorage.getItem("isPostpond"))&&!a.defaultRequestCall&&!a.isPostponePopupShown){a.isPostponePopupShown=!0;var j=i.confirm().title(m.instant("POSTPONE_APPOINTMENT")).textContent(m.instant("SELECT_SLOT_TO_POSTPONT")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(j).then(function(){i.hide()},function(){q.goBackToPrevState()})}},function(a){r.showSpinner=!1}),0==a.loggedInUser.isOrganizationUserMode&&$(".fc-myCustomButton-button").hide()},a.showAvailability=function(){i.show({controller:"ShowCalendarAvailabilityCtrl",templateUrl:"app/modules/fullCalendar/views/working-day.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{calendarMasterId:a.calendarMasterObject.calendarId,entityId:a.calendarMasterObject.entityId,calendarRequestData:a.calendarObjectData,parentScope:a}}).then(function(){a.WSHealthProfessionalsValues={}},function(c){a.WSHealthProfessionalsValues={},c&&b.reload()})},a.$on("$destroy",function(){localStorage.getItem("viewCalendarFilterValues")&&localStorage.removeItem("viewCalendarFilterValues"),sessionStorage.getItem("samePageCall")&&sessionStorage.removeItem("samePageCall")}),a.init=function(){if(a.searchCriteria.entityName={},q.isNullOrEmpty(d.data)||localStorage.setItem("cmi",angular.toJson(d.data)),1==angular.fromJson(sessionStorage.getItem("samePageCall"))){if(localStorage.getItem("viewCalendarFilterValues")){var b=angular.fromJson(localStorage.getItem("viewCalendarFilterValues"));a.searchCriteria.orgLocation=b.orgLocation,a.searchCriteria.entityType=b.entityType,a.searchCriteria.entityName=b.entityName}}else q.isNullOrEmpty(angular.fromJson(sessionStorage.getItem("samePageCall")))?d.data=angular.fromJson(localStorage.getItem("cmi")):d.data=angular.fromJson(localStorage.getItem("cmi"));a.loggedInUser=p.getLoggedInUser(),a.individualFeaturePrivileges=s.getIndividualFeaturePrivileges(),a.locationConsolidatedPrivileges=s.getLocationConsolidatedPrivileges(),a.locationFeaturePrivileges=s.getLocationFeaturePrivileges(),d.data?(localStorage.setItem("cmi",angular.toJson(d.data)),a.calendarObjectData=d.data,d.data.slotId&&"true"==localStorage.getItem("isPostpond")&&(a.isPostpond=!0,sessionStorage.setItem("isPostpond",!0))):(a.trialCalendarObjectData=localStorage.getItem("cmi"),a.calendarObjectData=angular.fromJson(a.trialCalendarObjectData),d.data=angular.copy(a.calendarObjectData)),d.data&&!localStorage.getItem("viewCalendarFilterValues")&&(q.isFieldEmpty(d.data.organizationLocation)?q.isFieldEmpty(d.data.orgLocation)||(a.searchCriteria.orgLocation=d.data.orgLocation.id):a.searchCriteria.orgLocation=d.data.organizationLocation,q.isFieldEmpty(d.data.entityType)||(a.searchCriteria.entityType=d.data.entityType),q.isFieldEmpty(d.data.entityId)||(a.searchCriteria.entityName.id=d.data.entityId,a.searchCriteria.entityName.value=d.data.entityName)),a.getCalendarData()},a.createEvent=function(){b.go("manageEventCalendar",{type:"add",calendarData:a.calendarMaster,calendarState:d,callingPage:"usercalendarview"})},a.init(),a.changeTo="Hungarian",/* event source that pulls from google.com */
a.eventSource={className:"gcal-event",// an option!
currentTimezone:"America/Chicago"},a.customFullscreen=j("xs")||j("sm"),a.dayClick=function(b,c,e){if("exception"!=d.type){(j("sm")||j("xs"))&&a.customFullscreen}},a.eventClick=function(e,f){if(1==e.exception){(j("sm")||j("xs"))&&a.customFullscreen;i.show({controller:y,templateUrl:"app/modules/fullCalendar/views/exception-approval.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{calendarDayEventId:e.id,calendarRequestData:a.calendarMasterObject,eventDate:e.eventDate,eventException:e.exception}}).then(function(a){},function(){a.WSHealthProfessionalsValues={}})}else{var h=m.instant("LIST_APPOINTMENTS"),k=m.instant("EDIT_EVENT"),n=m.instant("DEFINE_EVENT_EXCEPTION"),o=m.instant("FIX_APPOINTMENT"),s=m.instant("CANCEL_APPOINTMENTS"),u=m.instant("POSTPONE_APPOINTMENT"),v=m.instant("REGISTER_WALKIN"),w=m.instant("SHOW_STATUS"),x=m.instant("CHECK_IN"),z=m.instant("CHECK_OUT"),B=m.instant("VIEW_APPOINTMENT"),C=m.instant("MAP_DISEASE"),D=m.instant("UPLOAD_DOWNLOAD"),E=m.instant("DIAGNOSTIC_TESTS"),F=m.instant("PATIENT_ACTIVITY"),G=m.instant("CONSULTATION_START"),H=m.instant("CONSULTATION_FINISH"),I=m.instant("RECORD_DIAGNOSIS"),J=m.instant("MAKE_A_PRESCRIIPTION"),K=m.instant("VIEW_TREATMENT_HISTORY"),L=m.instant("VIEW_PRESCRIPTION");if(d.data&&!angular.fromJson(sessionStorage.getItem("isPostpond")))if(1==a.menuVisible)$(".event-menu-list").remove(),a.menuVisible=!1;else if(444==f.target.id){var M=!1;if(angular.forEach(e.eventSlots,function(a){0==M&&a.appointmentSlots&&(M=!0)}),1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){var N=(Math.floor(501*Math.random()),$("#calendar").offset()),O=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),P=f.pageX-N.left+O,Q=f.pageY-N.top+$(".calendarDetailsRow").height(),R=null;e.eventSlots&&(R=e.eventSlots[0].slotDate);var S="<div class='event-menu-list'><ul>";S=S+"<li class='calendar-event-menu-title-style'><div>"+e.eventName+"</div></li><li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+R+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='listAppointmentMenu'>"+h+" </div></li>";var T=new Date,U=R.split("-"),V=e.eventEndTime.split(":"),W=parseInt(U[1])-1,X=W.toString(),Y=new Date(U[0],X,U[2],V[0],V[1],V[2]);Y.getTime()>=T.getTime()&&(t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"calendar_event_edit",a.showObject.orgLocId)&&(/*Edit event menu*/
S=S+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+R+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='editEventMenu'>"+k+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"event_excpetions",a.showObject.orgLocId)&&(/*Event exception menu*/
S=S+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+R+"' data-eventExceptionId='"+e.eventExceptionId+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='eventExceptionMenu'>"+n+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_add",a.showObject.orgLocId)&&"FCFS"!=e.appointmentType&&(/*fix appointment menu*/
S=S+"<li><div data-eventId='"+e.eventId+"' data-eventDate='"+R+"' data-entityName='"+e.entityName+"' data-eventExceptionId='"+e.eventExceptionId+"' data-eventStartTime='"+e.eventStartTime+"' data-eventEndTime='"+e.eventEndTime+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='fixAppointmentMenu'>"+o+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_cancel",a.showObject.orgLocId)&&1==M&&(/*Cancel Appointment menu*/
S=S+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+R+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='cancelAppointmentMenu'>"+s+"</div></li>"),t.calendarLocationBaseMenuValidator(a.locationFeaturePrivileges,"appointment_postpone",a.showObject.orgLocId)&&Y.getDate()==T.getDate()&&Y.getMonth()==T.getMonth()&&Y.getYear()==T.getYear()&&1==M&&(/*Postpone appointment menu*/
S=S+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+R+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='postpondAppointmentMenu' >"+u+"</div></li>"));var Z=g("date")(R,"yyyy-MM-dd"),_=g("date")(new Date,"yyyy-MM-dd");1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode&&Z==_&&(S=S+"<li><div data-eventId='"+e.eventId+"' data-eventDate='"+R+"' class='calendar-event-menu-style' id='showStatusMenu'>"+w+"</div></li>",a.locationConsolidatedPrivileges.indexOf("appointment_walk_in")!=-1&&(S=S+"<li><div data-entityName='"+e.entityName+"' data-eventId='"+e.eventId+"' data-eventDate='"+R+"' data-eventName='"+e.eventName+"' data-eventStartTime='"+e.eventStartTime+"' class='calendar-event-menu-style' id='registerWalkinMenu'>"+v+"</div></li>")),S+="</ul></div>",S.indexOf("</li>")!=-1&&($newdiv=$(S).css({left:P+"px",top:Q+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}}else{var T=new Date,U=f.target.dataset.appointmentdate.split("-"),V=f.target.dataset.appointmentendtime.split(":"),W=parseInt(U[1])-1,X=W.toString(),Y=new Date(U[0],X,U[2],V[0],V[1],V[2]),aa=!1;/*if (appDate.getTime() >= currentDate.getTime()) {*/
if("FCFS"!=f.target.dataset.appointmenttype&&0==aa){var N=(Math.floor(501*Math.random()),$("#calendar").offset()),O="",P="",Q="";q.mobilecheck()?(O=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),P=f.pageX-N.left+O-100,Q=f.pageY-N.top+155):(O=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),P=f.pageX-N.left+O,Q=f.pageY-N.top+$(".calendarDetailsRow").height());var ba="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode)if("null"!=f.target.dataset.appointmentid){var _=A(new Date);"CHECKED_OUT"!=f.target.dataset.appointmentstatus&&"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus&&"FORWARDED"!=f.target.dataset.appointmentstatus&&(/* cancel appointment menu */
ba=ba+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+s+"</div></li>",/* postpont appointment menu*/
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"),f.target.dataset.appointmentdate==_&&(/*Show status menu*/
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'>"+w+"</div></li>","NEW"!=f.target.dataset.appointmentstatus&&"POSTPONED"!=f.target.dataset.appointmentstatus||(/* Check in menu */
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"'   data-orglocid='"+e.organizationLocationId+"' class='calendar-event-menu-style' id='checkInRMenu'>"+x+"</div></li>"),"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus||(/* Checkout Menu */
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"'   data-orglocid='"+e.organizationLocationId+"' class='calendar-event-menu-style' id='checkOutRMenu'>"+z+"</div></li>"),ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='otherOptionRMenu'>"+C+"</div></li>","CHECKED_IN"==f.target.dataset.appointmentstatus&&(ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='issueTokenRMenu'>"+issueTokenLable+"</div></li>"),"ISSUE_TOKEN"==f.target.dataset.appointmentstatus&&(ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' class='calendar-event-menu-style' id='consultationStartRMenu'>"+G+"</div></li>"),"CONSULTATION_STARTED"==f.target.dataset.appointmentstatus&&(ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='consultationFinishRMenu'>"+H+"</div></li>"),"CONSULTATION_STARTED"==f.target.dataset.appointmentstatus&&(ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentuserid='"+f.target.dataset.appointmentuserid+"'  data-orglocid='"+e.organizationLocationId+"' class='calendar-event-menu-style' id='makePrescriptionRMenu'>"+J+"</div></li>")),ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='viewAppointmentRMenu'>"+B+"</div></li>",ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='uploadDownloadRMenu'>"+D+"</div></li>",ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentuserid='"+f.target.dataset.appointmentuserid+"' data-patientName='"+f.target.dataset.patientname+"' class='calendar-event-menu-style' id='diagnosticTestRMenu'>"+E+"</div></li>",ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='viewPatientActivityRMenu'>"+F+"</div></li>","CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CHECKED_OUT"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus||(ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='recordDiagnosisRMenu'>"+I+"</div></li>"),ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentuserid='"+f.target.dataset.appointmentuserid+"' data-patientName='"+f.target.dataset.patientname+"' data-orglocid='"+e.organizationLocationId+"' data-orglocname='"+e.organizationLocationName+"' class='calendar-event-menu-style' id='viewTreatmentHistoryRMenu'>"+K+"</div></li>",ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='viewPrescriptionRMenu'>"+L+"</div></li>"}else Y.getTime()>=T.getTime()&&(ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-eventExceptionId='"+e.eventExceptionId+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");else if("null"!=f.target.dataset.appointmentid){if("null"!=f.target.dataset.appointmentuserid&&f.target.dataset.appointmentuserid==angular.fromJson(p.getLoggedInUser()).id){var _=A(new Date);/* cancel appointment menu */
"ADHOC"!=f.target.dataset.appointmenttype&&"CHECKED_OUT"!=f.target.dataset.appointmentstatus&&"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus&&(ba=ba+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+s+"</div></li>",/* postpont appointment menu*/
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"),f.target.dataset.appointmentdate==_&&(/*Show status menu*/
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'>"+w+"</div></li>","CAL_EVENT_ONLINE"!=e.eventType.code||"NEW"!=f.target.dataset.appointmentstatus&&"POSTPONED"!=f.target.dataset.appointmentstatus||(/* Check in menu */
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"'   data-orglocid='"+e.organizationLocationId+"' class='calendar-event-menu-style' id='checkInRMenu'>"+x+"</div></li>"),"CAL_EVENT_ONLINE"!=e.eventType.code||"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus||(/* Checkout Menu */
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"'   data-orglocid='"+e.organizationLocationId+"' class='calendar-event-menu-style' id='checkOutRMenu'>"+z+"</div></li>")),ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='viewAppointmentRMenu'>"+B+"</div></li>",ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='uploadDownloadRMenu'>"+D+"</div></li>"}}else"ADHOC"!=f.target.dataset.appointmenttype&&Y.getTime()>=T.getTime()&&(ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-eventExceptionId='"+e.eventExceptionId+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");ba+="</ul></div>",ba.indexOf("</li>")!=-1&&($newdiv=$(ba).css({left:P+"px",top:Q+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}}else{var N=(Math.floor(501*Math.random()),$("#calendar").offset()),O="",P="",Q="",T=new Date,R=null,U=null,V=null,W=null,X=null,Y=null;e.eventSlots&&(R=e.eventSlots[0].slotDate),R&&(U=R.split("-")),e.eventEndTime&&(V=e.eventEndTime.split(":")),U&&(W=parseInt(U[1])-1),X&&(X=W.toString()),U&&X&&V&&(Y=new Date(U[0],X,U[2],V[0],V[1],V[2])),q.mobilecheck()?(O=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),P=f.pageX-N.left+O-100,Q=f.pageY-N.top+155):(O=2*parseInt($(".calendarWell").css("padding-right").substring(0,2)),P=f.pageX-N.left+O,Q=f.pageY-N.top+$(".calendarDetailsRow").height());var ba="<div class='event-menu-list'><ul>";if(1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode){if(sessionStorage.getItem("oldAppointmentId")){r.showSpinner=!0;var ca={};ca.apptDate=e.eventSlots[0].slotDate,!f.target.dataset.slotid&&f.target.firstElementChild&&f.target.firstElementChild.dataset?ca.slotId=f.target.firstElementChild.dataset.slotid:f.target.dataset&&f.target.dataset.slotid&&(ca.slotId=f.target.dataset.slotid),ca.oldAppointmentId=sessionStorage.getItem("oldAppointmentId"),ca.eventId=e.eventId,ca.slotId?c.postpondRegularAppointment(ca,function(a){r.showSpinner=!1,l("success",a.successMessage),localStorage.setItem("isPostpond","false"),b.reload()},function(a){r.showSpinner=!1}):r.showSpinner=!1}else if("null"!=f.target.dataset.appointmentid)if("null"==f.target.dataset.appointmentuserid||f.target.dataset.appointmentuserid!=angular.fromJson(p.getLoggedInUser()).id&&1!=angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode)("ADHOC"==f.target.dataset.appointmenttype&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode||"ADHOC"!=f.target.dataset.appointmenttype)&&Y.getTime()>=T.getTime()&&(ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-eventExceptionId='"+e.eventExceptionId+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");else{var _=A(new Date);"CHECKED_OUT"!=f.target.dataset.appointmentstatus&&"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus&&(/* cancel appointment menu */
ba=ba+"<li><div data-slotId='"+f.target.dataset.slotid+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"'  data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-entityName='"+e.entityName+"' data-entityTypeId='"+e.entityType.id+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventId='"+e.eventId+"'  data-eventTypeId='"+e.eventType.id+"' data-eventTypeName='"+e.eventType.value+"' data-eventName='"+e.eventName+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-entityId='"+e.entityId+"'  data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='cancelAppointmentRMenu'>"+s+"</div></li>",/* postpont appointment menu*/
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventTypeId+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-entityId='"+e.entityId+"' class='calendar-event-menu-style' id='postpondAppointmentRMenu'>"+u+"</div></li>"),f.target.dataset.appointmentdate==_&&(/*Show status menu*/
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' class='calendar-event-menu-style' id='showStatusRMenu'>"+w+"</div></li>","CAL_EVENT_ONLINE"!=e.eventType.code||"NEW"!=f.target.dataset.appointmentstatus&&"POSTPONED"!=f.target.dataset.appointmentstatus||(/* Check in menu */
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"'  data-orglocid='"+e.organizationLocationId+"' class='calendar-event-menu-style' id='checkInRMenu'>"+x+"</div></li>"),"CAL_EVENT_ONLINE"!=e.eventType.code||"CONSULTATION_STARTED"!=f.target.dataset.appointmentstatus&&"CONSULTATION_COMPLETED"!=f.target.dataset.appointmentstatus||(/* Checkout Menu */
ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"'   data-orglocid='"+e.organizationLocationId+"' class='calendar-event-menu-style' id='checkOutRMenu'>"+z+"</div></li>")),ba=ba+"<li><div data-appointmentId='"+f.target.dataset.appointmentid+"' class='calendar-event-menu-style' id='viewPrescriptionRMenu'>"+L+"</div></li>"}else("ADHOC"==f.target.dataset.appointmenttype&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUser&&1==angular.fromJson(p.getLoggedInUser()).isOrganizationUserMode||"ADHOC"!=f.target.dataset.appointmenttype)&&Y.getTime()>=T.getTime()&&(ba=ba+"<li><div data-appointmentEndTime='"+f.target.dataset.appointmentendtime+"' data-appointmentTime='"+f.target.dataset.appointmenttime+"' data-appointmentDate='"+f.target.dataset.appointmentdate+"' data-entityTypeName='"+e.entityType.value+"' data-eventTypeName='"+e.eventType.value+"' data-entityTypeCode='"+e.entityType.code+"' data-entityTypeId='"+e.entityType.id+"' data-eventTypeId='"+e.eventType.id+"' data-eventId='"+e.eventId+"' data-eventName='"+e.eventName+"' data-entityName='"+e.entityName+"' data-entityId='"+e.entityId+"' data-slotId='"+f.target.dataset.slotid+"' data-appointmentId='"+f.target.dataset.appointmentid+"' data-appointmentType='"+f.target.dataset.appointmenttype+"' data-eventExceptionId='"+e.eventExceptionId+"' class='calendar-event-menu-style' id='fixAppointmentRMenu'>"+o+"</div></li>");ba+="</ul></div>",ba.indexOf("</li>")!=-1&&($newdiv=$(ba).css({left:P+"px",top:Q+"px"}),$newdiv.appendTo("#calendar").delay(1).fadeIn(100,function(){}),a.menuVisible=!0)}else{r.showSpinner=!0;var ca={};ca.apptDate=e.eventSlots[0].slotDate,f.target.firstElementChild&&f.target.firstElementChild.dataset&&f.target.firstElementChild.dataset.slotid?ca.slotId=f.target.firstElementChild.dataset.slotid:f.target.dataset&&f.target.dataset.slotid&&(ca.slotId=f.target.dataset.slotid),angular.fromJson(sessionStorage.getItem("oldAppointmentId"))?ca.oldAppointmentId=sessionStorage.getItem("oldAppointmentId"):d.data.appointmentId&&(ca.oldAppointmentId=d.data.appointmentId),ca.eventId=e.eventId,ca.oldAppointmentId&&ca.slotId?c.postpondRegularAppointment(ca,function(a){l("success",a.successMessage),localStorage.setItem("isPostpond","false"),r.showSpinner=!1,b.reload()},function(a){r.showSpinner=!1}):r.showSpinner=!1,r.showSpinner=!1}}}},a.slotEventOverlap=function(){return a.calendarObject.slotEventOverlap},/* add and removes an event source of choice */
a.addRemoveEventSource=function(a,b){var c=0;angular.forEach(a,function(d,e){a[e]===b&&(a.splice(e,1),c=1)}),0===c&&a.push(b)},/* Change View */
a.changeView=function(a,b){h.calendars[b].fullCalendar("changeView",a)},/* Change View */
a.renderCalender=function(a){f(function(){h.calendars[a]})},$(".container").click(function(e,f){if(e&&"usercalendarview"==b.current.name){if(444!=e.target.id&&1111!=e.target.id)if("fixAppointmentMenu"==e.target.id)b.go("manageFixAppointment",{type:"add",eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.eventdate,eventExceptionId:e.target.dataset.eventexceptionid,apptStartTime:e.target.dataset.eventstarttime,apptEndTime:e.target.dataset.eventendtime});else if("editEventMenu"==e.target.id)e.target.dataset.eventid&&b.go("manageEventCalendar",{type:"edit",eventId:e.target.dataset.eventid});else if("cancelAppointmentMenu"==e.target.id)b.go("cancelAppointmentList",{type:"cancel",eventId:e.target.dataset.eventid,date:e.target.dataset.eventdate});else if("postpondAppointmentMenu"==e.target.id)b.go("postponeAppointmentList",{type:"postpone",eventId:e.target.dataset.eventid});else if("listAppointmentMenu"==e.target.id)b.go("appointmentsList",{event:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.eventdate,entityName:e.target.dataset.entityname,loadFilter:!1});else if("showStatusMenu"==e.target.id)e.target.dataset.eventid&&e.target.dataset.eventdate&&b.go("userAppointmentStatus",{eventId:e.target.dataset.eventid,eventDate:e.target.dataset.eventdate,calendarState:d,callingPage:"usercalendarview"});else if("registerWalkinMenu"==e.target.id)b.go("manageAppointmentWalkIn",{eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptStartTime:e.target.dataset.eventstarttime,apptDate:e.target.dataset.eventdate,appointmentType:"RECORDWALKIN",urlState:"manageAppointmentWalkIn",calendarState:d,callingPage:"usercalendarview"});else if("eventExceptionMenu"==e.target.id)e.target.dataset.eventid&&"null"!=e.target.dataset.eventexceptionid?b.go("manageEventCalendarException",{type:"edit",eventId:e.target.dataset.eventid,eventExceptionId:e.target.dataset.eventexceptionid,calendarState:d,callingPage:"usercalendarview"}):e.target.dataset.eventid&&b.go("manageEventCalendarException",{type:"add",eventId:e.target.dataset.eventid,calendarState:d,callingPage:"usercalendarview"});else if("cancelAppointmentRMenu"==e.target.id){if(e.target.dataset.appointmentid&&"null"!=e.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")){var g={};if(sessionStorage.setItem("oldAppointmentId",null),g.apptDate=e.target.dataset.appointmentdate,$(".event-menu-list").remove(),a.menuVisible=!1,"true"!=localStorage.getItem("isPopupOpen")){localStorage.setItem("isPopupOpen","true");var h=i.confirm().title(m.instant("APPOINTMENT_CANCELATION_TITLE")).textContent(m.instant("APPOINTMENT_CANCELATION_MSG")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(h).then(function(){localStorage.setItem("isPopupOpen","false"),g.appointmentIds=[e.target.dataset.appointmentid],e.target.dataset.appointmentid=null,c.cancelAppointment(g,function(a){l("success",a.successMessage),b.reload()},function(a){})},function(){localStorage.setItem("isPopupOpen","false")})}}}else if("postpondAppointmentRMenu"==e.target.id){if("true"!=localStorage.getItem("isPopupOpen"))if(localStorage.setItem("isPopupOpen","true"),"ADHOC"==e.target.dataset.appointmenttype)$(".event-menu-list").remove(),a.menuVisible=!1,i.show({controller:z,templateUrl:"app/modules/appointment/views/postpone-adhoc-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{oldAppointmentId:e.target.dataset.appointmentid,eventId:e.target.dataset.eventid,userId:p.getLoggedInUser().id,slotId:e.target.dataset.slotid}}).then(function(b){a.WSHealthProfessionalsValues={},localStorage.setItem("isPopupOpen","false")},function(){a.WSHealthProfessionalsValues={},localStorage.setItem("isPopupOpen","false")});else{a.oldAppointmentId=null,sessionStorage.setItem("oldAppointmentId",null),sessionStorage.setItem("isPostpond",!0),a.isPostpond=!0,$(".event-menu-list").remove(),a.menuVisible=!1;var h=i.confirm().title(m.instant("POSTPONE_APPOINTMENT")).textContent(m.instant("SELECT_SLOT_TO_POSTPONT")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(h).then(function(){i.hide(),localStorage.setItem("isPopupOpen","false")},function(){i.hide(),localStorage.setItem("isPopupOpen","false"),sessionStorage.setItem("isPostpond",!1),a.isPostpond=!1}),sessionStorage.setItem("oldAppointmentId",e.target.dataset.appointmentid),a.oldAppointmentId=e.target.dataset.appointmentid}}else if("showStatusRMenu"==e.target.id)e.target.dataset.appointmentid&&b.go("userAppointmentStatus",{appoinmentId:e.target.dataset.appointmentid});else if("issueTokenRMenu"==e.target.id)e.target.dataset.appointmentid&&a.manageIssueToken(e.target.dataset.appointmentid);else if("viewTreatmentHistoryRMenu"==e.target.id){if(e.target.dataset.appointmentuserid&&e.target.dataset.patientname&&e.target.dataset.orglocid&&e.target.dataset.orglocname){var j={patientId:e.target.dataset.appointmentuserid,organizationLocationId:e.target.dataset.orglocid,patientName:e.target.dataset.patientname,locationName:e.target.dataset.orglocname};a.viewTreatmentHistory(j)}}else if("viewPrescriptionRMenu"==e.target.id){if(e.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")){localStorage.setItem("isPopupOpen","true"),$(".event-menu-list").remove(),a.menuVisible=!1;var j={id:e.target.dataset.appointmentid};a.viewPrescription(j)}}else if("consultationFinishRMenu"==e.target.id)e.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),a.manageConsultationFinished({id:e.target.dataset.appointmentid}));else if("diagnosticTestRMenu"==e.target.id){if(e.target.dataset.appointmentuserid&&e.target.dataset.patientname){var k={patientName:e.target.dataset.patientname,patientId:e.target.dataset.appointmentuserid};a.showDiagnosticTests(k)}}else if("consultationStartRMenu"==e.target.id){if(e.target.dataset.appointmentid&&e.target.dataset.appointmentdate&&e.target.dataset.eventid&&e.target.dataset.eventname&&"true"!=localStorage.getItem("isPopupOpen")){localStorage.setItem("isPopupOpen","true");var j={id:e.target.dataset.appointmentid,event:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate};a.manageConsultationStarted(j)}}else if("viewPatientActivityRMenu"==e.target.id){if(e.target.dataset.appointmentid){var n={id:e.target.dataset.appointmentid};a.viewPatientActivity(n)}}else if("recordDiagnosisRMenu"==e.target.id){if(e.target.dataset.appointmentid){var n={id:e.target.dataset.appointmentid};a.recordDiagnosis(n)}}else if("makePrescriptionRMenu"==e.target.id)e.target.dataset.appointmentid&&e.target.dataset.appointmentuserid&&e.target.dataset.orglocid&&"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),$(".event-menu-list").remove(),a.menuVisible=!1,a.makePrescription(e,e.target.dataset.orglocid,e.target.dataset.appointmentuserid,null,e.target.dataset.appointmentid));else if("uploadDownloadRMenu"==e.target.id){if(e.target.dataset.appointmentid){var o={id:e.target.dataset.appointmentid};a.goToUploadDownload(o)}}else if("otherOptionRMenu"==e.target.id){if(e.target.dataset.appointmentid&&"true"!=localStorage.getItem("isPopupOpen")){localStorage.setItem("isPopupOpen","true");var q={id:e.target.dataset.appointmentid};$(".event-menu-list").remove(),a.menuVisible=!1,i.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{recordDetails:q,isCurrentDate:a.isCurrentDate,baseService:p,mode:null}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})}}else if("issueTokenRMenu"==e.target.id)a.manageIssueToken(e.target.dataset.appointmentid);else if("viewAppointmentRMenu"==e.target.id)b.go("manageFixAppointment",{type:"view",appointmentId:e.target.dataset.appointmentid});else if("checkInRMenu"==e.target.id){if(e.target.dataset.appointmentid)if("Online Appointment"==e.target.dataset.eventtypename){var r={};r.relatedtoCalendarEvent=e.target.dataset.eventid,r.appointmentId=e.target.dataset.appointmentid,"false"==localStorage.getItem("isCheckedIn")&&(localStorage.setItem("isCheckedIn","true"),c.getConversationIdForAppointment(r,function(a){b.go("skypeHome",{userId:angular.fromJson(p.getLoggedInUser()).id,convId:a.response.convId,convType:"APPOINTMENT",userName:angular.fromJson(p.getLoggedInUser()).displayName})},function(a){}))}else{var s={appointmentType:"CHECKEDIN"};e.target.dataset.appointmentid&&(s.appointmentId=e.target.dataset.appointmentid),s.urlState="manageAppointmentCheckIn",s.entityType={id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypename,code:e.target.dataset.entitytypecode},s.entityName={id:e.target.dataset.entityid,value:e.target.dataset.entityname},s.eventType={id:e.target.dataset.eventtypeid,value:e.target.dataset.eventtypename},s.eventName={id:e.target.dataset.eventid,value:e.target.dataset.eventname},s.appDate=e.target.dataset.appointmentdate,e.target.dataset.orglocid&&(s.orgLocation=e.target.dataset.orglocid),b.go(s.urlState,s)}}else if("checkOutRMenu"==e.target.id){if(e.target.dataset.appointmentid){var t=null;e.target.dataset.orglocid&&(t=e.target.dataset.orglocid),b.go("manageAppointmentCheckOut",{appointmentId:e.target.dataset.appointmentid,entityType:{id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypename,code:e.target.dataset.entitytypecode},entityName:{id:e.target.dataset.entityid,value:e.target.dataset.entityname},eventType:{id:e.target.dataset.eventtypeid,value:e.target.dataset.eventtypename},eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate,apptStartTime:e.target.dataset.appointmenttime,apptEndTime:e.target.dataset.appointmentendtime,orgLocation:t})}}else if("fixAppointmentRMenu"==e.target.id){if($(".event-menu-list").remove(),a.menuVisible=!1,e.target.dataset.appointmentid){var u=null;"ADHOC"!=e.target.dataset.appointmenttype&&(u=e.target.dataset.appointmentendtime),"true"!=localStorage.getItem("isPopupOpen")&&(localStorage.setItem("isPopupOpen","true"),i.show({controller:"QuickFixAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/fix-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{fixApptObj:{appointmentEnd:u,type:"add",appointmentId:e.target.dataset.appointmentid,slotId:e.target.dataset.slotid,entityType:{id:e.target.dataset.entitytypeid,value:e.target.dataset.entitytypename,code:e.target.dataset.entitytypecode},entityName:{id:e.target.dataset.entityid,value:e.target.dataset.entityname},eventType:{id:e.target.dataset.eventtypeid,value:e.target.dataset.eventtypename},eventName:{id:e.target.dataset.eventid,value:e.target.dataset.eventname},apptDate:e.target.dataset.appointmentdate,apptStartTime:e.target.dataset.appointmenttime,apptEndTime:u,eventExceptionId:e.target.dataset.eventexceptionid}}}).then(function(a){b.reload()},function(){a.WSHealthProfessionalsValues={}}))}}else $(".event-menu-list").remove(),a.menuVisible=!1}else 1==a.menuVisible&&($(".event-menu-list").remove(),a.menuVisible=!1)}),a.viewRender=function(b,c){b&&a.getCalendarData(b)},a.setCalendarData=function(b,c){var d=new Date;d.setYear(b),d.setMonth(c),h.calendars.myCalendar.fullCalendar("removeEvents"),angular.forEach(a.calendarMaster.events,function(a,b){h.calendars.myCalendar.fullCalendar("renderEvent",a)})},a.filterEvent=function(){h.calendars.myCalendar.fullCalendar("rerenderEvents")},/* Render Tooltip */
a.eventRender=function(b,d,e){c.setEventStyle(d,b,a.slotTime)},a.eventAfterAllRender=function(a){$(".fc-content .fc-time").hide()},/* config object */
a.events=a.calendarMaster.events,/* event sources array*/
a.eventSources=[a.eventSource],a.CalendarPopUpValues={},a.getAppointmentById=function(a,b){a&&w.getAppointmentById(a,function(a){b(a)},function(a){})},a.goToUploadDownload=function(a){w.goToUploadDownload(a)},a.showDiagnosticTests=function(a){var c={};a.patientId&&(c.userName=a.patientName,c.userId=a.patientId,b.go("usertestlist",c))},a.viewPatientActivity=function(a){b.go("patientActivityList",{apptId:a.id})},a.manageIssueToken=function(a){a&&(r.showSpinner=!0,w.manageIssueToken(a,function(a){r.showSpinner=!1,l("success",m.instant("TOKEN_ISSUE_SUCCESS")),b.reload()},function(a){r.showSpinner=!1}))},a.manageConsultationStarted=function(a){a&&(r.showSpinner=!0,w.validateStartConsultation(a,function(c){if(r.showSpinner=!1,""==c.successMessage)w.manageConsultationStarted(a.id,function(a){r.showSpinner=!1,l("success",m.instant("CONSULT_START_SUCCESS")),b.reload()},function(a){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")});else{var d=i.confirm().title(m.instant("CONFIRM_START_CUNSULTATION")).textContent(c.successMessage).ok(m.instant("OK")).cancel(m.instant("CANCEL"));i.show(d).then(function(){r.showSpinner=!0,w.confirmStartConsultation(a,function(a){r.showSpinner=!1,l("success",m.instant("CONSULT_START_SUCCESS")),b.reload()},function(a){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")})},function(){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")})}},function(a){r.showSpinner=!1}))},a.manageConsultationFinished=function(a){a&&a.id&&(r.showSpinner=!0,w.manageConsultationCompleted(a.id,function(a){r.showSpinner=!1,l("success",m.instant("CONSULT_FINISHED_SUCCESS")),b.reload()},function(a){r.showSpinner=!1,localStorage.setItem("isPopupOpen","false")}))},a.recordDiagnosis=function(a){b.go("appointmentnotes",{appointmentId:a.id,type:"edit"})},a.makePrescription1=x.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="usermedication",a.makePrescription1(b,c,d,e,g,f)},a.viewTreatmentHistory=function(a){b.go("patientRecord",{type:"view",id:a.patientId,locationId:a.organizationLocationId,displayName:a.patientName,locationValue:a.locationName})},a.viewPrescription=function(b){w.getPrescriptionByAppId(b.id,function(b){i.show({controller:B,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:p}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){})},/* filter code start */
a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.entityType={queryUrl:"GET_ENTITY_TYPES_EXCEPT_ORG_LOC",queryParameter:{}},a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.getCalendarName=function(){var b={};q.isNullOrEmpty(a.searchCriteria.entityType)||(b.entityTypeId=a.searchCriteria.entityType.id),q.isNullOrEmpty(a.searchCriteria.orgLocation)||(b.organizationLocationId=a.searchCriteria.orgLocation.id),q.isNullOrEmpty(a.searchCriteria.entityName)||(b.entityId=a.searchCriteria.entityName.id),u.postData(v.getUrl("CALENDAR_SMART_SEARCH"),b,function(b){b&&b.data&&(a.calendarNames=b.data)},function(a){errorCallback(a)})},a.$watch("searchCriteria.orgLocation",function(b,c){b&&b.id?(a.locationID=b.id,f(function(){a.getCalendarName()},0)):(a.searchCriteria.eventName={},a.isEventNameDisabled=!0)}),a.$watch("searchCriteria.entityType",function(b,c){b&&b.code?(a.isEquipment=!1,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!1,"CAL_PROCESS"===b.code?(a.isProcess=!0,a.isEquipment=!1,a.entityName={queryUrl:"FIND_ALL_PROCESSESS",queryParameter:{orgLocationId:a.searchCriteria.orgLocation.id}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_EQUIPMENT"===b.code?(a.isEquipment=!0,a.isProcess=!1,a.entityName={queryUrl:"FIND_EQUIPMENT_BY_LOC_ID",queryParameter:{}},a.$broadcast("loadSearchCriteriaEntityName",a.entityName)):"CAL_ORGANIZATION_LOCATION"===b.code?(a.isOrgLocation=!0,a.entityName={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:a.searchCriteria.orgLocation.data.id}}):"CAL_ORGANIZATION_USER"===b.code&&(a.isOrgUser=!0,a.entityName={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{}}),f(function(){a.getCalendarName()},0)):(a.searchCriteria.entityName=null,a.searchCriteria.calendarObj=null,a.searchCriteria.specificProfessional={},a.isEquipment=!0,a.isOrgLocation=!1,a.isOrgUser=!1,a.isProcess=!1,a.isEntityNameDisabled=!0)}),a.$watch("searchCriteria.entityName",function(b,c){b&&b.id?a.entityNameID=b.id:a.searchCriteria.calendarObj=null,f(function(){a.getCalendarName()},0)}),a.filterCalendar=function(){if(!q.isFieldEmpty(a.searchCriteria.orgLocation)){r.showSpinner=!0;var d={calendarId:a.searchCriteria.calendarObj.id,entityTypeCode:a.searchCriteria.entityType.code,entityId:a.searchCriteria.entityName.id};c.getCalendarDetailsById(d,function(c){if(r.showSpinner=!1,c)if(localStorage.setItem("cmi",angular.toJson(c)),q.isNullOrEmpty(a.searchCriteria)||localStorage.setItem("viewCalendarFilterValues",angular.toJson(a.searchCriteria)),"CAL_ORGANIZATION_USER"==a.searchCriteria.entityType.code){sessionStorage.setItem("samePageCall",!0);var d={inherit:!1};b.go(".",{data:c,samePageCall:!0},d)}else"CAL_PROCESS"==a.searchCriteria.entityType.code?(localStorage.removeItem("viewCalendarFilterValues"),b.go("processcalendarview",{type:"regular",data:c})):"CAL_EQUIPMENT"==a.searchCriteria.entityType.code&&(localStorage.removeItem("viewCalendarFilterValues"),b.go("equipmentcalendarview",{type:"regular",data:c}))},function(a){r.showSpinner=!1})}},a.clear=function(){a.searchCriteria={}}}]).directive("mdOption",function(){return{link:function(a,b){a.$on("$destroy",function(){b.detach()})}}}),angular.module("paripal.fullCalendarModule").controller("CreateCalendarCtrl",["$scope","$state","$filter","httpService","urlService","$compile","$timeout","createCalendarService","uiCalendarConfig","$mdDialog","$mdMedia","notify","calendarService","utilService","baseService","dateconvertor","$rootScope","featurePrivilegeConstants","checkPermissionService","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.locationObject={},a.disableAddAvailability=!1,a.minDateForStart=new Date,a.maxDateForStart=null,a.minDateForEnd=new Date,a.requiredValue=!0,a.disableRemoveAvailability=!0,a.selectedEntityType={},a.smartUserVisibility=!0,/*$scope.minDate=new Date($scope.today.getFullYear(),$scope.today.getMonth() - 2,$scope.today.getDate()).toDateString();*/
a.availabilityDetails=[{}],a.calendarObj={},a.CalendarPopUpValues={},a.selectedEntityId=0,a.disableLocationName=!0,a.entityVisiblity=!0,a.locationSelected=!0,a.pageState="add",a.filterCriteria={},a.minDateValidFrom=p.convertToServerDate(new Date),a.getOrganizationList=function(){d.getData(e.getUrl("GET_ORG"),null,function(b){a.organizationList=angular.fromJson(b.data)},function(a){})},a.getOrganizationList(),a.getOrgLocation=function(b){a.requestData={},a.requestData.orgId=b,d.getData(e.getParameterizedUrl("FIND_ORGLOCBYID",a.requestData),null,function(b){a.locations=angular.fromJson(b.data)},function(a){})},a.organizationSelected=function(){a.getOrgLocation(a.selectedOrganizationId),a.disableLocationName=!1},a.orgLocationSelected=function(){a.locationSelected=!1},a.cancel=function(){n.goBackToPrevState()},/**/
a.changeEntityVisuals=function(b){if("CAL_ORGANIZATION_USER"==b)a.isEntityRequired=!1,a.smartUserVisibility=!1,a.entityVisiblity=!0,a.isSmartRequired=!0,a.userNameLabel="ORGANIZATION_USER",a.disableSelectUser=!0,a.calendarUser={};else if("CAL_ORGANIZATION_LOCATION"==b)a.isEntityRequired=!1,a.smartUserVisibility=!0,a.entityVisiblity=!0,a.isSmartRequired=!1,a.selectedEntityId=a.filterCriteria.organizationLocation.data.id;else{var c="";c="CAL_EQUIPMENT"==b?"FIND_EQUIPMENT_BY_LOC_ID":"FIND_PROCESS_BY_LOC_ID";var f={orgLocationId:a.filterCriteria.organizationLocation.data.id};d.getData(e.getUrl(c),f,function(b){a.entities=b.data},function(a){}),a.isEntityRequired=!0,a.smartUserVisibility=!1,a.entityVisiblity=!1,a.isSmartRequired=!1}},a.getEntityTypes=function(){var b={};return n.isEmpty(a.filterCriteria.organizationLocation)||n.isEmpty(a.filterCriteria.organizationLocation.data)||(b.locationId=a.filterCriteria.organizationLocation.data.id),d.getData(e.getParameterizedUrl("GET_CALENDER_ENTITY_TYPES",b),null,function(b){/*var hasPermission = checkPermissionService.hasPermission($scope.filterCriteria.organizationLocation.data.id, featurePrivilegeConstants.CALENDAR_LOCATION_ADD)
                if (!hasPermission) {
                    response.data.splice(response.data.map(function (e) {
                        return e.code;
                    }).indexOf('CAL_ORGANIZATION_LOCATION'), 1);
                }*/
a.entityTypes=angular.fromJson(b.data)},function(a){})},a.entityTypeSelected=function(){a.changeEntityVisuals(a.entityTypeName)},a.getUserNames=function(b,c){return a.userData={},a.userData.searchKeyword=b,a.userData.orgLocationId=c,a.userNameAutoCmpLoading=!0,d.getData(e.getParameterizedUrl("GET_USERS_TO_CREATE_CALENDAR",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.userNameChanged=function(){},a.onUserSelect=function(b){a.calendarUser.user=b,a.selectedEntityId=b.id,a.stateDisabled=!1},a.entitySelected=function(){a.selectedEntityId=angular.fromJson(a.entityId).id},a.addAvailability=function(){
//TODO check the length
a.availabilityDetails.length<=5&&(a.availabilityDetails.push({}),5==a.availabilityDetails.length&&(a.disableAddAvailability=!0)),a.availabilityDetails.length>1&&(a.disableRemoveAvailability=!1)},a.checkBoxClicked=function(){a.requiredValue=m.checkBoxValidationCheck(a.availabilityDetails)},a.removeAvailability=function(b){a.availabilityDetails.splice(b,1),1==a.availabilityDetails.length&&(a.disableRemoveAvailability=!0),a.availabilityDetails.length<5&&(a.disableAddAvailability=!1)},a.getEntityType=function(b){a.selectedEntityType=b},a.saveCalendar=function(){q.showSpinner=!0,a.calendarObject={},a.calendarObject.organizationId=a.filterCriteria.organization.data.id,a.calendarObject.id=null,a.calendarObject.version=0,a.calendarObject.organizationLocationId=a.filterCriteria.organizationLocation.data.id,a.calendarObject.name=a.CalendarPopUpValues.professional,a.calendarObject.startDate=a.CalendarPopUpValues.requestStartDate,a.calendarObject.endDate=a.CalendarPopUpValues.requestEndDate,a.CalendarPopUpValues.defaultAvailablity=[],a.calendarObject.nonWorkingDays=[],a.CalendarPopUpValues.slotSize?a.calendarObject.slotSize=a.CalendarPopUpValues.slotSize:a.calendarObject.slotSize=15;var c={id:a.selectedEntityType.id,organizationLocationId:a.locationObject.selectedLocationId,value:a.selectedEntityType.value,code:a.selectedEntityType.code};a.calendarObject.entityId=a.selectedEntityId,a.calendarObject.entityType=c,h.createCalendarMethod(a,a.calendarObject,a.availabilityDetails,a.CalendarPopUpValues,function(){q.showSpinner=!1,l("success",t.instant("CALENDAR_ADDED_SUCCESSFULLY")),b.go("calendarlistview",{type:"",data:""})},function(b){q.showSpinner=!1,b&&(a.CalendarPopUpValues.defaultAvailablity=[],a.availabilityDetails=[{}])})},a.$watch("filterCriteria.organizationLocation.data",function(b){n.isFieldEmpty(b)?a.locationSelected=!0:a.locationSelected=!1}),a.init=function(){a.filterCriteria.organization={},a.filterCriteria.organizationLocation={}},a.init()}]),angular.module("paripal.fullCalendarModule").controller("EditCalendarCtrl",["$scope","commonCalendarService","$stateParams","$state","editCalendarService","$compile","$timeout","httpService","urlService","uiCalendarConfig","$mdDialog","$mdMedia","$filter","calendarService","utilService","dateconvertor","notify","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){a.disableAddAvailability=!1,a.locationObject={},a.filterCriteria={},a.filterCriteria.organizationLocation={},a.filterCriteria.organization={},a.filterCriteria.organizationLocation.data={},a.filterCriteria.organization.data={},a.disableRemoveAvailability=!0,a.availabilityDetailsCount=0,a.minDateForStart=new Date,
//$scope.maxDateForStart=null;
//$scope.minDateForEnd=new Date();
a.requiredValue=!0,a.locations=[{}],a.disableSelect=!1,a.selectedEntityId=0,a.entityTypeObject={},a.calendarUser={},a.calendarUser.user={},/*$scope.minDate=new Date($scope.today.getFullYear(),$scope.today.getMonth() - 2,$scope.today.getDate()).toDateString();*/
a.availabilityDetails=[];a.pageState="edit",a.minDateValidTill=p.convertToServerDate(new Date),/*$filter('timestampToDate')(new Date(), 'MM/dd/yyyy');*/
o.isNullOrEmpty(c.fromLocWall)||(a.fromLocWall=c.fromLocWall),a.goToCalendar=function(a){a.preventDefault(),o.isNullOrEmpty(c)||d.go("usercalendarview",{type:"regular",data:c.data})},a.getOrganizations=function(){h.getData(i.getUrl("GET_ORG"),null,function(b){a.organizationList=angular.fromJson(b.data)},function(a){})},a.getOrgLocation=function(b){a.requestData={},a.requestData.orgId=b,h.getData(i.getParameterizedUrl("FIND_ORGLOCBYID",a.requestData),null,function(b){a.locations=angular.fromJson(b.data)},function(a){})},a.getEntityTypes=function(){return h.getData(i.getUrl("GET_ENTITY_TYPES"),null,function(b){a.entityTypes=angular.fromJson(b.data)},function(a){})},a.checkBoxClicked=function(){a.requiredValue=n.checkBoxValidationCheck(a.availabilityDetails)},a.setData=function(d){
//$scope.calendarObject={};
a.serverEntityId=d.entityId,a.calendarObject=d,a.filterCriteria={},a.filterCriteria.organization={data:d.organization},a.filterCriteria.organizationLocation={data:d.organizationLocation},"CAL_ORGANIZATION_LOCATION"==a.calendarObject.entityType.code?(a.entityVisiblity=!0,a.smartUserVisibility=!0):"CAL_ORGANIZATION_USER"==a.calendarObject.entityType.code?(a.calendarUser.user.id=a.calendarObject.entityId,a.calendarUser.user.value=a.calendarObject.entityName,a.smartUserVisibility=!1,a.entityVisiblity=!0):"CAL_USER"==a.calendarObject.entityType.code?(a.smartUserVisibility=!1,a.entityVisiblity=!0):"CAL_PROCESS"!=a.calendarObject.entityType.code&&"CAL_EQUIPMENT"!=a.calendarObject.entityType.code||(a.selectedEntityId=a.calendarObject.entityId),a.CalendarPopUpValues=b.convertCalendarObject(a,a.CalendarPopUpValues,a.calendarObject,"Client"),a.CalendarPopUpValues.id=a.calendarObject.id;var e=a.CalendarPopUpValues.defaultAvailablity;"object"==typeof e&&e.sort(function(a,b){return a.startTime>b.startTime}),a.availabilityDetails=e,a.availabilityDetailsCount=a.CalendarPopUpValues.defaultAvailablity.length,1==a.availabilityDetails.length&&(a.disableRemoveAvailability=!0,a.requiredValue=!1),a.availabilityDetailsCount>1&&(a.disableRemoveAvailability=!1,a.checkBoxClicked()),a.getEntityTypes(),c.entityData?(a.entityTypeObject=c.entityData,a.entityTypeName=a.entityTypeObject.code):(a.entityTypeObject=a.calendarObject.entityType,a.entityTypeName=a.calendarObject.entityType.code);var f="";f="CAL_EQUIPMENT"==a.entityTypeName?"FIND_EQUIPMENT_BY_LOC_ID":"FIND_PROCESS_BY_LOC_ID";var g={orgLocationId:a.filterCriteria.organizationLocation.data.id};h.getData(i.getParameterizedUrl(f,g),null,function(b){a.entities=b.data},function(a){}),/*$scope.entityTypeName=$scope.CalendarPopUpValues;*/
a.locationObject.selectedLocationId=a.CalendarPopUpValues.organizationLocationId,a.CalendarPopUpValues.slotSize=d.slotSize,c.type&&"edit"==c.type&&("CAL_ORGANIZATION_LOCATION"!=a.calendarObject.entityType.code&&1==a.calendarObject.whetherLinked?(a.disableFromDate=!0,a.disableTillDate=!0,a.isLocationDisable=!0,a.disableOrgName=!0,a.disableLocationName=!0,a.disableEntityType=!0,a.disableSelectEntity=!0,a.disableSelectUser=!0,a.isCalendarNameDisabled=!0,a.linkMode=!0,a.disableSave=!0,a.minDateValidTill=p.convertToServerDate(new Date)):(a.disableCtrl=!1,a.disableFromDate=!0,a.isLocationDisable=!0,a.disableOrgName=!0,a.disableLocationName=!0,a.disableEntityType=!0,a.disableSelectEntity=!0,a.disableSelectUser=!0,a.isCalendarNameDisabled=!0,a.minDateValidTill=p.convertToServerDate(new Date))),"CAL_ORGANIZATION_USER"==a.calendarObject.entityType.code?a.userNameLabel="ORGANIZATION_USER":"CAL_USER"==a.calendarObject.entityType.code&&(a.userNameLabel="USER_NAME")},a.init=function(){a.CalendarPopUpValues={},c.data?(localStorage.setItem("cmi",angular.toJson(c.data)),a.setData(c.data)):(a.calendarObjectData=localStorage.getItem("cmi"),a.data=angular.fromJson(a.calendarObjectData),a.setData(a.data))},a.init(),a.changeEntityVisuals=function(b){"CAL_ORGANIZATION_USER"==b?(a.isEntityRequired=!1,a.smartUserVisibility=!1,a.entityVisiblity=!0,a.isSmartRequired=!0,a.userNameLabel="ORGANIZATION_USER"):"CAL_ORGANIZATION_LOCATION"==b?(a.isEntityRequired=!1,a.smartUserVisibility=!0,a.entityVisiblity=!0,a.isSmartRequired=!1,a.selectedEntityId=a.locationObject.selectedLocationId):(a.isEntityRequired=!0,a.smartUserVisibility=!0,a.entityVisiblity=!1,a.isSmartRequired=!1)},/*             $scope.entityTypeSelected = function () {
                    $scope.changeEntityVisuals($scope.entityTypeName);
                };*/
a.getUserNames=function(b,c){return a.userData={},a.userData.searchKeyword=b,a.userData.orgLocationId=c,a.userNameAutoCmpLoading=!0,h.getData(i.getParameterizedUrl("GET_USERS_TO_CREATE_CALENDAR",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.removeAvailability=function(b){a.availabilityDetailsCount=a.availabilityDetailsCount-1,a.availabilityDetails.splice(b,1),1==a.availabilityDetails.length&&(a.disableRemoveAvailability=!0),a.availabilityDetails.length<5&&(a.disableAddAvailability=!1)},a.addAvailability=function(){a.availabilityDetailsCount<4&&(a.availabilityDetails.push({}),a.availabilityDetailsCount=a.availabilityDetailsCount+1,4==a.availabilityDetailsCount&&(a.disableAddAvailability=!0)),a.availabilityDetailsCount>1&&(a.disableRemoveAvailability=!1)},a.cancel=function(){o.goBackToPrevState()},a.getEntityType=function(b){a.selectedEntityType=b},a.saveCalendar=function(){a.calendarObject={},a.calendarObject.organizationId=a.selectedOrganizationId,a.calendarObject.id=a.CalendarPopUpValues.id,a.calendarObject.version=a.CalendarPopUpValues.version,a.calendarObject.organizationLocationId=a.locationObject.selectedLocationId,a.calendarObject.name=a.CalendarPopUpValues.professional,a.calendarObject.startDate=a.CalendarPopUpValues.requestStartDate,a.calendarObject.endDate=a.CalendarPopUpValues.requestEndDate,a.CalendarPopUpValues.defaultAvailablity=[],a.calendarObject.nonWorkingDays=[],a.CalendarPopUpValues.slotSize?a.calendarObject.slotSize=a.CalendarPopUpValues.slotSize:a.calendarObject.slotSize=15;var b={id:a.entityTypeObject.id,organizationLocationId:a.selectedLocationId,value:a.entityTypeObject.value,code:a.entityTypeObject.code};a.calendarObject.entityId=a.serverEntityId,a.calendarObject.entityType=b,e.editCalendarMethod(a,a.calendarObject,a.availabilityDetails,a.CalendarPopUpValues,function(){q("success",r.instant("CALENDAR_UPDATED_SUCCESSFULLY")),d.go("calendarlistview",{type:"",data:""})},function(a){})}}]),angular.module("paripal.fullCalendarModule").controller("LinkCalendarCtrl",["$scope","commonCalendarService","$stateParams","$state","editCalendarService","$compile","$timeout","httpService","urlService","uiCalendarConfig","$mdDialog","$mdMedia","$filter","calendarService","utilService","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.disableAddAvailability=!1,a.locationObject={},a.disableRemoveAvailability=!0,a.availabilityDetailsCount=0,a.minDateForStart=new Date,
//$scope.maxDateForStart=null;
//$scope.minDateForEnd=new Date();
a.requiredValue=!0,a.locations=[{}],a.disableSelect=!1,a.selectedEntityId=0,a.entityTypeObject={},a.calendarUser={},a.calendarUser.user={},a.filterCriteria={},a.filterCriteria.organization={},a.filterCriteria.organizationLocation={},a.filterCriteria.organizationLocation.data={},a.filterCriteria.organization.data={},/*$scope.minDate=new Date($scope.today.getFullYear(),$scope.today.getMonth() - 2,$scope.today.getDate()).toDateString();*/
a.availabilityDetails=[];a.pageState="link",a.getOrganizations=function(){h.getData(i.getUrl("GET_ORG"),null,function(b){a.organizationList=angular.fromJson(b.data)},function(a){})},a.getOrgLocation=function(b){a.requestData={},a.requestData.orgId=b,h.getData(i.getParameterizedUrl("FIND_ORGLOCBYID",a.requestData),null,function(b){a.locations=angular.fromJson(b.data)},function(a){})},a.getEntityTypes=function(){return h.getData(i.getUrl("GET_ENTITY_TYPES"),null,function(b){a.entityTypes=angular.fromJson(b.data),a.entityTypes.splice(1,1)},function(a){})},a.checkBoxClicked=function(){a.requiredValue=n.checkBoxValidationCheck(a.availabilityDetails)},a.setData=function(d){
//$scope.calendarObject={};
a.serverEntityId=d.entityId,a.calendarObject=d,a.filterCriteria={},a.filterCriteria.organization={data:d.organization},a.filterCriteria.organizationLocation={data:d.organizationLocation},"CAL_ORGANIZATION_LOCATION"==a.calendarObject.entityType.code?(a.entityVisiblity=!0,a.smartUserVisibility=!0):"CAL_ORGANIZATION_USER"==a.calendarObject.entityType.code?(a.calendarUser.user.id=a.calendarObject.entityId,a.calendarUser.user.displayName=a.calendarObject.entityName,a.smartUserVisibility=!1,a.entityVisiblity=!0):"CAL_USER"==a.calendarObject.entityType.code&&(a.calendarUser.user.id=a.calendarObject.entityId,a.calendarUser.user.displayName=a.calendarObject.entityName,a.smartUserVisibility=!1,a.entityVisiblity=!0),a.CalendarPopUpValues=b.convertCalendarObject(a,a.CalendarPopUpValues,a.calendarObject,"Client"),a.CalendarPopUpValues.id=a.calendarObject.id,a.availabilityDetails=a.CalendarPopUpValues.defaultAvailablity,a.availabilityDetailsCount=a.CalendarPopUpValues.defaultAvailablity.length,1==a.availabilityDetails.length&&(a.disableRemoveAvailability=!0,a.requiredValue=!1),a.availabilityDetailsCount>1&&(a.disableRemoveAvailability=!1,a.checkBoxClicked()),a.selectedOrganizationId=a.CalendarPopUpValues.organizationId,a.getOrganizations(),a.getOrgLocation(a.selectedOrganizationId),a.getEntityTypes(),c.entityData?a.entityTypeObject=c.entityData:a.entityTypeObject=a.calendarObject.entityType,a.isCalendarNameDisabled=!0,a.disableFromDate=!0,a.disableTillDate=!0,a.isLocationDisable=!0,a.linkMode=!0,/*$scope.entityTypeName=$scope.CalendarPopUpValues;*/
a.locationObject.selectedLocationId=a.CalendarPopUpValues.organizationLocationId},a.init=function(){a.CalendarPopUpValues={},c.type&&"link"==c.type&&(a.disableOrgName=!0,a.disableLocationName=!0,a.disableSelectEntity=!0),c.data?(localStorage.setItem("cmi",angular.toJson(c.data)),a.setData(c.data)):(a.calendarObjectData=localStorage.getItem("cmi"),a.data=angular.fromJson(a.calendarObjectData),a.setData(a.data))},a.init(),a.changeEntityVisuals=function(b){"CAL_ORGANIZATION_USER"==b?(/*$scope.calendarUser.user= "";*/
a.isEntityRequired=!1,a.smartUserVisibility=!1,a.entityVisiblity=!0,a.isSmartRequired=!0,a.userNameLabel="ORGANIZATION_USER",a.calendarUser.user={id:p.getLoggedInUser().id,displayName:p.getLoggedInUser().displayName},a.selectedEntityId=p.getLoggedInUser().id):"CAL_ORGANIZATION_LOCATION"==b?(a.isEntityRequired=!1,a.smartUserVisibility=!0,a.entityVisiblity=!0,a.isSmartRequired=!1,a.selectedEntityId=a.locationObject.selectedLocationId):(a.isEntityRequired=!0,a.smartUserVisibility=!0,a.entityVisiblity=!1,a.isSmartRequired=!1)},a.onUserSelect=function(b){a.calendarUser.user=b,a.selectedEntityId=b.id,a.stateDisabled=!1},a.entityTypeSelected=function(){a.changeEntityVisuals(a.entityTypeName)},a.getUserNames=function(b,c){return a.userData={},a.userData.userName=b,a.userData.orgLocId=c,a.userNameAutoCmpLoading=!0,h.getData(i.getParameterizedUrl("FIND_USERBYORGLOC",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.removeAvailability=function(b){a.availabilityDetailsCount=a.availabilityDetailsCount-1,a.availabilityDetails.splice(b,1),1==a.availabilityDetails.length&&(a.disableRemoveAvailability=!0),a.availabilityDetails.length<5&&(a.disableAddAvailability=!1)},a.addAvailability=function(){a.availabilityDetailsCount<4&&(a.availabilityDetails.push({}),a.availabilityDetailsCount=a.availabilityDetailsCount+1,4==a.availabilityDetailsCount&&(a.disableAddAvailability=!0)),a.availabilityDetailsCount>1&&(a.disableRemoveAvailability=!1)},a.cancel=function(){o.goBackToPrevState()},a.getEntityType=function(b){a.selectedEntityType=b},a.saveCalendar=function(){a.calendarObject={},a.calendarObject.organizationId=a.selectedOrganizationId,a.calendarObject.id=a.CalendarPopUpValues.id,a.calendarObject.organizationLocationId=a.locationObject.selectedLocationId,a.calendarObject.name=a.CalendarPopUpValues.professional;var b={id:a.selectedEntityType.id,organizationLocationId:a.locationObject.selectedLocationId,value:a.selectedEntityType.value,code:a.selectedEntityType.code};a.calendarObject.entityId=a.selectedEntityId,a.calendarObject.entityType=b,e.linkCalendarMethod(a.calendarObject,function(){notify("success",$translate.instant("CALENDAR_LINKED_SUCCESSFULLY")),d.go("calendarlistview",{type:"",data:""})},function(a){})},a.$watch("filterCriteria.organizationLocation.data",function(b){o.isFieldEmpty(b)?a.locationSelected=!0:a.locationSelected=!1})}]),angular.module("paripal.fullCalendarModule").controller("ViewCalendarListCtrl",["datatableconfig","serverSidePagination","$state","utilService","commonCalendarService","$scope","$filter","httpService","urlService","$compile","$timeout","createCalendarService","uiCalendarConfig","$mdDialog","$mdMedia","$rootScope","notify","userStatusService","baseService","$translate","manageRequestService","checkPermissionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";f.currentPage=1,f.itemPerPage=10,f.startRecord=(f.currentPage-1)*f.itemPerPage+1,f.endRecord=f.itemPerPage,f.pagingInfo={},f.calendarSearchCriteria={},f.calendarSpinner=!1,f.calendars=[],f.filterCriteria={},f.orgLocDisabled=!0,f.entityHided=!0,/*$scope.calendars=commonCalendarService.trial2();*/
f.getOrganizationList=function(){h.getData(i.getUrl("GET_ORG"),null,function(a){f.organizationList=angular.fromJson(a.data)},function(a){})},r.isUserLoggedIn()&&f.getOrganizationList(),f.organizationSelected=function(){f.getOrgLocation(f.calendarSearchCriteria.organizationId),f.orgLocDisabled=!1},f.getOrgLocation=function(a){f.requestData={},f.requestData.orgId=a,h.getData(i.getParameterizedUrl("FIND_ORGLOCBYID",f.requestData),null,function(a){f.locations=angular.fromJson(a.data)},function(a){})},f.getEntityTypes=function(){return h.getData(i.getUrl("GET_ENTITY_TYPES"),null,function(a){f.entityTypes=angular.fromJson(a.data),angular.forEach(f.entityTypes,function(a,b){"CAL_ORGANIZATION_USER"===a.code&&(
//$scope.filterCriteria.entityTypeId = value;
f.displayId=a.id)})},function(a){})},f.getEntityTypes(),f.entityTypesSelected=function(){f.calendarSearchCriteria.entityTypeId=f.filterCriteria.entityTypeId.id,f.displayId=f.filterCriteria.entityTypeId.id,f.selectedEntity=f.filterCriteria.entityTypeId,f.filterCriteria.entityId=null,f.showEntityFilter(f.selectedEntity)},f.showEntityFilter=function(a){"CAL_ORGANIZATION_USER"==a.code?(f.entityHided=!1,f.orgUser=!0):"CAL_USER"==a.code?(f.entityHided=!1,f.orgUser=!1):"CAL_ORGANIZATION_LOCATION"==a.code?(f.filterCriteria.entityId=angular.copy(f.filterCriteria.organizationLocation.data.id),/* $scope.calendarSearchCriteria.entityId = angular.copy($scope.filterCriteria.organizationLocation.data.id);*/
/*$scope.filterCriteria.entityId = null;*/
f.entityHided=!0):(f.calendarSearchCriteria.entityId=null,f.filterCriteria.entityId=null,f.entityHided=!0)},f.getEntityData=function(a){if(f.orgUser){var b={};return b.searchString=a,f.filterCriteria.organizationLocation.data&&(b.orgLocId=f.filterCriteria.organizationLocation.data.id),h.getData(i.getParameterizedUrl("GET_DOCTORS_FOR_SEARCH_CALENDAR",b),null,function(a){return f.entityData=angular.fromJson(a.data),f.entityData},function(a){})}var b={};return b.userName=a,h.getData(i.getParameterizedUrl("GET_ALL_USERS",b),null,function(a){return f.entityData=angular.fromJson(a.data),f.entityData},function(a){})},f.onEntitySelect=function(a){f.filterCriteria.entityId.id=a.id,f.filterCriteria.entityId.value=a.value},f.filterCalendar=function(a,c,g){if(f.calendarSpinner=!0,f.filterCriteria.entityId)if(f.filterCriteria.entityId.id)f.calendarSearchCriteria.entityId=f.filterCriteria.entityId.id;else{if("CAL_ORGANIZATION_USER"==f.filterCriteria.entityTypeId.code)return q("error",t.instant("PLEASE_SELECT_VALID_USER")),1;f.calendarSearchCriteria.entityId=f.filterCriteria.entityId}else f.calendarSearchCriteria&&f.calendarSearchCriteria.entityId&&(f.calendarSearchCriteria.entityId=null);f.filterCriteria.entityId&&!d.isFieldEmpty(c)&&(f.filterCriteria.entityId.displayName=c.value),f.filterCriteria.organization&&f.filterCriteria.organization.data.id&&(f.calendarSearchCriteria.organizationId=f.filterCriteria.organization.data.id),f.filterCriteria.organization&&f.filterCriteria.organizationLocation.data.id&&(f.calendarSearchCriteria.organizationLocationId=f.filterCriteria.organizationLocation.data.id),f.calendarSearchCriteria.pageNumber=f.currentPage,f.calendarSearchCriteria.recordsPerPage=f.itemPerPage,f.filterCriteria.entityTypeId&&(f.calendarSearchCriteria.entityTypeCode=f.filterCriteria.entityTypeId.code),e.searchCalendar(f.calendarSearchCriteria,function(a){f.calendars=a.data,f.totalItems=a.totalRecords,f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems),f.calendarSpinner=!1},function(a){f.calendarSpinner=!1},g)},f.clear=function(){d.isFieldEmpty(f.calendarSearchCriteria)||(f.calendarSearchCriteria.entityId=null,f.calendarSearchCriteria.entityTypeId=null),f.calendars=[],f.calendarSearchCriteria={},f.filterCriteria.entityTypeId=null,f.filterCriteria.entityId=null,f.filterCriteria={},f.orgLocDisabled=!0,f.entityHided=!0,f.filterCriteria.organization={},f.filterCriteria.organizationLocation={},f.filterCriteria.organization.data={},f.filterCriteria.organizationLocation.data={},f.filterCalendar(!0)},f.addNewCalendar=function(){c.go("createcalendarview",{type:"",data:""})},f.viewCalendar=function(a){"CAL_ORGANIZATION_USER"==a.entityType.code?c.go("usercalendarview",{type:"regular",data:a,fromListPage:!0}):"CAL_PROCESS"==a.entityType.code?c.go("processcalendarview",{type:"regular",data:a}):"CAL_EQUIPMENT"==a.entityType.code?c.go("equipmentcalendarview",{type:"regular",data:a}):"CAL_ORGANIZATION_LOCATION"==a.entityType.code&&c.go("locationcalendarview",{type:"regular",data:a})},f.viewException=function(a){c.go("usercalendarview",{type:"exception",data:a})},f.linkCalendar=function(a){h.postData(i.getUrl("FIND_CALENDARBYID"),a,function(b){c.go("linkCalendar",{type:"link",entityId:a.entityId,entityData:a.entityType,data:angular.fromJson(b.data),calendarId:a.id})},function(a){})},f.editCalendar=function(a){h.postData(i.getUrl("FIND_CALENDARBYID"),a,function(b){c.go("editcalendarview",{type:"edit",entityId:a.entityId,entityData:a.entityType,data:angular.fromJson(b.data),calendarId:a.id})},function(a){})},f.pageChanged=function(){f.pagingInfo=b(f.currentPage,f.itemPerPage,f.totalItems),f.filterCalendar(!0)},f.validateCalendarMenu=function(a){f.endDate=new Date(a.endDate),f.isCalendarExpired=d.dateComparator(f.endDate,f.currentDate,"lt")},f.unLinkCalendar=function(a){h.postData(i.getUrl("UNLINK_CALENDAR"),a,function(a){q("success",t.instant("CALENDAR_UNLINK_SUCCESS")),c.reload()},function(a){})},f.setMaxRecords=function(a){f.pageNumber=1,f.itemPerPage=a,f.filterCalendar(!0)};
//datatble config json
var w={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};f.options=a.setOptionProperties(w),f.dtColumnDefs=a.setColumnProperties({}),f.hasCalendarEditPermission=function(a,b){return v.hasPermission(a,b)},f.viewDayException=function(a){c.go("dayExceptionList",{calendarId:a.id,entityId:a.entityId,organizationLocationId:a.organizationLocationId,entityTypeCode:a.entityType.code,entityType:a.entityType})},f.init=function(){f.status={},f.filterCriteria.organization={},f.filterCriteria.organizationLocation={},f.filterCriteria.organization.data={},f.filterCriteria.organizationLocation.data={};var a=s.getDefaultOrgLocation();d.isFieldEmpty(a)||(f.filterCriteria.organizationLocation.data=a.orgLoc,f.filterCriteria.organization.data=a.org),f.isCalendarExpired=!1,f.currentDate=new Date;/*calendarEntityType,CAL_ORGANIZATION_USER*/
var b={};b.pickListCode="calendarEntityType",b.pickListItemCode="CAL_ORGANIZATION_USER",u.getPicklistWSByCode(b,function(a){f.displayId=a.data.id},function(a){});var e=null,g=null;"professionalwall"===c.params.type&&(e=c.params.data,g="SEARCH_CALENDAR_BY_PROFESSIONAL",f.fromProfessionalWall=!0),d.isFieldEmpty(s.getLoggedInUser())||0!=s.getLoggedInUser().isOrganizationUserMode?f.filterCalendar(!0,e,g):(f.status.open=!0,q("info",t.instant("PLEASE_SELECT_HOSPITAL"))),d.isFieldEmpty(p.loggedInUserDetails)||d.isFieldEmpty(p.loggedInUserDetails.userAccountStatusDTO)||(f.whetherClient=p.loggedInUserDetails.userAccountStatusDTO.whetherClient)},f.init()}]),angular.module("paripal.fullCalendarModule").service("calendarMenuService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.calendarLocationBaseMenuValidator=function(a,b,c){var d=!1;return a&&a[b]&&a[b].indexOf(c)!=-1&&(d=!0),d}}]),angular.module("paripal.fullCalendarModule").service("calendarObjIteratorService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.objIterator=function(a){var b=[];return angular.forEach(a,function(a,c){var d=[];angular.forEach(a.eventSlots,function(c,e){var f=[];angular.forEach(a.eventSlots,function(a,b){c.slotDate==a.slotDate&&c.eventId==a.eventId&&e<=b&&d.indexOf(b)==-1&&(f.push(a),d.push(b))});var g=angular.copy(a);g.eventSlots=f,0!=f.length&&(g.dates=[f[0].slotDate],b.push(g))})}),b}}]),angular.module("paripal.fullCalendarModule").service("calendarService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.checkBoxValidationCheck=function(a){var b=!0;return angular.forEach(a,function(a,c){b=1!=a.monday&&(1!=a.tuesday&&(1!=a.wednesday&&(1!=a.thursday&&(1!=a.friday&&(1!=a.saturday&&1!=a.sunday)))))}),b}}]),angular.module("paripal.fullCalendarModule").service("commonCalendarService",["httpService","$filter","urlService","dateconvertor","utilService","baseService","featurePrivilegeConstants",function(a,b,c,d,e,f,g){"use strict";this.dateSeperator=function(a){var b={},c=new Date(a);return b.month=("0"+(c.getMonth()+1)).slice(-2),b.day=("0"+c.getDate()).slice(-2),b.year=c.getFullYear(),b},this.searchCalendar=function(b,d,h,i){i=e.isFieldEmpty(i)&&!e.isFieldEmpty(f.getLoggedInUser())&&f.getLoggedInUser().isOrganizationUserMode?"SEARCH_CALENDAR":"SEARCH_INDIVIDUAL_CALENDAR",a.postData(c.getUrl(i),b,function(a){d(a.data)},function(a){h(a)},{orgLocPermission:g.VIEW_CALENDAR})},this.searchDayExceptions=function(b,d,e){a.postData(c.getUrl("GET_DAY_EXCEPTION_LIST"),b,function(a){d(a.data)},function(a){e(a)})},this.getCalendarData=function(b,d,e,f){"exception"==d?a.postData(c.getUrl("VIEW_EXCEPTION"),b,function(a){e(a.data)},function(a){f(a)}):a.postData(c.getUrl("VIEW_CALENDAR"),b,function(a){e(a.data)},function(a){f(a)})},this.saveExceptionDecision=function(b,d,e){a.putData(c.getUrl("EXCEPTION_DECISION"),b,function(a){d(a.data)},function(a){e(a)},{orgLocPermission:g.CALENDAR_EVENT_EDIT})},this.setEventStyle=function(a,c,d){if(a.css("cursor","default"),"background"!=c.rendering)if(0==c.exception||e.isFieldEmpty(c.exception)){a.css("cursor","pointer");var g="";if("agendaWeek"==c.viewType){g='<div id="99" class="btn-group col-sm-12 col-md-12 col-lg-12 padding-0 abc" ng-class="toggleClass" style="height: 100%;"><div href="abc" id="444" class="col-sm-12 col-md-2 col-lg-2 padding-0 event-icon-holder-week dropdown-toggle dropDownBtnLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >';var h="";if("FCFS"!=c.appointmentType&&(h="glyphicon-chevron-right"),c.eventType?"CAL_EVENT_APPT"==c.eventType.code?g+='<i class="fa fa-check calender-event-menu-weekicon"  aria-hidden="true"></i>':"CAL_EVENT_HOME_VISIT"==c.eventType.code?g+='<i class="fa fa-home calender-event-menu-weekicon" aria-hidden="true"></i>':"CAL_EVENT_ONLINE"==c.eventType.code?g+='<i class="fa fa-wifi calender-event-menu-weekicon" aria-hidden="true"></i>':"CAL_EVENT_SELF_NORMAL"==c.eventType.code&&(g+='<i class="calender-self-normal-icon calender-event-menu-weekicon" aria-hidden="true"></i>'):g+='<i class="fa fa-user-plus calender-event-menu-weekicon" aria-hidden="true"></i>',g+='</div><div id="555" class="col-sm-12 col-md-10 col-lg-10 padding-0 calendar-event-weektext-div" style="">',c.eventSlots){var i=c.eventSlots.length;angular.forEach(c.eventSlots,function(a,e){var j=new Date;a.startTime&&(j.setHours(a.startTime.substring(0,2)),j.setMinutes(a.startTime.substring(3,5)));var k=new Date;a.endTime&&(k.setHours(a.endTime.substring(0,2)),k.setMinutes(a.endTime.substring(3,5)));var l=b("date")(j,"hh:mm a"),m=b("date")(k,"hh:mm a"),n="";if("ADHOC"!=c.appointmentType)c.eventSlots.length>1?15==d?c.slotSize%15===0?(n=c.slotSize/15*20,n+="px"):(n=Math.round(c.slotSize/15*20),i-1==e&&(n-=1),n+="px"):c.slotSize%5===0?(n=c.slotSize/5*20,n+="px"):(n=Math.round(c.slotSize/5*20),i-1==e&&(n-=1),n+="px"):n="100%";else{var o=new Date(a.slotDate+" "+a.startTime),p=new Date(a.slotDate+" "+a.endTime),q=p-o,r=Math.floor(q%864e5/36e5),s=Math.round(q%864e5%36e5/6e4),t=s+60*r;15==d?t%15===0?(n=t/15*20,n+="px"):(n=Math.round(t/15*20),n+="px"):t%5===0?(n=t/5*20,n+="px"):(n=Math.round(t/5*20),n+="px")}var u="",v="",w=new Date,x=a.slotDate.split("-"),y=c.eventEndTime.split(":"),z=parseInt(x[1])-1,A=z.toString(),B=new Date(x[0],A,x[2],y[0],y[1],y[2]);B.getTime()>=w.getTime()?a.isBooked?a.appointmentSlots&&1!=a.appointmentSlots[0].whetherPostponedAppt?a.appointmentSlots&&f.getLoggedInUser().displayName==a.appointmentSlots[0].patientName?(u="event-booked-slots",v="fc-event-text"):"CAL_PROCESS"==c.entityType.code&&0!=a.capacityRemaining?(u="event-free-slots",v="fc-event-text"):(u="event-other-booked-slots",v="fc-other-event-text"):a.appointmentSlots&&1==a.appointmentSlots[0].whetherPostponedAppt&&(u="event-postponed-slots",v="fc-event-text"):(u="event-free-slots",v="fc-event-text"):(u="event-other-booked-slots",v="fc-other-event-text");var C=null,D=a.id,E=null,F=null,G=null;a.appointmentSlots&&(C=a.appointmentSlots[0].appointmentId,E=a.appointmentSlots[0].userId,F=a.appointmentSlots[0].patientName,G=a.appointmentSlots[0].status.code),g=g+" <div data-slotId='"+D+"' class='col-sm-12 col-md-12 col-lg-12 padding-0 calendar-event-text-style "+u+"' id='12' style='height:"+n+"'><div data-slotId='"+D+"' id='54' class='col-sm-12 col-md-12 col-lg-12 padding-0 padding-t-5 fc-event-text-holder'><div class='"+v+"'><span id='1111' data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+a.startTime+"' data-appointmentEndTime='"+a.endTime+"'  data-appointmentDate='"+a.slotDate+"' data-appointmentUserId='"+E+"' data-appointmentId='"+C+"' data-patientName='"+F+"'  data-appointmentStatus='"+G+"' data-slotId='"+D+"'>"+l+"-"+m+" <i data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+a.startTime+"' data-appointmentEndTime='"+a.endTime+"'  data-appointmentDate='"+a.slotDate+"' data-appointmentUserId='"+E+"' data-appointmentId='"+C+"' data-patientName='"+F+"'  data-appointmentStatus='"+G+"' data-slotId='"+D+"' class='glyphicon calendar-appointment-menu-style "+h+"' id='1111' aria-hidden='true' ng-class=''></i></span></div>","CAL_PROCESS"==c.entityType.code&&(g=g+" <div><span class='"+v+"'>Capacity:"+a.capacity+"</span></div><div><span class='"+v+"'>Remaining:"+a.capacityRemaining+"</span></div>"),g+=" </div></div>"})}else{var j=new Date;c.eventStartTime&&(j.setHours(c.eventStartTime.substring(0,2)),j.setMinutes(c.eventStartTime.substring(3,5)));var k=new Date;c.eventEndTime&&(k.setHours(c.eventEndTime.substring(0,2)),k.setMinutes(c.eventEndTime.substring(3,5)));var l=b("date")(j,"hh:mm a"),m=b("date")(k,"hh:mm a"),n="event-booked-slots";g=g+" <div class='col-sm-12 col-md-12 col-lg-12 padding-0 calendar-event-text-style "+n+"' id='12' style='height:100%'><div id='54' class='col-sm-12 col-md-12 col-lg-12 padding-0 padding-t-5 fc-event-text-holder'><span id='1111' data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+c.eventStartTime+"' data-appointmentEndTime='"+c.eventEndTime+"'  data-appointmentDate='"+c.eventDate+"' data-appointmentUserId='"+c.eventUserId+"' data-appointmentId='"+c.appointmentId+"' class='fc-event-text'>"+l+"-"+m+" <i data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+c.eventStartTime+"' data-appointmentEndTime='"+c.eventEndTime+"'  data-appointmentDate='"+c.eventDate+"' data-appointmentUserId='"+c.eventUserId+"' data-appointmentId='"+c.appointmentId+"' class='glyphicon calendar-appointment-menu-style "+h+"' id='1111' aria-hidden='true'></i></span> </div></div>"}}else if("agendaDay"==c.viewType){var h="";if("FCFS"!=c.appointmentType&&(h="glyphicon-chevron-right"),g='<div id="99" class="btn-group col-sm-12 col-md-12 col-lg-12 padding-0 abc" ng-class="toggleClass" style="height: 100%; width:100%;"><div href="abc" id="444" class="col-sm-12 col-md-1 col-lg-1 padding-0 event-icon-holder-day dropdown-toggle dropDownBtnLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >',c.eventType?"CAL_EVENT_APPT"==c.eventType.code?g+='<i class="fa fa-check calender-event-menu-weekicon"  aria-hidden="true"></i>':"CAL_EVENT_HOME_VISIT"==c.eventType.code?g+='<i class="fa fa-home calender-event-menu-weekicon" aria-hidden="true"></i>':"CAL_EVENT_ONLINE"==c.eventType.code?g+='<i class="fa fa-wifi calender-event-menu-weekicon" aria-hidden="true"></i>':"CAL_EVENT_SELF_NORMAL"==c.eventType.code&&(g+='<i class="calender-self-normal-icon calender-event-menu-weekicon" aria-hidden="true"></i>'):g+='<i class="fa fa-user-plus calender-event-menu-weekicon" aria-hidden="true"></i>',g+='</div><div id="555" class="col-sm-12 col-md-11 col-lg-11 padding-0 calendar-event-daytext-div" style="">',c.eventSlots){c.eventSlots.length;angular.forEach(c.eventSlots,function(a,e){var j=new Date;a.startTime&&(j.setHours(a.startTime.substring(0,2)),j.setMinutes(a.startTime.substring(3,5)));var k=new Date;a.endTime&&(k.setHours(a.endTime.substring(0,2)),k.setMinutes(a.endTime.substring(3,5)));var l=b("date")(j,"hh:mm a"),m=b("date")(k,"hh:mm a"),n="";if("ADHOC"!=c.appointmentType)c.eventSlots.length>1?15==d?c.slotSize%15===0?(n=c.slotSize/15*20,n+="px"):(n=Math.round(c.slotSize/15*20),i-1==e&&(n-=1),n+="px"):c.slotSize%5===0?(n=c.slotSize/5*20+2,n+="px"):(n=Math.round(c.slotSize/5*20),i-1==e&&(n-=1),n+="px"):n="100%";else if(c.eventSlots.length>1){var o=new Date(a.slotDate+" "+a.startTime),p=new Date(a.slotDate+" "+a.endTime),q=p-o,r=Math.floor(q%864e5/36e5),s=Math.round(q%864e5%36e5/6e4),t=s+60*r;15==d?t%15===0?(n=t/15*20,n+="px"):(n=Math.round(t/15*20),n+="px"):t%5===0?(n=t/5*20,n+="px"):(n=Math.round(t/5*20),n+="px")}else n="100%";var u="",v="",w=new Date,x=a.slotDate.split("-"),y=c.eventEndTime.split(":"),z=parseInt(x[1])-1,A=z.toString(),B=new Date(x[0],A,x[2],y[0],y[1],y[2]);B.getTime()>=w.getTime()?a.isBooked?1==a.appointmentSlots[0].whetherPostponedAppt?(u="event-postponed-slots",v="fc-event-text"):f.getLoggedInUser().displayName==a.appointmentSlots[0].patientName?(u="event-booked-slots",v="fc-event-text"):"CAL_PROCESS"==c.entityType.code&&0!=a.capacityRemaining?(u="event-free-slots",v="fc-event-text"):(u="event-other-booked-slots",v="fc-other-event-text"):(u="event-free-slots",v="fc-event-text"):(u="event-other-booked-slots",v="fc-other-event-text");var C=null,D=null,E=a.id,F="";if(a.appointmentSlots){var G="";1==a.appointmentSlots[0].whetherPostponedAppt&&(G="New appointment timing:- "+b("date")(a.appointmentSlots[0].startTime,"hh:mm a")+" - "+b("date")(a.appointmentSlots[0].endTime,"hh:mm a")),C=a.appointmentSlots[0].appointmentId,D=a.appointmentSlots[0].userId;var H="";H=1==a.appointmentSlots[0].whetherPostponedAppt?"fc-event-text":"fc-other-event-text",F=F+"<span class='"+H+" text-ellipsis' style='width: 40%;float:left;'> Patient Name:",angular.forEach(a.appointmentSlots,function(b,c){F=0==c?F+" "+b.patientName:F+","+b.patientName,c==a.appointmentSlots.length-1&&null!=b.serviceType&&(F=F+"     Treatment Type: "+b.serviceType)}),F=F+". "+G+"</span>"}g=g+" <div data-slotId='"+E+"' class='col-sm-12 col-md-12 col-lg-12 padding-0 calendar-event-text-style "+u+"' id='12' style='height:"+n+"'><div data-slotId='"+E+"' id='54' class='col-sm-12 col-md-12 col-lg-12 padding-0 padding-t-5 fc-event-text-holder'><div><span data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+a.startTime+"' data-appointmentEndTime='"+a.endTime+"'  data-appointmentDate='"+a.slotDate+"' data-appointmentUserId='"+D+"' data-appointmentId='"+C+"' id='1111'  data-slotId='"+E+"' class='"+v+"' style='float:left;'>"+l+"-"+m+" <i data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+a.startTime+"' data-appointmentEndTime='"+a.endTime+"'  data-appointmentDate='"+a.slotDate+"' data-appointmentUserId='"+D+"' data-appointmentId='"+C+"' data-slotId='"+E+"' class='glyphicon calendar-appointment-menu-style "+h+"' id='1111' aria-hidden='true'></i></span> "+F+"</div>","CAL_PROCESS"==c.entityType.code&&(g=g+" <div><span class='"+v+"'>Capacity:"+a.capacity+"  Remaining:"+a.capacityRemaining+"</span></div>",c.doctorsAssoctiated&&(g=g+" <div><span class='"+v+" text-ellipsis'>Doctors:",angular.forEach(c.doctorsAssoctiated,function(a,b){g=0==b?g+" "+a:g+","+a}),g+=" </span></div>")),g+=" </div></div>"})}else{var j=new Date;c.eventStartTime&&(j.setHours(c.eventStartTime.substring(0,2)),j.setMinutes(c.eventStartTime.substring(3,5)));var k=new Date;c.eventEndTime&&(k.setHours(c.eventEndTime.substring(0,2)),k.setMinutes(c.eventEndTime.substring(3,5)));var o="";c.doctorsAssoctiated?(o+="<span class='fc-event-text text-ellipsis' style='width: 40%;float:left;'> Dr.",angular.forEach(c.doctorsAssoctiated,function(a,b){o=0==b?o+" "+a:o+","+a}),o+=" </span>"):c.doctorName&&c.locationName&&(o=o+"<span class='fc-event-text text-ellipsis' style='width: 40%;float:left;'> Dr."+c.doctorName+"  Location-:"+c.locationName,o+=" </span>");var n="event-booked-slots",l=b("date")(j,"hh:mm a"),m=b("date")(k,"hh:mm a");g=g+" <div class='col-sm-12 col-md-12 col-lg-12 padding-0 calendar-event-text-style "+n+" ' id='12' style='height:100%'><div id='54' class='col-sm-12 col-md-12 col-lg-12 padding-0 padding-t-5 fc-event-text-holder'><span id='1111' data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+c.eventStartTime+"' data-appointmentEndTime='"+c.eventEndTime+"'  data-appointmentDate='"+c.eventDate+"' data-appointmentUserId='"+c.eventUserId+"' data-appointmentId='"+c.appointmentId+"' class='fc-event-text' style='float:left;'>"+l+"-"+m+" <i data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+c.eventStartTime+"' data-appointmentEndTime='"+c.eventEndTime+"'  data-appointmentDate='"+c.eventDate+"' data-appointmentUserId='"+c.eventUserId+"' data-appointmentId='"+c.appointmentId+"'  class='glyphicon calendar-appointment-menu-style "+h+"' id='1111' aria-hidden='true'></i></span> "+o,c.entityType&&"CAL_PROCESS"==c.entityType.code&&(g=g+"<span class='fc-event-text'> Process Name:"+c.entityName+"</span>"),g+=" </div></div>"}}else{var p="",q=new Date,r=c.eventSlots[0].slotDate.split("-"),s=c.eventEndTime.split(":"),t=parseInt(r[1])-1,u=t.toString(),v=new Date(r[0],u,r[2],s[0],s[1],s[2]);/*var appDate = new Date(event.eventSlots[0].slotDate + " " + event.eventEndTime);*/
p=v.getTime()>=q.getTime()?"new-date-calendar-event":"old-date-calendar-event",g='<div id="99" class="btn-group col-sm-12 col-md-12 col-lg-12 padding-0 '+p+' abc" ng-class="toggleClass" style="height: 100%;"><div href="abc" id="444" class="col-sm-12 col-md-2 col-lg-2 padding-0 event-icon-holder-month dropdown-toggle dropDownBtnLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >',c.eventType?"CAL_EVENT_APPT"==c.eventType.code?g+='<i class="fa fa-check calender-event-menu-monthicon"  aria-hidden="true"></i>':"CAL_EVENT_HOME_VISIT"==c.eventType.code?g+='<i class="fa fa-home calender-event-menu-monthicon" aria-hidden="true"></i>':"CAL_EVENT_ONLINE"==c.eventType.code?g+='<i class="fa fa-wifi calender-event-menu-monthicon" aria-hidden="true"></i>':"CAL_EVENT_SELF_NORMAL"==c.eventType.code&&(g+='<i class="calender-self-normal-icon calender-event-menu-monthicon" aria-hidden="true"></i>'):g+='<i class="fa fa-user-plus calender-event-menu-monthicon" aria-hidden="true"></i>',g+='</div><div id="555" class="col-sm-12 col-md-10 col-lg-10 padding-0 calendar-event-monthtext-div" style="">';var j=new Date;c.eventStartTime&&(j.setHours(c.eventStartTime.substring(0,2)),j.setMinutes(c.eventStartTime.substring(3,5)));var k=new Date;c.eventEndTime&&(k.setHours(c.eventEndTime.substring(0,2)),k.setMinutes(c.eventEndTime.substring(3,5)));var l=b("date")(j,"hh:mm a"),m=b("date")(k,"hh:mm a");g=g+" <div class='col-sm-12 col-md-12 col-lg-12 padding-0 calendar-event-text-style' id='12'><div id='54' class='col-sm-12 col-md-12 col-lg-12 padding-0 fc-event-text-holder' style='height:20px;'><span id='1111' data-appointmentType='"+c.appointmentType+"' class='fc-event-text'>"+l+"-"+m+" <i data-appointmentType='"+c.appointmentType+"' class='glyphicon calendar-appointment-menu-style "+h+"' id='1111' aria-hidden='true'></i></span></div></div>"}g+="</div></div><div class='event-menu-list'></div>",a.html(g),a.css("background-color","#ebebeb"),a.css("border-color","#959595"),a.css("color","#959595"),a.css("overflow","inherit")}else{g='<div id="99" class="btn-group col-sm-12 col-md-12 col-lg-12 padding-0 abc" ng-class="toggleClass" style="height: 100%;"><div href="abc" id="444" class="col-sm-12 col-md-2 col-lg-2 padding-0 exception-icon-holder-week dropdown-toggle dropDownBtnLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >';var h="";"FCFS"!=c.appointmentType&&(h="glyphicon-chevron-right"),g+='</div><div id="555" class="col-sm-12 col-md-10 col-lg-10 padding-0 calendar-event-weektext-div" style="">';var j=new Date;c.eventStartTime&&(j.setHours(c.eventStartTime.substring(0,2)),j.setMinutes(c.eventStartTime.substring(3,5)));var k=new Date;c.eventEndTime&&(k.setHours(c.eventEndTime.substring(0,2)),k.setMinutes(c.eventEndTime.substring(3,5)));var l=b("date")(j,"hh:mm a"),m=b("date")(k,"hh:mm a");g=g+" <div class='col-sm-12 col-md-12 col-lg-12 padding-0 calendar-event-text-style' id='12' style='height:100%'><div id='54'  class='col-sm-12 col-md-12 col-lg-12 padding-0 padding-t-5 fc-event-text-holder'><span id='1111' data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+c.eventStartTime+"' data-appointmentEndTime='"+c.eventEndTime+"'  data-appointmentDate='"+c.eventDate+"' data-appointmentUserId='"+c.eventUserId+"' data-appointmentId='"+c.appointmentId+"' class='fc-event-text'>"+l+"-"+m+" <i data-appointmentType='"+c.appointmentType+"' data-appointmentTime='"+c.eventStartTime+"' data-appointmentEndTime='"+c.eventEndTime+"'  data-appointmentDate='"+c.eventDate+"' data-appointmentUserId='"+c.eventUserId+"' data-appointmentId='"+c.appointmentId+"' class='glyphicon calendar-appointment-menu-style "+h+"' id='1111' aria-hidden='true'></i></span> </div></div>",a.html(g),a.find("div.fc-content").prepend('<i class="calendar-event-menu" aria-hidden="true"></i>'),a.css("background-color","#ffe8e8"),a.css("border-color","#d73636"),a.css("cursor","pointer"),a.css("color","#d73636")}},this.convertCalendarObject=function(a,c,d,f){if(a.mondayObject={},a.tuesdayObject={},a.wednesdayObject={},a.thursdayObject={},a.fridayObject={},a.saturdayObject={},a.sundayObject={},"Server"==f){angular.forEach(c.defaultAvailablity,function(b,d){angular.forEach(b.defaultWorkingDays,function(d,f){angular.isUndefined(b.defaultStartTime)||("Monday"==d?e.isEmpty(a.mondayObject)?(a.mondayObject={day:"MONDAY",id:b.id,organizationLocationId:c.organizationLocationId,version:0},a.mondayObject.timings=[{startTime:b.defaultStartTime,endTime:b.defaultEndTime}]):a.mondayObject.timings.push({startTime:b.defaultStartTime,endTime:b.defaultEndTime}):"Tuesday"==d?e.isEmpty(a.tuesdayObject)?(a.tuesdayObject={day:"TUESDAY",id:b.id,organizationLocationId:c.organizationLocationId,version:0},a.tuesdayObject.timings=[{startTime:b.defaultStartTime,endTime:b.defaultEndTime}]):a.tuesdayObject.timings.push({startTime:b.defaultStartTime,endTime:b.defaultEndTime}):"Wednesday"==d?e.isEmpty(a.wednesdayObject)?(a.wednesdayObject={day:"WEDNESDAY",id:b.id,organizationLocationId:c.organizationLocationId,version:0},a.wednesdayObject.timings=[{startTime:b.defaultStartTime,endTime:b.defaultEndTime}]):a.wednesdayObject.timings.push({startTime:b.defaultStartTime,endTime:b.defaultEndTime}):"Thursday"==d?e.isEmpty(a.thursdayObject)?(a.thursdayObject={day:"THURSDAY",id:b.id,organizationLocationId:c.organizationLocationId,version:0},a.thursdayObject.timings=[{startTime:b.defaultStartTime,endTime:b.defaultEndTime}]):a.thursdayObject.timings.push({startTime:b.defaultStartTime,endTime:b.defaultEndTime}):"Friday"==d?e.isEmpty(a.fridayObject)?(a.fridayObject={day:"FRIDAY",id:b.id,organizationLocationId:c.organizationLocationId,version:0},a.fridayObject.timings=[{startTime:b.defaultStartTime,endTime:b.defaultEndTime}]):a.fridayObject.timings.push({startTime:b.defaultStartTime,endTime:b.defaultEndTime}):"Saturday"==d?e.isEmpty(a.saturdayObject)?(a.saturdayObject={day:"SATURDAY",id:b.id,organizationLocationId:c.organizationLocationId,version:0},a.saturdayObject.timings=[{startTime:b.defaultStartTime,endTime:b.defaultEndTime}]):a.saturdayObject.timings.push({startTime:b.defaultStartTime,endTime:b.defaultEndTime}):"Sunday"==d?e.isEmpty(a.sundayObject)?(a.sundayObject={day:"SUNDAY",id:b.id,organizationLocationId:c.organizationLocationId,version:0},a.sundayObject.timings=[{startTime:b.defaultStartTime,endTime:b.defaultEndTime}]):a.sundayObject.timings.push({startTime:b.defaultStartTime,endTime:b.defaultEndTime}):alert("Wrong Input Value"))})}),c.defaultAvailablity.splice(0,c.defaultAvailablity.length),e.isEmpty(a.mondayObject)?d.nonWorkingDays.push("MONDAY"):c.defaultAvailablity.push(a.mondayObject),e.isEmpty(a.tuesdayObject)?d.nonWorkingDays.push("TUESDAY"):c.defaultAvailablity.push(a.tuesdayObject),e.isEmpty(a.wednesdayObject)?d.nonWorkingDays.push("WEDNESDAY"):c.defaultAvailablity.push(a.wednesdayObject),e.isEmpty(a.thursdayObject)?d.nonWorkingDays.push("THURSDAY"):c.defaultAvailablity.push(a.thursdayObject),e.isEmpty(a.fridayObject)?d.nonWorkingDays.push("FRIDAY"):c.defaultAvailablity.push(a.fridayObject),e.isEmpty(a.saturdayObject)?d.nonWorkingDays.push("SATURDAY"):c.defaultAvailablity.push(a.saturdayObject),e.isEmpty(a.sundayObject)?d.nonWorkingDays.push("SUNDAY"):c.defaultAvailablity.push(a.sundayObject);var g=!0;return 1==g&&angular.forEach(c.defaultAvailablity,function(a,b){angular.forEach(a.timings,function(b,c){angular.forEach(a.timings,function(a,b){})})}),1==g&&c.defaultAvailablity}if("Client"==f)/*$scope.calendarObject.defaultAvailabilities=$scope.availablityObject;*/
return angular.forEach(d.defaultAvailabilities,function(b,c){angular.forEach(b.timings,function(c,d){if(!angular.isUndefined(c.startTime)&&!angular.isUndefined(c.endTime)){angular.isUndefined(a.availablityObject)&&(a.availablityObject=[]);var e=new Date;c.startTime&&(e.setHours(c.startTime.substring(0,2)),e.setMinutes(c.startTime.substring(3,5)));var f=new Date;if(c.endTime&&(f.setHours(c.endTime.substring(0,2)),f.setMinutes(c.endTime.substring(3,5))),0==a.availablityObject.length){var g={};g[b.day.toLowerCase()]=!0,g.startTime=e,g.endTime=f,a.availablityObject.push(g)}else{var h=!1;if(angular.forEach(a.availablityObject,function(a,c){angular.isUndefined(a)||0==h&&a.startTime.getHours()==e.getHours()&&a.startTime.getMinutes()==e.getMinutes()&&a.endTime.getHours()==f.getHours()&&a.endTime.getMinutes()==f.getMinutes()&&(a[b.day.toLowerCase()]=!0,h=!0)}),0==h){var g={};g[b.day.toLowerCase()]=!0,g.startTime=e,g.endTime=f,a.availablityObject.push(g)}}}})}),c.professional=a.calendarObject.name,c.requestStartDate=b("date")(a.calendarObject.startDate,"MM/dd/yyyy"),c.requestEndDate=b("date")(a.calendarObject.endDate,"MM/dd/yyyy"),c.id=a.calendarObject.id,c.organizationLocationId=a.calendarObject.organizationLocationId,c.version=a.calendarObject.version,c.organizationId=a.calendarObject.organizationId,c.defaultAvailablity=a.availablityObject,c},this.dateFormatter=function(a){var b=new Date(a),c=("0"+(b.getMonth()+1)).slice(-2),d=("0"+b.getDate()).slice(-2),e=b.getFullYear();return e+"-"+c+"-"+d},this.removeSpecificObject=function(a,b){for(var c=0;c<=a.length;c++)if(a[c].name==b.name){a.splice(c,1);break}},this.eventValidate=function(a,b,c,d){for(var e=0;e<d.events.length;e++)if(d.events[e].title==c||d.events[e].start==a)return!1;return!0},this.addZero=function(a){var b="";return a<10&&(b="0"+a),b},this.getMyCalendar=function(b,d,e){a.postData(c.getUrl("GET_PATIENTS_CALENDAR"),b,function(a){d(a.data)},function(a){e(a)})},this.getMyAppointmentList=function(b,d,e){a.postData(c.getUrl("GET_MY_APPOINTMENT_LIST"),b,function(a){d(a.data)},function(a){e(a)})},this.getIndividualCalendarList=function(b,d,e){a.postData(c.getUrl("GET_INDIVIDUAL_CALENDAR_LIST"),b,function(a){d(a.data)},function(a){e(a)})},this.getConversationIdForAppointment=function(b,d,e){a.postData(c.getUrl("GET_SKYPE_CONVERSATION_ID_FOR_APPOINTMENT"),b,function(a){d(a.data)},function(a){e(a)})},this.getConversationIdForAppointmentAgora=function(b,d,e){a.postData(c.getUrl("GET_SKYPE_CONVERSATION_ID_FOR_APPOINTMENT_FOR_AGORA"),b,function(a){d(a.data)},function(a){e(a)})},this.getConversationIdForAppointmentForDoc=function(b,d,e){a.putData(c.getUrl("GET_CONVERSATION_ID_FOR_APPOINTMENT_FOR_DOC"),b,function(a){d(a.data)},function(a){e(a)})},this.getConversationIdForAppointmentForDocAgora=function(b,d,e){a.putData(c.getUrl("GET_CONVERSATION_ID_FOR_APPOINTMENT_FOR_DOC_AGORA"),b,function(a){d(a.data)},function(a){e(a)})},this.postpondProcessAppointment=function(b,d,e){a.putData(c.getUrl("POSTPOND_APPOINTMENT_FOR_PROCESS"),b,function(a){d(a.data)},function(a){e(a)})},this.postpondRegularAppointment=function(b,d,e){a.putData(c.getUrl("POSTPOND_APPOINTMENT_FOR_OTHER"),b,function(a){d(a.data)},function(a){e(a)})},this.cancelAppointment=function(b,d,e){a.putData(c.getUrl("CANCEL_APPOINTMENT"),b,function(a){d(a.data)},function(a){e(a)})},this.cancelCustomAppointment=function(b,d,e){a.putData(c.getParameterizedUrl("CANCEL_CUSTOM_APPOINTMENT",b),null,function(a){d(a.data)},function(a){e(a)})},this.viewCustomAppointment=function(b,d,e){a.getData(c.getParameterizedUrl("VIEW_CUSTOM_APPOINTMENT",b),null,function(a){d(a.data)},function(a){e(a)})},this.getCalendarDetailsById=function(b,d,e){a.postData(c.getUrl("GET_CALENDAR_DETAILS_BY_ID"),b,function(a){d(a.data)},function(a){e(a)})},this.getCalendarDetailsByIdForCardView=function(b,d,e){a.postData(c.getUrl("GET_CALENDER_DETAILS_FOR_CARDVIEW"),b,function(a){d(a.data)},function(a){e(a)})},this.getEventListByType=function(b,d,e){a.postData(c.getUrl("GET_EVENT_LIST_BY_TYPE"),b,function(a){d(a.data)},function(a){e(a)})},this.postponeAdhocAppointment=function(b,d,e){a.putData(c.getUrl("POSTPONE_ADHOC_APPOINTMENT"),b,function(a){d(a.data)},function(a){e(a)})},this.getOrganizationCallType=function(b,d,e){var f={};f.orgId=b.id,a.getData(c.getParameterizedUrl("GET_ORGANIZATION_ONLINE_CALL_TYPE",f),null,function(a){d(a.data)},function(a){e(a)})},this.getAvailableTimings=function(b,d,e){a.getData(c.getParameterizedUrl("GET_AVAILABLE_POSTPONE_TIME",b),null,function(a){d(a.data)},function(a){e(a)})},this.getCalendarExceptionStatus=function(b,d){a.getData(c.getUrl("GET_CALENDAR_EXCEPTION_STATUSES"),null,function(a){b(a.data)},function(a){d(a)})},this.approveDayException=function(b,d,e){a.putData(c.getParameterizedUrl("APPROVE_DAY_EXCEPTION",b),null,function(a){d(a.data)},function(a){e(a)})},this.rejectDayException=function(b,d,e){a.putData(c.getUrl("REJECT_DAY_EXCEPTION"),b,function(a){d(a.data)},function(a){e(a)})},this.getCalendarByUserLocationId=function(b,d,e){a.getData(c.getParameterizedUrl("GET_CALENDAR_BY_USER_LOCATION_ID",b),null,function(a){d(a.data)},function(a){e(a)})},this.getTrustedCalendarByUserLocationId=function(b,d,e){a.getData(c.getParameterizedUrl("GET_TRUSTED_CALENDAR_BY_USER_LOCID",b),null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.fullCalendarModule").service("createCalendarService",["httpService","urlService","$filter","commonCalendarService","dateconvertor","utilService","notify","$translate","$rootScope",function(a,b,c,d,e,f,g,h,i){"use strict";this.createCalendarMethod=function(f,j,k,l,m,n){var o=!0;angular.forEach(k,function(a,b){var d=[],e={};a.monday&&d.push("Monday"),a.tuesday&&d.push("Tuesday"),a.wednesday&&d.push("Wednesday"),a.thursday&&d.push("Thursday"),a.friday&&d.push("Friday"),a.saturday&&d.push("Saturday"),a.sunday&&d.push("Sunday"),e.defaultWorkingDays=d;var f=a.startTime,g=a.endTime;e.defaultStartTime=c("date")(f,"HH:mm"),e.defaultEndTime=c("date")(g,"HH:mm"),l.defaultAvailablity.push(e)}),angular.forEach(l.defaultAvailablity,function(a,b){a.defaultStartTime>a.defaultEndTime&&(g("Error",h.instant("END_TIME_GREATER_THAN_START_TIME")),o=!1,i.showSpinner=!1)});var p=d.convertCalendarObject(f,l,j,"Server");p||n(!0),j.defaultAvailabilities=p,delete j.nonWorkingDays,j.startDate&&(j.startDate=e.convertToServerDate(j.startDate)),j.endDate&&(j.endDate=e.convertToServerDate(j.endDate)),this.validateAvailability(j.defaultAvailabilities)?o&&a.postData(b.getParameterizedUrl("CREATE_CALENDAR",j),j,function(a){m()},function(a){n(!1)}):(i.showSpinner=!1,g("error",h.instant("INVALID_AVAILABILITY_COMBINATIONS")))},/*this.updateDayAvailability=function(eventObject,successCallback,errorCallBack){
            httpService.postData(urlService.getUrl('DAY_AVAILABILITY'), eventObject,
                function (response) {
                        successCallback();
                },
                function (error) {
                    errorCallBack();
                });
        }*/
this.validateAvailability=function(a){var b=!0;return angular.forEach(a,function(a,c){var d=angular.copy(a);angular.forEach(a.timings,function(a,c){var e=new Date,f=new Date;e.setHours(parseInt(a.startTime.substring(0,2))),e.setMinutes(parseInt(a.startTime.substring(3,5))),f.setHours(parseInt(a.endTime.substring(0,2))),f.setMinutes(parseInt(a.endTime.substring(3,5))),angular.forEach(d.timings,function(a,d){var g=new Date,h=new Date;g.setHours(parseInt(a.startTime.substring(0,2))),g.setMinutes(parseInt(a.startTime.substring(3,5))),h.setHours(parseInt(a.endTime.substring(0,2))),h.setMinutes(parseInt(a.endTime.substring(3,5))),(e.getTime()<g.getTime()&&f.getTime()>g.getTime()||e.getTime()<h.getTime()&&f.getTime()>h.getTime())&&c!=d&&(b=!1)})})}),b},this.getOrganizations=function(c){a.postData(b.getUrl("GET_ORG"),null,function(a){c(a)},function(a){})}}]),angular.module("paripal.fullCalendarModule").service("createEventService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.saveCreateEvent=function(c,d,f){c.startTime=e("date")(c.startTime,"H:mm"),c.endTime=e("date")(c.endTime,"H:mm"),a.postData(b.getUrl("CREATE_DAY_EVENT"),c,function(a){a.data?d(a.data):f(a)},function(a){f(a)})},this.saveDateStatus=function(c,d,e){a.postData(b.getUrl("SAVE_DAY_STATUS"),c,function(a){a.data?d(a.data):e(a)},function(a){e(a)})},this.getListOfEventsByDate=function(c,d,e,f,g){var h={};h.date=c,h.calendarId=d,h.entityId=e.entityId,h.organizationLocationId=e.organizationLocationId,h.entityType=e.entityType,a.postData(b.getUrl("GET_LIST_EVENT_BY_DATE"),h,function(a){a.data?f(a.data):g(a)},function(a){g(a)})},this.updateDayDetails=function(c,d,e){a.postData(b.getUrl("DAY_AVAILABILITY"),c,function(a){a.data?d(a.data):e(a)},function(a){e(a)})},this.updateEventDetails=function(c,d,f,g,h){c.startTime=e("date")(c.startTime,"H:mm"),c.endTime=e("date")(c.endTime,"H:mm"),c.calendarMaster={},c.calendarMaster.id=d,c.entityId=f,delete c.et,delete c.st;var i={};i.id=c.id,a.putData(b.getParameterizedUrl("UPDATE_DAY_EVENT",i),c,function(a){a.data?g(a.data):h(a)},function(a){h(a)})},this.getExceptionDetails=function(c,d,e,f,g,h){var i={};i.calendarId=c.calendarId,i.organizationLocationId=c.organizationLocationId,i.entityId=c.entityId,i.entityType=c.entityType,i.date=e,i.eventId=d,i.eventException=f,a.postData(b.getUrl("EXCEPTION_DETAILS"),i,function(a){g(a.data)},function(a){h()})},this.deleteEvent=function(c,d,e){var f={};f.eventId=c.id,a.deleteData(b.getParameterizedUrl("DELETE_EVENT",f),null,function(a){d(a.data)},function(a){e()})}}]),angular.module("paripal.fullCalendarModule").service("customAppointmentService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){this.createCustomAppointment=function(d,e,f){var g={};angular.copy(d,g),g.apptStartTime=b("date")(g.apptStartTime,"HH:mm:ss"),g.apptEndTime=b("date")(g.apptEndTime,"HH:mm:ss"),a.postData(c.getUrl("SAVE_CUSTOM_APPOINTMENT"),g,function(a){e(a)},function(a){f(a)})}}]),angular.module("paripal.fullCalendarModule").service("editCalendarService",["httpService","urlService","$filter","commonCalendarService","dateconvertor","utilService","notify","$translate","$rootScope",function(a,b,c,d,e,f,g,h,i){"use strict";var j=this;this.editCalendarMethod=function(f,k,l,m,n,o){var p=!0;angular.forEach(l,function(a,b){var d=[],e={};a.monday&&d.push("Monday"),a.tuesday&&d.push("Tuesday"),a.wednesday&&d.push("Wednesday"),a.thursday&&d.push("Thursday"),a.friday&&d.push("Friday"),a.saturday&&d.push("Saturday"),a.sunday&&d.push("Sunday"),e.defaultWorkingDays=d;var f=a.startTime,g=a.endTime;e.defaultStartTime=c("date")(f,"H:mm"),e.defaultEndTime=c("date")(g,"H:mm"),m.defaultAvailablity.push(e)}),angular.forEach(m.defaultAvailablity,function(a,b){j.toTime(a.defaultStartTime)>j.toTime(a.defaultEndTime)&&(g("Error",h.instant("END_TIME_GREATER_THAN_START_TIME")),p=!1)});var q=d.convertCalendarObject(f,m,k,"Server");if(k.defaultAvailabilities=q,delete k.nonWorkingDays,k.startDate&&(k.startDate=e.convertToServerDate(k.startDate)),k.endDate&&(k.endDate=e.convertToServerDate(k.endDate)),this.validateAvailability(k.defaultAvailabilities)){var r={};r.id=k.id,p&&a.putData(b.getParameterizedUrl("EDIT_CALENDAR",r),k,function(a){n()},function(a){o()})}else i.showSpinner=!1,g("error",h.instant("INVALID_AVAILABILITY_COMBINATIONS"))},this.validateAvailability=function(a){var b=!0;return angular.forEach(a,function(a,c){var d=angular.copy(a);angular.forEach(a.timings,function(a,c){var e=new Date,f=new Date;e.setHours(parseInt(a.startTime.substring(0,2))),e.setMinutes(parseInt(a.startTime.substring(3,5))),f.setHours(parseInt(a.endTime.substring(0,2))),f.setMinutes(parseInt(a.endTime.substring(3,5))),angular.forEach(d.timings,function(a,d){var g=new Date,h=new Date;g.setHours(parseInt(a.startTime.substring(0,2))),g.setMinutes(parseInt(a.startTime.substring(3,5))),h.setHours(parseInt(a.endTime.substring(0,2))),h.setMinutes(parseInt(a.endTime.substring(3,5))),(e.getTime()<g.getTime()&&f.getTime()>g.getTime()||e.getTime()<h.getTime()&&f.getTime()>h.getTime())&&c!=d&&(b=!1)})})}),b},this.linkCalendarMethod=function(c,d,e){var f={};f.id=c.id,f.organizationLocationId=c.organizationLocationId,f.entityId=c.entityId,f.entityType=c.entityType,a.postData(b.getUrl("LINK_CALENDAR"),f,function(a){d()},function(a){e()})},this.getOrganizations=function(c){a.postData(b.getUrl("GET_ORG"),null,function(a){c(a)},function(a){})},this.toTime=function(a){var b=a.split(":");return new Date(1970,0,1,b[0],b[1])}}]),angular.module("paripal.appointmentModule").service("manageCalendarEventService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveCalendarEvent=function(d,e,f,g){if(d){var h={};if(//angular.copy(processAssociationObj);
h.id=d.id,h.version=d.version,d.orgLocation&&d.orgLocation.id&&(h.organizationLocationId=d.orgLocation.id),d.calendarMaster&&d.calendarMaster.id&&(h.calendarMasterId=d.calendarMaster.id),/*if (calendarEventObj.eventDate && calendarEventObj.eventDate) {
                    WSCalendarEvent.eventDate= dateconvertor.convertToServerDate(calendarEventObj.eventDate);
                }*/
d.repeatFrequency&&d.repeatFrequency.id&&(h.repeatFrequency=d.repeatFrequency.id),d.eventName&&(h.eventName=d.eventName),d.eventStartTime&&(h.eventStartTime=d.eventStartTime.getHours()+":"+d.eventStartTime.getMinutes()+":00"),d.eventEndTime&&(h.eventEndTime=d.eventEndTime.getHours()+":"+d.eventEndTime.getMinutes()+":00"),/*if (calendarEventObj.isException) {
                    WSCalendarEvent.isException= calendarEventObj.isException;
                }else{
                    WSCalendarEvent.isException = false;
                }*/
d.eventStartDate&&(h.eventStartDate=c.convertToServerDate(d.eventStartDate)),d.eventEndDate&&(h.eventEndDate=c.convertToServerDate(d.eventEndDate)),d.eventType&&d.eventType.id&&(h.eventTypeId=d.eventType.id),d.entityType&&d.entityType.id&&(h.entityTypeId=d.entityType.id),d.entityName&&d.entityName.id&&(h.entityId=d.entityName.id),/*if (calendarEventObj.process && calendarEventObj.process.id) {
                    WSCalendarEvent.processId= calendarEventObj.process.id;
                }
                if (calendarEventObj.professionalId) {
                    WSCalendarEvent.professionalId = calendarEventObj.professional.id;
                }
                if (calendarEventObj.equipmentId) {
                    WSCalendarEvent.equipmentId= calendarEventObj.equipmentId;
                }*/
d.isRepeat?h.isRepeat=d.isRepeat:h.isRepeat=!1,d.isMondayRepeat?h.isMondayRepeat=d.isMondayRepeat:h.isMondayRepeat=!1,d.isTuesdayRepeat?h.isTuesdayRepeat=d.isTuesdayRepeat:h.isTuesdayRepeat=!1,d.isWednesdayRepeat?h.isWednesdayRepeat=d.isWednesdayRepeat:h.isWednesdayRepeat=!1,d.isThursdayRepeat?h.isThursdayRepeat=d.isThursdayRepeat:h.isThursdayRepeat=!1,d.isFridayRepeat?h.isFridayRepeat=d.isFridayRepeat:h.isFridayRepeat=!1,d.isSaturdayRepeat?h.isSaturdayRepeat=d.isSaturdayRepeat:h.isSaturdayRepeat=!1,d.isSundayRepeat?h.isSundayRepeat=d.isSundayRepeat:h.isSundayRepeat=!1,d.isRoundRobin?h.isRoundRobin=d.isRoundRobin:h.isRoundRobin=!1,/*if (calendarEventObj.isAutoRefund) {
                    WSCalendarEvent.isAutoRefund= calendarEventObj.isAutoRefund;
                }else{
                    WSCalendarEvent.isAutoRefund = false;
                }*/
d.paymentToBeTaken&&(h.paymentToBeTaken=d.paymentToBeTaken),d.appointmentType&&(h.appointmentType=d.appointmentType),d.slotSize&&(h.slotSize=d.slotSize),d.capacity&&(h.capacity=d.capacity),d.isAllowBookingForFCFS&&(h.isAllowBookingForFCFS=d.isAllowBookingForFCFS),d.roomName&&(h.roomName=d.roomName),d.advanceBookingDaysLimit&&(h.advanceBookingDaysLimit=d.advanceBookingDaysLimit),d.autoRefundTimeLimit&&(h.autoRefundTimeLimit=d.autoRefundTimeLimit),d.autoRefundTimeLimit&&(h.autoRefundTimeLimit=d.autoRefundTimeLimit),"add"===e)a.postData(b.getUrl("SAVE_CALENDAR_EVENT"),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)});else{var i={};i.id=d.id,a.putData(b.getParameterizedUrl("UPDATE_DAY_EVENT",i),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)})}}},this.getCalendarEventDetails=function(c,d){var e={};e.id=c,a.getData(b.getParameterizedUrl("GET_CALENDAR_EVENT_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.searchCalendarEventException=function(c,d,e,f){var g={};c.eventId&&(g.eventId=c.eventId),g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,c.sorters&&(g.sorters=c.sorters),a.postDataWithHeader(b.getParameterizedUrl("GET_EVENT_EXCEPTION_BY_EVENT_ID",{eventId:c.eventId}),g,d,function(a){e(a.data)},function(a){f(a)})},this.saveCalendarEventException=function(d,e,f,g){if(d){var h={};d.id&&(h.id=d.id),d.version&&(h.version=d.version),d.eventId&&(h.eventId=d.eventId),d.exceptionDate&&(h.exceptionDate=c.convertToServerDate(d.exceptionDate)),d.appointmentType&&(h.appointmentType=d.appointmentType),d.capacity&&(h.capacity=d.capacity),d.roomName&&(h.roomName=d.roomName),d.eventStartTime&&(h.startTime=d.eventStartTime.getHours()+":"+d.eventStartTime.getMinutes()+":00"),d.eventEndTime&&(h.endTime=d.eventEndTime.getHours()+":"+d.eventEndTime.getMinutes()+":00"),d.isCancelled?h.isCancelled=d.isCancelled:h.isCancelled=!1,d.reason&&(h.reason=d.reason),d.slotSize&&(h.slotSize=d.slotSize),"add"===e?a.postData(b.getUrl("SAVE_CALENDAR_EVENT_EXCEPTION"),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)}):a.putData(b.getParameterizedUrl("UPDATE_CALENDAR_EVENT_EXCEPTION",{id:h.id}),h,function(a){f(a&&a.data?a.data:a)},function(a){g(a)})}},this.getCalendarEventException=function(c,d){var e={};e.id=c,a.getData(b.getParameterizedUrl("GET_CALENDAR_EVENT_EXCEPTION_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}}]),angular.module("paripal.userIdentify").controller("UserIdentifyListCtrl",["$scope","$rootScope","datatableconfig","userIdDocumentService","utilService","serverSidePagination","notify","$translate","$state","fileOperations","userIdentifyService","httpService","urlService","commonConstants","$stateParams","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.userIdentifyListSpinner=!1,a.userList=[],a.userIdentifyDetail={},a.userIdentifyDetail.isUserMode=!0,a.commonConstants=n,a.status={open:!0},a.currentPage=n.defaultPageNo,a.itemPerPage=6,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.documentTypeList=new Array,a.organizationList=new Array,a.isDisable="false",a.loadListOfDocumentType=function(){d.loadListOfDocumentType(function(b){e.isEmpty(b)||(b.splice(b.map(function(a){return a.subType}).indexOf("PROFILE_PHOTO"),1),a.documentTypeList=b)},function(a){})},a.loadListOfOrganizations=function(){k.loadListOfOrganizations(function(b){e.isEmpty(b)||(a.organizationList=b)},function(a){})},a.getCities=function(b){return a.cityData={},a.cityData.cityName=b,a.cityNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("FIND_CITY_BY_NAME",a.cityData),null,function(b){return a.cityNameAutoCmpLoading=!1,a.cityNames=angular.fromJson(b.data)},function(b){a.cityNameAutoCmpLoading=!1})},a.getUserNames=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.userNames=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.getUsersByCriteria=function(){var b=angular.copy(a.userIdentifyDetail);if(delete b.isUserMode,e.isFieldEmpty(b.firstName)&&e.isFieldEmpty(b.lastName)&&e.isFieldEmpty(b.userName)&&e.isFieldEmpty(b.mobileNumber)&&a.userIdentifyDetail.isUserMode)g("warning",p("translate")("ONE_OF_THE_FOUR_FIELDS"));else{var c=new Object;if(c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,e.isEmpty(a.userIdentifyDetail))g("Error",h.instant("SELECT_SEARCH_CRITERIA"));else{var d="";a.userIdentifyDetail.isUserMode?(//User Mode is selected
d="IDENTIFY_PATIENT_BY_USER",e.isNullOrEmpty(a.userIdentifyDetail.mobileNumber)||(c.mobileNo=a.userIdentifyDetail.mobileNumber),/*if (!utilService.isEmpty($scope.userIdentifyDetail.organization) && !utilService.isNullOrEmpty($scope.userIdentifyDetail.organization.id)) {
                            userfilterParamObject.organizationId = $scope.userIdentifyDetail.organization.id;
                        }*/
e.isEmpty(a.userIdentifyDetail.city)||e.isNullOrEmpty(a.userIdentifyDetail.city.id)||(c.cityId=a.userIdentifyDetail.city.id),e.isNullOrEmpty(a.userIdentifyDetail.userName)||(c.userName=a.userIdentifyDetail.userName),e.isNullOrEmpty(a.userIdentifyDetail.firstName)||(c.firstName=a.userIdentifyDetail.firstName),e.isNullOrEmpty(a.userIdentifyDetail.lastName)||(c.lastName=a.userIdentifyDetail.lastName),e.isNullOrEmpty(a.userIdentifyDetail.organizationName)||(c.organizationName=a.userIdentifyDetail.organizationName)):(//Document Mode is selected
d="IDENTIFY_PATIENT_BY_DOCUMENT",c.documentTypeStr=n.documentTypes.userIdDocument,e.isNullOrEmpty(a.userIdentifyDetail.documentType.subType)||(c.documentSubTypeStr=a.userIdentifyDetail.documentType.subType),e.isNullOrEmpty(a.userIdentifyDetail.referenceNo)||(c.referenceNumber=a.userIdentifyDetail.referenceNo)),a.userIdentifyListSpinner=!0,k.getUsersByCriteria(d,c,function(b){b&&(a.userIdentifyListSpinner=!1,e.isEmpty(b.data)?g("Error",h.instant("NO_RESULTS_FOUND")):angular.forEach(b.data,function(a){if(e.isNullOrEmpty(a.userPhotoDocumentId))a.url="app/images/user.jpg";else{var b=new Object;b.fileName=a.fileName,b.resourceId=a.userPhotoDocumentId,b.docType=n.documentTypes.userIdDocument,b.docSubType=n.documentSubTypes.profilePhoto,b.userId=a.userId,j.getImageUrl(b,function(b){a.url=b},function(){})}}),a.userList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems))},function(b){a.userIdentifyListSpinner=!1})}}},a.viewUserImage=function(b){if(!e.isNullOrEmpty(b.userPhotoDocumentId)){var c=new Object;c.fileName=b.fileName,a.fileUserId=b.userId,c.resourceId=b.userPhotoDocumentId,c.docType=n.documentTypes.userIdDocument,c.docSubType=n.documentSubTypes.profilePhoto,a.fileResource=c,a.viewFileContent=!0,a.isHidingPrintButton=!1}};var q=function(){var a=null;e.isFieldEmpty(o.callBackURL)||(a=i.current.name);var b=e.isFieldEmpty(o.callBackURL)?"emergencytransaction":o.callBackURL;if("emergencyrequeststatus"==b){var c=angular.fromJson(localStorage.getItem("sequenceId"));i.go(b,{callbackUrl:i.current.name,callingUrl:a,sequenceId:c})}else{var d="affectedPerson"==o.callingScreen?"step3":"step4";i.go(b,{type:d,callbackUrl:i.current.name,callingUrl:a})}};a.selectPatient=function(a){if(!e.isFieldEmpty(a)){var b={};/*= angular.copy(angular.fromJson(localStorage.getItem('WSEmergencyTransaction')));
                               if (utilService.isFieldEmpty(user)) {
                                   user = {}
                               }
                               if (utilService.isFieldEmpty(user.WSEmergencyTransaction)) {
                                   user.WSEmergencyTransaction = {}
                               }*/
e.isFieldEmpty(o.callingScreen)||"affectedPerson"!=o.callingScreen||(b.affectedPerson={userId:a.userId,firstName:a.firstName,lastName:a.lastName,userPhone:a.cell,userEmail:a.email,isSubscriber:a.whetherSubscriber}),e.isFieldEmpty(o.callingScreen)||"accompanyingPerson"!=o.callingScreen||(b.accompanyingPerson={userId:a.userId,firstName:a.firstName,lastName:a.lastName,userPhone:a.cell,userEmail:a.email,isSubscriber:a.whetherSubscriber}),e.isFieldEmpty(o.callingScreen)||"emergencyRequest"!=o.callingScreen||(b.emergencyPatient={userId:a.userId,firstName:a.firstName,lastName:a.lastName,userPhone:a.cell,userEmail:a.email}),localStorage.setItem("WSUserIdentification",angular.toJson(b)),q()}},a.modeChange=function(b){var c=a.userIdentifyDetail.isUserMode;a.userIdentifyDetail={},a.userList=[],a.userIdentifyDetail.isUserMode=c,a.totalItems=0,a.pagingInfo=null},a.pageChanged=function(){a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems),a.getUsersByCriteria()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getUsersByCriteria()};var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=c.setOptionProperties(r),a.dtColumnDefs=c.setColumnProperties({}),a.clear=function(){var b=a.userIdentifyDetail.isUserMode;a.userIdentifyDetail={},a.userIdentifyDetail.isUserMode=b,a.userList=[],a.totalItems=0,a.pagingInfo=null},a.cancel=function(){q()},a.init=function(){a.loadListOfDocumentType(),a.loadListOfOrganizations(),"calledFromEmergencyTransaction"===o.type?(a.calledFromEmergencyTransaction=!0,e.isFieldEmpty(o.data)||(e.isFieldEmpty(o.data.userPhone)||(a.userIdentifyDetail.mobileNumber=o.data.userPhone),e.isFieldEmpty(o.data.firstName)||(a.userIdentifyDetail.firstName=o.data.firstName),e.isFieldEmpty(o.data.lastName)||(a.userIdentifyDetail.lastName=o.data.lastName),e.isFieldEmpty(o.data.userPhone)&&e.isFieldEmpty(o.data.lastName)&&e.isFieldEmpty(o.data.firstName)||a.getUsersByCriteria())):"calledFromEmergencyRequest"===o.type&&(a.calledFromEmergencyTransaction=!0,e.isFieldEmpty(o.data)||(e.isFieldEmpty(o.data.affectedPerson)||e.isFieldEmpty(o.data.affectedPerson.userPhone)||(a.userIdentifyDetail.mobileNumber=o.data.affectedPerson.userPhone),e.isFieldEmpty(o.data.affectedPerson)||e.isFieldEmpty(o.data.affectedPerson.firstName)||(a.userIdentifyDetail.firstName=o.data.affectedPerson.firstName),e.isFieldEmpty(o.data.affectedPerson)||e.isFieldEmpty(o.data.affectedPerson.lastName)||(a.userIdentifyDetail.lastName=o.data.affectedPerson.lastName),e.isFieldEmpty(a.userIdentifyDetail.mobileNumber)&&e.isFieldEmpty(a.userIdentifyDetail.lastName)&&e.isFieldEmpty(a.userIdentifyDetail.firstName)||a.getUsersByCriteria())),e.isFieldEmpty(o.callBackURL)||(a.showCancelBtn=!0)},a.init()}]),angular.module("paripal.userIdentify").service("userIdentifyService",["httpService","urlService","utilService",function(a,b,c){this.loadListOfOrganizations=function(c,d){a.getData(b.getUrl("FIND_ACTIVE_ORGANIZATIONS"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getUsersByCriteria=function(c,d,e,f){var g=b.getUrl(c);a.postData(g,d,function(a){a&&a.data&&e(a.data)},function(a){f(a)})}}]),angular.module("paripal.importDataModule").directive("fileModel",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b,c[0].files[0])})})}}}]).service("fileUpload",["httpService","urlService",function(a,b){this.uploadFileToUrl=function(c,d){var e=new FormData;e.append("file",new Uint8Array(c)),a.uploadFileData(b.getUrl("IMPORT_FILE"),e,function(a){console.log(a)},function(a){})}}]),angular.module("paripal.importDataModule").controller("ImportDataCtrl",["$scope","commonConstants","datatableconfig","NgMap","httpService","urlService","utilService","notify","ImportDataService","$state","$stateParams","$translate","$filter","fileOperations","$mdDialog","featurePrivilegeConstants","dateconvertor","serverSidePagination","$http","$rootScope","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";/*POP-UP CONTROLLER BEGINS*/
function v(a,b,c,d,g,i,j,k,n){function p(){var b=a.toastPosition;b.bottom&&u.top&&(b.top=!1),b.top&&u.bottom&&(b.bottom=!1),b.right&&u.left&&(b.left=!1),b.left&&u.right&&(b.right=!1),u=angular.extend({},b)}a.orgLocPermission=g.ORGANIZATION_CLIENT_ADD,
//$scope.organization = {};
//$scope.orgLocation = {};
a.fileObj={},a.type=d,a.uploadDocumentObj=new Object,a.uploadDocumentObj.selectedFileArray=new Array,a.createRequest={};var r=k.getDefaultOrgLocation();n.isFieldEmpty(r)||(a.organization=r.org,a.orgLocation=r.orgLoc),
//dropdown for Request type
a.getRequestType=function(){var b={};b.code="REQUEST_TYPE",e.getData(f.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.requestType=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||h("error",l.instant(a.data.messages[0]))})},a.getRequestType();/* locationCategory label changes */
var s=k.getLocationCategory();a.fieldLabel={},n.isFieldEmpty(s)?a.fieldLabel.indUserImport=l.instant("INDIVIDUAL_USER_CLIENT_IMPORT"):"EDUCATIONAL_INSTITUTION"==s.code?(a.fieldLabel.importUser=l.instant("IMPORT_STUDENTS"),a.fieldLabel.indUserImport=l.instant("INDIVIDUAL_USER_STUDENT_IMPORT")):"CORPORATE"==s.code?a.fieldLabel.indUserImport=l.instant("INDIVIDUAL_USER_EMPLOYEE_IMPORT"):"SERVICE_PROVIDER"==s.code&&(a.fieldLabel.indUserImport=l.instant("INDIVIDUAL_USER_CLIENT_IMPORT")),a.importOptions=[{url:"GET_CLIENT_TEMPLATE",value:"CLIENT_DATA",flag:!1},{url:"GET_ORG_USER_TEMPLATE",value:"ORGANIZATION_USERS",flag:!1},{url:"GET_ORGLOC_TEMPLATE",value:"ORGANIZATION_LOCATION",flag:!0},{url:"GET_USER_VACCINATION_TEMPLATE",value:"USER_VACCINATION",flag:!1},{url:"GET_USER_INCIDENT_TEMPLATE",value:"USER_INCIDENT",flag:!1},{url:"GET_USER_SYMPTOM_TEMPLATE",value:"USER_SYMPTOM",flag:!1},{url:"GET_USER_FAMILY_HISTORY_TEMPLATE",value:"USER_FAMILY_HISTORY",flag:!1},{url:"GET_APPOINTMENT_TEMPLATE",value:"APPOINTMENT",flag:!1},{url:"GET_INDIVIDUAL_USER_TEMPLATE",value:"INDIVIDUAL_USER_CLIENT_IMPORT",flag:!1},{url:"GET_CREATE_REQUEST_TEMPLATE",value:"CREATE_REQUEST_IMPORT",flag:!1}],a.clearOrgLoc=function(){a.organization={},a.orgLocation={}},a.uploadFile=function(){var b=a.fileObj.myFile;if(a.fileObj.myFile){var c=a.fileObj.myFile.name;if(c=c.substring(c.indexOf(".")+1),"xls"==c||"xlsx"==c){var d={},g=new FormData;if(n.isFieldEmpty(a.userState))return void h("Warning",m("translate")("PLEASE_SELECT_DOWNLOAD_TEMPLATE_FOR"));if(n.isFieldEmpty(a.organization))return void h("Warning",m("translate")("SELECT_ORG_AND_ORGLOC"));if("GET_ORGLOC_TEMPLATE"===a.userState.url&&(n.isFieldEmpty(a.organization)||g.append("orgId",a.organization.id)),n.isFieldEmpty(a.orgLocation)||(d.orgLocId=a.orgLocation.id,g.append("orgLocId",a.orgLocation.id)),n.isFieldEmpty(a.createRequest.startDate)||(a.newStart=q.convertToServerDate(a.createRequest.startDate),d.startDate=a.newStart,g.append("startDate",a.newStart)),n.isFieldEmpty(a.createRequest.endDate)||(a.newEnd=q.convertToServerDate(a.createRequest.endDate),d.endDate=a.newEnd,g.append("endDate",a.newEnd)),n.isFieldEmpty(a.createRequest.requestTypeName)||(d.requestType=a.createRequest.requestTypeName.id,g.append("requestType",a.createRequest.requestTypeName.id)),n.isNullOrEmpty(b))return void h("Warning",m("translate")("PLEASE_SELECT_FILE"));var i="";if("GET_ORG_USER_TEMPLATE"===a.userState.url?i="importOrgUserFile":"GET_CLIENT_TEMPLATE"===a.userState.url?i="importClientFile":"GET_ORGLOC_TEMPLATE"===a.userState.url?i="importOrgLocFile":"GET_USER_VACCINATION_TEMPLATE"===a.userState.url?i="importUserVaccinationFile":"GET_USER_INCIDENT_TEMPLATE"===a.userState.url?i="importUserIncidentFile":"GET_USER_SYMPTOM_TEMPLATE"===a.userState.url?i="importUserSymptomFile":"GET_USER_FAMILY_HISTORY_TEMPLATE"===a.userState.url?i="importUserFamilyHistoryFile":"GET_APPOINTMENT_TEMPLATE"===a.userState.url?i="importAppointmentFile":"GET_INDIVIDUAL_USER_TEMPLATE"===a.userState.url?i="importIndividualUserClientFile":"GET_CREATE_REQUEST_TEMPLATE"===a.userState.url&&(i="importCreateRequestFile"),g.append(i,b),t.showSpinner=!0,"GET_ORG_USER_TEMPLATE"===a.userState.url){var j=f.getParameterizedUrl("IMPORT_FILE_ORG_USER",d);e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_CLIENT_TEMPLATE"===a.userState.url){var j=f.getParameterizedUrl("IMPORT_FILE_CLIENT",d);e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_ORGLOC_TEMPLATE"===a.userState.url){var j=f.getUrl("UPLOAD_FILE_WITH_ORGID");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_USER_VACCINATION_TEMPLATE"===a.userState.url){var j=f.getUrl("IMPORT_FILE_USER_VACCINATION");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_USER_INCIDENT_TEMPLATE"===a.userState.url){var j=f.getUrl("IMPORT_FILE_USER_INCIDENT");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_USER_SYMPTOM_TEMPLATE"===a.userState.url){var j=f.getUrl("IMPORT_FILE_USER_SYMPTOM");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_USER_FAMILY_HISTORY_TEMPLATE"===a.userState.url){var j=f.getUrl("IMPORT_FILE_USER_FAMILY_HISTORY");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_APPOINTMENT_TEMPLATE"===a.userState.url){var j=f.getUrl("IMPORT_FILE_APPOINTMENT");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_INDIVIDUAL_USER_TEMPLATE"===a.userState.url){var j=f.getUrl("IMPORT_INDIVIDUAL_USER_TEMPLATE");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}else if("GET_CREATE_REQUEST_TEMPLATE"===a.userState.url){var j=f.getUrl("IMPORT_FILE_CREATE_REQUEST");e.uploadFileData(j,g,function(a){a&&a.data&&(t.showSpinner=!1,h("success",l.instant("FILE_IMPORTED_SUCCESSFULLY")))},function(a){t.showSpinner=!1})}}else h("error",l.instant("PLEASE_SELECT_VALID_FILE"))}else h("error",l.instant("PLEASE_SELECT_A_FILE"))},a.downloadFile=function(c,d,e){var g=g||function(a){if(!("undefined"==typeof a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var o,p=this,q=b.type,r=q===j,s=function(){m(p,"writestart progress write writeend".split(" "))},t=function(){if((h||r&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;"),c=a.open(b,"_blank");c||(a.location.href=b),b=void 0,p.readyState=p.DONE,s()},d.readAsDataURL(b),void(p.readyState=p.INIT)}if(o||(o=c().createObjectURL(b)),r)a.location.href=o;else{var e=a.open(o,"_blank");e||(a.location.href=o)}p.readyState=p.DONE,s(),l(o)};return p.readyState=p.INIT,e?(o=c().createObjectURL(b),void setTimeout(function(){d.href=o,d.download=i,f(d),s(),l(o),p.readyState=p.DONE})):void t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);if("undefined"!=typeof module&&module.exports?module.exports.saveAs=g:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return g}),n.isFieldEmpty(a.userState))return void h("Warning",m("translate")("PLEASE_SELECT_DOWNLOAD_TEMPLATE_FOR"));var i=f.getUrl(a.userState.url);if("GET_ORG_USER_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_CLIENT_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_USER_VACCINATION_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_USER_INCIDENT_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_USER_SYMPTOM_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_USER_FAMILY_HISTORY_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_APPOINTMENT_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_INDIVIDUAL_USER_TEMPLATE"===a.userState.url&&(i=i+"/"+a.orgLocation.id),"GET_CREATE_REQUEST_TEMPLATE"===a.userState.url){var j=c.requestTypeName.id,k=Date.parse(c.startDate),l=Date.parse(c.endDate);i=i+"/"+a.orgLocation.data.id+"/"+j+"/"+k+"/"+l}b({url:i,method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(b,c,d,e){/*var blob = new Blob([data], {
    type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
});*/
/*var objectUrl = URL.createObjectURL(data);
                           window.open(objectUrl);*/
var f=null;"GET_ORG_USER_TEMPLATE"===a.userState.url?f="OrgUserTemplate.xls":"GET_CLIENT_TEMPLATE"===a.userState.url?f="ClientUserTemplate.xls":"GET_ORGLOC_TEMPLATE"===a.userState.url?f="OrganizationLocationTemplate.xls":"GET_USER_VACCINATION_TEMPLATE"===a.userState.url?f="UserVaccinationTemplate.xls":"GET_USER_INCIDENT_TEMPLATE"===a.userState.url?f="UserIncidentTemplate.xls":"GET_USER_SYMPTOM_TEMPLATE"===a.userState.url?f="UserSymptomTemplate.xls":"GET_USER_FAMILY_HISTORY_TEMPLATE"===a.userState.url?f="UserFamilyHistoryTemplate.xls":"GET_APPOINTMENT_TEMPLATE"===a.userState.url?f="AppointmentTemplate.xls":"GET_INDIVIDUAL_USER_TEMPLATE"===a.userState.url?f="IndividualUserTemplate.xls":"GET_CREATE_REQUEST_TEMPLATE"===a.userState.url&&(f="CreateRequestTemplate.xls");var h=new Blob([b],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});g(h,f),o.cancel()}).error(function(a,b,c,d){})};/*TOAST CODE*/
var u={bottom:!1,top:!0,left:!1,right:!0};a.toastPosition=angular.extend({},u),a.getToastPosition=function(){return p(),Object.keys(a.toastPosition).filter(function(b){return a.toastPosition[b]}).join(" ")},a.cancel=function(){o.cancel()},a.getOrganizations=function(b){var c="";
//}
//if (attrs.adhocUrlOrg) {
//    orgUrl = attrs.adhocUrlOrg;
//} else {
return a.queryObj={},a.queryObj.keyword=b,c="GET_ACCESSIBLE_ORG_LIST_KEYWORD",e.getData(f.getParameterizedUrl(c,a.queryObj),null,function(b){if(b&&b.data)return a.organizations=b.data,a.organizations},function(a){},{orgLocPermission:a.orgLocPermission,organizationTypeCategory:"WHETHER_SUBSCRIBER"})},a.getOrganizationLocations=function(b){var c="";a.queryObj={},a.queryObj.keyword=b;var d=null;if(a.organization&&(a.queryObj.orgId=a.organization.id,c="GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD",d=f.getParameterizedUrl(c,a.queryObj)),d)return e.getData(d,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},a.init=function(){a.userType="GET_ORG_USER_TEMPLATE",i&&"patientRecord"==i&&(j&&(a.isPatientRecord=!0,"appointment"==j?a.requestTypeCode="APPOINTMENT":"userVaccination"==j?a.requestTypeCode="USER_VACCINATION":"userIncident"==j?a.requestTypeCode="USER_INCIDENT":"userSymptom"==j?a.requestTypeCode="USER_SYMPTOM":"userFamilyHistory"==j&&(a.requestTypeCode="USER_FAMILY_HISTORY")),a.getSystemOrg=function(){var b={organizationId:t.loggedInUserDetails.organizationId};return e.getData(f.getParameterizedUrl("GET_ORG_BY_ID",b),null,function(b){b&&b.data&&(a.creatingOrganization=b.data,a.organization={id:a.creatingOrganization.id,value:a.creatingOrganization.displayName},a.getSystemOrgLoc(a.organization.id))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||h("error",l.instant(a.data.messages[0]))})},i&&"patientRecord"==i&&a.getSystemOrg(),a.getSystemOrgLoc=function(b){var c={};return c.organizationId=b,c.userId=t.loggedInUserDetails.id,e.getData(f.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",c),null,function(b){if(b&&b.data)
//$scope.orgLocValues = {};
return a.creatingOrganizationLocation=b.data[0],a.orgLocation=a.creatingOrganizationLocation,a.selectedOrg=a.creatingOrganizationLocation,a.orgLocValues},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||h("error",l.instant(a.data.messages[0]))})})},a.init()}v.$inject=["$scope","$http","$mdToast","type","featurePrivilegeConstants","stateName","cardName","baseService","utilService"],a.commonConstants=b,a.a=1e3,a.filterCriteria={},a.importDataRecords={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.dataObjectList=[],a.recordValue=!1;/* locationCategory label changes */
var w=u.getLocationCategory();a.fieldLabel={},g.isFieldEmpty(w)?a.fieldLabel.userData=l.instant("IMPORT_CLIENTS"):"EDUCATIONAL_INSTITUTION"==w.code?a.fieldLabel.userData=l.instant("STUDENT_DATA"):"CORPORATE"==w.code?a.fieldLabel.userData=l.instant("EMPLOYEE_DATA"):"SERVICE_PROVIDER"==w.code&&(a.fieldLabel.userData=l.instant("IMPORT_CLIENTS")),a.importDataTypeList=["ORG_USER_DATA",a.fieldLabel.userData,"ORG_LOC_DATA","USER_VACCINATION_DATA","USER_INCIDENT_DATA","USER_SYMPTOM_DATA","USER_FAMILY_HISTORY_DATA","APPOINTMENT_DATA","CREATE_REQUEST_DATA"];var x={};a.pageChanged=function(){a.pagingInfo=r(a.currentPage,a.itemPerPage,a.totalItems),a.getFilteredImportData(a.uploadDate)},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getFilteredImportData(a.uploadDate)},a.getFilteredImportData=function(b){a.importListSpinner=!0,x=angular.copy(a.filterCriteria),g.isFieldEmpty(b)||(x.uploadedOn=q.convertToServerDate(b));var c="GET_IMPORT_DETAILS";/*criteriaObject.sorters = $scope.sortedObject.sorters;*/
x.pageNumber=a.currentPage,x.recordsPerPage=a.itemPerPage,i.filterImportData(c,x,function(b){a.dataObjectList=b,a.totalItems=b.totalRecords,a.pagingInfo=r(a.currentPage,a.itemPerPage,a.totalItems),a.importListSpinner=!1},function(b){a.importListSpinner=!1})},a.hideValue=function(a,b){if(b.uploadFailureCount>0)return!0},a.downloadFailedRec=function(a){var b=b||function(a){if(!("undefined"==typeof a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var o,p=this,q=b.type,r=q===j,s=function(){m(p,"writestart progress write writeend".split(" "))},t=function(){if((h||r&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;"),c=a.open(b,"_blank");c||(a.location.href=b),b=void 0,p.readyState=p.DONE,s()},d.readAsDataURL(b),void(p.readyState=p.INIT)}if(o||(o=c().createObjectURL(b)),r)a.location.href=o;else{var e=a.open(o,"_blank");e||(a.location.href=o)}p.readyState=p.DONE,s(),l(o)};return p.readyState=p.INIT,e?(o=c().createObjectURL(b),void setTimeout(function(){d.href=o,d.download=i,f(d),s(),l(o),p.readyState=p.DONE})):void t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);if("undefined"!=typeof module&&module.exports?module.exports.saveAs=b:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return b}),console.log(a),"ORG_USER_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_ORG_USER",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("CLIENT_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_CLIENT",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("ORG_LOC_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("GET_ORGLOC_GRID_EXCEL_FILE",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("USER_VACCINATION_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_USER_VACCINATION",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("USER_INCIDENT_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_USER_INCIDENT",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("USER_SYMPTOM_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_USER_SYMPTOM",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("USER_FAMILY_HISTORY_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_USER_FAMILY_HISTORY",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("APPOINTMENT_DATA"==a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_APPOINTMENT",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("INDIVIDUAL_USER_CLIENT_DATA"===a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_INDIVIDUAL_USER_CLIENT",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}else if("CREATE_REQUEST_DATA"===a.recordType){var c={id:a.id};s({url:f.getParameterizedUrl("DOWNLOAD_FAILED_REC_CREATE_REQUEST",c),method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,c,d,e){var f=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b(f,"Failed_Document.xls")}).error(function(a,b,c,d){})}},a.uploadFile=function(){var b=a.fileObj.myFile,c=new FormData;g.isNullOrEmpty(b)||c.append("importOrgUserFile",b);var d=f.getUrl("IMPORT_FILE");e.uploadFileData(d,c,function(a){a&&a.data},function(a){})};var y={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=c.setOptionProperties(y),a.dtColumnDefs=c.setColumnProperties({}),a.fileUploadDownload=function(c,d,e){o.show({templateUrl:"app/modules/import-data/views/fileUploadDownload.html",controller:v,parent:angular.element(document.body),locals:{type:c,stateName:d,cardName:e},
//targetEvent: ev,
clickOutsideToClose:b.dialogBox.clickOutsideToClose}).then(function(b){a.getFilteredImportData(a.uploadDate)})},a.clear=function(){j.reload()},a.init=function(){/*var criteriaObject = {
    pageNumber: $scope.currentPage,
    recordsPerPage: $scope.itemPerPage
};
$scope.getImportData(criteriaObject);*/
a.isSearched=!1,a.getFilteredImportData()},a.init()}]),angular.module("paripal.searchHospitalModule").service("ImportDataService",["httpService","urlService","utilService","notify","$translate","featurePrivilegeConstants","serverSidePagination",function(a,b,c,d,e,f,g){"use strict";this.filterImportData=function(d,e,g,h){c.isFieldEmpty(e.importDataType)||(e.recordType=e.importDataType,delete e.importDataType),a.postData(b.getUrl(d),e,function(a){g(a.data)},function(a){h(a)},{orgLocPermission:f.ORGANIZATION_USER_ADD})}}]),angular.module("paripal.jobManagement").controller("JobListHistoryCtrl",["$scope","$rootScope","datatableconfig","serverSidePagination","notify","$state","$stateParams","httpService","urlService","utilService","commonConstants","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.commonConstants=k,a.filterCriteria={},a.jobListSpinner=!1,a.jobListData=[],a.filterStatus={open:!0},a.currentPage=k.defaultPageNo,a.itemPerPage=k.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.clear=function(){f.reload()},a.callBack=function(){f.go("jobList",{data:g.data})},a.callBackToHistory=function(a){f.go("jobHistory",{data:g.data})},a.getListOfJobs=function(){var c=new Object;return angular.copy(a.filterCriteria,c),c.organization&&(c.sysOrgId=c.organization.id),delete c.organization,delete c.jobDisplayName,j.isNullOrEmpty(c.fromDate)||(c.fromDate=l.convertToServerDate(c.fromDate)),j.isNullOrEmpty(c.toDate)||(c.toDate=l.convertToServerDate(c.toDate)),b.showSpinner=!0,h.postData(i.getUrl("JOB_HISTORY"),c,function(c){b.showSpinner=!1,a.jobListData={},a.jobListData=angular.copy(angular.fromJson(c.data.data)),a.totalItems=a.jobListData.length,a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})},a.getErrorMessage=function(a){b.showSpinner=!0,h.getData(i.getParameterizedUrl("JOB_ERROR",{historyId:a.id}),null,function(a){b.showSpinner=!1,f.go("jobError",{errormessage:a.data,data:g.data,callBackURL:"jobHistory"})},function(a){b.showSpinner=!1})};var m=function(){j.isFieldEmpty(g.data)||("jobHistory"===g.callBackURL?a.errormessage=g.errormessage:(a.filterCriteria=angular.copy(g.data),a.getListOfJobs()))};m(),/**
         *Server side pagination module
         */
a.pageChanged=function(){a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems),a.getListOfJobs()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getListOfJobs()};/**
         *datatble config json
         */
var n=k.gridConfigurations;a.options=c.setOptionProperties(n)}]),angular.module("paripal.jobManagement").controller("JobListViewCtrl",["$scope","$rootScope","datatableconfig","serverSidePagination","notify","$translate","$state","httpService","urlService","commonConstants","$stateParams","$filter","$mdDialog","jobListService","utilService","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.commonConstants=j,a.filterCriteria={},a.clientSideFilter={},a.jobListSpinner=!1,a.jobList=[];var q=[];a.statuses=["WAITING","PAUSED"],a.status={open:!0},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};var r,s=[];a.getFilteredValues=function(){a.getListOfJobs()};var t={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=c.setOptionProperties(t),a.dtColumnDefs=c.setColumnProperties({}),a.clear=function(){a.filterCriteria=new Object,a.jobList=new Array,r=new Array,s=new Array,a.clientSideFilter={},a.totalItems=0,a.pagingInfo={}},a.executeJob=function(b){var c={};c.organization=b.displayName,c.sysOrgId=b.sysOrgId,c.jobName=b.jobName;var d=m.confirm().title(f.instant("EXECUTE_JOB")).textContent(f.instant("EXECUTE_JOB_MSG",c)).ok(f.instant("OK")).cancel(f.instant("CANCEL"));m.show(d).then(function(){a.jobListSpinner=!0,n.executeJob(c,function(b){e("success",f.instant("EXECUTE_JOB_SUCCESS")),m.hide(),a.getListOfJobs(),a.jobListSpinner=!1},function(b){a.jobListSpinner=!1})},function(){})},a.changeStatus=function(b,c){var d={sysOrgId:b.sysOrgId,jobName:b.jobName,triggerState:c},g=f.instant(c),h=m.confirm().title(f.instant("CHANGE_STATUS")).textContent(f.instant("CHANGE_STATUS_MSG",{status:g})).ok(f.instant("YES")).cancel(f.instant("NO"));m.show(h).then(function(){a.jobListSpinner=!0,n.changeStatus(d,function(b){a.jobListSpinner=!1,e("success",f.instant("EXECUTE_JOB_SUCCESS")),m.hide(),a.getListOfJobs()},function(b){a.jobListSpinner=!1})},function(){})},a.getListOfJobs=function(b){return a.jobListSpinner=!0,b&&a.userfilterParamObject&&a.userfilterParamObject.systermOrganization&&a.userfilterParamObject.systermOrganization==a.filterCriteria.organization.id?(u(angular.copy(q)),void(a.jobListSpinner=!1)):(a.userfilterParamObject=new Object,angular.copy(a.filterCriteria,a.userfilterParamObject),a.userfilterParamObject.organization&&(a.userfilterParamObject.systermOrganization=a.userfilterParamObject.organization.id),delete a.userfilterParamObject.organization,h.postData(i.getUrl("GET_JOB_LIST"),a.userfilterParamObject,function(b){q=b.data,u(angular.copy(q)),a.jobListSpinner=!1},function(b){a.jobListSpinner=!1}))};var u=function(b){r=l("filter")(b,{jobDisplayName:a.clientSideFilter.jobName,triggerState:a.clientSideFilter.status}),0==r.length&&(r=l("filter")(b,{jobName:a.clientSideFilter.jobName,triggerState:a.clientSideFilter.status})),s=angular.copy(angular.fromJson(r)),a.jobList=angular.copy(r),a.totalItems=a.jobList.length,a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems),a.pageChanged()};a.showHistory=function(b){g.go("jobHistory",{data:{jobName:b.jobName,jobDisplayName:b.jobDisplayName,sysOrgId:b.sysOrgId,organization:a.filterCriteria.organization}})},a.checkIfEmpty=function(){o.isFieldEmpty(a.clientSideFilter.jobName)&&(a.clientSideFilter.jobName=void 0)};var v=function(){p.isUserLoggedIn()||g.go("login"),n.getAccessibleOrganizations(function(b){a.orgList=b}),o.isNullOrEmpty(k.data)||(a.filterCriteria.organization=k.data.organization,a.getListOfJobs())};v(),a.pageChanged=function(){a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems),angular.copy(s,r),a.jobList=r.splice(a.pagingInfo.startRecord-1,a.itemPerPage)},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems),angular.copy(s,r),a.jobList=r.splice(a.pagingInfo.startRecord-1,a.itemPerPage)}}]),angular.module("paripal.dataSettingsModule").service("jobListService",["httpService","urlService","utilService",function(a,b,c){"use strict";this.getOrgLocations=function(c,d){a.getData(b.getUrl("GET_SYSTEM_ORGANIZATIONS"),null,function(a){c(a.data)},function(a){d(a)})},this.executeJob=function(c,d,e){a.putData(b.getQueryParameterizedUrl("EXECUTE_JOB",c),null,function(a){d(a.data)},function(a){e(a)})},this.changeStatus=function(c,d,e){a.putData(b.getParameterizedUrl("CHANGE_JOB_STATE",c),null,function(a){d(a.data)},function(a){e(a)})},this.getAccessibleOrganizations=function(c){a.getData(b.getQueryParameterizedUrl("GET_ACCESSIBLE_ORG_LIST"),null,function(a){c(a.data)})}}]),angular.module("paripal.labCRM").controller("AddUserMeasurementCtrl",["$scope","$rootScope","$state","$stateParams","httpService","urlService","utilService","notify","dateconvertor","datatableconfig","commonConstants","userStatusService","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.userMeasurementObject={},a.commonConstants=k,/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=k.defaultPageNo,a.itemPerPage=k.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.today=new Date,a.userMeasurementObject.measurementDate=i.convertToViewDate(a.today),a.init=function(){a.pageState="add",l.isUserLoggedIn()&&(a.userMeasurementObject.user=l.userStatus().userData),g.isEmpty(d.data)||(a.userMeasurementObject.user=d.data.user,a.isUserDisable=!l.isOrgUser(),g.isFieldEmpty(d.data.diagnosticTest)||(a.userMeasurementObject.diagnosticTestUser=d.data.diagnosticTest,a.loadMeasurementList("",a.userMeasurementObject.diagnosticTestUser.id)))},/**
         * Get users list
         * @param   {string} viewValue Name of the user being searched.
         * @returns {Array} [[Description]]
         */
a.getUsersList=function(b){a.userNameAutoCmp=!0;var c={};return c.searchString=b,e.getData(f.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,a.userList=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.getUserTestList=function(b,c){var d={};return d.userId=b.id,d.userTestTrName=c,a.userTestNameAutoCmp=!0,e.getData(f.getParameterizedUrl("FIND_USERTESTBYUSERID",d),null,function(b){return a.userTestNameAutoCmp=!1,a.diagnosticTestUserList=angular.fromJson(b.data)},function(b){a.userTestNameAutoCmp=!1})},a.getIndicator=function(b){a.indicatorAutoCmp=!0;var c=f.getUrl("GET_INDICATOR");return c=c+b+"&whetherActive=true",e.getData(c,null,function(b){return a.indicatorAutoCmp=!1,a.indicatorList=angular.fromJson(b.data),a.indicatorList},function(b){a.indicatorAutoCmp=!1})},a.loadMeasurementList=function(b,c){a.userMeasurementObject.userTestCode=b,a.userMeasurementObject.measurementList=[];var d={};d.userTestCode=b,d.userTestId=c,e.getData(f.getParameterizedUrl("GET_INDICATORBYUSERTESTIDANDCODE",d),null,function(b){var c=b.data;g.isNullOrEmpty(c.measurementDate)||(c.measurementDate=i.convertToViewDate(c.measurementDate)),g.isEmpty(c.diagnosticTestUser)||(c.userTestCode=c.diagnosticTestUser.code),a.measurementListLength=c.wsUserMeasurements.length,angular.copy(c,a.userMeasurementObject)},function(a){})},/*Function to search symptoms*/
a.viewMeasurementSymptoms=function(a){a.ifUserMeasurement=!0,c.go("measurementsymptoms",{data:a,callBackURL:c.current.name})},/*Check type of value*/
a.checkNumber=function(a){var b=parseInt(a);if(angular.isNumber(b)&&NaN!=b)return b},a.createUserMeasurement=function(b,c){if(c&&0==b.wsUserMeasurements.length)return void h("warning",m("translate")("PLEASE_FILL_ALL_THE_FIELD"));var d={};a.isRequestSent=!0,g.isNullOrEmpty(b)||g.isNullOrEmpty(b.wsUserMeasurements)||angular.forEach(b.wsUserMeasurements,function(a,c){g.isNullOrEmpty(a.measurementIndicatorName.id)||(b.wsUserMeasurements[c].measurementIndicatorId=a.measurementIndicatorName.id,b.wsUserMeasurements[c].measurementIndicatorName=a.measurementIndicatorName.value)}),angular.copy(b,d),g.isNullOrEmpty(d.measurementDate)||(d.measurementDate=i.convertToServerDate(d.measurementDate)),delete d.userTestCode,e.postData(f.getUrl("CREATE_USERMEASUREMENT"),d,function(b){a.isRequestSent=!1,h("success",b.data.successMessage),a.back()},function(b){a.isRequestSent=!1})},a.clearUserTestFields=function(){a.userMeasurementObject.wsUserMeasurements=[],a.userMeasurementObject.userTestCode=null,a.userMeasurementObject.diagnosticTestUser=null,a.userMeasurementObject.measurementDate=i.convertToViewDate(a.today),a.measurementListLength=0},a.back=function(){g.goBackToPrevState()};/**
         *datatble config json
         */
var n=k.gridConfigurations;n.setDeafultColSortingOrder="asc",a.options=j.setOptionProperties(n),a.addRow=function(){a.userMeasurementObject.wsUserMeasurements.push({chartingValue:null,id:null,measurementDate:null,measurementIndicatorId:null,measurementIndicatorName:null,organizationLocationId:null,unitOfMeasurement:null,value:null,version:null})},a.removeRow=function(b){a.userMeasurementObject.wsUserMeasurements.splice(b,1),a.addUserMeasurementForm.value.$valid=!0},a.init()}]),angular.module("paripal.labCRM").controller("DiagnosisTestIndicatorLinkCtrl",["$scope","$rootScope","utilService","httpService","urlService","datatableconfig","serverSidePagination","$state","commonConstants","notify","$mdDialog","$filter","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.filterObject={},a.commonConstants=i,a.currentPage=a.commonConstants.defaultPageNo,a.itemPerPage=a.commonConstants.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.init=function(){"callLink"===m.type&&(a.filterObject.diagnosticTestNameObj=m.data,a.getIndicators(a.filterObject.diagnosticTestNameObj))},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b,c){var f={};f.diagnosticTestName=b;var g=e.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",f);return c?(a.diagnosticTestNameAutoCmp=!0,g=g+"&whetherActive="+c):a.diagnosticNameAutoCmp=!0,d.getData(g,null,function(b){return a.diagnosticTestNameAutoCmp=!1,a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticTestNameAutoCmp=!1,a.diagnosticNameAutoCmp=!1})},a.getIndicators=function(b){if(c.isEmpty(b))j("Warning",l("translate")("INVALID_TEST_NAME"));else{var f={};a.diagnosticNameAutoCmp=!0,f.recordsPerPage=a.itemPerPage,f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage,f.diagnosticTestName=b.diagnosticTestName,f.diagnosticTestId=b.diagnosticTestId,d.postData(e.getParameterizedUrl("GET_INDICATOR_LIST"),f,function(b){a.diagTestIndlinkListData=angular.fromJson(b.data),a.totalItems=a.diagTestIndlinkListData.totalRecords,a.diagTestIndlinkList=a.diagTestIndlinkListData.data,a.diagnosticNameAutoCmp=!1,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.diagnosticNameAutoCmp=!1})}},a.addNewIndicator=function(b,d){var e=function(){k.show({scope:a,preserveScope:!0,templateUrl:"app/modules/labCRM/views/popup-add-diagnosis-test-indicator-link.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:i.dialogBox.clickOutsideToClose})};a.testlinkObj={whetherActive:!0,diagnosticTestNameObj:d},c.isEmpty(d)?e():d.whetherActive?e():j("Warning",l("translate")("TEST_INDICATOR_LINK_ERROR"))},a.hide=function(){k.hide()},a.cancel=function(){k.cancel()},a.findIndicatorByName=function(b,f){if(!c.isNullOrEmpty(f)){var g={},h=[];a.indicatorNameSpinner=!0,g.indicatorName=b,g.diagnosticTestId=f;var i=e.getParameterizedUrl("FIND_INDICATOR_TO_ADD",g);return d.getData(i,null,function(b){return a.indicatorNameSpinner=!1,h=angular.fromJson(b.data)},function(b){a.indicatorNameSpinner=!1})}},a.createTestIndicatorLink=function(b){if(b.$valid){a.progress=!0;var c={};c.diagnosticTest={},angular.copy(a.testlinkObj.diagnosticTestNameObj,c.diagnosticTest),c.diagnosticTest.id=c.diagnosticTest.diagnosticTestId,delete c.diagnosticTest.diagnosticTestId,c.measurementIndicator=a.testlinkObj.indicatorObj,c.whetherActive=a.testlinkObj.whetherActive,delete c.diagnosticTest.lastUpdatedDate,d.postData(e.getUrl("CREATE_TEST_INDICATOR"),c,function(b){a.progress=!1,j("success",b.data.successMessage),a.cancel(),a.getIndicators(a.testlinkObj.diagnosticTestNameObj)},function(b){a.progress=!1})}},a.toggleStatus=function(b,c){a.requestObject={},a.requestObject.id=b.id,a.requestObject.whetherActive=c,d.putData(e.getParameterizedUrl("TOGGLE_DIAGNOSTIC_TEST_INDICATOR_STATUS",a.requestObject),null,function(b){b.data.successMessage&&(j("success",b.data.successMessage),a.getIndicators(a.filterObject.diagnosticTestNameObj))})},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.getIndicators(a.filterObject.diagnosticTestNameObj)},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getIndicators(a.filterObject.diagnosticTestNameObj)},a.init();var n=a.commonConstants.gridConfigurations;a.options=f.setOptionProperties(n)}]),angular.module("paripal.labCRM").controller("DiagnosticTestsCtrl",["$scope","utilService","httpService","urlService","notify","$stateParams","$state","commonConstants","$mdDialog","baseService",function(a,b,c,d,e,f,g,h,i,j){a.diagnosticTestobj={},a.diagnosticTestobj.organizationId={},a.commonConstants=h,a.hide=function(){i.hide()},a.cancel=function(){i.cancel()},a.init=function(){a.checkPageState()},a.checkPageState=function(){if("edit"===f.type||"view"===f.type){a.pageState=f.type;var c=f.data;a.setPackageObject(c)}if("add"===f.type||b.isNullOrEmpty(f.type)){a.pageState="add",a.diagnosticTestobj.whetherActive=!0;var d=j.getDefaultOrgLocation();b.isFieldEmpty(d)||(a.diagnosticTestobj.organizationId={data:d.org})}},a.setPackageObject=function(c){b.isNullOrEmpty(c.organizationId)||(c.organizationId={data:{id:c.organizationId,value:c.organizationDisplayName}}),a.diagnosticTestobj=c},a.createDignosticTest=function(f){if(f.$valid){a.progress=!0;var g={};angular.copy(a.diagnosticTestobj,g),g.testPurpose=a.diagnosticTestobj.testPurpose.dataValue,b.isNullOrEmpty(g.organizationId)||(g.organizationId=a.diagnosticTestobj.organizationId.data.id),b.isNullOrEmpty(a.diagnosticTestobj.id)?c.postData(d.getUrl("CREATE_DIAGNOSTIC_TESTS"),g,function(c){b.isNullOrEmpty(c.data.messages)&&(e("success",c.data.successMessage),a.back())},function(b){a.progress=!1}):(g.id=a.diagnosticTestobj.id,c.putData(d.getParameterizedUrl("UPDATE_DIAGNOSTIC_TESTS",g),g,function(c){b.isNullOrEmpty(c.data.message)&&(e("success",c.data.successMessage),a.back())},function(b){a.progress=!1}))}},a.back=function(){b.goBackToPrevState()},a.init()}]),angular.module("paripal.labCRM").controller("DiagnosticTestsListCtrl",["$scope","$rootScope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$uibModal","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l){a.filterObject={},a.cardView=!0,a.currentPage=j.defaultPageNo,1==a.listView?a.itemPerPage=10:a.itemPerPage=12,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.status={},a.commonConstants=j,a.init=function(){a.searchData()},/* CARD VIEW CODE START */
$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1,a.itemPerPage=12,a.searchData()):(a.cardView=!1,a.listView=!0,a.itemPerPage=10,a.searchData()),"Card view"===c?"List View":"Card view"})}),/* CARD VIEW CODE END */
/**
     *Get Group name on autocomplete
     */
a.getGroupNameList=function(b){a.groupNameAutoCmp=!0;var c={},f=[];return c.measurementGroupName=b,d.getData(e.getParameterizedUrl("FIND_GROUPBYNAME",c),null,function(b){return a.groupNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.groupNameAutoCmp=!1})},/**
     *Get Symptom name on autocomplete
     */
a.getSymptomList=function(b){a.symptomNameAutoCmpLoading=!0;var c={};return a.symptomList=[],c.symptomName=b,d.getData(e.getParameterizedUrl("FIND_SYMPTOMNAME",c),null,function(b){return a.symptomNameAutoCmpLoading=!1,a.symptomList=angular.fromJson(b.data)},function(b){a.symptomNameAutoCmpLoading=!1})},a.linkChart=function(a){i.go("testBenchmarkChartList",{test:a})},a.findIndicatorByName=function(b){a.indicatorAutoCmpLoading=!0;var c={},f=[];return c.measurementIndicatorName=b,d.getData(e.getParameterizedUrl("FIND_INDICATORBYNAME",c),null,function(b){return a.indicatorAutoCmpLoading=!1,f=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.getDisease=function(b){a.diseaseNameAutoCmpLoading=!0;var c={};c.searchKeyWord=b;var f=[];return d.getData(e.getParameterizedUrl("GET_DISEASE_VARIANTS",c),null,function(b){return a.diseaseNameAutoCmpLoading=!1,f=angular.fromJson(b.data)},function(b){a.diseaseNameAutoCmpLoading=!1})},/**
     *search Data functionality
     */
a.searchData=function(){var f={};b.showSpinner=!0,f.whetherActive=a.filterObject.whetherActive,f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage,c.isEmpty(a.filterObject.diagnosticTestNameObj)||(f.diagnosticTestId=a.filterObject.diagnosticTestNameObj.diagnosticTestId,delete f.diagnosticTestNameObj),c.isEmpty(a.filterObject.diagnosticTestName)||(f.diagnosticTestName=a.filterObject.diagnosticTestName),c.isEmpty(a.filterObject.groupNameObj)||(f.measurementGroupId=a.filterObject.groupNameObj.measurementGroupId,delete f.groupNameObj),c.isEmpty(a.filterObject.indicatorObj)||(f.measurementIndicatorId=a.filterObject.indicatorObj.id,delete f.indicatorObj),c.isEmpty(a.filterObject.symptom)||(f.symptomId=a.filterObject.symptom.id,delete f.symptom),c.isEmpty(a.filterObject.disease)||(f.diseaseVariantId=a.filterObject.disease.id,delete f.disease),d.postData(e.getUrl("GET_DIAGNOSTICTEST"),f,function(c){b.showSpinner=!1;var d={};d=angular.fromJson(c.data),a.totalItems=d.totalRecords,a.diagnosticList=d.data,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})},/**
     *Edit indicator functionality
     */
a.editViewDiagnostic=function(a,b){var c={};c.diagnosticTestId=a.diagnosticTestId,d.getData(e.getParameterizedUrl("FIND_DIAGNOSTICTESTBYID",c),null,function(a){i.go("diagnostictests",{type:b,data:angular.fromJson(a.data)})})},/**
     *Clear function
     */
a.clear=function(){a.filterObject={},a.searchData(),i.reload()},/**
     *Add new function
     */
a.addNewdiagnostic=function(){i.go("diagnostictests",{type:""})},a.redirectToTestGroupLink=function(a){i.go("testgrouplist",{type:"callLink",data:a})},a.redirectToTestIndicatorLink=function(a){i.go("diagnosistestindicatorlink",{type:"callLink",data:a})},a.redirectTestOrgLocList=function(a){i.go("testorglocationlist",{type:"callLink",data:{id:a.diagnosticTestId,value:a.diagnosticTestName}})},a.init(),/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},a.toggleActiveStatus=function(b,c){var g={};g.id=b,g.whetherActive=c,d.putData(e.getParameterizedUrl("TOGGLE_ACTIVE_DIAGNOSTICTEST_STATUS",g),null,function(b){b.data.successMessage&&(f("success",b.data.successMessage),a.searchData())})};/**
     *datatble config json
     */
var m=j.gridConfigurations;a.options=g.setOptionProperties(m)}]),angular.module("paripal.labCRM").controller("GroupIndicatorLinkListCtrl",["$scope","$filter","utilService","httpService","urlService","notify","$state","$stateParams","datatableconfig","serverSidePagination","commonConstants","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l){a.currentPage=k.defaultPageNo,a.itemPerPage=k.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=k,a.addgroupIndicatorLinkObj={},a.gouplinkObj={},a.measurementGroup={},a.requestData={sorters:[]},a.init=function(){c.isNullOrEmpty(h.data)||(a.addgroupIndicatorLinkObj.measurementGroup={whetherActive:h.data.whetherActive,measurementGroupId:h.data.measurementGroupId,measurementGroupName:h.data.measurementGroupName},"addgroupindicatorlink"===h.type&&a.addinputpopup(null,a.addgroupIndicatorLinkObj.measurementGroup),a.getIndicators(h.data.measurementGroupId))},/* for group name list*/
a.getGroupNameList=function(b,c){var f={};f.measurementGroupName=b,a.groupList=[];var g=e.getParameterizedUrl("FIND_GROUPNAME",f);return c?(g=g+"&whetherActive="+c,a.groupNamePopupSpinner=!0):a.groupNameSpinner=!0,d.getData(g,null,function(b){return a.groupNamePopupSpinner=!1,a.groupNameSpinner=!1,a.groupList=angular.fromJson(b.data)},function(b){a.groupNamePopupSpinner=!1,a.groupNameSpinner=!1})},a.getIndicators=function(b){var f={};f.id=b,f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage,a.indicatorListSpinner=!0,f.sorters=a.requestData.sorters,d.postData(e.getUrl("FIND_INDICATORBYGROUPID"),f,function(b){a.indicatorListSpinner=!1,a.data=angular.fromJson(b.data),a.indicatorList=a.data.data,c.isFieldEmpty(measurementGroup)||(a.addgroupIndicatorLinkObj.measurementGroup=measurementGroupName),a.totalItems=a.data.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.indicatorListSpinner=!1})},a.clear=function(){a.addgroupIndicatorLinkObj={},a.indicatorList=[],g.reload()},a.addinputpopup=function(d,e){var g=function(){l.show({scope:a,preserveScope:!0,templateUrl:"app/modules/labCRM/views/popup-add-group-indicator-link.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:k.dialogBox.clickOutsideToClose})};c.isEmpty(e)?g():e.whetherActive?g():f("warning",b("translate")("GROUP_INDICATOR_LINK_ERROR")),a.gouplinkObj={whetherActive:!0,measurementGroup:e}},a.hide=function(){l.hide()},a.cancel=function(){l.cancel()},a.findIndicatorByName=function(b,c){var f={};a.indicatorNameSpinner=!0,f.measurementIndicatorName=b,f.measurementGroupId=c;var g=e.getParameterizedUrl("FIND_INDICATORSTOADD",f);return d.getData(g,null,function(b){return a.indicatorNameSpinner=!1,a.indicatorByNameList=angular.fromJson(b.data)},function(b){a.indicatorNameSpinner=!1})},a.createGroupIndicatorLink=function(b){if(b.$valid){a.progress=!0;var c={};c.measurementGroupId=a.gouplinkObj.measurementGroup.measurementGroupId,c.measurementIndicatorId=a.gouplinkObj.indicatorObj.id,c.whetherActive=a.gouplinkObj.whetherActive,d.postData(e.getUrl("CREATE_MEASUREMENTGROUPINDICATOR"),c,function(b){a.progress=!1,f("success",b.data.successMessage),a.getIndicators(a.gouplinkObj.measurementGroup.measurementGroupId),a.cancel()},function(b){a.progress=!1})}},a.toggleStatus=function(b,c){a.requestObject={},a.requestObject.id=b.id,a.requestObject.whetherActive=c,d.putData(e.getParameterizedUrl("TOGGLE_ACTIVE_GROUPLINK_STATUS",a.requestObject),null,function(b){b.data.successMessage&&(f("success",b.data.successMessage),a.getIndicators(a.addgroupIndicatorLinkObj.measurementGroup.measurementGroupId))})},a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.getIndicators(a.addgroupIndicatorLinkObj.measurementGroup.measurementGroupId)},a.setMaxRecords=function(d){c.isEmpty(a.addgroupIndicatorLinkObj.measurementGroup)?f("Warning",b("translate")("GROUP_NOT_SELECTED")):(a.currentPage=1,a.itemPerPage=d,a.getIndicators(a.addgroupIndicatorLinkObj.measurementGroup.measurementGroupId))};var m=k.gridConfigurations;a.options=i.setOptionProperties(m),a.init()}]),angular.module("paripal.labCRM").controller("GroupListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","$filter","serverSidePagination","$state","commonConstants","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k){
//popup controller
function l(a,b,c,d,e,f,g,h){a.hide=function(){h.hide()},a.cancel=function(){h.cancel()},a.manageGroupObject={},a.init=function(){a.checkPageState()},a.checkPageState=function(){"add"===g.type?(a.pageState="add",a.manageGroupObject.whetherActive=!1,a.manageGroupObject={}):(a.pageState=g.type,angular.copy(g.data,a.manageGroupObject))},/**
         *Create funtionality
         */
a.createGroup=function(f){if(f.$valid)if(a.manageGroupObject.measurementGroupId){var g={};g.measurementGroupId=a.manageGroupObject.measurementGroupId;var i=a.manageGroupObject;i.id=i.measurementGroupId,delete i.measurementGroupId,c.putData(d.getParameterizedUrl("UPDATE_GROUP",g),i,function(c){b.isNullOrEmpty(c.data.message)&&(e("success",c.data.successMessage),h.hide(),a.searchData())})}else c.postData(d.getUrl("CREATE_GROUP"),a.manageGroupObject,function(c){b.isNullOrEmpty(c.messages)&&(e("success",c.data.successMessage),h.hide(),a.searchData())})},a.init()}l.$inject=["$scope","utilService","httpService","urlService","notify","$state","stateParams","$mdDialog"],a.manageGroupFilterObj={},a.currentPage=j.defaultPageNo,a.itemPerPage=j.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=j,/**
     * Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(e){var f,g={};if(g.diagnosticTestName="",a.diagnosticTestNameSpinner=!0,b.isNullOrEmpty(e))a.diagnosticTestNameList=[],f=d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",g);else{if(!(e.length>2))return a.diagnosticTestNameSpinner=!1,a.diagnosticTestNameList;a.diagnosticTestNameList=[],g.diagnosticTestName=e,f=d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",g)}return c.getData(f,null,function(b){return a.diagnosticTestNameSpinner=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(a){})},/**
     *Get Symptom name on autocomplete
     */
a.getSymptomList=function(e){if(!b.isNullOrEmpty(e)){var f={};return a.symptomList=[],f.symptomName=e,c.getData(d.getParameterizedUrl("FIND_SYMPTOMNAME",f),null,function(b){return a.symptomList=angular.fromJson(b.data)},function(a){})}},/**
     * Get Group Name List
     */
a.getIndicatorList=function(e){
// $scope.indicatorNameAutoCmp = true;
if(!b.isNullOrEmpty(e))return a.requestObject={},a.indicatorList=[],a.requestObject.measurementIndicatorName=e,c.getData(d.getParameterizedUrl("GET_INDICATORNAME",a.requestObject),null,function(b){
//  $scope.indicatorNameAutoCmp = false;
return a.indicatorList=angular.fromJson(b.data)},function(a){})},/**
     *Search Data Function
     */
a.searchData=function(){var e={};angular.copy(a.manageGroupFilterObj,e),e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.manageGroupFilterObj.diagnosticTestNameObj)||(e.diagnosticTestId=a.manageGroupFilterObj.diagnosticTestNameObj.diagnosticTestId,delete e.diagnosticTestNameObj),b.isEmpty(a.manageGroupFilterObj.diagnosticTestNameObj)&&delete e.diagnosticTestNameObj,b.isEmpty(a.manageGroupFilterObj.symptom)||(e.symptomId=a.manageGroupFilterObj.symptom.id,delete e.symptom),b.isEmpty(a.manageGroupFilterObj.indicatorObj)||(e.measurementIndicatorName=a.manageGroupFilterObj.indicatorObj.measurementIndicatorName,delete e.indicatorObj),a.groupListSpinner=!0,
//$scope.requestGroupData = angular.copy(requestGroupData);
c.postData(d.getUrl("GET_GROUPS"),e,function(b){a.groupListSpinner=!1,a.groupData=angular.fromJson(b.data),a.totalItems=a.groupData.totalRecords,a.groupList=a.groupData.data,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.groupListSpinner=!1})},a.searchData(),/**
     *Edit group functionality
     */
a.editViewGroup=function(a,b){var e={};e.measurementGroupId=a.measurementGroupId,c.getData(d.getParameterizedUrl("FIND_GROUPBYID",e),null,function(a){i.go("managegroup",{type:b,data:angular.fromJson(a.data)})})},/**
     * Clear function
     */
a.clear=function(){a.manageGroupFilterObj={},i.reload(),a.searchData()},/**
     *listing
     */
a.addNewGroupIndicator=function(a,b){i.go("groupindicatorlinklist",{type:b,data:a})},/*Add link group - indicator*/
a.addinputpopup=function(c,d){var f=function(){k.show({scope:a,preserveScope:!0,templateUrl:"app/modules/labCRM/views/popup-add-group-indicator-link.html",parent:angular.element(document.body),
// targetEvent: event,
clickOutsideToClose:j.dialogBox.clickOutsideToClose})};b.isEmpty(d)?f():d.whetherActive?f():e("warning",g("translate")("GROUP_INDICATOR_LINK_ERROR")),a.gouplinkObj={whetherActive:!0,measurementGroup:d}},a.addEditViewGroupRecord=function(b,c,d){k.show({scope:a,preserveScope:!0,controller:l,templateUrl:"app/modules/labCRM/views/manage-group.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:j.dialogBox.clickOutsideToClose,locals:{stateParams:{type:d,data:b}}})},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},a.toggleActiveStatus=function(b,f){var g={};g.id=b,g.whetherActive=f,c.putData(d.getParameterizedUrl("TOGGLE_GROUPLIST_STATUS",g),null,function(b){b.data.successMessage&&(e("success",b.data.successMessage),a.searchData())})},a.back=function(){b.goBackToPrevState()};/**
     *datatble config json
     */
var m=j.gridConfigurations;a.options=f.setOptionProperties(m)}]),angular.module("paripal.labCRM").controller("IndicatorConditionListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$stateParams",function(a,b,c,d,e,f,g,h,i,j){a.filterObject={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterObject.organization={},a.filterObject.organizationLocation={},a.commonConstants=i;var k=function(){b.isFieldEmpty(j.data)||"showconditions"!==j.type||(a.filterObject.indicatorObj=j.data),a.searchData()};a.findIndicatorByName=function(e){var f={};if(b.isNullOrEmpty(e))f.measurementIndicatorName="";else{if(!(e.length>2))return a.indicatorByNameList;f.measurementIndicatorName=e}return c.getData(d.getParameterizedUrl("FIND_INDICATORBYNAME",f),null,function(b){return a.indicatorByNameList=angular.fromJson(b.data)})},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(e){a.diagnosticNameAutoCmp=!0;var f={};f.diagnosticTestName="";var g;if(b.isNullOrEmpty(e))a.diagnosticTestNameList=[],g=d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",f);else{if(!(e.length>2))return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList;a.diagnosticTestNameList=[],f.diagnosticTestName=e,g=d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",f)}return c.getData(g,null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},/**
     *Get group name on autocomplete
     */
a.getGroupName=function(b){var e={};e.measurementGroupName=b;var f=d.getParameterizedUrl("FIND_GROUPBYNAME",e);return c.getData(f,null,function(b){return a.groupNameList=angular.fromJson(b.data)},function(a){})},/**
     *search Data functionality
     */
a.searchData=function(){var e={};a.indicatorConditionListSpinner=!0,angular.copy(a.filterObject,e),e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.filterObject.organizationLocation)||(e.organizationLocationId=a.filterObject.organizationLocation.data.id,delete e.organizationLocation,delete e.organization),b.isEmpty(a.filterObject.diagnosticTestNameObj)||(e.diagnosticTestId=a.filterObject.diagnosticTestNameObj.diagnosticTestId,delete e.diagnosticTestNameObj),b.isEmpty(a.filterObject.groupNameObj)||(e.measurementGroupId=a.filterObject.groupNameObj.measurementGroupId,delete e.groupNameObj),b.isEmpty(a.filterObject.indicatorObj)||(e.measurementIndicatorId=a.filterObject.indicatorObj.id,delete e.indicatorObj),e=b.checkNullProp(e),c.postData(d.getUrl("GET_ALLINDICATORCONDITIONS"),e,function(b){a.indicatorConditionListSpinner=!1,a.indicatorData=angular.fromJson(b.data),a.totalItems=a.indicatorData.totalRecords,a.indicatorList=a.indicatorData.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.indicatorConditionListSpinner=!1})},/**
     *Edit indicator functionality
     */
a.editViewIndicatorCondition=function(b,e){a.requestObject={},a.requestObject.id=b.id,c.getData(d.getParameterizedUrl("FIND_INDICATORCONDITIONBYID",a.requestObject),null,function(a){h.go("manageindicatorconditions",{type:e,data:angular.fromJson(a.data)})})},/**
     *Clear function
     */
a.clear=function(){h.reload(),a.filterObject={},a.$broadcast("clearOrgAndOrgLoc"),a.searchData()},/**
     *Add new function
     */
a.addNewIndicatorCondition=function(){h.go("manageindicatorconditions",{type:""})},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},a.toggleStatus=function(b,f){a.requestObject={},a.requestObject.id=b.id,a.requestObject.whetherActive=f,c.putData(d.getParameterizedUrl("TOGGLE_ACTIVE_INDICATOR_CONDITION_STATUS",a.requestObject),null,function(b){b.data.successMessage&&(e("success",b.data.successMessage),a.searchData())})};/**
     *datatble config json
     */
var l=i.gridConfigurations;a.options=f.setOptionProperties(l),k()}]),angular.module("paripal.labCRM").controller("IndicatorCtrl",["$scope","utilService","httpService","urlService","notify","$stateParams","$state","getPicklistObject","commonConstants",function(a,b,c,d,e,f,g,h,i){a.indicatorObject={},a.indicatorObject.whetherActive=!0,a.indicatorObject.whetherVital=!1,a.commonConstants=i,a.init=function(){a.checkPageState(),a.fetchCategotyLabels()},a.checkPageState=function(){"edit"!==f.type&&"view"!==f.type||(a.pageState=f.type,angular.copy(f.data,a.indicatorObject),a.setIndicatorObject(a.indicatorObject)),("add"===f.type||b.isNullOrEmpty(f.type))&&(a.pageState="add")},a.setIndicatorObject=function(c){b.isEmpty(c.unitOfMeasurement)||(a.indicatorObject.unitOfMeasurement=c.unitOfMeasurement),a.indicatorObject.category={},b.isEmpty(c.category1)||(a.indicatorObject.category[0]=c.category1),b.isEmpty(c.category2)||(a.indicatorObject.category[1]=c.category2),b.isEmpty(c.category3)||(a.indicatorObject.category[2]=c.category3)},a.fetchCategotyLabels=function(){var e=new Array;e.push("INDICATOR_CATEGORY_3"),e.push("INDICATOR_CATEGORY_4"),e.push("INDICATOR_CATEGORY_5"),e.push("INDICATOR_CATEGORY_2"),e.push("INDICATOR_CATEGORY_1"),c.postData(d.getUrl("FETCH_CATEGORIES"),e,function(c){b.isEmpty(c)||b.isEmpty(c.data)||(a.labelList=c.data)},function(a){})},/**
     * Find benchmark charts
     */
a.getBenchmark=function(b){var e={};return e.benchmarkName=b,c.getData(d.getParameterizedUrl("FIND_BENCHMARKBYNAME",e),null,function(b){return a.benchmarkList=angular.fromJson(b.data)},function(){})},a.viewPrintFile=function(c,d){if(!b.isEmpty(d)){var e=new Object;e.fileName=d.fileName,e.resourceId=d.id,e.docType=d.documentType.type,e.docSubType=d.documentType.subType,a.fileResource=e,a.viewFileContent=!0,a.isHidingPrintButton=!0}},a.createIndicator=function(f){a.progress=!0,f.$valid?(a.requestObject={},angular.copy(a.indicatorObject,a.requestObject),b.isEmpty(a.indicatorObject.category)||(b.isEmpty(a.indicatorObject.category[0])||(a.requestObject.category1=a.indicatorObject.category[0].dataValue),b.isEmpty(a.indicatorObject.category[1])||(a.requestObject.category2=a.indicatorObject.category[1].dataValue),b.isEmpty(a.indicatorObject.category[2])||(a.requestObject.category3=a.indicatorObject.category[2].dataValue)),delete a.requestObject.category,a.requestObject.unitOfMeasurement=h.getObject(a.requestObject.unitOfMeasurement),b.isNullOrEmpty(a.requestObject.id)?c.postData(d.getUrl("CREATE_INDICATOR"),a.requestObject,function(c){b.isNullOrEmpty(c.messages)&&(e("success",c.data.successMessage),a.back())},function(b){a.progress=!1}):(a.requestData={},a.requestData.measurementIndicatorId=a.indicatorObject.measurementIndicatorId,c.putData(d.getParameterizedUrl("UPDATE_INDICATOR",a.requestData),a.requestObject,function(c){b.isNullOrEmpty(c.data.message)&&(e("success",c.data.successMessage),a.back())},function(b){a.progress=!1}))):a.progress=!1},a.redirectToManageIndicatorCondition=function(a){g.go("manageindicatorconditions",{type:"",data:{id:a.id,measurementIndicatorName:a.measurementIndicatorName}})},a.redirectToIndicatorCondition=function(a){g.go("indicatorconditionlist",{type:"",data:{id:a.id,measurementIndicatorName:a.measurementIndicatorName}})},a.back=function(){b.goBackToPrevState()},a.init()}]),angular.module("paripal.labCRM").controller("IndicatorListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$uibModal",function(a,b,c,d,e,f,g,h,i,j){a.filterObject={},a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.requestData={},a.commonConstants=i,/**
     * Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(e){a.diagnosticNameAutoCmp=!0;var f={};f.diagnosticTestName="";var g;if(b.isNullOrEmpty(e))a.diagnosticTestNameList=[],g=d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",f);else{if(!(e.length>2))return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList;a.diagnosticTestNameList=[],f.diagnosticTestName=e,g=d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",f)}return c.getData(g,null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},a.getGroupName=function(b){var e={};e.measurementGroupName=b;var f=d.getParameterizedUrl("FIND_GROUPBYNAME",e);return c.getData(f,null,function(b){return a.groupNameList=angular.fromJson(b.data)},function(a){})},/**
     *Get Symptom name on autocomplete
     */
a.getSymptomList=function(b){a.symptomNameAutoCmp=!0;var e={};return a.symptomList=[],e.symptomName=b,c.getData(d.getParameterizedUrl("FIND_SYMPTOMNAME",e),null,function(b){return a.symptomNameAutoCmp=!1,a.symptomList=angular.fromJson(b.data)},function(b){a.symptomNameAutoCmp=!1})},a.showIndicatorBenchmarkCharts=function(a){h.go("indicatorBenchmarkChartList",{indicator:a})},/**
     *search Data functionality
     */
a.searchData=function(){var e={};a.indicatorListSpinner=!0,angular.copy(a.filterObject,e),e.measurementIndicatorName,e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.filterObject.diagnosticTestNameObj)||(e.diagnosticTestId=a.filterObject.diagnosticTestNameObj.diagnosticTestId,delete e.diagnosticTestNameObj),b.isEmpty(a.filterObject.groupNameObj)||(e.measurementGroupId=a.filterObject.groupNameObj.measurementGroupId,delete e.groupNameObj),b.isEmpty(a.filterObject.symptom)||(e.symptomId=a.filterObject.symptom.id,delete e.symptom),e=b.checkNullProp(e),c.postData(d.getUrl("GET_INDICATORS"),e,function(b){a.indicatorListSpinner=!1,a.indicatorData=angular.fromJson(b.data),a.totalItems=a.indicatorData.totalRecords,a.indicatorList=a.indicatorData.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.indicatorListSpinner=!1})},a.searchData(),/**
     *Edit indicator functionality
     */
a.editViewIndicator=function(b,e){a.requestObject={},a.requestObject.measurementIndicatorId=b.id,c.getData(d.getParameterizedUrl("FIND_INDICATORBYID",a.requestObject),null,function(a){h.go("indicator",{type:e,data:angular.fromJson(a.data)})})},/**
     *Clear function
     */
a.clear=function(){h.reload()},/**
     *Add new function
     */
a.addNewIndicator=function(){h.go("indicator",{type:""})},/**
     * Redirect to the manage indicator condidtion page
     */
a.redirectToManageIndicatorCondition=function(a){h.go("manageindicatorconditions",{type:"linkconditions",data:{id:a.id,measurementIndicatorName:a.measurementIndicatorName}})},/**
     * Redirect to indicator condidtion page
     */
a.redirectToIndicatorCondition=function(a){h.go("indicatorconditionlist",{type:"showconditions",data:{id:a.id,measurementIndicatorName:a.measurementIndicatorName}})},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},a.toggleActiveStatus=function(b,f){a.requestObject={},a.requestObject.id=b,a.requestObject.whetherActive=f,c.putData(d.getParameterizedUrl("TOGGLE_ACTIVE_INDICATOR_STATUS",a.requestObject),null,function(b){b.data.successMessage&&(e("success",b.data.successMessage),a.searchData())})},a.cancelPopup=function(b){a.indicatorList[b.index].whetherActive=!b.whetherActive,a.modalInstance.close()};/**
     *datatble config json
     */
var k=i.gridConfigurations;a.options=f.setOptionProperties(k)}]),angular.module("paripal.labCRM").controller("ManageIndicatorConditionsCtrl",["$scope","utilService","httpService","urlService","notify","$state","$stateParams","commonConstants","baseService",function(a,b,c,d,e,f,g,h,i){a.manageIndicatorConditionObject={},a.manageIndicatorConditionObject.organization={},a.manageIndicatorConditionObject.orgLocation={},a.commonConstants=h,a.symptomList=[],a.manageIndicatorConditionObject.whetherActive=!0,a.init=function(){c.getData(d.getUrl("GET_ALLSYMPTOMS"),null,function(b){a.symptomList=angular.fromJson(b.data)}),a.checkPageState(),b.isFieldEmpty(g.data)||"linkconditions"!==g.type||(a.manageIndicatorConditionObject.indicatorObj=g.data)},a.checkPageState=function(){if("edit"===g.type||"view"===g.type){a.pageState=g.type,angular.copy(g.data,a.manageIndicatorConditionObject),a.manageIndicatorConditionObject.indicatorObj={},a.manageIndicatorConditionObject.symptom=null,a.manageIndicatorConditionObject.organization={},a.manageIndicatorConditionObject.orgLocation={};var c={id:g.data.measurementIndicatorId,measurementIndicatorName:g.data.measurementIndicatorName};if(a.manageIndicatorConditionObject.symptomId&&!b.isNullOrEmpty(a.manageIndicatorConditionObject.symptomName)){var d={id:a.manageIndicatorConditionObject.symptomId,name:a.manageIndicatorConditionObject.symptomName};a.manageIndicatorConditionObject.symptom=d}angular.copy(c,a.manageIndicatorConditionObject.indicatorObj),b.isNullOrEmpty(a.manageIndicatorConditionObject.organizationId)||b.isNullOrEmpty(a.manageIndicatorConditionObject.organizationDisplayName)||(a.manageIndicatorConditionObject.organization=a.setOrgAndLoc(g.data.organizationId,g.data.organizationDisplayName)),b.isNullOrEmpty(a.manageIndicatorConditionObject.organizationLocationId)||b.isNullOrEmpty(a.manageIndicatorConditionObject.organizationLocationDisplayName)||(a.manageIndicatorConditionObject.orgLocation=a.setOrgAndLoc(g.data.organizationLocationId,g.data.organizationLocationDisplayName)),b.isEmpty(a.manageIndicatorConditionObject.referenceChartId)||(a.referenceChart=a.manageIndicatorConditionObject.referenceChartId)}if("add"===g.type||b.isNullOrEmpty(g.type)){a.pageState="add";var e=i.getDefaultOrgLocation();b.isFieldEmpty(e)||(a.manageIndicatorConditionObject.organization={data:e.org},a.manageIndicatorConditionObject.orgLocation={data:e.orgLoc})}},a.setOrgAndLoc=function(a,b){var c={};return c.data={},c.data.id=a,c.data.value=b,c},a.getOrgAndLocId=function(a){return a.data.id},a.getOrgAndLocName=function(a){return a.data.value},/**
     * Find benchmark charts
     */
a.getBenchmark=function(b){var e={};return e.benchmarkName=b,c.getData(d.getParameterizedUrl("FIND_BENCHMARKBYNAME",e),null,function(b){return a.benchmarkList=angular.fromJson(b.data)},function(){})},a.viewPrintFile=function(c,d){if(!b.isEmpty(d)){var e=new Object;e.fileName=d.fileName,e.resourceId=d.id,e.docType=d.documentType.type,e.docSubType=d.documentType.subType,a.fileResource=e,a.viewFileContent=!0,a.isHidingPrintButton=!0}},a.setReferenceChartId=function(b){a.manageIndicatorConditionObject.referenceChartId={id:b.id}},a.addIndicatorCondition=function(f){if(f.$valid&&!a.manageIndicatorConditionForm.minValue.$error.minValError&&!a.manageIndicatorConditionForm.minValue.$error.maxValError){var g={};if(a.progress=!0,angular.copy(a.manageIndicatorConditionObject,g),b.isEmpty(a.manageIndicatorConditionObject.indicatorObj)||(g.measurementIndicatorId=a.manageIndicatorConditionObject.indicatorObj.id,delete g.indicatorObj),b.isEmpty(a.manageIndicatorConditionObject.symptom)||(g.symptomId=a.manageIndicatorConditionObject.symptom.id,delete g.symptom),b.isEmpty(a.manageIndicatorConditionObject.organization)||(g.organizationId=a.getOrgAndLocId(g.organization),g.organizationDisplayName=a.getOrgAndLocName(g.organization),delete g.organization),b.isEmpty(a.manageIndicatorConditionObject.orgLocation)||(g.organizationLocationId=a.getOrgAndLocId(g.orgLocation),g.organizationLocationDisplayName=a.getOrgAndLocName(g.orgLocation),delete g.orgLocation),delete g.symptom,delete g.symptomName,b.isNullOrEmpty(a.manageIndicatorConditionObject.id))c.postData(d.getUrl("CREATE_INDICATOR_CONDITION"),g,function(c){b.isNullOrEmpty(c.messages)?(e("success",c.data.successMessage),a.back()):(a.dateErrorList=angular.fromJson(c.messages),a.dateError=!0)},function(b){a.progress=!1});else{var h={};h.indicatorConditionId=g.id,c.putData(d.getParameterizedUrl("UPDATE_INDICATOR_CONDITION",h),g,function(c){b.isNullOrEmpty(c.messages)?(e("success",c.data.successMessage),a.back()):(a.dateErrorList=angular.fromJson(c.messages),a.dateError=!0)},function(b){a.progress=!1})}}},a.compareValues=function(b,c){c&&(Number(b)>Number(c)?a.minValError=!0:a.minValError=!1)},a.findIndicatorByName=function(b){var e={};e.measurementIndicatorName=b;var f=d.getParameterizedUrl("FIND_INDICATORBYNAME",e);return f+="&whetherActive=true",c.getData(f,null,function(b){return a.indicatorByNameList=angular.fromJson(b.data)})},a.back=function(){b.goBackToPrevState()},a.init()}]),angular.module("paripal.labCRM").controller("ManageTestCommentCtrl",["$scope","utilService","httpService","urlService","notify","$state","$stateParams","commonConstants",function(a,b,c,d,e,f,g,h){a.testCommentObj={},a.commonConstants=h;var i=function(){a.selectChanged()};/**
     *  dropdown menulist function for comment about 
     */
a.selectChanged=function(){a.dataList=[{value:"Diagnostic test"},{value:"Measurement Indicator"},{value:"Measurement Group"}]},/**
     *Get User name on autocomplete
     */
a.findUserByName=function(b){a.userNameAutoCmp=!0;var e={},f=[];return e.userName=b,c.getData(d.getParameterizedUrl("FIND_USERBYNAME",e),null,function(b){return a.userNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.addTestComment=function(b){console.log(a.testCommentObj)},i()}]),angular.module("paripal.labCRM").controller("ManageTestGroupConditionCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$mdDialog","$filter","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l){a.manageTestGroupConditionObject={},a.manageTestGroupConditionObject.organizationObj={},a.manageTestGroupConditionObject.orgLocationObj={},a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=i,a.init=function(){a.checkPageState()},a.checkPageState=function(){b.isNullOrEmpty(l.data)?a.pageState="add":a.pageState=l.type,b.isEmpty(l.data)||(a.manageTestGroupConditionObject=l.data,a.manageTestGroupConditionObject.organizationObj={},a.manageTestGroupConditionObject.orgLocationObj={},b.isEmpty(a.manageTestGroupConditionObject.organization)||(a.manageTestGroupConditionObject.organizationObj.data=a.manageTestGroupConditionObject.organization),b.isEmpty(a.manageTestGroupConditionObject.organizationLocation)||(a.manageTestGroupConditionObject.orgLocationObj.data=a.manageTestGroupConditionObject.organizationLocation))},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestMeasurementGroupName=function(b){a.diagnosticTestMeasurementGroupAutoCmp=!0;var e={};return e.name=b,c.getData(d.getParameterizedUrl("FIND_TESTGROUPBYNAME",e),null,function(b){return a.diagnosticTestMeasurementGroupAutoCmp=!1,a.diagnosticTestMeasurementGroupList=angular.fromJson(b.data)},function(b){a.diagnosticTestMeasurementGroupAutoCmp=!1})},/**
     * Find benchmark charts
     */
a.getBenchmark=function(b){var e={};return e.benchmarkName=b,c.getData(d.getParameterizedUrl("FIND_BENCHMARKBYNAME",e),null,function(b){return a.benchmarkList=angular.fromJson(b.data)},function(){})},a.viewPrintFile=function(c,d){if(!b.isEmpty(d)){var e=new Object;e.fileName=d.fileName,e.resourceId=d.id,e.docType=d.documentType.type,e.docSubType=d.documentType.subType,a.fileResource=e,a.viewFileContent=!0,a.isHidingPrintButton=!0}},a.setReferenceChartId=function(b){a.manageTestGroupConditionObject.referenceChart={id:b.id}},/**
     * Create/update function
     * @param {object} formObject      Test group link form object
     * @param {object} testGroupObject  Test group link object
     */
a.createTestGroupLink=function(f,g){if(f.$valid){var h={};if(angular.copy(g,h),b.isEmpty(h.organizationObj)||(h.organization=h.organizationObj.data,delete h.organizationObj),b.isEmpty(h.orgLocationObj)||(h.organizationLocation=h.orgLocationObj.data,delete h.orgLocationObj),h=b.checkNullProp(h),b.isNullOrEmpty(h.id))c.postData(d.getUrl("CREATE_TESTGROUP_CONDITION"),h,function(c){b.isNullOrEmpty(c.messages)&&(e("success",c.data.successMessage),a.back())},function(a){});else{var i={};i.id=h.id,c.putData(d.getParameterizedUrl("UPDATE_TESTGROUP_CONDITION",i),h,function(c){b.isNullOrEmpty(c.messages)&&(e("success",c.data.successMessage),a.back())},function(a){})}}},a.back=function(){b.goBackToPrevState()},a.init()}]),angular.module("paripal.labCRM").controller("ManageTestOrgLocationCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$stateParams","$mdDialog","$translate","$rootScope","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.manageTestOrgLocationObject={},a.manageTestOrgLocationObject.whetherActive=!0,a.manageTestOrgLocationObject.priorAppointmentNeeded=!1,a.commonConstants=i,a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.status={},a.init=function(){a.checkPageState()},a.checkPageState=function(){if("add"===j.type||b.isNullOrEmpty(j.type)){a.pageState="add",a.manageTestOrgLocationObject.organization={},a.manageTestOrgLocationObject.organizationLocation={};var e=n.getDefaultOrgLocation();b.isFieldEmpty(e)||(a.manageTestOrgLocationObject.organization={data:e.org},a.manageTestOrgLocationObject.organizationLocation={data:e.orgLoc})}else{a.pageState=j.type;var f={};f.id=j.data.id,c.getData(d.getParameterizedUrl("FIND_TESTORGLOCATIONBYID",f),null,function(b){a.setTestOrgLocationObject(b.data)},function(){})}},a.setTestOrgLocationObject=function(b){if(b.organization){var c=angular.copy(b.organization);b.organization.data=c}if(b.organizationLocation){var d=angular.copy(b.organizationLocation);b.organizationLocation.data=d}angular.copy(b,a.manageTestOrgLocationObject)},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b,e){a.diagnosticNameAutoCmp=!0;var f={};f.diagnosticTestName=b;var g=d.getParameterizedUrl("FIND_ACTIVE_DIAGNOSTIC_TESTS",f)+"&whetherActive="+e;return c.getData(g,null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},/**
     *Server side pagination module
     */
a.manageTestOrgLocation=function(f,g){if(g.$valid){var h={};if(a.isRequestSent=!0,angular.copy(f,h),b.isEmpty(f.organizationLocation)||(h.organizationLocation=f.organizationLocation.data),b.isEmpty(f.organization)||(h.organization=f.organization.data),delete h.diagnosticTest.flag,f.id){var i={};i.id=f.id,c.putData(d.getParameterizedUrl("UPDATE_TESTORGLOCATIONLINK",i),h,function(c){a.isRequestSent=!1,b.isNullOrEmpty(c.data.successMessage)||b.isEmpty(c.data)||(e("success",c.data.successMessage),a.back())},function(b){a.isRequestSent=!1})}else c.postData(d.getUrl("CREATE_TESTORGLOCATIONLINK"),h,function(f){if(a.isRequestSent=!1,!b.isNullOrEmpty(f.data.successMessage)&&!b.isEmpty(f.data)){/*$scope.back();*/
if(e("success",f.data.successMessage),!b.isNullOrEmpty(f.data.response))var g={diagTestOrgLocationId:f.data.response};var h=k.confirm().title(l.instant("CONFIRM_ACTION")).textContent(l.instant("PROCESS_DEFAULT_BILL")).ok(l.instant("YES")).cancel(l.instant("NO"));k.show(h).then(function(){m.showSpinner=!0,c.putData(d.getParameterizedUrl("BILL_CONFIG",g),null,function(c){m.showSpinner=!1,b.isNullOrEmpty(c.data.successMessage)||b.isEmpty(c.data)||(e("success",c.data.successMessage),a.back())},function(b){a.isRequestSent=!1,m.showSpinner=!1})},function(){m.showSpinner=!1,a.back()})}},function(b){a.isRequestSent=!1})}},a.back=function(){b.goBackToPrevState()},a.init()}]),angular.module("paripal.labCRM").controller("MeasurementSymptomsListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$stateParams",function(a,b,c,d,e,f,g,h,i,j){a.filterObject={},a.currentPage=1,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.pagingInfo={},a.indicatorList=[],a.findIndicatorByName=function(e){var f={};if(b.isNullOrEmpty(e))f.measurementIndicatorName="";else{if(!(e.length>2))return a.indicatorByNameList;f.measurementIndicatorName=e}return c.getData(d.getParameterizedUrl("FIND_INDICATORBYNAME",f),null,function(b){return a.indicatorByNameList=angular.fromJson(b.data)})};var k=function(){b.isFieldEmpty(j.data)||(a.filterObject.indicatorObj=j.data,a.searchData())};/**
     *search Data functionality
     */
a.searchData=function(){var e={};a.indicatorConditionListSpinner=!0,angular.copy(a.filterObject,e),e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.filterObject)||(e.measurementIndicatorId=a.filterObject.measurementIndicatorId,delete e.indicatorObj),e=b.checkNullProp(e),c.postData(d.getUrl("GET_ALLINDICATORCONDITIONS"),e,function(b){a.indicatorConditionListSpinner=!1,a.indicatorData=angular.fromJson(b.data),a.totalItems=a.indicatorData.totalRecords,a.indicatorList=a.indicatorData.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.indicatorConditionListSpinner=!1})},a.back=function(){b.goBackToPrevState()},a.clear=function(){h.reload(),a.filterObject={},a.searchData()},a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};/**
         *datatble config json
         */
var l=i.gridConfigurations;a.options=f.setOptionProperties(l),k()}]),angular.module("paripal.labCRM").controller("SearchLabCtrl",["$scope","utilService","httpService","urlService","datatableconfig","serverSidePagination","commonConstants","dateconvertor","notify","$filter","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.status={open:!0},a.filterObject={},a.currentPage=g.defaultPageNo,a.itemPerPage=g.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.filterObject.organization={},a.filterObject.organizationLocation={},a.pagingInfo={},a.commonConstants=g,/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b){a.diagnosticNameAutoCmp=!0;var e={};return e.diagnosticTestName=b,c.getData(d.getParameterizedUrl("FIND_ACTIVE_DIAGNOSTIC_TESTS",e),null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},/**
     *Get Indicator name on autocomplete
     */
a.findIndicatorByName=function(b){a.indicatorAutoCmpLoading=!0;var e={},f=[];return e.measurementIndicatorName=b,c.getData(d.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",e),null,function(b){return a.indicatorAutoCmpLoading=!1,f=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},a.checkfield=function(c){c.$valid&&!b.isNullOrEmpty(a.filterObject.diagnosticTest)||!b.isNullOrEmpty(a.filterObject.indicatorObj)?a.searchData():i("warning",j("translate")("PLEASE_SELECT_TEST_OR_INDICATOR"))},/**
     *search Data functionality
     */
a.searchData=function(){var e={};a.searchLabSpinner=!0,angular.copy(a.filterObject,e),e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.filterObject.organization)&&b.isEmpty(a.filterObject.organizationLocation)||(e.organizationId=a.filterObject.organization.data.id,e.organizationLocationId=a.filterObject.organizationLocation.data.id,delete e.organization,delete e.organizationLocation),b.isEmpty(a.filterObject.diagnosticTest)||(e.diagnosticTestId=e.diagnosticTest.id,delete e.diagnosticTest),b.isEmpty(a.filterObject.indicatorObj)||(e.measurementIndicatorId=e.indicatorObj.id,delete e.indicatorObj),delete e.postalCode,e=b.checkNullProp(e),c.postData(d.getUrl("GET_SEARCH_LAB"),e,function(b){a.searchLabSpinner=!1;var c={};c=angular.fromJson(b.data),a.totalItems=c.totalRecords,a.searchLabList=c.data,a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.searchLabSpinner=!1})},a.pageChanged=function(){a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},a.clear=function(){a.filterObject={},a.filterObject.organization={},a.filterObject.organizationLocation={},a.$broadcast("clearOrgAndOrgLoc"),
//        $scope.searchLabList = [];
a.totalItems="",k.reload()};/**
     *datatble config json
     */
var l=g.gridConfigurations;a.options=e.setOptionProperties(l)}]),angular.module("paripal.labCRM").controller("TestCommentListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants",function(a,b,c,d,e,f,g,h,i){a.filterObject={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.requestData={},a.commonConstants=i,a.init=function(){},/**
     *Get User name on autocomplete
     */
a.findUserByName=function(b){a.userNameAutoCmp=!0;var e={},f=[];return e.userName=b,c.getData(d.getParameterizedUrl("FIND_USERBYNAME",e),null,function(b){return a.userNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b){a.diagnosticNameAutoCmp=!0;var e={};return e.diagnosticTestName=b,c.getData(d.getParameterizedUrl("FIND_ACTIVE_DIAGNOSTIC_TESTS",e),null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},/**
     *Get Group name on autocomplete
     */
a.getGroupNameList=function(b){a.groupNameAutoCmp=!0;var e={},f=[];return e.measurementGroupName=b,c.getData(d.getParameterizedUrl("FIND_GROUPBYNAME",e),null,function(b){return a.groupNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.groupNameAutoCmp=!1})},/**
     *Get Indicator name on autocomplete
     */
a.findIndicatorByName=function(e){var f={};if(b.isNullOrEmpty(e))f.measurementIndicatorName="";else{if(!(e.length>2))return a.indicatorByNameList;f.measurementIndicatorName=e}return c.getData(d.getParameterizedUrl("FIND_INDICATORBYNAME",f),null,function(b){return a.indicatorByNameList=angular.fromJson(b.data)})},/**
     *search Data functionality
     */
a.searchData=function(){var e={};a.indicatorConditionListSpinner=!0,angular.copy(a.filterObject,e),e.measurementIndicatorName,e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.filterObject.userObj)||(e.userId=a.filterObject.userObj.id,delete e.userObj),b.isEmpty(a.filterObject.diagnosticTestNameObj)||(e.diagnosticTestId=a.filterObject.diagnosticTestNameObj.diagnosticTestId,delete e.diagnosticTestNameObj),b.isEmpty(a.filterObject.groupNameObj)||(e.measurementGroupId=a.filterObject.groupNameObj.measurementGroupId,delete e.groupNameObj),b.isEmpty(a.filterObject.indicatorObj)||(e.measurementIndicatorId=a.filterObject.indicatorObj.id,delete e.indicatorObj),b.isNullOrEmpty(a.filterObject.dateFrom)||(e.dateFrom=dateconvertor.convertToServerDate(a.filterObject.dateFrom)),b.isNullOrEmpty(a.filterObject.dateTill)||(e.dateTill=dateconvertor.convertToServerDate(a.filterObject.dateTill)),e=b.checkNullProp(e),e.sorters=a.requestData.sorters,c.postData(d.getUrl(""),e,function(b){a.indicatorConditionListSpinner=!1,a.indicatorData=angular.fromJson(b.data),a.totalItems=a.indicatorData.totalRecords,a.indicatorList=a.indicatorData.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.indicatorConditionListSpinner=!1})},a.searchData(),/**
     *Edit indicator functionality
     */
a.editViewTestComment=function(b,e){a.requestObject={},a.requestObject.id=b.id,c.getData(d.getParameterizedUrl("//FIND_INDICATORCONDITIONBYID",a.requestObject),null,function(a){h.go("managetestcomment",{type:e,data:angular.fromJson(a.data)})})},/**
     *Clear function
     */
a.clear=function(){a.filterObject={},a.$broadcast("clearOrgAndOrgLoc"),a.searchData(),h.reload()},/**
     *Add new function
     */
a.addNewTestComment=function(){h.go("managetestcomment",{type:""})},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},a.init();/**
     *datatble config json
     */
var j=i.gridConfigurations;a.options=f.setOptionProperties(j)}]),angular.module("paripal.labCRM").controller("TestDiseaseListCtrl",["$scope","$rootScope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$mdDialog","$filter","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m){
//popup controller
function n(a,b,c,d,e,f,g,h){/**
         * Hide popup
         */
a.hide=function(){a.addTestDiseaseLinkObj={},h.hide()},/**
         * Cancel popup
         */
a.cancel=function(){a.addTestDiseaseLinkObj={},h.cancel()},a.addTestDiseaseLinkObj={},a.init=function(){a.checkPageState()},a.checkPageState=function(){"add"===g.type?(a.pageState="add",a.addTestDiseaseLinkObj={},a.addTestDiseaseLinkObj.whetherActive=!1,a.filterObject.diagnosticTest&&(a.addTestDiseaseLinkObj.diagnosticTest=a.filterObject.diagnosticTest)):(a.pageState=g.type,angular.copy(g.data,a.addTestDiseaseLinkObj))},/**
         *Create funtionality
         */
a.createTestDiseaseLink=function(f,g){if(g.$valid){var i={};a.isRequestSent=!0,i.diagnosticTest=f.diagnosticTest,i.relationship=f.relationship.dataValue,i.diseaseVariant=f.diseaseVariant,i.diseaseSpecificPrecondition=f.diseaseSpecificPrecondition,i.measurementRelatedRemarks=f.measurementRelatedRemarks,delete i.diagnosticTest.flag,f.id?(i.id=f.id,i.version=f.version,i.whetherActive=f.whetherActive,c.putData(d.getParameterizedUrl("UPDATE_TEST_DISEASE",i),i,function(c){b.isNullOrEmpty(c.data.message)&&(a.isRequestSent=!1,e("success",c.data.successMessage),h.hide(),a.searchData(a.filterObject))},function(){a.isRequestSent=!1})):(i.whetherActive=!0,c.postData(d.getUrl("CREATE_TESTDISEASELINK"),i,function(c){b.isNullOrEmpty(c.messages)&&(a.filterObject.diagnosticTest=f.diagnosticTest,a.isRequestSent=!1,e("success",c.data.successMessage),a.hide(),a.searchData(a.filterObject))},function(b){a.isRequestSent=!1}))}},/**
         * Find diseases not linked to the test
         * @param   {string} viewValue To find group by name
         * @param   {number} testId    TestId to return unlinked groups
         * @returns {Array} List of groups
         */
a.findDiseaseByName=function(b,e){var f={};f.diagnosticTestId=e;var g=[];return f.diseaseVariantName=b,a.diseaseVariantAutoCmp=!0,c.getData(d.getParameterizedUrl("FIND_UNLINKEDDISEASESBYNAME",f),null,function(b){return a.diseaseVariantAutoCmp=!1,g=angular.fromJson(b.data)},function(b){a.diseaseVariantAutoCmp=!1})},a.init()}n.$inject=["$scope","utilService","httpService","urlService","notify","$state","stateParams","$mdDialog"],a.filterObject={},a.addTestDiseaseLinkObj={},a.addTestDiseaseLinkObj.whetherActive=!0,a.currentPage=j.defaultPageNo,a.itemPerPage=j.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=j,a.init=function(){"callLink"===m.type&&(a.filterObject.diagnosticTest=m.data,a.searchData(a.filterObject))},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b,c){var f={};f.diagnosticTestName=b;var g=e.getParameterizedUrl("FIND_ACTIVE_DIAGNOSTIC_TESTS",f);return c?(a.diagnosticNameAutoCmp=!0,g=g+"&whetherActive="+c):a.diagnosticTestNameAutoCmp=!0,d.getData(g,null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameAutoCmp=!1})},/*    $scope.sort = function (testObject, value) {
            $scope.searchData(testObject, value);
        };*/
/**
     *search Data functionality
     */
a.searchData=function(b,f){if(!c.isEmpty(b)){var g={};a.testDiseaseListSpinner=!0,angular.copy(b,g),g.pageNumber=a.currentPage,g.recordsPerPage=a.itemPerPage,c.isEmpty(b.diagnosticTest)||(g.diagnosticTestName=b.diagnosticTest.value,delete g.diagnosticTest),d.postData(e.getUrl("GET_TEST_DISEASE_LIST"),g,function(b){a.testDiseaseListSpinner=!1,a.data=angular.fromJson(b.data),a.totalItems=a.data.totalRecords,a.testDiseaseList=a.data.data,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.testDiseaseListSpinner=!1})}},/**
     * Activate/Inactivate test-disease link
     * @param {number}  id              Id of the link
     * @param {boolean} whetherActive Boolean value to be changed to
     */
a.toggleActiveStatus=function(b,c){var g={};g.id=b,g.whetherActive=c,d.putData(e.getParameterizedUrl("TOGGLE_ACTIVE_TEST_DISEASE_STATUS",g),null,function(b){b.data.successMessage&&(f("success",b.data.successMessage),a.searchData(a.filterObject))})},/**
     * Function called for calling a popup
     */
a.addEditViewDiseaseRecord=function(b,c,d,e){e||void 0===e?k.show({scope:a,preserveScope:!0,controller:n,templateUrl:"app/modules/labCRM/views/manage-test-disease-link.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:j.dialogBox.clickOutsideToClose,locals:{stateParams:{type:d,data:b}}}):f("Warning",l("translate")("TEST_DISEASE_LINK_ERROR"))},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData(a.filterObject)},a.setMaxRecords=function(b){c.isEmpty(a.filterObject)?f("Warning",l("translate")("INVALID_TEST_NAME")):(a.currentPage=1,a.itemPerPage=b,a.searchData(a.filterObject))};/**
     *datatble config json
     */
var o=j.gridConfigurations;a.options=g.setOptionProperties(o),a.init(),a.dtColumnDefs=g.setColumnProperties({notSoratbleCol:[0,1,2]})}]),angular.module("paripal.labCRM").controller("TestGroupConditionListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$mdDialog","$filter","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l){a.filterObject={},a.filterObject.organization={},a.filterObject.orgLocation={},a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=i,a.init=function(){"linkCalled"===l.type&&(a.filterObject.diagnosticTestNameObj=l.data.test,a.filterObject.groupNameObj=l.data.group),a.searchData(a.filterObject)},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b){a.diagnosticNameAutoCmp=!0;var e={};return e.diagnosticTestName=b,c.getData(d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",e),null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},/**
     *Get Diagnostic group name on autocomplete
     */
a.getMeasurementGroupName=function(b){a.groupNameAutoCmp=!0;var e={};return e.measurementGroupName=b,c.getData(d.getParameterizedUrl("FIND_GROUPBYNAME",e),null,function(b){return a.groupNameAutoCmp=!1,a.measurementGroupList=angular.fromJson(b.data)},function(b){a.groupNameAutoCmp=!1})},/**
     *search Data functionality
     */
a.searchData=function(e){var f={};a.testGroupConditionListSpinner=!0,angular.copy(e,f),f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage,b.isEmpty(e.diagnosticTestNameObj)||(f.diagnosticTestId=e.diagnosticTestNameObj.diagnosticTestId,delete f.diagnosticTestNameObj),b.isEmpty(e.groupNameObj)||(f.measurementGroupId=e.groupNameObj.measurementGroupId,delete f.groupNameObj),b.isEmpty(e.orgLocation)||(f.organizationLocationId=e.orgLocation.data.id,delete f.orgLocation,delete f.organization),delete f.orgLocation,delete f.organization,b.checkNullProp(f),c.postData(d.getUrl("GET_TEST_GROUP_CONDITION_LIST"),f,function(b){a.testGroupConditionListSpinner=!1,a.data=angular.fromJson(b.data),a.totalItems=a.data.totalRecords,a.testGroupConditionList=a.data.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.testGroupConditionListSpinner=!1})},/**
     * Add new test-group condition
     */
a.manageTestGroupCondition=function(a,b){h.go("managetestgroupcondition",{data:a,type:b})},/**
     * Activate/Inactivate test-group link
     * @param {number}  id              Id of the link
     * @param {boolean} whetherActive Boolean value to be changed to
     */
a.toggleActiveStatus=function(b,f){var g={};g.id=b,g.whetherActive=f,c.putData(d.getParameterizedUrl("TOGGLE_ACTIVE_TEST_GROUP_STATUS",g),null,function(b){b.data.successMessage&&(e("success",b.data.successMessage),a.searchData(a.filterObject))})},/**
     *Clear function
     */
a.clear=function(){a.filterObject={},a.filterObject.organization={},a.filterObject.orgLocation={},a.searchData(a.filterObject)},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData(a.filterObject)},a.setMaxRecords=function(c){b.isEmpty(a.filterObject)?e("Warning",k("translate")("INVALID_TEST_NAME")):(a.currentPage=1,a.itemPerPage=c,a.searchData(a.filterObject))};/**
     *datatble config json
     */
var m=i.gridConfigurations;a.options=f.setOptionProperties(m),a.init()}]),angular.module("paripal.labCRM").controller("TestGroupListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$mdDialog","$filter","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l){a.filterObject={},a.addTestGroupLinkObj={},a.addTestGroupLinkObj.whetherActive=!0,a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=i,a.init=function(){"callLink"===l.type&&(a.filterObject.diagnosticTest=l.data,a.searchData(a.filterObject))},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b,e){var f={};f.diagnosticTestName=b;var g=d.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",f);return e?(a.diagnosticTestNameAutoCmp=!0,g=g+"&whetherActive="+e):a.diagnosticNameAutoCmp=!0,c.getData(g,null,function(b){return a.diagnosticTestNameAutoCmp=!1,a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticTestNameAutoCmp=!1,a.diagnosticNameAutoCmp=!1})},/**
     *search Data functionality
     */
a.searchData=function(e){var f={};a.testGroupListSpinner=!0,angular.copy(e,f),f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage,b.isEmpty(e.diagnosticTest)||(f.diagnosticTestName=e.diagnosticTest.diagnosticTestName,delete f.diagnosticTest),b.isEmpty(e.measurementGroup)||delete f.measurementGroup,c.postData(d.getUrl("GET_ALLTESTGROUPS"),f,function(b){a.testGroupListSpinner=!1,a.data=angular.fromJson(b.data),a.totalItems=a.data.totalRecords,a.testGroupList=a.data.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.testGroupListSpinner=!1})},/**
     * Function called for calling a popup
     */
a.addTestGroup=function(c,d){j.show({scope:a,preserveScope:!0,templateUrl:"app/modules/labCRM/views/add-test-group-link.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:i.dialogBox.clickOutsideToClose}).then(function(a){},function(){a.WSHealthProfessionalsValues={}}),b.isEmpty(d)||(a.addTestGroupLinkObj.diagnosticTestNameObj=d)},/**
     * Called to create group-test link
     * @param {object}   testObj  Diagnostic test
     * @param {object} groupObj [[Description]]
     */
a.createTestGroupLink=function(f,g,h){if(h.$valid){var i={};a.isRequestSent=!0,i.diagnosticTest={id:f.diagnosticTestId,diagnosticTestName:f.diagnosticTestName,whetherActive:f.whetherActive},i.measurementGroup=g,c.postData(d.getUrl("CREATE_TESTGROUPLINK"),i,function(c){b.isNullOrEmpty(c.messages)&&(a.addTestGroupLinkObj={},a.isRequestSent=!1,e("success",c.data.successMessage),a.hide(),a.searchData(i))},function(b){a.isRequestSent=!1})}},/**
     * Hide popup
     */
a.hide=function(){a.addTestGroupLinkObj={},j.hide()},/**
     * Cancel popup
     */
a.cancel=function(){a.addTestGroupLinkObj={},j.cancel()},/**
     * Activate/Inactivate test-group link
     * @param {number}  id              Id of the link
     * @param {boolean} whetherActive Boolean value to be changed to
     */
a.toggleActiveStatus=function(b,f){var g={};g.id=b,g.whetherActive=f,c.putData(d.getParameterizedUrl("TOGGLE_ACTIVE_TEST_GROUP_STATUS",g),null,function(b){b.data.successMessage&&(e("success",b.data.successMessage),a.searchData(a.filterObject))})},a.testGroupCondition=function(a,b){h.go("testgroupconditionlist",{data:{test:{diagnosticTestId:a.id,diagnosticTestName:a.diagnosticTestName},group:{measurementGroupName:b.measurementGroupName,measurementGroup:b.id}},type:"linkCalled"})},/**
     * Find groups not linked to the test
     * @param   {string} viewValue To find group by name
     * @param   {number} testId    TestId to return unlinked groups
     * @returns {Array} List of groups
     */
a.findGroupByName=function(b,e){var f={};f.testId=e,f.groupName=b,a.measurementGroupAutoCmp=!0;var g=d.getParameterizedUrl("FIND_UNLINKEDGROUPBYNAME",f);return g+="&whetherActive=true",c.getData(g,null,function(b){return a.measurementGroupAutoCmp=!1,a.unlinkedGroupList=angular.fromJson(b.data)},function(b){a.measurementGroupAutoCmp=!1})},/**
     *Clear function
     */
a.clear=function(){a.filterObject={},a.testGroupList=[]},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData(a.filterObject)},a.setMaxRecords=function(c){b.isEmpty(a.filterObject)?e("Warning",k("translate")("INVALID_TEST_NAME")):(a.currentPage=1,a.itemPerPage=c,a.searchData(a.filterObject))};/**
     *datatble config json
     */
var m=i.gridConfigurations;a.options=f.setOptionProperties(m),a.init()}]),angular.module("paripal.labCRM").controller("TestOrgLocationListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","commonConstants","$mdDialog","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k){a.filterObject={},a.filterObject.organization={},a.filterObject.orgLocation={},a.commonConstants=i,a.currentPage=i.defaultPageNo,a.itemPerPage=i.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.status={};var l=function(){b.isFieldEmpty(k.data)?a.searchData():(a.filterObject.diagnosticTest=k.data,a.searchData())};/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b){a.diagnosticNameAutoCmp=!0;var e={};return e.diagnosticTestName=b,c.getData(d.getParameterizedUrl("FIND_ACTIVE_DIAGNOSTIC_TESTS",e),null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},/**
     *Get Symptom name on autocomplete
     */
a.getSymptomList=function(b){a.symptomNameAutoCmpLoading=!0;var e={};return a.symptomList=[],e.symptomName=b,c.getData(d.getParameterizedUrl("FIND_SYMPTOMNAME",e),null,function(b){return a.symptomNameAutoCmpLoading=!1,a.symptomList=angular.fromJson(b.data)},function(b){a.symptomNameAutoCmpLoading=!1})},a.findIndicatorByName=function(b){var e={};return e.measurementIndicatorName=b,c.getData(d.getParameterizedUrl("FIND_INDICATORBYNAME",e),null,function(b){return a.indicatorByNameList=angular.fromJson(b.data)})},/**
     * Get disease by name
     * @param   {string} viewValue Value entered
     * @returns {[[Type]]} [[Description]]
     */
a.getDisease=function(b){a.diseaseNameAutoCmpLoading=!0;var e={};return e.searchKeyWord=b,c.getData(d.getParameterizedUrl("GET_DISEASE_VARIANTS",e),null,function(b){return a.diseaseNameAutoCmpLoading=!1,a.disObj=angular.fromJson(b.data)},function(b){a.diseaseNameAutoCmpLoading=!1})},/**
     * Get group list by name
     * @param   {string} viewValue Value entered by user
     * @returns {Array} List of groups
     */
a.getGroupName=function(b){var e={};return e.measurementGroupName=b,c.getData(d.getParameterizedUrl("FIND_GROUPBYNAME",e),null,function(b){return a.groupNameList=angular.fromJson(b.data)},function(a){})},/**
     *search Data functionality
     */
a.searchData=function(){var e={};a.testOrgLocListSpinner=!0,angular.copy(a.filterObject,e),e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.filterObject.organization)||(e.organizationId=a.filterObject.organization.data.id),b.isEmpty(a.filterObject.orgLocation)||(e.organizationLocationId=a.filterObject.orgLocation.data.id),b.isEmpty(a.filterObject.diagnosticTest)||(e.diagnosticTestId=a.filterObject.diagnosticTest.id),delete e.diagnosticTest,b.isEmpty(a.filterObject.groupNameObj)||(e.measurementGroupId=a.filterObject.groupNameObj.measurementGroupId),delete e.groupNameObj,b.isEmpty(a.filterObject.indicatorObj)||(e.measurementIndicatorId=a.filterObject.indicatorObj.id),delete e.indicatorObj,b.isEmpty(a.filterObject.disease)||(e.diseaseId=a.filterObject.disease.id),delete e.disease,delete e.organization,delete e.orgLocation,c.postData(d.getUrl("GET_TESTORGSEARCHCRITERIALIST"),e,function(b){a.testOrgLocListSpinner=!1;var c=angular.fromJson(b.data);a.totalItems=c.totalRecords,a.testOrgLocList=c.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.testOrgLocListSpinner=!1})},a.manageTestOrgLocation=function(a,b){h.go("managetestorglocation",{data:b,type:a})},/**
     *Clear function
     */
a.clear=function(){a.filterObject={},a.filterObject.organization={},a.filterObject.orgLocation={},a.searchData(),h.reload()},/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()},a.toggleActiveStatus=function(b,f){var g={};g.id=b,g.whetherActive=f,c.putData(d.getParameterizedUrl("TOGGLE_ACTIVE_TESTORGLOCATION_STATUS",g),null,function(b){b.data.successMessage&&(e("success",b.data.successMessage),a.searchData())})},l();/**
     *datatble config json
     */
var m=i.gridConfigurations;a.options=f.setOptionProperties(m)}]),angular.module("paripal.labCRM").controller("UserMeasurementListCtrl",["$scope","$rootScope","utilService","httpService","urlService","datatableconfig","serverSidePagination","commonConstants","dateconvertor","notify","$filter","$mdDialog","$state","$stateParams","userStatusService","$timeout","baseService","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a,b,f,g){function h(){i()}function i(){a.pageState=g}a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.checkNumber=function(a){var b=parseInt(a);if(angular.isNumber(b)&&NaN!=b)return b},a.update=function(f,g){if(f.$valid&&g.id){a.isRequestSent=!0;var h=angular.copy(g);delete h.measurementDate;var i={};i.id=g.id,d.putData(e.getParameterizedUrl("UPDATE_USERMEASUREMENT",i),h,function(d){a.isRequestSent=!1,c.isEmpty(d.data)||(j("success",d.data.successMessage),b.hide())},function(){a.isRequestSent=!1})}},h(),a.userMeasurementObject=angular.copy(f)}s.$inject=["$scope","$mdDialog","data","type"],a.filterObject={},a.currentPage=h.defaultPageNo,a.itemPerPage=h.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.currentPage=1,1==a.listView?a.itemPerPage=10:a.itemPerPage=12,a.pagingInfo={},a.commonConstants=h,/* CARD VIEW CHANGES START */
a.listView=!1,a.cardView=!0,a.btnText=r.instant("LIST_VIEW"),a.toggleView=function(){1==a.listView?(a.cardView=!0,a.listView=!1,a.btnText=r.instant("LIST_VIEW"),a.itemPerPage=12,a.searchData()):(a.cardView=!1,a.listView=!0,a.btnText=r.instant("CARD_VIEW"),a.itemPerPage=10,a.searchData())};/* CARD VIEW CHANGES END */
/*Initialiazation*/
var t=function(){if(o.isUserLoggedIn()){var b=o.userStatus();a.isUserDisable=!b.isOrgUser,b.isOrgUser||c.isFieldEmpty(b.userData)||(a.filterObject.userObj=b.userData,a.clientId=b.userData.id)}c.isFieldEmpty(n.data)?a.status={open:!0}:(a.filterObject.diagnosticTest=n.data.diagnosticTest,a.filterObject.userObj=n.data.user,a.clientId=n.data.user.id,"linkCalled"===n.type&&(a.disableAddEdit=!0),a.searchData()),q.validateListing("USER_MEASUREMENT_RECORD_SUB"),n.fromState&&"stakeHolderUserDPR"==n.fromState?a.restrictAdd=!0:a.restrictAdd=!1};/*
     *Get User name on autocomplete
     */
a.findUserByName=function(b){a.userNameAutoCmp=!0;var c={},f=[];return c.searchString=b,d.getData(e.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b,c){a.diagnosticNameAutoCmp=!0;var f={};return f.userId=b.id,f.userTestTrName=c,d.getData(e.getParameterizedUrl("FIND_USERTESTBYUSERID",f),null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},a.viewBenchmarkChart=function(b){var c;a.clientId?c=a.clientId:a.filterObject&&a.filterObject.userObj&&(c=a.filterObject.userObj.id),m.go("benchmarkchartdatalist",{recordId:b.measurementIndicatorId,fromPage:"userMeasurement",clientId:c})},/**
     *Get Group name on autocomplete
     */
a.getGroupNameList=function(b){a.groupNameAutoCmp=!0;var c={},f=[];return c.measurementGroupName=b,d.getData(e.getParameterizedUrl("FIND_GROUPBYNAME",c),null,function(b){return a.groupNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.groupNameAutoCmp=!1})},/**
     *Get Indicator name on autocomplete
     */
a.findIndicatorByName=function(b){a.indicatorAutoCmpLoading=!0;var c={},f=[];return c.measurementIndicatorName=b,d.getData(e.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",c),null,function(b){return a.indicatorAutoCmpLoading=!1,f=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},/**
     *search Data functionality
     */
a.searchData=function(){if(c.isFieldEmpty(a.filterObject.userObj)||c.isFieldEmpty(a.filterObject.diagnosticTest))j("warning",k("translate")("PLEASE_SELECT_TEST"));else{var f={};b.showSpinner=!0,angular.copy(a.filterObject,f),f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage,c.isEmpty(a.filterObject.userObj)||(f.userId=a.filterObject.userObj.id,delete f.userObj),c.isEmpty(a.filterObject.groupNameObj)||(f.measurementGroup={id:a.filterObject.groupNameObj.measurementGroupId,value:a.filterObject.groupNameObj.measurementGroupName},delete f.groupNameObj),c.isNullOrEmpty(a.filterObject.dateFrom)||(f.dateFrom=i.convertToServerDate(a.filterObject.dateFrom)),c.isNullOrEmpty(a.filterObject.dateTill)||(f.dateTill=i.convertToServerDate(a.filterObject.dateTill)),delete f.diagnosticTest.flag,f=c.checkNullProp(f),d.postData(e.getUrl("GET_USER_MEASUREMENT"),f,function(c){b.showSpinner=!1;var d={};d=angular.fromJson(c.data),a.totalItems=d.totalRecords,a.userMeasurementList=d.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(a){b.showSpinner=!1})}},/*Function to search symptoms*/
a.viewMeasurementSymptoms=function(a){a.ifUserMeasurement=!0,m.go("measurementsymptoms",{data:a,callBackURL:m.current.name})},/**
     * Popup for edit/view functionality of a user-measurement indicator
     * @param {string} pageType Either edit/view
     * @param {object} data     Object to be edited or viewed
     */
a.manageUserMeasurement=function(b,d,e){if("add"!==b)l.show({controller:s,templateUrl:"app/modules/labCRM/views/manage-user-measurement.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:h.dialogBox.clickOutsideToClose,locals:{data:d,type:b}}).then(function(){a.searchData()},function(){});else{var f={};f.user={id:d.userObj.id,value:d.userObj.value},c.isFieldEmpty(d.diagnosticTest)||(f.diagnosticTest=d.diagnosticTest),m.go("addusermeasurement",{data:f})}},a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){c.isEmpty(a.filterObject.userObj)?j("warning",k("translate")("PLEASE_SELECT_USER")):(a.currentPage=1,a.itemPerPage=b,a.searchData())},a.clear=function(){a.filterObject={},a.$broadcast("clearOrgAndOrgLoc"),a.userMeasurementList=[],a.totalItems="",m.reload()};/**
     *datatble config json
     */
var u=h.gridConfigurations;a.options=f.setOptionProperties(u),t()}]),angular.module("paripal.labCRM").controller("UserMeasurementManagementCtrl",["$rootScope","$scope",function(a,b){"use strict"}]),angular.module("paripal.labCRM").controller("ViewMeasurementIndicatorPopupCtrl",["$scope","utilService","httpService","urlService","datatableconfig","serverSidePagination","commonConstants","dateconvertor","notify","$filter","$mdDialog","$state","$stateParams","userStatusService","$timeout","baseService","$translate","diagnosticTest","patient","BenchmarkChartParameterListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(a,e,f,g){function h(){j()}function j(){a.pageState=g}a.hide=function(){e.hide()},a.cancel=function(){e.cancel()},a.checkNumber=function(a){var b=parseInt(a);if(angular.isNumber(b)&&NaN!=b)return b},a.update=function(f,g){if(f.$valid&&g.id){a.isRequestSent=!0;var h=angular.copy(g);delete h.measurementDate;var j={};j.id=g.id,c.putData(d.getParameterizedUrl("UPDATE_USERMEASUREMENT",j),h,function(c){a.isRequestSent=!1,b.isEmpty(c.data)||(i("success",c.data.successMessage),e.hide())},function(){a.isRequestSent=!1})}},h(),a.userMeasurementObject=angular.copy(f)}u.$inject=["$scope","$mdDialog","data","type"],a.filterObject={},a.currentPage=g.defaultPageNo,a.itemPerPage=g.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=g,a.WSBenchmarkChart={},a.cancel=function(){k.cancel()};/*Initialiazation*/
var v=function(){r&&s&&(a.filterObject.diagnosticTest=r,a.filterObject.userObj=s,a.clientId=s.id,a.searchData())};/*
     *Get User name on autocomplete
     */
a.findUserByName=function(b){a.userNameAutoCmp=!0;var e={},f=[];return e.searchString=b,c.getData(d.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",e),null,function(b){return a.userNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},/**
     *Get Diagnostic test name on autocomplete
     */
a.getDiagnosticTestName=function(b,e){a.diagnosticNameAutoCmp=!0;var f={};return f.userId=b.id,f.userTestTrName=e,c.getData(d.getParameterizedUrl("FIND_USERTESTBYUSERID",f),null,function(b){return a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticNameAutoCmp=!1})},a.viewBenchmarkChart=function(b){var c;a.clientId&&(c=a.clientId),a.getBenchmarkChartTypeList(b.measurementIndicatorId,"userMeasurement",c),a.initiateBarChart(),a.initiateTimeSeriesChart(),a.initiateLineChart(),a.showBechmarkChart=!0},a.back=function(){a.showBechmarkChart=!1},/**
     *Get Group name on autocomplete
     */
a.getGroupNameList=function(b){a.groupNameAutoCmp=!0;var e={},f=[];return e.measurementGroupName=b,c.getData(d.getParameterizedUrl("FIND_GROUPBYNAME",e),null,function(b){return a.groupNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.groupNameAutoCmp=!1})},/**
     *Get Indicator name on autocomplete
     */
a.findIndicatorByName=function(b){a.indicatorAutoCmpLoading=!0;var e={},f=[];return e.measurementIndicatorName=b,c.getData(d.getParameterizedUrl("FIND_ALLACTIVE_INDICATOR",e),null,function(b){return a.indicatorAutoCmpLoading=!1,f=angular.fromJson(b.data)},function(b){a.indicatorAutoCmpLoading=!1})},/**
     *search Data functionality
     */
a.searchData=function(){if(b.isFieldEmpty(a.filterObject.userObj)||b.isFieldEmpty(a.filterObject.diagnosticTest))i("warning",j("translate")("PLEASE_SELECT_TEST"));else{var e={};a.userMeasurementListSpinner=!0,angular.copy(a.filterObject,e),e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isEmpty(a.filterObject.userObj)||(e.userId=a.filterObject.userObj.id,delete e.userObj),b.isEmpty(a.filterObject.groupNameObj)||(e.measurementGroup={id:a.filterObject.groupNameObj.measurementGroupId,value:a.filterObject.groupNameObj.measurementGroupName},delete e.groupNameObj),b.isNullOrEmpty(a.filterObject.dateFrom)||(e.dateFrom=h.convertToServerDate(a.filterObject.dateFrom)),b.isNullOrEmpty(a.filterObject.dateTill)||(e.dateTill=h.convertToServerDate(a.filterObject.dateTill)),delete e.diagnosticTest.flag,e=b.checkNullProp(e),c.postData(d.getUrl("GET_USER_MEASUREMENT"),e,function(b){a.userMeasurementListSpinner=!1;var c={};c=angular.fromJson(b.data),a.totalItems=c.totalRecords,a.userMeasurementList=c.data,a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.userMeasurementListSpinner=!1})}},/*Function to search symptoms*/
a.viewMeasurementSymptoms=function(a){a.ifUserMeasurement=!0,l.go("measurementsymptoms",{data:a,callBackURL:l.current.name})},/**
     * Popup for edit/view functionality of a user-measurement indicator
     * @param {string} pageType Either edit/view
     * @param {object} data     Object to be edited or viewed
     */
a.manageUserMeasurement=function(c,d,e){if("add"!==c)k.show({controller:u,templateUrl:"app/modules/labCRM/views/manage-user-measurement.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:g.dialogBox.clickOutsideToClose,locals:{data:d,type:c}}).then(function(){a.searchData()},function(){});else{var f={};f.user={id:d.userObj.id,value:d.userObj.value},b.isFieldEmpty(d.diagnosticTest)||(f.diagnosticTest=d.diagnosticTest),l.go("addusermeasurement",{data:f})}},a.pageChanged=function(){a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(c){b.isEmpty(a.filterObject.userObj)?i("warning",j("translate")("PLEASE_SELECT_USER")):(a.currentPage=1,a.itemPerPage=c,a.searchData())},a.clear=function(){a.filterObject={},a.$broadcast("clearOrgAndOrgLoc"),a.userMeasurementList=[],a.totalItems="",l.reload()};/**
     *datatble config json
     */
var w=g.gridConfigurations;a.options=e.setOptionProperties(w),v(),a.getBenchmarkChartData=function(){var b=a.WSBenchmarkChart.benchmarkChartType,c={};c.id=b.id,a.WSBenchmarkChart.whetherTrend?c.whetherTrend=a.WSBenchmarkChart.whetherTrend:c.whetherTrend=!1,a.WSBenchmarkChart.from&&(c.from=h.convertToServerDate(a.WSBenchmarkChart.from)),a.WSBenchmarkChart.till&&(c.till=h.convertToServerDate(a.WSBenchmarkChart.till)),s&&s.id&&(c.userId=s.id),t.getBenchmarkChartData(c,"userMeasurement",function(b){console.log(b),a.chartData=b.columnData,a.chartKeys=b.keys,a.variantKeys=b.variantKeys,"LINE"==b.chartType?a.initiateLineChart():"TIME_SERIES"==b.chartType?a.initiateTimeSeriesChart():a.initiateBarChart()},function(a){})},a.getBenchmarkChartTypeList=function(b,c,d){t.getBenchmarkChartType(b,c,d,function(b){a.benchmarkChartTypeList=b},function(a){})},a.initiateTimeSeriesChart=function(){if(a.chartData&&a.chartKeys){c3.generate({size:{height:600},padding:{top:20},title:{show:!0,text:a.WSBenchmarkChart.benchmarkChartType.benchmarkChart.value,position:"top-center"},bindto:"#bar1",data:{labels:!0,json:a.chartData,keys:a.chartKeys},subchart:{show:!0},axis:{x:{type:"timeseries",tick:{format:"%Y-%m-%d",rotate:90,fit:!0}}},legend:{/*show: scope.legend,*/
show:!0,position:"bottom"},zoom:{enabled:!0,rescale:!0},point:{r:2,focus:{expand:{enabled:!1}}}});angular.forEach(a.variantKeys,function(a,b){var c="c3-line-"+a.replace(/ /g,"-"),d="c3-circles-"+a.replace(/ /g,"-");$("."+c).addClass("c3-target-line-width-5"),$("."+d).children().attr("r",5)}),a.currentBar="bar1"}},a.initiateLineChart=function(){if(a.chartData&&a.chartKeys){c3.generate({title:{show:!0,text:a.WSBenchmarkChart.benchmarkChartType.benchmarkChart.value,position:"top-center"},bindto:"#bar1",data:{labels:!0,json:a.chartData,keys:a.chartKeys},subchart:{show:!0},axis:{x:{type:"line"}},legend:{/*show: scope.legend,*/
show:!0,position:"bottom"}});a.currentBar="bar1"}},a.initiateBarChart=function(){if(a.chartData&&a.chartKeys){c3.generate({title:{show:!0,text:a.WSBenchmarkChart.benchmarkChartType.benchmarkChart.value,position:"top-center"},bindto:"#bar",data:{type:"bar",labels:!0,json:a.chartData,keys:a.chartKeys},subchart:{show:!0},axis:{x:{extent:a.extentWidth,type:"category",label:{position:"inner-right"}},y:{label:{position:"outer-middle"}}},bar:{width:{ratio:.3}},legend:{/*show: scope.legend,*/
show:!0,position:"bottom"}});a.currentBar="bar"}},a.manageBenchmark=function(){l.go("managebenchmarkchartdata")},a.abc=function(){l.go("addbenchmarkparameterdata")},a.xyz=function(){l.go("addparameterdata")}}]),/**
 * Creating home controller in paripal application
 *
 */
angular.module("paripal.landingPageModule").controller("landingPageCtrl",["$rootScope","$scope","$state","$translate","httpService","urlService","utilService","menuGenerationService","commonConstants","fileOperations","feedbackService",function(a,b,c,d,e,f,g,h,i,j,k){b.getElement=function(a){a.preventDefault()},b.getUpdateDocument=function(){var a=f.getUrl("GET_DOCUMENT");e.getData(a,null,function(a){b.document=a.data},function(a){console.log(a)})},b.showDocument=function(a){var c=b.document;a.preventDefault();var d=new Object;d.fileName=c.fileName,d.resourceId=c.id,d.recordId=1,d.docType="RESOURCE",d.docSubType="RESOURCE",d.orgLocId=c.serviceProviderId,b.fileResource=d,b.viewFileContent=!0,b.isHidingPrintButton=!1},b.init=function(){b.getUpdateDocument(),$(".modal-backdrop").removeClass("modal-backdrop")},b.init(),b.listOrganisation=function(a,b){a.preventDefault(),c.go("orglist",{searchType:b})},b.submitFeedback=function(a){a.$valid&&(b.feedbackFormSpinner=!0,k.submitFeedback(a,b.feedback,function(a){b.feedbackFormSpinner=!1,b.feedback=new Object,b.feedbackForm.$setPristine(),b.feedbackForm.$setUntouched()},function(){b.feedbackFormSpinner=!1}))},/*$scope.listTreatmentTypes = function ($event, searchType) {
    $event.preventDefault();
    $state.go("standardmasterlist", {
        searchType: searchType
    })

};*/
b.listUsers=function(a,b){a.preventDefault();var d={};"Doctors"==b?d.type="healthProfessional":"OtherProfessionals"==b&&(d.type="supportServiceProfessional"),c.go("orglocuserlist",{wallData:d})},/**,
                    {
                        id: 2,
                        name: "SEARCH_FOR"
                    }**/
b.tabs=[{id:1,name:"MAIN"},{id:3,name:"STATISTICS"},{id:4,name:"ACTIONS"}],b.selectedTab=b.tabs[0],//To set default tab
b.setCurrentTab=function(a){b.selectedTab=a},b.isActiveTab=function(a){return b.selectedTab.id==a}}]),angular.module("paripal.locationTreatmentModule").controller("LocationTreatmentListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","LocationTreatmentListService","ManageLocationTreatmentService","httpService","urlService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.filterStatus=!1,c=k.getStateParamsFromLocalStarage(c,"locationTreatmentList"),l.isEmpty(c)&&d.go("home.view"),a.goToClientCountByTreatment=function(a){var b={};b.id=a.treatmentType.id,b.value=a.treatmentType.value,d.go("locationtreatmenttypereports",{data:b})},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.addressInfoFilter={},a.wsTreatmentList=[],a.searchCriteria.org={},a.searchCriteria.orgLoc={},a.WSLocationTreatmentType={},a.treatmentType={},
//$scope.mangeProfTreatmentSpinner = false;
a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")},l.isEmpty(k.getLoggedInUser())||(a.isOrganizationUserMode=k.getLoggedInUser().isOrganizationUserMode),l.isEmpty(c.user)||(a.userType=c.user.userType),a.user={queryUrl:"LOCATIONS_BY_NAME_COMBO",queryParameter:{type:a.userType},jsonParameter:{}},a.userRequired=!0,a.treatment={queryUrl:"TREATMENT_TYPE_PUBLIC_COMBO",queryParameter:{},jsonParameter:{}},
//Search User Address
a.searchLocationTreatmentType=function(){
//$scope.treatmentType;
a.mangeProfTreatmentSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,m.searchLocationTreatment(a.searchCriteria,a.addressInfoFilter,function(b){a.mangeProfTreatmentSpinner=!1,a.wsTreatmentList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.mangeProfTreatmentSpinner=!1,f("error",g.instant("TREATMENT_LIST_LOAD_FAILURE"))})},a.manageLocationTreatment=function(b,c,d){h.show({controller:"ManageLocationTreatmentCtrl",templateUrl:"app/modules/location-treatment/views/manage-location-treatment.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:q.dialogBox.clickOutsideToClose,locals:{stateParams:{type:d,locationTreatmentTypeId:c},parentScope:a}}).then(function(){},function(){})},
//Fetch records
a.fetchRecords=function(){a.searchLocationTreatmentType()},
//clear search
a.clear=function(){a.searchCriteria={},a.addressInfoFilter={},b.$broadcast("clearAddressData"),b.$broadcast("clearOrgLocData"),a.searchCriteria.org={},a.searchCriteria.orgLoc={},a.searchCriteria.whetherActive="true",
//$scope.treatmentType = {};
a.searchLocationTreatmentType()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchLocationTreatmentType()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchLocationTreatmentType()};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(r),a.dtColumnDefs=e.setColumnProperties({}),/*Whether activate or inactivate*/
a.toggleActiveStatus=function(b,c){var d={};d.organizationLocationTreatmentTypeId=b,d.whetherActive=c,c?o.getData(p.getParameterizedUrl("ACTIVATION_LOCATION_TREATMENT_TYPE",d),null,function(b){b.data.successMessage&&(f("success",b.data.successMessage),a.searchLocationTreatmentType())}):o.getData(p.getParameterizedUrl("INACTIVATION_LOCATION_TREATMENT_TYPE",d),null,function(b){b.data.successMessage&&(f("success",b.data.successMessage),a.searchLocationTreatmentType())})},a.showReport=function(a,b){d.go(a,{orgLocation:b.organizationLocation,treatmentType:b.treatmentType})},a.init=function(){l.isFieldEmpty(c.wallData)?c.organization&&c.organizationLoc&&(a.searchCriteria.org.data=c.organization,a.searchCriteria.orgLoc.data=c.organizationLoc):(a.searchCriteria.org.data=c.wallData.organization,a.filterStatus=!0,l.isFieldEmpty(c.wallData.orglocation)||(a.searchCriteria.orgLoc.data=c.wallData.orglocation)),a.searchLocationTreatmentType();/* locationCategory label changes */
var b=k.getLocationCategory();a.gridLabel={},l.isFieldEmpty(b)?a.gridLabel.noOfUsers=g.instant("NO_OF_CLIENTS"):"EDUCATIONAL_INSTITUTION"==b.code?a.gridLabel.noOfUsers=g.instant("NO_OF_STUDENTS"):"CORPORATE"==b.code?a.gridLabel.noOfUsers=g.instant("NO_OF_EMPLOYEES"):"SERVICE_PROVIDER"==b.code&&(a.gridLabel.noOfUsers=g.instant("NO_OF_CLIENTS"))},a.init()}]),angular.module("paripal.locationTreatmentModule").controller("ManageLocationTreatmentCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","applicationExceptionService","ManageLocationTreatmentService","stateParams","parentScope","featurePrivilegeConstants","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";c=q,a.isLocationSelected=!1,a.WSLocationTreatmentType={},a.treatmentType={},a.orgLoc={},a.transactionFees=[],a.getTransactionTypeList=function(){p.getLocationTreatmentTypeList(function(b){a.transactionTypeList=b},function(a){})},a.getTransactionTypeList(),a.treatment={queryUrl:"TREATMENT_TYPE_COMBO",queryParameter:{},jsonParameter:{}},
// Add/update follow up EXCEPTION
a.saveLocationTreatmentType=function(){a.WSLocationTreatmentType.organizationLocationTreatmentTypeFees=[],"edit"==a.pageState&&a.treatmentFeeArray&&a.treatmentFeeArray.length>0?(angular.forEach(a.treatmentFeeArray,function(b,c){var d={};d.id=b.id,d.transactionType=b.transactionType,d.fee=a.transactionFees[b.transactionType.code],a.WSLocationTreatmentType.organizationLocationTreatmentTypeFees.push(d)}),angular.forEach(a.transactionTypeList,function(b,c){if(a.transactionFees[b.code]&&a.tempArray.indexOf(b.code)==-1){var d={};d.transactionType=b,d.fee=a.transactionFees[b.code],a.WSLocationTreatmentType.organizationLocationTreatmentTypeFees.push(d)}})):angular.forEach(a.transactionTypeList,function(b,c){if(a.transactionFees[b.code]){var d={};d.transactionType=b,d.fee=a.transactionFees[b.code],a.WSLocationTreatmentType.organizationLocationTreatmentTypeFees.push(d)}}),p.saveLocationTreatmentType(a.WSLocationTreatmentType,a.orgLoc,a.treatmentType,c.type,function(a){h("success",a.successMessage),e.cancel(),r.searchLocationTreatmentType()})},a.getLocationTreatmentTypeDetails=function(b,c){n.isNullOrEmpty(b)||p.getLocationTreatmentTypeDetails(b,function(b){a.WSLocationTreatmentType=b,a.setData()},function(a){h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},a.setData=function(){a.orgLoc.data=a.WSLocationTreatmentType.organizationLocation,a.treatmentType=a.WSLocationTreatmentType.treatmentType,a.treatmentFeeArray=a.WSLocationTreatmentType.organizationLocationTreatmentTypeFees;var b=[];a.tempArray=[],angular.forEach(a.treatmentFeeArray,function(c,d){b[c.transactionType.code]=c.fee,a.tempArray.push(c.transactionType.code)}),a.transactionFees=b},
// on cancel forward to search list
a.cancel=function(){e.cancel()},a.hide=function(){e.hide()},a.setDataToLocationTreeatmentTypeForm=function(a){},
//Init Method
a.init=function(){if(a.disableFees=!1,a.orgLocPermission=s.LOCATION_TREATMENT_ADD,"add"===c.type?(n.isEmpty(c.user)||(a.WSLocationTreatmentType.location={id:c.user.id,value:c.user.value}),a.pageState="add"):"edit"===c.type?(a.pageState="edit",a.getLocationTreatmentTypeDetails(c.locationTreatmentTypeId)):"view"===c.type&&(a.disabled=!0,a.pageState="view",a.disableFees=!0,a.getLocationTreatmentTypeDetails(c.locationTreatmentTypeId)),"add"===a.pageState||"add"===c.type){var b=t.getDefaultOrgLocation();n.isFieldEmpty(b)||(a.orgLoc={data:b.orgLoc})}},a.init()}]),angular.module("paripal.locationTreatmentModule").service("LocationTreatmentListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchLocationTreatment=function(c,d,f,g){var h=new Object;angular.copy(c,h),e.isFieldEmpty(c.orgLoc.data)||(h.organizationLocation=c.orgLoc.data),delete h.orgLoc,e.isFieldEmpty(c.org.data)||(h.organizationId=c.org.data.id),delete h.org,e.isFieldEmpty(d.countryValue)||(h.country=d.countryValue),e.isFieldEmpty(d.stateValue)||(h.state=d.stateValue),e.isFieldEmpty(d.cityValue)||(h.city=d.cityValue),e.isFieldEmpty(d.districtValue)||(h.district=d.districtValue),e.isFieldEmpty(d.postalCode)||(h.postalCode=d.postalCode),a.postData(b.getUrl("SEARCH_LOCATION_TREATMENT_TYPE_LIST"),h,function(a){f(a.data)},function(a){g(a)})}}]),angular.module("paripal.locationTreatmentModule").service("ManageLocationTreatmentService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveLocationTreatmentType=function(c,d,e,f,g,h){var c=c;if(c.organizationLocation=d.data,c.treatmentType=e,"add"===f)a.postData(b.getUrl("ADD_LOCATION_TREATMENT_TYPE"),c,function(a){g(a.data)},function(a){h(a)});else if("edit"===f){var i={};i.locationTreatmentTypeId=c.id,a.putData(b.getParameterizedUrl("UPDATE_LOCATION_TREATMENT_TYPE",i),c,function(a){g(a.data)},function(a){h(a)})}},this.getLocationTreatmentTypeDetails=function(c,d,e){var f={};f.locationTreatmentTypeId=c,a.getData(b.getParameterizedUrl("GET_LOCATION_TREATMENT_TYPE_BY_ID",f),null,function(a){d(a&&a.data?a.data:a)},function(a){e(a)})},this.getLocationTreatmentTypeList=function(c,d){a.getData(b.getUrl("GET_TRANSACTION_TYPE_LIST"),null,function(a){c(a&&a.data?a.data:a)},function(a){d(a)})}}]),angular.module("paripal.manageAmbulance").controller("AmbulanceListCtrl",["$scope","$rootScope","$stateParams","$state","ambulanceListService","httpService","urlService","baseService","utilService","notify","$translate","datatableconfig","$mdDialog","serverSidePagination","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.wsAmbulanceSearchCriteria={},a.wsAmbulanceSearchCriteria.orgLocation={},a.wsAmbulanceSearchCriteria.driverMappedTo={},a.searchAmbulance=function(){a.ambulanceSpinner=!0,a.wsAmbulanceSearchCriteria.pageNumber=a.currentPage,a.wsAmbulanceSearchCriteria.recordsPerPage=a.itemPerPage,e.searchAmbulance(a.wsAmbulanceSearchCriteria,function(b){a.ambulanceSpinner=!1,a.ambulanceList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.ambulanceList=[],a.ambulanceSpinner=!1,a.error=b})},a.clear=function(){a.wsAmbulanceSearchCriteria={},a.wsAmbulanceSearchCriteria.orgLocation={},a.wsAmbulanceSearchCriteria.driverMappedTo={},a.$broadcast("clearPicklistData"),a.searchAmbulance()},a.getUsers=function(b){var c={};return c.userName=b,f.getData(g.getParameterizedUrl("GET_AMBULANCE_DRIVER_MAP_TO",c),null,function(b){return a.driverValues=angular.fromJson(b.data),a.driverValues},function(a){})},a.onUserSelect=function(b){a.wsAmbulanceSearchCriteria.driverMappedTo=b},a.validateValue=function(b){i.isFieldEmpty(b)&&(a.wsAmbulanceSearchCriteria.driverMappedTo={})},a.addAmbulance=function(b,c){m.show({controller:"ManageAmbulanceCtrl",templateUrl:"app/modules/manage-ambulance/views/manageAmbulanceDetails.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:o.dialogBox.clickOutsideToClose,locals:{data:c,parentScope:a}}).then(function(){},function(){})},a.editAmbulance=function(b,c){m.show({controller:"ManageAmbulanceCtrl",templateUrl:"app/modules/manage-ambulance/views/manageAmbulanceDetails.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:o.dialogBox.clickOutsideToClose,locals:{data:c,parentScope:a}}).then(function(){},function(){})},a.mapDriverToVehicle=function(b,c){m.show({controller:"ManageAmbulanceCtrl",templateUrl:"app/modules/manage-ambulance/views/mapDriverToVehicle.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:o.dialogBox.clickOutsideToClose,locals:{data:c,parentScope:a}}).then(function(){},function(){})},a.unMapDriverToVehicle=function(b,c){var d=m.confirm().title(k.instant("UNMAP_DRIVER")).textContent(k.instant("UNMAP_DRIVER_MESSAGE")).ok(k.instant("YES")).cancel(k.instant("NO"));m.show(d).then(function(){e.unMapDriverToVehicle(c,function(b){j("success",k.instant("DRIVER_UNMAP_SUCCESS")),a.searchAmbulance()},function(b){j("error",k.instant("FAILED_TO_UNMAP_DRIVER")),a.searchAmbulance()})},function(){})},a.setAvailabilityStatus=function(b,c){m.show({controller:"ManageAmbulanceCtrl",templateUrl:"app/modules/manage-ambulance/views/setVehicleAvailablityStatus.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:o.dialogBox.clickOutsideToClose,locals:{data:c,parentScope:a}}).then(function(){},function(){})},a.mapOtherStaffToVehicle=function(a){d.go("ambulancestafflist",{ambulanceId:a.id,orgLocId:a.organizationLocation.id})},a.showVehicleUsageHistory=function(a){d.go("ambulancerequestallocation",{ambulanceReqId:a.id})},a.showDriverRequestMappedHistory=function(a){d.go("ambulancerequest",{driverId:a.driver.id})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),a.searchAmbulance()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchAmbulance()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=l.setOptionProperties(p),a.dtColumnDefs=l.setColumnProperties({}),a.init=function(){a.searchAmbulance()},a.init()}]),angular.module("paripal.manageAmbulance").controller("AmbulanceStaffListCtrl",["$scope","ambulanceListService","manageAmbulanceService","httpService","urlService","baseService","utilService","notify","$translate","$stateParams","serverSidePagination","datatableconfig","$mdDialog","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchAmbulanceStaff=function(){a.ambulanceSpinner=!0,b.searchAmbulanceStaff(a.ambulanceId,function(b){a.ambulanceSpinner=!1,a.ambulanceStaffList=b,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.ambulanceStaffList=[],a.ambulanceSpinner=!1,a.error=b})},a.addOtherStaffToAmbulance=function(b){m.show({controller:"MapOtherStaffToVehicle",templateUrl:"app/modules/manage-ambulance/views/mapOtherStaffToVehicle.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:n.dialogBox.clickOutsideToClose,locals:{parentScope:a}}).then(function(){},function(){})},a.unMapStaffForAmbulance=function(b){var d=b.id,e=m.confirm().title(i.instant("UNMAP_STAFF_FOR_AMBULANCE")).textContent(i.instant("UNMAP_STAFF_MESSAGE")).ok(i.instant("YES")).cancel(i.instant("NO"));m.show(e).then(function(){c.unMapStaffForAmbulance(d,function(b){a.searchAmbulanceStaff()},function(a){})},function(){})},a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.searchAmbulanceStaff()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchAmbulanceStaff()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=l.setOptionProperties(o),a.dtColumnDefs=l.setColumnProperties({}),a.init=function(){j.ambulanceId&&(a.ambulanceId=j.ambulanceId),j.orgLocId&&(a.orgLocId=j.orgLocId),a.searchAmbulanceStaff()},a.init()}]),angular.module("paripal.manageAmbulance").controller("ManageAmbulanceCtrl",["$scope","$rootScope","$stateParams","$state","manageAmbulanceService","httpService","urlService","baseService","utilService","notify","$translate","$mdDialog","parentScope","data","featurePrivilegeConstants","storageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(
//$scope.editMode = true;
a.wsAmbulance={},a.cancel=function(){l.cancel()},a.hide=function(){l.hide()},i.isEmpty(n)){var q=h.getDefaultOrgLocation();i.isFieldEmpty(q)||(a.organizationLocation={data:q.orgLoc})}else a.editMode=!0,a.wsAmbulance=angular.copy(n),a.type={},i.isEmpty(n.type)||(a.type.id=n.type.id),a.status={},i.isEmpty(n.status)?a.status.dataValue={}:(a.status.id=n.status.id,a.statusId=n.status.id),i.isEmpty(n.driver)?i.isEmpty(n.driverName)||(a.driverName=n.driverName,a.mobileNumber=n.mobileNumber):a.driverName=n.driver.value,a.organizationLocation={},a.organizationLocation.data=angular.copy(n.organizationLocation);a.manageAmbulanceDetails=function(){a.wsAmbulance.id?a.saveType="edit":a.saveType="add",e.saveAmbulanceDetails(a.wsAmbulance,a.type,a.status,a.organizationLocation,a.saveType,a.driverName,a.mobileNumber,function(b){"add"==a.saveType?j("success",k.instant("AMBULANCE_ADDED_SUCCESS")):j("success",k.instant("AMBULANCE_UPDATED_SUCCESS")),l.hide(),m.searchAmbulance()},function(a){})},a.getUsers=function(b){var c={};return c.userName=b,c.locId=a.organizationLocation.data.id,f.getData(g.getParameterizedUrl("GET_ALL_FREE_AMBULANCE_DRIVER",c),null,function(b){return a.driverValues=angular.fromJson(b.data),a.driverValues},function(a){})},a.isUserSelected=!1,a.onUserSelect=function(b){a.wsAmbulance.driver={id:b.userId},a.driverName=b.driverName,a.mobileNumber=b.mobileNumber,a.isUserSelected=!0},a.validateValue=function(b){i.isFieldEmpty(b)&&(a.isUserSelected=!1,a.driverName="",a.mobileNumber="",a.wsAmbulance.driver={})},a.getPickList=function(b){var c={};c.type=b;var d="GET_PICKLIST_DATA";f.getData(g.getParameterizedUrl(d,c),null,function(b){a.statusList=angular.fromJson(b.data),a.statusBasedOnPermission(a.statusList)},function(a){})},a.getPickList("AMBULANCE_STATUS"),a.selectChanged=function(b){a.wsAmbulance.status=JSON.parse(b)},a.statusBasedOnPermission=function(b){a.dataList=[];var c=p.getLocationFeaturePrivileges();i.isEmpty(c)||(c.hasOwnProperty("ambulance_status_edit_by_admin")&&(a.admin=!0),c.hasOwnProperty("ambulance_status_edit_by_driver")&&(a.driver=!0),c.hasOwnProperty("ambulance_status_edit_by_admin")&&c.hasOwnProperty("ambulance_status_edit_by_driver")&&(a.adminDriver=!0),angular.forEach(b,function(b,c){a.admin||a.adminDriver?"IN_A_TRANSACTION"!==b.code&&a.dataList.push(b):a.driver&&"IN_A_TRANSACTION"!==b.code&&"NOT_IN_USE"!==b.code&&a.dataList.push(b)}))}}]),angular.module("paripal.manageAmbulance").controller("MapOtherStaffToVehicle",["$scope","manageAmbulanceService","httpService","urlService","baseService","utilService","notify","$translate","$mdDialog","parentScope",function(a,b,c,d,e,f,g,h,i,j){a.cancel=function(){i.cancel()},a.hide=function(){i.hide()},a.getUsers=function(b){var e={};return e.userName=b,e.locId=j.orgLocId,c.getData(d.getParameterizedUrl("FIND_USERS_EXCEPT_DRIVER",e),null,function(b){return a.driverValues=angular.fromJson(b.data),a.driverValues},function(a){})},a.onUserSelect=function(b){a.userId=b.id},a.mapStaffToAmbulance=function(){b.mapStaffToAmbulance(a.userId,j.ambulanceId,function(a){i.hide(),j.searchAmbulanceStaff()},function(a){})}}]),angular.module("paripal.manageAmbulance").service("ambulanceListService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.searchAmbulance=function(c,e,f){var g={};d.isEmpty(c.orgLocation)||d.isEmpty(c.orgLocation.data)||(g.orgLocId=angular.copy(c.orgLocation.data.id)),d.isEmpty(c.driverMappedTo)||(g.driverId=angular.copy(c.driverMappedTo.userId)),d.isEmpty(c.make)||(g.make=c.make),d.isEmpty(c.modelYear)||(g.modelYear=c.modelYear),d.isEmpty(c.color)||(g.color=c.color),d.isEmpty(c.regNo)||(g.regNo=c.regNo),d.isEmpty(c.vehicleNo)||(g.vehicleNo=c.vehicleNo),d.isEmpty(c.ambulanceType)||d.isEmpty(c.ambulanceType.dataValue)||(g.type={},g.type.code=angular.copy(c.ambulanceType.dataValue.code)),d.isEmpty(c.ambulanceStatus)||d.isEmpty(c.ambulanceStatus.dataValue)||(g.status={},g.status.code=angular.copy(c.ambulanceStatus.dataValue.code)),d.isFieldEmpty(c.pageNumber)||(g.pageNumber=c.pageNumber),d.isFieldEmpty(c.recordsPerPage)||(g.recordsPerPage=c.recordsPerPage),a.postData(b.getUrl("SEARCH_AMBULANCE_LIST"),g,function(a){a.data&&a.data.data?e(a.data):f(a)},function(a){f(a)})},this.unMapDriverToVehicle=function(c,d,e){var f={};f.ambulanceId=c.id,a.putData(b.getParameterizedUrl("UNMAP_DRIVER_AMBULANCE",f),null,function(a){a.data?d(a.data):e(a)},function(a){e(a)})},this.searchAmbulanceStaff=function(c,d,e){var f={};f.ambulanceId=c,a.getData(b.getParameterizedUrl("FIND_AMBULANCED_MAPPED_USERS",f),null,function(a){a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.manageAmbulance").service("manageAmbulanceService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveAmbulanceDetails=function(c,e,f,g,h,i,j,k,l){d.isEmpty(e.dataValue)||(c.type=e.dataValue),d.isEmpty(f)||d.isEmpty(f.dataValue)||(c.status=f.dataValue),c.driverName=i,c.mobileNumber=j;var m=null;"edit"===h?(m=b.getUrl("UPDATE_AMBULANCE_DETAILS"),a.putData(m,c,function(a){a&&a.data&&k(a.data)},function(a){l(a)})):(c.organizationLocation=g.data,m=b.getUrl("SAVE_AMBULANCE_DETAILS"),a.postData(m,c,function(a){a&&a.data&&k(a.data)},function(a){l(a)}))},this.mapStaffToAmbulance=function(c,d,e,f){var g={};g.ambulanceId=d,g.userId=c,a.postData(b.getParameterizedUrl("MAP_STAFF_TO_AMBULANCE",g),null,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.unMapStaffForAmbulance=function(c,d,e){var f={};f.ambulanceStaffId=c,a.deleteData(b.getParameterizedUrl("UNMAP_STAFF_TO_AMBULANCE",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.followUpSettingsModule").controller("FollowUpExceptionListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","utilService","baseService","followUpExceptionListService","manageFollowUpExceptionService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WsFollowUpExceptionList=[],a.searchCriteria={},a.organizationLocation={},a.transactionTypeId={},a.followupExceptionSpinner=!1,a.moveToPreviousStep=function(){i.goBackToPrevState()},
//Search Follow up Exception
a.searchFollowUpException=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.followupExceptionSpinner=!0,
//var loggedInUser = baseService.getLoggedInUser();
k.searchFollowUpException(a.searchCriteria,c.followupVisitConfigurationId,null,function(b){a.followupExceptionSpinner=!1,a.WsFollowUpExceptionList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.followupExceptionSpinner=!1})},
//Fetch records
a.fetchRecords=function(){a.searchFollowUpException()},
//clear search
a.clear=function(){a.searchCriteria={},a.$broadcast("clearPicklistData")},
//Dispaly edit/view follow up Exception form
a.manageFollowUpException=function(a,b){var e=null,f=null,g=null,h=null;c.validFrom&&(e=c.validFrom),c.validTill&&(f=c.validTill),c.noOfFreeVisits&&(g=c.noOfFreeVisits),c.noOfFreeClarifications&&(h=c.noOfFreeClarifications);var i={type:b,followupVisitConfigurationId:c.followupVisitConfigurationId,followupSpecialConfigurationId:a,organizationLocation:c.organizationLocation,transactionType:c.transactionType,validFrom:e,validTill:f,noOfFreeVisits:g,noOfFreeClarifications:h};d.go("manageFollowUpException",i)},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchFollowUpException()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFollowUpException()};
//datatble config json
var m={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(m),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){i.isEmpty(c.organizationLocation)||i.isEmpty(c.transactionType)?d.go("followUpSettingsList",c):(a.organizationLocation.data={id:c.organizationLocation.id,value:c.organizationLocation.value},a.transactionTypeId={id:c.transactionType.id,value:c.transactionType.value},a.searchFollowUpException())},a.init()}]),angular.module("paripal.followUpSettingsModule").controller("FollowUpSettingsListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","serverSidePagination","baseService","utilService","followUpSettingsListService","manageFollowUpSettingsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WsFollowUpSettingsList=[],a.searchCriteria={},a.orgLocValues={},a.orgLocValues.org={},a.orgLocValues.orgLoc={},a.criteria={},a.criteria.transactionTypeId={},a.followupSettingSpinner=!1,a.status={open:!0},a.moveToPreviousStep=function(){k.goBackToPrevState()},a.transactionType={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"transactionType"}},
//Search Follow up settings
a.searchFollowUpSettings=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.followupSettingSpinner=!0,l.searchFollowUpSettings(a.searchCriteria,a.orgLocValues.org,a.orgLocValues.orgLoc,a.criteria.transactionTypeId,function(b){a.followupSettingSpinner=!1,a.WsFollowUpSettingsList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.followupSettingSpinner=!1})},
// Inactive follow up settings
a.inactiveFollowUpSettings=function(b,c,d){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("FOLLOWUP_INACTIVE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){m.inactiveFollowUpSettings(c,function(b){f("success",g.instant(b.successMessage)),a.searchFollowUpSettings()},function(a){f("error",g.instant("FAILED_TO_UPDATE_RECORD"))})},function(){})},
//Fetch records
a.fetchRecords=function(b){b.$valid&&a.searchFollowUpSettings()},
//clear search
a.clear=function(){a.searchCriteria={},a.orgLocValues.org={},a.orgLocValues.orgLoc={},a.criteria.transactionTypeId={}},
//Dispaly edit/view follow up setting form
a.manageFollowUpSettings=function(a,b){var e=null;c.organization&&(e={id:c.organization.id,value:c.organization.value});var f=null;c.organizationLocation&&(f={id:c.organizationLocation.id,value:c.organizationLocation.value});var g={type:b,organization:e,organizationLocation:f,followupVisitConfigurationId:a};d.go("manageFollowUpSettings",g)},a.followUpExceptionAction=function(a,b,e,f,g,h,i,j){var k={type:f,followupVisitConfigurationId:a,organization:c.organization,organizationLocation:b,transactionType:e,validFrom:g,validTill:j,noOfFreeVisits:h,noOfFreeClarifications:i};d.go("followUpExceptionList",k)},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchFollowUpSettings()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFollowUpSettings()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(n),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){k.isEmpty(c.organization)||k.isEmpty(c.organizationLocation)||(a.orgLocValues.org.data={id:c.organization.id,value:c.organization.value},a.orgLocValues.orgLoc.data={id:c.organizationLocation.id,value:c.organizationLocation.value},a.searchFollowUpSettings())},a.init()}]),angular.module("paripal.followUpSettingsModule").controller("ManageFollowUpExceptionCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","dateconvertor","httpService","baseService","urlService","utilService","applicationExceptionService","manageFollowUpExceptionService","followUpCommonService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.WSFollowupSpecialConfiguration={},a.disabledFormFields=!1,a.isBeforeChecked=!1,a.isInitialDisabled=!1,a.onEditDisabled=!1,a.whetherOrganizationReference=!1,a.onBeforeCheckedMandatory=!0,a.followupSpecialConfigurationId=null,a.version=null,a.organizationLocation={},a.WSFollowupSpecialConfiguration.targetUser={},a.transactionTypeId={},a.WSFollowupSpecialConfiguration.freePeriodTypeId={},a.WSFollowupSpecialConfiguration.noOfFreeVisits=null,a.WSFollowupSpecialConfiguration.freePeriodDuration=null,a.WSFollowupSpecialConfiguration.noOfFreeClarifications=null,a.WSFollowupSpecialConfiguration.validFrom=null,a.WSFollowupSpecialConfiguration.validTill=null,a.WSFollowupSpecialConfiguration.whetherFreePeriodEnabled=!1,a.WSFollowupSpecialConfiguration.whetherOrganizationReference="false",
//$scope.userData = {};
a.organizationList=[],a.dataSet=!1,a.manageFollowupExceptionSpinner=!1,a.freePeriodTypeId={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"freePeriodType"}},a.transactionTypeId={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"transactionType"}},
// Organization combo loaf=ding and validation
a.getOrganizationData=function(b){var c={};return c.keyword=b,j.getData(l.getParameterizedUrl("GET_ACCESSIBLE_ORG_LIST_KEYWORD",c),null,function(b){if(b&&b.data)return a.organizationList=b.data,a.organizationList},function(a){})},a.calculateValidTill=function(){a.WSFollowupSpecialConfiguration.validTill=p.calculateDateOnFeePeriodAndType(a.WSFollowupSpecialConfiguration.freePeriodDuration,a.WSFollowupSpecialConfiguration.freePeriodTypeId,a.WSFollowupSpecialConfiguration.whetherFreePeriodEnabled,a.WSFollowupSpecialConfiguration.validFrom)},a.$watch("organizationList",function(b){m.isEmpty(b)||a.dataSet&&(a.dataSet=!1)},!0),a.changeIsBefore=function(){m.isNullOrEmpty(a.WSFollowupSpecialConfiguration.noOfFreeVisits)||"0"===a.WSFollowupSpecialConfiguration.noOfFreeVisits?(a.WSFollowupSpecialConfiguration.whetherFreePeriodEnabled&&f("warning",g.instant("NO_OF_VISIT_MORE_THAN_ZERO")),a.isBeforeChecked=!1,a.WSFollowupSpecialConfiguration.whetherFreePeriodEnabled=!1,a.WSFollowupSpecialConfiguration.freePeriodDuration=null,a.WSFollowupSpecialConfiguration.freePeriodTypeId={}):!m.isNullOrEmpty(a.WSFollowupSpecialConfiguration.noOfFreeVisits)&&a.WSFollowupSpecialConfiguration.whetherFreePeriodEnabled?(a.isBeforeChecked=!0,a.WSFollowupSpecialConfiguration.freePeriodDuration=null,a.WSFollowupSpecialConfiguration.freePeriodTypeId={}):(a.isBeforeChecked=!1,a.WSFollowupSpecialConfiguration.whetherFreePeriodEnabled=!1,a.WSFollowupSpecialConfiguration.freePeriodDuration=null,a.WSFollowupSpecialConfiguration.freePeriodTypeId={})},a.changeClientType=function(){a.WSFollowupSpecialConfiguration.targetUser={}},
// Add/update follow up EXCEPTION
a.saveFolllowUpException=function(){b.showSpinner=!0,"add"===c.type&&(a.version=null),o.saveFolllowUpException(a.WSFollowupSpecialConfiguration,c.followupVisitConfigurationId,c.followupSpecialConfigurationId,a.version,a.organizationLocation,c.type,function(a){b.showSpinner=!1,f("success",g.instant(a.successMessage)),c=k.getStateParamsFromLocalStarage(c,"followUpExceptionList"),m.isEmpty(c)||d.go("followUpExceptionList",c)},function(a){b.showSpinner=!1,m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},
// Get selected follow up Exception data
a.getFollowUpExceptionDetails=function(b,c){m.isNullOrEmpty(b)||(a.manageFollowupExceptionSpinner=!0,o.getFollowUpExceptionDetails(b,function(b){a.manageFollowupExceptionSpinner=!1,a.setDataToFollowUpExceptionForm(b)}))},
// set selected FollowUp Exception Form data
a.setDataToFollowUpExceptionForm=function(b){a.onEditDisabled=!0;var c="MM/dd/yyyy";m.isEmpty(b)||(m.isNullOrEmpty(b.version)||(a.version=b.version),m.isEmpty(b.organizationLocation)||(a.organizationLocation.data={id:b.organizationLocation.id,value:b.organizationLocation.value}),m.isEmpty(b.transactionTypeId)||(a.transactionTypeId={id:b.transactionTypeId.id,value:b.transactionTypeId.value}),m.isEmpty(b.freePeriodTypeId)||(a.WSFollowupSpecialConfiguration.freePeriodTypeId={id:b.freePeriodTypeId.id,value:b.freePeriodTypeId.value}),m.isEmpty(b.targetUser)||(a.WSFollowupSpecialConfiguration.targetUser={id:b.targetUser.id,value:b.targetUser.value}),m.isNullOrEmpty(b.freePeriodDuration)||(a.WSFollowupSpecialConfiguration.freePeriodDuration=b.freePeriodDuration),m.isNullOrEmpty(b.noOfFreeVisits)||(a.WSFollowupSpecialConfiguration.noOfFreeVisits=b.noOfFreeVisits),m.isNullOrEmpty(b.noOfFreeClarifications)||(a.WSFollowupSpecialConfiguration.noOfFreeClarifications=b.noOfFreeClarifications),m.isNullOrEmpty(b.whetherFreePeriodEnabled)||(b.whetherFreePeriodEnabled&&(a.isBeforeChecked=!0),a.WSFollowupSpecialConfiguration.whetherFreePeriodEnabled=b.whetherFreePeriodEnabled),m.isNullOrEmpty(b.whetherOrganizationReference)||(b.whetherOrganizationReference?(a.WSFollowupSpecialConfiguration.whetherOrganizationReference="true",a.whetherOrganizationReference=!0):(a.WSFollowupSpecialConfiguration.whetherOrganizationReference="false",a.whetherOrganizationReference=!1)),m.isNullOrEmpty(b.validFrom)||(a.WSFollowupSpecialConfiguration.validFrom=h("timestampToDate")(b.validFrom,c)),m.isNullOrEmpty(b.validTill)||(a.WSFollowupSpecialConfiguration.validTill=h("timestampToDate")(b.validTill,c)))},
// on cancel forward to search list
a.cancel=function(){m.goBackToPrevState()},
//Init Method
a.init=function(){m.isEmpty(c.organizationLocation)||m.isEmpty(c.transactionType)?d.go("followUpSettingsList",c):(a.organizationLocation.data={id:c.organizationLocation.id,value:c.organizationLocation.value},a.transactionTypeId={id:c.transactionType.id,value:c.transactionType.value},a.isInitialDisabled=!0,"add"===c.type?(c.noOfFreeClarifications&&(a.WSFollowupSpecialConfiguration.noOfFreeClarifications=c.noOfFreeClarifications),c.noOfFreeVisits&&(a.WSFollowupSpecialConfiguration.noOfFreeVisits=c.noOfFreeVisits),c.validFrom&&(a.WSFollowupSpecialConfiguration.validFrom=c.validFrom),c.validTill&&(a.WSFollowupSpecialConfiguration.validTill=c.validTill),a.pageState="add"):"edit"===c.type?(a.pageState="edit",a.getFollowUpExceptionDetails(c.followupSpecialConfigurationId,c.type)):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0,a.getFollowUpExceptionDetails(c.followupSpecialConfigurationId,c.type)))},a.init()}]),angular.module("paripal.followUpSettingsModule").controller("ManageFollowUpSettingsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","dateconvertor","httpService","baseService","urlService","utilService","applicationExceptionService","manageFollowUpSettingsService","followUpCommonService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";c=k.getStateParamsFromLocalStarage(c,"manageFollowUpSettings"),m.isEmpty(c)&&d.go("home.view"),a.WSFollowupVisitConfiguration={},a.disabledFormFields=!1,a.isBeforeChecked=!1,a.isEditDisabled=!1,a.onBeforeCheckedMandatory=!0,a.followupVisitConfigurationId=null,a.WSFollowupVisitConfiguration.version=null,a.WSFollowupVisitConfiguration.organizationLocation={},a.WSFollowupVisitConfiguration.transactionTypeId={},a.WSFollowupVisitConfiguration.noOfFreeVisits=null,a.WSFollowupVisitConfiguration.freePeriodDuration=null,a.WSFollowupVisitConfiguration.noOfFreeClarifications=null,a.WSFollowupVisitConfiguration.freePeriodTypeId={},a.WSFollowupVisitConfiguration.validFrom=null,a.WSFollowupVisitConfiguration.validTill=null,a.WSFollowupVisitConfiguration.whetherFreePeriodEnabled=!1,a.WSFollowupVisitConfiguration.whetherNewUHIDMandatory=!1,a.manageFollowupSettingSpinner=!1,a.status={open:!0},a.freePeriodTypeId={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"freePeriodType"}},a.transactionTypeId={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"transactionType"}},/*$scope.calculateValidTill = function () {
    $scope.WSFollowupVisitConfiguration.validTill = followUpCommonService.calculateDateOnFeePeriodAndType($scope.WSFollowupVisitConfiguration.freePeriodDuration, $scope.WSFollowupVisitConfiguration.freePeriodTypeId, $scope.WSFollowupVisitConfiguration.whetherFreePeriodEnabled, $scope.WSFollowupVisitConfiguration.validFrom);
};*/
a.changeIsBefore=function(){m.isNullOrEmpty(a.WSFollowupVisitConfiguration.noOfFreeVisits)||"0"===a.WSFollowupVisitConfiguration.noOfFreeVisits?(a.WSFollowupVisitConfiguration.whetherFreePeriodEnabled&&f("warning",g.instant("NO_OF_VISIT_MORE_THAN_ZERO")),a.isBeforeChecked=!1,a.WSFollowupVisitConfiguration.whetherFreePeriodEnabled=!1,a.WSFollowupVisitConfiguration.freePeriodDuration=null,a.WSFollowupVisitConfiguration.freePeriodTypeId=null):!m.isNullOrEmpty(a.WSFollowupVisitConfiguration.noOfFreeVisits)&&a.WSFollowupVisitConfiguration.whetherFreePeriodEnabled?(a.isBeforeChecked=!0,a.WSFollowupVisitConfiguration.freePeriodDuration=null,a.WSFollowupVisitConfiguration.freePeriodTypeId=null):(a.isBeforeChecked=!1,a.WSFollowupVisitConfiguration.whetherFreePeriodEnabled=!1,a.WSFollowupVisitConfiguration.freePeriodDuration=null,a.WSFollowupVisitConfiguration.freePeriodTypeId=null),a.calculateValidTill()},
// Add/update follow up setting
a.saveFolllowUpSetting=function(){b.showSpinner=!0,"add"===c.type&&(a.WSFollowupVisitConfiguration.version=null),o.saveFolllowUpSetting(a.WSFollowupVisitConfiguration,c.type,function(a){b.showSpinner=!1,f("success",g.instant(a.successMessage)),c=k.getStateParamsFromLocalStarage(c,"followUpSettingsList"),m.isEmpty(c)?d.go("home.view"):d.go("followUpSettingsList",c)},function(a){b.showSpinner=!1,m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},
// Get selected follow up settings data
a.getFollowUpSettingDetails=function(b,c){m.isNullOrEmpty(b)||(a.manageFollowupSettingSpinner=!0,o.getFollowUpSettingDetails(b,function(b){a.manageFollowupSettingSpinner=!1,a.setDataToFollowUpSettingForm(b)}))},
// set selected FollowUp Setting Form data
a.setDataToFollowUpSettingForm=function(b){var c="MM/dd/yyyy";m.isEmpty(b)||(m.isNullOrEmpty(b.id)||(a.WSFollowupVisitConfiguration.id=b.id),m.isNullOrEmpty(b.version)||(a.WSFollowupVisitConfiguration.version=b.version),m.isEmpty(b.organizationLocation)||(a.WSFollowupVisitConfiguration.organizationLocation.data={id:b.organizationLocation.id,value:b.organizationLocation.value}),m.isEmpty(b.freePeriodTypeId)||(a.WSFollowupVisitConfiguration.freePeriodTypeId={id:b.freePeriodTypeId.id,value:b.freePeriodTypeId.value}),m.isEmpty(b.transactionTypeId)||(a.WSFollowupVisitConfiguration.transactionTypeId={id:b.transactionTypeId.id,value:b.transactionTypeId.value}),m.isNullOrEmpty(b.configurationTypeCode)||(a.WSFollowupVisitConfiguration.configurationTypeCode=b.configurationTypeCode),m.isNullOrEmpty(b.freePeriodDuration)||(a.WSFollowupVisitConfiguration.freePeriodDuration=b.freePeriodDuration),m.isNullOrEmpty(b.noOfFreeVisits)||(a.WSFollowupVisitConfiguration.noOfFreeVisits=b.noOfFreeVisits),m.isNullOrEmpty(b.noOfFreeClarifications)||(a.WSFollowupVisitConfiguration.noOfFreeClarifications=b.noOfFreeClarifications),m.isNullOrEmpty(b.whetherFreePeriodEnabled)||(b.whetherFreePeriodEnabled&&(a.isBeforeChecked=!0),a.WSFollowupVisitConfiguration.whetherFreePeriodEnabled=b.whetherFreePeriodEnabled),m.isNullOrEmpty(b.whetherNewUHIDMandatory)||(a.WSFollowupVisitConfiguration.whetherNewUHIDMandatory=b.whetherNewUHIDMandatory),m.isNullOrEmpty(b.validFrom)||(a.WSFollowupVisitConfiguration.validFrom=h("timestampToDate")(b.validFrom,c)),m.isNullOrEmpty(b.validTill)||(a.WSFollowupVisitConfiguration.validTill=h("timestampToDate")(b.validTill,c)))},
// on cancel forward to search list
a.cancel=function(){/*$stateParams = baseService.getStateParamsFromLocalStarage($stateParams, "followUpSettingsList");
            if (!utilService.isEmpty($stateParams)) {
                $state.go("followUpSettingsList", $stateParams);
            } else {
                $state.go("home.view");
            }*/
m.goBackToPrevState()},
//Init Method
a.init=function(){c.type?"add"===c.type?(a.pageState="add",a.isEditDisabled=!1):"edit"===c.type&&c.followupVisitConfigurationId?(a.pageState="edit",a.isEditDisabled=!0,a.getFollowUpSettingDetails(c.followupVisitConfigurationId,c.type)):"view"===c.type&&c.followupVisitConfigurationId?(a.pageState="view",a.disabledFormFields=!0,a.getFollowUpSettingDetails(c.followupVisitConfigurationId,c.type)):d.go("followUpSettingsList",c):d.go("followUpSettingsList",c)},a.init()}]),angular.module("paripal.followUpSettingsModule").service("followUpExceptionListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchFollowUpException=function(c,d,f,g,h){e.isNullOrEmpty(d)||(c.followupSpecialConfigurationId=d),e.isNullOrEmpty(f)||(c.targetUserId=f),a.postData(b.getUrl("SEARCH_FOLLOW_UP_EXCEPTION_LIST"),c,function(a){g(a.data)},function(a){h(a)})}}]),angular.module("paripal.followUpSettingsModule").service("followUpSettingsListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchFollowUpSettings=function(c,d,f,g,h,i){e.isEmpty(d.data)||(c.organizationId=d.data.id),e.isEmpty(f.data)||(c.organizationLocationId=f.data.id),e.isEmpty(g)||(c.transactionTypeId=g.id),a.postData(b.getUrl("SEARCH_FOLLOW_UP_SETTINGS_LIST"),c,function(a){h(a.data)},function(a){i(a)})}}]),angular.module("paripal.followUpSettingsModule").service("manageFollowUpExceptionService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveFolllowUpException=function(e,f,g,h,i,j,k,l){var m="";e.version=h,d.isNullOrEmpty(f)||(e.followUpVistConfig={},e.followUpVistConfig.id=f),d.isNullOrEmpty(g)||(e.id=g),d.isEmpty(e.targetUser)&&delete e.targetUser,d.isEmpty(e.freePeriodTypeId)&&(e.freePeriodTypeId=null),d.isNullOrEmpty(e.freePeriodDuration)&&(e.freePeriodDuration=null),d.isNullOrEmpty(e.noOfFreeVisits)&&(e.noOfFreeVisits="0"),d.isNullOrEmpty(e.noOfFreeClarifications)&&(e.noOfFreeClarifications=null),d.isNullOrEmpty(e.whetherFreePeriodEnabled)&&(e.whetherFreePeriodEnabled=!1),d.isNullOrEmpty(e.whetherOrganizationReference)&&(e.whetherOrganizationReference=!1),d.isNullOrEmpty(e.validFrom)?e.validFrom=null:e.validFrom=c.convertToServerDate(e.validFrom),d.isNullOrEmpty(e.validTill)?e.validTill=null:e.validTill=c.convertToServerDate(e.validTill),m="add"===j?"ADD_FOLLOW_UP_EXCEPTION":"UPDATE_FOLLOW_UP_EXCEPTION",a.postData(b.getUrl(m),e,function(a){a&&a.data&&k(a.data)},function(a){l(a)})},this.getFollowUpExceptionDetails=function(c,d){var e={};e.followupSpecialConfigurationId=c,a.getData(b.getParameterizedUrl("GET_FOLLOW_UP_EXCEPTION_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}}]),angular.module("paripal.followUpSettingsModule").service("manageFollowUpSettingsService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveFolllowUpSetting=function(e,f,g,h){var i="",j=angular.copy(e);d.isEmpty(e.organizationLocation)||d.isEmpty(e.organizationLocation.data)||(j.organizationLocation=e.organizationLocation.data),/*if (utilService.isEmpty(transactionTypeId)) {
                followupVisitConfiguration.transactionTypeId = null;
            }
            if (utilService.isEmpty(freePeriodTypeId)) {
                followupVisitConfiguration.freePeriodTypeId = null;
            }*/
d.isNullOrEmpty(e.configurationTypeCode)&&(j.configurationTypeCode=null),d.isNullOrEmpty(e.freePeriodDuration)&&(j.freePeriodDuration=null),d.isNullOrEmpty(e.noOfFreeVisits)&&(j.noOfFreeVisits="0"),d.isNullOrEmpty(e.noOfFreeClarifications)&&(j.noOfFreeClarifications=null),d.isNullOrEmpty(e.whetherFreePeriodEnabled)&&(j.whetherFreePeriodEnabled=!1),d.isNullOrEmpty(e.whetherNewUHIDMandatory)&&(j.whetherNewUHIDMandatory=!1),d.isNullOrEmpty(e.validFrom)?j.validFrom=null:j.validFrom=c.convertToServerDate(e.validFrom),d.isNullOrEmpty(e.validTill)?j.validTill=null:j.validTill=c.convertToServerDate(e.validTill),i="add"===f?"ADD_FOLLOW_UP_SETTING":"UPDATE_FOLLOW_UP_SETTING",a.postData(b.getUrl(i),j,function(a){a&&a.data&&g(a.data)},function(a){h(a)})},this.inactiveFollowUpSettings=function(c,d,e){var f={};f.followupVisitConfigurationId=c,a.putData(b.getParameterizedUrl("INACTIVE_FOLLOW_UP_SETTINGS",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getFollowUpSettingDetails=function(c,d){var e={};e.followupVisitConfigurationId=c,a.getData(b.getParameterizedUrl("GET_FOLLOW_UP_SETTING_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})}}]).service("followUpCommonService",["utilService",function(a){"use strict";function b(a,b){var c=new Date(a);return c.setDate(c.getDate()+b),c}this.calculateDateOnFeePeriodAndType=function(c,d,e,f){if(a.isFieldEmpty(c)||a.isFieldEmpty(d)||!e||a.isFieldEmpty(f)){if(!e)return null}else switch(d.code){case"DAYS":return b(f,1*parseInt(c));case"WEEK":return b(f,7*parseInt(c));case"FORTNIGHT":return b(f,14*parseInt(c));case"MONTH":return b(f,30*parseInt(c))}}}]),angular.module("paripal.manageOrganisationLocationClient").controller("AddOrgLocClientCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","addOrgLocClientService","orgLocClientListService","notify","$translate","utilService","otherDocumentService","commonConstants","urlService","httpService","fileOperations","dateconvertor","$mdDialog","featurePrivilegeConstants","storageService","baseService","registerService","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";if(a.selectedLanguage={code:null},a.languages=[],a.featurePrivilegeConstants=r,a.WSClient={},a.WSClientDate={},a.WSClientExtraData={},a.addressData={},a.organization={},a.orgLocation={},a.user={userData:{}},a.currencyValue={},a.referredByData={},a.WSSetDataObj={},a.WSClient.whetherActive=!0,a.userSelectedDisabled=!1,a.editDisabled=!1,a.trackCustomerBilling=!0,a.orgSelectedDisabled=!1,a.clientDisabled=!1,a.validFromDisabled=!1,a.addOrgLocClientSpinner=!1,a.disableUser=!1,a.documentUploadFile=null,a.guardianData={},a.minDateValidTill=p.convertToServerDate(new Date),localStorage.clientListCellNo){var w=localStorage.getItem("clientListCellNo");c.user={cellNo:w},localStorage.removeItem("clientListCellNo")}a.saveDocumentDetails=function(){if(b.showSpinner=!0,a.document=new Object,a.documentUploadFile){a.document.fileName=a.documentUploadFile.name,a.document.fileSize=a.documentUploadFile.size,a.document.organizationLocationId=a.orgLocation.data.id,a.document.documentType={subType:l.documentSubTypes.clientScanId};var d="",e="";"edit"===c.type?(d=m.getUrl("UPDATE_DOCUMENT_DETAILS"),e=!0,a.document.id=a.WSClient.documentId):(d=m.getUrl("SAVE_DOCUMENT_DETAILS"),e=!1),k.saveDocumentDetails(a.document,d,e,function(b){a.documentUploadFile&&a.uploadFile(a.documentUploadFile,b)},function(a){b.showSpinner=!1})}else a.saveOrgLocClient()},a.uploadFile=function(c,d){var e=new Object;e.file=c,e.orgLocId=a.document.organizationLocationId,e.docType=l.documentTypes.client,e.docSubType=l.documentSubTypes.clientScanId,j.isNullOrEmpty(d.response)||(e.resourceId=d.response),o.uploadFile(e,function(b){var c=d.response;a.saveOrgLocClient(c)},function(a){b.showSpinner=!1,h("Error",i.instant("ERROR_WHILE_UPLOADING"))})},a.saveOrgLocClient=function(e){e&&(a.WSClient.documentId=e,a.WSClient.patientIdScanPath=a.document.fileName),"COMPANY"===a.WSClient.clientType&&(a.guardianData.guardian=null,a.guardianData.guardianId=null,a.guardianData.guardianName=null),
//$scope.guardianData.birthDate = dateconvertor.convertToServerDate($scope.birthDate);
//$scope.guardianData.hasGuardian = $scope.guardianCheck;
//$scope.guardian = $scope.WSUserServiceOrganization;
j.isFieldEmpty(a.guardianData.guardian)||(a.guardianData.guardianId=a.guardianData.guardian.id,a.guardianData.guardianName=a.guardianData.guardian.value),a.WSClientExtraData&&a.WSClientExtraData.genderCode&&a.genderList&&angular.forEach(a.genderList,function(b,c){b.code==a.WSClientExtraData.genderCode&&(a.WSClientExtraData.gender=b)}),b.showSpinner=!0,f.saveOrgLocClient(a.WSClient,a.WSClientDate,a.organization,a.orgLocation,a.user.userData,a.currencyValue,a.referredByData,a.WSSetDataObj,a.addressData,a.WSClientExtraData,c.type,a.guardianData,function(e){b.showSpinner=!1,a.expressionSaveResponse=e,"edit"===c.type&&j.isNullOrEmpty(e.successMessage)?h("success",i.instant(a.responseMessageLabel.userUpdated)):h("success",i.instant(e.successMessage)),c.urlState&&c.appointmentType?"RECORDWALKIN"==c.appointmentType?d.go(c.urlState,{clientId:e,appointmentId:c.appointmentId,type:c.appointmentType,urlState:c.urlState,entityType:c.entityType,entityName:c.entityName,eventType:c.eventType,eventName:c.eventName}):d.go(c.urlState,{clientId:e,appointmentId:c.appointmentId,type:c.appointmentType,urlState:c.urlState}):(q.hide(!0),d.go("orglocclientlist",{type:""}))},function(c){b.showSpinner=!1,a.expressionSaveResponse=c})},a.close=function(){q.hide(),a.emptyUserDetails(),c.user={}},a.cancel=function(){j.goBackToPrevState()},a.viewCompleteForm=function(){if(q.hide(),j.isNullOrEmpty(a.user)||j.isNullOrEmpty(a.user.userData)){var b={};b.uName=a.user.userData,j.isNullOrEmpty(a.WSClientExtraData)||(j.isNullOrEmpty(a.WSClientExtraData.cellNo)||(b.cellNo=a.WSClientExtraData.cellNo),j.isNullOrEmpty(a.WSClientExtraData.genderCode)||(b.genderCode=a.WSClientExtraData.genderCode),j.isNullOrEmpty(a.WSClientExtraData.age)||(b.age=a.WSClientExtraData.age),j.isNullOrEmpty(a.WSClientExtraData.month)||(b.month=a.WSClientExtraData.month),j.isNullOrEmpty(a.WSClientExtraData.email)||(b.email=a.WSClientExtraData.email),j.isNullOrEmpty(a.WSClientExtraData.validFrom)||(b.validFrom=a.WSClientExtraData.validFrom)),j.isNullOrEmpty(a.guardianData)||(b.dob=a.guardianData)}else if(j.isNullOrEmpty(a.user.userData.data)){var b={};b.uName=a.user.userData,j.isNullOrEmpty(a.WSClientExtraData)||(j.isNullOrEmpty(a.WSClientExtraData.cellNo)||(b.cellNo=a.WSClientExtraData.cellNo),j.isNullOrEmpty(a.WSClientExtraData.genderCode)||(b.genderCode=a.WSClientExtraData.genderCode),j.isNullOrEmpty(a.WSClientExtraData.age)||(b.age=a.WSClientExtraData.age),j.isNullOrEmpty(a.WSClientExtraData.month)||(b.month=a.WSClientExtraData.month),j.isNullOrEmpty(a.WSClientExtraData.email)||(b.email=a.WSClientExtraData.email),j.isNullOrEmpty(a.WSClientExtraData.validFrom)||(b.validFrom=a.WSClientExtraData.validFrom)),j.isNullOrEmpty(a.guardianData)||(b.dob=a.guardianData)}else var b=a.user.userData;d.go("addorglocclient",{type:"",user:b})},a.$watch("user.userData.data",function(b){a.user&&a.user.userData&&!j.isEmpty(a.user.userData.data)?(j.isFieldEmpty(a.user.userData.data.id)||a.userDetailsInfo(a.user.userData.data.id),a.WSClientExtraData.cellNo=parseFloat(b.cell1),a.WSClientExtraData.email=b.email1,b.genderId&&b.genderId.code&&(a.WSClientExtraData.genderCode=b.genderId.code),a.guardianData.birthDate=p.convertToViewDate(b.birthDate),a.guardianCheck=b.hasGuardian,b.guardianId&&null!=b.guardianId&&b.data.guardianName&&null!=b.data.guardianName&&(a.WSUserServiceOrganization={id:b.guardianId,value:b.data.guardianName})):(delete a.guardianData.birthDate,delete a.WSClientExtraData.email,delete a.WSClientExtraData.age,delete a.WSClientExtraData.month,delete a.WSClientExtraData.genderCode,a.isLocUser=!1,a.user.userData&&a.user.userData.nameValue&&(a.guardianData.guardianCheck=!0,a.userList&&a.userList.length>0&&(a.guardianData.guardian={id:a.userList[0].userId,value:a.userList[0].displayName})),
//delete $scope.user.userData.data;
a.disableUser=!1,a.userSelectedDisabled=!1)},!0),a.clientTypeChanged=function(){b.$broadcast("clearUserData"),a.emptyUserDetails(),a.addressType="COMPANY"==a.WSClient.clientType?"WORK":"HOME",a.filterAddressTypesMethod()},a.emptyUserDetails=function(){a.addressData={},a.addressData.addressTypeId=-1,a.WSClientExtraData.cellNo=null,a.WSClientExtraData.email=null,a.WSClientExtraData.age=null,a.WSClientExtraData.month=null,a.userSelectedDisabled=!1,a.disableUser=!1,a.guardianData={},a.guardianCheck=!1,a.WSUserServiceOrganization={}},a.$watch("referredByData.data",function(b){b!==-1?j.isEmpty(a.referredByData.data)||(a.WSClient.referedById=a.referredByData.data.id,a.WSClientExtraData.referedByIdValue=a.referredByData.data.userCode):(a.WSClient.referedById="",a.WSClientExtraData.referedByIdValue="")},!0),a.$watch("orgLocation.data",function(c){j.isEmpty(c)?(a.addressData={},a.addressData.addressTypeId=-1,a.WSClientExtraData.cellNo=null,a.WSClientExtraData.email=null,a.guardianData={},a.userSelectedDisabled=!1,b.$broadcast("clearUserData"),a.disableUser=!1,a.orgSelectedDisabled=!0):(a.organizationLocationId=c.id,f.getOrgLocationByOrgLocId(a.organizationLocationId,function(b){a.WSOrgLocation=b,a.trackCustomerBilling=a.WSOrgLocation.whetherTrackCustomerBilling,a.orgSelectedDisabled=!1},function(a){}))},!0),a.userDetailsInfo=function(b){f.userDetailsInfo(b,function(b){a.addressData=b.userAddress,a.WSClientExtraData.cellNo=b.cell1,a.WSClientExtraData.email=b.email1,a.guardianData.birthDate=p.convertToViewDate(b.birthDate),a.guardianData.guardianCheck=b.hasGuardian,a.guardianData.guardian={id:b.guardianId,value:b.guardianName},b.genderId&&(a.WSClientExtraData.genderCode=b.genderId.code),a.WSClientExtraData.age=b.age,a.WSClientExtraData.month=b.month,(b.guardianId||b.guardianName)&&(a.WSUserServiceOrganization={id:b.guardianId,value:b.guardianName}),
//$scope.disableUser = true;
j.isNullOrEmpty(a.addressData.id)||"edit"==a.pageState||"add"==a.pageState?a.userSelectedDisabled=!1:(a.userSelectedDisabled=!0,a.addressData.selectedDisable=!0)},function(a){})},a.calculateDateOfBirth=function(){
//changes done to calculate birthDate by age and month
var b,c;b=a.WSClientExtraData.age?(new Date).getFullYear()-a.WSClientExtraData.age:(new Date).getFullYear(),c=a.WSClientExtraData.month?(new Date).getMonth()-a.WSClientExtraData.month:(new Date).getMonth(),a.guardianData.birthDate=new Date(b,c,(new Date).getDate()),a.dobChanged(a.WSClientExtraData.age)},a.$watch("guardianData.birthDate",function(b){if(b){var c=Date.now()-new Date(b).getTime(),d=new Date(c);// miliseconds from epoch
a.WSClientExtraData.age=Math.abs(d.getUTCFullYear()-1970);var e=(new Date).valueOf()-new Date(b).valueOf(),f=Math.floor(e%31536e6/864e5),g=Math.floor(f/30);a.WSClientExtraData.month=g,a.WSClientExtraData.age<18?(a.guardianData.guardianCheck=!0,a.userList&&(a.guardianData.guardian={id:a.userList[0].userId,value:a.userList[0].displayName})):(a.guardianData.guardianCheck=!1,a.guardianData.guardian={})}}),a.setDirectiveFn=function(b){a.dobChanged=b},/* $scope.$watch('WSSetDataObj.userByUserId.systemLanguage', function (newVal) {
                if (newVal !== -1) {
                    $scope.WSClientExtraData.systemLanguage = newVal;
                }
            }, true); */
a.setData=function(){a.WSSetDataObj.validFrom&&(a.WSClientDate.validFrom=a.WSSetDataObj.validFrom),a.WSSetDataObj.validTill&&(a.WSClientDate.validTill=a.WSSetDataObj.validTill),j.isEmpty(a.WSSetDataObj.clientType)||(a.WSClient.clientType=a.WSSetDataObj.clientType),j.isEmpty(a.WSSetDataObj.userByUserId)||(a.WSSetDataObj.userByUserId.id?(a.WSClientExtraData.systemLanguage=a.WSSetDataObj.userByUserId.systemLanguage,a.selectedLanguage={code:a.WSClientExtraData.systemLanguage.code},a.WSClientExtraData.cellNo=a.WSSetDataObj.userByUserId.cell1,a.WSClientExtraData.email=a.WSSetDataObj.userByUserId.email1,a.userDetailsInfo(a.WSSetDataObj.userByUserId.id),a.user.userData=a.WSSetDataObj.userByUserId,a.user.userData.value=a.user.userData.displayName):(a.user.userData=a.WSSetDataObj.userByUserId,a.user.userData.cell1&&(a.WSClientExtraData.cellNo=parseFloat(a.user.userData.cell1)))),j.isEmpty(a.WSSetDataObj.currency)||(a.currencyValue=a.WSSetDataObj.currency),j.isEmpty(a.WSSetDataObj.organizationLocation)||(a.orgLocation.data={id:a.WSSetDataObj.organizationLocation.id,value:a.WSSetDataObj.organizationLocation.displayName},j.isEmpty(a.WSSetDataObj.organizationLocation.organization)||(a.organization.data=a.WSSetDataObj.organizationLocation.organization)),j.isNullOrEmpty(a.WSSetDataObj.referedById)||(a.WSClient.referedById=a.WSSetDataObj.referedById,a.WSClientExtraData.referedByIdValue=a.WSSetDataObj.referedById,a.WSClient.referedById&&f.userInfo(a.WSSetDataObj.referedById,function(b){a.referredByData=b,a.WSClientExtraData.referedByIdValue=b.userCode,j.isNullOrEmpty(a.WSSetDataObj.referedBy)?a.referredByData.value=b.firstName:a.referredByData.value=a.WSSetDataObj.referedBy},function(a){})),j.isNullOrEmpty(a.WSSetDataObj.balanceDue)||(a.WSClient.balanceDue=a.WSSetDataObj.balanceDue),j.isNullOrEmpty(a.WSSetDataObj.patientIdScanPath)||(a.uploadFileName=a.WSSetDataObj.patientIdScanPath,a.WSClient.patientIdScanPath=a.WSSetDataObj.patientIdScanPath),j.isNullOrEmpty(a.WSSetDataObj.patientId)||(a.WSClient.patientId=a.WSSetDataObj.patientId),j.isNullOrEmpty(a.WSSetDataObj.documentId)||(a.WSClient.documentId=a.WSSetDataObj.documentId)},a.downloadClientScanFile=function(){var b=new Object;b.fileName=a.WSClient.patientIdScanPath,b.resourceId=a.WSClient.documentId,b.docType=l.documentTypes.client,b.docSubType=l.documentSubTypes.clientScanId,b.orgLocId=a.orgLocation.data.id,o.downloadFile(b,function(a){},function(a){})},a.loadLanguages=function(){u.loadListOfLanguages(function(b){a.languages=b},function(a){})},a.init=function(){if(v(function(){null!=a.selectedLanguage.code&&"en"!=a.selectedLanguage.code?console.log():a.selectedLanguage={code:"en"}},0),j.isNullOrEmpty(c.user)||(j.isNullOrEmpty(c.user.data)?(c.user.uName&&(a.user.userData=c.user.uName),j.isNullOrEmpty(c.user.cellNo)||(a.WSClientExtraData.cellNo=c.user.cellNo),j.isNullOrEmpty(c.user.genderCode)||(a.WSClientExtraData.genderCode=c.user.genderCode),j.isNullOrEmpty(c.user.age)||(a.WSClientExtraData.age=c.user.age),j.isNullOrEmpty(c.user.month)||(a.WSClientExtraData.month=c.user.month),j.isNullOrEmpty(c.user.email)||(a.WSClientExtraData.email=c.user.email),j.isNullOrEmpty(c.user.validFrom)||(a.WSClientExtraData.validFrom=c.user.validFrom),j.isNullOrEmpty(c.user.dob)||(j.isNullOrEmpty(c.user.dob.birthDate)||(a.guardianData.birthDate=c.user.dob.birthDate),j.isNullOrEmpty(c.user.dob.guardianCheck)||(a.guardianData.guardianCheck=c.user.dob.guardianCheck),j.isNullOrEmpty(c.user.dob.guardian)||(a.guardianData.guardian=c.user.dob.guardian))):a.user.userData=c.user),j.isNullOrEmpty(c.type)?a.stateOfPage="add":a.stateOfPage=c.type,a.pageState="add",c.user&&c.user.cellNo&&f.UserInfoDTO(c.user.cellNo,function(b){b&&b.length>0&&(a.userList=b.sort(function(a,b){return b.age-a.age}),a.guardianData.guardian={id:a.userList[0].id,value:a.userList[0].displayName})},function(a){}),localStorage.getItem("defaultOrg")&&(a.organization={},a.organization.data=angular.fromJson(localStorage.getItem("defaultOrg"))),localStorage.getItem("defaultOrgLoc")){var b=s.getLocationFeaturePrivileges();b&&b.organization_client_add&&b.organization_client_add.indexOf(angular.fromJson(localStorage.getItem("defaultOrgLoc")).id)!=-1&&(a.orgLocation={},a.orgLocation.data=angular.fromJson(localStorage.getItem("defaultOrgLoc")))}a.WSClientDate.validFrom=new Date,a.addOrgLocClientSpinner=!0,"edit"===c.type?(a.pageState="edit",a.editDisabled=!0,a.validFromDisabled=!0):"view"===c.type?(a.pageState="view",a.clientDisabled=!0,a.validFromDisabled=!0):(a.addOrgLocClientSpinner=!1,a.WSClient.clientType="INDIVIDUAL"),f.getGenderList(function(b){a.genderList=b},function(a){}),c.data?(a.WSSetDataObj=c.data,a.setData(),a.addOrgLocClientSpinner=!1):c.clientId&&g.getOrgLocClientById(c.clientId,function(b){a.addOrgLocClientSpinner=!1,a.WSSetDataObj=b,a.setData()},function(b){a.addOrgLocClientSpinner=!1,a.error=b}),a.addressType="COMPANY"==a.WSClient.clientType?"WORK":"HOME";/* locationCategory label changes start */
var d=t.getLocationCategory();a.fieldLabel={},a.responseMessageLabel={},j.isFieldEmpty(d)?((a.pageState="add")?a.titleLabelAdd=i.instant("ADD_ORGANIZATION_CLIENT"):(a.pageState="edit")?a.titleLabelEdit=i.instant("EDIT_ORGANIZATION_CLIENT"):(a.pageState="view")&&(a.titleLabelView=i.instant("VIEW_ORGANIZATION_CLIENT")),a.fieldLabel.userName=i.instant("CLIENT_NAME"),a.fieldLabel.userID=i.instant("CLIENT_ID"),a.fieldLabel.userType=i.instant("CLIENT_TYPE"),a.fieldLabel.userBasicInfo=i.instant("CLIENT_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=i.instant("CLIENT_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=i.instant("CLIENT_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=i.instant("CLIENT_UPDATE_SUCCESS")):"EDUCATIONAL_INSTITUTION"==d.code?((a.pageState="add")?a.titleLabelAdd=i.instant("ADD_ORGANIZATION_STUDENT"):(a.pageState="edit")?a.titleLabelEdit=i.instant("EDIT_ORGANIZATION_STUDENT"):(a.pageState="view")&&(a.titleLabelView=i.instant("VIEW_ORGANIZATION_STUDENT")),a.fieldLabel.userName=i.instant("STUDENT_NAME"),a.fieldLabel.userID=i.instant("STUDENT_ID"),a.fieldLabel.userType=i.instant("STUDENT_TYPE"),a.fieldLabel.userBasicInfo=i.instant("STUDENT_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=i.instant("STUDENT_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=i.instant("STUDENT_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=i.instant("STUDENT_UPDATE_SUCCESS")):"CORPORATE"==d.code?((a.pageState="add")?a.titleLabelAdd=i.instant("ADD_ORGANIZATION_EMPLOYEE"):(a.pageState="edit")?a.titleLabelEdit=i.instant("EDIT_ORGANIZATION_EMPLOYEE"):(a.pageState="view")&&(a.titleLabelView=i.instant("VIEW_ORGANIZATION_EMPLOYEE")),a.fieldLabel.userName=i.instant("EMPLOYEE_NAME"),a.fieldLabel.userID=i.instant("EMPLOYEE_ID"),a.fieldLabel.userType=i.instant("EMPLOYEE_TYPE"),a.fieldLabel.userBasicInfo=i.instant("EMPLOYEE_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=i.instant("EMPLOYEE_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=i.instant("EMPLOYEE_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=i.instant("EMPLOYEE_UPDATE_SUCCESS")):"SERVICE_PROVIDER"==d.code?((a.pageState="add")?a.titleLabelAdd=i.instant("ADD_ORGANIZATION_CLIENT"):(a.pageState="edit")?a.titleLabelEdit=i.instant("EDIT_ORGANIZATION_CLIENT"):(a.pageState="view")&&(a.titleLabelView=i.instant("VIEW_ORGANIZATION_CLIENT")),a.fieldLabel.userName=i.instant("CLIENT_NAME"),a.fieldLabel.userID=i.instant("CLIENT_ID"),a.fieldLabel.userType=i.instant("CLIENT_TYPE"),a.fieldLabel.userBasicInfo=i.instant("CLIENT_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=i.instant("CLIENT_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=i.instant("CLIENT_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=i.instant("CLIENT_UPDATE_SUCCESS")):((a.pageState="add")?a.titleLabelAdd=i.instant("ADD_ORGANIZATION_CLIENT"):(a.pageState="edit")?a.titleLabelEdit=i.instant("EDIT_ORGANIZATION_CLIENT"):(a.pageState="view")&&(a.titleLabelView=i.instant("VIEW_ORGANIZATION_CLIENT")),a.fieldLabel.userName=i.instant("CLIENT_NAME"),a.fieldLabel.userID=i.instant("CLIENT_ID"),a.fieldLabel.userType=i.instant("CLIENT_TYPE"),a.fieldLabel.userBasicInfo=i.instant("CLIENT_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=i.instant("CLIENT_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=i.instant("CLIENT_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=i.instant("CLIENT_UPDATE_SUCCESS")),/* locationCategory label changes end */
a.loadLanguages()},a.init(),a.checkOrgLocClient=function(b,c){var d={};d.userId=b.userId,d.orgLocId=c.data.id,n.getData(m.getParameterizedUrl("IS_LOGGED_USER_CLIENT_BY_LOC_ID",d),null,function(b){b&&b.data?a.isLocUser=!0:a.isLocUser=!1},function(a){})},a.checkUsersMobileNo=function(){"edit"!=c.type&&a.WSClientExtraData.cellNo&&f.UserInfoDTO(a.WSClientExtraData.cellNo,function(b){b&&b.length>0?(a.userList=b.sort(function(a,b){return b.age-a.age}),a.guardianData.guardian={id:a.userList[0].userId,value:a.userList[0].displayName}):(a.userList={},/*$scope.user.userData = {};*/
a.userDetails={},delete a.guardianData.birthDate,delete a.WSClientExtraData.email,delete a.WSClientExtraData.age,delete a.WSClientExtraData.month,delete a.WSClientExtraData.genderCode,delete a.WSClientExtraData.selectUserId)},function(a){})},
//This method is used to populate the details in popup with the selected user in dropdown
a.getUserDetails=function(b){a.user={},f.userDetailsInfo(b.userId,function(c){f.userInfo(b.userId,function(b){a.user={},a.user.userData={},a.user.userData.data=b,a.user.userData.data.value=b.displayName,a.user.userData.data.userAccountType=null,a.user.userData.nameValue=b.displayName},function(a){}),a.userDetails=c,a.userDetails.value=c.displayName,a.addressData=c.userAddress,/*$scope.user = {
userData: {
    data: $scope.userDetails
}
};*/
a.WSClientExtraData.cellNo=c.cell1,a.WSClientExtraData.email=c.email1,a.guardianData.birthDate=p.convertToViewDate(c.birthDate),a.guardianData.guardianCheck=c.hasGuardian,j.isNullOrEmpty(c.genderId)||(a.WSClientExtraData.genderCode=c.genderId.code),j.isNullOrEmpty(c.age)||(a.WSClientExtraData.age=c.age),j.isNullOrEmpty(c.month)||(a.WSClientExtraData.month=c.month),(c.guardianId||c.guardianName)&&(a.guardianData.guardian={id:c.guardianId,value:c.guardianName},a.WSUserServiceOrganization={id:c.guardianId,value:c.guardianName}),c.hasGuardian||(a.guardianData.guardian={id:c.id,value:c.displayName}),j.isNullOrEmpty(a.addressData.id)||"edit"==a.pageState||"add"==a.pageState?a.userSelectedDisabled=!1:(a.userSelectedDisabled=!0,a.addressData.selectedDisable=!0)},function(a){})}}]),angular.module("paripal.manageOrganisationLocationClient").controller("AddOrgLocClientFromContactsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$log","$q","$timeout","serverSidePagination","manageUserTreatmentService","httpService","urlService","utilService","commonConstants","fileOperations","featurePrivilegeConstants","addOrgLocClientService","baseService","storageService","$mdDialog","MakePrescriptionFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";a.step1=!0,a.step2=!1,a.iconStep1=!0,a.iconStep2=!0,a.featurePrivilegeConstants=s,a.WSClient={},a.WSClientDate={},a.addressData={},a.organization={},a.orgLocation={},a.user={userData:{}},a.currencyValue={},a.referredByData={},a.WSSetDataObj={},a.WSClient.whetherActive=!0,a.userSelectedDisabled=!1,a.editDisabled=!1,a.trackCustomerBilling=!0,a.orgSelectedDisabled=!1,a.clientDisabled=!1,a.validFromDisabled=!1,a.addOrgLocClientSpinner=!1,a.disableUser=!1,a.documentUploadFile=null,a.loginDetails=b.loggedInUserDetails,a.contactslist=c.data,a.selected=[],a.contactlist=[];var y=angular.copy(b.contactslist);a.contactlist=y,a.toggle=function(b,c){if(a.selected&&a.selected.length>0){var d=!1,e=-1;a.selected.forEach(function(a,c){d||a.cell!=b.cell||(e=c,d=!0)}),d?e>=0&&a.selected.splice(e,1):a.selected.push({name:b.name,cell:b.cell,email:b.email})}else a.selected=[],a.selected.push({name:b.name,cell:b.cell,email:b.email})},a.checkSelected=function(b,c){var d=!1;return a.selected&&a.selected.length>0&&a.selected.forEach(function(a,c){a.cell==b.cell&&(d=!0)}),d},a.selectedlist=function(b){b?a.contactlist=y:(a.contactlist=[],a.contactlist=a.selected)};var z=angular.element(document.querySelector("#wizard1")),A=angular.element(document.querySelector("#wizard2"));a.goToStep1=function(){console.log(a.selected),a.step1=!0,a.step2=!1,z.addClass("btn-primary").removeClass("btn-default"),A.addClass("btn-default").removeClass("btn-primary")},a.goToStep2=function(){a.selected.length>0&&(console.log(a.selected),a.step1=!1,a.step2=!0,z.addClass("btn-default").removeClass("btn-primary"),A.addClass("btn-primary").removeClass("btn-default"))},a.close=function(){w.hide(),a.emptyUserDetails(),c.user={}},a.cancel=function(){p.goBackToPrevState()},a.viewCompleteForm=function(){if(w.hide(),p.isNullOrEmpty(a.user)||p.isNullOrEmpty(a.user.userData)){var b={};b.uName=a.user.userData,p.isNullOrEmpty(a.selected)||(p.isNullOrEmpty(a.selected.cell)||(b.cellNo=a.selected.cell),p.isNullOrEmpty(a.selected.genderCode)||(b.genderCode=a.selected.genderCode),p.isNullOrEmpty(a.selected.age)||(b.age=a.selected.age),p.isNullOrEmpty(a.selected.month)||(b.month=a.selected.month),p.isNullOrEmpty(a.selected.email)||(b.email=a.selected.email),p.isNullOrEmpty(a.selected.validFrom)||(b.validFrom=a.selected.validFrom)),p.isNullOrEmpty(a.selected.guardianData)||(b.dob=a.selected.guardianData)}else if(p.isNullOrEmpty(a.user.userData.data)){var b={};b.uName=a.user.userData,p.isNullOrEmpty(a.selected)||(p.isNullOrEmpty(a.selected.cell)||(b.cellNo=a.selected.cell),p.isNullOrEmpty(a.selected.genderCode)||(b.genderCode=a.selected.genderCode),p.isNullOrEmpty(a.selected.age)||(b.age=a.selected.age),p.isNullOrEmpty(a.selected.month)||(b.month=a.selected.month),p.isNullOrEmpty(a.selected.email)||(b.email=a.selected.email),p.isNullOrEmpty(a.selected.validFrom)||(b.validFrom=a.selected.validFrom)),p.isNullOrEmpty(a.guardianData)||(b.dob=a.guardianData)}else var b=a.user.userData;d.go("addorglocclient",{type:"",user:b})},a.$watch("user.userData.data",function(b){a.user&&a.user.userData&&!p.isEmpty(a.user.userData.data)?(p.isFieldEmpty(a.user.userData.data.id)||a.userDetailsInfo(a.user.userData.data.id),a.selected.cell=parseFloat(b.cell),
// $scope.selected.email = newVal.email1;
b.genderId&&b.genderId.code&&(a.selected.genderCode=b.genderId.code),a.selected.guardianData.birthDate=dateconvertor.convertToViewDate(b.birthDate),a.selected.guardianCheck=b.hasGuardian,b.guardianId&&null!=b.guardianId&&b.data.guardianName&&null!=b.data.guardianName&&(a.WSUserServiceOrganization={id:b.guardianId,value:b.data.guardianName})):(delete a.selected.guardianData.birthDate,delete a.selected.email,delete a.selected.age,delete a.selected.month,delete a.selected.genderCode,a.isLocUser=!1,a.user.userData&&a.user.userData.nameValue&&(a.selected.guardianData.guardianCheck=!0,a.userList&&a.userList.length>0&&(a.selected.guardianData.guardian={id:a.userList[0].userId,value:a.userList[0].name})),
//delete $scope.user.userData.data;
a.disableUser=!1,a.userSelectedDisabled=!1)},!0),a.clientTypeChanged=function(){b.$broadcast("clearUserData"),a.emptyUserDetails(),a.addressType="COMPANY"==a.WSClient.clientType?"WORK":"HOME",a.filterAddressTypesMethod()},a.emptyUserDetails=function(){a.addressData={},a.addressData.addressTypeId=-1,a.selected.cell=null,a.selected.email=null,a.selected.age=null,a.selected.month=null,a.userSelectedDisabled=!1,a.disableUser=!1,a.selected.guardianData={},a.guardianCheck=!1,a.WSUserServiceOrganization={}},a.$watch("referredByData.data",function(b){b!==-1?p.isEmpty(a.referredByData.data)||(a.WSClient.referedById=a.referredByData.data.id,a.selected.referedByIdValue=a.referredByData.data.userCode):(a.WSClient.referedById="",a.selected.referedByIdValue="")},!0),a.$watch("orgLocation.data",function(c){p.isEmpty(c)?(a.addressData={},a.addressData.addressTypeId=-1,a.selected.cell=null,a.selected.email=null,a.selected.guardianData={},a.userSelectedDisabled=!1,b.$broadcast("clearUserData"),a.disableUser=!1,a.orgSelectedDisabled=!0):(a.organizationLocationId=c.id,t.getOrgLocationByOrgLocId(a.organizationLocationId,function(b){a.WSOrgLocation=b,a.trackCustomerBilling=a.WSOrgLocation.whetherTrackCustomerBilling,a.orgSelectedDisabled=!1},function(a){}))},!0),a.userDetailsInfo=function(b){t.userDetailsInfo(b,function(b){a.addressData=b.userAddress,a.selected.cell=b.cell,a.selected.email=b.email1,a.selected.guardianData.birthDate=dateconvertor.convertToViewDate(b.birthDate),a.selected.guardianData.guardianCheck=b.hasGuardian,a.selected.guardianData.guardian={id:b.guardianId,value:b.guardianName},b.genderId&&(a.selected.genderCode=b.genderId.code),a.selected.age=b.age,a.selected.month=b.month,(b.guardianId||b.guardianName)&&(a.WSUserServiceOrganization={id:b.guardianId,value:b.guardianName}),
//$scope.disableUser = true;
p.isNullOrEmpty(a.addressData.id)?a.userSelectedDisabled=!1:(a.userSelectedDisabled=!0,a.addressData.selectedDisable=!0)},function(a){})},a.calculateDateOfBirth=function(b){
//changes done to calculate birthDate by age and month
var c,d;c=b.age?(new Date).getFullYear()-b.age:(new Date).getFullYear(),d=b.month?(new Date).getMonth()-b.month:(new Date).getMonth(),b.guardianData.birthDate=new Date(c,d,(new Date).getDate()),a.dobChanged(b.age)},a.insteadWatch=function(b,c){if(b){var d=Date.now()-new Date(b).getTime(),e=new Date(d);// miliseconds from epoch
c.age=Math.abs(e.getUTCFullYear()-1970);var f=(new Date).valueOf()-new Date(b).valueOf(),g=Math.floor(f%31536e6/864e5),h=Math.floor(g/30);c.month=h,c.age<18?(c.guardianData.guardianCheck=!0,a.userList&&(c.guardianData.guardian={id:a.userList[0].userId,value:a.userList[0].displayName})):(c.guardianData.guardianCheck=!1,c.guardianData.guardian={})}},a.setDirectiveFn=function(b){a.dobChanged=b},a.setData=function(){a.WSSetDataObj.validFrom&&(a.WSClientDate.validFrom=a.WSSetDataObj.validFrom),a.WSSetDataObj.validTill&&(a.WSClientDate.validTill=a.WSSetDataObj.validTill),p.isEmpty(a.WSSetDataObj.clientType)||(a.WSClient.clientType=a.WSSetDataObj.clientType),p.isEmpty(a.WSSetDataObj.userByUserId)||(a.WSSetDataObj.userByUserId.id?(a.selected.cell=a.WSSetDataObj.userByUserId.cell,a.selected.email=a.WSSetDataObj.userByUserId.email1,a.userDetailsInfo(a.WSSetDataObj.userByUserId.id),a.user.userData=a.WSSetDataObj.userByUserId,a.user.userData.value=a.user.userData.name):(a.user.userData=a.WSSetDataObj.userByUserId,a.user.userData.cell&&(a.selected.cell=parseFloat(a.user.userData.cell)))),p.isEmpty(a.WSSetDataObj.currency)||(a.currencyValue=a.WSSetDataObj.currency),p.isEmpty(a.WSSetDataObj.organizationLocation)||(a.orgLocation.data={id:a.WSSetDataObj.organizationLocation.id,value:a.WSSetDataObj.organizationLocation.name},p.isEmpty(a.WSSetDataObj.organizationLocation.organization)||(a.organization.data=a.WSSetDataObj.organizationLocation.organization)),p.isNullOrEmpty(a.WSSetDataObj.referedById)||(a.WSClient.referedById=a.WSSetDataObj.referedById,a.selected.referedByIdValue=a.WSSetDataObj.referedById,a.WSClient.referedById&&t.userInfo(a.WSSetDataObj.referedById,function(b){a.referredByData=b,a.selected.referedByIdValue=b.userCode,p.isNullOrEmpty(a.WSSetDataObj.referedBy)?a.referredByData.value=b.firstName:a.referredByData.value=a.WSSetDataObj.referedBy},function(a){})),p.isNullOrEmpty(a.WSSetDataObj.balanceDue)||(a.WSClient.balanceDue=a.WSSetDataObj.balanceDue),p.isNullOrEmpty(a.WSSetDataObj.patientId)||(a.WSClient.patientId=a.WSSetDataObj.patientId),p.isNullOrEmpty(a.WSSetDataObj.documentId)||(a.WSClient.documentId=a.WSSetDataObj.documentId)},a.downloadClientScanFile=function(){var b=new Object;b.resourceId=a.WSClient.documentId,b.docType=q.documentTypes.client,b.docSubType=q.documentSubTypes.clientScanId,b.orgLocId=a.orgLocation.data.id,r.downloadFile(b,function(a){},function(a){})},a.init=function(){if(p.isNullOrEmpty(c.user)||(p.isNullOrEmpty(c.user.data)?(c.user.uName&&(a.user.userData=c.user.uName),p.isNullOrEmpty(c.user.cellNo)||(a.selected.cell=c.user.cellNo),p.isNullOrEmpty(c.user.genderCode)||(a.selected.genderCode=c.user.genderCode),p.isNullOrEmpty(c.user.age)||(a.selected.age=c.user.age),p.isNullOrEmpty(c.user.month)||(a.selected.month=c.user.month),p.isNullOrEmpty(c.user.email)||(a.selected.email=c.user.email),p.isNullOrEmpty(c.user.validFrom)||(a.selected.validFrom=c.user.validFrom),p.isNullOrEmpty(c.user.dob)||(p.isNullOrEmpty(c.user.dob.birthDate)||(a.selected.guardianData.birthDate=c.user.dob.birthDate),p.isNullOrEmpty(c.user.dob.guardianCheck)||(a.selected.guardianData.guardianCheck=c.user.dob.guardianCheck),p.isNullOrEmpty(c.user.dob.guardian)||(a.selected.guardianData.guardian=c.user.dob.guardian))):a.user.userData=c.user),a.pageState="add",c.user&&c.user.cellNo&&t.UserInfoDTO(c.user.cellNo,function(b){b&&b.length>0&&(a.userList=b.sort(function(a,b){return b.age-a.age}),a.selected.guardianData.guardian={id:a.userList[0].id,value:a.userList[0].name})},function(a){}),localStorage.getItem("defaultOrg")&&(a.organization={},a.organization.data=angular.fromJson(localStorage.getItem("defaultOrg"))),localStorage.getItem("defaultOrgLoc")){var b=v.getLocationFeaturePrivileges();b&&b.organization_client_add&&b.organization_client_add.indexOf(angular.fromJson(localStorage.getItem("defaultOrgLoc")).id)!=-1&&(a.orgLocation={},a.orgLocation.data=angular.fromJson(localStorage.getItem("defaultOrgLoc")))}a.WSClientDate.validFrom=new Date,a.addOrgLocClientSpinner=!0,"edit"===c.type?(a.pageState="edit",a.editDisabled=!0,a.validFromDisabled=!0):"view"===c.type?(a.pageState="view",a.clientDisabled=!0,a.validFromDisabled=!0):(a.addOrgLocClientSpinner=!1,a.WSClient.clientType="INDIVIDUAL"),t.getGenderList(function(b){a.genderList=b},function(a){}),c.data?(a.WSSetDataObj=c.data,a.setData(),a.addOrgLocClientSpinner=!1):c.clientId&&orgLocClientListService.getOrgLocClientById(c.clientId,function(b){a.addOrgLocClientSpinner=!1,a.WSSetDataObj=b,a.setData()},function(b){a.addOrgLocClientSpinner=!1,a.error=b}),a.addressType="COMPANY"==a.WSClient.clientType?"WORK":"HOME";/* locationCategory label changes start */
var d=u.getLocationCategory();a.fieldLabel={},a.responseMessageLabel={},p.isFieldEmpty(d)?((a.pageState="add")?a.titleLabelAdd=h.instant("ADD_ORGANIZATION_CLIENT"):(a.pageState="edit")?a.titleLabelEdit=h.instant("EDIT_ORGANIZATION_CLIENT"):(a.pageState="view")&&(a.titleLabelView=h.instant("VIEW_ORGANIZATION_CLIENT")),a.fieldLabel.userName=h.instant("CLIENT_NAME"),a.fieldLabel.userID=h.instant("CLIENT_ID"),a.fieldLabel.userType=h.instant("CLIENT_TYPE"),a.fieldLabel.userBasicInfo=h.instant("CLIENT_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=h.instant("CLIENT_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=h.instant("CLIENT_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=h.instant("CLIENT_UPDATE_SUCCESS")):"EDUCATIONAL_INSTITUTION"==d.code?((a.pageState="add")?a.titleLabelAdd=h.instant("ADD_ORGANIZATION_STUDENT"):(a.pageState="edit")?a.titleLabelEdit=h.instant("EDIT_ORGANIZATION_STUDENT"):(a.pageState="view")&&(a.titleLabelView=h.instant("VIEW_ORGANIZATION_STUDENT")),a.fieldLabel.userName=h.instant("STUDENT_NAME"),a.fieldLabel.userID=h.instant("STUDENT_ID"),a.fieldLabel.userType=h.instant("STUDENT_TYPE"),a.fieldLabel.userBasicInfo=h.instant("STUDENT_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=h.instant("STUDENT_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=h.instant("STUDENT_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=h.instant("STUDENT_UPDATE_SUCCESS")):"CORPORATE"==d.code?((a.pageState="add")?a.titleLabelAdd=h.instant("ADD_ORGANIZATION_EMPLOYEE"):(a.pageState="edit")?a.titleLabelEdit=h.instant("EDIT_ORGANIZATION_EMPLOYEE"):(a.pageState="view")&&(a.titleLabelView=h.instant("VIEW_ORGANIZATION_EMPLOYEE")),a.fieldLabel.userName=h.instant("EMPLOYEE_NAME"),a.fieldLabel.userID=h.instant("EMPLOYEE_ID"),a.fieldLabel.userType=h.instant("EMPLOYEE_TYPE"),a.fieldLabel.userBasicInfo=h.instant("EMPLOYEE_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=h.instant("EMPLOYEE_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=h.instant("EMPLOYEE_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=h.instant("EMPLOYEE_UPDATE_SUCCESS")):"SERVICE_PROVIDER"==d.code&&((a.pageState="add")?a.titleLabelAdd=h.instant("ADD_ORGANIZATION_CLIENT"):(a.pageState="edit")?a.titleLabelEdit=h.instant("EDIT_ORGANIZATION_CLIENT"):(a.pageState="view")&&(a.titleLabelView=h.instant("VIEW_ORGANIZATION_CLIENT")),a.fieldLabel.userName=h.instant("CLIENT_NAME"),a.fieldLabel.userID=h.instant("CLIENT_ID"),a.fieldLabel.userType=h.instant("CLIENT_TYPE"),a.fieldLabel.userBasicInfo=h.instant("CLIENT_BASIC_INFORMATION"),a.fieldLabel.userAddressDetails=h.instant("CLIENT_ADDRESS_DETAILS"),a.responseMessageLabel.userAdded=h.instant("CLIENT_ADDED_SUCCESSFULLY"),a.responseMessageLabel.userUpdated=h.instant("CLIENT_UPDATE_SUCCESS"))},a.init(),a.checkOrgLocClient=function(b,c){var d={};d.userId=b.userId,d.orgLocId=c.data.id,n.getData(o.getParameterizedUrl("IS_LOGGED_USER_CLIENT_BY_LOC_ID",d),null,function(b){b&&b.data?a.isLocUser=!0:a.isLocUser=!1},function(a){})},a.checkUsersMobileNo=function(){a.selected.cell&&t.UserInfoDTO(a.selected.cell,function(b){b&&b.length>0?(a.userList=b.sort(function(a,b){return b.age-a.age}),a.selected.guardianData.guardian={id:a.userList[0].userId,value:a.userList[0].name}):(a.userList={},a.user.userData={},a.userDetails={},delete a.selected.guardianData.birthDate,delete a.selected.email,delete a.selected.age,delete a.selected.month,delete a.selected.genderCode,delete a.selected.selectUserId)},function(a){})},
//This method is used to populate the details in popup with the selected user in dropdown
a.getUserDetails=function(b){a.user={},t.userDetailsInfo(b.userId,function(c){t.userInfo(b.userId,function(b){a.user={},a.user.userData={},a.user.userData.data=b,a.user.userData.data.value=b.name,a.user.userData.data.userAccountType=null,a.user.userData.nameValue=b.name},function(a){}),a.userDetails=c,a.userDetails.value=c.name,a.addressData=c.userAddress,/*$scope.user = {
                            userData: {
                                data: $scope.userDetails
                            }
                        };*/
a.selected.cell=c.cell,a.selected.email=c.email1,a.selected.guardianData.birthDate=dateconvertor.convertToViewDate(c.birthDate),a.selected.guardianData.guardianCheck=c.hasGuardian,p.isNullOrEmpty(c.genderId)||(a.selected.genderCode=c.genderId.code),p.isNullOrEmpty(c.age)||(a.selected.age=c.age),p.isNullOrEmpty(c.month)||(a.selected.month=c.month),(c.guardianId||c.guardianName)&&(a.selected.guardianData.guardian={id:c.guardianId,value:c.guardianName},a.WSUserServiceOrganization={id:c.guardianId,value:c.guardianName}),c.hasGuardian||(a.selected.guardianData.guardian={id:c.id,value:c.name}),p.isNullOrEmpty(a.addressData.id)?a.userSelectedDisabled=!1:(a.userSelectedDisabled=!0,a.addressData.selectedDisable=!0)},function(a){})},a.saveOrgLocClient=function(e){if(a.setData(),"COMPANY"===a.WSClient.clientType&&(a.selected[e].guardianData.guardian=null,a.selected[e].guardianData.guardianId=null,a.selected[e].guardianData.guardianName=null),p.isFieldEmpty(a.selected[e].guardianData.guardian)||(a.selected[e].guardianData.guardianId=a.selected[e].guardianData.guardian.id,a.selected[e].guardianData.guardianName=a.selected[e].guardianData.guardian.value),a.selected&&a.selected.length>0&&angular.forEach(a.selected,function(b){a.selected&&a.selected[e].genderCode&&a.genderList&&angular.forEach(a.genderList,function(b,c){b.code==a.selected[e].genderCode&&(a.selected[e].gender=b)})}),a.user.userData={nameValue:a.selected[e].act_name},a.selected[e]){a.toBeSent=[],a.sent={};var g=a.selected[e];a.gen={id:2},a.sent={age:a.selected[e].age,cellNo:g.cell,gender:a.gen,genderCode:g.genderCode,month:a.selected[e].month},a.toBeSent.push(a.sent)}a.WSSetDataObj={},a.selected[e]&&a.selected[e].guardianData&&!a.selected[e].guardianData.birthDate&&(a.selected[e].guardianData.birthDate=new Date),b.showSpinner=!0,t.saveOrgLocClient(a.WSClient,a.WSClientDate,a.organization,a.orgLocation,a.user.userData,a.currencyValue,a.referredByData,a.WSSetDataObj,a.addressData,a.sent,c.type,a.selected[e].guardianData,function(g){b.showSpinner=!1,a.expressionSaveResponse=g,"edit"===c.type?f("success",h.instant(a.responseMessageLabel.userUpdated)):f("success",h.instant(a.responseMessageLabel.userAdded)),c.urlState&&c.appointmentType?"RECORDWALKIN"==c.appointmentType?d.go(c.urlState,{clientId:g,appointmentId:c.appointmentId,type:c.appointmentType,urlState:c.urlState,entityType:c.entityType,entityName:c.entityName,eventType:c.eventType,eventName:c.eventName}):d.go(c.urlState,{clientId:g,appointmentId:c.appointmentId,type:c.appointmentType,urlState:c.urlState}):(w.hide(!0),a.deleteFromList(e),0==a.selected.length&&d.go("orglocclientlist",{type:""}))},function(c){b.showSpinner=!1,a.expressionSaveResponse=c})},a.deleteFromList=function(b){a.selected.splice(b,1),0==a.selected.length&&d.go("orglocclientlist",{type:""})},a.search=function(b){a.selected.name.contains(b)?console.log("Name Exists"):console.log("Name Not Exists")}}]),angular.module("paripal.manageOrganisationLocationClient").controller("OrgLocClientListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","orgLocClientListService","notify","httpService","urlService","$translate","serverSidePagination","utilService","$mdDialog","baseService","addUserTestService","$mdMedia","docMgntService","messaging","orbeonFormRunner",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(b){for(var c=0;c<b.length;c++)if(null==b[c].phoneNumbers||null==b[c].name||null==b[c].name.formatted)console.log("empty Values");else if(b[c].phoneNumbers.length>1&&null!=b[c].phoneNumbers&&null!=b[c].name&&null!=b[c].name.formatted){a.c_list={},a.cell1=b[c].phoneNumbers[0].value,a.cedit=a.cell1.replace(/ /g,"");var d=a.cedit.match(/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/);d&&d.input&&d.input.length>9&&(a.c_list.name=b[c].name.formatted,a.c_list.cell=a.cedit,null!=b[c].emails&&a.c_list.email==b[c].emails[0].value,a.contact_list.push(a.c_list))}else if(b[c].phoneNumbers.length>0&&null!=b[c].phoneNumbers&&null!=b[c].name&&null!=b[c].name.formatted){a.c_list={},a.cell1=b[c].phoneNumbers[0].value,a.cedit=a.cell1.replace(/ /g,"");var d=a.cedit.match(/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/);d&&d.input&&d.input.length>9&&(a.c_list.name=b[c].name.formatted,a.c_list.cell=a.cedit,b[c].emails&&(a.c_list.email=b[c].emails[0].value),a.contact_list.push(a.c_list))}else console.log("empty phoneNumber");a.contact_list.sort(),v(a.contact_list)}function u(a){b.showSpinner=!1,alert("onError!")}function v(a){h.postData(i.getUrl("CHECK_ARRAY_USER_BY_EMAIL_AND_CELL"),a,function(a){a.data&&(b.contactslist=a.data,b.showSpinner=!1,d.go("addorglocclientfromcontacts"))},function(){b.showSpinner=!1,errorCallback()})}function w(a,b,c,d,e,f,g){a.searchCriteria={},a.getFormList=function(){var b={};b.transactionType="Client_Records",b.organizationLocationId=f.organizationLocation.id,b.languageId=a.searchCriteria.language.id,g.getFormsList(b,function(b){a.formList=b},function(a){})},a.$watch("searchCriteria.language",function(b){l.isEmpty(b)||a.getFormList()},!0),a.selectForm=function(){var c={};c.selectedForm=a.selectedForm,c.clientObj=f,b.hide(c)},/*if (clientObj) {
                $scope.getFormList();
            }*/
a.cancel=function(){b.hide()}}function x(a,b,c,d,e,f,g,h,i){a.category=new Array,a.labelList="";var j={clientId:f.id};d.getData(e.getParameterizedUrl("GET_ORG_LOC_CLIENT_BY_ID",j),null,function(b){b&&b.data&&(l.isNullOrEmpty(b.data.clientCategoryId1)||(a.category[0]={},a.category[0]=b.data.clientCategoryId1),l.isNullOrEmpty(b.data.clientCategoryId2)||(a.category[1]={},a.category[1]=b.data.clientCategoryId2),l.isNullOrEmpty(b.data.clientCategoryId3)||(a.category[2]={},a.category[2]=b.data.clientCategoryId3))},function(a){}),a.cancel=function(a){c.hide(a)},a.fetchCategotyLabels=function(){var b=new Array;b.push("CLIENT_CATEGORY_1"),b.push("CLIENT_CATEGORY_2"),b.push("CLIENT_CATEGORY_3"),g.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.fetchCategotyLabels(),a.updateCat=function(){b.showSpinner=!0;var c={},g={clientId:f.id};l.isNullOrEmpty(a.category)||angular.forEach(a.category,function(a,b){0!=b||l.isNullOrEmpty(a.dataValue)?1!=b||l.isNullOrEmpty(a.dataValue)?b>1&&!l.isNullOrEmpty(a.dataValue)&&(c.clientCategoryId3=a.dataValue):c.clientCategoryId2=a.dataValue:c.clientCategoryId1=a.dataValue}),d.postData(e.getParameterizedUrl("UPDATE_CLIENT_CAT",g),c,function(c){b.showSpinner=!1,c.data.successMessage&&(h("success",i.instant(c.data.successMessage)),a.cancel("true"))},function(a){b.showSpinner=!1})}}w.$inject=["$scope","$mdDialog","httpService","urlService","parentScope","clientObj","orgLocClientListService"],x.$inject=["$scope","$rootScope","$mdDialog","httpService","urlService","rowObj","manageOrgLocService","notify","$translate"],a.currentPage=1,a.itemPerPage=10,a.c_list={},
//$scope.cell2 = [];
a.contact_list=[],a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterCriteria={},a.filterCriteria.organization={},a.filterCriteria.orgLocation={},a.userData={},a.addressInfoFilter={},a.addressInfo={},a.organizationInfo={},a.orgLocationInfo={},a.userDataInfo={},a.WSOrgLocationClientSearchCriteria={},a.filterCriteria.whetherActive=!0,a.WSOrgLocationClientSearchCriteria.whetherActive=!0,a.professionalList=["DOCTOR","SUPPORT_SERVICE_PROFESSIONAL","OTHER_HEALTH_SERVICE_PROFESSIONAL","COUNSELOR"],a.cell="",a.isCordovaValue=!1,a.text="",a.orglocclientlistSpinner=!1,a.isCordova="undefined"!=typeof cordova,a.isCordova&&(a.isCordovaValue=!0),
//Add new Organisation
a.addNewUser=function(b){
// debugger;
""!=b&&localStorage.setItem("clientListCellNo",b),
//localStorage.setItem("clientListCellNo",cellNo);
m.show({controller:"AddOrgLocClientCtrl",templateUrl:"app/modules/manage-organisation-location-client/views/add-org-loc-client-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{}}).then(function(a){a&&d.reload()},function(){a.WSHealthProfessionalsValues={}})},
//Add new Organisation
a.addNewUserFromContacts=function(c){if(
// debugger;
b.showSpinner=!0,a.isCordova="undefined"!=typeof cordova,a.isCordova){var d=new ContactFindOptions;d.filter="",d.multiple=!0;var e=["displayName","phoneNumbers","emails"];
// $state.go('addorglocclientfromcontacts',{data: filter});
navigator.contacts.find(e,t,u,d)}},a.fillForm=function(b){/*$state.go("documentManagement");*/
a.dialogBox=m.show({controller:w,templateUrl:"app/modules/document-management/views/fill-form.html",parent:angular.element(document.body),targetEvent:event,multiple:!1,clickOutsideToClose:!1,locals:{parentScope:a,clientObj:b}}).then(function(b){b&&(a.selectedFormObj=b.selectedForm,"MEASUREMENT_1"==a.selectedFormObj.serviceTypeName.value||"MEASUREMENT"==a.selectedFormObj.serviceTypeName.value?a.saveUserTest(a.selectedFormObj,b.clientObj):a.saveClientRecordTemplateData(a.selectedFormObj,b.clientObj))},function(a){})},/* CLIENT CATGEORY CHANGES : START */
a.updateCategory=function(b){a.dialogBox=m.show({controller:x,templateUrl:"app/modules/manage-organisation-location-client/views/update-category-popup.html",parent:angular.element(document.body),targetEvent:event,multiple:!1,clickOutsideToClose:!1,locals:{parentScope:a,rowObj:b}}).then(function(b){b&&a.fetchRecords()},function(a){})},/* CLIENT CATEGORY CHANGES: END */
a.saveClientRecordTemplateData=function(b,c){a.WSClientRecordTemplateData={};var d=n.getLoggedInUser().id;a.WSClientRecordTemplateData.user={id:c.client.id},a.WSClientRecordTemplateData.initiator={id:d},a.WSClientRecordTemplateData.organizationLocation={id:b.organizationLocationId},h.postData(i.getUrl("CREATE_CLIENT_RECORD_TEMPLATE_DATA"),a.WSClientRecordTemplateData,function(d){var e=d.data.response;a.selectOrbeonForm(null,b.referenceEntityType,e,b.organizationLocationId,b.systemLanguage.id,c.client.id)},function(a){})},a.saveUserTest=function(b,c){a.WSDiagnosticTestUser={},a.WSDiagnosticTestUser.user={id:c.client.id},a.WSDiagnosticTestUser.diagnosticTest={id:1,value:"FormTest"},a.WSDiagnosticTestUser.advisedById=n.getLoggedInUser().id,a.WSDiagnosticTestUser.advisedByName=n.getLoggedInUser().displayName,a.WSDiagnosticTestUser.reason="trial",a.labsReferred="ezest labs",a.testConductedAt=null,/*$scope.testConductedAt.data = {
                id: formObj.organizationLocationId,
                value: formObj.organizationLocationName
            };*/
a.WSDiagnosticTestUser.requestedOn=new Date;var d=null;o.saveUserTest(a.WSDiagnosticTestUser,a.labsReferred,a.testConductedAt,d,function(d){a.documentId=d.response,/*notify("success", successResponse.successMessage);*/
a.selectOrbeonForm(null,b.referenceEntityType,a.documentId,b.organizationLocationId,b.systemLanguage.id,c.client.id)},function(b){a.manageUserTestSpinner=!1})},a.selectOrbeonForm=function(b,c,d,e,f,g){var h=((p("sm")||p("xs"))&&a.customFullscreen,p("gt-sm"),{});h.stateName="orglocclientlist",q.getFormInstanceDetails(0,d,c,e,f,0,function(a){a?l.isFieldEmpty(f)||/*prevStateParam.params= {
                                   type: 'iframe',
                                   url:iframeURL,
                                   savedRecordId:recordId,
                                   readonly: readonly,
                                   prevStateParam:prevStateParam,
                               };*/
s.loadNewFormRunner(d,c,e,f,h,a,0,g,n.getLoggedInUser().id,n.getLoggedInUser().displayName):
// triggerMsgevent only
r.triggerMessageEvent(c,d,e,function(a){},function(a){})},function(a){r.triggerMessageEvent(c,d,e,function(a){},function(a){})})},a.serachByCell=function(){l.isNullOrEmpty(a.cell)?g("error",j.instant("VALID_NUMBER_ERR")):(a.WSOrgLocationClientSearchCriteria={},a.organization={},a.orgLocation={},a.userData={},a.addressInfo={},a.addressInfoFilter={},a.organizationInfo={},a.orgLocationInfo={},a.userDataInfo={},a.filterCriteria={whetherActive:!0},a.$broadcast("clearAddressData"),a.$broadcast("clearOrgLocData"),a.$broadcast("clearProfessionalData"),a.WSOrgLocationClientSearchCriteria.cell1=a.cell,a.WSOrgLocationClientSearchCriteria.whetherActive=!0,a.searchOrgLocClient())},a.serachByText=function(){l.isNullOrEmpty(a.text)?g("error",j.instant("INVALID_TEXT")):(a.WSOrgLocationClientSearchCriteria={},a.organization={},a.orgLocation={},a.userData={},a.addressInfo={},a.addressInfoFilter={},a.organizationInfo={},a.orgLocationInfo={},a.userDataInfo={},a.filterCriteria={whetherActive:!0},a.$broadcast("clearAddressData"),a.$broadcast("clearOrgLocData"),a.$broadcast("clearProfessionalData"),/*$scope.WSOrgLocationClientSearchCriteria.cell1 = $scope.cell;*/
a.WSOrgLocationClientSearchCriteria.searchKeyword=a.text,a.WSOrgLocationClientSearchCriteria.whetherActive=!0,a.searchOrgLocClient())},a.searchOrgLocClient=function(){a.WSOrgLocationClientSearchCriteria.pageNumber=a.currentPage,a.WSOrgLocationClientSearchCriteria.recordsPerPage=a.itemPerPage,l.isNullOrEmpty(a.text)||(a.WSOrgLocationClientSearchCriteria.searchKeyword=a.text,a.WSOrgLocationClientSearchCriteria.whetherActive=!0),a.orglocclientlistSpinner=!0,f.searchOrgLocClient(a.WSOrgLocationClientSearchCriteria,a.userDataInfo,a.addressInfoFilter,function(b){a.orglocclientlistSpinner=!1,a.WSOrganizationLocationClient=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.orglocclientlistSpinner=!1,a.error=b})},a.clear=function(){a.WSOrgLocationClientSearchCriteria={},a.organization={},a.orgLocation={},a.userData={},a.addressInfo={},a.addressInfoFilter={},a.organizationInfo={},a.orgLocationInfo={},a.userDataInfo={},a.filterCriteria={whetherActive:!0},delete a.WSOrgLocationClientSearchCriteria.cell1,a.cell="",delete a.WSOrgLocationClientSearchCriteria.searchKeyword,a.text="",a.$broadcast("clearAddressData"),a.$broadcast("clearOrgLocData"),a.$broadcast("clearProfessionalData"),a.fetchRecords()},a.fetchRecords=function(){delete a.WSOrgLocationClientSearchCriteria.cell1,a.cell="",l.isEmpty(a.filterCriteria)||(a.WSOrgLocationClientSearchCriteria=angular.copy(a.filterCriteria)),l.isEmpty(a.WSOrgLocationClientSearchCriteria.clientType)&&(a.WSOrgLocationClientSearchCriteria.clientType=null),a.addressInfoFilter=a.addressInfo,/*
                        $scope.organizationInfo = $scope.filterCriteria.organization;
                        $scope.orgLocationInfo = $scope.filterCriteria.orgLocation;*/
a.userDataInfo=a.userData,a.searchOrgLocClient()},a.addEditClient=function(b,c){var b=b;f.getOrgLocClientById(b,function(a){var e=a;"view"!==c&&"edit"!==c||d.go("addorglocclient",{type:c,data:e,clientId:b})},function(b){a.error=b})},a.showUserAddressList=function(a,b,c,e){var f={navigateFrom:"orglocclientlist",userAddressId:null,userId:a,userCode:b,userName:c};d.go("userAddressList",f)},a.goToUserScreen=function(a,b,c,e){if("searchUserIssue"===e){var f={userId:a,value:c};d.go(e,{user:f})}else d.go(e,{userId:a,userName:c})},a.goToTestScreen=function(a,b,c,e){var f={};f.user={id:a,value:c},/*$state.go(state, {
                user: user,
                fromClientsPage: true
            });*/
"addUserTestOrder"==e?d.go("testorder",{pageState:"add",data:f}):d.go("testorderlist",{data:f})},a.goToIncidentScreen=function(a){d.go("userincident",{user:a.client})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()};
//datatble config json
var y={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:5,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(y),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.searchOrgLocClient();/* locationCategory label changes */
var b=n.getLocationCategory();a.gridLabel={},a.filterLabel={},l.isFieldEmpty(b)?(a.titleLabel=j.instant("ORGANIZATION_CLIENT_LIST"),a.gridLabel.userName=j.instant("CLIENT_NAME"),a.gridLabel.userType=j.instant("CLIENT_TYPE"),a.gridLabel.userID=j.instant("CLIENT_ID"),a.filterLabel.activeUser=j.instant("ACTIVE_CLIENT")):"EDUCATIONAL_INSTITUTION"==b.code?(a.titleLabel=j.instant("ORGANIZATION_STUDENT_LIST"),a.gridLabel.userName=j.instant("STUDENT_NAME"),a.gridLabel.userType=j.instant("STUDENT_TYPE"),a.gridLabel.userID=j.instant("STUDENT_ID"),a.filterLabel.activeUser=j.instant("ACTIVE_STUDENT")):"CORPORATE"==b.code?(a.titleLabel=j.instant("ORGANIZATION_EMPLOYEE_LIST"),a.gridLabel.userName=j.instant("EMPLOYEE_NAME"),a.gridLabel.userType=j.instant("EMPLOYEE_TYPE"),a.gridLabel.userID=j.instant("EMPLOYEE_ID"),a.filterLabel.activeUser=j.instant("ACTIVE_EMPLOYEE")):"SERVICE_PROVIDER"==b.code?(a.titleLabel=j.instant("ORGANIZATION_CLIENT_LIST"),a.gridLabel.userName=j.instant("CLIENT_NAME"),a.gridLabel.userType=j.instant("CLIENT_TYPE"),a.gridLabel.userID=j.instant("CLIENT_ID"),a.filterLabel.activeUser=j.instant("ACTIVE_CLIENT")):"RESIDENTIAL_SOCIETY"==b.code?(a.titleLabel=j.instant("SOCIETY_RESIDNET_LIST"),a.gridLabel.userName=j.instant("RESIDENT_NAME"),a.gridLabel.userType=j.instant("RESIDENT_TYPE"),a.gridLabel.userID=j.instant("RESIDENT_ID"),a.filterLabel.activeUser=j.instant("ACTIVE_RESIDENT")):(a.titleLabel=j.instant("ORGANIZATION_CLIENT_LIST"),a.gridLabel.userName=j.instant("CLIENT_NAME"),a.gridLabel.userType=j.instant("CLIENT_TYPE"),a.gridLabel.userID=j.instant("CLIENT_ID"),a.filterLabel.activeUser=j.instant("ACTIVE_CLIENT"))},a.init()}]),angular.module("paripal.manageOrganisationLocationClient").service("addOrgLocClientService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveOrgLocClient=function(e,f,g,h,i,j,k,l,m,n,o,p,q,r){e.organizationLocation={},d.isEmpty(i)||(i.data!==-1?d.isEmpty(i.data)?!d.isNullOrEmpty(i.nameValue)&&d.isNullOrEmpty(i.id)?this.populateUserDetails(e,i.nameValue,m,n,"NOT_SELECTED"):i.id&&this.populateUserDetails(e,i,m,n,"SELECTED"):this.populateUserDetails(e,i.data,m,null,"SELECTED"):d.isNullOrEmpty(i.data)&&!d.isNullOrEmpty(i.nameValue)?this.populateUserDetails(e,i.nameValue,m,n,"NOT_SELECTED"):i.data!==-1||d.isNullOrEmpty(i.nameValue)||this.populateUserDetails(e,i.nameValue,m,n,"NOT_SELECTED")),d.isEmpty(g)||(e.organizationLocation.organization=g.data),d.isEmpty(h)||(e.organizationLocation.id=h.data.id,e.organizationLocation.displayName=h.data.value),d.isEmpty(j)||(e.currency=j.dataValue),d.isEmpty(k)||(k.data?(e.referedBy=k.data.value,e.referedById=k.data.id):k.value&&(e.referedBy=k.value,e.referedById=k.id)),d.isEmpty(l)||(d.isEmpty(l.organizationLocation)||(e.organizationLocation=l.organizationLocation),l.id&&(e.id=l.id),l.version&&(e.version=l.version)),f.validFrom&&(e.validFrom=c.convertToServerDate(f.validFrom)),f.validTill&&(e.validTill=c.convertToServerDate(f.validTill));var s=null;if("edit"===o){var t={};t.clientId=e.id,s=b.getParameterizedUrl("UPDATE_CLIENT",t),e.userByUserId||(e.userByUserId={}),e.userByUserId.birthDate=p.birthDate,e.userByUserId.hasGuardian=p.hasGuardian,
//if (!utilService.isFieldEmpty(WSClient.guardianId)) {
e.userByUserId.guardianId=p.guardianId,e.userByUserId.guardianName=p.guardianName}else s=b.getUrl("ADD_CLIENT"),e.userByUserId||(e.userByUserId={}),e.userByUserId.birthDate=p.birthDate,e.userByUserId.hasGuardian=p.hasGuardian,
//if (!utilService.isFieldEmpty(WSClient.guardianId)) {
e.userByUserId.guardianId=p.guardianId,e.userByUserId.guardianName=p.guardianName;!e.userByUserId.userAddress||e.userByUserId.userAddress.addressTypeId&&null!=e.userByUserId.userAddress.addressTypeId||delete e.userByUserId.userAddress,/* Changes for edit client 14-11-18 */
d.isNullOrEmpty(e.userByUserId)||(d.isNullOrEmpty(e.userByUserId.userAddress)||(e.userAddress=e.userByUserId.userAddress),e.user=e.userByUserId),a.postData(s,e,function(a){a&&a.data&&q(a.data)},function(a){r(a)})},this.userDetailsInfo=function(c,d,e){var f={};f.userId=c,a.getData(b.getParameterizedUrl("GET_USER_DETAILS",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getUserDetailsInfo=function(c,d,e){var f={};f.userId=c,a.getData(b.getParameterizedUrl("GET_USER_BY_ID_FOR_CLIENT",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.UserInfoDTO=function(c,d,e){var f={};f.cell=c,a.postData(b.getUrl("CHECK_USER_BY_EMAIL_AND_CELL"),f,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.checkOrgLocClient=function(c,d,e){var f={};f.userId=c.userId,f.orgLocId=c.orgLocId,a.postData(b.getUrl("IS_LOGGED_USER_CLIENT_BY_LOC_ID"),f,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getGenderList=function(c,d){var e={};e.type="GENDER",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.userInfo=function(c,d,e){var f={};f.userId=c,a.getData(b.getParameterizedUrl("FIND_USER_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getOrgLocationByOrgLocId=function(c,d,e){var f={};f.organizationLocationId=c,a.getData(b.getParameterizedUrl("GET_ORG_LOC_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.populateUserDetails=function(a,b,c,e,f){if("NOT_SELECTED"===f){var g=b;g=g.split(" "),a.userByUserId={},a.userByUserId.firstName=g[0],a.userByUserId.lastName=g[1],a.userByUserId.email1=e.email,a.userByUserId.cell1=e.cellNo,a.userByUserId.genderId=e.gender,a.userByUserId.age=parseInt(e.age),a.userByUserId.month=parseInt(e.month),a.userByUserId.displayName=a.userByUserId.firstName+" "+a.userByUserId.lastName,d.isNullOrEmpty(a.userByUserId.lastName)&&(a.userByUserId.lastName=a.userByUserId.firstName,a.userByUserId.displayName=a.userByUserId.firstName)}else"SELECTED"===f&&(a.userByUserId={},a.userByUserId.id=b.id,a.userByUserId.userCode=b.userCode,a.userByUserId.firstName=b.firstName,a.userByUserId.lastName=b.lastName,a.userByUserId.email1=b.email1,d.isNullOrEmpty(e)||d.isNullOrEmpty(e.cellNo)?a.userByUserId.cell1=b.cell1:a.userByUserId.cell1=e.cellNo,d.isNullOrEmpty(b.nameValue)?a.userByUserId.displayName=b.displayName:a.userByUserId.displayName=b.nameValue,a.userByUserId.systemLanguage=b.systemLanguage,d.isNullOrEmpty(e)||d.isNullOrEmpty(e.gender)||(a.userByUserId.genderId=e.gender),d.isNullOrEmpty(e)||d.isNullOrEmpty(e.email)||(a.userByUserId.email1=e.email));d.isEmpty(c)||c.addressTypeId!==-1&&(a.userByUserId.userAddress=c,delete a.userByUserId.userAddress.selectedDisable),/* Changes for preferred language 10-01-19 */
d.isNullOrEmpty(e)||d.isNullOrEmpty(e.systemLanguage)||(a.userByUserId.systemLanguage=angular.fromJson(e.systemLanguage))}}]),angular.module("paripal.manageOrganisationLocationUser").service("orgLocClientListService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.searchOrgLocClient=function(e,f,g,h,i){d.isEmpty(e.organization)?(delete e.organization,e.organizationId=""):(e.organizationId=e.organization.data.id,delete e.organization),d.isEmpty(e.orgLocation)?(delete e.orgLocation,e.organizationLocationId=""):(e.organizationLocationId=e.orgLocation.data.id,delete e.orgLocation),d.isEmpty(f)||(e.userId=f.data.id),e.cityId="",e.districtId="",e.stateId="",e.countryId="",e.postalCode="",d.isEmpty(g)||(d.isEmpty(g.cityValue)||(e.cityId=g.cityValue.id),d.isEmpty(g.districtValue)||(e.districtId=g.districtValue.id),d.isEmpty(g.stateValue)||(e.stateId=g.stateValue.id),d.isEmpty(g.countryValue)||(e.countryId=g.countryValue.id),d.isEmpty(g.postalCode)||(e.postalCode=g.postalCode)),e.validFrom&&(e.validFrom=c.convertToServerDate(e.validFrom)),e.validTill&&(e.validTill=c.convertToServerDate(e.validTill)),e.whetherActive||(e.whetherActive=!1),a.postData(b.getUrl("SEARCH_ORG_LOC_CLIENT"),e,function(a){a.data&&a.data.data?h(a.data):i(a)},function(a){i(a)})},this.getOrgLocClientById=function(c,d,f){var g={};g.clientId=c,a.getData(b.getParameterizedUrl("GET_ORG_LOC_CLIENT_BY_ID",g),null,function(a){a&&a.data?(a.data.validFrom=e("timestampToDate")(a.data.validFrom,"MM/dd/yyyy"),a.data.validTill=e("timestampToDate")(a.data.validTill,"MM/dd/yyyy"),d(a.data)):f(a)},function(a){f(a)})},this.getFormsList=function(c,d,e){a.postData(b.getUrl("GET_LIST_OF_FORMS_TO_FILL"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDynamicFormsList=function(c,d,e){a.postData(b.getUrl("GET_LIST_OF_DYNAMIC_FORMS_TO_FILL"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.manageOrganisationLocationUser").controller("ManageOrgUserCtrl",["$scope","manageOrgUserService","$stateParams","$state","notify","$translate","orgUserListService","$rootScope","userStatusService","utilService","dateconvertor","baseService","fileOperations","urlService","otherDocumentService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.WSOrganizationUser={},a.userUpdateResponse="";a.WSOrganizationUser.orgLoc={},a.disabled=!1,a.signaturePic={},a.designation={},a.status={},a.status.ACTIVE="true",a.status.INACTIVE="false",a.status.selected="",a.orgUserPreferedContactModes=new Array,a.userData={},a.disabledModules={},a.manageUserSpinner=!1,a.signObject={},a.signObject.whetherSignatory=!1,a.$watch("userData.data",function(b){b&&b.id?(a.WSOrganizationUser.userByUserId={},a.WSOrganizationUser.userByUserId.userCode=b.userCode,a.WSOrganizationUser.userByUserId.id=b.id,a.WSOrganizationUser.userByUserId.firstName=b.firstName,a.WSOrganizationUser.userByUserId.middleName=b.middleName,a.WSOrganizationUser.userByUserId.lastName=b.lastName,a.WSOrganizationUser.officialCellNumber=b.cell1,a.WSOrganizationUser.officialEmailId=b.email1,a.WSOrganizationUser.officialDirectLandline=b.landline1,a.birthDate=k.convertToViewDate(b.birthDate),a.guardianCheck=b.hasGuardian,a.WSUserServiceOrganization={id:b.guardianId,value:b.guardianName}):b&&b===-1&&(a.userData={},a.WSOrganizationUser.userByUserId={},a.WSOrganizationUser.officialCellNumber="",a.WSOrganizationUser.officialEmailId="",a.WSOrganizationUser.officialDirectLandline="",a.birthDate=null,a.guardianCheck=!1,a.WSUserServiceOrganization={})},!0),a.$watch("WSOrganizationUser.orgLoc",function(b){b&&b.data.id&&"edit"===a.pageState&&a.changeOrgFun(a.WSOrganizationUser.orgLoc.data)},!0),a.changeOrgFun=function(c){c&&c.id&&b.loadModuleSubscription(c.id,function(b){b&&(a.disabledModules=b,a.disableModuleSelection())},function(a){})},a.disableModuleSelection=function(){0==a.disableServicesFlag&&(a.disableAppointement=a.disabledModules.disableAppointement,a.disableOnlineAdvice=a.disabledModules.disableOnlineAdvice,a.disableEmergency=a.disabledModules.disableEmergency,a.disabledUrgentClarification=a.disabledModules.disabledUrgentClarification,a.disableHomeVisit=a.disabledModules.disableHomeVisit,a.disableFrontOffice=a.disabledModules.disableFrontOffice,a.disableAccount=a.disabledModules.disableAccount,a.disabledNotify=a.disabledModules.disabledNotify,a.disabledAttachment=a.disabledModules.disabledAttachment)},a.WSOrganizationUser.whetherDoctor||a.WSOrganizationUser.whetherClinicalChiefDoctor||a.WSOrganizationUser.whetherOtherHealthSrvcPrfssnl||a.WSOrganizationUser.whetherSupportSrvcPrfssnl||(a.disableServicesFlag=!0,a.disableAppointement=!0,a.disableOnlineAdvice=!0,a.disabledUrgentClarification=!0,a.disableHomeVisit=!0,a.disableEmergency=!0),a.changeModuleSelection=function(){a.WSOrganizationUser.userByUserId&&(a.userData.id=a.WSOrganizationUser.userByUserId.id,a.userData.value=a.WSOrganizationUser.userByUserId.displayName),a.disableAppointement=!0,a.disableOnlineAdvice=!0,a.disabledUrgentClarification=!0,a.disableHomeVisit=!0,
// $scope.disableFrontOffice = true;
// $scope.disableAccount = true;
a.disableEmergency=!0,a.disableDoctor=!1,a.disableOtherHealthSrvcPrfssnl=!1,a.disablePharmacyUser=!1,a.disableSupportSrvcPrfssnl=!1,a.disableCounselor=!1,a.disableLabTechnician=!1,a.disabledCanConsult=!1,a.disableEmployee=!1,a.disableDriver=!1,a.disableServiceProviderAdmin=!1,a.WSOrganizationUser.whetherDoctor||a.WSOrganizationUser.whetherClinicalChiefDoctor||a.WSOrganizationUser.whetherOtherHealthSrvcPrfssnl||a.WSOrganizationUser.whetherSupportSrvcPrfssnl?(/* $scope.disableOtherHealthSrvcPrfssnl = true;
                $scope.disablePharmacyUser = true;
                $scope.disableSupportSrvcPrfssnl = true; */
a.disableAppointement=!1,a.disableOnlineAdvice=!1,a.disableEmergency=!1,a.disableHomeVisit=!1,a.disabledUrgentClarification=!1):(a.disableServicesFlag=!0,a.disableAppointement=!0,a.disableOnlineAdvice=!0,a.disabledUrgentClarification=!0,a.disableHomeVisit=!0,a.disableEmergency=!0,a.WSOrganizationUser.whetherAppointments=!1,a.WSOrganizationUser.whetherOnlineAdvice=!1,a.WSOrganizationUser.whetherEmergencyTransactions=!1,a.WSOrganizationUser.whetherUrgentClarifications=!1,a.WSOrganizationUser.whetherHomeVisit=!1),/* if ($scope.WSOrganizationUser.whetherOtherHealthSrvcPrfssnl) {
                $scope.disableDoctor = true;
                $scope.disableSupportSrvcPrfssnl = true;

                $scope.disableAppointement = false;
                $scope.disableOnlineAdvice = false;
                $scope.disableEmergency = false;
                $scope.disableHomeVisit = false;
                $scope.disabledUrgentClarification = false;
                $scope.disableDriver = true;
            }

            if ($scope.WSOrganizationUser.whetherSupportSrvcPrfssnl) {
                $scope.disableDoctor = true;
                $scope.disableDriver = true;
                $scope.disableOtherHealthSrvcPrfssnl = true;

                $scope.disableAppointement = false;
                $scope.disableOnlineAdvice = false;
                $scope.disableHomeVisit = false;
                $scope.disabledUrgentClarification = false;
            }

            if ($scope.WSOrganizationUser.whetherLabTechnician) {
                $scope.disableCounselor = true;
                $scope.disableDriver = true;
                $scope.disablePharmacyUser = true;

                $scope.disableHomeVisit = false;
            }

            if ($scope.WSOrganizationUser.whetherCounselor) {
                $scope.disableLabTechnician = true;
                $scope.disablePharmacyUser = true;
                $scope.disableDriver = true;


                $scope.disableAppointement = false;
                $scope.disableOnlineAdvice = false;
                $scope.disableHomeVisit = false;
                $scope.disabledUrgentClarification = false;
            }

            if ($scope.WSOrganizationUser.whetherPharmacyUser) {
                $scope.disableDoctor = true;
                $scope.disableCounselor = true;
                $scope.disableLabTechnician = true;
                $scope.disableDriver = true;
                $scope.disableOtherHealthSrvcPrfssnl = true;
                $scope.disableSupportSrvcPrfssnl = true;

            }
            if ($scope.WSOrganizationUser.whetherEmployee) {
                $scope.disabledCanConsult = true;
            }
            if ($scope.WSOrganizationUser.whetherCanConsultElsewhere) {
                $scope.disableEmployee = true;
            }

            if ($scope.WSOrganizationUser.whetherDriver) {
                $scope.disableDoctor = true;
                $scope.disableCounselor = true;
                $scope.disableLabTechnician = true;
                $scope.disableOtherHealthSrvcPrfssnl = true;
                $scope.disableSupportSrvcPrfssnl = true;
                $scope.disablePharmacyUser = true;
            }

            if (!$scope.WSOrganizationUser.whetherDoctor && !$scope.WSOrganizationUser.whetherOtherHealthSrvcPrfssnl && !$scope.WSOrganizationUser.whetherSupportSrvcPrfssnl && !$scope.WSOrganizationUser.whetherLabTechnician && !$scope.WSOrganizationUser.whetherCounselor && !$scope.WSOrganizationUser.whetherPharmacyUser) {
                $scope.disableAccount = false;
                $scope.disableFrontOffice = false;
            } */
"view"===a.pageState&&(a.disableAppointement=!0,a.disableOnlineAdvice=!0,a.disabledUrgentClarification=!0,a.disableHomeVisit=!0,a.disableFrontOffice=!0,a.disableAccount=!0,a.disableEmergency=!0,a.disableDoctor=!0,a.disableOtherHealthSrvcPrfssnl=!0,a.disablePharmacyUser=!0,a.disableSupportSrvcPrfssnl=!0,a.disableCounselor=!0,a.disableLabTechnician=!0,a.disabledCanConsult=!0,a.disableEmployee=!0,a.disableDriver=!0,a.disableServiceProviderAdmin=!0),a.disableModuleSelection()},a.setData=function(){if(a.disabled=!1,"view"===a.pageState&&(a.disabled=!0),"add"===a.pageState&&(a.WSOrganizationUser.whetherAccounts=!1,a.WSOrganizationUser.whetherAppointments=!1,a.WSOrganizationUser.whetherCanConsultElsewhere=!1,a.WSOrganizationUser.whetherCounselor=!1,a.WSOrganizationUser.whetherDoctor=!1,a.WSOrganizationUser.whetherEmergencyTransactions=!1,a.WSOrganizationUser.whetherEmployee=!1,a.WSOrganizationUser.whetherFrontOffice=!1,a.WSOrganizationUser.whetherHomeVisit=!1,a.WSOrganizationUser.whetherLabTechnician=!1,a.WSOrganizationUser.whetherNotifyNewRequests=!1,a.WSOrganizationUser.whetherOtherHealthSrvcPrfssnl=!1,a.WSOrganizationUser.whetherOnlineAdvice=!1,a.WSOrganizationUser.whetherPharmacyUser=!1,a.WSOrganizationUser.whetherPhoneAttachment=!1,a.WSOrganizationUser.whetherSupportSrvcPrfssnl=!1,a.WSOrganizationUser.whetherUrgentClarifications=!1,a.WSOrganizationUser.whetherClient=!1,a.WSOrganizationUser.whetherServiceProviderAdmin=!1,a.WSOrganizationUser.whetherDriver=!1),a.changeModuleSelection(),a.WSOrganizationUser.whetherActive?a.status.selected="true":a.status.selected="false",a.WSOrganizationUser.organizationLocation&&a.WSOrganizationUser.organizationLocation.id&&(a.WSOrganizationUser.orgLoc={},a.WSOrganizationUser.orgLoc.data={},a.WSOrganizationUser.orgLoc.data.id=a.WSOrganizationUser.organizationLocation.id,a.WSOrganizationUser.orgLoc.data.value=a.WSOrganizationUser.organizationLocation.value),a.WSOrganizationUser.appointmentLogicId&&a.WSOrganizationUser.appointmentLogicId.id&&(a.appLogicId=a.WSOrganizationUser.appointmentLogicId.id),a.WSOrganizationUser.orgUserPreferedContactModes){a.orgUserPreferedContactModes=new Array;for(var b=0;a.WSOrganizationUser.orgUserPreferedContactModes.length>b;b++)a.orgUserPreferedContactModes.push(a.WSOrganizationUser.orgUserPreferedContactModes[b].contactMode.id)}if(a.WSOrganizationUser.designation&&(a.designation.designationName=a.WSOrganizationUser.designation),a.WSOrganizationUser.whetherSignatory&&(a.signObject.whetherSignatory=a.WSOrganizationUser.whetherSignatory),a.WSOrganizationUser.signatureDocumentId&&a.WSOrganizationUser.signatureFileName){var c={};c.fileName=a.WSOrganizationUser.signatureFileName,c.resourceId=a.WSOrganizationUser.signatureDocumentId,c.docType="USER_ID_DOCUMENT",c.docSubType="SIGNATURE_PHOTO",c.documentForId=a.WSOrganizationUser.userByUserId.id,a.downloadSign(c)}else a.logoUrl="app/images/signature.png"},a.downloadSign=function(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.resourceId,c.docType=b.docType,c.docSubType=b.docSubType,c.documentForId=b.orgLocId,m.getImageUrl(c,function(b){a.logoUrl=b},function(a){})},a.manageOrgUser=function(){a.signaturePic.fileToBeUpload?a.saveDocument():a.manageOrgnizationUser()},a.saveFileDetailsToLocal=function(b){if(b){var c=b.name.split(".").pop();c=c.toLowerCase(),"jpg"===c||"jpeg"===c||"png"===c||"bmp"===c||"tif"===c?(a.signaturePic.fileToBeUpload=b,console.log(b)):e("Warning",f.instant("UPLOAD_VALID_FILE_TYPE"))}},a.manageOrgnizationUser=function(){h.showSpinner=!0,a.WSOrganizationUser.userByUserId.birthDate=k.convertToServerDate(a.birthDate),a.WSOrganizationUser.userByUserId.hasGuardian=a.guardianCheck,
// $scope.userData.data.guardian = $scope.WSUserServiceOrganization;
j.isFieldEmpty(a.WSUserServiceOrganization)||(a.WSUserServiceOrganization.id&&(a.WSOrganizationUser.userByUserId.guardianId=a.WSUserServiceOrganization.id),a.WSOrganizationUser.userByUserId.guardianName=a.WSUserServiceOrganization.value);/*if ((!utilService.isFieldEmpty($scope.userData.data)) && (!utilService.isFieldEmpty($scope.userData.data.guardian))) {
    $scope.WSOrganizationUser.userByUserId.guardianId = $scope.userData.data.guardian.id;
    $scope.WSOrganizationUser.userByUserId.guardianName = $scope.userData.data.guardian.value;
}*/
var c={whetherSignatory:a.signObject.whetherSignatory};c.designation=a.designation.designationName,a.signResourceId&&(c.signatureDocumentId=a.signResourceId),a.signFileName&&(c.signatureFileName=a.signFileName),b.updateUser(a.WSOrganizationUser,a.userData,a.pageState,a.orgUserPreferedContactModes,a.contactModes,function(b){h.showSpinner=!1,a.userUpdateResponse=b,"add"===a.pageState&&e("success",f.instant("ORGANIZATION_USER_ADDED_SUCCESSFULLY")),"edit"===a.pageState&&e("success",f.instant("ORGANIZATION_USER_UPDETED_SUCCESSFULLY")),d.go("orglocuserlist",{type:""})},function(b){h.showSpinner=!1,a.userUpdateResponse=b},c)},a.cancel=function(){j.goBackToPrevState()},a.uploadFile=function(b,c){var d=new Object;d.file=a.signaturePic.fileToBeUpload,j.isNullOrEmpty(a.signaturePic)||j.isNullOrEmpty(a.signaturePic.fileToBeUpload)||(d.docType="USER_ID_DOCUMENT",d.docSubType="SIGNATURE_PHOTO"),
//paramObject.orgLocId = $scope.WSOrganizationLocation.id;
c.response&&(d.resourceId=c.response),m.uploadFile(d,function(b){if(!j.isNullOrEmpty(a.signaturePic)&&!j.isNullOrEmpty(a.signaturePic.fileToBeUpload)){var c=(n.getUrl("SAVE_DOCUMENT_DETAILS"),new Object);c.documentType={type:"USER_ID_DOCUMENT",subType:"SIGNATURE_PHOTO"},c.fileName=a.signaturePic.fileToBeUpload.name,c.fileSize=a.signaturePic.fileToBeUpload.size,j.isNullOrEmpty(c)||j.isNullOrEmpty(c.fileSize)||j.isNullOrEmpty(c.fileName)||(
//requestObject.organizationLocationId = $scope.WSOrganizationLocation.id;
c.documentResourceType={type:"Image"})}a.manageOrgnizationUser()},function(a){e("Error",f.instant("ERROR_WHILE_UPLOADING"))})},a.saveDocument=function(){var b=n.getUrl("SAVE_DOCUMENT_DETAILS"),c=new Object;c.documentType={type:"USER_ID_DOCUMENT",subType:"SIGNATURE_PHOTO"},j.isNullOrEmpty(a.signaturePic)||j.isNullOrEmpty(a.signaturePic.fileToBeUpload)||j.isNullOrEmpty(a.signaturePic.fileToBeUpload.name)||(c.fileName=a.signaturePic.fileToBeUpload.name,a.signFileName=a.signaturePic.fileToBeUpload.name),j.isNullOrEmpty(a.signaturePic)||j.isNullOrEmpty(a.signaturePic.fileToBeUpload)||j.isNullOrEmpty(a.signaturePic.fileToBeUpload.size)||(c.fileSize=a.signaturePic.fileToBeUpload.size),j.isNullOrEmpty(c)||j.isNullOrEmpty(c.fileSize)||j.isNullOrEmpty(c.fileName)||(c.documentResourceType={type:"Image"}),c.documentForId=a.WSOrganizationUser.userByUserId.id,c.documentResourceType={id:4},o.saveDocumentDetails(c,b,!1,function(b){a.signResourceId=b.response,a.uploadFile(a.signaturePic,b)},function(a){e("Error",f.instant("ERROR_WHILE_UPLOADING"))})},a.init=function(){if(a.manageUserSpinner=!0,b.loadContactMode(function(b){a.manageUserSpinner=!1,a.contactModes=b,"add"===c.type&&angular.forEach(a.contactModes,function(b,c){"EMAIL"!=b.code&&"SMS"!=b.code&&"SYSTEN NOTIFICATIONS"!=b.code||a.orgUserPreferedContactModes.push(b.id)})},function(b){a.manageUserSpinner=!1}),"add"===c.type?(a.pageState="add",a.setData()):"edit"===c.type?a.pageState="edit":"view"===c.type&&(a.pageState="view"),i.isUserLoggedIn()&&!i.isOrgUser()?a.hideFormFields=!0:a.hideFormFields=!1,c.data?(a.WSOrganizationUser=c.data,a.birthDate=k.convertToViewDate(a.WSOrganizationUser.userByUserId.birthDate),a.guardianCheck=a.WSOrganizationUser.userByUserId.hasGuardian,(a.WSOrganizationUser.userByUserId.guardianId||a.WSOrganizationUser.userByUserId.guardianName)&&(a.WSUserServiceOrganization={id:a.WSOrganizationUser.userByUserId.guardianId,value:a.WSOrganizationUser.userByUserId.guardianName}),a.setData()):c.orgUserId&&g.getUserById(c.orgUserId,function(b){a.manageUserSpinner=!1,a.WSOrganizationUser=b,a.setData()},function(b){a.manageUserSpinner=!1,a.error=b,e("error",f.instant("ORG_USER_FETCH_FAILURE"))}),"add"===a.pageState){var d=l.getDefaultOrgLocation();j.isFieldEmpty(d)||(a.WSOrganizationUser.orgLoc={data:d.orgLoc},a.changeOrgFun(a.WSOrganizationUser.orgLoc.data))}},a.init()}]),angular.module("paripal.manageOrganisationLocationUser").controller("OrgUserCardCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","baseService","orgUserListService","notify","$translate","serverSidePagination","manageProfessionalSummaryService","utilService","statePersistenceService","NgMap","$timeout","httpService","urlService","SearchHospitalService","commonConstants","commonCalendarService","manageRequestService","$mdDialog","GoogleMap","GeoCoder","storageService","$window","fileOperations","$log","$filter","baseConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D){"use strict";function E(a,b,c){a.services=c,a.cancel=function(){b.hide()}}function F(a){var c={};c.appointmentIds=[];for(var e=0,f=a.appointmentSlots.length;e<f;e++)if(a.appointmentSlots[e].userId==b.loggedInUserDetails.id){c.appointmentIds.push(a.appointmentSlots[e].appointmentId),c.apptDate=a.appointmentSlots[e].apptDate;break}var g=v.confirm().title(i.instant("APPOINTMENT_CANCELATION_TITLE")).textContent(i.instant("APPOINTMENT_CANCELATION_MSG")).ok(i.instant("OK")).cancel(i.instant("CANCEL"));v.show(g).then(function(){t.cancelAppointment(c,function(a){h("success",a.successMessage),d.reload()},function(a){})})}function G(c,d){var e={calendarId:c.calendarId,entityTypeCode:"CAL_ORGANIZATION_USER",entityId:c.userId};null!=d?(e.startDate=d.split("-").reverse().join("-"),e.endDate=d.split("-").reverse().join("-")):(e.startDate=new Date,e.endDate=new Date),b.showSpinner=!0,t.getCalendarDetailsByIdForCardView(e,function(c){console.log(c),
//$scope.slotBasedTimeSlots = [];
//$scope.FCFSBasedTimeSlots = [];
// angular.forEach(successResponse, function (v, k) {
//     $scope.viewLogo(v);
// });
angular.forEach(c.events,function(c,d){"FCFS"==c.appointmentType&&angular.forEach(c.eventSlots[0].appointmentSlots,function(c,d){c.userId==b.loggedInUserDetails.id&&(a.addColorChanges=!0)})}),a.showTimeSlots=c,b.showSpinner=!1,console.log(a.showTimeSlots.events[0].eventSlots)},function(a){b.showSpinner=!1})}function H(a,c,d,e,f,g,j,k,m){a.requestType=d,a.cancel=function(){c.cancel()},a.getTreatmentType=function(b){var c;return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,"REQ_ONLINE_ADVICE"!=d&&"REQ_URGENT_CLARIFICATION"!=d||(c="TREATMENT_TYPE"),p.getData(q.getParameterizedUrl(c,a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SERACH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.getOnBehalfOf=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d;
//var url='GET_PATIENTS_LIST_BY_SEACRH_KEY';
return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),p.getData(q.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,b.data&&0==b.data.length&&h("error",i.instant("INVALID_USER")),a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},a.saveRequest=function(){b.showSpinner=!0,a.createRequest.requestDate=j("date")(new Date,"yyyy-MM-dd");var d=k.getLoggedInUser();a.createRequest.initiator={id:d.id,value:d.displayName},a.createRequest.requestStatus=f,a.createRequest.requestsType=g,a.createRequest.broadcast=!1,a.createRequest.organization={id:m.locationId,value:m.locationName},a.createRequest.healthProfessional={id:m.id,value:m.userName},e.save(a.createRequest,function(a){b.showSpinner=!1,h("success",i.instant("MSG_WITH_REQUEST_ID")+a.response.requestId),c.cancel()},function(a){b.showSpinner=!1})}}E.$inject=["$scope","$mdDialog","services"],H.$inject=["$scope","$mdDialog","requestType","manageRequestService","requestStatus","requestsType","$filter","baseService","selectedUser"],a.commonConstants=s,a.currentPage=1,a.itemPerPage=10,a.currentLocation="current-location",a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.doctorsNearMe=!0,a.currentDocPage=1,a.itemPerPageForDoc=10,a.startRecordForDoc=(a.currentDocPage-1)*a.itemPerPageForDoc+1,a.endRecordForDoc=a.itemPerPageForDoc,a.getEventSlotTime=G,a.docPagingInfo={},angular.fromJson(localStorage.whetherParipalAsSubdomain)&&(a.hideFilterElements=!0),a.professionalTypes=[{id:"SUPPORT_PROFESSIONAL",value:"SUPPORT_SERVICE_PROFESSIONAL"},{id:"HEALTH_PROFESSIONAL",value:"HEALTH_SERVICE_PRO"}],a.fromHomeView=!1,l.isNullOrEmpty(c.fromHomeView)||"true"!=c.fromHomeView?a.fromHomeView=!1:a.fromHomeView=!0,a.org={},a.orgLoc={},a.userList=[],a.WSUserSearchCriteria={},a.error={},a.filterCriteria={},a.error={},a.addressInfo={},a.addressInfoFilter={},a.filterCriteria.org={},a.filterCriteria.orgLoc={},a.status={},a.status.AND="true",a.status.OR="false",a.userlistSpinner=!1,a.userListPageSpinner=!1,a.filterCriteria.radius=2e4,a.filterCriteria.slider=20,a.mapVisibility="hide-map",a.isMapVisible=!1,a.newDate=new Date,a.cancelAppt=F,
//$scope.presentDate = $filter('date')($scope.newDate, 'dd-MM-yyyy')
a.presentDate=C("date")(a.newDate,"yyyy-MM-dd"),a.currentTime=a.newDate.getHours()+":"+a.newDate.getMinutes()+":"+a.newDate.getSeconds(),n.getMap().then(function(b){o(function(){a.map=b},0),b.addListener("zoom_changed",function(){12!==b.getZoom()&&a.whetherSetToDefalut&&(a.whetherSetToDefalut=!1,b.setZoom(12))})}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.changeRadius=function(){a.filterCriteria.radius=angular.copy(1e3*a.filterCriteria.slider)},l.isEmpty(f.getLoggedInUser())||(a.loggedInUser=f.getLoggedInUser().id),a.getCityNameData=function(b){return a.requestData={},a.requestData.searchString=b,a.requestData.noOfSuggestions=s.smartSearchRecordLimit,a.userNameAutoCmpLoading=!0,p.getData(q.getParameterizedUrl("GET_CITY_DISTRICT_BY_STRING",a.requestData),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.showLocalDoctors=function(b){0==b&&(delete a.filterCriteria.cityDistrict,delete a.WSUserSearchCriteria.cityDistrict)},/* changes for card view START */
a.changeCardRadius=function(){a.filterCriteria.radius=angular.copy(1e3*a.filterCriteria.slider),a.searchUsers()},a.getUserStatus=function(a){var b="";return angular.forEach(a,function(a,c){b=0==c?a:b+","+a}),b},a.getUserTreatmentTypes=function(a){var b="";return angular.forEach(a,function(a,c){b=0==c?a.value:b+","+a.value}),b},a.getDirections=function(b){if(!l.isNullOrEmpty(b)&&!l.isNullOrEmpty(a.currentLocation))var c=a.currentLocation,d=b;var e=!!window.cordova;e?window.location.href="https://www.google.com/maps/search/?api=1&query="+d:z.open("http://maps.google.com/maps?saddr="+c+"&daddr="+d,"_blank")},a.viewLogo=function(a){if(a.logoDocumentId){var b=new Object;b.fileName=a.logoFileName,b.resourceId=a.logoDocumentId,b.docType=s.documentTypes.userIdDocument,b.docSubType=s.documentSubTypes.profilePhoto,b.userId=a.userId,A.getImageUrl(b,function(b){a.logoUrl=b},function(){})}else a.logoUrl=D.readJsonFileUrl+"app/images/user.jpg"},a.showServices=function(a){var a=a;v.show({controller:E,templateUrl:"app/modules/manage-organisation-location-users/views/show-services-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{services:a}})},/* changes for card view END */
a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=q.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return p.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getProfessionalTypes=function(){a.professionalTypesData=[],a.professionalSubTypeData=[],a.filterCriteria.specializationId=null,a.filterCriteria.subSpecializationId=null;var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=q.getUrl("GET_HEALTH_PROFESSIONAL_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=q.getUrl("GET_SUPPORT_PROFESSIONAL_TYPES")),p.getData(b,null,function(b){a.professionalTypesData=angular.fromJson(b.data)},function(){})},a.getProfessionalSubType=function(){var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=q.getUrl("GET_HEALTH_PROFESSIONAL_SUB_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=q.getUrl("GET_SUPPORT_PROFESSIONAL_SUB_TYPES")),b+=a.filterCriteria.specializationId.id,p.getData(b,null,function(b){a.professionalSubTypeData=angular.fromJson(b.data)},function(){})},a.getDiseaseVariant=function(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.filterCriteria.disease.id,a.diseaseVariantLoad=!0,p.getData(q.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||h("error",i.instant(b.data.messages[0]))})},a.getSymptom=function(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,p.getData(q.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SEARCH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",p.getData(q.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",p.getData(q.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.searchUsers=function(){b.showSpinner=!0,1==a.isMapVisible?/*delete $scope.WSUserSearchCriteria.slider;*/
g.searchUsersForMap(a.WSUserSearchCriteria,a.addressInfo,a.org,a.orgLoc,function(c){b.showSpinner=!1,a.organizationLocationsList=c;var d=c;a.orgMapArray=[],a.orgMapArray.push(a.currentLocationObject),a.WSUserSearchCriteria.whetherAllStatus&&a.WSUserSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus=!0:a.filterCriteria.whetherAllStatus=!1,delete a.filterCriteria.organizationId;for(var e=0;e<d.length;e++)l.isFieldEmpty(d[e].addressLattitudes)||l.isFieldEmpty(d[e].addressLongitudes)||(d[e].location=[d[e].addressLattitudes,d[e].addressLongitudes],d[e].isDraggable=!1,d[e].organizationTypeIcon=a.iconsList.ICONS[d[e].organizationTypeIconsEnum],d[e].isSelected=!1,d[e].id=d[e].locationId,null!=d[e].organizationLocationAddressId&&a.orgMapArray.push(d[e]));l.isFieldEmpty(d)&&(a.orgMapArray=[],a.orgMapArray.push(a.currentLocationObject))},function(a){b.showSpinner=!1}):(a.WSUserSearchCriteria.pageNumber=a.currentPage,a.WSUserSearchCriteria.recordsPerPage=a.itemPerPage,delete a.WSUserSearchCriteria.slider,a.WSUserSearchCriteria.radius=angular.copy(a.filterCriteria.radius/1e3),l.isNullOrEmpty(a.filterCriteria.cityDistrict)||(a.WSUserSearchCriteria.cityDistrict=a.filterCriteria.cityDistrict),/*delete $scope.WSUserSearchCriteria.radius;*/
g.searchUserCards(a.WSUserSearchCriteria,a.addressInfo,a.org,a.orgLoc,function(c){b.showSpinner=!1,a.userlistSpinner=!1,a.userList=c.data,o(function(){$("*[class*=showUpload]").hide(),$("*[class*=showNoRecords]").hide()},1e3),angular.forEach(a.userList,function(b,c){a.viewLogo(b)}),/*$scope.viewLogo($scope.userList.logoDocumentId, $scope.userList.logoFileName);*/
a.totalItems=c.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.WSUserSearchCriteria.whetherAllStatus&&a.WSUserSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus=!0:a.filterCriteria.whetherAllStatus=!1},function(c){b.showSpinner=!1,a.userlistSpinner=!1,a.error=c,a.userList=null,a.currentPage=1,a.totalItems=0,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)}))},a.fetchRecords=function(b){b&&I(),!l.isNullOrEmpty(a.filterCriteria)&&l.isNullOrEmpty(a.filterCriteria.symptom)&&delete a.filterCriteria.symptom,angular.copy(a.filterCriteria,a.WSUserSearchCriteria),a.WSUserSearchCriteria.radius?a.WSUserSearchCriteria.radius=a.WSUserSearchCriteria.radius/1e3:(a.WSUserSearchCriteria.radius=20,a.filterCriteria.slider=20),l.isFieldEmpty(a.WSUserSearchCriteria.organization)||(a.WSUserSearchCriteria.organizationId=a.WSUserSearchCriteria.organization.data.id),delete a.WSUserSearchCriteria.organization,/*if (!$scope.isMapVisible) {
                delete $scope.WSUserSearchCriteria.radius;
            }*/
a.addressInfo=a.addressInfoFilter,a.orgType=a.orgTypeFilter;var c="";l.isFieldEmpty(a.addressInfo.cityValue)?l.isFieldEmpty(a.addressInfo.city)?"undefined"!=typeof a.WSUserSearchCriteria.cityDistrict&&""!=a.WSUserSearchCriteria.cityDistrict&&(c+=a.WSUserSearchCriteria.cityDistrict.cityDistrict.split("-")[0]):c+=a.addressInfo.city.value:c+=a.addressInfo.cityValue.value,l.isFieldEmpty(a.addressInfo.postalCode)||(c=l.isFieldEmpty(c)?a.addressInfo.postalCode.toString():c+" "+a.addressInfo.postalCode),l.isFieldEmpty(c)?a.searchUsers():(a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=c),x.geocode({address:c}).then(function(b){a.currentLocation=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.filterCriteria.addressLattitudes=b[0].geometry.location.lat(),a.filterCriteria.addressLongitudes=b[0].geometry.location.lng(),a.WSUserSearchCriteria.addressLattitudes=b[0].geometry.location.lat(),a.WSUserSearchCriteria.addressLongitudes=b[0].geometry.location.lng(),a.currentLocationObject.location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()]),a.searchUsers()}))};/* To assign null if statuses-chip-component return any false property */
var I=function(){var b=a.filterCriteria,c={};angular.forEach(b,function(a,b){"boolean"==typeof a?c[b]="whetherAllStatus"!=b&&0==a?null:a:c[b]=a}),a.filterCriteria=c};a.selectHospital=function(b,c){a.hospitalSelected=!0,a.selectedId=c.id,a.showDoctors(c.locationId),a.hideDetail()},a.showDoctors=function(c){b.showSpinner=!0;var d=angular.copy(a.WSUserSearchCriteria);d.pageNumber=a.currentDocPage,d.recordsPerPage=a.itemPerPageForDoc,d.organizationLocationId=c,a.selectedLocationId=c,delete d.radius,g.searchUsers(d,a.addressInfo,null,c,function(c){b.showSpinner=!1,a.locationUserList=c.data,a.totalItemsForDoc=c.totalRecords,a.docPagingInfo=j(a.currentDocPage,a.itemPerPageForDoc,a.totalItemsForDoc)},function(a){b.showSpinner=!1})},a.unconfirm=function(){a.selectedId=null,a.selectedAddress=null,a.map.hideInfoWindow("bar"),a.destination=null},a.hideDetail=function(){"calledFromEmergencyTransaction"!==c.type?a.map.hideInfoWindow("foo-iw"):"changeEmergencyLocation"!==c.caller?a.map.hideInfoWindow("foo-iw"):0!==a.address.organizationLocationAddressId&&a.map.hideInfoWindow("foo-iw")},a.fixAppointment=function(a,b,c){return c.isBooked?void h("Alert",i.instant("Appointment already booked")):void v.show({controller:"QuickFixAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/fix-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{fixApptObj:{appointmentEnd:c.endTime,type:"add",appointmentId:"null",slotId:c.id,entityType:a.entityType,entityName:{id:a.entityId,value:a.entityName},eventType:b.eventType,eventName:{id:b.id,value:b.title},apptDate:c.slotDate,apptStartTime:c.startTime,apptEndTime:c.endTime,eventExceptionId:"null"}}}).then(function(a){d.reload()},function(){})},a.fixAppointmentFCFS=function(c,e,f){
// if(boookingDetails.isBooked){
//     notify("Alert", $translate.instant("Appointment already booked"));
//     return;
// }
return 0==f.capacityRemaining?void h("Alert",i.instant("No Available Slots For This Timing")):(null!=f.appointmentSlots&&f.appointmentSlots.length>0?angular.forEach(f.appointmentSlots,function(c,d){
//notify("Alert", $translate.instant("Appointment already booked"));
return c.userId==b.loggedInUserDetails.id?(F(f),void(a.canProceedBooking=!1)):void(a.canProceedBooking=!0)}):v.show({controller:"QuickFixAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/fix-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{fixApptObj:{appointmentEnd:f.endTime,type:"add",appointmentId:"null",slotId:f.id,entityType:c.entityType,entityName:{id:c.entityId,value:c.entityName},eventType:e.eventType,eventName:{id:e.id,value:e.title},apptDate:f.slotDate,apptStartTime:f.startTime,apptEndTime:f.endTime,eventExceptionId:"null"}}}).then(function(a){d.reload()},function(){}),a.canProceedBooking?void v.show({controller:"QuickFixAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/fix-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{fixApptObj:{appointmentEnd:f.endTime,type:"add",appointmentId:"null",slotId:f.id,entityType:c.entityType,entityName:{id:c.entityId,value:c.entityName},eventType:e.eventType,eventName:{id:e.id,value:e.title},apptDate:f.slotDate,apptStartTime:f.startTime,apptEndTime:f.endTime,eventExceptionId:"null"}}}).then(function(a){d.reload()},function(){}):null)},
//booking appointment
a.showUploadDownload=function(c,d){if(a.showUpload)a.showUpload=!a.showUpload,$("*[class*=showUpload]").hide(),$("*[class*=showNoRecords]").hide();else
// $('.showUpload' + row.id).show();
if(a.showUpload=!0,localStorage.setItem("apptOpenTab","showUpload"),localStorage.setItem("apptOpenTabRow",JSON.stringify(c)),c.calendarId){b.showSpinner=!0;var e={calendarId:c.calendarId,entityTypeCode:"CAL_ORGANIZATION_USER",entityId:c.userId};null!=d?(e.startDate=d,e.endDate=d):(e.startDate=new Date,
//calendarRequestObj.endDate = new Date(new Date().setDate(new Date().getDate() + 7));
e.endDate=new Date),t.getCalendarDetailsByIdForCardView(e,function(d){d&&d.events.length>0?(angular.forEach(d.events,function(c,d){"FCFS"==c.appointmentType&&angular.forEach(c.eventSlots[0].appointmentSlots,function(c,d){c.userId==b.loggedInUserDetails.id&&(a.addColorChanges=!0)})}),a.showTimeSlots=d,$(".showUpload"+c.id).show()):($(".showUpload"+c.id).hide(),$(".showNoRecords"+c.id).show()),b.showSpinner=!1},function(a){b.showSpinner=!1})}},a.next=function(b){a.selectedIndex<6&&a.selectedIndex++},a.back=function(){a.selectedIndex<6&&a.selectedIndex++},
// $scope.appendDateArray = function(start, end) {
//   var
//     arr = new Array(),
//     //start
//     dt = start;
//     //end
//   while (dt <= new Date(new Date().setDate(new Date().getDate() + 6))) {
//     //while (dt <= new Date(new Date(end))) {
//     $scope.dateArray.push($filter('date')(new Date(dt), 'dd-MM-yyyy'));
//     dt.setDate(dt.getDate() + 1);
//   }
//   console.log($scope.dateArray);
//   //$scope.dateArray = arr;
//   //return arr;
// };
a.getDateArray=function(b,c){for(var d=new Array,e=new Date;e<=new Date((new Date).setDate((new Date).getDate()+30));)d.push(C("date")(new Date(e),"dd-MM-yyyy")),e.setDate(e.getDate()+1);return console.log(d),a.dateArray=d,d},a.getDateArray();var J=a.dateArray,K=null,L=null;a.tabs=J,a.selectedIndex=0,a.$watch("selectedIndex",function(a,b){L=K,K=J[a]}),a.viewCalendar=function(c){if(c.calendarId){b.showSpinner=!0;var d={calendarId:c.calendarId,entityTypeCode:"CAL_ORGANIZATION_USER",entityId:c.userId};t.getCalendarDetailsById(d,function(b){a.getDateArray(b.startDate,b.endDate)},function(a){b.showSpinner=!1})}else b.showSpinner=!1},a.showDetails=function(b,c){a.address=c,c.organizationLocationAddressId&&a.map.showInfoWindow("foo-iw","id_"+c.locationId),a.map.hideInfoWindow("bar"),c.locationId!==a.selectedId};var M=function(b){p.getJsonData(q.getJsonFileUrl("ORGANIZATION_TYPE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),N())},function(a){})},N=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){O(b.coords.latitude,b.coords.longitude,!0)})},function(a){w.getUsersCoordinates(a,function(a){O(a.coords.latitude,a.coords.longitude,!0)})})},O=function(b,c){a.filterCriteria.addressLattitudes=b,a.filterCriteria.addressLongitudes=c;var d={latLng:new google.maps.LatLng(b,c)};a.changeLocation(d),a.organizationLocationsList=[],a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,organizationLocationName:"You are here",locationId:0,id:0},a.organizationLocationsList.push(a.currentLocationObject),a.init()};a.changeLocation=function(b){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filterCriteria.addressLattitudes=b.latLng.lat(),a.filterCriteria.addressLongitudes=b.latLng.lng(),a.currentLocationObject={location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes]},a.locationChanged=!0,r.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,addressLattitudes:b.latLng.lat(),addressLongitudes:b.latLng.lng()}}),a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,locationId:0,id:0,organizationLocationName:"You dragged here"},!l.isFieldEmpty(c.wallData)&&l.isFieldEmpty(c.wallData.organization)?a.fetchRecords():l.isFieldEmpty(c.wallData)&&a.fetchRecords()},a.manageMsgSubscription=function(a,b){d.go("manageEventSubscription",{user:{id:a,displayName:b}})},/*$scope.fetchRecords = function () {
            angular.copy($scope.filterCriteria, $scope.WSUserSearchCriteria);
            $scope.addressInfo = $scope.addressInfoFilter;
            $scope.searchUsers();
        };*/
a.clear=function(){a.WSUserSearchCriteria={},a.addressInfo={},a.org={},a.orgLoc={},a.filterCriteria={},a.addressInfoFilter={},a.$broadcast("clearStatusData"),a.$broadcast("clearPicklistData"),a.$broadcast("clearAddressData"),a.WSUserSearchCriteria.radius=2e4,M()},
//Add new Organisation
a.addNewUser=function(){d.go("manageorglocuser",{type:"add"})},a.showUserAddressList=function(a,b,c,e){var f={navigateFrom:"orglocuserlist",userAddressId:null,userId:a,userCode:b,userName:c};d.go("userAddressList",f)},a.requestForUrgentClarification=function(c){b.showSpinner=!0,a.selectedUser=c,a.type="REQ_URGENT_CLARIFICATION";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_URGENT_CLARIFICATION",u.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",u.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.requestForOnlineAppointment=function(c){b.showSpinner=!0,a.selectedUser=c,a.type="REQ_ONLINE_ADVICE";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_ONLINE_ADVICE",u.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",u.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.getStars=function(a){
// Get the value
var b=parseFloat(a),c=b/5*100;return c+"%"},a.openPopup=function(){v.show({controller:H,templateUrl:"app/modules/manage-organisation-locations/views/create-request-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{requestType:a.type,manageRequestService:u,requestStatus:a.requestStatus,requestsType:a.requestsType,baseService:f,selectedUser:a.selectedUser}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.manageProfessionalWall=function(a){d.go("professionalwall",{callingUrl:"orgLocUsers",userData:a})},a.getUserProfessionalTreatmentTypes=function(a,b,c,e){var f=!1,g=c.indexOf("Other Health Service Professional")>-1;//"Other Health Service Professional", "Support Service Professional"
g&&(f=!0),d.go("professionalTreatmentList",{type:null,user:{id:a,userName:b,userType:f?"H":"S",whetherHealthProfessional:f}})},a.getUserDiseaseVariantLinked=function(a,b,c,e){d.go("diseaseVariantLinkedList",{type:null,professional:{id:a,userName:b,userType:"H"}})},a.getMonthlyDiseaseVariantLinked=function(a,b,c,e){d.go("monthlyDiseaseVariantLinkedStatastics",{type:null,professional:{id:a,userName:b,userType:"H"}})},
//Edit new User
a.getOrgnizationUser=function(c,e){b.showSpinner=!0,g.getUserById(c,function(a){b.showSpinner=!1;var f=a;d.go("manageorglocuser",{type:e,data:f,orgUserId:c})},function(c){b.showSpinner=!1,a.error=c,h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},
//This function is use to view Health Support Professional Service
a.viewHealthSupportProfessional=function(c,e,f){b.showSpinner=!0,k.getProfessionalSummaryData(c,e,function(a){b.showSpinner=!1;var g=a;d.go("manageProfessionalSummary",{type:e,data:g,orgUserId:c,mode:f})},function(c){b.showSpinner=!1,a.error=c})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()},a.pageChangedForDoc=function(){a.docPagingInfo=j(a.currentDocPage,a.itemPerPageForDoc,a.totalItemsForDoc),a.showDoctors(a.selectedLocationId)},a.setMaxRecordsForDoc=function(b){a.currentDocPage=1,a.itemPerPageForDoc=b,a.showDoctors(a.selectedLocationId)};
//datatble config json
var P={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(P),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.isMapVisible=!1,a.buttonText=i.instant("SHOW_MAP"),a.mapVisibility="hide-map",a.getSpecializations(),a.getSubbranch(),l.isFieldEmpty(c.wallData)?c.organization&&c.orgLocation&&(a.filterCriteria.org.data=c.organization,a.filterCriteria.orgLoc.data=c.orgLocation):(l.isFieldEmpty(c.wallData.organization)||(a.org.data=c.wallData.organization,a.filterCriteria.org.data=c.wallData.organization,a.filterCriteria.orgLoc.data=c.wallData.orglocation,a.fetchRecords()),l.isFieldEmpty(c.wallData.orglocation)||(a.orgLoc.data=c.wallData.orglocation),l.isFieldEmpty(c.wallData.type)||"healthProfessional"===c.wallData.type||("supportServiceProfessional"===c.wallData.type?a.filterCriteria.whetherSupportSrvcPrfssnl=!0:"professionalwall"===c.wallData.type&&(a.fromProfessionalWall=!0,a.filterCriteria.userName=c.wallData.userName,"SUMMARY"===c.wallData.subType&&(a.whetherSummary=!0)))),/*$scope.fetchRecords();*/
a.locationConsolidatedPrivileges=y.getLocationConsolidatedPrivileges(),a.locationConsolidatedPrivileges&&(a.locationConsolidatedPrivileges.indexOf("organization_user_edit")&&b.loggedInUserDetails.isOrganizationUserMode?a.fwdPageState="edit":a.fwdPageState="view"),$("*[class*=showUpload]").hide(),
//Added this for menu issue for whetherParipalAsSubdomain
"true"==localStorage.whetherParipalAsSubdomain&&("true"==localStorage.whetherReload||o(function(){localStorage.setItem("whetherReload",!0),console.log("reloaded successfuly"),z.location.reload()},200)),a.searchUsers()},M(),a.myUpcommingAppts=function(){d.go("individualAppointmentsList",{fromHomeView:"upcoming"})},a.toggleMap=function(){/*$state.reload();*/
a.isMapVisible=!a.isMapVisible,1==a.isMapVisible?(a.buttonText=i.instant("SHOW_LIST"),a.mapVisibility="show-map"):(a.buttonText=i.instant("SHOW_MAP"),a.mapVisibility="hide-map"),l.isFieldEmpty(c.wallData)||(l.isFieldEmpty(c.wallData.organization)||(a.org.data=c.wallData.organization),l.isFieldEmpty(c.wallData.orglocation)||(a.orgLoc.data=c.wallData.orglocation),l.isFieldEmpty(c.wallData.type)||"healthProfessional"===c.wallData.type||("supportServiceProfessional"===c.wallData.type?a.filterCriteria.whetherSupportSrvcPrfssnl=!0:"professionalwall"===c.wallData.type&&(a.fromProfessionalWall=!0,a.filterCriteria.userName=c.wallData.userName,"SUMMARY"===c.wallData.subType&&(a.whetherSummary=!0)))),a.fetchRecords()}}]),angular.module("paripal.manageOrganisationLocationUser").controller("OrgUserListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","baseService","orgUserListService","notify","$translate","serverSidePagination","manageProfessionalSummaryService","utilService","statePersistenceService","NgMap","$timeout","httpService","urlService","SearchHospitalService","commonConstants","commonCalendarService","manageRequestService","$mdDialog","GoogleMap","GeoCoder",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";function y(a,c,d,e,f,g,j,k,m){a.requestType=d,a.cancel=function(){c.cancel()},a.getTreatmentType=function(b){var c;return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,"REQ_ONLINE_ADVICE"!=d&&"REQ_URGENT_CLARIFICATION"!=d||(c="TREATMENT_TYPE"),p.getData(q.getParameterizedUrl(c,a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SERACH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.getOnBehalfOf=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d;
//var url='GET_PATIENTS_LIST_BY_SEACRH_KEY';
return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),p.getData(q.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,b.data&&0==b.data.length&&h("error",i.instant("INVALID_USER")),a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},a.saveRequest=function(){b.showSpinner=!0,a.createRequest.requestDate=j("date")(new Date,"yyyy-MM-dd");var d=k.getLoggedInUser();a.createRequest.initiator={id:d.id,value:d.displayName},a.createRequest.requestStatus=f,a.createRequest.requestsType=g,a.createRequest.broadcast=!1,a.createRequest.organization={id:m.locationId,value:m.locationName},a.createRequest.healthProfessional={id:m.id,value:m.userName},e.save(a.createRequest,function(a){b.showSpinner=!1,h("success",i.instant("MSG_WITH_REQUEST_ID")+a.response.requestId),c.cancel()},function(a){b.showSpinner=!1})}}y.$inject=["$scope","$mdDialog","requestType","manageRequestService","requestStatus","requestsType","$filter","baseService","selectedUser"],a.commonConstants=s,a.currentPage=1,a.itemPerPage=10,a.currentLocation="current-location",a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.currentDocPage=1,a.itemPerPageForDoc=10,a.startRecordForDoc=(a.currentDocPage-1)*a.itemPerPageForDoc+1,a.endRecordForDoc=a.itemPerPageForDoc,a.docPagingInfo={},a.professionalTypes=[{id:"SUPPORT_PROFESSIONAL",value:"SUPPORT_SERVICE_PROFESSIONAL"},{id:"HEALTH_PROFESSIONAL",value:"HEALTH_SERVICE_PRO"}],a.fromHomeView=!1,l.isNullOrEmpty(c.fromHomeView)||"true"!=c.fromHomeView?a.fromHomeView=!1:a.fromHomeView=!0,a.org={},a.orgLoc={},a.userList=[],a.WSUserSearchCriteria={},a.error={},a.filterCriteria={},a.error={},a.addressInfo={},a.addressInfoFilter={},a.filterCriteria.org={},a.filterCriteria.orgLoc={},a.status={},a.status.AND="true",a.status.OR="false",a.userlistSpinner=!1,a.userListPageSpinner=!1,a.filterCriteria.radius=2e4,a.filterCriteria.slider=20,a.mapVisibility="hide-map",a.isMapVisible=!0,n.getMap().then(function(b){o(function(){a.map=b},0),b.addListener("zoom_changed",function(){12!==b.getZoom()&&a.whetherSetToDefalut&&(a.whetherSetToDefalut=!1,b.setZoom(12))})}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.changeRadius=function(){a.filterCriteria.radius=angular.copy(1e3*a.filterCriteria.slider)},l.isEmpty(f.getLoggedInUser())||(a.loggedInUser=f.getLoggedInUser().id),a.getUserStatus=function(a){var b="";return angular.forEach(a,function(a,c){b=0==c?a:b+","+a}),b},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=q.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return p.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getProfessionalTypes=function(){a.professionalTypesData=[],a.professionalSubTypeData=[],a.filterCriteria.specializationId=null,a.filterCriteria.subSpecializationId=null;var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=q.getUrl("GET_HEALTH_PROFESSIONAL_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=q.getUrl("GET_SUPPORT_PROFESSIONAL_TYPES")),p.getData(b,null,function(b){a.professionalTypesData=angular.fromJson(b.data)},function(){})},a.getProfessionalSubType=function(){var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=q.getUrl("GET_HEALTH_PROFESSIONAL_SUB_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=q.getUrl("GET_SUPPORT_PROFESSIONAL_SUB_TYPES")),b+=a.filterCriteria.specializationId.id,p.getData(b,null,function(b){a.professionalSubTypeData=angular.fromJson(b.data)},function(){})},a.getDiseaseVariant=function(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.filterCriteria.disease.id,a.diseaseVariantLoad=!0,p.getData(q.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||h("error",i.instant(b.data.messages[0]))})},a.getSymptom=function(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,p.getData(q.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SEARCH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",p.getData(q.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",p.getData(q.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.searchUsers=function(){b.showSpinner=!0,1==a.isMapVisible?/*delete $scope.WSUserSearchCriteria.slider;*/
g.searchUsersForMap(a.WSUserSearchCriteria,a.addressInfo,a.org,a.orgLoc,function(c){b.showSpinner=!1,a.organizationLocationsList=c;var d=c;a.orgMapArray=[],a.orgMapArray.push(a.currentLocationObject),a.WSUserSearchCriteria.whetherAllStatus&&a.WSUserSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus=!0:a.filterCriteria.whetherAllStatus=!1,delete a.filterCriteria.organizationId;for(var e=0;e<d.length;e++)l.isFieldEmpty(d[e].addressLattitudes)||l.isFieldEmpty(d[e].addressLongitudes)||(d[e].location=[d[e].addressLattitudes,d[e].addressLongitudes],d[e].isDraggable=!1,d[e].organizationTypeIcon=a.iconsList.ICONS[d[e].organizationTypeIconsEnum],d[e].isSelected=!1,d[e].id=d[e].locationId,null!=d[e].organizationLocationAddressId&&a.orgMapArray.push(d[e]));l.isFieldEmpty(d)&&(a.orgMapArray=[],a.orgMapArray.push(a.currentLocationObject))},function(a){b.showSpinner=!1}):(a.WSUserSearchCriteria.pageNumber=a.currentPage,a.WSUserSearchCriteria.recordsPerPage=a.itemPerPage,delete a.WSUserSearchCriteria.slider,delete a.WSUserSearchCriteria.radius,g.searchUsers(a.WSUserSearchCriteria,a.addressInfo,a.org,a.orgLoc,function(c){b.showSpinner=!1,a.userlistSpinner=!1,a.userList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.WSUserSearchCriteria.whetherAllStatus&&a.WSUserSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus=!0:a.filterCriteria.whetherAllStatus=!1},function(c){b.showSpinner=!1,a.userlistSpinner=!1,a.error=c,a.userList=null,a.currentPage=1,a.totalItems=0,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)}))},a.fetchRecords=function(b){b&&z(),!l.isNullOrEmpty(a.filterCriteria)&&l.isNullOrEmpty(a.filterCriteria.symptom)&&delete a.filterCriteria.symptom,angular.copy(a.filterCriteria,a.WSUserSearchCriteria),a.WSUserSearchCriteria.radius?a.WSUserSearchCriteria.radius=a.WSUserSearchCriteria.radius/1e3:(a.WSUserSearchCriteria.radius=20,a.filterCriteria.slider=20),l.isFieldEmpty(a.WSUserSearchCriteria.organization)||(a.WSUserSearchCriteria.organizationId=a.WSUserSearchCriteria.organization.data.id),delete a.WSUserSearchCriteria.organization,a.isMapVisible||delete a.WSUserSearchCriteria.radius,a.addressInfo=a.addressInfoFilter,a.orgType=a.orgTypeFilter;var c="";l.isFieldEmpty(a.addressInfo.cityValue)?l.isFieldEmpty(a.addressInfo.city)||(c+=a.addressInfo.city.value):c+=a.addressInfo.cityValue.value,l.isFieldEmpty(a.addressInfo.postalCode)||(c=l.isFieldEmpty(c)?a.addressInfo.postalCode.toString():c+" "+a.addressInfo.postalCode),l.isFieldEmpty(c)?a.searchUsers():(a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=c),x.geocode({address:c}).then(function(b){a.currentLocation=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.filterCriteria.addressLattitudes=b[0].geometry.location.lat(),a.filterCriteria.addressLongitudes=b[0].geometry.location.lng(),a.WSUserSearchCriteria.addressLattitudes=b[0].geometry.location.lat(),a.WSUserSearchCriteria.addressLongitudes=b[0].geometry.location.lng(),a.currentLocationObject.location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()]),a.searchUsers()}))};/* To assign null if statuses-chip-component return any false property */
var z=function(){var b=a.filterCriteria,c={};angular.forEach(b,function(a,b){"boolean"==typeof a?c[b]="whetherAllStatus"!=b&&0==a?null:a:c[b]=a}),a.filterCriteria=c};a.selectHospital=function(b,c){a.hospitalSelected=!0,a.selectedId=c.id,a.showDoctors(c.locationId),a.hideDetail()},a.showDoctors=function(c){b.showSpinner=!0;var d=angular.copy(a.WSUserSearchCriteria);d.pageNumber=a.currentDocPage,d.recordsPerPage=a.itemPerPageForDoc,d.organizationLocationId=c,a.selectedLocationId=c,delete d.radius,g.searchUsers(d,a.addressInfo,null,c,function(c){b.showSpinner=!1,a.locationUserList=c.data,a.totalItemsForDoc=c.totalRecords,a.docPagingInfo=j(a.currentDocPage,a.itemPerPageForDoc,a.totalItemsForDoc)},function(a){b.showSpinner=!1})},a.unconfirm=function(){a.selectedId=null,a.selectedAddress=null,a.map.hideInfoWindow("bar"),a.destination=null},a.hideDetail=function(){"calledFromEmergencyTransaction"!==c.type?a.map.hideInfoWindow("foo-iw"):"changeEmergencyLocation"!==c.caller?a.map.hideInfoWindow("foo-iw"):0!==a.address.organizationLocationAddressId&&a.map.hideInfoWindow("foo-iw")},a.viewCalendar=function(a){if(a.calendarId){b.showSpinner=!0;var c={calendarId:a.calendarId,entityTypeCode:"CAL_ORGANIZATION_USER",entityId:a.userId};t.getCalendarDetailsById(c,function(a){b.showSpinner=!1,d.go("usercalendarview",{type:"regular",data:a})},function(a){b.showSpinner=!1})}},a.showDetails=function(b,c){a.address=c,c.organizationLocationAddressId&&a.map.showInfoWindow("foo-iw","id_"+c.locationId),a.map.hideInfoWindow("bar"),c.locationId!==a.selectedId};var A=function(b){p.getJsonData(q.getJsonFileUrl("ORGANIZATION_TYPE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),B())},function(a){})},B=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){C(b.coords.latitude,b.coords.longitude,!0)})},function(a){w.getUsersCoordinates(a,function(a){C(a.coords.latitude,a.coords.longitude,!0)})})},C=function(b,c){a.filterCriteria.addressLattitudes=b,a.filterCriteria.addressLongitudes=c;var d={latLng:new google.maps.LatLng(b,c)};a.changeLocation(d),a.organizationLocationsList=[],a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,organizationLocationName:"You are here",locationId:0,id:0},a.organizationLocationsList.push(a.currentLocationObject),a.init()};a.changeLocation=function(b){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filterCriteria.addressLattitudes=b.latLng.lat(),a.filterCriteria.addressLongitudes=b.latLng.lng(),a.currentLocationObject={location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes]},a.locationChanged=!0,r.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,addressLattitudes:b.latLng.lat(),addressLongitudes:b.latLng.lng()}}),a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,locationId:0,id:0,organizationLocationName:"You dragged here"},!l.isFieldEmpty(c.wallData)&&l.isFieldEmpty(c.wallData.organization)?a.fetchRecords():l.isFieldEmpty(c.wallData)&&a.fetchRecords()},a.manageMsgSubscription=function(a,b){d.go("manageEventSubscription",{user:{id:a,displayName:b}})},/*$scope.fetchRecords = function () {
            angular.copy($scope.filterCriteria, $scope.WSUserSearchCriteria);
            $scope.addressInfo = $scope.addressInfoFilter;
            $scope.searchUsers();
        };*/
a.clear=function(){a.WSUserSearchCriteria={},a.addressInfo={},a.org={},a.orgLoc={},a.filterCriteria={},a.addressInfoFilter={},a.$broadcast("clearStatusData"),a.$broadcast("clearPicklistData"),a.$broadcast("clearAddressData"),a.WSUserSearchCriteria.radius=2e4,A()},
//Add new Organisation
a.addNewUser=function(){d.go("manageorglocuser",{type:"add"})},a.showUserAddressList=function(a,b,c,e){var f={navigateFrom:"orglocuserlist",userAddressId:null,userId:a,userCode:b,userName:c};d.go("userAddressList",f)},a.requestForUrgentClarification=function(c){b.showSpinner=!0,a.selectedUser=c,a.type="REQ_URGENT_CLARIFICATION";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_URGENT_CLARIFICATION",u.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",u.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.requestForOnlineAppointment=function(c){b.showSpinner=!0,a.selectedUser=c,a.type="REQ_ONLINE_ADVICE";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_ONLINE_ADVICE",u.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",u.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.getStars=function(a){
// Get the value
var b=parseFloat(a),c=b/5*100;return c+"%"},a.openPopup=function(){v.show({controller:y,templateUrl:"app/modules/manage-organisation-locations/views/create-request-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{requestType:a.type,manageRequestService:u,requestStatus:a.requestStatus,requestsType:a.requestsType,baseService:f,selectedUser:a.selectedUser}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.manageProfessionalWall=function(a){d.go("professionalwall",{callingUrl:"orgLocUsers",userData:a})},a.getUserProfessionalTreatmentTypes=function(a,b,c,e){var f=!1,g=c.indexOf("Other Health Service Professional")>-1;//"Other Health Service Professional", "Support Service Professional"
g&&(f=!0),d.go("professionalTreatmentList",{type:null,user:{id:a,userName:b,userType:f?"H":"S",whetherHealthProfessional:f}})},a.getUserDiseaseVariantLinked=function(a,b,c,e){d.go("diseaseVariantLinkedList",{type:null,professional:{id:a,userName:b,userType:"H"}})},a.getMonthlyDiseaseVariantLinked=function(a,b,c,e){d.go("monthlyDiseaseVariantLinkedStatastics",{type:null,professional:{id:a,userName:b,userType:"H"}})},
//Edit new User
a.getOrgnizationUser=function(c,e){b.showSpinner=!0,g.getUserById(c,function(a){b.showSpinner=!1;var f=a;d.go("manageorglocuser",{type:e,data:f,orgUserId:c})},function(c){b.showSpinner=!1,a.error=c,h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},
//This function is use to view Health Support Professional Service
a.viewHealthSupportProfessional=function(c,e,f){b.showSpinner=!0,k.getProfessionalSummaryData(c,e,function(a){b.showSpinner=!1;var g=a;d.go("manageProfessionalSummary",{type:e,data:g,orgUserId:c,mode:f})},function(c){b.showSpinner=!1,a.error=c})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()},a.pageChangedForDoc=function(){a.docPagingInfo=j(a.currentDocPage,a.itemPerPageForDoc,a.totalItemsForDoc),a.showDoctors(a.selectedLocationId)},a.setMaxRecordsForDoc=function(b){a.currentDocPage=1,a.itemPerPageForDoc=b,a.showDoctors(a.selectedLocationId)};
//datatble config json
var D={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(D),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.isMapVisible=!0,a.buttonText=i.instant("SHOW_TABLE"),a.mapVisibility="show-map",a.getSpecializations(),a.getSubbranch(),l.isFieldEmpty(c.wallData)?c.organization&&c.orgLocation&&(a.filterCriteria.org.data=c.organization,a.filterCriteria.orgLoc.data=c.orgLocation):(l.isFieldEmpty(c.wallData.organization)||(a.org.data=c.wallData.organization,a.filterCriteria.org.data=c.wallData.organization,a.filterCriteria.orgLoc.data=c.wallData.orglocation,a.fetchRecords()),l.isFieldEmpty(c.wallData.orglocation)||(a.orgLoc.data=c.wallData.orglocation),l.isFieldEmpty(c.wallData.type)||("healthProfessional"===c.wallData.type?(a.filterCriteria.whetherOtherHealthSrvcPrfssnl=!0,a.filterCriteria.whetherDoctor=!0):"supportServiceProfessional"===c.wallData.type?a.filterCriteria.whetherSupportSrvcPrfssnl=!0:"professionalwall"===c.wallData.type&&(a.fromProfessionalWall=!0,a.filterCriteria.userName=c.wallData.userName,"SUMMARY"===c.wallData.subType&&(a.whetherSummary=!0,a.filterCriteria.whetherOtherHealthSrvcPrfssnl=!0,a.filterCriteria.whetherSupportSrvcPrfssnl=!0,a.filterCriteria.whetherDoctor=!0))))},A(),a.toggleMap=function(){/*$state.reload();*/
a.isMapVisible=!a.isMapVisible,1==a.isMapVisible?(a.buttonText=i.instant("SHOW_TABLE"),a.mapVisibility="show-map"):(a.buttonText=i.instant("SHOW_MAP"),a.mapVisibility="hide-map"),l.isFieldEmpty(c.wallData)||(l.isFieldEmpty(c.wallData.organization)||(a.org.data=c.wallData.organization),l.isFieldEmpty(c.wallData.orglocation)||(a.orgLoc.data=c.wallData.orglocation),l.isFieldEmpty(c.wallData.type)||("healthProfessional"===c.wallData.type?(a.filterCriteria.whetherOtherHealthSrvcPrfssnl=!0,a.filterCriteria.whetherDoctor=!0):"supportServiceProfessional"===c.wallData.type?a.filterCriteria.whetherSupportSrvcPrfssnl=!0:"professionalwall"===c.wallData.type&&(a.fromProfessionalWall=!0,a.filterCriteria.userName=c.wallData.userName,"SUMMARY"===c.wallData.subType&&(a.whetherSummary=!0,a.filterCriteria.whetherOtherHealthSrvcPrfssnl=!0,a.filterCriteria.whetherSupportSrvcPrfssnl=!0,a.filterCriteria.whetherDoctor=!0)))),a.fetchRecords()}}]),angular.module("paripal.manageOrganisationLocationUser").service("manageOrgUserService",["httpService","urlService","dateconvertor",function(a,b,c){"use strict";this.updateUser=function(d,e,f,g,h,i,j,k){var l={};angular.copy(d,l),e.data&&e.data!==-1||e.nameValue&&(l.userByUserId.displayName=e.nameValue),l.validFrom=c.convertToServerDate(l.validFrom),l.validTill&&(l.validTill=c.convertToServerDate(l.validTill)),l.orgLoc&&l.orgLoc.data&&l.orgLoc.data.id&&(l.organizationLocation={},l.organizationLocation.id=l.orgLoc.data.id,delete l.orgLoc),l.orgUserPreferedContactModes=new Array;for(var m=0;g.length-1>=m;m++)for(var n=0;h.length-1>=n;n++)if(h[n].id===g[m]){var o={};o.contactMode={},o.contactMode.id=h[n].id,o.contactMode.code=h[n].code,o.contactMode.value=h[n].value,l.orgUserPreferedContactModes.push(o)}l.whetherSignatory=k.whetherSignatory,l.designation=k.designation,l.signatureDocumentId=k.signatureDocumentId,l.signatureFileName=k.signatureFileName;var p=null;if(f&&"add"===f)p=b.getUrl("ADD_ORG_USER");else if(f&&"edit"===f){var q={};q.orgUserId=l.id,p=b.getParameterizedUrl("UPDATE_ORG_USER",q)}p&&(f&&"add"===f?a.postData(p,l,function(a){a&&a.data?i(a.data):j(a)},function(a){j(a)},{organizationLocationId:l.organizationLocation.id}):f&&"edit"===f&&a.putData(p,l,function(a){a&&a.data?i(a.data):j(a)},function(a){j(a)}))},this.loadContactMode=function(c,d){var e={};e.type="Preferred_contact_Modes",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.loadModuleSubscription=function(c,d,e){var f={};f.orgLocationId=c,a.getData(b.getParameterizedUrl("GET_SUBSCRIPTION_LIST",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.manageOrganisationLocationUser").service("orgUserListService",["httpService","urlService","dateconvertor","$filter","statePersistenceService","utilService",function(a,b,c,d,e,f){"use strict";this.searchUsers=function(c,d,g,h,i,j,k){var l=angular.copy(c);f.isEmpty(k)||(l.userName=k),/*else {
    searchObj.userName = "";
}*/
l.whetherAllStatus&&"true"===l.whetherAllStatus?l.whetherAllStatus=!0:l.whetherAllStatus=!1,d&&(d.cityValue&&d.cityValue.id&&(l.cityId=d.cityValue.id),d.districtValue&&d.districtValue.id&&(l.districtId=d.districtValue.id),d.stateValue&&d.stateValue.id&&(l.stateId=d.stateValue.id),d.countryValue&&d.countryValue.id&&(l.countryId=d.countryValue.id),d.postalCode&&(l.postalCode=d.postalCode)),c.org&&c.org.data&&(l.organizationId=c.org.data.id),delete l.org,c.orgLoc&&c.orgLoc.data?l.organizationLocationId=c.orgLoc.data.id:h&&h.id&&(l.organizationLocationId=h.id),delete l.orgLoc,c.disease&&(l.diseaseId=c.disease.id,delete l.disease),c.diseaseVariant&&(l.diseaseVariantId=c.diseaseVariant.id,delete l.diseaseVariant),c.symptom&&(l.symptomId=c.symptom.id,delete l.symptom),c.specializationId&&(l.specializationId=c.specializationId.id),c.subSpecializationId&&(l.subSpecializationId=c.subSpecializationId.id),c.gender&&!c.gender.dataValue&&delete l.gender,c.gender&&c.gender.dataValue?(l.genderId=c.gender.dataValue.id,delete l.gender):l.genderId=null,e.setStateData("orgLocFilterData",l),a.postData(b.getUrl("SEARCH_ORG_LOC_USERS"),l,function(a){a.data&&a.data.data?i(a.data):j(a)},function(a){j(a)})},this.searchUserCards=function(c,d,g,h,i,j,k){var l=angular.copy(c);f.isEmpty(k)||(l.userName=k),/*else {
    searchObj.userName = "";
}*/
l.whetherAllStatus&&"true"===l.whetherAllStatus?l.whetherAllStatus=!0:l.whetherAllStatus=!1,d&&(d.cityValue&&d.cityValue.id&&(l.cityId=d.cityValue.id),d.districtValue&&d.districtValue.id&&(l.districtId=d.districtValue.id),d.stateValue&&d.stateValue.id&&(l.stateId=d.stateValue.id),d.countryValue&&d.countryValue.id&&(l.countryId=d.countryValue.id),d.postalCode&&(l.postalCode=d.postalCode)),c.org&&c.org.data&&(l.organizationId=c.org.data.id),delete l.org,c.orgLoc&&c.orgLoc.data?l.organizationLocationId=c.orgLoc.data.id:h&&h.id&&(l.organizationLocationId=h.id),delete l.orgLoc,c.disease&&(l.diseaseId=c.disease.id,delete l.disease),c.diseaseVariant&&(l.diseaseVariantId=c.diseaseVariant.id,delete l.diseaseVariant),c.symptom&&(l.symptomId=c.symptom.id,delete l.symptom),c.specializationId&&(l.specializationId=c.specializationId.id),c.subSpecializationId&&(l.subSpecializationId=c.subSpecializationId.id),c.gender&&!c.gender.dataValue&&delete l.gender,c.gender&&c.gender.dataValue?(l.genderId=c.gender.dataValue.id,delete l.gender):l.genderId=null,c.radius?l.radius=c.radius:l.radius=20,c.cityDistrict&&(
//searchObj.cityDistrict = WSUserSearchCriteria.cityDistrict;
l.cityId=c.cityDistrict.cityId,
//searchObj.districtId = WSUserSearchCriteria.districtId;
l.stateId=c.cityDistrict.stateId,l.countryId=c.cityDistrict.countryId,
//searchObj.postalCode = WSUserSearchCriteria.cityDistrict;
delete l.cityDistrict),e.setStateData("orgLocFilterData",l),a.postData(b.getUrl("SEARCH_ORG_LOC_USER_CARDS"),l,function(a){a.data&&a.data.data?i(a.data):j(a)},function(a){j(a)})},this.searchUsersForMap=function(c,d,f,g,h,i){c.whetherAllStatus&&"true"===c.whetherAllStatus?c.whetherAllStatus=!0:c.whetherAllStatus=!1,d&&(d.cityValue&&d.cityValue.id&&(c.cityId=d.cityValue.id),d.districtValue&&d.districtValue.id&&(c.districtId=d.districtValue.id),d.stateValue&&d.stateValue.id&&(c.stateId=d.stateValue.id),d.countryValue&&d.countryValue.id&&(c.countryId=d.countryValue.id),d.postalCode&&(c.postalCode=d.postalCode)),c.org&&c.org.data&&(c.organizationId=c.org.data.id),delete c.org,c.orgLoc&&c.orgLoc.data&&(c.organizationLocationId=c.orgLoc.data.id),delete c.orgLoc,delete c.slider,c.disease&&(c.diseaseId=c.disease.id,delete c.disease),c.diseaseVariant&&(c.diseaseVariantId=c.diseaseVariant.id,delete c.diseaseVariant),c.symptom&&(c.symptomId=c.symptom.id,delete c.symptom),c.specializationId&&(c.specializationId=c.specializationId.id),c.subSpecializationId&&(c.subSpecializationId=c.subSpecializationId.id),c.radius||delete c.radius,e.setStateData("orgLocFilterData",c),a.postData(b.getUrl("ORGANIZATION_USER_MAP_VIEW"),c,function(a){a.data&&a.data?h(a.data):i(a)},function(a){i(a)})},this.getUserById=function(c,e,f){var g={};g.orgUserId=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_ORG_USER_BY_ID",g),null,function(a){a&&a.data?(a.data.validFrom=d("timestampToDate")(a.data.validFrom,h),a.data.validTill=d("timestampToDate")(a.data.validTill,h),e(a.data)):f(a)},function(a){f(a)})},this.getDoctorsByLocationId=function(c,d,e){a.postData(b.getUrl("GET_DOCTORS_BY_LOCATION_ID"),c,function(a){d(a)},function(a){e(a)})},this.getAccesibleOrgLocationsByUserId=function(c,d,e){var f={};f.userId=c,f.searchString="",a.getData(b.getParameterizedUrl("FIND_ACCESSIBLE_ORG_LOC_BY_USER_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.manageOrganisationLocation").controller("AddOrgLocCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","addOrgLocService","notify","$translate","manageOrgLocService","utilService",function(a,b,c,d,e,f,g,h,i,j){"use strict";a.WSOrganizationLocation={},a.orgLocSaveResponse="",a.orgLocTypeFilter={},a.currencyFilter={},a.calendarFilter={},a.orgLoc={},a.org={},a.category=new Array,a.maxDate=new Date,a.minDate=new Date,a.emailValues=[{}],a.tollFreeValues=[{}],a.cellNoValues=[{}],a.landlineValues=[{}],a.wallValues=[{}],a.labelList="",a.$on("imageEvent",function(b,c){e.readAsDataUrl(c,a).then(function(b){a.imageSrc=b})}),/*Get Organization by Id */
a.getOrgDetailById=function(b){j.isFieldEmpty(b)||f.getOrgDetailById(b.data.id,function(b){j.isFieldEmpty(b.commencementDate)||(a.setMinCommDate=b.commencementDate)},function(a){})},a.saveOrganizationLocation=function(){b.showSpinner=!0,j.isNullOrEmpty(a.WSOrganizationLocation.homeCollectionStartTime)||j.isNullOrEmpty(a.WSOrganizationLocation.homeCollectionEndTime)||(a.WSOrganizationLocation.homeCollectionStartTime=a.WSOrganizationLocation.homeCollectionStartTime.getHours()+":"+a.WSOrganizationLocation.homeCollectionStartTime.getMinutes()+":00",a.WSOrganizationLocation.homeCollectionEndTime=a.WSOrganizationLocation.homeCollectionEndTime.getHours()+":"+a.WSOrganizationLocation.homeCollectionEndTime.getMinutes()+":00"),f.saveOrganizationLocation(a.WSOrganizationLocation,a.org,a.orgLoc,a.orgLocTypeFilter,a.category,a.currencyFilter,a.calendarFilter,a.emailValues,a.tollFreeValues,a.cellNoValues,a.landlineValues,a.wallValues,function(c){b.showSpinner=!1,a.orgLocSaveResponse=c,g("success",h.instant("ADDED_SUCCESS")),d.go("orgloclist",{type:""})},function(c){b.showSpinner=!1,a.orgLocSaveResponse=c})},a.cancel=function(){j.goBackToPrevState()},a.fetchCategotyLabels=function(){var b=new Array;b.push("ORG_LOCATION_CATEGORY_1"),b.push("ORG_LOCATION_CATEGORY_2"),b.push("ORG_LOCATION_CATEGORY_3"),i.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.fetchCategotyLabels(),a.$watch("WSOrganizationLocation.whetherLab",function(b,c){b!=c&&0==b&&(delete a.WSOrganizationLocation.whetherTakeOnlineTestOrder,delete a.WSOrganizationLocation.whetherTakeOrdersByAPI,delete a.WSOrganizationLocation.whetherTakeTestSampleHomeCollection,delete a.WSOrganizationLocation.homeCollectionStartTime,delete a.WSOrganizationLocation.homeCollectionEndTime)}),a.init=function(){a.WSOrganizationLocation.whetherSelfBillingLocation=!0},a.init()}]),angular.module("paripal.manageOrganisationLocation").controller("DateWiseClientCountCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.maxDateValidFrom=new Date,a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.exportTableToExcel=function(a,b){var c,d="application/vnd.ms-excel",e=document.getElementById(a),f=e.outerHTML.replace(/ /g,"%20");if(
// Specify file name
b=b?b+".xls":"excel_data.xls",
// Create download link element
c=document.createElement("a"),document.body.appendChild(c),navigator.msSaveOrOpenBlob){var g=new Blob(["\ufeff",f],{type:d});navigator.msSaveOrOpenBlob(g,b)}else
// Create a link to the file
c.href="data:"+d+", "+f,
// Setting the file name
c.download=b,
//triggering the function
c.click()},/* Code to download csv : START */
a.setTable=function(){var b=document.querySelector("table").outerHTML;a.export_table_to_csv(b,"DateWiseClientCount.csv")},a.export_table_to_csv=function(b,c){for(var d=[],e=document.querySelectorAll("table tr"),f=0;f<e.length;f++){for(var g=[],h=e[f].querySelectorAll("td, th"),i=0;i<h.length;i++)g.push(h[i].innerText);d.push(g.join(","))}
// Download CSV
a.download_csv(d.join("\n"),c)},a.download_csv=function(a,b){var c,d;
// CSV FILE
c=new Blob([a],{type:"text/csv"}),
// Download link
d=document.createElement("a"),
// File name
d.download=b,
// We have to create a link to the file
d.href=window.URL.createObjectURL(c),
// Make sure that the link is not displayed
d.style.display="none",
// Add the link to your DOM
document.body.appendChild(d),
// Lanzamos
d.click()},/* Code to download csv : END */
a.getClientCount=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("DATE_WISE_CLIENT_COUNT"),c,function(c){c&&c.data&&(b.showSpinner=!1,a.countList=angular.fromJson(c.data),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){a.searchCriteria={},a.getClientCount()},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",k.getData(l.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getClientCount()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getClientCount()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){var b=j.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.searchCriteria.organizationLocation=b.orgLoc),a.getClientCount()},a.init()}]),angular.module("paripal.manageOrganisationLocation").controller("DateWiseTransactionCountCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.maxDateValidFrom=new Date,a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.exportTableToExcel=function(a,b){var c,d="application/vnd.ms-excel",e=document.getElementById(a),f=e.outerHTML.replace(/ /g,"%20");if(
// Specify file name
b=b?b+".xls":"excel_data.xls",
// Create download link element
c=document.createElement("a"),document.body.appendChild(c),navigator.msSaveOrOpenBlob){var g=new Blob(["\ufeff",f],{type:d});navigator.msSaveOrOpenBlob(g,b)}else
// Create a link to the file
c.href="data:"+d+", "+f,
// Setting the file name
c.download=b,
//triggering the function
c.click()},/* Code to download csv : START */
a.setTable=function(){var b=document.querySelector("table").outerHTML;a.export_table_to_csv(b,"DateWiseTransactionTypeCount.csv")},a.export_table_to_csv=function(b,c){for(var d=[],e=document.querySelectorAll("table tr"),f=0;f<e.length;f++){for(var g=[],h=e[f].querySelectorAll("td, th"),i=0;i<h.length;i++)g.push(h[i].innerText);d.push(g.join(","))}
// Download CSV
a.download_csv(d.join("\n"),c)},a.download_csv=function(a,b){var c,d;
// CSV FILE
c=new Blob([a],{type:"text/csv"}),
// Download link
d=document.createElement("a"),
// File name
d.download=b,
// We have to create a link to the file
d.href=window.URL.createObjectURL(c),
// Make sure that the link is not displayed
d.style.display="none",
// Add the link to your DOM
document.body.appendChild(d),
// Lanzamos
d.click()},/* Code to download csv : END */
a.getTransactionCount=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("DATE_WISE_TRANSACTION_COUNT"),c,function(c){c&&c.data&&(b.showSpinner=!1,a.countList=angular.fromJson(c.data),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){a.searchCriteria={},a.getTransactionCount()},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",k.getData(l.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},a.getTransactionTypes=function(){k.getData(l.getUrl("GET_TRANSACTION_TYPES_PICKLIST"),null,function(b){b&&b.data&&(a.transactionTypeList=b.data)},function(a){})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getTransactionCount()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getTransactionCount()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){var b=j.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.searchCriteria.organizationLocation=b.orgLoc),a.getTransactionTypes(),a.getTransactionCount()},a.init()}]),angular.module("paripal.manageOrganisationLocation").controller("LocWiseClientCountCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.maxDateValidFrom=new Date,a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.exportTableToExcel=function(a,b){var c,d="application/vnd.ms-excel",e=document.getElementById(a),f=e.outerHTML.replace(/ /g,"%20");if(
// Specify file name
b=b?b+".xls":"excel_data.xls",
// Create download link element
c=document.createElement("a"),document.body.appendChild(c),navigator.msSaveOrOpenBlob){var g=new Blob(["\ufeff",f],{type:d});navigator.msSaveOrOpenBlob(g,b)}else
// Create a link to the file
c.href="data:"+d+", "+f,
// Setting the file name
c.download=b,
//triggering the function
c.click()},/* Code to download csv : START */
a.setTable=function(){var b=document.querySelector("table").outerHTML;a.export_table_to_csv(b,"LocationWiseClientCount.csv")},a.export_table_to_csv=function(b,c){for(var d=[],e=document.querySelectorAll("table tr"),f=0;f<e.length;f++){for(var g=[],h=e[f].querySelectorAll("td, th"),i=0;i<h.length;i++)g.push(h[i].innerText);d.push(g.join(","))}
// Download CSV
a.download_csv(d.join("\n"),c)},a.download_csv=function(a,b){var c,d;
// CSV FILE
c=new Blob([a],{type:"text/csv"}),
// Download link
d=document.createElement("a"),
// File name
d.download=b,
// We have to create a link to the file
d.href=window.URL.createObjectURL(c),
// Make sure that the link is not displayed
d.style.display="none",
// Add the link to your DOM
document.body.appendChild(d),
// Lanzamos
d.click()},/* Code to download csv : END */
a.getClientCount=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("LOC_WISE_CLIENT_COUNT"),c,function(c){c&&c.data&&(b.showSpinner=!1,a.countList=angular.fromJson(c.data),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){a.searchCriteria={},a.getClientCount()},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",k.getData(l.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getClientCount()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getClientCount()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){var b=j.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.searchCriteria.organizationLocation=b.orgLoc),a.getClientCount()},a.init()}]),angular.module("paripal.manageOrganisationLocation").controller("LocWiseTransactionCountCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.maxDateValidFrom=new Date,a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.exportTableToExcel=function(a,b){var c,d="application/vnd.ms-excel",e=document.getElementById(a),f=e.outerHTML.replace(/ /g,"%20");if(
// Specify file name
b=b?b+".xls":"excel_data.xls",
// Create download link element
c=document.createElement("a"),document.body.appendChild(c),navigator.msSaveOrOpenBlob){var g=new Blob(["\ufeff",f],{type:d});navigator.msSaveOrOpenBlob(g,b)}else
// Create a link to the file
c.href="data:"+d+", "+f,
// Setting the file name
c.download=b,
//triggering the function
c.click()},/* Code to download csv : START */
a.setTable=function(){var b=document.querySelector("table").outerHTML;a.export_table_to_csv(b,"LocationWiseTransactionTypeCount.csv")},a.export_table_to_csv=function(b,c){for(var d=[],e=document.querySelectorAll("table tr"),f=0;f<e.length;f++){for(var g=[],h=e[f].querySelectorAll("td, th"),i=0;i<h.length;i++)g.push(h[i].innerText);d.push(g.join(","))}
// Download CSV
a.download_csv(d.join("\n"),c)},a.download_csv=function(a,b){var c,d;
// CSV FILE
c=new Blob([a],{type:"text/csv"}),
// Download link
d=document.createElement("a"),
// File name
d.download=b,
// We have to create a link to the file
d.href=window.URL.createObjectURL(c),
// Make sure that the link is not displayed
d.style.display="none",
// Add the link to your DOM
document.body.appendChild(d),
// Lanzamos
d.click()},/* Code to download csv : END */
a.getTransactionCount=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("LOC_WISE_TRANSACTION_COUNT"),c,function(c){c&&c.data&&(b.showSpinner=!1,a.countList=angular.fromJson(c.data),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){a.searchCriteria={},a.getTransactionCount()},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",k.getData(l.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},a.getTransactionTypes=function(){k.getData(l.getUrl("GET_TRANSACTION_TYPES_PICKLIST"),null,function(b){b&&b.data&&(a.transactionTypeList=b.data)},function(a){})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getTransactionCount()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getTransactionCount()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){var b=j.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.searchCriteria.organizationLocation=b.orgLoc),a.getTransactionTypes(),a.getTransactionCount()},a.init()}]),angular.module("paripal.manageOrganisationLocation").controller("LocWiseUploadCountCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.maxDateValidFrom=new Date,a.documentTypes=["User id document","Transaction","Test","Resource","Complaint","Messaging","Master","Other","Client","Logo","Photo","Orbeon","Reviews","Disease","Medication","Treatment","Request","Vaccination","Header Logo","Help","All"],a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.exportTableToExcel=function(a,b){var c,d="application/vnd.ms-excel",e=document.getElementById(a),f=e.outerHTML.replace(/ /g,"%20");if(
// Specify file name
b=b?b+".xls":"excel_data.xls",
// Create download link element
c=document.createElement("a"),document.body.appendChild(c),navigator.msSaveOrOpenBlob){var g=new Blob(["\ufeff",f],{type:d});navigator.msSaveOrOpenBlob(g,b)}else
// Create a link to the file
c.href="data:"+d+", "+f,
// Setting the file name
c.download=b,
//triggering the function
c.click()},a.exportTableToExcel1=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("LOC_WISE_UPLOAD_COUNT_CSV"),c,function(c){c&&c.data&&(c.data.forEach(function(a){a.convertedFileSize=(a.fileSize/1024/1024).toFixed(2)}),b.showSpinner=!1,a.excelCountList=c.data,a.exportTableToExcel("tblExcelData","LocationWiseDocumentCount"))},function(a){b.showSpinner=!1})},/* Code to download csv : START */
a.setTable=function(){
//var html = document.querySelector("table").outerHTML;
var b=document.getElementById("tblData").outerHTML;a.export_table_to_csv(b,"LocationWiseDocumentCount.csv")},a.setTable1=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("LOC_WISE_UPLOAD_COUNT_CSV"),c,function(c){c&&c.data&&(c.data.forEach(function(a){a.convertedFileSize=(a.fileSize/1024/1024).toFixed(2)}),b.showSpinner=!1,a.export_table_to_csv_1(c.data,"LocationWiseDocumentCount.csv"))},function(a){b.showSpinner=!1})},a.export_table_to_csv=function(b,c){for(var d=[],e=document.getElementById("tblData").querySelectorAll("table tr"),f=0;f<e.length;f++){for(var g=[],h=e[f].querySelectorAll("td, th"),i=0;i<h.length;i++)g.push(h[i].innerText);d.push(g.join(","))}
// Download CSV
a.download_csv(d.join("\n"),c)},a.export_table_to_csv_1=function(b,c){var d=[],e="Organization location,Document count,Total document size in MB";d.push(e),b.forEach(function(a){d.push(a.orgLoc.value+","+a.totCount+","+a.convertedFileSize).toString()}),a.download_csv(d.join("\n"),c)},a.download_csv=function(a,b){var c,d;
// CSV FILE
c=new Blob([a],{type:"text/csv"}),
// Download link
d=document.createElement("a"),
// File name
d.download=b,
// We have to create a link to the file
d.href=window.URL.createObjectURL(c),
// Make sure that the link is not displayed
d.style.display="none",
// Add the link to your DOM
document.body.appendChild(d),
// Lanzamos
d.click()},/* Code to download csv : END */
a.getUploadCount=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("LOC_WISE_UPLOAD_COUNT"),c,function(c){c&&c.data&&(c.data.data.forEach(function(a){a.convertedFileSize=(a.fileSize/1024/1024).toFixed(2)}),b.showSpinner=!1,a.countList=angular.fromJson(c.data),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){a.searchCriteria={},a.searchCriteria.documentType="All",a.getUploadCount()},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",k.getData(l.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},a.getPartyNameData=function(c){var d={};if(b.isLoggedIn&&b.loggedInUserDetails.isOrganizationUser)return d.keyword=c,k.getData(l.getParameterizedUrl("FIND_ACCESSIBLE_ORG_LOC_BY_KEY",d),null,function(b){
//return angular.fromJson(response.data);
return b&&b.data&&(a.finalOrgLocation=[],b.data.forEach(function(b){a.finalOrgLocation.push(b.orgLocation)})),a.finalOrgLocation},function(a){})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getUploadCount()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getUploadCount()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){var b=j.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.searchCriteria.orgLocation=b.orgLoc),a.getUploadCount()},a.init()}]),angular.module("paripal.manageOrganisationLocation").controller("ManageOrgLocCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","manageOrgLocService","orgLocListService","notify","$translate","commonConstants","otherDocumentService","fileOperations","$interval","$timeout","utilService","baseService","commonCalendarService","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.WSOrganizationLocation={},a.orgLocUpdateResponse="",a.disabled=!1,a.orgLocTypeFilter={},a.labelList="",a.category=new Array,a.currencyFilter={},a.calendarFilter={},a.status={},a.status.ACTIVE="true",a.status.INACTIVE="false",a.status.selected="",a.orgLoc={},a.org={},a.additionalData={},a.preferedLanguage={},a.maxDate=new Date,a.minDate=new Date,a.emailValues=[{}],a.tollFreeValues=[{}],a.cellNoValues=[{}],a.landlineValues=[{}],a.wallValues=[{}],a.manageOrgLocSpinner=!1,a.logo={},a.headerLogo={};a.calendarSearchCriteria={},o.isNullOrEmpty(c)||o.isNullOrEmpty(c.data)||o.isNullOrEmpty(c.data.billingLocation)||o.isNullOrEmpty(c.data.billingLocation.id)||(a.calendarSearchCriteria.organizationLocationId=c.data.billingLocation.id,q.searchCalendar(a.calendarSearchCriteria,function(b){a.calendars=b.data;for(var c=0;c<=a.calendars.length;c++)o.isNullOrEmpty(a.calendars[c])||"CAL_ORGANIZATION_LOCATION"==a.calendars[c].entityType.code&&(a.calendarData=a.calendars[c])},function(b){a.calendarSpinner=!1}));var t=function(){f.getWallItems(function(b){a.wallItems=b})};a.$on("imageEvent",function(b,c){e.readAsDataUrl(c,a).then(function(b){a.imageSrc=b})}),a.updateOrganizationLocation=function(){b.showSpinner=!0;/* Code for updating rootScope by location category changes */
for(var c=0;c<=a.category.length;c++)o.isNullOrEmpty(a.category[c])||o.isNullOrEmpty(a.category[c].dataValue)||(b.locationCategory=a.category[c].dataValue,localStorage.setItem("locationCategory",angular.toJson(a.category[c].dataValue)));o.isNullOrEmpty(a.WSOrganizationLocation.homeCollectionStartTime)||o.isNullOrEmpty(a.WSOrganizationLocation.homeCollectionEndTime)||(a.WSOrganizationLocation.homeCollectionStartTime=a.WSOrganizationLocation.homeCollectionStartTime.getHours()+":"+a.WSOrganizationLocation.homeCollectionStartTime.getMinutes()+":00",a.WSOrganizationLocation.homeCollectionEndTime=a.WSOrganizationLocation.homeCollectionEndTime.getHours()+":"+a.WSOrganizationLocation.homeCollectionEndTime.getMinutes()+":00"),f.updateOrganizationLocation(a.WSOrganizationLocation,a.org,a.additionalData.orgloc,a.orgLocTypeFilter,a.category,a.currencyFilter,a.calendarFilter,a.emailValues,a.tollFreeValues,a.cellNoValues,a.landlineValues,a.wallValues,function(c){b.showSpinner=!1,a.orgLocUpdateResponse=c,h("success",i.instant("RECORD_EDITED_SUCESS")),d.go("orgloclist",{type:""})},function(c){b.showSpinner=!1,a.orgLocUpdateResponse=c})},a.wallItemCall=function(b,c){"VIEW_CALENDAR"==c.name?r.postData(s.getUrl("FIND_CALENDARBYID"),a.calendarData,function(b){d.go("editcalendarview",{type:"edit",entityId:a.calendarData.entityId,entityData:a.calendarData.entityType,data:angular.fromJson(b.data),calendarId:a.calendarData.id,fromLocWall:!0})},function(a){}):f.wallItemCall(b,c,a.WSOrganizationLocation)},a.cancel=function(){o.goBackToPrevState()},a.setData=function(){if(!o.isNullOrEmpty(a.WSOrganizationLocation.homeCollectionStartTime)&&!o.isNullOrEmpty(a.WSOrganizationLocation.homeCollectionEndTime)){var b=new Date,c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear();c<10&&(c="0"+c),d<10&&(d="0"+d);var b=d+"/"+c+"/"+e;a.WSOrganizationLocation.homeCollectionStartTime=new Date(b+" "+a.WSOrganizationLocation.homeCollectionStartTime),a.WSOrganizationLocation.homeCollectionEndTime=new Date(b+" "+a.WSOrganizationLocation.homeCollectionEndTime)}if(a.WSOrganizationLocation.whetherActive?a.status.selected="true":a.status.selected="false",a.WSOrganizationLocation.locationTypeId&&a.WSOrganizationLocation.locationTypeId.id&&(a.orgLocTypeFilter.id=a.WSOrganizationLocation.locationTypeId.id),a.WSOrganizationLocation.orgLctnCategoryId1&&a.WSOrganizationLocation.orgLctnCategoryId1.id&&(a.category[0]={},a.category[0].id=a.WSOrganizationLocation.orgLctnCategoryId1.id),a.WSOrganizationLocation.orgLctnCategoryId2&&a.WSOrganizationLocation.orgLctnCategoryId2.id&&(a.category[1]={},a.category[1].id=a.WSOrganizationLocation.orgLctnCategoryId2.id),a.WSOrganizationLocation.orgLctnCategoryId3&&a.WSOrganizationLocation.orgLctnCategoryId3.id&&(a.category[2]={},a.category[2].id=a.WSOrganizationLocation.orgLctnCategoryId3.id),a.WSOrganizationLocation.currency&&a.WSOrganizationLocation.currency.id&&(a.currencyFilter.id=a.WSOrganizationLocation.currency.id),a.WSOrganizationLocation.calendar&&a.WSOrganizationLocation.calendar.id&&(a.calendarFilter.id=a.WSOrganizationLocation.calendar.id),a.WSOrganizationLocation.organization&&a.WSOrganizationLocation.organization.id&&(a.org.data={},a.org.data.id=a.WSOrganizationLocation.organization.id,a.org.data.value=a.WSOrganizationLocation.organization.value),a.WSOrganizationLocation.userLanguage&&a.WSOrganizationLocation.userLanguage.id&&(a.preferedLanguage.data={},a.preferedLanguage.data.id=a.WSOrganizationLocation.userLanguage.id,a.preferedLanguage.data.value=a.WSOrganizationLocation.userLanguage.value),a.WSOrganizationLocation.billingLocation&&a.WSOrganizationLocation.billingLocation.id&&(a.orgLoc.data={},a.orgLoc.data.id=a.WSOrganizationLocation.billingLocation.id,a.orgLoc.data.value=a.WSOrganizationLocation.billingLocation.value),a.WSOrganizationLocation.email1&&(a.emailValues[0].value=a.WSOrganizationLocation.email1),a.WSOrganizationLocation.email2&&a.emailValues.push({value:a.WSOrganizationLocation.email2}),a.WSOrganizationLocation.tollFreeNumber1&&(a.tollFreeValues[0].value=a.WSOrganizationLocation.tollFreeNumber1),a.WSOrganizationLocation.tollFreeNumber2&&a.tollFreeValues.push({value:a.WSOrganizationLocation.tollFreeNumber2}),a.WSOrganizationLocation.mobileNumber1&&(a.cellNoValues[0].value=a.WSOrganizationLocation.mobileNumber1),a.WSOrganizationLocation.mobileNumber2&&a.cellNoValues.push({value:a.WSOrganizationLocation.mobileNumber2}),a.WSOrganizationLocation.landlineNumber1&&(a.landlineValues[0].value=a.WSOrganizationLocation.landlineNumber1),a.WSOrganizationLocation.landlineNumber2&&a.landlineValues.push({value:a.WSOrganizationLocation.landlineNumber2}),a.WSOrganizationLocation.locationWall1&&(a.wallValues[0].value=a.WSOrganizationLocation.locationWall1),a.WSOrganizationLocation.locationWall2&&a.wallValues.push({value:a.WSOrganizationLocation.locationWall2}),o.isNullOrEmpty(a.WSOrganizationLocation.logoDocumentId)&&!o.isNullOrEmpty(a.WSOrganizationLocation.headerLogoDocumentId)){a.logoUrl="app/images/billing/hospital.png";var f=new Object;
//fileObject.fileName = "1 (1).png";
f.fileName=a.WSOrganizationLocation.headerLogoFilePath,f.resourceId=a.WSOrganizationLocation.headerLogoDocumentId,f.docType=j.documentTypes.orgLocHeaderLogo,f.docSubType=j.documentSubTypes.orgLocHeaderLogo,f.orgLocId=a.WSOrganizationLocation.id,l.getImageUrl(f,function(b){a.headerLogoUrl=b},function(){})}else if(!o.isNullOrEmpty(a.WSOrganizationLocation.logoDocumentId)&&o.isNullOrEmpty(a.WSOrganizationLocation.headerLogoDocumentId)){a.headerLogoUrl="app/images/billing/hospital.png";var f=new Object;
//fileObject.fileName = "1 (1).png";
f.fileName=a.WSOrganizationLocation.logoFilePath,f.resourceId=a.WSOrganizationLocation.logoDocumentId,f.docType=j.documentTypes.orgLocLogo,f.docSubType=j.documentSubTypes.orgLocLogo,f.orgLocId=a.WSOrganizationLocation.id,l.getImageUrl(f,function(b){a.logoUrl=b},function(){})}else if(!o.isNullOrEmpty(a.WSOrganizationLocation.headerLogoDocumentId)&&!o.isNullOrEmpty(a.WSOrganizationLocation.logoDocumentId)){var f=new Object;
//fileObject.fileName = "1 (1).png";
f.fileName=a.WSOrganizationLocation.logoFilePath,f.resourceId=a.WSOrganizationLocation.logoDocumentId,f.docType=j.documentTypes.orgLocLogo,f.docSubType=j.documentSubTypes.orgLocLogo,f.orgLocId=a.WSOrganizationLocation.id,l.getImageUrl(f,function(b){a.logoUrl=b;var c=new Object;
//fileObject.fileName = "1 (1).png";
c.fileName=a.WSOrganizationLocation.headerLogoFilePath,c.resourceId=a.WSOrganizationLocation.headerLogoDocumentId,c.docType=j.documentTypes.orgLocHeaderLogo,c.docSubType=j.documentSubTypes.orgLocHeaderLogo,c.orgLocId=a.WSOrganizationLocation.id,l.getImageUrl(c,function(b){a.headerLogoUrl=b},function(){})},function(){})}/*baseService.getLogo('organizationlocations', $scope.WSOrganizationLocation.id);*/
a.setOrgLocId(a.orgLoc)},a.setOrgLocId=function(b){a.additionalData.orgloc=new Object,angular.copy(b,a.additionalData.orgloc)},/*$scope.$watch('eventRow', function (newValue, oldValue) {
                temp();
            });*/
a.$watch("WSOrganizationLocation.whetherLab",function(b,c){b!=c&&0==b&&(delete a.WSOrganizationLocation.whetherTakeOnlineTestOrder,delete a.WSOrganizationLocation.whetherTakeOrdersByAPI,delete a.WSOrganizationLocation.whetherTakeTestSampleHomeCollection,delete a.WSOrganizationLocation.homeCollectionStartTime,delete a.WSOrganizationLocation.homeCollectionEndTime)}),a.getStars=function(a){
// Get the value
var b=parseFloat(a),c=b/5*100;return c+"%"},a.init=function(){/*To fetch Event Record from Database*/
if(a.manageOrgLocSpinner=!0,"edit"===c.type?a.pageState="edit":"view"===c.type&&(a.pageState="view",a.disabled=!0,t(),a.findCurrentAddressOfLocation()),c.data?(o.isFieldEmpty(c.data.maxLfeThrdEmergencyADay)||o.isFieldEmpty(c.data.vecantEmergencyADay)||(a.orginalValue=c.data.maxLfeThrdEmergencyADay,a.emergenciesADay=c.data.maxLfeThrdEmergencyADay-c.data.vecantEmergencyADay),a.WSOrganizationLocation=c.data,a.manageOrgLocSpinner=!1,a.setData()):c.orgLocId&&g.getOrganizationLocationById(c.orgLocId,function(b){a.manageOrgLocSpinner=!1,a.WSOrganizationLocation=b,a.setData()},function(b){a.manageOrgLocSpinner=!1,a.error=b}),c.orgLocId){var b={orgLocId:c.orgLocId};f.fetchEventRecordToSlide(b,function(b){a.eventRecordArray=o.isFieldEmpty(b)?null:a.eventRecordArray=b[0].eventDTOs},function(b){a.error=b})}},a.findCurrentAddressOfLocation=function(){var b=c.orgLocId;!b&&c.data&&(b=c.data.id),b&&g.findCurrentAddressOfLocation(b,function(b){a.WSOrganizationLocationAddress=b},function(b){a.error=b})},a.viewEventDetails=function(a){d.go("showeventdetails",{eventId:a.id})},a.init(),a.noOfPatientsChanged=function(){o.isFieldEmpty(a.WSOrganizationLocation.maxLfeThrdEmergencyADay)||o.isFieldEmpty(a.emergenciesADay)||a.WSOrganizationLocation.maxLfeThrdEmergencyADay<=a.emergenciesADay&&(h("error",i.instant("MAX_EMERGENCIES_GREATER_THAN")+a.emergenciesADay),a.WSOrganizationLocation.maxLfeThrdEmergencyADay=a.orginalValue)},a.saveLogoDetails=function(){var b=s.getUrl("SAVE_DOCUMENT_DETAILS"),c=new Object;!o.isNullOrEmpty(a.headerLogo.fileName)&&!o.isNullOrEmpty(a.headerLogo.fileToBeUpload)&&o.isNullOrEmpty(a.logo.fileName)&&o.isNullOrEmpty(a.logo.fileToBeUpload)?(c.documentType={type:j.documentTypes.orgLocHeaderLogo,subType:j.documentSubTypes.orgLocHeaderLogo},o.isNullOrEmpty(a.headerLogo)||o.isNullOrEmpty(a.headerLogo.fileToBeUpload)||o.isNullOrEmpty(a.headerLogo.fileToBeUpload.name)||(c.fileName=a.headerLogo.fileToBeUpload.name),o.isNullOrEmpty(a.headerLogo)||o.isNullOrEmpty(a.headerLogo.fileToBeUpload)||o.isNullOrEmpty(a.headerLogo.fileToBeUpload.size)||(c.fileSize=a.headerLogo.fileToBeUpload.size),o.isNullOrEmpty(c)||o.isNullOrEmpty(c.fileSize)||o.isNullOrEmpty(c.fileName)||(c.organizationLocationId=a.WSOrganizationLocation.id,c.documentResourceType={type:"Image"}),k.saveDocumentDetails(c,b,!1,function(b){a.WSOrganizationLocation.headerLogoDocumentId=b.response,a.WSOrganizationLocation.headerLogoFilePath=c.fileName,a.uploadFile(a.headerLogo,b)},function(b){h("Error",i.instant("ERROR_WHILE_UPLOADING")),a.updateOrganizationLocation()})):o.isNullOrEmpty(a.headerLogo.fileName)&&o.isNullOrEmpty(a.headerLogo.fileToBeUpload)&&!o.isNullOrEmpty(a.logo.fileName)&&!o.isNullOrEmpty(a.logo.fileToBeUpload)?(c.documentType={type:j.documentTypes.orgLocLogo,subType:j.documentSubTypes.orgLocLogo},c.fileName=a.logo.fileToBeUpload.name,c.fileSize=a.logo.fileToBeUpload.size,o.isNullOrEmpty(c)||o.isNullOrEmpty(c.fileSize)||o.isNullOrEmpty(c.fileName)||(c.organizationLocationId=a.WSOrganizationLocation.id,c.documentResourceType={type:"Image"}),k.saveDocumentDetails(c,b,!1,function(b){a.WSOrganizationLocation.logoDocumentId=b.response,a.WSOrganizationLocation.logoFilePath=c.fileName,a.uploadFile(a.logo,b)},function(b){h("Error",i.instant("ERROR_WHILE_UPLOADING")),a.updateOrganizationLocation()})):o.isNullOrEmpty(a.headerLogo.fileName)||o.isNullOrEmpty(a.headerLogo.fileToBeUpload)||o.isNullOrEmpty(a.logo.fileName)||o.isNullOrEmpty(a.logo.fileToBeUpload)?a.updateOrganizationLocation():(c.documentType={type:j.documentTypes.orgLocLogo,subType:j.documentSubTypes.orgLocLogo},c.fileName=a.logo.fileToBeUpload.name,c.fileSize=a.logo.fileToBeUpload.size,o.isNullOrEmpty(c)||o.isNullOrEmpty(c.fileSize)||o.isNullOrEmpty(c.fileName)||(c.organizationLocationId=a.WSOrganizationLocation.id,c.documentResourceType={type:"Image"}),k.saveDocumentDetails(c,b,!1,function(b){a.WSOrganizationLocation.logoDocumentId=b.response,a.WSOrganizationLocation.logoFilePath=c.fileName,a.uploadFile(a.logo,b)},function(b){h("Error",i.instant("ERROR_WHILE_UPLOADING")),a.updateOrganizationLocation()}))},a.uploadFile=function(b,c){var d=new Object;d.file=b.fileToBeUpload,!o.isNullOrEmpty(a.headerLogo)&&!o.isNullOrEmpty(a.headerLogo.fileToBeUpload)&&o.isNullOrEmpty(a.logo)||o.isNullOrEmpty(a.logo.fileToBeUpload)?(d.docType=j.documentTypes.orgLocHeaderLogo,d.docSubType=j.documentSubTypes.orgLocHeaderLogo):o.isNullOrEmpty(a.headerLogo)||o.isNullOrEmpty(a.headerLogo.fileToBeUpload)&&!o.isNullOrEmpty(a.logo)&&!o.isNullOrEmpty(a.logo.fileToBeUpload)?(d.docType=j.documentTypes.orgLocLogo,d.docSubType=j.documentSubTypes.orgLocLogo):o.isNullOrEmpty(a.headerLogo)&&(o.isNullOrEmpty(a.headerLogo.fileToBeUpload)||o.isNullOrEmpty(a.logo)||o.isNullOrEmpty(a.logo.fileToBeUpload))||(d.docType=j.documentTypes.orgLocLogo,d.docSubType=j.documentSubTypes.orgLocLogo),d.orgLocId=a.WSOrganizationLocation.id,c.response&&(d.resourceId=c.response),l.uploadFile(d,function(b){if(o.isNullOrEmpty(a.headerLogo)||o.isNullOrEmpty(a.headerLogo.fileToBeUpload)||o.isNullOrEmpty(a.logo)||o.isNullOrEmpty(a.logo.fileToBeUpload))c.successMessage&&a.updateOrganizationLocation();else{var d=s.getUrl("SAVE_DOCUMENT_DETAILS"),e=new Object;e.documentType={type:j.documentTypes.orgLocHeaderLogo,subType:j.documentSubTypes.orgLocHeaderLogo},e.fileName=a.headerLogo.fileToBeUpload.name,e.fileSize=a.headerLogo.fileToBeUpload.size,o.isNullOrEmpty(e)||o.isNullOrEmpty(e.fileSize)||o.isNullOrEmpty(e.fileName)||(e.organizationLocationId=a.WSOrganizationLocation.id,e.documentResourceType={type:"Image"}),k.saveDocumentDetails(e,d,!1,function(b){a.WSOrganizationLocation.headerLogoDocumentId=b.response,a.WSOrganizationLocation.headerLogoFilePath=e.fileName;var d=new Object;d.file=a.headerLogo.fileToBeUpload,d.docType=j.documentTypes.orgLocHeaderLogo,d.docSubType=j.documentSubTypes.orgLocHeaderLogo,d.orgLocId=a.WSOrganizationLocation.id,b.response&&(d.resourceId=c.response),l.uploadFile(d,function(b){c.successMessage&&a.updateOrganizationLocation()},function(b){a.updateOrganizationLocation(),h("Error",i.instant("ERROR_WHILE_UPLOADING"))})},function(b){h("Error",i.instant("ERROR_WHILE_UPLOADING")),a.updateOrganizationLocation()})}},function(b){a.updateOrganizationLocation(),h("Error",i.instant("ERROR_WHILE_UPLOADING"))})},a.viewLogo=function(){if(a.WSOrganizationLocation.logoDocumentId){var b=new Object;b.fileName=a.WSOrganizationLocation.logoFilePath,
//fileObject.fileName = "1 (1).png";
b.resourceId=a.WSOrganizationLocation.logoDocumentId,b.docType=j.documentTypes.orgLocLogo,b.docSubType=j.documentSubTypes.orgLocLogo,a.fileResource=b,a.viewFileContent=!0,a.isHidingPrintButton=!1}},a.fetchCategotyLabels=function(){var b=new Array;b.push("ORG_LOCATION_CATEGORY_1"),b.push("ORG_LOCATION_CATEGORY_2"),b.push("ORG_LOCATION_CATEGORY_3"),f.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.fetchCategotyLabels()}]),angular.module("paripal.userTestModule").controller("MapSystemSummaryCtrl",["$scope","$rootScope","notify","$translate","httpService","urlService","utilService","commonConstants","baseService","$mdDialog","featurePrivilegeConstants","rowObject",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.commonConstants=h,a.mappedFields=[],a.testArray=[],a.systemFields=[{}],a.cancel=function(){j.hide()},a.addField=function(){a.systemFields.push({})},a.removeField=function(b){a.systemFields.splice(b,1),a.testArray.splice(b,1),a.mappedFields.splice(b,1)},a.getSystemSummaryField=function(b,c){var d={searchString:b};return g.isNullOrEmpty(l)||g.isNullOrEmpty(l.selectedCat)||(d.categoryId=l.selectedCat.id),e.getData(f.getParameterizedUrl("CLINICAL_DATA_LIST",d),null,function(b){if(b&&b.data)return a.clinicalDataList=b.data},function(a){})},a.onSummaryFieldSelect=function(b,e,f,h){var i=!1;angular.forEach(a.mappedFields,function(e,f){if(f==h){i=!0;var g={};g=b,g.id=null,g.location=a.defOrgLoc,a.testArray[f]=b,a.mappedFields[f]=g}else e&&b.clinicalData.id==e.clinicalData.id&&(i=!0,angular.forEach(a.testArray,function(e,f){b.id==e.id&&(delete a.testArray[h],delete a.mappedFields[h],a.systemFields.splice(h,1),a.testArray=a.testArray.filter(function(a){return void 0!=a}),a.mappedFields=a.mappedFields.filter(function(a){return void 0!=a}),c("error",d.instant("FIELD_ALREADY_SELECTED")))}))}),0==i&&(g.isNullOrEmpty(b)||a.mappedFields.push({clinicalData:b.clinicalData,id:null,location:a.defOrgLoc}))},a.submitClinicalData=function(){b.showSpinner=!0;var h=angular.copy(a.mappedFields),i={};g.isNullOrEmpty(l)||g.isNullOrEmpty(l.selectedCat)||(i.categoryId=l.selectedCat.id),e.postData(f.getParameterizedUrl("SAVE_CLINICAL_DATA_LOCATION_MAPPING",i),h,function(a){b.showSpinner=!1,c("success",d.instant("MAPPED_SUCCESSFULLY")),j.hide()},function(a){b.showSpinner=!1})};var m=function(){if(g.isNullOrEmpty(l)){var c=i.getDefaultOrgLocation();g.isFieldEmpty(c)||(a.defOrgLoc=c.orgLoc)}else a.defOrgLoc={},g.isNullOrEmpty(l.id)||(a.defOrgLoc.id=l.id),g.isNullOrEmpty(l.displayName)||(a.defOrgLoc.value=l.displayName),g.isNullOrEmpty(l.locationCode)||(a.defOrgLoc.code=l.locationCode);var d={};d.locationId=a.defOrgLoc.id,g.isNullOrEmpty(l)||g.isNullOrEmpty(l.selectedCat)||(d.category=l.selectedCat.id),b.showSpinner=!0,e.getData(f.getParameterizedUrl("GET_CLINICAL_DATA_LOCATION_MAPPING",d),null,function(c){b.showSpinner=!1,c&&c.data&&(a.mappedFields=angular.copy(c.data),a.testArray=angular.copy(c.data),a.systemFields=angular.copy(c.data),0==a.systemFields.length?a.whetherRmvVisible=!0:a.whetherRmvVisible=!1)},function(a){b.showSpinner=!1})};m()}]),angular.module("paripal.manageOrganisationLocation").controller("OrgLocCardCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","baseService","orgLocListService","notify","$translate","serverSidePagination","$mdDialog","utilService","NgMap","httpService","urlService","SearchHospitalService","commonConstants","$timeout","manageRequestService","GoogleMap","GeoCoder","commonCalendarService","$window","fileOperations",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";function y(a,b,c){a.services=c,a.cancel=function(){b.hide()}}function z(a,c,d,e,f,g,j,k,m,p,q,r){a.requestType=d,a.cancel=function(){c.cancel()},/*$scope.createRequest = angular.copy(filterCriteria);*/
a.getTreatmentType=function(b){var c;return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,"HOME_VISITS"!=d&&"ONLINE_CONSULTATION"!=d&&"REQ_URGENT_CLARIFICATION"!=d||(c="TREATMENT_TYPE"),"REQ_MEDICAL_CERTIFICATE"!=d&&"OTHER_REQUESTS"!=d&&"MEDICINE_AVAILABILITY"!=d||(c="GET_SUPPORT_SERVICE_TREATMENT_TYPE_BY_KEY_WORD"),n.getData(o.getParameterizedUrl(c,a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SERACH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.getOnBehalfOf=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d;
//var url='GET_PATIENTS_LIST_BY_SEACRH_KEY';
return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),n.getData(o.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,b.data&&0==b.data.length&&h("error",i.instant("INVALID_USER")),a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},a.saveRequest=function(){b.showSpinner=!0,r&&!q&&(a.createRequest.organization={id:r.id,value:r.displayName}),a.createRequest.requestDate=k("date")(new Date,"yyyy-MM-dd");var d=m.getLoggedInUser();a.createRequest.initiator={id:d.id,value:d.displayName},a.createRequest.requestStatus=f,a.createRequest.requestsType=g,a.createRequest.broadcast=q,p.countryValue&&(a.createRequest.requestToBeLimitedToCountry=p.countryValue),p.stateValue&&(a.createRequest.requestToBeLimitedToState=p.stateValue),p.districtValue&&(a.createRequest.requestToBeLimitedToDistrict=p.districtValue),p.cityValue&&(a.createRequest.requestToBeLimitedToCity=p.cityValue),e.save(a.createRequest,function(a){b.showSpinner=!1,h("success",i.instant("MSG_WITH_REQUEST_ID")+a.response.requestId),c.cancel()},function(a){b.showSpinner=!1})}}/*$scope.init();*/
function A(a,b,c,d,e,f,g){a.activationListResult=d,a.isInactive=e,a.inactiveMsg=f,a.orgLocId=c,a.orgLocListService=g,a.reason={},a.reason.value={},a.hide=function(){b.hide()},a.inactivate=function(){g.inActivate(a.orgLocId,a.reason,function(b){a.inactiveMsg=i.instant("INACTIVATION_SUCCESS")}),a.isInactive=!0},a.ok=function(){b.cancel()}}y.$inject=["$scope","$mdDialog","services"],z.$inject=["$scope","$mdDialog","requestType","manageRequestService","requestStatus","requestsType","filterCriteria","$filter","baseService","addressInfoFilter","broadcast","row"],A.$inject=["$scope","$mdDialog","orgLocId","activationListResult","isInactive","inactiveMsg","orgLocListService"],a.commonConstants=q,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.currentLocation="current-location",a.organizationLocationsList=[],a.WSOrganizationLocationSearchCriteria={},a.filterCriteria={},a.filterCriteria.organization={},a.filterCriteria.radius=2e3,a.filterCriteria.slider=2,a.error={},a.addressInfo={},a.orgType={},a.addressInfoFilter={},a.orgTypeFilter={},a.orgTypeFilter.dataValue={},a.status={},a.status.AND="true",a.status.OR="false",a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.mapVisibility="hide-map",a.isMapVisible=!1,a.professionalTypes=[{id:"SUPPORT_PROFESSIONAL",value:"SUPPORT_SERVICE_PROFESSIONAL"},{id:"HEALTH_PROFESSIONAL",value:"HEALTH_SERVICE_PRO"}],m.getMap().then(function(b){r(function(){a.map=b},0),b.addListener("zoom_changed",function(){12!==b.getZoom()&&a.whetherSetToDefalut&&(a.whetherSetToDefalut=!1,b.setZoom(12))})}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},/* changes for card view START */
a.viewLogo=function(a){if(a.logoDocumentId){var b=new Object;b.fileName=a.logoFilePath,b.resourceId=a.logoDocumentId,b.docType=q.documentTypes.orgLocLogo,b.docSubType=q.documentSubTypes.orgLocLogo,b.orgLocId=a.id,x.getImageUrl(b,function(b){a.logoUrl=b},function(){})}else a.logoUrl="../../images/billing/hospital.png"},a.showServices=function(a){var a=a;k.show({controller:y,templateUrl:"app/modules/manage-organisation-location-users/views/show-services-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{services:a}})},a.getTreatmentTypes=function(a){var b="";return angular.forEach(a,function(a,c){b=0==c?a:b+","+a}),b},a.getStatuses=function(a){var b="";return angular.forEach(a,function(a,c){b=0==c?a:b+","+a}),b},a.getStars=function(a){
// Get the value
var b=parseFloat(a),c=b/5*100;return c+"%"},a.getDirections=function(b){if(!l.isNullOrEmpty(b)&&!l.isNullOrEmpty(a.currentLocation))var c=a.currentLocation,d=b;var e=!!window.cordova;e?window.location.href="https://www.google.com/maps/search/?api=1&query="+d:w.open("http://maps.google.com/maps?saddr="+c+"&daddr="+d,"_blank")},/* changes for card view END */
a.broadcastFor=function(c){if(b.showSpinner=!0,a.type=c,a.broadcast=!0,a.rowObj=null,"HOME_VISITS"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_HOME_VISIT",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}if("ONLINE_CONSULTATION"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_ONLINE_ADVICE",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}if("OTHER_REQUESTS"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_OTHER_REQUEST",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}if("MEDICINE_AVAILABILITY"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_MEDICINE_AVAILABILITY",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}},a.requestForCertificate=function(c){a.rowObj=c,a.broadcast=!1,b.showSpinner=!0,a.selectedUser=c,a.type="REQ_MEDICAL_CERTIFICATE";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_MEDICAL_CERTIFICATE",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.viewLocationTreatmentType=function(a){var b={id:a.organizationId,value:a.organizationDisplayName},a={id:a.id,value:a.displayName};d.go("locationTreatmentList",{organization:b,organizationLoc:a})},a.viewLocationUsers=function(a,b){/*var organization = {
                id: orgLocation.organizationId,
                value: orgLocation.organizationDisplayName
            };
            var orgLocation = {
                id: orgLocation.id,
                value: orgLocation.displayName
            };
            $state.go("orglocuserlist", {
                organization: organization,
                orgLocation: orgLocation
            });*/
var c={};"Doctors"==a?c.type="healthProfessional":"OtherProfessionals"==a&&(c.type="supportServiceProfessional"),l.isNullOrEmpty(b)||l.isNullOrEmpty(b.organizationId)||l.isNullOrEmpty(b.organizationDisplayName)||(c.organization={id:b.organizationId,value:b.organizationDisplayName}),l.isNullOrEmpty(b)||l.isNullOrEmpty(b.displayName)||l.isNullOrEmpty(b.id)||(c.orglocation={id:b.id,value:b.displayName}),d.go("orglocusercard",{wallData:c})},a.requestForHomeVisit=function(c){a.rowObj=c,a.broadcast=!1,b.showSpinner=!0,a.selectedUser=c,a.type="HOME_VISITS";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_HOME_VISIT",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.getProfessionalTypes=function(){a.professionalTypesData=[],a.professionalSubTypeData=[],a.filterCriteria.specializationId=null,a.filterCriteria.subSpecializationId=null;var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=o.getUrl("GET_HEALTH_PROFESSIONAL_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=o.getUrl("GET_SUPPORT_PROFESSIONAL_TYPES")),n.getData(b,null,function(b){a.professionalTypesData=angular.fromJson(b.data)},function(){})},a.getProfessionalSubType=function(){var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=o.getUrl("GET_HEALTH_PROFESSIONAL_SUB_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=o.getUrl("GET_SUPPORT_PROFESSIONAL_SUB_TYPES")),b+=a.filterCriteria.specializationId.id,n.getData(b,null,function(b){a.professionalSubTypeData=angular.fromJson(b.data)},function(){})},a.onProfessionalSubTypeSelect=function(a){},a.openPopup=function(){k.show({controller:z,templateUrl:"app/modules/manage-organisation-locations/views/create-request-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{requestType:a.type,manageRequestService:s,requestStatus:a.requestStatus,requestsType:a.requestsType,filterCriteria:a.filterCriteria,baseService:f,addressInfoFilter:a.addressInfoFilter,broadcast:a.broadcast,row:a.rowObj}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.changeRadius=function(){a.filterCriteria.radius=1e3*a.filterCriteria.slider,a.fetchRecords()},a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=o.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getDiseaseVariant=function(b){var c={};/*searchKeyWord.diseaseId = $scope.filterCriteria.disease.id;*/
return c.searchKeyword=b,a.diseaseVariantLoad=!0,n.getData(o.getParameterizedUrl("GET_DISEASE_VARIANT_BY_KEY",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||h("error",i.instant(b.data.messages[0]))})},a.getSymptom=function(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,n.getData(o.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SEARCH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.goToProcessCalendar=function(a){if(a.calendarEntityInfo&&a.calendarEntityInfo.calendarMasterId){b.showSpinner=!0;var c={calendarId:a.calendarEntityInfo.calendarMasterId,entityTypeCode:"CAL_PROCESS",entityId:a.calendarEntityInfo.calendarEntityId};v.getCalendarDetailsById(c,function(a){b.showSpinner=!1,d.go("processcalendarview",{type:"regular",data:a})},function(a){b.showSpinner=!1})}},a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.searchOrganizationLocations=function(b){a.WSOrganizationLocationSearchCriteria.pageNumber=a.currentPage,a.WSOrganizationLocationSearchCriteria.radius||a.isMapVisible?a.WSOrganizationLocationSearchCriteria.recordsPerPage=25:a.WSOrganizationLocationSearchCriteria.recordsPerPage=a.itemPerPage,a.WSOrganizationLocationSearchCriteria.addressLattitudes&&a.WSOrganizationLocationSearchCriteria.addressLongitudes||(a.WSOrganizationLocationSearchCriteria.addressLattitudes=a.filterCriteria.addressLattitudes,a.WSOrganizationLocationSearchCriteria.addressLongitudes=a.filterCriteria.addressLongitudes);var c="";!l.isFieldEmpty(a.addressInfo.cityValue)&&a.isFiltered?c+=a.addressInfo.cityValue.value:!l.isFieldEmpty(a.addressInfo.city)&&a.isFiltered&&(c+=a.addressInfo.city.value),l.isFieldEmpty(a.addressInfo.postalCode)||(c=l.isFieldEmpty(c)?a.addressInfo.postalCode.toString():c+" "+a.addressInfo.postalCode),l.isFieldEmpty(c)?a.getFilteredResult():(a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=c),u.geocode({address:c}).then(function(b){a.currentLocation=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.filterCriteria.addressLattitudes=b[0].geometry.location.lat(),a.filterCriteria.addressLongitudes=b[0].geometry.location.lng(),a.WSOrganizationLocationSearchCriteria.addressLattitudes=b[0].geometry.location.lat(),a.WSOrganizationLocationSearchCriteria.addressLongitudes=b[0].geometry.location.lng(),a.currentLocationObject.location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()]),a.getFilteredResult()}))},a.getFilteredResult=function(){a.addressInfo.whetherMapView=a.isMapVisible,a.orgloclistSpinner=!0,a.addressInfo.isFiltered=a.isFiltered,g.searchOrganizationLocationCards(a.WSOrganizationLocationSearchCriteria,a.addressInfo,a.orgType,function(b){a.orgloclistSpinner=!1,a.organizationLocationsCards=b.data,angular.forEach(a.organizationLocationsCards,function(b,c){a.viewLogo(b)}),r(function(){angular.forEach(a.organizationLocationsCards,function(a,b){var c="divclass"+a.id,d=$("."+c),e=d.clone().css({display:"inline",width:"auto",visibility:"hidden"}).appendTo("body");e.width()>d.width()?d.find(".showMoreBtn").show():d.find(".showMoreBtn").hide()})},500),a.totalItems=b.totalRecords,a.itemPerPage=b.recordsPerPage,/*$scope.currentPage = sucessResponse.pageNumber;*/
a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),
//notify("success", $translate.instant("ORG_LOC_LIST_SUCCESS"));
a.WSOrganizationLocationSearchCriteria.whetherAllStatus&&a.WSOrganizationLocationSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus="true":a.filterCriteria.whetherAllStatus="false",delete a.filterCriteria.organizationId},function(b){a.orgloclistSpinner=!1,a.error=b,delete a.filterCriteria.organizationId})},a.fetchFilteredRecords=function(b){a.isFiltered=b,a.fetchRecords()},a.subscriptionFilterChanged=function(){a.fetchRecords()},a.fetchRecords=function(){angular.copy(a.filterCriteria,a.WSOrganizationLocationSearchCriteria),a.filterCriteria.specializationId&&(a.WSOrganizationLocationSearchCriteria.specializationId=a.filterCriteria.specializationId.id),a.filterCriteria.subSpecializationId&&(a.WSOrganizationLocationSearchCriteria.subSpecializationId=a.filterCriteria.subSpecializationId.id),a.WSOrganizationLocationSearchCriteria.radius=a.WSOrganizationLocationSearchCriteria.radius/1e3,l.isFieldEmpty(a.WSOrganizationLocationSearchCriteria.organization)||(a.WSOrganizationLocationSearchCriteria.organizationId=a.WSOrganizationLocationSearchCriteria.organization.data.id),delete a.WSOrganizationLocationSearchCriteria.organization,a.isMapVisible||delete a.WSOrganizationLocationSearchCriteria.radius,a.filterCriteria.organizationSpecificationTypeId&&a.filterCriteria.organizationSpecificationTypeId.dataValue?a.WSOrganizationLocationSearchCriteria.organizationSpecificationTypeId=a.filterCriteria.organizationSpecificationTypeId.dataValue.id:delete a.WSOrganizationLocationSearchCriteria.organizationSpecificationTypeId,a.addressInfo=a.addressInfoFilter,a.orgType=a.orgTypeFilter,a.searchOrganizationLocations()},a.selectHospital=function(b,c){a.whetherSetToDefalut=!0,a.destination=c.addressLattitudes+","+c.addressLongitudes,0!==c.organizationLocationAddressId&&(c.whetherSubscriberOrganization&&(a.selectedId=c.id),a.selectedHospital=c,a.map.showInfoWindow("bar","id_"+c.id)),a.hideDetail()},a.unconfirm=function(){a.selectedId=null,a.selectedAddress=null,a.map.hideInfoWindow("bar"),a.destination=a.currentLocation,a.whetherSetToDefalut=!0},a.hideDetail=function(){"calledFromEmergencyTransaction"!==c.type?a.map.hideInfoWindow("foo-iw"):"changeEmergencyLocation"!==c.caller?a.map.hideInfoWindow("foo-iw"):0!==a.address.organizationLocationAddressId&&a.map.hideInfoWindow("foo-iw")},a.showDetails=function(b,c){0!=c.id&&(c.id!==a.selectedId?(a.address=c,c.organizationLocationAddressId&&a.map.showInfoWindow("foo-iw","id_"+c.id),a.map.hideInfoWindow("bar")):(a.selectHospital(b,c),a.hideDetail()))},a.clear=function(){a.isFiltered=!1,a.WSOrganizationLocationSearchCriteria={},a.addressInfo={},a.orgType={};var b=a.filterCriteria.addressLattitudes,c=a.filterCriteria.addressLongitudes;a.filterCriteria={},a.filterCriteria.addressLattitudes=b,a.filterCriteria.addressLongitudes=c,a.filterCriteria.organization={},a.addressInfoFilter={},
//$scope.orgTypeFilter.dataValue = {};
a.$broadcast("clearStatusData"),a.$broadcast("clearPicklistData"),a.$broadcast("clearOrgOrgLocType"),a.$broadcast("clearAddressData"),a.searchOrganizationLocations()},
//Add new Organisation
a.addNewOrgLoc=function(){d.go("addorgloc",{type:""})},
//View Organization Location Address
a.viewOrgLocationAddressList=function(a,b,c,e,f){var g={type:"",organization:{id:a,displayName:b},organizationLocation:{id:c,displayName:e},wallData:{whetherSubscriberOrganization:f.whetherSubscriberOrganization}};d.go("orgLocationAddressList",g)},
//View follow up setting
a.viewFollowUpSetting=function(a,b,c,e){var f={type:null,organization:{id:a,value:b},organizationLocation:{id:c,value:e}};d.go("followUpSettingsList",f)},a.listOrgs=function(a,b,c){var e={};e.dataValue={},e.dataValue.id=a,e.dataValue.value=b,d.go("manageorg",{orgId:c,orgLoc:e,type:"view"})},
//Edit new Organisation
a.manageOrgLoc=function(b,c){a.orgLocListPageSpinner=!0,g.getOrganizationLocationById(b,function(e){a.orgLocListPageSpinner=!1;var f="view",g="manageorglocView";c&&(f="edit",g="manageorgloc");var h=e;d.go(g,{type:f,data:h,orgLocId:b})},function(b){a.orgLocListPageSpinner=!1,a.error=b,h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},
//Server side pagination module
a.pageChanged=function(b){a.currentPage=b,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchOrganizationLocations()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchOrganizationLocations()};
//datatble config json
var B={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(B),a.dtColumnDefs=e.setColumnProperties({});var C=function(b){n.getJsonData(o.getJsonFileUrl("ORGANIZATION_TYPE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),D())},function(a){})},D=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){var c=new google.maps.Geocoder,d=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);c.geocode({latLng:d},function(b,c){a.currLocationAddress=b[0].formatted_address,a.currAddressArray=a.currLocationAddress.split(","),a.currCountry=a.currAddressArray[a.currAddressArray.length-1],a.currState=a.currAddressArray[a.currAddressArray.length-2].substring(0,a.currAddressArray[a.currAddressArray.length-2].lastIndexOf(" ")),a.currCity=a.currAddressArray[a.currAddressArray.length-3];var d={countryValue:a.currCountry.trim(),stateValue:a.currState.trim(),cityValue:a.currCity.trim()};g.fetchAddressDetailsByGPS(d,function(b){a.addressInfoFilter.country=b.data.country,a.addressInfoFilter.state=b.data.state,a.addressInfoFilter.district=b.data.district,a.addressInfoFilter.city=b.data.city},function(a){})}),E(b.coords.latitude,b.coords.longitude)})},function(b){t.getUsersCoordinates(b,function(b){E(b.coords.latitude,b.coords.longitude,!0),a.currentLocation=[parseFloat(b.coords.latitude),parseFloat(b.coords.longitude)]}),console.log(b)})};a.onMapLoaded=function(){r(function(){m.getMap({id:"my_map"}).then(function(a){google.maps.event.trigger(a,"resize")})},500)};var E=function(b,c){a.filterCriteria.addressLattitudes=b,a.filterCriteria.addressLongitudes=c;var d={latLng:new google.maps.LatLng(b,c)};a.changeLocation(d),a.organizationLocationsList=[],a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,displayName:"You are here",id:0},a.organizationLocationsList.push(a.currentLocationObject),a.init()};a.changeLocation=function(b){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filterCriteria.addressLattitudes=b.latLng.lat(),a.filterCriteria.addressLongitudes=b.latLng.lng(),a.locationChanged=!0,a.isFiltered=!1,p.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,addressLattitudes:b.latLng.lat(),addressLongitudes:b.latLng.lng()}}),a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,id:0,displayName:"You dragged here"},a.fetchRecords()},a.goToWall=function(a){d.go("manageorglocView",{orgLocId:a,type:"view"})},a.goToMapClinicalData=function(a,b){var c=a;c.selectedCat=b,k.show({controller:"MapSystemSummaryCtrl",templateUrl:"app/modules/manage-organisation-locations/views/map-system-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{rowObject:c}})},a.init=function(){if(a.timing=(new Date).getTime(),a.onMapLoaded(),a.mapVisibility="hide-map",b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?(a.isMapVisible=!1,a.buttonText=i.instant("SHOW_MAP"),a.mapVisibility="hide-map"):(a.isMapVisible=!1,a.buttonText=i.instant("SHOW_MAP")),a.getSpecializations(),a.getSubbranch(),/*NgMap.initMap('Map');*/
c.org&&(a.filterCriteria.organizationId=c.org.dataValue.id),c.wallData&&(a.filterCriteria.organization.data=c.wallData.organization),c.searchType){var d=c.searchType;"Hospital"==d?(a.filterCriteria.whetherHasHospital=!0,a.filterCriteria.whetherClinic=!0,a.filterCriteria.whetherHealthServiceProvider=!0):"Lab"==d?a.filterCriteria.whetherLab=!0:"Pharmacies"==d?a.filterCriteria.whetherPharmacy=!0:"OtherServiceProviders"==d?a.filterCriteria.whetherOtherHealthServiceProvider=!0:"NGOs"==d?(a.filterCriteria.whetherNGO=!0,a.filterCriteria.whetherSponsor=!0):"serviceProvider"==d&&(a.filterCriteria.viewSubscribedLoc=!0)}a.fetchRecords();var e=f.getLocationCategory();l.isFieldEmpty(e)||("SERVICE_PROVIDER_HO"==e.code?a.whetherHO=!0:a.whetherHO=!1),n.getData(o.getUrl("CLINICAL_CAT_LIST"),null,function(b){a.clinicalCatList=angular.fromJson(b.data)},function(){})},C(),a.activate=function(b){var c=i.instant("ORG_LOC_NOT_ACTIVATED");g.activate(b,function(b){b.whetherActivated&&(c=i.instant("ACTIVATION_SUCCESS"));var d={activationListResult:b,isInactive:b.whetherActivated,inactiveMsg:c,orgLocId:null,orgLocListService:null,parentScope:a};a.showModal(A,"app/modules/manage-organisation-locations/views/activationTemplate.html",d)},function(b){var d={activationListResult:b,isInactive:!0,inactiveMsg:c,orgLocId:null,orgLocListService:null,parentScope:a};a.showModal(A,"app/modules/manage-organisation-locations/views/activationTemplate.html",d)})},a.inActivate=function(b){var c={orgLocId:b,isInactive:!1,inactiveMsg:i.instant("INACTIVATION_FAILED_REASON"),activationListResult:null,orgLocListService:g,parentScope:a};a.showModal(A,"app/modules/manage-organisation-locations/views/inActivatationTemplate.html",c)},a.showModal=function(a,b,c){var d;k.show({controller:A,templateUrl:b,parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:q.dialogBox.clickOutsideToClose,
// fullscreen: useFullScreen,
locals:c}).then(function(){c.parentScope.fetchRecords()},function(){c.parentScope.fetchRecords()})},a.toggleMap=function(){if(/*$state.reload();*/
a.isMapVisible=!a.isMapVisible,1==a.isMapVisible?(a.buttonText=i.instant("SHOW_LIST"),a.mapVisibility="show-map"):(a.buttonText=i.instant("SHOW_MAP"),a.mapVisibility="hide-map"),c.org&&(a.filterCriteria.organizationId=c.org.dataValue.id),c.wallData&&(a.filterCriteria.organization.data=c.wallData.organization),c.searchType){var b=c.searchType;"Hospital"==b&&(a.filterCriteria.whetherHasHospital=!0)}a.fetchRecords()},a.goToTestOrderScreen=function(a,c){var e={};/*paramObj.user = {
                id: userId,
                value: userName
            };*/
b.loggedInUserDetails.isOrganizationUser||b.loggedInUserDetails.isOrganizationUserMode||(e.testConductedAtOrg={id:a.organizationId,value:a.organizationDisplayName},e.testConductedAt={id:a.id,value:a.displayName}),"addUserTestOrder"==c?d.go("testorder",{pageState:"fromLoc",data:e}):d.go("testorderlist",{pageState:"add"})},a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")}}]),angular.module("paripal.manageOrganisationLocation").controller("OrgLocListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","baseService","orgLocListService","notify","$translate","serverSidePagination","$mdDialog","utilService","NgMap","httpService","urlService","SearchHospitalService","commonConstants","$timeout","manageRequestService","GoogleMap","GeoCoder","commonCalendarService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";function w(a,c,d,e,f,g,j,k,m,p,q,r){a.requestType=d,a.cancel=function(){c.cancel()},/*$scope.createRequest = angular.copy(filterCriteria);*/
a.getTreatmentType=function(b){var c;return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,"HOME_VISITS"!=d&&"ONLINE_CONSULTATION"!=d&&"REQ_URGENT_CLARIFICATION"!=d||(c="TREATMENT_TYPE"),"REQ_MEDICAL_CERTIFICATE"!=d&&"OTHER_REQUESTS"!=d&&"MEDICINE_AVAILABILITY"!=d||(c="GET_SUPPORT_SERVICE_TREATMENT_TYPE_BY_KEY_WORD"),n.getData(o.getParameterizedUrl(c,a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SERACH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.getOnBehalfOf=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d;
//var url='GET_PATIENTS_LIST_BY_SEACRH_KEY';
return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),n.getData(o.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,b.data&&0==b.data.length&&h("error",i.instant("INVALID_USER")),a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},a.saveRequest=function(){b.showSpinner=!0,r&&!q&&(a.createRequest.organization={id:r.id,value:r.displayName}),a.createRequest.requestDate=k("date")(new Date,"yyyy-MM-dd");var d=m.getLoggedInUser();a.createRequest.initiator={id:d.id,value:d.displayName},a.createRequest.requestStatus=f,a.createRequest.requestsType=g,a.createRequest.broadcast=q,p.countryValue&&(a.createRequest.requestToBeLimitedToCountry=p.countryValue),p.stateValue&&(a.createRequest.requestToBeLimitedToState=p.stateValue),p.districtValue&&(a.createRequest.requestToBeLimitedToDistrict=p.districtValue),p.cityValue&&(a.createRequest.requestToBeLimitedToCity=p.cityValue),e.save(a.createRequest,function(a){b.showSpinner=!1,h("success",i.instant("MSG_WITH_REQUEST_ID")+a.response.requestId),c.cancel()},function(a){b.showSpinner=!1})}}/*$scope.init();*/
function x(a,b,c,d,e,f,g){a.activationListResult=d,a.isInactive=e,a.inactiveMsg=f,a.orgLocId=c,a.orgLocListService=g,a.reason={},a.reason.value={},a.hide=function(){b.hide()},a.inactivate=function(){g.inActivate(a.orgLocId,a.reason,function(b){a.inactiveMsg=i.instant("INACTIVATION_SUCCESS")}),a.isInactive=!0},a.ok=function(){b.cancel()}}w.$inject=["$scope","$mdDialog","requestType","manageRequestService","requestStatus","requestsType","filterCriteria","$filter","baseService","addressInfoFilter","broadcast","row"],x.$inject=["$scope","$mdDialog","orgLocId","activationListResult","isInactive","inactiveMsg","orgLocListService"],a.commonConstants=q,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.currentLocation="current-location",a.organizationLocationsList=[],a.WSOrganizationLocationSearchCriteria={},a.filterCriteria={},a.filterCriteria.organization={},a.filterCriteria.radius=2e3,a.filterCriteria.slider=2,a.error={},a.addressInfo={},a.orgType={},a.addressInfoFilter={},a.orgTypeFilter={},a.orgTypeFilter.dataValue={},a.status={},a.status.AND="true",a.status.OR="false",a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.mapVisibility="show-map",a.isMapVisible=!0,a.professionalTypes=[{id:"SUPPORT_PROFESSIONAL",value:"SUPPORT_SERVICE_PROFESSIONAL"},{id:"HEALTH_PROFESSIONAL",value:"HEALTH_SERVICE_PRO"}],m.getMap().then(function(b){r(function(){a.map=b},0),b.addListener("zoom_changed",function(){12!==b.getZoom()&&a.whetherSetToDefalut&&(a.whetherSetToDefalut=!1,b.setZoom(12))})}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.broadcastFor=function(c){if(b.showSpinner=!0,a.type=c,a.broadcast=!0,a.rowObj=null,"HOME_VISITS"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_HOME_VISIT",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}if("ONLINE_CONSULTATION"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_ONLINE_ADVICE",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}if("OTHER_REQUESTS"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_OTHER_REQUEST",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}if("MEDICINE_AVAILABILITY"===c){var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_MEDICINE_AVAILABILITY",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}}},a.requestForCertificate=function(c){a.rowObj=c,a.broadcast=!1,b.showSpinner=!0,a.selectedUser=c,a.type="REQ_MEDICAL_CERTIFICATE";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_MEDICAL_CERTIFICATE",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.viewLocationTreatmentType=function(a){var b={id:a.organizationId,value:a.organizationDisplayName},a={id:a.id,value:a.displayName};d.go("locationTreatmentList",{organization:b,organizationLoc:a})},a.viewLocationUsers=function(a){var b={id:a.organizationId,value:a.organizationDisplayName},a={id:a.id,value:a.displayName};d.go("orglocuserlist",{organization:b,orgLocation:a})},a.requestForHomeVisit=function(c){a.rowObj=c,a.broadcast=!1,b.showSpinner=!0,a.selectedUser=c,a.type="HOME_VISITS";var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode="REQ_HOME_VISIT",s.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",s.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.getProfessionalTypes=function(){a.professionalTypesData=[],a.professionalSubTypeData=[],a.filterCriteria.specializationId=null,a.filterCriteria.subSpecializationId=null;var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=o.getUrl("GET_HEALTH_PROFESSIONAL_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=o.getUrl("GET_SUPPORT_PROFESSIONAL_TYPES")),n.getData(b,null,function(b){a.professionalTypesData=angular.fromJson(b.data)},function(){})},a.getProfessionalSubType=function(){var b="";"HEALTH_PROFESSIONAL"==a.filterCriteria.professionalType?b=o.getUrl("GET_HEALTH_PROFESSIONAL_SUB_TYPES"):"SUPPORT_PROFESSIONAL"==a.filterCriteria.professionalType&&(b=o.getUrl("GET_SUPPORT_PROFESSIONAL_SUB_TYPES")),b+=a.filterCriteria.specializationId.id,n.getData(b,null,function(b){a.professionalSubTypeData=angular.fromJson(b.data)},function(){})},a.onProfessionalSubTypeSelect=function(a){},a.openPopup=function(){k.show({controller:w,templateUrl:"app/modules/manage-organisation-locations/views/create-request-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{requestType:a.type,manageRequestService:s,requestStatus:a.requestStatus,requestsType:a.requestsType,filterCriteria:a.filterCriteria,baseService:f,addressInfoFilter:a.addressInfoFilter,broadcast:a.broadcast,row:a.rowObj}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},a.changeRadius=function(){a.filterCriteria.radius=1e3*a.filterCriteria.slider,a.fetchRecords()},a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=o.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getDiseaseVariant=function(b){var c={};/*searchKeyWord.diseaseId = $scope.filterCriteria.disease.id;*/
return c.searchKeyword=b,a.diseaseVariantLoad=!0,n.getData(o.getParameterizedUrl("GET_DISEASE_VARIANT_BY_KEY",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||h("error",i.instant(b.data.messages[0]))})},a.getSymptom=function(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,n.getData(o.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SEARCH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.goToProcessCalendar=function(a){if(a.calendarEntityInfo&&a.calendarEntityInfo.calendarMasterId){b.showSpinner=!0;var c={calendarId:a.calendarEntityInfo.calendarMasterId,entityTypeCode:"CAL_PROCESS",entityId:a.calendarEntityInfo.calendarEntityId};v.getCalendarDetailsById(c,function(a){b.showSpinner=!1,d.go("processcalendarview",{type:"regular",data:a})},function(a){b.showSpinner=!1})}},a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.searchOrganizationLocations=function(b){a.WSOrganizationLocationSearchCriteria.pageNumber=a.currentPage,a.WSOrganizationLocationSearchCriteria.radius||a.isMapVisible?a.WSOrganizationLocationSearchCriteria.recordsPerPage=25:a.WSOrganizationLocationSearchCriteria.recordsPerPage=a.itemPerPage,a.WSOrganizationLocationSearchCriteria.addressLattitudes&&a.WSOrganizationLocationSearchCriteria.addressLongitudes||(a.WSOrganizationLocationSearchCriteria.addressLattitudes=a.filterCriteria.addressLattitudes,a.WSOrganizationLocationSearchCriteria.addressLongitudes=a.filterCriteria.addressLongitudes);var c="";!l.isFieldEmpty(a.addressInfo.cityValue)&&a.isFiltered?c+=a.addressInfo.cityValue.value:!l.isFieldEmpty(a.addressInfo.city)&&a.isFiltered&&(c+=a.addressInfo.city.value),l.isFieldEmpty(a.addressInfo.postalCode)||(c=l.isFieldEmpty(c)?a.addressInfo.postalCode.toString():c+" "+a.addressInfo.postalCode),l.isFieldEmpty(c)?a.getFilteredResult():(a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=c),u.geocode({address:c}).then(function(b){a.currentLocation=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.filterCriteria.addressLattitudes=b[0].geometry.location.lat(),a.filterCriteria.addressLongitudes=b[0].geometry.location.lng(),a.WSOrganizationLocationSearchCriteria.addressLattitudes=b[0].geometry.location.lat(),a.WSOrganizationLocationSearchCriteria.addressLongitudes=b[0].geometry.location.lng(),a.currentLocationObject.location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.organizationLocationsList[0]&&(a.organizationLocationsList[0].location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()]),a.getFilteredResult()}))},a.getFilteredResult=function(){a.addressInfo.whetherMapView=a.isMapVisible,a.orgloclistSpinner=!0,a.addressInfo.isFiltered=a.isFiltered,g.searchOrganizationLocations(a.WSOrganizationLocationSearchCriteria,a.addressInfo,a.orgType,function(b){a.orgloclistSpinner=!1,a.organizationLocationsList=b.data,a.totalItems=b.totalRecords,a.itemPerPage=b.recordsPerPage,/*$scope.currentPage = sucessResponse.pageNumber;*/
a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),
//notify("success", $translate.instant("ORG_LOC_LIST_SUCCESS"));
a.WSOrganizationLocationSearchCriteria.whetherAllStatus&&a.WSOrganizationLocationSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus="true":a.filterCriteria.whetherAllStatus="false",delete a.filterCriteria.organizationId},function(b){a.orgloclistSpinner=!1,a.error=b,delete a.filterCriteria.organizationId})},a.fetchFilteredRecords=function(b){a.isFiltered=b,a.fetchRecords()},a.subscriptionFilterChanged=function(){a.fetchRecords()},a.fetchRecords=function(){angular.copy(a.filterCriteria,a.WSOrganizationLocationSearchCriteria),a.filterCriteria.specializationId&&(a.WSOrganizationLocationSearchCriteria.specializationId=a.filterCriteria.specializationId.id),a.filterCriteria.subSpecializationId&&(a.WSOrganizationLocationSearchCriteria.subSpecializationId=a.filterCriteria.subSpecializationId.id),a.WSOrganizationLocationSearchCriteria.radius=a.WSOrganizationLocationSearchCriteria.radius/1e3,l.isFieldEmpty(a.WSOrganizationLocationSearchCriteria.organization)||(a.WSOrganizationLocationSearchCriteria.organizationId=a.WSOrganizationLocationSearchCriteria.organization.data.id),delete a.WSOrganizationLocationSearchCriteria.organization,a.isMapVisible||delete a.WSOrganizationLocationSearchCriteria.radius,a.filterCriteria.organizationSpecificationTypeId&&a.filterCriteria.organizationSpecificationTypeId.dataValue?a.WSOrganizationLocationSearchCriteria.organizationSpecificationTypeId=a.filterCriteria.organizationSpecificationTypeId.dataValue.id:delete a.WSOrganizationLocationSearchCriteria.organizationSpecificationTypeId,a.addressInfo=a.addressInfoFilter,a.orgType=a.orgTypeFilter,a.searchOrganizationLocations()},a.selectHospital=function(b,c){a.whetherSetToDefalut=!0,a.destination=c.addressLattitudes+","+c.addressLongitudes,0!==c.organizationLocationAddressId&&(c.whetherSubscriberOrganization&&(a.selectedId=c.id),a.selectedHospital=c,a.map.showInfoWindow("bar","id_"+c.id)),a.hideDetail()},a.unconfirm=function(){a.selectedId=null,a.selectedAddress=null,a.map.hideInfoWindow("bar"),a.destination=a.currentLocation,a.whetherSetToDefalut=!0},a.hideDetail=function(){"calledFromEmergencyTransaction"!==c.type?a.map.hideInfoWindow("foo-iw"):"changeEmergencyLocation"!==c.caller?a.map.hideInfoWindow("foo-iw"):0!==a.address.organizationLocationAddressId&&a.map.hideInfoWindow("foo-iw")},a.showDetails=function(b,c){0!=c.id&&(c.id!==a.selectedId?(a.address=c,c.organizationLocationAddressId&&a.map.showInfoWindow("foo-iw","id_"+c.id),a.map.hideInfoWindow("bar")):(a.selectHospital(b,c),a.hideDetail()))},a.clear=function(){a.isFiltered=!1,a.WSOrganizationLocationSearchCriteria={},a.addressInfo={},a.orgType={};var b=a.filterCriteria.addressLattitudes,c=a.filterCriteria.addressLongitudes;a.filterCriteria={},a.filterCriteria.addressLattitudes=b,a.filterCriteria.addressLongitudes=c,a.filterCriteria.organization={},a.addressInfoFilter={},
//$scope.orgTypeFilter.dataValue = {};
a.$broadcast("clearStatusData"),a.$broadcast("clearPicklistData"),a.$broadcast("clearOrgOrgLocType"),a.$broadcast("clearAddressData"),a.searchOrganizationLocations()},
//Add new Organisation
a.addNewOrgLoc=function(){d.go("addorgloc",{type:""})},
//View Organization Location Address
a.viewOrgLocationAddressList=function(a,b,c,e,f){var g={type:"",organization:{id:a,displayName:b},organizationLocation:{id:c,displayName:e},wallData:{whetherSubscriberOrganization:f.whetherSubscriberOrganization}};d.go("orgLocationAddressList",g)},
//View follow up setting
a.viewFollowUpSetting=function(a,b,c,e){var f={type:null,organization:{id:a,value:b},organizationLocation:{id:c,value:e}};d.go("followUpSettingsList",f)},a.listOrgs=function(a,b,c){var e={};e.dataValue={},e.dataValue.id=a,e.dataValue.value=b,d.go("manageorg",{orgId:c,orgLoc:e,type:"view"})},
//Edit new Organisation
a.manageOrgLoc=function(b,c){a.orgLocListPageSpinner=!0,g.getOrganizationLocationById(b,function(e){a.orgLocListPageSpinner=!1;var f="view",g="manageorglocView";c&&(f="edit",g="manageorgloc");var h=e;d.go(g,{type:f,data:h,orgLocId:b})},function(b){a.orgLocListPageSpinner=!1,a.error=b,h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},
//Server side pagination module
a.pageChanged=function(b){a.currentPage=b,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchOrganizationLocations()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchOrganizationLocations()};
//datatble config json
var y={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(y),a.dtColumnDefs=e.setColumnProperties({});var z=function(b){n.getJsonData(o.getJsonFileUrl("ORGANIZATION_TYPE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),A())},function(a){})},A=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){var c=new google.maps.Geocoder,d=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);c.geocode({latLng:d},function(b,c){a.currLocationAddress=b[0].formatted_address,a.currAddressArray=a.currLocationAddress.split(","),a.currCountry=a.currAddressArray[a.currAddressArray.length-1],a.currState=a.currAddressArray[a.currAddressArray.length-2].substring(0,a.currAddressArray[a.currAddressArray.length-2].lastIndexOf(" ")),a.currCity=a.currAddressArray[a.currAddressArray.length-3];var d={countryValue:a.currCountry.trim(),stateValue:a.currState.trim(),cityValue:a.currCity.trim()};g.fetchAddressDetailsByGPS(d,function(b){a.addressInfoFilter.country=b.data.country,a.addressInfoFilter.state=b.data.state,a.addressInfoFilter.district=b.data.district,a.addressInfoFilter.city=b.data.city},function(a){})}),B(b.coords.latitude,b.coords.longitude)})},function(b){t.getUsersCoordinates(b,function(b){B(b.coords.latitude,b.coords.longitude,!0),a.currentLocation=[parseFloat(b.coords.latitude),parseFloat(b.coords.longitude)]}),console.log(b)})};a.onMapLoaded=function(){r(function(){m.getMap({id:"my_map"}).then(function(a){google.maps.event.trigger(a,"resize")})},500)};var B=function(b,c){a.filterCriteria.addressLattitudes=b,a.filterCriteria.addressLongitudes=c;var d={latLng:new google.maps.LatLng(b,c)};a.changeLocation(d),a.organizationLocationsList=[],a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,displayName:"You are here",id:0},a.organizationLocationsList.push(a.currentLocationObject),a.init()};a.changeLocation=function(b){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filterCriteria.addressLattitudes=b.latLng.lat(),a.filterCriteria.addressLongitudes=b.latLng.lng(),a.locationChanged=!0,a.isFiltered=!1,p.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,addressLattitudes:b.latLng.lat(),addressLongitudes:b.latLng.lng()}}),a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!0,organizationTypeIcon:a.iconsList.ICONS.DEFAULT,isSelected:!1,id:0,displayName:"You dragged here"},a.fetchRecords()},a.goToWall=function(a){d.go("manageorglocView",{orgLocId:a,type:"view"})},a.goToMapClinicalData=function(a,b){var c=a;c.selectedCat=b,k.show({controller:"MapSystemSummaryCtrl",templateUrl:"app/modules/manage-organisation-locations/views/map-system-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{rowObject:c}})},a.init=function(){if(a.timing=(new Date).getTime(),a.onMapLoaded(),a.mapVisibility="show-map",b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?(a.isMapVisible=!1,a.buttonText=i.instant("SHOW_MAP"),a.mapVisibility="hide-map"):(a.isMapVisible=!0,a.buttonText=i.instant("SHOW_TABLE")),a.getSpecializations(),a.getSubbranch(),/*NgMap.initMap('Map');*/
c.org&&(a.filterCriteria.organizationId=c.org.dataValue.id),c.wallData&&(a.filterCriteria.organization.data=c.wallData.organization),c.searchType){var d=c.searchType;"Hospital"==d?(a.filterCriteria.whetherHasHospital=!0,a.filterCriteria.whetherClinic=!0,a.filterCriteria.whetherHealthServiceProvider=!0):"Lab"==d?a.filterCriteria.whetherLab=!0:"Pharmacies"==d?a.filterCriteria.whetherPharmacy=!0:"OtherServiceProviders"==d?a.filterCriteria.whetherOtherHealthServiceProvider=!0:"NGOs"==d?(a.filterCriteria.whetherNGO=!0,a.filterCriteria.whetherSponsor=!0):"serviceProvider"==d&&(a.filterCriteria.viewSubscribedLoc=!0)}a.fetchRecords();var e=f.getLocationCategory();l.isFieldEmpty(e)||("SERVICE_PROVIDER_HO"==e.code?a.whetherHO=!0:a.whetherHO=!1),n.getData(o.getUrl("CLINICAL_CAT_LIST"),null,function(b){a.clinicalCatList=angular.fromJson(b.data)},function(){})},z(),a.activate=function(b){var c=i.instant("ORG_LOC_NOT_ACTIVATED");g.activate(b,function(b){b.whetherActivated&&(c=i.instant("ACTIVATION_SUCCESS"));var d={activationListResult:b,isInactive:b.whetherActivated,inactiveMsg:c,orgLocId:null,orgLocListService:null,parentScope:a};a.showModal(x,"app/modules/manage-organisation-locations/views/activationTemplate.html",d)},function(b){var d={activationListResult:b,isInactive:!0,inactiveMsg:c,orgLocId:null,orgLocListService:null,parentScope:a};a.showModal(x,"app/modules/manage-organisation-locations/views/activationTemplate.html",d)})},a.inActivate=function(b){var c={orgLocId:b,isInactive:!1,inactiveMsg:i.instant("INACTIVATION_FAILED_REASON"),activationListResult:null,orgLocListService:g,parentScope:a};a.showModal(x,"app/modules/manage-organisation-locations/views/inActivatationTemplate.html",c)},a.showModal=function(a,b,c){var d;k.show({controller:x,templateUrl:b,parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:q.dialogBox.clickOutsideToClose,
// fullscreen: useFullScreen,
locals:c}).then(function(){c.parentScope.fetchRecords()},function(){c.parentScope.fetchRecords()})},a.toggleMap=function(){if(/*$state.reload();*/
a.isMapVisible=!a.isMapVisible,1==a.isMapVisible?(a.buttonText=i.instant("SHOW_TABLE"),a.mapVisibility="show-map"):(a.buttonText=i.instant("SHOW_MAP"),a.mapVisibility="hide-map"),c.org&&(a.filterCriteria.organizationId=c.org.dataValue.id),c.wallData&&(a.filterCriteria.organization.data=c.wallData.organization),c.searchType){var b=c.searchType;"Hospital"==b&&(a.filterCriteria.whetherHasHospital=!0)}a.fetchRecords()},a.goToTestOrderScreen=function(a,c){var e={};/*paramObj.user = {
                id: userId,
                value: userName
            };*/
b.loggedInUserDetails.isOrganizationUser||b.loggedInUserDetails.isOrganizationUserMode||(e.testConductedAtOrg={id:a.organizationId,value:a.organizationDisplayName},e.testConductedAt={id:a.id,value:a.displayName}),"addUserTestOrder"==c?d.go("testorder",{pageState:"fromLoc",data:e}):d.go("testorderlist",{pageState:"add"})},a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")}}]),angular.module("paripal.manageOrganisationLocation").service("addOrgLocService",["httpService","urlService","dateconvertor",function(a,b,c){"use strict";this.saveOrganizationLocation=function(d,e,f,g,h,i,j,k,l,m,n,o,p,q){e.data&&e.data.id&&(d.organization={},d.organization.id=e.data.id),d.preferedLanguage&&(d.preferedLanguage=angular.fromJson(d.preferedLanguage)),f.data&&f.data.id&&(d.billingLocation={},d.billingLocation.id=f.data.id),g&&g.dataValue&&(d.locationTypeId={},d.locationTypeId.id=g.dataValue.id);for(var r=0;r<h.length;r++)0==r&&h[r].dataValue&&(d.orgLctnCategoryId1={},d.orgLctnCategoryId1.id=h[r].dataValue.id),1==r&&h[r].dataValue&&(d.orgLctnCategoryId2={},d.orgLctnCategoryId2.id=h[r].dataValue.id),2==r&&h[r].dataValue&&(d.orgLctnCategoryId3={},d.orgLctnCategoryId3.id=h[r].dataValue.id);i&&i.dataValue&&(d.currency={},d.currency.id=i.dataValue.id),j&&j.dataValue&&(d.calendar={},d.calendar.id=j.dataValue.id),k[0]&&k[0].value&&(d.email1=k[0].value),k[1]&&k[1].value&&(d.email2=k[1].value),l[0]&&l[0].value&&(d.tollFreeNumber1=l[0].value),l[1]&&l[1].value&&(d.tollFreeNumber2=l[1].value),m[0]&&m[0].value&&(d.mobileNumber1=m[0].value),m[1]&&m[1].value&&(d.mobileNumber2=m[1].value),n[0]&&n[0].value&&(d.landlineNumber1=n[0].value),n[1]&&n[1].value&&(d.landlineNumber2=n[1].value),o[0]&&o[0].value&&(d.locationWall1=o[0].value),o[1]&&o[1].value&&(d.locationWall2=o[1].value),d.commencementDate=c.convertToServerDate(d.commencementDate),d.validFrom=c.convertToServerDate(d.validFrom),d.validTill=c.convertToServerDate(d.validTill),a.postData(b.getUrl("ADD_ORG_LOC"),d,function(a){a&&a.data&&p(a.data)},function(a){q(a)})},this.getOrgDetailById=function(c,d,e){var f={};f.organizationId=c,a.getData(b.getParameterizedUrl("GET_ORG_BY_ID",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.manageOrganisationLocation").service("manageOrgLocService",["httpService","urlService","dateconvertor","Upload","$timeout","$state",function(a,b,c,d,e,f){"use strict";this.updateOrganizationLocation=function(d,e,f,g,h,i,j,k,l,m,n,o,p,q){e.data&&e.data.id&&(d.organization={},d.organization.id=e.data.id),f.data&&f.data.id&&(d.billingLocation={},d.billingLocation.id=f.data.id),g&&g.dataValue&&(d.locationTypeId={},d.locationTypeId.id=g.dataValue.id);for(var r=0;r<h.length;r++)0==r&&h[r].dataValue&&(d.orgLctnCategoryId1={},d.orgLctnCategoryId1.id=h[r].dataValue.id),1==r&&h[r].dataValue&&(d.orgLctnCategoryId2={},d.orgLctnCategoryId2.id=h[r].dataValue.id),2==r&&h[r].dataValue&&(d.orgLctnCategoryId3={},d.orgLctnCategoryId3.id=h[r].dataValue.id);i&&i.dataValue&&(d.currency={},d.currency.id=i.dataValue.id),j&&j.dataValue&&(d.calendar={},d.calendar.id=j.dataValue.id),k[0]&&k[0].value&&(d.email1=k[0].value),k[1]&&k[1].value&&(d.email2=k[1].value),l[0]&&l[0].value&&(d.tollFreeNumber1=l[0].value),l[1]&&l[1].value&&(d.tollFreeNumber2=l[1].value),m[0]&&m[0].value&&(d.mobileNumber1=m[0].value),m[1]&&m[1].value&&(d.mobileNumber2=m[1].value),n[0]&&n[0].value&&(d.landlineNumber1=n[0].value),n[1]&&n[1].value&&(d.landlineNumber2=n[1].value),/*if (wallValues[0] && wallValues[0].value)
                WSOrganizationLocation.locationWall1 = wallValues[0].value;
            if (wallValues[1] && wallValues[1].value)
                WSOrganizationLocation.locationWall2 = wallValues[1].value;*/
d.commencementDate=c.convertToServerDate(d.commencementDate),d.validFrom=c.convertToServerDate(d.validFrom),d.validTill=c.convertToServerDate(d.validTill);var s={};s.orgLocId=d.id,a.putData(b.getParameterizedUrl("UPDATE_ORG_LOC",s),d,function(a){a&&a.data?p(a.data):q(a)},function(a){q(a)})},this.uploadLogo=function(a,c,f,g,h){var i={};i.orgLocId=a,c&&(c.upload=d.upload({url:b.getParameterizedUrl("UPLOAD_ORG_LOC_LOGO",i),data:{file:c}}),c.upload.then(function(a){e(function(){f(a.data)})},function(a){a.status>0&&g(a.status+": "+a.data)},function(a){h(Math.min(100,parseInt(100*a.loaded/a.total)))}))},this.getWallItems=function(c){a.getJsonData(b.getJsonFileUrl("WALL_ITEMS_LIST_FOR_ORG_LOCATION",null),function(a){a&&a.data&&c(a.data)},function(a){})},this.wallItemCall=function(a,b,c){if(a.preventDefault(),"#"!==b.href)return"manageorgView"===b.href?void f.go(b.href,{type:"view",orgId:c.organization.id}):void f.go(b.href,{wallData:{organization:c.organization,orglocation:{id:c.id,value:c.displayName},type:b.type,reportType:"LOC_TREAT_CLIENT_BY_LOC"}})},this.downloadLogo=function(c,d,e){var f={};f.orgLocationId=c,a.getImageData(b.getParameterizedUrl("DOWNLOAD_ORG_LOC_LOGO",f),null,function(a){if(a&&a.data){var b=new Uint8Array(a.data),c=new Blob([b],{type:"image/jpeg"}),f=window.URL||window.webkitURL,g=f.createObjectURL(c);d(g)}else e(a)},function(a){e(a)})},this.fetchCategotyLabels=function(c,d,e){a.postData(b.getUrl("FETCH_CATEGORIES"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchEventRecordToSlide=function(c,d,e){a.postData(b.getUrl("GET_EVENT_RECORD"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)},{handleError:!1})}}]),angular.module("paripal.manageOrganisationLocation").service("orgLocListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchOrganizationLocations=function(c,d,e,f,g){c.whetherAllStatus&&"true"===c.whetherAllStatus?c.whetherAllStatus=!0:c.whetherAllStatus=!1,c.viewSubscribedLoc||(c.viewSubscribedLoc=null),c.cityId="",c.districtId="",c.stateId="",c.countryId="",c.postalCode="",d&&(c.whetherMapView=d.whetherMapView),d&&1==d.isFiltered&&(d.city&&d.city.id?c.cityId=d.city.id:d.cityValue&&d.cityValue.id&&(c.cityId=d.cityValue.id),d.district&&d.district.id?c.districtId=d.district.id:d.districtValue&&d.districtValue.id&&(c.districtId=d.districtValue.id),d.state&&d.state.id?c.stateId=d.state.id:d.stateValue&&d.stateValue.id&&(c.stateId=d.stateValue.id),d.country&&d.country.id?c.countryId=d.country.id:d.countryValue&&d.countryValue.id&&(c.countryId=d.countryValue.id),d.postalCode&&(c.postalCode=d.postalCode)),e&&e.dataValue&&e.dataValue.id&&e.dataValue.id&&(c.organizationLocationTypeId={},c.organizationLocationTypeId.id=e.dataValue.id),c.disease&&(c.diseaseId=c.disease.id),c.diseaseVariant&&(c.diseaseVariantId=c.diseaseVariant.id),c.symptom&&(c.symptomId=c.symptom.id),delete c.disease,delete c.diseaseVariant,delete c.symptom,c.radius||delete c.radius,delete c.slider,a.postData(b.getUrl("SEARCH_ORG_LOC"),c,function(a){a.data&&a.data.data?f(a.data):g(a)},function(a){g(a)})},this.searchOrganizationLocationCards=function(c,d,e,f,g){c.whetherAllStatus&&"true"===c.whetherAllStatus?c.whetherAllStatus=!0:c.whetherAllStatus=!1,c.viewSubscribedLoc||(c.viewSubscribedLoc=null),c.cityId="",c.districtId="",c.stateId="",c.countryId="",c.postalCode="",d&&(c.whetherMapView=d.whetherMapView),d&&1==d.isFiltered&&(d.city&&d.city.id?c.cityId=d.city.id:d.cityValue&&d.cityValue.id&&(c.cityId=d.cityValue.id),d.district&&d.district.id?c.districtId=d.district.id:d.districtValue&&d.districtValue.id&&(c.districtId=d.districtValue.id),d.state&&d.state.id?c.stateId=d.state.id:d.stateValue&&d.stateValue.id&&(c.stateId=d.stateValue.id),d.country&&d.country.id?c.countryId=d.country.id:d.countryValue&&d.countryValue.id&&(c.countryId=d.countryValue.id),d.postalCode&&(c.postalCode=d.postalCode)),e&&e.dataValue&&e.dataValue.id&&e.dataValue.id&&(c.organizationLocationTypeId={},c.organizationLocationTypeId.id=e.dataValue.id),c.disease&&(c.diseaseId=c.disease.id),c.diseaseVariant&&(c.diseaseVariantId=c.diseaseVariant.id),c.symptom&&(c.symptomId=c.symptom.id),delete c.disease,delete c.diseaseVariant,delete c.symptom,c.radius||delete c.radius,delete c.slider,a.postData(b.getUrl("SEARCH_ORG_LOC_CARD"),c,function(a){a.data&&a.data.data?f(a.data):g(a)},function(a){g(a)})},this.getOrganizationLocationById=function(c,e,f){var g={};g.organizationLocationId=c,a.getData(b.getParameterizedUrl("GET_ORG_LOC_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.commencementDate=d("timestampToDate")(a.data.commencementDate,b),a.data.validFrom=d("timestampToDate")(a.data.validFrom,b),a.data.validTill=d("timestampToDate")(a.data.validTill,b),e(a.data)):f(a)},function(a){f(a)})},this.activate=function(c,d,e){var f={};f.orgLocId=c,a.putData(b.getParameterizedUrl("ACTIVATE_ORG_LOC",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)},{organizationLocationId:c})},this.inActivate=function(c,d,e,f){var g={};g.orgLocId=c,a.putData(b.getParameterizedUrl("INACTIVATE_ORG_LOC",g),d.value,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)},{organizationLocationId:c})},this.findCurrentAddressOfLocation=function(c,d,e){var f={};f.organizationLocationId=c,a.getData(b.getParameterizedUrl("CURRENR_LOCARION_ADDRESS",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchAddressDetailsByGPS=function(c,d,e){a.postData(b.getUrl("GET_ADDRESS_DETAILS_BY_GPS"),c,function(a){d(a)},function(a){e(a)})},this.getOrganizationLocationByEmergencyType=function(c,d,e,f){var g={};g.keyword=c,g.treatmentTypeId=d,a.getData(b.getParameterizedUrl("GET_ORG_LOCATION_BY_EMERGENCY_TYPE",g),null,function(a){e(a.data)},function(a){f(a)})}}]),angular.module("paripal.manageOrganisation").controller("AddOrgCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","addOrgService","notify","$translate","manageOrgService","expressionListService","utilService",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";a.WSOrganization={},a.orgSaveResponse="",a.labelList="",a.orgTypeFilter={},a.category=new Array,a.maxDate=new Date,a.$on("imageEvent",function(b,c){e.readAsDataUrl(c,a).then(function(b){a.imageSrc=b})}),a.saveOrganization=function(){b.showSpinner=!0,f.saveOrganization(a.WSOrganization,a.orgTypeFilter,a.category,function(c){b.showSpinner=!1,a.orgSaveResponse=c,g("success",h.instant("ADDED_SUCCESS")),d.go("orglist",{type:""})},function(c){b.showSpinner=!1,a.orgSaveResponse=c})},a.cancel=function(){k.goBackToPrevState()},a.fetchCategotyLabels=function(){var b=new Array;b.push("ORG_CATEGORY_1"),b.push("ORG_CATEGORY_2"),b.push("ORG_CATEGORY_3"),i.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.fetchCategotyLabels(),a.loadListOfOrganizations=function(){j.loadListOfOrganizations(function(b){a.sysOrgList=b},function(a){})},a.loadListOfOrganizations()}]),angular.module("paripal.manageOrganisation").controller("ManageOrgCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","manageOrgService","orgListService","notify","$translate","$filter","expressionListService","commonConstants","urlService","otherDocumentService","fileOperations","manageOrgLocService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.WSOrganization={},a.orgUpdateResponse="",a.disabled=!1,a.orgTypeFilter={},a.category=new Array,a.currencyFilter={},a.status={},a.status.ACTIVE="true",a.status.INACTIVE="false",a.status.selected="",a.maxDate=new Date,a.labelList="",a.manageOrgSpinner=!1,a.logo={};var r=function(){f.getWallItems(function(c){q.isFieldEmpty(b.loggedInUserDetails)&&(c=c.filter(function(a){return"subscribertransaction"!==a.href&&"accountstatement"!==a.href})),a.wallItems=c})};a.$on("imageEvent",function(b,c){e.readAsDataUrl(c,a).then(function(b){a.imageSrc=b})}),a.updateOrganization=function(){b.showSpinner=!0,f.updateOrganization(a.WSOrganization,a.orgTypeFilter,a.category,a.currencyFilter,function(c){b.showSpinner=!1,a.orgUpdateResponse=c,h("success",i.instant("RECORD_EDITED_SUCESS")),d.go("orglist",{type:""})},function(c){b.showSpinner=!1,a.orgUpdateResponse=c})},a.wallItemCall=function(b,c){f.wallItemCall(b,c,a.WSOrganization)},a.cancel=function(){q.goBackToPrevState()},a.setData=function(){if(a.WSOrganization.whetherActive?a.status.selected="true":a.status.selected="false",a.WSOrganization.organizationTypeId&&a.WSOrganization.organizationTypeId.id&&(a.orgTypeFilter.id=a.WSOrganization.organizationTypeId.id),a.WSOrganization.organizationCategoryId1&&a.WSOrganization.organizationCategoryId1.id&&(a.category[0]={},a.category[0].id=a.WSOrganization.organizationCategoryId1.id),a.WSOrganization.organizationCategoryId2&&a.WSOrganization.organizationCategoryId2.id&&(a.category[1]={},a.category[1].id=a.WSOrganization.organizationCategoryId2.id),a.WSOrganization.organizationCategoryId3&&a.WSOrganization.organizationCategoryId3.id&&(a.category[2]={},a.category[2].id=a.WSOrganization.organizationCategoryId3.id),a.WSOrganization.currency&&a.WSOrganization.currency.id&&(a.currencyFilter.id=a.WSOrganization.currency.id),a.WSOrganization.logoDocumentId){var b=new Object;
//fileObject.fileName = "1 (1).png";
b.fileName=a.WSOrganization.logoFilePath,b.resourceId=a.WSOrganization.logoDocumentId,b.docType=l.documentTypes.orgLogo,b.docSubType=l.documentSubTypes.orgLogo,b.organizationId=a.WSOrganization.id,o.getImageUrl(b,function(b){a.logoUrl=b},function(){})}else a.logoUrl="app/images/billing/hospital.png";a.manageOrgSpinner=!1},a.init=function(){/*To fetch Event Record from Database*/
if(a.manageOrgSpinner=!0,"edit"===c.type?a.pageState="edit":"view"===c.type&&(a.pageState="view",a.disabled=!0,r()),c.data?(a.WSOrganization=c.data,a.setData()):c.orgId?g.getOrganizationById(c.orgId,function(b){a.WSOrganization=b,a.setData()},function(b){a.manageOrgSpinner=!1,a.error=b}):c.orgLoc?f.searchOrganizationsByLocationId(c.orgLoc.dataValue.id,function(b){a.WSOrganization=b,a.manageOrgSpinner=!1,a.setData()},function(b){a.manageOrgSpinner=!1,a.error=b}):a.cancel(),c.orgId){var b={orgId:c.orgId};p.fetchEventRecordToSlide(b,function(b){a.eventRecordArray=q.isFieldEmpty(b)?null:a.eventRecordArray=b[0].eventDTOs},function(b){a.error=b})}},a.viewEventDetails=function(a){d.go("showeventdetails",{eventId:a.id})},a.init(),a.saveLogoDetails=function(){var b=m.getUrl("SAVE_DOCUMENT_DETAILS"),c=new Object;c.documentType={type:l.documentTypes.orgLogo,subType:l.documentSubTypes.orgLogo},a.logo&&a.logo.fileToBeUpload?(c.fileName=a.logo.fileToBeUpload.name,c.fileSize=a.logo.fileToBeUpload.size,n.saveDocumentDetails(c,b,!1,function(b){a.WSOrganization.logoDocumentId=b.response,a.WSOrganization.logoFilePath=c.fileName,a.uploadFile(a.logo,b)},function(b){h("Error",i.instant("ERROR_WHILE_UPLOADING")),a.updateOrganization()})):a.updateOrganization()},a.uploadFile=function(b,c){var d=new Object;d.file=b.fileToBeUpload,d.docType=l.documentTypes.orgLogo,d.docSubType=l.documentSubTypes.orgLogo,d.organizationId=a.WSOrganization.id,c.response&&(d.resourceId=c.response),o.uploadFile(d,function(b){c.successMessage&&a.updateOrganization()},function(b){h("Error",i.instant("ERROR_WHILE_UPLOADING")),a.updateOrganization()})},a.viewLogo=function(){if(a.WSOrganization.logoDocumentId){var b=new Object;b.fileName=a.WSOrganization.logoFilePath,
//fileObject.fileName = "1 (1).png";
b.resourceId=a.WSOrganization.logoDocumentId,b.docType=l.documentTypes.orgLogo,b.docSubType=l.documentSubTypes.orgLogo,a.fileResource=b,a.viewFileContent=!0,a.isHidingPrintButton=!1}},a.fetchCategotyLabels=function(){var b=new Array;b.push("ORG_CATEGORY_1"),b.push("ORG_CATEGORY_2"),b.push("ORG_CATEGORY_3"),f.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.fetchCategotyLabels(),a.loadListOfOrganizations=function(){k.loadListOfOrganizations(function(b){a.sysOrgList=b},function(a){})},a.loadListOfOrganizations()}]),angular.module("paripal.manageOrganisation").controller("OrgListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","orgListService","notify","$translate","serverSidePagination","$mdDialog","baseService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b,c,d,e,f,g){a.orgId=c,a.activationListResult=d,a.isInactive=e,a.inactiveMsg=f,a.orgListService=g,a.reason={},a.reason.value={},a.cancel=function(){b.hide()},a.inactivate=function(){g.inActivate(c,a.reason,function(b){a.inactiveMsg=h.instant("INACTIVATION_SUCCESS")},function(b){a.inactiveMsg=h.instant("INACTIVATION_FAILED")}),a.isInactive=!0},a.ok=function(){b.cancel()}}m.$inject=["$scope","$mdDialog","orgId","activationListResult","isInactive","inactiveMsg","orgListService"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgListSpinner=!1,a.orgListPageSpinner=!1,a.organizationsList=[],a.WSOrganizationSearchCriteria={},a.filterCriteria={},a.error={},a.addressInfo={},a.orgType={},a.addressInfoFilter={},a.filter={orgTypeFilter:{}},
//$scope.orgTypeFilter.dataValue = {};
a.status={},a.status.AND="true",a.status.OR="false",a.searchOrganizations=function(){a.WSOrganizationSearchCriteria.pageNumber=a.currentPage,a.WSOrganizationSearchCriteria.recordsPerPage=a.itemPerPage,a.orgListSpinner=!0,f.searchOrganizations(a.WSOrganizationSearchCriteria,a.addressInfo,a.orgType,function(b){a.orgListSpinner=!1,a.organizationsList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),
//notify("success", $translate.instant("ADDED_SUCCESS"));
a.WSOrganizationSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus="true":a.filterCriteria.whetherAllStatus="false"},function(b){a.orgListSpinner=!1,a.error=b,a.organizationsList=[],a.totalItems=0,a.pagingInfo={},a.WSOrganizationSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus="true":a.filterCriteria.whetherAllStatus="false"})},a.fetchRecords=function(){a.WSOrganizationSearchCriteria=a.filterCriteria,a.addressInfo=a.addressInfoFilter,a.orgType=a.filter.orgTypeFilter,a.searchOrganizations()},a.clear=function(){a.WSOrganizationSearchCriteria={},a.addressInfo={},a.orgType={},a.filterCriteria={},a.addressInfoFilter={},
//$scope.orgTypeFilter = {};
a.$broadcast("clearOrgOrgLocType"),a.$broadcast("clearStatusData"),a.$broadcast("clearPicklistData"),a.$broadcast("clearAddressData"),a.searchOrganizations()},
//Add new Organisation
a.addNewOrg=function(){d.go("addorg",{type:""})},a.listOrgLocs=function(a,b){var c={};c.dataValue={},c.dataValue.id=a,c.dataValue.value=b,d.go("orgloclist",{org:c})},
//Edit new Organisation
a.manageOrg=function(b,c){a.orgListPageSpinner=!0,f.getOrganizationById(b,function(e){a.orgListPageSpinner=!1;var f="view",g="manageorgView";c&&(g="manageorg",f="edit");var h=e;d.go(g,{type:f,data:h,orgId:b})},function(b){a.orgListPageSpinner=!1,a.error=b,g("error",h.instant("FAILED_TO_LOAD_RECORD"))})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchOrganizations()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchOrganizations()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(n),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){
//$scope.filterCriteria.whetherHasHopital = true;
var b=c.searchType;"Hospital"==b?a.filterCriteria.whetherHasHospital=!0:"Lab"==b?a.filterCriteria.whetherLab=!0:"Pharmacies"==b?a.filterCriteria.whetherPharmacy=!0:"OtherServiceProviders"==b?a.filterCriteria.whetherOtherHealthServiceProvider=!0:"NGOs"==b&&(a.filterCriteria.whetherNGO=!0),a.fetchRecords()},a.init(),a.activate=function(b){var c=h.instant("ORG_NOT_ACTIVATED");f.activate(b,function(d){d.whetherActivated&&(c=h.instant("ACTIVATION_SUCCESS"));var e={orgId:b,activationListResult:d,isInactive:d.whetherActivated,inactiveMsg:c,orgListService:f,parentScope:a};a.showModal(a.activateInactiveController,"app/modules/manage-organisations/views/activationTemplate.html",e)},function(d){var e={orgId:b,activationListResult:d,isInactive:!0,inactiveMsg:c,orgListService:f,parentScope:a};a.showModal(a.activateInactiveController,"app/modules/manage-organisations/views/activationTemplate.html",e)})},a.checkPermission=function(a,b){var c=k.getLoggedInUser();if("SYSTEM"===c.userOrganizationCategoryType&&!utilService.isNullOrEmpty(a.systemOrganizationId)&&c.accessibleSystemOrganizations.indexOf(scope.systemOrganizationId)!=-1){if(1!=a.whetherSubscriber)return!0;if(b===!0)return!0}
// system-organization-id="row.systemOrganizationId" subscriber-organization="row.whetherSubscriber"
return!1},a.inActivate=function(b){var c={orgId:b,isInactive:!1,inactiveMsg:"Inactivation unsuccessful",activationListResult:null,orgListService:f,parentScope:a};a.showModal(a.activateInactiveController,"app/modules/manage-organisations/views/inActivatationTemplate.html",c)},a.showModal=function(a,b,c){var d;j.show({controller:m,templateUrl:b,parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:l.dialogBox.clickOutsideToClose,
// fullscreen: useFullScreen,
locals:c}).then(function(){c.parentScope.fetchRecords()},function(){c.parentScope.fetchRecords()})}}]),angular.module("paripal.manageOrganisation").service("addOrgService",["httpService","urlService","dateconvertor",function(a,b,c){"use strict";this.saveOrganization=function(d,e,f,g,h){e&&e.dataValue&&(d.organizationTypeId={},d.organizationTypeId.id=e.dataValue.id);for(var i=0;i<f.length;i++)0==i&&f[i].dataValue&&(d.organizationCategoryId1={},d.organizationCategoryId1.id=f[i].dataValue.id),1==i&&f[i].dataValue&&(d.organizationCategoryId2={},d.organizationCategoryId2.id=f[i].dataValue.id),2==i&&f[i].dataValue&&(d.organizationCategoryId3={},d.organizationCategoryId3.id=f[i].dataValue.id);d.commencementDate=c.convertToServerDate(d.commencementDate),a.postData(b.getUrl("ADD_ORG"),d,function(a){a&&a.data&&g(a.data)},function(a){h(a)})}}]),angular.module("paripal.manageOrganisation").service("manageOrgService",["httpService","urlService","dateconvertor","Upload","$timeout","$filter","$state",function(a,b,c,d,e,f,g){"use strict";this.updateOrganization=function(d,e,f,g,h,i){e&&e.dataValue&&(d.organizationTypeId={},d.organizationTypeId.id=e.dataValue.id);for(var j=0;j<f.length;j++)0==j&&f[j].dataValue&&(d.organizationCategoryId1={},d.organizationCategoryId1.id=f[j].dataValue.id),1==j&&f[j].dataValue&&(d.organizationCategoryId2={},d.organizationCategoryId2.id=f[j].dataValue.id),2==j&&f[j].dataValue&&(d.organizationCategoryId3={},d.organizationCategoryId3.id=f[j].dataValue.id);g&&g.dataValue&&(d.currency={},d.currency.id=g.dataValue.id),d.commencementDate=c.convertToServerDate(d.commencementDate);var k={};k.organizationId=d.id,a.putData(b.getParameterizedUrl("UPDATE_ORG",k),d,function(a){a&&a.data?h(a.data):i(a)},function(a){i(a)})},this.getWallItems=function(c){a.getJsonData(b.getJsonFileUrl("WALL_ITEMS_LIST_FOR_ORGANIZATION",null),function(a){a&&a.data&&c(a.data)},function(a){})},this.wallItemCall=function(a,b,c){a.preventDefault(),"#"!==b.href&&g.go(b.href,{wallData:{organization:{id:c.id,value:c.displayName},type:b.type}})},this.uploadLogo=function(a,c,f,g,h){var i={};i.organizationId=a,c&&(c.upload=d.upload({url:b.getParameterizedUrl("UPLOAD_ORG_LOGO",i),data:{file:c}}),c.upload.then(function(a){e(function(){f(a.data)})},function(a){a.status>0&&g(a.status+": "+a.data)},function(a){h(Math.min(100,parseInt(100*a.loaded/a.total)))}))},this.searchOrganizationsByLocationId=function(c,d,e){var g={};g.orgLocationId=c,a.getData(b.getParameterizedUrl("SEARCH_ORG_BY_LOCATION_ID",g),null,function(a){a.data?(a.data.commencementDate=f("timestampToDate")(a.data.commencementDate,"MM/dd/yyyy"),d(a.data)):e(a)},function(a){e(a)})},this.downloadLogo=function(c,d,e){var f={};f.organizationId=c,a.getImageData(b.getParameterizedUrl("DOWNLOAD_ORG_LOGO",f),null,function(a){if(a&&a.data){var b=new Uint8Array(a.data),c=new Blob([b],{type:"image/*"}),f=window.URL||window.webkitURL,g=f.createObjectURL(c);d(g)}else e(a)},function(a){e(a)})},this.fetchCategotyLabels=function(c,d,e){a.postData(b.getUrl("FETCH_CATEGORIES"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.manageOrganisation").service("orgListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchOrganizations=function(c,d,e,f,g){c.whetherAllStatus&&"true"===c.whetherAllStatus?c.whetherAllStatus=!0:c.whetherAllStatus=!1,c.cityId="",c.districtId="",c.stateId="",c.countryId="",c.postalCode="",d&&(d.cityValue&&d.cityValue.id&&(c.cityId=d.cityValue.id),d.districtValue&&d.districtValue.id&&(c.districtId=d.districtValue.id),d.stateValue&&d.stateValue.id&&(c.stateId=d.stateValue.id),d.countryValue&&d.countryValue.id&&(c.countryId=d.countryValue.id),d.postalCode&&(c.postalCode=d.postalCode)),e&&e.dataValue&&e.dataValue.id&&(c.organizationTypeId={},c.organizationTypeId.id=e.dataValue.id),a.postData(b.getUrl("SEARCH_ORG"),c,function(a){a.data&&a.data.data?f(a.data):g(a)},function(a){g(a)})},this.getOrganizationById=function(c,e,f){var g={};g.organizationId=c,a.getData(b.getParameterizedUrl("GET_ORG_BY_ID",g),null,function(a){a&&a.data?(a.data.commencementDate=d("timestampToDate")(a.data.commencementDate,"MM/dd/yyyy"),e(a.data)):f(a)},function(a){f(a)})},this.activate=function(c,d,e){var f={};f.organizationId=c,a.putData(b.getParameterizedUrl("ACTIVATE_ORG",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.inActivate=function(c,d,e,f){var g={};g.organizationId=c,a.putData(b.getParameterizedUrl("INACTIVATE_ORG",g),d.value,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.manageProfessionalSummary").controller("manageProfessionalSummaryCtrl",["$scope","$rootScope","$stateParams","$state","notify","$translate","utilService","manageProfessionalSummaryService","httpService","urlService","$filter","baseService","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.professionalList=["DOCTOR","SUPPORT_SERVICE_PROFESSIONAL","OTHER_HEALTH_SERVICE_PROFESSIONAL","COUNSELOR"],a.userData={},a.calendarFilter={},a.WSProfessional={},a.WSProfessionalFilters={},a.professionalSelected=!0,a.picklistItemByCategoryId1={},a.picklistItemByCategoryId2={},a.picklistItemByCategoryId3={},a.picklistItemByCategoryId4={},a.picklistItemByCategoryId5={},a.minDateValidFrom=new Date,a.manageProfSummerySpinner=!1,a.recordSaved=!1,a.disableConfirmedOn=!1,a.profileTypes=[{id:"H",value:"Health Service"},{id:"S",value:"Support Service"}],a.clicked=!1,a.setClickedRow=function(){//function that sets the value of selectedRow to current index
a.clicked?a.clicked=!1:a.clicked=!0},a.$on("test",function(){a.clicked=!1}),a.getProfessionalTypes=function(){var b="";return c.type&&(a.profileTypeFieldId=c.type),b="H"==a.profileTypeFieldId?j.getUrl("GET_HEALTH_PROFESSIONAL_TYPES"):j.getUrl("GET_SUPPORT_PROFESSIONAL_TYPES"),i.getData(b,null,function(b){a.professionalTypesData=angular.fromJson(b.data)},function(a){})},a.getProfessionalSubType=function(){var b="";return c.type&&(a.profileTypeFieldId=c.type),b="H"==a.profileTypeFieldId?j.getUrl("GET_HEALTH_PROFESSIONAL_SUB_TYPES"):j.getUrl("GET_SUPPORT_PROFESSIONAL_SUB_TYPES"),b+=a.professionalId,i.getData(b,null,function(b){return a.professionalSubTypeData=angular.fromJson(b.data),a.professionalSubTypeData},function(a){})},a.profileTypeChanged=function(){a.WSProfessional.profileType=JSON.parse(a.WSProfessionalFilters.profileType).id},a.onProfessionalTypesSelect=function(b){a.WSProfessional.professionalTypeId=b,a.professionalId=b.id,a.professionalSelected=!1,a.WSProfessional.professionalSubTypeId="",a.WSProfessionalFilters.professionalSubType=""},a.onProfessionalSubTypeSelect=function(b){a.WSProfessional.professionalSubTypeId=b},a.validateValue=function(b,c){g.isNullOrEmpty(b)&&"PROFESSIONAL_TYPE"===c?(a.WSProfessional.professionalTypeId="",a.WSProfessionalFilters.professionalType="",a.WSProfessional.professionalSubTypeId="",a.WSProfessionalFilters.professionalSubType="",a.professionalSelected=!0):g.isNullOrEmpty(b)&&"PROFESSIONAL_SUB_TYPE"===c&&(a.WSProfessional.professionalSubTypeId="",a.WSProfessionalFilters.professionalSubType="")},a.cancel=function(){g.goBackToPrevState()},a.saveProfessionalSummary=function(){a.manageProfSummerySpinner=!0,h.saveProfessionalSummary(a.WSProfessional,a.userData,a.picklistItemByCategoryId1,a.picklistItemByCategoryId2,a.picklistItemByCategoryId3,a.picklistItemByCategoryId4,a.picklistItemByCategoryId5,a.profileTypeFieldId,function(b){a.manageProfSummerySpinner=!1,a.recordSaved=!0,a.createdProfessionalId=b.id,a.WSProfessional=b,a.setData(),"H"==a.profileTypeFieldId?e("success",f.instant("HEALTH_PROFESSIONAL_ADDED_SUCCESSFULLY")):e("success",f.instant("SUPPORT_PROFESSIONAL_ADDED_SUCCESSFULLY"))},function(b){a.manageProfSummerySpinner=!1,a.error=b})},a.setHealthProfessionalData=function(b){g.isEmpty(b.healthProfessionalTypeId)||(a.WSProfessionalFilters.professionalType=b.healthProfessionalTypeId,a.professionalId=b.healthProfessionalTypeId.id,a.professionalSelected=!1,a.recordSaved=!0),g.isEmpty(b.healthProfessionalSubTypeId)||(a.WSProfessionalFilters.professionalSubType=b.healthProfessionalSubTypeId),g.isEmpty(b.healthCategoryId1)||(a.picklistItemByCategoryId1=b.healthCategoryId1),g.isEmpty(b.healthCategoryId2)||(a.picklistItemByCategoryId2=b.healthCategoryId2),g.isEmpty(b.healthCategoryId3)||(a.picklistItemByCategoryId3=b.healthCategoryId3),g.isEmpty(b.healthCategoryId4)||(a.picklistItemByCategoryId4=b.healthCategoryId4),g.isEmpty(b.healthCategoryId5)||(a.picklistItemByCategoryId5=b.healthCategoryId5)},a.setSupportProfessionalData=function(b){g.isEmpty(b.supportProfessionalTypeId)||(a.WSProfessionalFilters.professionalType=b.supportProfessionalTypeId,a.professionalId=b.supportProfessionalTypeId.id,a.professionalSelected=!1,a.recordSaved=!0),g.isEmpty(b.supportProfessionalSubTypeId)||(a.WSProfessionalFilters.professionalSubType=b.supportProfessionalSubTypeId),g.isEmpty(b.supportCategoryId1)||(a.picklistItemByCategoryId1=b.supportCategoryId1),g.isEmpty(b.supportCategoryId2)||(a.picklistItemByCategoryId2=b.supportCategoryId2),g.isEmpty(b.supportCategoryId3)||(a.picklistItemByCategoryId3=b.supportCategoryId3),g.isEmpty(b.supportCategoryId4)||(a.picklistItemByCategoryId4=b.supportCategoryId4),g.isEmpty(b.supportCategoryId4)||(a.picklistItemByCategoryId5=b.supportCategoryId5)},a.setData=function(){g.isEmpty(a.WSProfessional)||(g.isEmpty(a.WSProfessional.user)||(a.userData=a.WSProfessional.user),a.WSProfessional.confirmationDate&&(a.WSProfessional.confirmationDate=k("timestampToDate")(a.WSProfessional.confirmationDate,"MM/dd/yyyy"),g.isNullOrEmpty(a.WSProfessional.confirmationDate)||(a.minDateValidFrom=a.WSProfessional.confirmationDate,a.disableConfirmedOn=!0)),g.isNullOrEmpty(a.WSProfessional.profileType)?c.type&&(a.profileTypeFieldId=c.type):a.profileTypeFieldId=a.WSProfessional.profileType,"H"==a.profileTypeFieldId?a.setHealthProfessionalData(a.WSProfessional):"S"==a.profileTypeFieldId&&a.setSupportProfessionalData(a.WSProfessional),m.isUserLoggedIn()&&(a.WSProfessional.confirmationBy=l.getLoggedInUser().displayName,a.WSProfessional.confirmationById={id:l.getLoggedInUser().id}))},a.init=function(){"view"==c.mode?a.viewMode=!0:a.viewMode=!1,!g.isFieldEmpty(c.data)&&c.data.healthProfessionalTypeId?(a.WSProfessional=c.data,a.setData()):c.orgUserId&&h.getProfessionalSummaryData(c.orgUserId,c.type,function(b){a.WSProfessional=b,a.setData()},function(b){a.error=b}),a.getProfessionalTypes()},a.init(),a.otherActions=function(b){var c=a.WSProfessional.user.id,e=null;e=g.isNullOrEmpty(a.createdProfessionalId)?a.WSProfessional.id:a.createdProfessionalId;var f=a.WSProfessional.user.value,h=a.profileTypeFieldId;if("HEALTH_SERVICE"===b&&d.go("orghealthprofessionallist",{type:null,professional:{id:e,userName:f}}),"SUPPORT_SERVICE"===b&&d.go("orgsupportprofcategorieslist",{type:null,professional:{id:e,userName:f}}),"TREATMENT_TYPE"===b){var i=!1;"H"===h&&(i=!0);var j={type:null,user:{id:e,value:f,userType:h,whetherHealthProfessional:i}};l.setStateParamsToLocalStarage("professionalTreatmentList",j),d.go("professionalTreatmentList",j)}if("DISEASE_VARIENT_LINKED"===b){var j={type:null,professional:{id:e,value:f,userType:"H"}};l.setStateParamsToLocalStarage("diseaseVariantLinkedList",j),d.go("diseaseVariantLinkedList",j)}if("MONTHLY_DISEASE_VARIENT"===b){var j={type:null,professional:{id:e,value:f,userType:"H"}};l.setStateParamsToLocalStarage("monthlyDiseaseVariantLinkedStatastics",j),d.go("monthlyDiseaseVariantLinkedStatastics",j)}if("REVIEWS"===b){var k;"H"===h?k="healthproreviewlist":"S"===h&&(k="supportproreviewlist"),k&&d.go(k,{type:null,professional:{id:c,userName:f}})}}}]),angular.module("paripal.manageProfessionalSummary").service("manageProfessionalSummaryService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.saveProfessionalSummary=function(e,f,g,h,i,j,k,l,m,n){d.isEmpty(e)||(d.isEmpty(f)||d.isEmpty(f.data)||(e.user={},e.user.id=f.data.id),"H"==l?this.fillHealthProfessionalData(e,g,h,i,j,k):"S"==l&&this.fillSupportProfessionalData(e,g,h,i,j,k),e.confirmationDate&&(e.confirmationDate=c.convertToServerDate(e.confirmationDate)),e.whetherActive=!0),e.id?"H"==l?a.putData(b.getUrl("UPDATE_HEALTH_PROFESSIONAL_SUMMARY"),e,function(a){a&&a.data?m(a.data):n(a)},function(a){n(a)}):"S"==l&&a.putData(b.getUrl("UPDATE_SUPPORT_PROFESSIONAL_SUMMARY"),e,function(a){a&&a.data?m(a.data):n(a)},function(a){n(a)}):(delete e.version,"H"==l?a.postData(b.getUrl("SAVE_HEALTH_PROFESSIONAL_SUMMARY"),e,function(a){a&&a.data?m(a.data):n(a)},function(a){n(a)}):"S"==l&&a.postData(b.getUrl("SAVE_SUPPORT_PROFESSIONAL_SUMMARY"),e,function(a){a&&a.data?m(a.data):n(a)},function(a){n(a)}))},this.getProfessionalSummaryData=function(c,d,e,f){var g={};g.userId=c;
//professionalObject.type = type;
var h=null;"H"==d?h=b.getParameterizedUrl("GET_HEALTH_PROFESSIONAL_SUMMARY",g):"S"==d&&(h=b.getParameterizedUrl("GET_SUPPORT_PROFESSIONAL_SUMMARY",g)),a.getData(h,null,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.fillHealthProfessionalData=function(a,b,c,e,f,g){return d.isEmpty(a.professionalTypeId)||(a.healthProfessionalTypeId=a.professionalTypeId,delete a.professionalTypeId),d.isEmpty(a.professionalSubTypeId)||(a.healthProfessionalSubTypeId=a.professionalSubTypeId,delete a.professionalSubTypeId),d.isEmpty(b)||(a.healthCategoryId1=b.dataValue),d.isEmpty(c)||(a.healthCategoryId2=c.dataValue),d.isEmpty(e)||(a.healthCategoryId3=e.dataValue),d.isEmpty(f)||(a.healthCategoryId4=f.dataValue),d.isEmpty(g)||(a.healthCategoryId5=g.dataValue),a.whetherHealthProfileCreated=!0,a},this.fillSupportProfessionalData=function(a,b,c,e,f,g){return d.isEmpty(a.professionalTypeId)||(a.supportProfessionalTypeId=a.professionalTypeId,delete a.professionalTypeId),d.isEmpty(a.professionalSubTypeId)||(a.supportProfessionalSubTypeId=a.professionalSubTypeId,delete a.professionalSubTypeId),d.isEmpty(b)||(a.supportCategoryId1=b.dataValue),d.isEmpty(c)||(a.supportCategoryId2=c.dataValue),d.isEmpty(e)||(a.supportCategoryId3=e.dataValue),d.isEmpty(f)||(a.supportCategoryId4=f.dataValue),d.isEmpty(g)||(a.supportCategoryId5=g.dataValue),a.whetherSupportProfileCreated=!0,a}}]),angular.module("paripal.professionalTreatmentModule").controller("DiseaseVariantLinkedListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","diseaseVariantLinkedListService","manageDiseaseVariantLinkedService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")},l.isEmpty(c)&&d.go("home.view"),a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.isFieldRequired=!0,a.searchCriteria={},a.searchCriteria.professional={},a.searchCriteria.diseaseVariant={},a.WSDiseaseVariantList=[],a.diseaseVariantProfSpinner=!1,a.professional={},a.variant={queryUrl:"GET_DISEASE_VARIANTS",queryParameter:{},jsonParameter:{}},a.$watch("professional",function(b){!l.isEmpty(b)&&b.id?a.isFieldRequired=!0:a.isFieldRequired=!1},!0),a.$watch("searchCriteria.diseaseVariant",function(b){!l.isEmpty(b)&&b.id?a.isFieldRequired=!1:a.isFieldRequired=!0},!0),a.onProfessionalSelect=function(b){a.searchCriteria.professional=b.data},
//Search Disease Variant Linked
a.searchDiseaseVariantLinked=function(){a.diseaseVariantProfSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,m.searchDiseaseVariantLinked(a.searchCriteria,function(b){a.diseaseVariantProfSpinner=!1,a.WSDiseaseVariantList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.diseaseVariantProfSpinner=!1,f("error",g.instant("FAILED_TO_LOAD_RECORD"))})},a.showReport=function(a,b){d.go(a,{professional:b.professional})},a.manageDiseaseVariantLinked=function(b,c,d){h.show({controller:"ManageDiseaseVariantLinkedCtrl",templateUrl:"app/modules/manage-professional-treatment/views/manage-disease-variant-liked.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:o.dialogBox.clickOutsideToClose,locals:{stateParams:{type:d,professional:a.searchCriteria.professional,professionalVariantId:c},parentScope:a}}).then(function(){},function(){})},
//Fetch records
a.fetchRecords=function(){a.searchDiseaseVariantLinked()},
//clear search
a.clear=function(){a.searchCriteria={},a.WSDiseaseVariantList=[]},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchDiseaseVariantLinked()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchDiseaseVariantLinked()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){l.isEmpty(c.professional)||(a.searchCriteria.professional={id:c.professional.id,value:c.professional.value},a.professional.data={},a.professional.data=a.searchCriteria.professional,a.searchDiseaseVariantLinked()),"professionalwall"===c.type?(c=k.getStateParamsFromLocalStarage(c,""),a.fromProfessionalWall=!0):c=k.getStateParamsFromLocalStarage(c,"diseaseVariantLinkedList")},a.init()}]),angular.module("paripal.professionalTreatmentModule").controller("ManageDiseaseVariantLinkedCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","applicationExceptionService","manageDiseaseVariantLinkedService","stateParams","parentScope","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";c=q,a.WSDiseaseVariantLinked={},a.WSDiseaseVariantLinked.version=null,a.WSDiseaseVariantLinked.professional={},a.WSDiseaseVariantLinked.diseaseVariant={},a.professional={},a.variant={queryUrl:"GET_DISEASE_VARIANTS",queryParameter:{},jsonParameter:{}},
// Add/update disease variant linked
a.saveDiseaseVariantLinked=function(){p.saveDiseaseVariantLinked(a.WSDiseaseVariantLinked,c.type,function(a){h("success",a.successMessage),e.cancel(),r.searchDiseaseVariantLinked()},function(a){h("error",i.instant("FAILED_TO_SAVE_RECORD"))})},a.getDiseaseVariantLinkedDetails=function(b,c){n.isNullOrEmpty(b)||p.getDiseaseVariantLinkedDetails(b,function(b){a.setDataToDiseaseVariantLinkedForm(b)},function(a){h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},a.setDataToDiseaseVariantLinkedForm=function(b){n.isEmpty(b)||(a.WSDiseaseVariantLinked=b,a.professional.data=b.professional)},
// on cancel forward to search list
a.cancel=function(){e.cancel()},a.hide=function(){e.hide()},a.onProfessionalSelect=function(b){a.WSDiseaseVariantLinked.professional=b.data},
//Init Method
a.init=function(){a.orgLocPermissions=s.PROF_DISEASE_VARIANT_ADD,"add"===c.type?(a.pageState="add",n.isEmpty(c.professional)||(a.professional.data=c.professional,a.WSDiseaseVariantLinked.professional=c.professional)):"edit"===c.type?(a.pageState="edit",a.getDiseaseVariantLinkedDetails(c.professionalVariantId,c.type)):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0,a.getDiseaseVariantLinkedDetails(c.professionalVariantId,c.type))},a.init()}]),angular.module("paripal.professionalTreatmentModule").controller("ManageProfessionalTreatmentCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","applicationExceptionService","manageProfessionalTreatmentService","stateParams","parentScope","featurePrivilegeConstants","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";c=q,a.isProfessionalSelected=!1,a.WSProfessionalTreatmentType={},a.WSProfessionalTreatmentType.version=null,a.WSProfessionalTreatmentType.professional={},a.WSProfessionalTreatmentType.treatmentType={},a.WSProfessionalTreatmentType.organizationLocation={},a.totalClients=0,a.showTotalClients=!1,a.WSProfessionalTreatmentType.whetherActive=!0,a.organizationLocation={},a.professional={},/* $scope.userName = {
             queryUrl: "PROFESSIONALS_BY_NAME_COMBO",
             queryParameter: {
                 type: (utilService.isFieldEmpty($stateParams.userType)) ? null : $stateParams.userType
             },
             jsonParameter: {}
         };
         console.log($scope.WSProfessionalTreatmentType.professional);
         $scope.orgLoc = {
             queryUrl: "FIND_ACCESSIBLE_LOCATION_BY_USER_ID",
             queryParameter: {
                 id: ((utilService.isEmpty($scope.WSProfessionalTreatmentType.professional)) ? null : $scope.WSProfessionalTreatmentType.professional.id)
             },
             jsonParameter: {}
         };*/
a.$watch("professional",function(b){!n.isEmpty(b)&&b.data.id?a.isProfessionalSelected=!0:/*     $scope.organizationLocation = {};
                     $scope.$broadcast("clearOrganizationLocation");*/
a.isProfessionalSelected=!1},!0),a.$watch("organizationLocation",function(b){a.isOrgSelected=n.isFieldEmpty(b)},!0),
// Add/update follow up EXCEPTION
a.saveProfessionalTreatmentType=function(){n.isNullOrEmpty(a.WSProfessionalTreatmentType.organizationLocation)||(delete a.WSProfessionalTreatmentType.organizationLocation.salesTaxCode,delete a.WSProfessionalTreatmentType.organizationLocation.tin,delete a.WSProfessionalTreatmentType.organizationLocation.whetherAggregator),a.WSProfessionalTreatmentType.treatmentType?a.WSProfessionalTreatmentType.treatmentType.id||(a.WSProfessionalTreatmentType.treatmentType={value:a.treatment.queryParameter.searchString}):a.WSProfessionalTreatmentType.treatmentType={value:a.treatment.queryParameter.searchString},p.saveProfessionalTreatmentType(a.WSProfessionalTreatmentType,c.professionalTreatmentTypeId,c.type,function(a){h("success",a.successMessage),e.cancel(),r.searchProfessionalTreatmentType()},function(a){h("error",i.instant("FAILED_TO_SAVE_RECORD"))},a.whetherExisting)},a.getProfessionalTreatmentTypeDetails=function(b,c){n.isNullOrEmpty(b)||p.getProfessionalTreatmentTypeDetails(b,function(b){a.setDataToProfessionalTreeatmentTypeForm(b)},function(a){h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},a.onOrgSelect=function(b){a.WSProfessionalTreatmentType.organizationLocation=b.data;var d="GET_HEALTH_TREATMENT_TYPE_BY_LOCATION";"H"==c.userType?d="GET_HEALTH_TREATMENT_TYPE_BY_LOCATION":"S"==c.userType&&(d="GET_SUPPORT_TREATMENT_TYPE_BY_LOCATION"),a.treatment={queryUrl:d,queryParameter:{orgLocId:b.data.id},jsonParameter:{}}},a.onProfessionalSelect=function(b){a.WSProfessionalTreatmentType.professional=b.data},a.setDataToProfessionalTreeatmentTypeForm=function(b){n.isEmpty(b)||(a.WSProfessionalTreatmentType=b),a.organizationLocation.data=b.organizationLocation,a.professional.data=b.professional,a.WSProfessionalTreatmentType.professional=a.professional.data},
// on cancel forward to search list
a.cancel=function(){e.cancel()},a.hide=function(){e.hide()},a.$watch("WSProfessionalTreatmentType.treatmentType",function(){a.WSProfessionalTreatmentType.treatmentType&&a.WSProfessionalTreatmentType.treatmentType.id&&0==a.isObjSelected?(a.isObjSelected=!0,a.whetherExisting=!1,a.disableCheck=!0):a.isObjSelected=!1}),a.$watch("treatment.queryParameter.searchString",function(b){a.WSProfessionalTreatmentType.treatmentType&&a.WSProfessionalTreatmentType.treatmentType.id&&(a.WSProfessionalTreatmentType.treatmentType=null),a.isObjSelected=!1,a.disableCheck=!1}),
//Init Method
a.init=function(){if(a.whetherExisting=!1,"add"===c.type){!n.isEmpty(c.user),a.disabledFormFields=!1,a.pageState="add";var b=t.getDefaultOrgLocation();n.isFieldEmpty(b)||(a.organizationLocation.data={},a.organizationLocation.data={id:b.orgLoc.id,value:b.orgLoc.value},a.onOrgSelect(a.organizationLocation))}else"edit"===c.type?(a.showTotalClients=!0,a.pageState="edit",a.getProfessionalTreatmentTypeDetails(c.professionalTreatmentTypeId,c.type),a.disabledFormFields=!1):"view"===c.type&&(a.showTotalClients=!0,a.pageState="view",a.disabledFormFields=!0,a.getProfessionalTreatmentTypeDetails(c.professionalTreatmentTypeId,c.type));"H"==c.userType&&(a.orgLocPermission=s.HEALTH_PROF_TREATMNT_ADD,a.urlByUserType="GET_PROFESSIONAlS_BY_ORGLOCID"),"S"==c.userType&&(a.orgLocPermission=s.SUPPORT_PROF_TREATMNT_ADD,a.urlByUserType="GET_SUPPORT_PROFESSIONAL_BY_PNAME_LOCID"),c.user.value&&(a.professional.data=c.user,a.WSProfessionalTreatmentType.professional=a.professional.data);/* locationCategory label changes */
var d=t.getLocationCategory();a.gridLabel={},n.isFieldEmpty(d)?a.gridLabel.noOfUsers=i.instant("NO_OF_CLIENTS"):"EDUCATIONAL_INSTITUTION"==d.code?a.gridLabel.noOfUsers=i.instant("NO_OF_STUDENTS"):"CORPORATE"==d.code?a.gridLabel.noOfUsers=i.instant("NO_OF_EMPLOYEES"):"SERVICE_PROVIDER"==d.code&&(a.gridLabel.noOfUsers=i.instant("NO_OF_CLIENTS"))},a.init()}]),angular.module("paripal.professionalTreatmentModule").controller("MonthlyDiseaseVariantLinkedListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","baseService","utilService","monthlyDiseaseVariantLinkedListService",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";c=i.getStateParamsFromLocalStarage(c,"monthlyDiseaseVariantLinkedStatastics"),j.isEmpty(c)&&d.go("home.view"),a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.searchCriteria.professional={},a.searchCriteria.month={},a.searchCriteria.year=null,a.wsMonthlyDiseaseVariantList=[],a.monthlyDisesVarProfSpinner=!1,a.professional={},
//Search Disease Variant Linked
a.searchDiseaseVariantLinked=function(){a.monthlyDisesVarProfSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,k.searchDiseaseVariantLinked(a.searchCriteria,function(b){a.monthlyDisesVarProfSpinner=!1,a.wsDiseaseVariantList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.monthlyDisesVarProfSpinner=!1,f("error",g.instant("FAILED_TO_LOAD_RECORD"))})},a.onProfessionalSelect=function(b){a.searchCriteria.professional=b.data},
//Fetch records
a.fetchRecords=function(){a.searchDiseaseVariantLinked()},
//clear search
a.clear=function(){a.searchCriteria={},a.wsDiseaseVariantList=[]},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchDiseaseVariantLinked()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchDiseaseVariantLinked()};
//datatble config json
var l={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(l),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){j.isEmpty(c.professional)||(a.searchCriteria.professional={id:c.professional.id,value:c.professional.value},a.fromProfessionalWall=!0,a.professional.data={},a.professional.data=a.searchCriteria.professional);var b=new Date;a.searchCriteria.month={id:b.getUTCMonth()+1},a.searchCriteria.year=b.getUTCFullYear(),a.searchDiseaseVariantLinked()},a.init()}]),angular.module("paripal.professionalTreatmentModule").controller("ProfessionalTreatmentListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","professionalTreatmentListService","manageProfessionalTreatmentService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";
//$stateParams = baseService.getStateParamsFromLocalStarage($stateParams, "professionalTreatmentList");
l.isEmpty(c)&&d.go("home.view"),a.currentPage=o.defaultPageNo,a.itemPerPage=o.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.requestData={},a.commonConstants=o,a.searchCriteria={},a.searchCriteria.user={},a.addressInfoFilter={},a.wsTreatmentList=[],a.userType=null,a.mangeProfTreatmentSpinner=!1,l.isEmpty(c.user)||(a.userType=c.user.userType),a.user={queryUrl:"PROFESSIONALS_BY_NAME_COMBO",queryParameter:{type:a.userType},jsonParameter:{}},a.userRequired=!0,a.showReport=function(a,b){d.go(a,{professional:b.professional})},
//Search User Address
a.searchProfessionalTreatmentType=function(){a.mangeProfTreatmentSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,m.searchProfessionalTreatment(a.searchCriteria,a.addressInfoFilter,c.user.whetherHealthProfessional,function(b){a.mangeProfTreatmentSpinner=!1,a.wsTreatmentList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.mangeProfTreatmentSpinner=!1,f("error",g.instant("TREATMENT_LIST_LOAD_FAILURE"))})},a.manageProfessionalTreatment=function(b,c,d){h.show({controller:"ManageProfessionalTreatmentCtrl",templateUrl:"app/modules/manage-professional-treatment/views/manage-professional-treatment.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:a.commonConstants.dialogBox.clickOutsideToClose,locals:{stateParams:{type:d,user:a.searchCriteria.user,userType:a.userType,professionalTreatmentTypeId:c},parentScope:a}}).then(function(){},function(){})},
//Fetch records
a.fetchRecords=function(){a.searchProfessionalTreatmentType()},
//clear search
a.clear=function(){a.searchCriteria={},a.addressInfoFilter={},a.wsTreatmentList=[],a.totalItems=0,a.pagingInfo={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchProfessionalTreatmentType()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchProfessionalTreatmentType()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){"professionalwall"===c.type?(c=k.getStateParamsFromLocalStarage(c,""),c.user.whetherHealthProfessional=!0,a.fromProfessionalWall=!0,a.userType="H"):c=k.getStateParamsFromLocalStarage(c,"professionalTreatmentList"),l.isEmpty(c.user)||(a.searchCriteria.user={id:c.user.id,value:c.user.value},a.searchProfessionalTreatmentType());/* locationCategory label changes */
var b=k.getLocationCategory();a.gridLabel={},l.isFieldEmpty(b)?a.gridLabel.noOfUsers=g.instant("NO_OF_CLIENTS"):"EDUCATIONAL_INSTITUTION"==b.code?a.gridLabel.noOfUsers=g.instant("NO_OF_STUDENTS"):"CORPORATE"==b.code?a.gridLabel.noOfUsers=g.instant("NO_OF_EMPLOYEES"):"SERVICE_PROVIDER"==b.code&&(a.gridLabel.noOfUsers=g.instant("NO_OF_CLIENTS"))},a.init()}]),angular.module("paripal.professionalTreatmentModule").service("diseaseVariantLinkedListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchDiseaseVariantLinked=function(c,d,f){e.isEmpty(c.professional)&&delete c.professional,e.isEmpty(c.diseaseVariant)&&delete c.diseaseVariant,a.postData(b.getUrl("SEARCH_DISEASE_VARIANT_LINKED_LIST"),c,function(a){d(a.data)},function(a){f(a)})}}]),angular.module("paripal.professionalTreatmentModule").service("manageDiseaseVariantLinkedService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveDiseaseVariantLinked=function(c,d,e,f){"add"===d?a.postData(b.getUrl("ADD_DISEASE_VARIANT_LINKED"),c,function(a){e(a.data)}):"edit"===d&&a.putData(b.getUrl("UPDATE_DISEASE_VARIANT_LINKED"),c,function(a){e(a.data)})},this.getDiseaseVariantLinkedDetails=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_DISEASE_VARIANT_DETAILS",f),null,function(a){d(a&&a.data?a.data:a)},function(a){e(a)})}}]),angular.module("paripal.professionalTreatmentModule").service("manageProfessionalTreatmentService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveProfessionalTreatmentType=function(c,e,f,g,h,i){"add"===f?(d.isNullOrEmpty(c.totalClients)&&(c.totalClients=0),i&&(c.whetherExistingTreatmentType=!i),d.isFieldEmpty(c.whetherExistingTreatmentType)&&(c.whetherExistingTreatmentType=!0),a.postData(b.getUrl("ADD_PROFESSIONAL_TREATMENT_TYPE"),c,function(a){g(a.data)})):"edit"===f&&a.putData(b.getUrl("UPDATE_PROFESSIONAL_TREATMENT_TYPE"),c,function(a){g(a.data)})},this.getProfessionalTreatmentTypeDetails=function(c,d){var e={};e.professionalTreatmentTypeId=c,a.getData(b.getParameterizedUrl("GET_PROFESSIONAL_TREATMENT_TYPE_BY_ID",e),null,function(a){d(a&&a.data?a.data:a)},function(a){})}}]),angular.module("paripal.professionalTreatmentModule").service("monthlyDiseaseVariantLinkedListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchDiseaseVariantLinked=function(c,d,f){var g={};e.isEmpty(c.professional)?delete c.professional:g.professional=c.professional,e.isEmpty(c.month)?delete c.month:g.month=c.month.id,e.isNullOrEmpty(c.year)?delete c.year:g.year=c.year,e.isNullOrEmpty(c.sorters)||(g.sorters=c.sorters),a.postData(b.getUrl("GET_PROFESSIONAL_DISEASE_STATASTICS"),g,function(a){d(a.data)},function(a){f(a)})}}]),angular.module("paripal.professionalTreatmentModule").service("professionalTreatmentListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchProfessionalTreatment=function(c,d,f,g,h){var i={};e.isEmpty(c.user)||(i.user={id:c.user.id}),e.isNullOrEmpty(c.pageNumber)||(i.pageNumber=c.pageNumber),e.isNullOrEmpty(c.recordsPerPage)||(i.recordsPerPage=c.recordsPerPage),e.isNullOrEmpty(f)||(i.whetherHealthProfessional=f),e.isEmpty(d.countryValue)||(i.country=d.countryValue),e.isEmpty(d.stateValue)||(i.state=d.stateValue),e.isEmpty(d.cityValue)||(i.city=d.cityValue),e.isEmpty(d.districtValue)||(i.district=d.districtValue),e.isEmpty(d.postalCode)||(i.postalCode=c.postalCode),e.isNullOrEmpty(c.sorters)||(i.sorters=c.sorters),a.postData(b.getUrl("SEARCH_PROFESSIONAL_TREATMENT_TYPE_LIST"),i,function(a){g(a.data)},function(a){h(a)})}}]),angular.module("paripal.manageRole").controller("LinkUserRoleCtrl",["$scope","httpService","service","$stateParams","$state","dateconvertor","urlService","notify","utilService","baseService",function(a,b,c,d,e,f,g,h,i,j){var k,l={},m=function(){a.linkUserRole={},a.requestData={},a.linkUserRoleEdit={},a.viewModeValidFrom=!1,a.viewModeValidTill=!1,a.editMode=!1,a.viewMode=!1,a.fromMinDate=new Date,a.singleOrganization=!1,a.singleLocation=!1,a.locations,a.userIdErr=!1,a.roleIdErr=!1,a.validFromError=!1,a.validTillError=!1,a.organizationList=[],a.locations=[],a.organization={},a.organizationLocation={}};m(),/*
                 * Fetch organization locations on selection of organization
                 */
a.init=function(){/*
                     * This condition is satisfied for edit functionality
                     */
if("edit"===d.type||"view"===d.type)a.editMode=!0,a.singleOrganization=!0,"view"===d.type&&(a.viewMode=!0),a.singleLocation=!0,k=d.data,/*
                         * Calling apirequest
                         */
a.apirequestFunction(k);else{var b=j.getDefaultOrgLocation();i.isFieldEmpty(b)||(a.organization={data:b.org},a.organizationLocation={data:b.orgLoc})}},/*
                 * This method is used to fetch org locations
                 * @param {orgId} var : organization ID
                 */
a.loadLocations=function(c){a.requestData={},a.requestData.orgId=c,b.getData(g.getParameterizedUrl("FIND_ORGLOCBYID",a.requestData),null,function(b){a.locations=angular.fromJson(b.data),1===a.locations.length?(a.linkUserRole.orgLocationId=a.locations[0].orgLocationId,a.linkUserRole.orgLocationName=a.locations[0].orgLocationName,a.singleLocation=!0):a.singleLocation=!1},function(a){})},a.setLinkUserRoleData=function(b){a.linkUserRoleEdit=angular.fromJson(b.data),a.linkUserRole=a.linkUserRoleEdit,a.organization={data:{id:b.data.organizationId,value:b.data.organizationName}},a.organizationLocation={data:{id:b.data.organizationId,value:b.data.organizationName}},a.organizationList.push({organizationName:a.linkUserRoleEdit.organizationName,organizationId:a.linkUserRoleEdit.organizationId}),a.locations.push({orgLocationId:a.linkUserRoleEdit.orgLocationId,orgLocationName:a.linkUserRoleEdit.orgLocationName}),a.linkUserRole.validFrom=f.convertToViewDate(a.linkUserRoleEdit.validFrom),null!==a.linkUserRoleEdit.validTill?a.linkUserRole.validTill=f.convertToViewDate(a.linkUserRoleEdit.validTill):a.linkUserRole.validTill="",a.linkUserRole.user={displayName:a.linkUserRole.userName,id:a.linkUserRole.userId},a.linkUserRole.role={roleName:a.linkUserRole.roleName,roleId:a.linkUserRole.roleId,roleValidFrom:a.linkUserRole.roleValidFrom,roleValidTill:a.linkUserRole.roleValidTill},a.viewModeValidFrom=i.dateComparator(a.linkUserRole.validFrom,new Date,"lt"),a.viewModeValidTill=i.dateComparator(a.linkUserRole.validTill,new Date,"lt"),a.viewModeValidFrom&&a.viewModeValidTill&&(a.uneditable=!0),"view"===d.type&&(a.viewModeValidFrom=!0,a.viewModeValidTill=!0)},a.apirequestFunction=function(c){a.requestData={},a.requestData.userRoleId=c.userRoleId,b.getData(g.getParameterizedUrl("FIND_USERROLEBYID",a.requestData),null,function(b){a.setLinkUserRoleData(b)},function(a){})},/*
                 * Fetch user name on type
                 *  * @Param viewValue
                 */
a.getUserNames=function(c,d){return a.userData={},a.userData.userName=c,d?a.userData.orgLocationId=d:a.userData.orgLocationId=a.organizationLocation.data.id,a.userNameAutoCmpLoading=!0,b.getData(g.getParameterizedUrl("SEARCH_USERBYORGLOC",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},/*
                 * Fetch role name on type
                 *  * @Param viewValue
                 */
a.getRoleNames=function(c,d){return a.roleData={},a.roleData.roleName=c,a.roleData.orgId=d,a.roleNameAutoCmpLoading=!0,b.getData(g.getParameterizedUrl("FIND_ROLEBYORGID",a.roleData),null,function(b){return a.roleNameAutoCmpLoading=!1,a.roleNames=angular.fromJson(b.data)},function(b){a.roleNameAutoCmpLoading=!1})},a.userNameChanged=function(){a.userIdErr=!1},a.roleNameChanged=function(){a.roleIdErr=!1},a.locationChanged=function(){a.linkUserRole.user=""},/*
                 * Adds new Link_User_Role or updates the existing
                 */
a.createUserRole=function(c){var d=c.$valid;a.linkUserRole.user&&i.isNullOrEmpty(a.linkUserRole.user.id)&&(a.userIdErr=!0,d=!1),a.linkUserRole.role&&i.isNullOrEmpty(a.linkUserRole.role.roleId)&&(a.roleIdErr=!0,d=!1),d&&(l.roleId=a.linkUserRole.role.roleId,l.userId=a.linkUserRole.user.id,l.validFrom=a.linkUserRole.validFrom,l.validTill=a.linkUserRole.validTill,a.linkUserRole.validFrom&&(l.validFrom=f.convertToServerDate(a.linkUserRole.validFrom)),a.linkUserRole.validTill&&(l.validTill=f.convertToServerDate(a.linkUserRole.validTill)),a.linkUserRole.version&&(l.version=a.linkUserRole.version),a.linkUserRole.id&&(l.id=a.linkUserRole.id),l.organizationId=a.organization.data.id,l.orgLocationId=a.organizationLocation.data.id,i.isNullOrEmpty(l.id)?b.postData(g.getUrl("CREATE_USERROLELINK"),l,function(a){a=angular.fromJson(a),e.go("userrolehistorylist"),h("success",a.data.successMessage)},function(a){}):(a.putRequestData={},a.putRequestData.userRoleId=l.id,b.putData(g.getParameterizedUrl("UPDATE_USERROLELINK",a.putRequestData),l,function(a){a=angular.fromJson(a),e.go("userrolehistorylist"),
//TODO: [NKL] Remove hard coding
h("success",a.data.successMessage)},function(a){})))},a.init(),/*
                 * Clears all field on click
                 */
a.clearAll=function(){a.addNewLinkUserRole.$setUntouched(),a.addNewLinkUserRole.$setPristine(),a.addNewLinkUserRole.roleName.$error.maxlength=!1,a.init(),m()},/*
                 * Takes back to 'Role History List' page
                 */
a.back=function(){i.goBackToPrevState()}}]),angular.module("paripal.manageRole").controller("ManageRoleCtrl",["$scope","$stateParams","$state","$location","$filter","$translate","service","notify","dateconvertor","utilService","urlService","httpService","numbering","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.newRole={},a.editMode={roleName:!1,createdFor:!1,label:!1},a.viewMode=!1,a.isLocationDisable=!1,a.viewModeValidFrom=!1,a.viewModeValidTill=!1,a.whetherSystemRole=!1,a.isValidFromDate=!1,a.isValidTillDate=!0,a.pageTypeValue=b.type,a.newRole.organization={},a.newRole.organizationLocation={},a.dateErrorList=[],a.fromMinDate=new Date,a.init=function(){if(a.isFieldMatchWithTbCOl=function(a,b){return m(a,b)},l.getData(k.getUrl("GET_ORG"),null,function(b){a.organizationList=angular.fromJson(b.data),1===a.organizationList.length?(a.newRole.organizationName=a.organizationList[0].organizationName,a.newRole.organizationId=a.organizationList[0].organizationId,a.createdFor=!0):a.createdFor=!1},function(a){h("error",f.instant("ERROR_OCCURED_WHILE_FETCHING_RECORD"))}),"edit"!=b.type&&"view"!=b.type){var c=n.getDefaultOrgLocation();j.isFieldEmpty(c)||(a.newRole.organization={data:c.org},a.newRole.organizationLocation={data:c.orgLoc})}},a.init(),a.setNewRoleData=function(b){b.whetherSystemRole?(a.whetherSystemRole=!0,a.editMode.roleName=!0,a.editMode.createdFor=!0,a.viewMode=!0,
//$scope.newRole.whetherSystemRole = "true";
null===b.organizationName&&(a.newRole.organizationName="NA"),a.newRole.id=b.id):(a.whetherSystemRole=!1,a.editMode.roleName=!0,a.editMode.createdFor=!0,a.editMode.label=!0,a.newRole.id=b.id,a.newRole.organizationId=b.organizationId),a.newRole.role={roleName:b.roleName,roleId:b.id},a.newRole.organizationName=b.organizationName,a.newRole.validFrom=e("timestampToDate")(b.validFrom,"MM/dd/yyyy"),null!==b.validTill?a.newRole.validTill=e("timestampToDate")(b.validTill,"MM/dd/yyyy"):a.newRole.validTill="",j.dateComparator(a.newRole.validFrom,new Date,"let")?(a.viewModeValidFrom=!0,a.fromMinDate=new Date(a.newRole.validFrom)):(a.viewModeValidFrom=!1,a.fromMinDate=new Date),a.editMode.roleName===!0&&a.editMode.createdFor===!0&&a.viewModeValidFrom===!0&&a.viewModeValidTill===!0&&(a.viewMode=!0)},/*
             * This function is used to get roles for auto-complete functionality.
             * It is called on every alphabet after the 3rd alphabet.
             */
a.getRoles=function(b){return a.requestData={},a.requestData.roleName=b,l.getData(k.getParameterizedUrl("FIND_ROLEBYNAME",a.requestData),null,function(b){return a.roles=angular.fromJson(b.data)},function(a){h("error",f.instant("ERROR_OCCURED_WHILE_FETCHING_RECORD"))})},/*$scope.checkTillDateValidation = function (tillDate) {
    if (tillDate !== undefined) {
        $scope.isTillDateLessThanFromDate = utilService.dateComparator(tillDate, $scope.newRole.validFrom, 'lt');
        $scope.isSaveDisabled = utilService.dateComparator(tillDate, $scope.newRole.validFrom, 'get');
        $scope.isTillDateLessThanTodayDate = utilService.dateComparator(tillDate, new Date(), 'get');
        $scope.isSaveDisabled = utilService.dateComparator(tillDate, new Date(), 'lt');
        if ($stateParams.type !== 'edit') {
            $scope.isFromDateLessThanTodayDate = utilService.dateComparator($scope.newRole.validFrom, tillDate, 'lt');
            $scope.isSaveDisabled = utilService.dateComparator(fromDate, new Date(), 'lt');
        };
        $scope.isFromDateLessThanTodayDate = utilService.dateComparator($scope.newRole.validFrom, tillDate, 'lt');
        $scope.isSaveDisabled = utilService.dateComparator($scope.newRole.validFrom, tillDate, 'lt');
        $scope.requestValidTill = dateconvertor.convertToServerDate($scope.newRole.validTill);
    };
};

$scope.checkFromDateValidation = function (fromDate) {
    if (fromDate !== undefined) {
        $scope.isFromDateLessThanTodayDate = utilService.dateComparator(fromDate, new Date(), 'lt');
        $scope.isSaveDisabled = utilService.dateComparator(fromDate, new Date(), 'lt');
        if ($scope.newRole.validTill !== undefined) {
            $scope.isFromDateLessThanTillDate = utilService.dateComparator(fromDate, $scope.newRole.validTill, 'lt');
            $scope.isSaveDisabled = utilService.dateComparator(fromDate, $scope.newRole.validTill, 'lt');
            $scope.isFromDateLessThanTillDate = utilService.dateComparator($scope.newRole.validTill, fromDate, 'get');
            $scope.isSaveDisabled = utilService.dateComparator($scope.newRole.validTill, fromDate, 'get');

        }
        $scope.checkTillDateValidation($scope.newRole.validTill);
        $scope.requestValidFrom = dateconvertor.convertToServerDate($scope.newRole.validFrom);
    };
};*/
/*
             * This function is called to add or edit a role
             */
a.createRole=function(b){a.requestObj={},a.dateError=!1,b&&(a.requestObj.validFrom=i.convertToServerDate(a.newRole.validFrom),a.requestObj.validTill=void 0===a.newRole.validTill?null:i.convertToServerDate(a.newRole.validTill),a.editMode.roleName===!0&&(a.requestObj.id=a.newRole.id),a.requestObj.organization=a.newRole.organization.data,a.requestObj.organizationLocation=a.newRole.organizationLocation.data,a.newRole.role.roleName?a.requestObj.roleName=a.newRole.role.roleName:a.requestObj.roleName=a.newRole.role,a.requestObj.whetherSystemRole=!1,void 0===a.newRole.id?l.postData(k.getUrl("CREATE_ROLE"),a.requestObj,function(a){c.go("rolelist"),h("success",a.data.successMessage)},function(a){}):(a.putRequestData={},a.putRequestData.roleId=a.requestObj.id,l.putData(k.getParameterizedUrl("UPDATE_ROLE",a.putRequestData),a.requestObj,function(a){c.go("rolelist"),h("success",a.data.successMessage)},function(a){})))},"edit"===b.type&&(a.newRole=b.data,a.editMode.roleName=!0,a.editMode.createdFor=!0,a.editMode.label=!0,a.newRole.organization.data=angular.copy(a.newRole.organization),a.newRole.organizationLocation.data=angular.copy(a.newRole.organizationLocation),a.isLocationDisable=!0,a.setNewRoleData(b.data)),"view"===b.type&&(a.editMode.roleName=!0,a.editMode.createdFor=!0,a.viewMode=!0),a.back=function(){j.goBackToPrevState()}}]),angular.module("paripal.manageRole").controller("ManageRolePrivilegeCtrl",["$scope","httpService","urlService","$filter","$stateParams","$state","notify","dateconvertor","utilService","$rootScope",function(a,b,c,d,e,f,g,h,i,j){a.role={},a.object={},a.featureList={},a.editMode=!1,a.newRolePrivilege={},a.fromMinDate=new Date,a.readOnlyFlag=!1,a.alreayExist=!1;var k=function(){void 0!==a.newRolePrivilege.validFrom&&(a.newRolePrivilege.validFrom=h.convertToViewDate(a.newRolePrivilege.validFrom)),void 0!==a.newRolePrivilege.validTill&&(a.newRolePrivilege.validTill=h.convertToViewDate(a.newRolePrivilege.validTill)),void 0!==a.newRolePrivilege.lastUpdatedDate&&(a.newRolePrivilege.lastUpdatedDate=h.convertToViewDate(a.newRolePrivilege.lastUpdatedDate)),i.dateComparator(a.newRolePrivilege.validFrom,new Date,"lt")?a.viewModeValidFrom=!0:a.viewModeValidFrom=!1,i.dateComparator(a.newRolePrivilege.validTill,new Date,"lt")?a.viewModeValidTill=!0:a.viewModeValidTill=!1},l=function(){a.object.role={roleId:a.newRolePrivilege.roleId,roleName:a.newRolePrivilege.roleName},a.object.feature={featureId:a.newRolePrivilege.featureId,featureCode:a.newRolePrivilege.featureCode},a.object.privilege={privilegeId:a.newRolePrivilege.privilegeId,privilegeCode:a.newRolePrivilege.privilegeCode}};"add"===e.type?a.pageState="add":"edit"===e.type?(a.newRolePrivilege=e.data,a.pageState="edit",k(),l()):"view"===e.type?(a.readOnlyFlag=!0,a.newRolePrivilege=e.data,a.pageState="view",k(),l()):a.pageState="manage",/**
     *
     * This function is to get list of Roles by user input
     */
a.getRoleNames=function(d){return a.requestData={},a.requestData.roleName=d,a.roleNameAutoCmpLoading=!0,b.getData(c.getParameterizedUrl("FIND_ROLEBYNAME",a.requestData),null,function(b){return a.roleNameAutoCmpLoading=!1,a.role=angular.fromJson(b.data)},function(b){a.roleNameAutoCmpLoading=!1})},/**
     *
     * This function is to get list of Features from Feature table by user input
     */
a.getFeatures=function(d){return a.featureData={},a.featureData.featureName=d,a.featureAutoCmpLoading=!0,b.getData(c.getParameterizedUrl("FIND_FEATUREBYNAME",a.featureData),null,function(b){return a.featureAutoCmpLoading=!1,a.featureList=angular.fromJson(b.data)},function(b){a.featureAutoCmpLoading=!1})},/**
     *
     * This function is to get list of Privileges of selected FeatureId by user input
     */
a.getPrivilegesByFeatureId=function(d){return a.privilegeData={},a.privilegeData.featureId=d,a.privilegeAutoCmpLoading=!0,b.getData(c.getParameterizedUrl("GET_PRIVILEGEBYFEATUREID",a.privilegeData),null,function(b){return a.privilegeAutoCmpLoading=!1,a.privilegeList=angular.fromJson(b.data)},function(b){a.privilegeAutoCmpLoading=!1})};/**
     *
     * This function is used to populate newRolePrivilege object with Role, Feature And Privilege
     */
var m=function(b){void 0!==a.object.role&&(b.roleId=a.object.role.roleId,b.roleName=a.object.role.roleName),void 0!==a.object.feature&&(b.featureId=a.object.feature.featureId,b.featureCode=a.object.feature.featureCode),void 0!==a.object.privilege&&(b.privilegeId=a.object.privilege.privilegeId,b.privilegeCode=a.object.privilege.privilegeCode)};/**
     *
     * This function performs add new rolePrivilege operations if id==undefined
     * else it performs update rolePrivilege Operation
     */
a.createRolePrivilege=function(d){var e={};angular.copy(a.newRolePrivilege,e),d.$valid&&(void 0!==a.newRolePrivilege.validFrom&&(e.validFrom=h.convertToServerDate(e.validFrom)),void 0!==a.newRolePrivilege.validTill&&(e.validTill=h.convertToServerDate(e.validTill)),e.lastUpdatedDate=new Date,m(e),j.showSpinner=!0,void 0===a.newRolePrivilege.id?b.postData(c.getUrl("CREATE_ROLEPRIVILEGE"),e,function(a){j.showSpinner=!1,f.go("roleprivilegelist"),g("success",a.data.successMessage)},function(a){}):(a.putRequestData={},a.putRequestData.rolePrivilegeId=e.id,b.putData(c.getParameterizedUrl("UPDATE_ROLEPRIVILEGE",a.putRequestData),e,function(a){j.showSpinner=!1,f.go("roleprivilegelist"),g("success",a.data.successMessage)},function(a){})))},/**
     *
     * This function redirect page To roleprivilegelist
     */
a.back=function(){i.goBackToPrevState()},/**
     *
     * This function resets form Untouched and Pristine
     */
a.clearAll=function(){a.addNewRolePrivilege.$setUntouched(),a.addNewRolePrivilege.$setPristine(),a.newRolePrivilege={},a.object={},a.editMode=!1,a.systemRole=!1,a.alreayExist=!1}}]),angular.module("paripal.manageRole").controller("RoleListCtrl",["$scope","$filter","$state","$location","datatableconfig","httpService","urlService","service","dateconvertor","notify","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k){a.organizationsList=[],a.filter={},a.requestData={},/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.fromMaxDate=new Date,a.tillMinDate=new Date,a.isDataFill=!0,a.init=function(){a.roleListSpinner=!0,a.requestData={},a.requestData.pageNumber=a.currentPage,a.requestData.recordsPerPage=a.itemPerPage,f.postData(g.getUrl("GET_ROLES"),a.requestData,function(b){a.roleListSpinner=!1,a.data=angular.fromJson(b.data),a.roles=a.data.data,a.totalItems=a.data.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.roleListSpinner=!1})},a.init(),
//Get roles name on autocomplete
a.getRolesNames=function(b){return a.roleNameAutoCmpLoading=!0,a.requestRoleData={},a.requestRoleData.roleName=b,f.getData(g.getParameterizedUrl("FIND_ALL_ROLEBYNAME",a.requestRoleData),null,function(b){return a.roleNameAutoCmpLoading=!1,a.roleNames=angular.fromJson(b.data)},function(b){a.roleNameAutoCmpLoading=!1})},
//Get user name on autocomplete
a.getUsers=function(b){return a.userNameAutoCmpLoading=!0,a.userData={},a.userData.userName=b,f.getData(g.getParameterizedUrl("FIND_USERBYNAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1,j("error","Error while fetching User Names link")})},
//Filter api
//Search record on filter criteria
a.searchRoles=function(){a.requestData={},a.requestData.pageNumber=a.currentPage,a.requestData.recordsPerPage=a.itemPerPage,a.requestData.roleName=a.filter.roleName,a.requestData.userName=a.filter.userName,void 0!=a.filter.roleValidFrom&&(a.requestData.roleValidFrom=i.convertToServerDate(a.filter.roleValidFrom)),void 0!=a.filter.roleValidTill&&(a.requestData.roleValidTill=i.convertToServerDate(a.filter.roleValidTill)),void 0!=a.filter.userValidFrom&&(a.requestData.userValidFrom=i.convertToServerDate(a.filter.userValidFrom)),void 0!=a.filter.userValidTill&&(a.requestData.userValidTill=i.convertToServerDate(a.filter.userValidTill)),a.roleListSpinner=!0,f.postData(g.getUrl("GET_ROLES"),a.requestData,function(b){a.roleListSpinner=!1,a.data=angular.fromJson(b.data),a.totalItems=a.data.totalRecords,a.roles=a.data.data,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.roleListSpinner=!1,j("error","Error While fetching data")})},a.clear=function(){a.filter={roleName:"",userName:""},a.init()},
//Add new Role
a.addNewRole=function(){c.go("managerole",{type:""})},
//view Role Statistics
a.viewRoleStatistics=function(b){a.requestData={},a.requestData.roleId=b.roleId,f.getData(g.getParameterizedUrl("FIND_ROLEBYID",a.requestData),null,function(a){c.go("rolestatistics",{type:"view",data:angular.fromJson(a.data)})},function(a){})},
//Edit selected role
a.editRole=function(b){a.requestData={},a.requestData.roleId=b.roleId,f.getData(g.getParameterizedUrl("FIND_ROLEBYID",a.requestData),null,function(a){c.go("managerole",{type:"edit",data:angular.fromJson(a.data)})},function(a){})},
//Redirect to view privileges screen
a.viewRolePrivilege=function(a){c.go("roleprivilegelist",{type:"edit",data:a})},a.viewRoleHistory=function(a){c.go("userrolehistorylist",{type:"edit",data:a})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.searchRoles()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchRoles()};
//datatble config json
var l={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:4,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(l),a.dtColumnDefs=e.setColumnProperties({notVisibleCol:[4]})}]),angular.module("paripal.manageRole").controller("RolePrivilegeListCtrl",["$scope","$filter","$stateParams","$state","datatableconfig","httpService","urlService","serverSidePagination","notify","$rootScope",function(a,b,c,d,e,f,g,h,i,j){a.features={},a.data={},a.filter={},a.object={},a.status={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={};/**
         * This function is to Redirect to ManageRolePrivilege screen @param type, @param id
         */
var k=function(b,c){a.requestData={},a.requestData.rolePrivilegeId=c,f.getData(g.getParameterizedUrl("FIND_ROLEPRIVILEGEBYID",a.requestData),null,function(a){d.go("manageroleprivilege",{type:b,data:angular.fromJson(a.data)})},function(){})};if(/**
         * This function is to Fetch the List of Features
         */
a.getRolesFeatures=function(){f.getData(g.getUrl("GET_FEATURES"),null,function(b){a.features=angular.fromJson(b.data)},function(){})},a.init=function(){a.getRolesFeatures()},a.init(),a.fetchRolePrivilegeList=function(){a.filter.pageNumber=a.currentPage,a.filter.recordsPerPage=a.itemPerPage,j.showSpinner=!0,f.postData(g.getUrl("GET_ROLEPRIVILEGES"),angular.fromJson(a.filter),function(b){j.showSpinner=!1,a.data=angular.fromJson(b.data),a.rolePrivileges=a.data.data,a.totalItems=a.data.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(a){})},null===c.type&&a.fetchRolePrivilegeList(),/**
         * This function is to fetch RolePrivileges @Param form
         */
a.fetchRolePrivilege=function(c){if(c.$valid){var d={};return a.rolePrivilegeListSpinner=!0,void 0!==a.filter.featureId&&(d.featureId=a.filter.featureId),void 0!==a.filter.privilegeId&&(d.privilegeId=a.filter.privilegeId),void 0!==a.object.role&&(d.roleName=a.object.role.roleName),d.pageNumber=a.currentPage,d.recordsPerPage=a.recordsPerPage,void 0!==a.filter.validFrom&&(d.validFrom=b("serverDate")(a.filter.validFrom,"yyyy-MM-dd")),void 0!==a.filter.validTill&&(d.validTill=b("serverDate")(a.filter.validTill,"yyyy-MM-dd")),f.postData(g.getUrl("GET_ROLEPRIVILEGES"),d,function(b){a.rolePrivilegeListSpinner=!1,d={},a.data=angular.fromJson(b.data),a.rolePrivileges=a.data.data,a.totalItems=a.data.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.rolePrivilegeListSpinner=!1})}},/**
         * This function is to Fetch the role names on type @Param viewValue
         */
a.getRolesNames=function(b){return a.requestRoleData={},a.requestRoleData.roleName=b,a.roleNameAutoCmpLoading=!0,f.getData(g.getParameterizedUrl("FIND_ALL_ROLEBYNAME",a.requestRoleData),null,function(b){return a.roleNameAutoCmpLoading=!1,a.roleNames=angular.fromJson(b.data)},function(b){a.roleNameAutoCmpLoading=!1})},/**
         * This function is to fetch the List of privileges related to @Param $scope.filter.featureId
         */
a.getPrivilegesByFeatureId=function(){null==a.filter.featureId||(a.privileges={},a.privileges.featureId=a.filter.featureId,f.getData(g.getParameterizedUrl("GET_PRIVILEGEBYFEATUREID",a.privileges),null,function(b){a.privileges=angular.fromJson(b.data)}))},
// Add new RolePrivilege
a.addNewRolePrivilege=function(){d.go("manageroleprivilege",{type:"add"})},
// Edit RolePrivilege
a.editRolePrivilege=function(a){k("edit",a.rolePrivilegeId)},
// View RolePrivilege
a.viewRolePrivilege=function(a){k("view",a.rolePrivilegeId)},a.confirmInactive=function(b){a.requestData={},a.requestData.rolePrivilegeId=b.rolePrivilegeId,f.deleteData(g.getParameterizedUrl("REMOVE_PRIVILEGE",a.requestData),null,function(b){i("success",b.data.successMessage);var c={$valid:!0};a.fetchRolePrivilege(c)},function(){})},"edit"===c.type){a.status.open=!0,a.data=c.data,a.object.role={roleName:a.data.roleName,roleId:a.data.roleId},a.getRolesFeatures();var l={$valid:!0};a.fetchRolePrivilege(l)}a.clearAll=function(){a.filter={},a.privileges=[],a.object={role:{roleName:""}},a.fetchRolePrivilegeList()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRolePrivilegeList()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.fetchRolePrivilegeList()};
//datatble config json
var m={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:3,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(m),a.dtColumnDefs=e.setColumnProperties({notVisibleCol:[3]})}]),angular.module("paripal.manageRole").controller("RoleStatisticsCtrl",["$scope","dateconvertor","httpService","urlService","notify","utilService","$rootScope","$translate","$stateParams",function(a,b,c,d,e,f,g,h,i){a.data=[],a.object={},a.roleStatistics={},a.roleList=[],a.object.organization={},a.object.organization.data={},a.object.orgLocation={},a.orgLocationDisabled=!0,a.status={open:!0},a.options={value:"ROLE_STATISTICS"},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b};var j=function(){c.getData(d.getUrl("GET_ALLORGLOC"),null,function(b){a.orgLocationList=angular.fromJson(b.data)},function(a){e("error",h.instant("ERROR_OCC_WHILE_FETCH_REC"))})};a.getLocationByOrganization=function(){null!==a.object.organization?(a.orgLocationDisabled=!1,a.requestData={},a.data=angular.fromJson(a.object.organization),a.requestData.orgId=a.data,c.getData(d.getParameterizedUrl("FIND_ORGLOCBYID",a.requestData),null,function(b){a.orgLocationList=angular.fromJson(b.data)},function(){})):j()};var k=function(){c.getData(d.getUrl("GET_ORG"),null,function(b){a.organizationList=angular.fromJson(b.data)},function(a){e("error",h.instant("ERROR_OCC_WHILE_FETCH_REC"))})};a.roleStatsChanged=function(){a.roleStatistics={},f.isFieldEmpty(a.stateParamRole)||(a.object.role=a.stateParamRole[0])},a.getRoleList=function(b){return a.requestData={},a.requestData.roleName=b,c.getData(d.getParameterizedUrl("FIND_ALL_ROLEBYNAME",a.requestData),null,function(b){return a.role=angular.fromJson(b.data)},function(a){e("error",h.instant("ERROR_OCC_WHILE_FETCH_REC"))})};var l=function(){"ROLE_STATISTICS"==a.options.value&&(f.isFieldEmpty(a.roleList)?a.roleStatistics.roleIds=[]:(a.roleStatistics.roleIds=[],a.roleStatistics.roleIds=a.roleList.slice())),"MONTHLY_ROLE_STATISTICS"==a.options.value&&(f.isFieldEmpty(a.object)||f.isFieldEmpty(a.object.role)||(a.roleStatistics.roleIds=[],void 0==a.object.role.id?null:a.roleStatistics.roleIds.push(a.object.role.id))),f.isFieldEmpty(a.object.organization)||(a.roleStatistics.organizationId=Number(a.object.organization)),f.isFieldEmpty(a.object.orgLocation)||(a.roleStatistics.organizationLocationId=Number(a.object.orgLocation)),f.isFieldEmpty(a.object.validFrom)||(a.roleStatistics.fromDate=b.convertToServerDate(a.object.validFrom)),f.isFieldEmpty(a.object.validTill)||(a.roleStatistics.validTillDate=b.convertToServerDate(a.object.validTill)),"ROLE_STATISTICS"==a.options.value?a.url="USER_COUNT_BY_ROLE":"MONTHLY_ROLE_STATISTICS"==a.options.value&&(a.url="USER_ENTRY_EXIT_BY_ROLE")},m=function(){g.showSpinner=!0;var b={};angular.copy(a.roleStatistics,b),c.postData(d.getUrl(a.url),b,function(b){g.showSpinner=!1;for(var c=h.instant("ASSIGNED_TO"),d=h.instant("EXITING_FROM"),e=0;e<b.data.length;e++)"ASSIGNED_TO"==b.data[e].attribute?b.data[e].attribute=c:"EXITING_FROM"==b.data[e].attribute&&(b.data[e].attribute=d);a.chartData=b.data,a.groupBarChartCreateFunction()},function(a){g.showSpinner=!1})};a.submitFilter=function(){l(),m()},a.clearForm=function(b){a.object={},a.roleStatistics={},b.$setPristine(),b.$setUntouched()},a.init=function(){if(k(),!f.isFieldEmpty(i.data)){var c={};c.id=i.data.id,c.roleName=i.data.roleName,a.stateParamRole=[],a.stateParamRole.push(c),a.object.validFrom=b.convertToViewDate(i.data.validFrom),a.object.validTill=b.convertToViewDate(i.data.validTill)}},a.init()}]),angular.module("paripal.manageRole").controller("UserRoleHistoryListCtrl",["$scope","$filter","$stateParams","$state","urlService","dateconvertor","datatableconfig","httpService","serverSidePagination","notify",function(a,b,c,d,e,f,g,h,i,j){
//Initialize varaibles
a.organizationList=[],a.locations=[],a.status={},a.status.open=!1,a.roleHistoryList=[],a.filter={},a.isDataFill=!0,/*Pagination default*/
a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.fetchUserRoleHistoryList=function(){a.userRoleHistoryListSpinner=!0,a.filter.pageNumber=a.currentPage,a.filter.recordsPerPage=a.itemPerPage,h.postData(e.getUrl("GET_ROLEUSERHISTORY"),a.filter,function(b){a.userRoleHistoryListSpinner=!1,a.data=angular.fromJson(b.data),a.roleHistoryList=a.data.data,a.totalItems=a.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.userRoleHistoryListSpinner=!1})},/*
         * Initial function
         */
a.init=function(){/*
             * Fetch list of organization
             */
h.getData(e.getUrl("GET_ORG"),null,function(b){a.organizationList=angular.fromJson(b.data)},function(a){j("error","Error occured while fetching rec")}),
//If user come directly
null===c.type&&a.fetchUserRoleHistoryList()},a.init(),/*
         *
         */
"edit"===c.type&&(a.status.open=!0,a.filter.roleName=c.data.roleName,a.filter.pageNumber=a.currentPage,a.filter.recordsPerPage=a.itemPerPage,h.postData(e.getUrl("GET_ROLEUSERHISTORY"),a.filter,function(b){a.data=angular.fromJson(b.data),a.roleHistoryList=a.data.data,a.totalItems=a.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(a){})),a.addLinkUserRole=function(){d.go("linkuserrole",{type:"new",data:null})},a.editLinkUserRole=function(a){d.go("linkuserrole",{type:"edit",data:a})},a.viewLinkUserRole=function(a){d.go("linkuserrole",{type:"view",data:a})},/*
         * Fetch the role names on type
         * @Praam viewValue
         */
a.getRolesNamesForRoleHistory=function(b){return a.requestData={},a.requestData.roleName=b,a.roleNameAutoCmpLoading=!0,h.getData(e.getParameterizedUrl("FIND_ALL_ROLEBYNAME",a.requestData),null,function(b){return a.roleNameAutoCmpLoading=!1,a.role=angular.fromJson(b.data)},function(b){a.roleNameAutoCmpLoading=!1})},/*
         * Fetch user name on type
         *  * @Praam viewValue
         */
a.getUserNamesForRoleHistory=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,h.getData(e.getParameterizedUrl("FIND_USERBYNAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},
//Get Locations on select of organization
a.getLocations=function(b){a.requestData={},a.requestData.orgId=b,h.getData(e.getParameterizedUrl("FIND_ORGLOCBYID",a.requestData),null,function(b){a.locations=angular.fromJson(b.data)},function(a){})},a.fetchRoleHistory=function(b){a.requestData={},b.$valid&&(a.requestData.pageNumber=a.currentPage,a.requestData.recordsPerPage=a.itemPerPage,a.requestData.roleName=a.filter.roleName,a.requestData.userName=a.filter.userName,a.requestData.organizationLocationId=a.filter.organizationLocationId,a.requestData.organizationId=a.filter.organizationId,void 0!=a.filter.userRoleValidFrom&&(a.requestData.userRoleValidFrom=f.convertToServerDate(a.filter.userRoleValidFrom)),void 0!=a.filter.userRoleValidTill&&(a.requestData.userRoleValidTill=f.convertToServerDate(a.filter.userRoleValidTill)),a.userRoleHistoryListSpinner=!0,h.postData(e.getUrl("GET_ROLEUSERHISTORY"),a.requestData,function(b){a.userRoleHistoryListSpinner=!1,a.data=angular.fromJson(b.data),a.roleHistoryList=a.data.data,a.totalItems=a.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.userRoleHistoryListSpinner=!1}))},a.clear=function(){a.filter={roleName:""},a.fetchRoleHistory({$valid:!0})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.fetchUserRoleHistoryList()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.fetchRoleHistory({$valid:!0})};
//datatble config json
var k={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:4,setDeafultColSortingOrder:"desc"};a.options=g.setOptionProperties(k),a.dtColumnDefs=g.setColumnProperties({notVisibleCol:[5]})}]),angular.module("paripal.manageRole").filter("timestampToDate",function(){return function(a){if(null!=a){var a=new Date(a),b=moment().locale();return moment(a).locale(b).format("L")}return""}}).filter("serverDate",["$filter",function(a){return function(b,c){var b=new Date(b);return void 0===c?c="yyyy-MM-dd":c,a("date")(b,c)}}]),angular.module("rest.api",[]).factory("apirequest",["$http",function(a){return function(b,c,d){return a({url:b,method:void 0===c?"GET":c,data:d})}}]),angular.module("paripal.manageRole").factory("service",function(){var a=null,b=function(b){a=b},c=function(){return a};return{setRoleData:b,gerRoleData:c}}),angular.module("paripal.manageUserAddress").controller("ManageUserAddressCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","applicationExceptionService","manageUserAddressService","EmergencyTransactionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.WSUserAddress={},a.WSAddressEntity={},a.addressData={},a.version=null,a.category=new Array,a.WSAddressEntity.landmark=null,a.WSAddressEntity.addressMapUrl=null,a.WSAddressEntity.whetherCurrentAddress=!1,a.disabledFormFields=!1,a.requiredMapUrl=!1,a.labelList="",a.manageUserAddressSpinner=!1,a.changeCurentAddress=function(){a.WSAddressEntity.whetherCurrentAddress?a.requiredMapUrl=!0:a.requiredMapUrl=!1},
// Add User Address
a.saveUserAddress=function(b){b.$valid&&(a.manageUserAddressSpinner=!0,a.WSUserAddress=a.addressData,"add"===c.type&&(a.version=null),c.isFirstLoggedIn?n.savePublicUserAddress(c.userAddressId,c.userId,c.type,a.version,a.WSUserAddress,a.WSAddressEntity,a.category,function(b){a.manageUserAddressSpinner=!1,f("success",g.instant(b.successMessage)),"billSummary"!=c.navigateFrom?d.go("userAddressList",c):l.goBackToPrevState()},function(b){a.manageUserAddressSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("Alert",g.instant(b.data.messages[0]))}):n.saveUserAddress(c.userAddressId,c.userId,c.type,a.version,a.WSUserAddress,a.WSAddressEntity,a.category,function(b){a.manageUserAddressSpinner=!1,f("success",g.instant(b.successMessage)),"billSummary"!=c.navigateFrom?d.go("userAddressList",c):l.goBackToPrevState()},function(b){a.manageUserAddressSpinner=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("Alert",g.instant(b.data.messages[0]))}))},
// Get selected user address data
a.getUserAddressDetails=function(b,c){l.isNullOrEmpty(b)||(a.manageUserAddressSpinner=!0,n.getUserAddressDetails(b,function(b){a.manageUserAddressSpinner=!1,a.setDataToAddressForm(b)}))},
// set selected organization location address data
a.setDataToAddressForm=function(b){l.isEmpty(b)||(l.isNullOrEmpty(b.version)||(a.version=b.version),l.isEmpty(b.addressTypeId)||(a.addressData.addressTypeId={id:b.addressTypeId.id,value:b.addressTypeId.value}),l.isEmpty(b.addressLine1)||(a.addressData.addressLine1=b.addressLine1),l.isEmpty(b.addressLine2)||(a.addressData.addressLine2=b.addressLine2),l.isEmpty(b.addressLine3)||(a.addressData.addressLine3=b.addressLine3),l.isEmpty(b.postalCode)||(a.addressData.postalCode=b.postalCode),l.isEmpty(b.country)||(a.addressData.country={id:b.country.id,value:b.country.value}),l.isEmpty(b.state)||(a.addressData.state={id:b.state.id,value:b.state.value}),l.isEmpty(b.district)||(a.addressData.district={id:b.district.id,value:b.district.value}),l.isEmpty(b.city)||(a.addressData.city={id:b.city.id,value:b.city.value}),l.isEmpty(b.addressCategoryId1)||(a.category[0]={id:b.addressCategoryId1.id,value:b.addressCategoryId1.value}),l.isEmpty(b.addressCategoryId2)||(a.category[1]={id:b.addressCategoryId2.id,value:b.addressCategoryId2.value}),l.isEmpty(b.addressCategoryId3)||(a.category[2]={id:b.addressCategoryId3.id,value:b.addressCategoryId3.value}),l.isNullOrEmpty(b.landmark)||(a.WSAddressEntity.landmark=b.landmark),l.isNullOrEmpty(b.addressMapUrl)||(a.WSAddressEntity.addressMapUrl=b.addressMapUrl),l.isNullOrEmpty(b.whetherCurrentAddress)||(a.WSAddressEntity.whetherCurrentAddress=b.whetherCurrentAddress,a.WSAddressEntity.whetherCurrentAddress?a.requiredMapUrl=!0:a.requiredMapUrl=!1))},
// on cancel forward to search list
a.cancel=function(){l.goBackToPrevState()},a.fetchCategotyLabels=function(){var b=new Array;b.push("USER_ADDRESS_CATEGORY_1"),b.push("USER_ADDRESS_CATEGORY_2"),b.push("USER_ADDRESS_CATEGORY_3"),n.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.useraddressSpinner=!0,
//Init Method
a.init=function(){l.isNullOrEmpty(c.userId)?l.isNullOrEmpty(c.navigateFrom)?d.go("home.view"):"orglocuserlist"===c.navigateFrom?d.go("orglocuserlist"):"myProfile"===c.navigateFrom?d.go("myProfile"):"billSummary"===c.navigateFrom?l.goBackToPrevState():d.go("home.view"):(a.fetchCategotyLabels(),"add"===c.type?(a.pageState="add",a.useraddressSpinner=!1,"billSummary"===c.navigateFrom&&o.getAddressTypeByCode("BILLING",function(b){a.addressData.addressTypeId=b,a.disableAddressType=!0},function(a){})):"edit"===c.type?("billSummary"===c.navigateFrom&&(a.disableAddressType=!0),a.pageState="edit",a.getUserAddressDetails(c.userAddressId,c.type)):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0,a.getUserAddressDetails(c.userAddressId,c.type)))},a.init()}]),angular.module("paripal.manageUserAddress").controller("UserAddressListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","serverSidePagination","baseService","utilService","userAddressListService","manageUserAddressService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.searchCriteria.userCode=null,a.searchCriteria.userModel={},a.wsUserAddressList=[],a.useraddressSpinner=!1,a.user={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{},jsonParameter:{}},
//Search User Address
a.searchUserAddress=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.useraddressSpinner=!0,l.searchUserAddress(a.searchCriteria,function(b){a.useraddressSpinner=!1,a.wsUserAddressList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.useraddressSpinner=!1})},
// Inactive User Address
a.inactiveUserAddress=function(b,c,d){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(d).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){m.inactiveUserAddress(b,function(b){f("success",g.instant("USER_ADDRESS_INACTIVE_SUCCESS")),a.searchUserAddress()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_UPDATE_RECORD")):f("Alert",g.instant(a.data.messages[0]))})},function(){})},
// active User Address
a.activeUserAddress=function(b,c,d){m.activeUserAddress(b,function(b){f("success",g.instant("USER_ADDRESS_INACTIVE_SUCCESS")),a.searchUserAddress()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_UPDATE_RECORD")):f("Alert",g.instant(a.data.messages[0]))})},
//Fetch records
a.fetchRecords=function(){a.searchUserAddress()},
//clear search
a.clear=function(){a.searchCriteria={},a.$broadcast("clearUserModel")},
//Dispaly add/edit/view User Address form
a.manageUserAddress=function(a,b){var e={type:b,navigateFrom:c.navigateFrom,userAddressId:a,userId:c.userId,userCode:c.userCode,userName:c.userName};d.go("manageUserAddress",e)},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchUserAddress()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchUserAddress()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(n),a.dtColumnDefs=e.setColumnProperties({}),a.moveToPreviousStep=function(){"orglocuserlist"===c.navigateFrom?d.go("orglocuserlist"):"myProfile"===c.navigateFrom?d.go("myProfile"):"orglocclientlist"===c.navigateFrom?d.go("orglocclientlist"):"professionalwall"===c.navigateFrom?d.go("professionalwall"):d.go("home.view")},a.init=function(){k.isEmpty(c)||k.isNullOrEmpty(c.userId)||k.isNullOrEmpty(c.userCode)||k.isNullOrEmpty(c.userName)?k.isEmpty(c)?d.go("home.view"):"orglocuserlist"===c.navigateFrom?d.go("orglocuserlist"):"myProfile"===c.navigateFrom?d.go("myProfile"):"orglocclientlist"===c.navigateFrom?d.go("orglocclientlist"):d.go("home.view"):(a.searchCriteria.userCode=c.userCode,a.searchCriteria.userModel={id:c.userId,value:c.userName},"professionalwall"===c.navigateFrom&&(a.fromProfessionalWall=!0),a.searchUserAddress())},a.init()}]),angular.module("paripal.manageUserAddress").service("manageUserAddressService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveUserAddress=function(c,e,f,g,h,i,j,k,l){var m="";h.version=g,d.isNullOrEmpty(c)||(h.id=c),d.isNullOrEmpty(e)||(h.userByUserId={},h.userByUserId.id=e);for(var n=0;n<j.length;n++)0==n&&j[n].dataValue&&(h.addressCategoryId1=j[n].dataValue),1==n&&j[n].dataValue&&(h.addressCategoryId2=j[n].dataValue),2==n&&j[n].dataValue&&(h.addressCategoryId3=j[n].dataValue);d.isNullOrEmpty(i.whetherCurrentAddress)?h.whetherCurrentAddress=!1:h.whetherCurrentAddress=i.whetherCurrentAddress,d.isNullOrEmpty(i.landmark)||(h.landmark=i.landmark),d.isNullOrEmpty(i.addressMapUrl)||(h.addressMapUrl=i.addressMapUrl),/*WSUserAddress.district = {
                id: 1
            };*/
m="add"===f?"ADD_USER_ADDRESS":"UPDATE_USER_ADDRESS",a.postData(b.getUrl(m),h,function(a){k(a&&a.data?a.data:a)},function(a){l(a)})},this.savePublicUserAddress=function(c,e,f,g,h,i,j,k,l){var m="";h.version=g,d.isNullOrEmpty(c)||(h.id=c),d.isNullOrEmpty(e)||(h.userByUserId={},h.userByUserId.id=e);for(var n=0;n<j.length;n++)0==n&&j[n].dataValue&&(h.addressCategoryId1=j[n].dataValue),1==n&&j[n].dataValue&&(h.addressCategoryId2=j[n].dataValue),2==n&&j[n].dataValue&&(h.addressCategoryId3=j[n].dataValue);d.isNullOrEmpty(i.whetherCurrentAddress)?h.whetherCurrentAddress=!1:h.whetherCurrentAddress=i.whetherCurrentAddress,d.isNullOrEmpty(i.landmark)||(h.landmark=i.landmark),d.isNullOrEmpty(i.addressMapUrl)||(h.addressMapUrl=i.addressMapUrl),/*WSUserAddress.district = {
                id: 1
            };*/
m="add"===f?"SAVE_BILLING_ADDRESS_PUBLIC":"UPDATE_BILLING_ADDRESS_PUBLIC",a.postData(b.getUrl(m),h,function(a){k(a&&a.data?a.data:a)},function(a){l(a)})},this.inactiveUserAddress=function(c,d,e){var f={};f.userAddressId=c,a.putData(b.getParameterizedUrl("INACTIVE_USER_ADDRESS",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.activeUserAddress=function(c,d,e){var f={};f.userAddressId=c,a.putData(b.getParameterizedUrl("ACTIVATE_USER_ADDRESS",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getUserAddressDetails=function(c,d){var e={};e.userAddressId=c,a.getData(b.getParameterizedUrl("GET_USER_ADDRESS_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.fetchCategotyLabels=function(c,d,e){a.postData(b.getUrl("FETCH_CATEGORIES"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.manageUserAddress").service("userAddressListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchUserAddress=function(c,d,f){var g=JSON.parse(JSON.stringify(c));!e.isNullOrEmpty(g.userModel)&&g.userModel.id&&(g.userId=g.userModel.id,delete g.userModel),delete g.userCode,a.postData(b.getUrl("SEARCH_USER_ADDRESS_LIST"),g,function(a){d(a.data)},function(a){f(a)})}}]),angular.module("paripal.manageUserDocuments").controller("ManageUserDocumentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","userStatusService","httpService","urlService","utilService","commonConstants","baseService","$mdDialog","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.selectedTab=0,a.myDocumentsTabs=m.myDocumentsTab;n.getLoggedInUser();/*if (loggedInUser && loggedInUser.isOrganizationUserMode != true || (!loggedInUser && !loggedInUser.userAccountStatusDTO.whetherSubscriber)) {
    $timeout(function () {
        $mdDialog.show(
            $mdDialog.alert()
            .title($translate.instant('INFORMATION'))
            .textContent($translate.instant('SHARED_RECORD_SUB'))
            .ok($translate.instant('OK'))
        );
    }, 2000);
}*/
if(a.showShareableOnly=!1,a.showOthersOnly=!1,l.isFieldEmpty(b.loggedInUserDetails)||b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode){var q=localStorage.getItem("selectedTab");a.selectedTabInDocuments=q?q:1}else{var q=localStorage.getItem("selectedTab");a.selectedTabInDocuments=q?q:0}var r=function(){"homeNavigation"==c.type&&(a.selectedTabInDocuments=1)};a.onTabClick=function(b){a.selectedTab=b},a.showFileInPopUp=function(b,c){b.isHidingPrintButton?a.isHidingPrintButton=!0:a.isHidingPrintButton=!1,delete b.isHidingPrintButton,c&&(a.userId=c),a.fileResource=b,a.viewFileContent=!0},
//added for VPR Documents routing
c?("patientrecord"==c.parentState&&"orgUser"==c.type?a.selectedTabInDocuments=1:"patientrecord"==c.parentState&&"indUser"==c.type&&(a.selectedTabInDocuments=1),c.fromMobileFooter&&(a.selectedTabInDocuments=1),null!=c.fromIndDashboard&&"showShareableOnly"==c.fromIndDashboard?a.showShareableOnly=!0:null!=c.fromIndDashboard&&"showOthersOnly"==c.fromIndDashboard&&(a.showOthersOnly=!0)):r()}]),angular.module("paripal.manageUserDocuments").controller("OtherDocumentCtrl",["$scope","$rootScope","$stateParams","$state","$translate","notify","dateconvertor","utilService","urlService","fileOperations","commonConstants","otherDocumentService","fileExtensionConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.otherDocDetail={},a.otherDocDetail.organizationLocation={},a.otherDocDetail.targetUser={},a.otherDocDetail.whetherActive=!0,a.manageOtherDocumentSpinner=!1,a.documentTypeList=new Array,a.displayId,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},1==localStorage.whetherParipalAsSubdomain||"true"==localStorage.whetherParipalAsSubdomain?a.hideEmergency=!0:a.hideEmergency=!1,a.loadListOfDocumentType=function(){l.loadListOfDocumentType(function(b){h.isEmpty(b)||(a.documentTypeList=b)},function(a){})},a.checkFileExtensionWRTResourceType=function(a){var b=!1;if(!h.isEmpty(m)&&!h.isNullOrEmpty(a.documentResourceType.type)&&!h.isNullOrEmpty(a.fileName)){var c=a.fileName,d=a.documentResourceType.type,g=c.substring(c.indexOf(".")+1,c.length);if(!h.isEmpty(m[d.toUpperCase()])&&m[d.toUpperCase()].length>0){var i=m[d.toUpperCase()];if(h.checkStringInArray(i,g))return b=!0;var j=!1,k="",l="";for(l in m)if(m.hasOwnProperty(l)){var n=m[l];h.checkStringInArray(n,g)&&(j=!0,k=l)}return j?(f("Error",e.instant("INVALID_RESOURCE_TYPE")+k+e.instant("RES_TYPE")),b):(f("Error",e.instant("INVALID_FILE_SELECTION")),b)}return f("Error",e.instant("RESOURCE_TYPE_NOT_PRESENT")),b}return b},a.saveOtherDocumentDetails=function(c){if(c.$valid&&!h.isEmpty(a.otherDocDetail)){var d="",e="";a.editMode?(e=!0,d=i.getUrl("UPDATE_DOCUMENT_DETAILS")):(e=!1,d=i.getUrl("SAVE_DOCUMENT_DETAILS"));var g=new Object;g.documentType={type:k.documentTypes.other,subType:k.documentTypes.other},h.isEmpty(a.otherDocDetail)||h.isNullOrEmpty(a.otherDocDetail.organizationLocation)||h.isNullOrEmpty(a.otherDocDetail.organizationLocation.data)||(g.organizationLocationId=a.otherDocDetail.organizationLocation.data.id),h.isEmpty(a.otherDocDetail)||h.isNullOrEmpty(a.otherDocDetail.targetUser)||(g.documentForId=a.otherDocDetail.targetUser.id),h.isEmpty(a.otherDocDetail)||h.isNullOrEmpty(a.otherDocDetail.identifier)||(g.identifier=a.otherDocDetail.identifier),h.isNullOrEmpty(a.otherDocDetail.canBeShared)||(g.canBeShared=a.otherDocDetail.canBeShared),h.isNullOrEmpty(a.otherDocDetail.id)||(g.id=a.otherDocDetail.id),h.isEmpty(a.otherDocDetail.documentResourceType)||(g.documentResourceType=a.otherDocDetail.documentResourceType),h.isNullOrEmpty(a.otherDocDetail.fileIdentifier)||(g.fileIdentifier=a.otherDocDetail.fileIdentifier),h.isEmpty(a.otherDocFileDetail)||(g.fileName=a.otherDocFileDetail.fileToBeUpload.name,g.fileSize=a.otherDocFileDetail.fileToBeUpload.size),h.isNullOrEmpty(a.otherDocDetail.whetherActive)||(g.whetherDeleted=!a.otherDocDetail.whetherActive);var j=a.checkFileExtensionWRTResourceType(a.otherDocDetail);j&&(b.showSpinner=!0,l.saveDocumentDetails(g,d,e,function(c){b.showSpinner=!1,h.isEmpty(a.otherDocFileDetail)?(h.isNullOrEmpty(c.successMessage)||f("success",c.successMessage),a.goToListingScreen()):a.uploadFile(a.otherDocFileDetail,a.otherDocDetail,c)},function(a){b.showSpinner=!1}))}},a.uploadFile=function(b,c,d){var g=new Object;g.file=b.fileToBeUpload,g.docType=k.documentTypes.other,g.docSubType=k.documentSubTypes.other,h.isNullOrEmpty(d.response)||(g.resourceId=d.response),h.isEmpty(a.otherDocDetail.documentResourceType)||"Video"!=a.otherDocDetail.documentResourceType.type||(g.isThumbnailRequired=!0),a.manageOtherDocumentSpinner=!0,j.uploadFile(g,function(b){h.isNullOrEmpty(d.successMessage)||f("success",d.successMessage),a.goToListingScreen()},function(b){f("Error",e.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()})},a.goToListingScreen=function(){a.otherDocDetail={},b.selectedTabInDocuments=2,1==localStorage.whetherParipalAsSubdomain||"true"==localStorage.whetherParipalAsSubdomain?d.go("otherDocumentList"):d.go("myDocuments"),b.showSpinner=!1},a.cancel=function(){b.selectedTabInDocuments=2,1==localStorage.whetherParipalAsSubdomain||"true"==localStorage.whetherParipalAsSubdomain?d.go("otherDocumentList"):h.goBackToPrevState()},a.downloadFile=function(b){if(!h.isEmpty(a.otherDocDetail)){var c=new Object;c.fileName=a.otherDocDetail.fileName,c.resourceId=a.otherDocDetail.id,c.docType=k.documentTypes.other,c.docSubType=k.documentSubTypes.other,a.otherDocUserId=b,j.downloadFile(c,function(a){},function(a){})}},a.viewPrintFile=function(b){if(!h.isEmpty(a.otherDocDetail)){var c=new Object;c.fileName=a.otherDocDetail.fileName,c.resourceId=a.otherDocDetail.id,c.docType=k.documentTypes.other,c.docSubType=k.documentSubTypes.other,a.otherDocUserId=b,a.fileResource=c,a.viewFileContent=!0,a.isHidingPrintButton=!1}},a.loadDocumentDetailsById=function(b){l.loadDocumentDetailsById(b,function(b){h.isEmpty(b)||(a.otherDocDetail=b,h.isEmpty(a.otherDocDetail)||h.isEmpty(a.otherDocDetail.documentResourceType)||(a.displayId=a.otherDocDetail.documentResourceType.id),h.isEmpty(a.otherDocDetail)||h.isNullOrEmpty(a.otherDocDetail.whetherDeleted)||(a.otherDocDetail.whetherActive=!a.otherDocDetail.whetherDeleted),h.isNullOrEmpty(b.documentFor)||(a.otherDocDetail.targetUser=b.documentFor),h.isNullOrEmpty(b.organizationLocation)||(a.otherDocDetail.organizationLocation.data=b.organizationLocation))},function(a){})},a.init=function(){a.loadListOfDocumentType(),"edit"===c.type&&(a.editMode=!0),"view"===c.type&&(a.viewMode=!0),"add"!==c.type&&"edit"!==c.type&&"view"!==c.type||h.isEmpty(b.loggedInUserDetails)||(h.isNullOrEmpty(b.loggedInUserDetails.userCode)||(a.otherDocDetail.userCode=b.loggedInUserDetails.userCode),h.isNullOrEmpty(b.loggedInUserDetails.firstName)||h.isNullOrEmpty(b.loggedInUserDetails.lastName)||(a.otherDocDetail.userName=b.loggedInUserDetails.firstName+"  "+b.loggedInUserDetails.lastName),h.isNullOrEmpty(b.loggedInUserDetails.dateOfBirth)||(a.otherDocDetail.dateOfBirth=g.convertToViewDate(b.loggedInUserDetails.dateOfBirth))),"edit"!==c.type&&"view"!==c.type||h.isNullOrEmpty(c.id)||a.loadDocumentDetailsById(c.id),h.isNullOrEmpty(b.loggedInUserDetails)||b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode&&(a.otherDocDetail.organizationLocation.data=angular.fromJson(localStorage.getItem("defaultOrgLoc")))},a.init()}]),angular.module("paripal.manageUserDocuments").controller("OtherDocumentListCtrl",["$scope","$stateParams","$rootScope","datatableconfig","otherDocumentService","utilService","serverSidePagination","notify","$translate","$state","fileOperations","$mdDialog","urlService","fileExtensionConstants","commonConstants","$timeout","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.document={},a.document.whetherUploadedDocument=!0,a.document.whetherForm=!1,a.otherDocumentListSpinner=!1,a.otherDocumentList=[],a.otherDocumentDetail={},a.pagination={},a.pagination.currentPage=1,1==a.listView?a.pagination.itemPerPage=10:a.pagination.itemPerPage=12,
//routing from DPR
b&&"patientrecord"==b.parentState&&b.data&&(a.disabledFormFields=!0,b.data.orgLocationCode&&(a.document.organizationLocation={data:b.data.orgLocationCode}),b.data.getName&&(a.document.targetUser=b.data.getName)),
//Added this for menu issue for whetherParipalAsSubdomain
"true"==localStorage.whetherParipalAsSubdomain&&("true"==localStorage.whetherReload||p(function(){localStorage.setItem("whetherReload",!0),console.log("reloaded successfuly"),q.location.reload()},200)),/*$scope.pagination = {
            currentPage: 1,
            itemPerPage: 10
        };*/
a.startRecord=(a.pagination.currentPage-1)*a.pagination.itemPerPage+1,a.endRecord=a.pagination.itemPerPage,a.pagingInfo={},1==localStorage.whetherParipalAsSubdomain||"true"==localStorage.whetherParipalAsSubdomain?(a.open=!1,a.hideForms=!0):(a.open=!0,a.hideForms=!1),a.shareObject={},a.deleteDialogBox={},/* CARD VIEW CHANGES START */
a.listView=!1,a.cardView=!0,a.btnText=i.instant("LIST_VIEW"),a.toggleView=function(){1==a.listView?(a.cardView=!0,a.listView=!1,a.btnText=i.instant("LIST_VIEW"),a.pagination.itemPerPage=12,a.getOtherDocuments()):(a.cardView=!1,a.listView=!0,a.btnText=i.instant("CARD_VIEW"),a.pagination.itemPerPage=10,a.getOtherDocuments())},/* CARD VIEW CHANGES END */
a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.$watch(function(){return a.selectedTab},function(b){(a.myDocumentsTabs&&b==a.myDocumentsTabs.otherDocumentTab||"true"==localStorage.whetherParipalAsSubdomain)&&a.getOtherDocuments()}),a.documentTypeList=new Array,a.loadListOfDocumentType=function(){e.loadListOfDocumentType(function(b){f.isEmpty(b)||(a.documentTypeList=b)},function(a){})},a.getOtherDocuments=function(){var b=new Object;b.pageNumber=a.pagination.currentPage,b.recordsPerPage=a.pagination.itemPerPage,b.documentType=o.documentTypes.other,f.isEmpty(a.document)||f.isNullOrEmpty(a.document.organizationLocation)||f.isNullOrEmpty(a.document.organizationLocation.data)||(b.organizationLocationId=a.document.organizationLocation.data.id),f.isEmpty(a.document)||f.isNullOrEmpty(a.document.targetUser)||(b.documentForId=a.document.targetUser.id),f.isEmpty(a.document)||f.isNullOrEmpty(a.document.identifier)||(b.identifier=a.document.identifier),f.isEmpty(a.document)||f.isNullOrEmpty(a.document.whetherAllIdentifier)||(b.whetherAllIdentifier=a.document.whetherAllIdentifier),f.isEmpty(a.document)||f.isNullOrEmpty(a.document.documentResourceTypeId)||(b.documentResourceTypeId=a.document.documentResourceTypeId),f.isEmpty(a.document)||f.isNullOrEmpty(a.document.fileIdentifier)||(b.fileIdentifier=a.document.fileIdentifier),!f.isEmpty(a.document)&&!f.isNullOrEmpty(a.document.whetherForm),!f.isEmpty(a.document)&&!f.isNullOrEmpty(a.document.whetherUploadedDocument),f.isNullOrEmpty(a.document.sorters)||(b.sorters=a.document.sorters),c.showSpinner=!0,e.getOtherDocuments(b,a.document.whetherForm,function(b){p(function(){b&&(c.showSpinner=!1,a.otherDocumentList=b.data,a.pagination.totalItems=b.totalRecords,a.pagingInfo=g(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems))},20)},function(a){c.showSpinner=!1})},a.shareDocument=function(b){if(!f.isEmpty(b)){var c=new Object;c.mode="add",c.shareType="DOCUMENT",c.entityId=b.id,c.sharedEntityName=b.fileIdentifier,a.shareObject.init(c)}},a.deleteOtherDocument=function(b){f.isEmpty(b)||(a.deleteDialogBox.header=i.instant("DELETE_DOCUMENT"),a.deleteDialogBox.onOkBtnClick=function(){var c=new Object;c.fileName=b.fileName,c.resourceId=b.id,c.docType=o.documentTypes.other,c.docSubType=o.documentSubTypes.other,e.deleteOtherDocFileDetails(c,function(c){e.deleteOtherDocDetails(b.id,function(b){f.isNullOrEmpty(b.successMessage)||h("success",b.successMessage),a.getOtherDocuments()},function(a){})},function(a){},!0,a.deleteDialogBox)},a.deleteDialogBox.init())},a.downloadFile=function(b){if(!f.isEmpty(b)){var c=new Object;c.fileName=b.fileName,/*if ($scope.document.whetherUploadedDocument) {
                    fileObject.resourceId = otherDocument.id;
                    fileObject.docType = commonConstants.documentTypes.other;
                    fileObject.docSubType = commonConstants.documentSubTypes.other;
                } else if ($scope.document.whetherForm) {
                    fileObject.resourceId = otherDocument.id;
                    fileObject.recordId = otherDocument.orbeonId;
                    fileObject.orgLocId = otherDocument.organizationLocationId;
                    fileObject.docType = commonConstants.documentTypes.orbeon;
                    fileObject.docSubType = commonConstants.documentSubTypes.OrbeonSubType;
                }*/
a.document.whetherForm?(c.resourceId=b.id,c.recordId=b.orbeonId,c.orgLocId=b.organizationLocationId,c.docType=o.documentTypes.orbeon,c.docSubType=o.documentSubTypes.OrbeonSubType):(c.resourceId=b.id,c.docType=o.documentTypes.other,c.docSubType=o.documentSubTypes.other),k.downloadFile(c,function(a){},function(a){})}},a.viewPrintFile=function(b,c){if(!f.isEmpty(c)){var d=new Object;d.fileName=c.fileName,a.document.whetherForm?(d.resourceId=c.id,d.recordId=c.orbeonId,d.orgLocId=c.organizationLocationId,d.docType=o.documentTypes.orbeon,d.docSubType=o.documentSubTypes.OrbeonSubType,d.isHidingPrintButton=!1):(d.resourceId=c.id,d.docType=o.documentTypes.other,d.docSubType=o.documentSubTypes.other),c.documentResourceType&&"Document"==c.documentResourceType.type?d.isHidingPrintButton=!1:d.isHidingPrintButton=!0,a.showFileInPopUp(d,c.createdById)}},a.createOtherDocument=function(){localStorage.setItem("selectedTab",3),j.go("otherDocument",{type:"add",data:null})},a.showOtherDocumentDetails=function(a,b){j.go("otherDocument",{type:b,data:a,id:a.id})},a.showFileInPopUp=function(b,c){b.isHidingPrintButton?a.isHidingPrintButton=!0:a.isHidingPrintButton=!1,delete b.isHidingPrintButton,c&&(a.userId=c),a.fileResource=b,a.viewFileContent=!0},a.pageChanged=function(){a.pagingInfo=g(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems),a.getOtherDocuments()},a.setMaxRecords=function(b){a.pagination.currentPage=1,a.pagination.itemPerPage=b,a.getOtherDocuments()};var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=d.setOptionProperties(r),a.dtColumnDefs=d.setColumnProperties({}),a.clear=function(){a.document={},a.getOtherDocuments(),a.document.whetherUploadedDocument=!0},a.onFormChkBox=function(b){b&&(a.document.whetherUploadedDocument=!1,a.getOtherDocuments())},a.onUploadDocumentChkBox=function(b){b&&(a.document.whetherForm=!1,a.getOtherDocuments())},a.init=function(){a.loadListOfDocumentType()},a.init()}]),angular.module("paripal.manageUserDocuments").controller("ShareWithMeListCtrl",["$scope","$rootScope","datatableconfig","utilService","serverSidePagination","notify","$translate","$state","fileOperations","shareDocumentService","dateconvertor","urlService","$timeout","baseService","$stateParams","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.shareObject={},a.documentSharedWithMe={},a.sharedDocumentListSpinner=!1,a.sharedDocumentList=[],a.documentSharedWithMe.onBehalfOf={};var q=n.getLoggedInUser();d.isEmpty(q)||(a.userObject={userId:q.id}),
//routing from DPR
o&&"patientrecord"==o.parentState&&o.data&&(a.disableOnBehalfOf=!0,o.data.getName&&(a.documentSharedWithMe.onBehalfOf=o.data.getName,a.documentSharedWithMe.onBehalfOf.data=o.data.getName)),a.pagination={},a.pagination.currentPage=1,1==a.listView?a.pagination.itemPerPage=10:a.pagination.itemPerPage=12,a.startRecord=(a.pagination.currentPage-1)*a.pagination.itemPerPage+1,a.endRecord=a.pagination.itemPerPage,a.pagingInfo={},a.userData={},a.open=!0,/*$scope.$watch(function () {
            return $scope.selectedTab;
        }, function (value) {
            if (value == $scope.myDocumentsTabs.shareWithMeTab) {
                $scope.getSharedDocumentsWithMe();
            }
        });*/
/* CARD VIEW CHANGES START */
a.listView=!1,a.cardView=!0,a.btnText=g.instant("LIST_VIEW"),a.toggleView=function(){1==a.listView?(a.cardView=!0,a.listView=!1,a.btnText=g.instant("LIST_VIEW"),a.pagination.itemPerPage=12,a.getSharedDocumentsWithMe()):(a.cardView=!1,a.listView=!0,a.btnText=g.instant("CARD_VIEW"),a.pagination.itemPerPage=10,a.getSharedDocumentsWithMe())},/* CARD VIEW CHANGES END */
a.recordTypeList=new Array,a.loadListOfRecordTypes=function(){var c;d.isEmpty(b.loggedInUserDetails)||d.isNullOrEmpty(b.loggedInUserDetails.isOrganizationUserMode)||(c=b.loggedInUserDetails.isOrganizationUserMode),j.loadListOfRecordTypes(c,!1,function(b){d.isEmpty(b)||(a.recordTypeList=b,a.recordTypeList.length>0&&(a.documentSharedWithMe.recordType=a.recordTypeList[0],a.getSharedDocumentsWithMe()))},function(a){})},a.sharedByList=new Array,a.loadListOfSharedByUsers=function(){j.loadListOfSharedByUsers(function(b){d.isEmpty(b)||(a.sharedByList=b)},function(a){})},a.getSharedDocumentsWithMe=function(){var c=new Object;c.pageNumber=a.pagination.currentPage,c.recordsPerPage=a.pagination.itemPerPage,c.whetherSharedTab=!1,d.isEmpty(a.documentSharedWithMe)||(d.isNullOrEmpty(a.documentSharedWithMe.recordType)||(c.sharedEntity=a.documentSharedWithMe.recordType),d.isNullOrEmpty(a.documentSharedWithMe.name)||(c.sharedEntityName=a.documentSharedWithMe.name),d.isEmpty(a.userData.data)||d.isNullOrEmpty(a.userData.data.id)||(c.sharedBy=a.userData.data.id),d.isNullOrEmpty(a.documentSharedWithMe.validFrom)||(c.sharedOnStartDate=k.convertToServerDate(a.documentSharedWithMe.validFrom)),d.isNullOrEmpty(a.documentSharedWithMe.validTill)||(c.sharedOnTillDate=k.convertToServerDate(a.documentSharedWithMe.validTill)),d.isNullOrEmpty(a.documentSharedWithMe.sorters)||(c.sorters=a.documentSharedWithMe.sorters),d.isEmpty(a.documentSharedWithMe.onBehalfOf)||d.isEmpty(a.documentSharedWithMe.onBehalfOf.data)||(c.onBehalfOf=a.documentSharedWithMe.onBehalfOf.data.id)),b.showSpinner=!0;var f=l.getUrl("GET_SHARE_DOCUMENTS");j.getSharedDocuments(c,f,function(c){m(function(){c&&(b.showSpinner=!1,a.sharedDocumentList=c.data,a.pagination.totalItems=c.totalRecords,a.pagingInfo=e(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems))},20)},function(a){b.showSpinner=!1})},a.recordTypeChanged=function(b){"USER_ISSUE"==b||"TREATMENT"==b||"DPR"==b?a.advanceSelected=!0:a.advanceSelected=!1},a.downloadFile=function(a){if(!d.isEmpty(a)){var b=new Object;b.fileName=a.fileName,b.resourceId=a.id,b.docType=a.docType,b.docSubType=a.documentType.subType,i.downloadFile(b,function(a){},function(a){})}},a.viewPrintFile=function(b,c){if(!d.isEmpty(c)){var e=new Object;e.fileName=c.fileName,e.resourceId=c.id,e.docType=c.docType,e.docSubType=c.documentType.subType,a.fileResource=e,a.viewFileContent=!0,a.isHidingPrintButton=!1}},a.shareDocument=function(b,c){if(localStorage.setItem("selectedTab",1),!d.isEmpty(b)){var e=new Object;e.id=b.id,e.entityId=b.entityInstanceId,e.shareType=b.sharedEntity,e.shareId=b.shareId,e.sharedWith=b.sharedWith,e.sharedEntityName=b.sharedEntityName,e.shareValidTill=b.shareValidTill,e.version=b.version,e.whetherActive=b.whetherActive,e.mode=c,e.callBackFun=function(){a.getSharedDocumentsWithMe()},a.shareObject.init(e)}},a.addShareDocument=function(b,c){if(!d.isEmpty(b)){var e=new Object;e.mode=c,e.shareType=b.sharedEntity,e.entityId=b.entityInstanceId,e.sharedEntityName=b.sharedEntityName,e.chainSharingId=b.id,e.chainGroupId=b.chainGroupId,e.whetherChaining=b.whetherChaining,e.shareValidTill=b.shareValidTill,e.shareWithMeChaining=!0,"USER_ISSUE"!=b.sharedEntity&&"TREATMENT"!=b.sharedEntity&&"DPR"!=b.sharedEntity||(e.accessKeyId=b.id),e.callBackFun=function(){a.getSharedDocumentsWithMe()},a.shareObject.init(e)}},a.viewVPR=function(a,b,c){var e,f,g,i;if(d.isEmpty(a.onBehalfOf)||(e=a.onBehalfOf.id,f=a.onBehalfOf.value),d.isEmpty(a.orgLoc)||(g=a.orgLoc.id,i=a.orgLoc.value),d.isNullOrEmpty(b)&&d.isNullOrEmpty(c)){var j={type:"DPR",id:e,displayName:f,locationId:g,locationValue:i,transactionType:a.sharedEntity};h.go("patientRecord",j)}else{var j={type:"DPR",id:e,displayName:f,locationId:g,locationValue:i,transactionType:a.sharedEntity,otp:b,accessKeyId:c};h.go("patientRecord",j)}},a.viewDocument=function(b){if(!d.isEmpty(b))switch(a.documentSharedWithMe.recordType){case"DOCUMENT":h.go("otherDocument",{type:"view",data:b,id:b.entityInstanceId});break;case"DIAGNOSTIC_TEST":h.go("addEditUserTests",{type:"view",userTestId:b.entityInstanceId,previousState:h.current.name});break;default:console.log("Wrong Input")}},a.pageChanged=function(){a.pagingInfo=e(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems),a.getSharedDocumentsWithMe()},a.setMaxRecords=function(b){a.pagination.currentPage=1,a.pagination.itemPerPage=b,a.getSharedDocumentsWithMe()};var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=c.setOptionProperties(r),a.dtColumnDefs=c.setColumnProperties({}),a.sendOTP=function(a){var b={};b.accessKeyId=a,p.getData(l.getQueryParameterizedUrl("SEND_OTP",b),null,function(a){f("warning",g.instant(a.data.successMessage))},function(a){f("error",g.instant(sucessResponse.data.successMessage))})},a.resendOTP=function(a){var b={};b.accessKeyId=a,p.getData(l.getQueryParameterizedUrl("RESEND_OTP",b),null,function(a){return angular.fromJson(a.data)},function(a){})},a.confirmShare=function(c){b.showSpinner=!0,d.isFieldEmpty(c)||(a.OTP=c);var e={};e.accessKeyId=a.accessId,d.isFieldEmpty(c)||(e.currentOTP=c),p.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",e),null,function(c){b.showSpinner=!1,a.goToDocumentView()},function(a){b.showSpinner=!1})},a.goToDocumentView=function(){var b={};b.accessKeyId=a.accessId,p.getData(l.getParameterizedUrl("FIND_DOCUMENT_BY_ID",b),null,function(b){var c=angular.fromJson(b.data);if("DOCUMENT"==c.sharedEntity){var e={};e.documentId=c.entityInstanceId,p.getData(l.getParameterizedUrl("GET_DOCUMENT_DETAILS_BY_ID",e),null,function(a){var b=angular.fromJson(a.data);h.go("otherDocument",{type:"view",data:b,id:c.entityInstanceId})},function(a){})}else if("DIAGNOSTIC_TEST"==c.sharedEntity){var f={};f.id=c.entityInstanceId,p.getData(l.getParameterizedUrl("USER_TEST_BY_ID",f),null,function(a){var b=angular.fromJson(a.data);h.go("addEditUserTests",{type:"view",userTestId:c.entityInstanceId,data:b,previousState:h.current.name})},function(a){})}else"EMERGENCY"==c.sharedEntity||("USER_ISSUE"==c.sharedEntity?d.isEmpty(c.sharedBy)||d.isEmpty(c.orgLoc)||a.viewVPR(c):"TREATMENT"==c.sharedEntity?d.isEmpty(c.sharedBy)||d.isEmpty(c.orgLoc)||a.viewVPR(c):"DPR"==c.sharedEntity&&(d.isEmpty(c.sharedBy)||d.isEmpty(c.orgLoc)||a.viewVPR(c,a.OTP,a.accessId)))},function(a){})},a.clear=function(){a.documentSharedWithMe={},a.userData={},b.$broadcast("clearUserData"),a.loadListOfRecordTypes()},a.init=function(){if(a.loadListOfRecordTypes(),d.isEmpty(o.accessKeyId))a.loadListOfSharedByUsers();else{a.accessId=o.accessKeyId;var b=o.accessKeyId;a.sendOTP(b)}},a.init()}]),angular.module("paripal.manageUserDocuments").controller("ShareableDocumentListCtrl",["$scope","$rootScope","datatableconfig","utilService","serverSidePagination","notify","$translate","$state","fileOperations","shareDocumentService","dateconvertor","urlService","$timeout","baseService","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.shareableDocument={},a.sharedDocumentListSpinner=!1,a.sharedDocumentList=[];var p=n.getLoggedInUser();a.shareObject={},a.userData={},a.shareableDocument.sharedBy={},a.shareableDocument.onBehalfOf={},a.pagination={},a.pagination.currentPage=1,1==a.listView?a.pagination.itemPerPage=10:a.pagination.itemPerPage=12,a.startRecord=(a.pagination.currentPage-1)*a.pagination.itemPerPage+1,a.endRecord=a.pagination.itemPerPage,a.pagingInfo={},a.disableOnBehalfOf=!1,a.disableSharedBy=!1,a.open=!0,d.isEmpty(p)||(a.userObject={userId:p.id}),
//routing from DPR
o&&"patientrecord"==o.parentState&&o.data&&(a.disableOnBehalfOf=!0,o.data.getName&&(a.shareableDocument.onBehalfOf=o.data.getName,a.shareableDocument.onBehalfOf.data=o.data.getName)),/* CARD VIEW CHANGES START */
a.listView=!1,a.cardView=!0,a.btnText=g.instant("LIST_VIEW"),a.toggleView=function(){1==a.listView?(a.cardView=!0,a.listView=!1,a.btnText=g.instant("LIST_VIEW"),a.pagination.itemPerPage=12,a.modeChange()):(a.cardView=!1,a.listView=!0,a.btnText=g.instant("CARD_VIEW"),a.pagination.itemPerPage=10,a.modeChange())},/* CARD VIEW CHANGES END */
a.$watch(function(){return a.selectedTab},function(b){b==a.myDocumentsTabs.shareableTab&&(
//After setting share mode it will call modeChange() function through ng-change event
void 0==a.shareableDocument.isSharedMode?(a.shareableDocument.isSharedMode=!0,a.loadListOfRecordTypes()):a.modeChange())}),a.$watch("shareableDocument.sharedBy",function(b){d.isEmpty(b)||d.isEmpty(b.data)||(p.id!=b.data.id?(a.disableOnBehalfOf=!0,a.shareableDocument.onBehalfOf={},a.shareableDocument.onBehalfOf.data={id:p.id}):a.disableOnBehalfOf=!1)},!0),a.$watch("shareableDocument.onBehalfOf",function(b){d.isEmpty(b)||d.isEmpty(b.data)||(p.id!=b.data.id?(a.disableSharedBy=!0,a.shareableDocument.sharedBy={},a.shareableDocument.sharedBy.data={id:p.id}):a.disableSharedBy=!1)},!0),a.recordTypeList=new Array,a.loadListOfRecordTypes=function(){var c;d.isEmpty(b.loggedInUserDetails)||d.isNullOrEmpty(b.loggedInUserDetails.isOrganizationUserMode)||(c=b.loggedInUserDetails.isOrganizationUserMode),j.loadListOfRecordTypes(c,!0,function(b){d.isEmpty(b)||(a.recordTypeList=b,a.recordTypeList.length>0&&(a.shareableDocument.recordType=a.recordTypeList[0],a.modeChange()))},function(a){})},a.getShareableDocuments=function(){var c=new Object;c.pageNumber=a.pagination.currentPage,c.recordsPerPage=a.pagination.itemPerPage,c.whetherSharedTab=!0,d.isEmpty(a.shareableDocument)||(d.isNullOrEmpty(a.shareableDocument.recordType)||(c.sharedEntity=a.shareableDocument.recordType),d.isNullOrEmpty(a.shareableDocument.name)||(c.sharedEntityName=a.shareableDocument.name),d.isEmpty(a.userData.data)||d.isNullOrEmpty(a.userData.data.id)||(c.sharedWith=a.userData.data.id),d.isNullOrEmpty(a.shareableDocument.validFrom)||(c.sharedOnStartDate=k.convertToServerDate(a.shareableDocument.validFrom)),d.isNullOrEmpty(a.shareableDocument.validTill)||(c.sharedOnTillDate=k.convertToServerDate(a.shareableDocument.validTill)),d.isNullOrEmpty(a.shareableDocument.sorters)||(c.sorters=a.shareableDocument.sorters),d.isEmpty(a.shareableDocument.sharedBy)||d.isEmpty(a.shareableDocument.sharedBy.data)||(c.sharedBy=a.shareableDocument.sharedBy.data.id),d.isEmpty(a.shareableDocument.onBehalfOf)||d.isEmpty(a.shareableDocument.onBehalfOf.data)||(c.onBehalfOf=a.shareableDocument.onBehalfOf.data.id,a.shareableDocument.onBehalfOf.data.id!=p.id?a.removeHyperLink=!0:a.removeHyperLink=!1)),b.showSpinner=!0;var f=l.getUrl("GET_SHARE_DOCUMENTS");j.getSharedDocuments(c,f,function(c){m(function(){c&&(b.showSpinner=!1,a.sharedDocumentList=c.data,a.pagination.totalItems=c.totalRecords,a.pagingInfo=e(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems))},20)},function(c){a.sharedDocumentList=[],b.showSpinner=!1})},a.getYetToBeShareDocuments=function(){var b=new Object;b.pageNumber=a.pagination.currentPage,b.recordsPerPage=a.pagination.itemPerPage,b.whetherSharedTab=!0,b.whetherYetToShare=!0,d.isEmpty(a.shareableDocument)||d.isNullOrEmpty(a.shareableDocument.recordType)||(b.sharedEntity=a.shareableDocument.recordType),d.isEmpty(a.shareableDocument.sharedBy)||d.isEmpty(a.shareableDocument.sharedBy.data)||(b.sharedBy=a.shareableDocument.sharedBy.data.id),d.isEmpty(a.shareableDocument.onBehalfOf)||d.isEmpty(a.shareableDocument.onBehalfOf.data)||(b.onBehalfOf=a.shareableDocument.onBehalfOf.data.id,a.shareableDocument.onBehalfOf.data.id!=p.id?a.removeHyperLink=!0:a.removeHyperLink=!1),a.sharedDocumentListSpinner=!0;var c=l.getUrl("YET_TOBE_SHARE_DETAILS");j.getSharedDocuments(b,c,function(b){b&&(a.sharedDocumentListSpinner=!1,a.sharedDocumentList=b.data,a.pagination.totalItems=b.totalRecords,a.pagingInfo=e(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems))},function(b){a.sharedDocumentList=[],a.sharedDocumentListSpinner=!1})},a.modeChange=function(){a.shareableDocument.isSharedMode?a.getShareableDocuments():a.getYetToBeShareDocuments()},a.recordTypeChanged=function(b){"USER_ISSUE"==b||"TREATMENT"==b||"DPR"==b?a.advanceSelected=!0:a.advanceSelected=!1},a.shareDocument=function(b,c){if(!d.isEmpty(b)){var e=new Object;e.id=b.id,e.entityId=b.entityInstanceId,e.shareType=b.sharedEntity,e.shareId=b.shareId,e.sharedWith=b.sharedWith,e.sharedEntityName=b.sharedEntityName,e.shareValidTill=b.shareValidTill,e.version=b.version,e.whetherActive=b.whetherActive,e.chainSharingId=b.chainSharingId,e.chainGroupId=b.chainGroupId,e.mode=c,e.callBackFun=function(){a.modeChange()},a.shareObject.init(e)}},a.addShareDocument=function(b,c){if("USER_ISSUE"==a.shareableDocument.recordType?b.advanceShareType="ALL":"TREATMENT"==a.shareableDocument.recordType?b.advanceShareType="ALL":"DPR"==a.shareableDocument.recordType&&(b.advanceShareType="ALL"),!d.isEmpty(b)){var e=new Object;e.mode=c,e.shareType=b.sharedEntity,e.advanceShareType=b.advanceShareType,e.entityId=b.entityInstanceId,e.sharedEntityName=b.sharedEntityName,e.chainSharingId=b.chainSharingId,e.callBackFun=function(){a.modeChange()},a.shareObject.init(e)}},a.advanceShareDocument=function(b,c){"USER_ISSUE"==a.shareableDocument.recordType?h.go("advancesharinglist",{type:"diseasevarient",id:b.entityInstanceId}):"TREATMENT"==a.shareableDocument.recordType?h.go("advancesharinglist",{type:"treatment",id:b.entityInstanceId}):"DPR"==a.shareableDocument.recordType&&h.go("advancesharinglist",{type:"mydocvpr",id:b.sharedBy.id,orgLocId:b.organizationLocationId})},a.viewVPR=function(a){var b,c,e,f;d.isEmpty(a.sharedBy)||(b=a.sharedBy.id,c=a.sharedBy.value),d.isEmpty(a.orgLoc)||(e=a.orgLoc.id,f=a.orgLoc.value);var g={type:"DPR",id:b,displayName:c,locationId:e,locationValue:f};h.go("patientRecord",g)},a.viewDocument=function(b){if(!d.isEmpty(b))switch(a.shareableDocument.recordType){case"DOCUMENT":h.go("otherDocument",{type:"view",data:b,id:b.entityInstanceId});break;case"DIAGNOSTIC_TEST":h.go("addEditUserTests",{type:"view",userTestId:b.entityInstanceId,previousState:h.current.name});break;default:console.log("Wrong Input")}},a.pageChanged=function(){a.pagingInfo=e(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems),a.modeChange()},a.setMaxRecords=function(b){a.pagination.currentPage=1,a.pagination.itemPerPage=b,a.modeChange()};var q={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=c.setOptionProperties(q),a.dtColumnDefs=c.setColumnProperties({}),a.clear=function(){a.userData={},b.$broadcast("clearUserData"),a.shareableDocument={},a.shareableDocument.isSharedMode=!0,a.loadListOfRecordTypes(),a.disableOnBehalfOf=!1,a.disableSharedBy=!1,a.removeHyperLink=!1}}]),angular.module("paripal.manageUserDocuments").controller("UserIdDocumentCtrl",["$scope","$rootScope","$stateParams","$state","$translate","notify","dateconvertor","utilService","urlService","resourceListService","fileOperations","userIdDocumentService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.userIdDocDetail={},a.documentTypeList=[],a.userIdDocDetail.whetherActive=!0,b.showSpinner=!1,a.displayId,a.loadListOfDocumentTypes=function(){b.showSpinner=!0,l.loadListOfDocumentType(function(c){h.isEmpty(c)||(a.documentTypeList=c,a.documentTypeList.splice(c.map(function(a){return a.subType}).indexOf("PROFILE_PHOTO"),1),b.showSpinner=!1)},function(a){})},a.saveUserIdDocumentDetails=function(c){if(c.$valid&&!h.isEmpty(a.userIdDocDetail)){b.showSpinner=!0;var d="",e="";a.editMode?(e=!0,d=i.getUrl("UPDATE_DOCUMENT_DETAILS")):(e=!1,d=i.getUrl("SAVE_DOCUMENT_DETAILS"));var j=new Object;h.isNullOrEmpty(a.userIdDocDetail.id)||(j.id=a.userIdDocDetail.id),h.isEmpty(a.userIdDocDetail.documentType)||(j.documentType=a.userIdDocDetail.documentType),h.isNullOrEmpty(a.userIdDocDetail.fileIdentifier)||(j.fileIdentifier=a.userIdDocDetail.fileIdentifier),h.isNullOrEmpty(a.userIdDocDetail.validTillDate)||(j.validTillDate=g.convertToServerDate(a.userIdDocDetail.validTillDate)),h.isEmpty(a.userIdDocFileDetail)||(j.fileName=a.userIdDocFileDetail.fileToBeUpload.name,j.fileSize=a.userIdDocFileDetail.fileToBeUpload.size),h.isNullOrEmpty(a.userIdDocDetail.whetherActive)||(j.whetherDeleted=!a.userIdDocDetail.whetherActive),l.saveDocumentDetails(j,d,e,function(b){h.isEmpty(a.userIdDocFileDetail)?(h.isNullOrEmpty(b.successMessage)||f("success",b.successMessage),a.goToListingScreen()):a.uploadFile(a.userIdDocFileDetail,a.userIdDocDetail,b)},function(a){b.showSpinner=!1})}},a.uploadFile=function(c,d,g){var i=new Object;i.file=c.fileToBeUpload,i.docType=m.documentTypes.userIdDocument,i.docSubType=d.documentType.subType,h.isNullOrEmpty(g.response)||(i.resourceId=g.response),a.userIdDocDetail.documentType&&a.userIdDocDetail.documentType.id&&"PROFILE_PHOTO"===a.userIdDocDetail.documentType.subType&&(i.isCompressedVersionRequired=!0),b.showSpinner=!0,k.uploadFile(i,function(b){h.isNullOrEmpty(g.successMessage)||f("success",g.successMessage),a.goToListingScreen()},function(b){h.isNullOrEmpty(g.response)||l.deleteUserIdDocDetails(g.response,function(b){f("Error",e.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()},function(b){f("Error",e.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()})})},a.goToListingScreen=function(){a.userIdDocDetail={},b.selectedTabInDocuments=0,d.go("myDocuments"),b.showSpinner=!1},a.cancel=function(){b.selectedTabInDocuments=0,h.goBackToPrevState()},a.init=function(){a.loadListOfDocumentTypes(),"edit"===c.type&&(a.editMode=!0),"view"===c.type&&(a.viewMode=!0),h.isEmpty(c.data)||(a.userIdDocDetail=c.data,h.isNullOrEmpty(c.data.referenceNumber)||(a.userIdDocDetail.fileIdentifier=c.data.referenceNumber,delete a.userIdDocDetail.referenceNumber),h.isNullOrEmpty(c.data.validTill)?delete a.userIdDocDetail.validTill:(a.userIdDocDetail.validTillDate=c.data.validTill,a.userIdDocDetail.validTillDate=g.convertToViewDate(a.userIdDocDetail.validTillDate),delete a.userIdDocDetail.validTill),h.isNullOrEmpty(a.userIdDocDetail.dateOfBirth)||(a.userIdDocDetail.dateOfBirth=g.convertToViewDate(a.userIdDocDetail.dateOfBirth)),h.isEmpty(a.userIdDocDetail.documentType)||(a.displayId=a.userIdDocDetail.documentType.id),h.isNullOrEmpty(a.userIdDocDetail.whetherDeleted)||(a.userIdDocDetail.whetherActive=!a.userIdDocDetail.whetherDeleted))},a.init()}]),angular.module("paripal.manageUserDocuments").controller("UserIdDocumentListCtrl",["$scope","$rootScope","datatableconfig","userIdDocumentService","utilService","serverSidePagination","notify","$translate","$state","fileOperations","commonConstants","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){a.document={},b.showSpinner=!1,a.documentList=[],a.userIdDocDetail={},a.userIdDocDetail.whetherDeleted=!1,a.deleteDialogBox={},a.open=!0,a.pagination={},a.pagination.currentPage=1,1==a.listView?a.pagination.itemPerPage=10:a.pagination.itemPerPage=12,a.startRecord=(a.pagination.currentPage-1)*a.pagination.itemPerPage+1,a.endRecord=a.pagination.itemPerPage,a.pagingInfo={},/* CARD VIEW CHANGES START */
a.listView=!1,a.cardView=!0,a.btnText=h.instant("LIST_VIEW"),a.toggleView=function(){1==a.listView?(a.cardView=!0,a.listView=!1,a.btnText=h.instant("LIST_VIEW"),a.pagination.itemPerPage=12,a.getUserIdByCriteria()):(a.cardView=!1,a.listView=!0,a.btnText=h.instant("CARD_VIEW"),a.pagination.itemPerPage=10,a.getUserIdByCriteria())},/* CARD VIEW CHANGES END */
a.$watch(function(){return a.selectedTab},function(b){b==a.myDocumentsTabs.userIdDocumentTab&&a.getUserIdByCriteria()}),a.documentTypeList=new Array,a.loadListOfDocumentType=function(){d.loadListOfDocumentType(function(b){e.isEmpty(b)||(a.documentTypeList=b,a.documentTypeList.splice(b.map(function(a){return a.subType}).indexOf("PROFILE_PHOTO"),1))},function(a){})},a.getUserIdByCriteria=function(){var c=new Object;c.pageNumber=a.pagination.currentPage,c.recordsPerPage=a.pagination.itemPerPage,c.documentTypeStr=k.documentTypes.userIdDocument,e.isEmpty(a.document)||e.isEmpty(a.document.documentType)||e.isNullOrEmpty(a.document.documentType.subType)||(c.documentSubTypeStr=a.document.documentType.subType),e.isEmpty(a.document)||e.isNullOrEmpty(a.document.referenceNo)||(c.referenceNumber=a.document.referenceNo),b.showSpinner=!0,d.getUserIdByCriteria(c,function(c){l(function(){c&&(b.showSpinner=!1,a.documentList=c.data,a.pagination.totalItems=c.totalRecords,a.pagingInfo=f(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems))},20)},function(a){b.showSpinner=!1})},a.deleteUserIdDocument=function(b){e.isEmpty(b)||(a.deleteDialogBox.header=h.instant("DELETE_USER_ID_DOCUMENTS"),a.deleteDialogBox.onOkBtnClick=function(){var c=new Object;c.fileName=b.fileName,c.resourceId=b.id,c.docType=k.documentTypes.userIdDocument,c.docSubType=b.documentType.subType,d.deleteUserIdDocFileDetails(c,function(c){d.deleteUserIdDocDetails(b.id,function(b){e.isNullOrEmpty(b.successMessage)||g("success",b.successMessage),a.getUserIdByCriteria()},function(a){})},function(a){})},a.deleteDialogBox.init())},a.downloadFile=function(a){if(!e.isEmpty(a)){var b=new Object;b.fileName=a.fileName,b.resourceId=a.id,b.docType=k.documentTypes.userIdDocument,b.docSubType=a.documentType.subType,j.downloadFile(b,function(a){},function(a){})}},a.viewPrintFile=function(b,c){if(!e.isEmpty(c)){var d=new Object;d.fileName=c.fileName,d.resourceId=c.id,d.docType=k.documentTypes.userIdDocument,d.docSubType=c.documentType.subType,d.isHidingPrintButton=!0,a.showFileInPopUp(d)}},a.createNewUserIdDocument=function(){localStorage.setItem("selectedTab",0),i.go("userIdDocument",{type:"add",data:null})},a.showUserIdDocumentDetails=function(a,b){localStorage.setItem("selectedTab",0),i.go("userIdDocument",{type:b,data:a})},a.pageChanged=function(){a.pagingInfo=f(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems),a.getUserIdByCriteria()},a.setMaxRecords=function(b){a.pagination.currentPage=1,a.pagination.itemPerPage=b,a.getUserIdByCriteria()};var m={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:0,setDeafultColSortingOrder:"desc"};a.options=c.setOptionProperties(m),a.dtColumnDefs=c.setColumnProperties({}),a.clear=function(){a.document={},a.getUserIdByCriteria()},a.init=function(){a.loadListOfDocumentType()},a.init()}]),angular.module("paripal.manageUserDocuments").service("manageUserDocumentService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict"}]),angular.module("paripal.manageUserDocuments").service("otherDocumentService",["httpService","urlService","utilService","$rootScope","$mdDialog","$translate",function(a,b,c,d,e,f){this.loadListOfDocumentType=function(c,d){a.getData(b.getUrl("GET_RESOURCE_TYPES"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getOtherDocuments=function(c,d,e,f){var g=b.getUrl("GET_OTHER_DOCUMENTS");d&&(g=b.getUrl("GET_ORBEON_FORM_DOCUMENTS")),a.postData(g,c,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.saveDocumentDetails=function(b,c,e,f,g){d.showSpinner=!0,e?a.putData(c,b,function(a){a&&a.data&&(d.showSpinner=!1,f(a.data))},function(a){g(a)}):a.postData(c,b,function(a){a&&a.data&&(d.showSpinner=!1,f(a.data))},function(a){g(a)})},this.deleteOtherDocFileDetails=function(c,d,e,g,h){var i=this,j=b.getUrl("DELETE_FILE");g&&(j+="?checkSharing=true"),a.postData(j,c,function(a){a&&d(a)},function(a){console.log(a),g&&a&&a.data&&1245===a.data.errorCodeValue?(h.header=f.instant("CONFIRM_DELETE_SHARE_DOCUMENT"),h.message=f.instant("REMOVE_SHARE_DOCUMENT"),h.onOkBtnClick=function(){i.deleteOtherDocFileDetails(c,d,e)},h.init()):e(a)},{handleError:!g})},this.deleteOtherDocDetails=function(c,d,e){var f=b.getUrl("DELETE_DOCUMENT_DETAILS");f&&(f=f+"?documentId="+c),a.deleteData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.loadDocumentDetailsById=function(c,d,e){var f=new Object;f.documentId=c;var g=b.getParameterizedUrl("GET_DOCUMENT_DETAILS_BY_ID",f);a.getData(g,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.manageUserDocuments").service("shareDocumentService",["httpService","urlService","utilService",function(a,b,c){this.loadListOfRecordTypes=function(d,e,f,g){if(!c.isNullOrEmpty(d)){var h=new Object;h.isOrganizationUserMode=d,h.isSharableTab=e;var i=b.getQueryParameterizedUrl("GET_RECORD_TYPES",h);a.getData(i,null,function(a){a&&a.data&&f(a.data)},function(a){g(a)})}},this.loadListOfSharedByUsers=function(c,d){a.getData(b.getUrl("GET_ALL_SHARE_BY_USERS"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getSharedDocuments=function(b,c,d,e){a.postData(c,b,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.saveShareDocumentDetails=function(b,c,d,e,f){d?a.putData(c,b,function(a){a&&a.data&&e(a.data)},function(a){f(a)}):a.postData(c,b,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.deleteShareDocumentDetails=function(d,e,f){if(!c.isNullOrEmpty(d)){var g=new Object;g.shareId=d;var h=b.getParameterizedUrl("SHARE_DETAILS",g);a.deleteData(h,null,function(a){a&&a.data&&e(a.data)},function(a){f(a)})}},this.getShareComments=function(c,d,e){var f=new Object;f.accessKeyId=c;var g=b.getQueryParameterizedUrl("GET_SHARE_COMMENTS",f);a.getData(g,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.manageUserDocuments").service("userIdDocumentService",["httpService","urlService","utilService",function(a,b,c){this.loadListOfDocumentType=function(c,d){a.getData(b.getUrl("FIND_USER_ID_DOCUMENTS"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getUserIdByCriteria=function(c,d,e){var f=b.getUrl("FIND_USER_ID_DOC_POST_LOGIN");a.postData(f,c,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.saveDocumentDetails=function(b,c,d,e,f){d?a.putData(c,b,function(a){a&&a.data&&e(a.data)},function(a){f(a)}):a.postData(c,b,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.deleteUserIdDocFileDetails=function(c,d,e){var f=b.getUrl("DELETE_FILE");a.postData(f,c,function(a){a&&d(a)},function(a){e(a)})},this.deleteUserIdDocDetails=function(c,d,e){var f=b.getUrl("DELETE_DOCUMENT_DETAILS");f&&(f=f+"?documentId="+c),a.deleteData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.manageUserProfile").controller("ManageUserProfileCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","baseService","httpService","urlService","utilService","commonConstants","applicationExceptionService","manageUserProfileService","otherDocumentService","fileOperations","$timeout","authenticationService","storageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.userProfileSpinner=!1,a.userDetalis=i.getLoggedInUser(),a.user={},a.disableForCompany=!1,a.userEthnicities={},a.userAccountStatuses={},a.userAdditionalDetails={},a.userInsurances={},a.languageList=[],a.ethnicities=[],a.ethnicity=[],a.emailValues=[{}],a.cellNoValues=[{}],a.landlineValues=[{}],a.userInsurances.currency={},a.user.walletCurrency={},a.user.hasGuardian=!1,a.category=[],a.labelList="",a.hideInActiveReason=!1,a.isGuardianRequired=!1,a.isInsuranceExist=!1,a.isPhotoUploaded=!1,a.logo={},a.setEthnicities=function(b){a.ethnicity=b},a.guardian={queryUrl:"FIND_USER_BY_LOGGED_IN_USER",queryParameter:{},jsonParameter:{}},a.userDetalis&&(a.user.hasGuardian=a.userDetalis.hasGuardian),a.systemLanguage={queryUrl:"GET_LANGUAGES",queryParameter:{},jsonParameter:{}},a.usersByAccountType={queryUrl:"GET_USERS_BY_ACCOUNT_TYPE",queryParameter:{accountType:"COMPANY"},jsonParameter:{}},a.notificationModes=[{id:"SMS",value:g.instant("SMS")},{id:"EMAIL",value:g.instant("EMAIL")},{id:"SYSTEN_NOTIFICATIONS",value:g.instant("SYSTEN_NOTIFICATIONS")}],a.onActiveChange=function(){a.user.whetherActive?a.hideInActiveReason=!1:a.hideInActiveReason=!0},a.$watch("userInsurances.insurancePolicyNo",function(b,c){l.isNullOrEmpty(b)?a.isInsuranceExist=!1:a.isInsuranceExist=!0}),a.getGuardianData=function(b){var c={};return c.searchString=b,j.getData(k.getParameterizedUrl("FIND_USER_BY_LOGGED_IN_USER",c),null,function(b){if(b&&b.data)return a.gaurdianList=b.data,a.gaurdianList},function(a){})},a.onGuardianSelect=function(b){a.userAdditionalDetails.guardianId=b},a.$watch("gaurdianList",function(b){l.isEmpty(b)||a.dataSet&&(a.dataSet=!1)},!0),a.validateGuardianValue=function(b,c){l.isNullOrEmpty(b)?(a.dataSet=!0,a.organization=null):(a.organization={},b.hasOwnProperty("value")?a.organization=b:a.organization.value=b)},a.hasGuardianRequired=function(){a.user.hasGuardian?a.isGuardianRequired=!0:(a.isGuardianRequired=!1,a.userAdditionalDetails.guardianId=null)},
// Add User Address
a.saveUserProfile=function(){return a.userProfileForm.$valid?(a.userProfileSpinner=!0,void o.saveUserProfile(a.user,a.ethnicity,a.userAccountStatuses,a.userAdditionalDetails,a.userInsurances,a.emailValues,a.landlineValues,a.cellNoValues,a.category,function(e){a.userProfileSpinner=!1,f("success",g.instant("USER_PROFILE_UPDATE_SUCCESS")),s.getUserDetails(a.user,function(e){b.showSpinner=!1,l.isEmpty(e)||(t.setPrivileges(e),i.setLoggedInUser(e),delete e.individualFeaturePrivileges,delete e.locationConsolidatedPrivileges,delete e.locationFeaturePrivileges,b.loggedInUserDetails=e,a.user.login={},a.selectLanguage(),l.isNullOrEmpty(e.redirectPage)||(l.isFieldEmpty(c.callbackState)?"FIRST_LOGIN"===e.redirectPage?d.go("newUserSignIn"):"RESET_PASSWORD_PAGE"===e.redirectPage?d.go("resetPassword"):d.go("home.view"):d.go(c.callbackState)))},function(c){b.showSpinner=!1,a.user.login.idEmailCellIdentity="",a.user.login.password="",d.go("home.view")}),d.go("home.view"),a.isPhotoUploaded&&b.$emit("loadHeaderPhotoImage",{logoDocumentId:a.user.logoDocumentId,logoFileName:a.user.logoFileName})},function(b){a.userProfileSpinner=!1})):void f("warning",g.instant("FILL_MANDATORY_FIELDS"))},a.userLogo={},a.saveFileDetailsToLocal=function(b){if(b){var c=b.name.split(".").pop();c=c.toLowerCase(),"jpg"===c||"jpeg"===c||"png"===c||"bmp"===c||"tif"===c?a.logo=b:f("Warning",g.instant("UPLOAD_VALID_FILE_TYPE"))}},a.saveLogoDetails=function(b){if(!b.$valid)return a.user.logoDocumentId=null,a.user.logoFileName=null,void f("warning",g.instant("FILL_MANDATORY_FIELDS"));var c=k.getUrl("SAVE_DOCUMENT_DETAILS"),d=new Object;d.documentType={type:m.documentTypes.userIdDocument,subType:m.documentSubTypes.profilePhoto},l.isEmpty(a.logo)||l.isNullOrEmpty(a.logo.name)?a.saveUserProfile():(d.fileName=a.logo.name,d.fileSize=a.logo.size,p.saveDocumentDetails(d,c,!1,function(b){a.user.logoDocumentId=b.response,a.user.logoFileName=d.fileName,a.uploadFile(a.logo,a.user.logoDocumentId)},function(a){f("Error",g.instant("ERROR_WHILE_UPLOADING"))}))},a.uploadFile=function(b,c){var d=new Object;d.file=b,d.docType=m.documentTypes.userIdDocument,d.docSubType=m.documentSubTypes.profilePhoto,d.isCompressedVersionRequired=!0,
//paramObject.organizationId = $scope.user.id;
c&&(d.resourceId=c),q.uploadFile(d,function(b){b&&(a.isPhotoUploaded=!0,a.saveUserProfile())},function(b){a.user.logoDocumentId=null,a.user.logoFileName=null,f("Error",g.instant("ERROR_WHILE_UPLOADING"))})},a.viewLogo=function(b,c){if(b){var d=new Object;d.fileName=c,d.resourceId=b,d.docType=m.documentTypes.userIdDocument,d.docSubType=m.documentSubTypes.profilePhoto,q.getImageUrl(d,function(b){a.logoUrl=b},function(){})}else a.logoUrl="../../images/user-profile-img.png"},
// Get selected user address data
a.getUserProfileDetails=function(b,c){l.isNullOrEmpty(b)||o.getUserProfileDetails(b,function(b){a.setDataToUserProfileForm(b,c),a.userProfileSpinner=!1})},a.manageMsgSubscription=function(){d.go("manageEventSubscription",{user:{id:a.userDetalis.id,displayName:a.userDetalis.displayName}})},a.setDataToUserProfileForm=function(c,d){if(!l.isEmpty(c)){if(l.isFieldEmpty(c.currentOrganization)?c.currentOrganization=null:c.currentOrganization={nameValue:c.currentOrganization},a.user=c,"COMPANY"==a.user.accountType&&(a.disableForCompany=!0),l.isNullOrEmpty(a.user.walletCurrency)&&(a.user.walletCurrency={}),l.isNullOrEmpty(a.user.logoDocumentId)||l.isNullOrEmpty(a.user.logoFileName)||(a.viewLogo(a.user.logoDocumentId,a.user.logoFileName),d&&b.$emit("loadHeaderPhotoImage",{logoDocumentId:a.user.logoDocumentId,logoFileName:a.user.logoFileName})),a.userAccountStatuses=c.userAccountStatuses,a.userAdditionalDetails=c.userAdditionalDetails,!l.isEmpty(c.userInsurances)&&c.userInsurances.length>0&&(a.userInsurances=c.userInsurances[0]),c.email1&&(a.emailValues[0]={value:c.email1}),c.email2&&a.emailValues.push({value:c.email2}),c.cell1&&(a.cellNoValues[0]={value:c.cell1}),c.cell2&&a.cellNoValues.push({value:c.cell2}),c.landline1&&(a.landlineValues[0]={value:c.landline1}),c.landline2&&a.landlineValues.push({value:c.landline2}),c.birthDate&&(a.user.birthDate=c.birthDate),c.validFrom&&(a.user.validFrom=c.validFrom),c.validTill&&(a.user.validTill=c.validTill),c.lastUpdatedDate&&(a.user.lastUpdatedDate=h("timestampToDate")(c.lastUpdatedDate,"MM/dd/yyyy")),c.userInsurances.length>0&&!l.isEmpty(c.userInsurances[0])&&(c.userInsurances[0].insuranceValidFrom&&(a.userInsurances.insuranceValidFrom=h("timestampToDate")(c.userInsurances[0].insuranceValidFrom,"MM/dd/yyyy")),c.userInsurances[0].insuranceValidTill&&(a.userInsurances.insuranceValidTill=h("timestampToDate")(c.userInsurances[0].insuranceValidTill,"MM/dd/yyyy"))),a.user.userEthnicities){a.ethnicity=[];for(var e=0;a.user.userEthnicities.length>e;e++)a.ethnicity.push(a.user.userEthnicities[e].ethnicity.id)}/*if(!utilService.isEmpty($scope.user.systemLanguage)){
                    $scope.systemLangyuageId = $scope.user.systemLanguage.id;
                }*/
l.isEmpty(a.userAdditionalDetails)||(l.isNullOrEmpty(a.userAdditionalDetails.guardianId)||l.isNullOrEmpty(a.userAdditionalDetails.guardianName)?l.isNullOrEmpty(a.userAdditionalDetails.guardianName)?(a.userAdditionalDetails.guardianId=null,a.isGuardianRequired=!1):(a.userAdditionalDetails.guardianId=a.userAdditionalDetails.guardianName,a.isGuardianRequired=!0):(a.userAdditionalDetails.guardianId={id:a.userAdditionalDetails.guardianId,value:a.userAdditionalDetails.guardianName},a.isGuardianRequired=!0),l.isEmpty(a.userAdditionalDetails.preferredContactModes)?(a.userAdditionalDetails.preferredContactModes=[],angular.forEach(a.notificationModes,function(b,c){a.userAdditionalDetails.preferredContactModes.push(b.id)})):a.userAdditionalDetails.preferredContactModes=a.userAdditionalDetails.preferredContactModes.split(","),l.isEmpty(a.userAdditionalDetails.userCategoryId1)||(a.category[0]={id:a.userAdditionalDetails.userCategoryId1.id,value:a.userAdditionalDetails.userCategoryId1.value}),l.isEmpty(a.userAdditionalDetails.userCategoryId2)||(a.category[1]={id:a.userAdditionalDetails.userCategoryId2.id,value:a.userAdditionalDetails.userCategoryId2.value}),l.isEmpty(a.userAdditionalDetails.userCategoryId3)||(a.category[2]={id:a.userAdditionalDetails.userCategoryId3.id,value:a.userAdditionalDetails.userCategoryId3.value}),l.isEmpty(a.userAdditionalDetails.userCategoryId4)||(a.category[3]={id:a.userAdditionalDetails.userCategoryId4.id,value:a.userAdditionalDetails.userCategoryId4.value}),l.isEmpty(a.userAdditionalDetails.userCategoryId5)||(a.category[4]={id:a.userAdditionalDetails.userCategoryId5.id,value:a.userAdditionalDetails.userCategoryId5.value})),r(function(){a.dobChanged()},0)}},a.fetchCategotyLabels=function(){var b=new Array;b.push("USER_CATEGORY_1"),b.push("USER_CATEGORY_2"),b.push("USER_CATEGORY_3"),b.push("USER_CATEGORY_4"),b.push("USER_CATEGORY_5"),o.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.getEthnicityPickList=function(){o.getEthnicityPickList("ETHNICITY",function(b){l.isEmpty(b)||(a.ethnicities=angular.fromJson(b))},function(a){})},a.calculateAge=function(){// birthday is a date
if(a.user.birthDate){var b=new Date(a.user.birthDate),c=Date.now()-b.getTime(),d=new Date(c),e=Math.abs(d.getUTCFullYear()-1970);a.user.age=e}},a.cancel=function(){l.goBackToPrevState()},a.changeUserAddress=function(){var b={navigateFrom:"myProfile",userAddressId:null,userId:a.userDetalis.id,userCode:a.userDetalis.userCode,userName:a.userDetalis.displayName};d.go("userAddressList",b)},a.manageStakeholderList=function(){d.go("userstackholderlist")},a.manageStakeholderRequestList=function(){d.go("userstackholderrequestlist")},/*$scope.myProfile = function () {
            $state.go("myProfile");
        };*/
a.setDirectiveFn=function(b){a.dobChanged=b},
//Init Method
a.init=function(){a.userProfileSpinner=!0,a.getEthnicityPickList(),a.fetchCategotyLabels(),a.userAdditionalDetails.preferredContactModes=[],l.isEmpty(a.userDetalis)||l.isNullOrEmpty(a.userDetalis.id)||a.getUserProfileDetails(a.userDetalis.id,!1)},a.init()}]),angular.module("paripal.manageUserProfile").service("manageUserProfileService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveUserProfile=function(e,f,g,h,i,j,k,l,m,n,o){var p=angular.copy(e),q=angular.copy(h);
//User Ethnicity
if(j[0]&&j[0].value?p.email1=j[0].value:p.email1=null,j[1]&&j[1].value?p.email2=j[1].value:p.email2=null,k[0]&&k[0].value?p.landline1=k[0].value:p.landline1=null,k[1]&&k[1].value?p.landline2=k[1].value:p.landline2=null,l[0]&&l[0].value?p.cell1=l[0].value:p.cell1=null,l[1]&&l[1].value?p.cell2=l[1].value:p.cell2=null,d.isFieldEmpty(p.currentOrganization)||(p.currentOrganization=p.currentOrganization.nameValue),p.title=null,p.religion=null,p.resident=null,p.gender=null,p.bloodGroup=null,d.isEmpty(e.title)||d.isEmpty(e.title.dataValue)||(p.title=e.title.dataValue),d.isEmpty(e.religion)||d.isEmpty(e.religion.dataValue)||(p.religion=e.religion.dataValue),d.isEmpty(e.resident)||d.isEmpty(e.resident.dataValue)||(p.resident=e.resident.dataValue),d.isEmpty(e.gender)||d.isEmpty(e.gender.dataValue)||(p.gender=e.gender.dataValue),d.isEmpty(e.walletCurrency)||d.isEmpty(e.walletCurrency.dataValue)||(p.walletCurrency=e.walletCurrency.dataValue),d.isEmpty(e.bloodGroup)||d.isEmpty(e.bloodGroup.dataValue)||(p.bloodGroup=e.bloodGroup.dataValue),d.isEmpty(e.inactiveReason)||d.isEmpty(e.inactiveReason.dataValue)||(p.inactiveReason=e.inactiveReason.dataValue),d.isNullOrEmpty(e.birthDate)||(p.birthDate=c.convertToServerDate(e.birthDate)),d.isNullOrEmpty(e.validFrom)||(p.validFrom=c.convertToServerDate(e.validFrom)),d.isNullOrEmpty(e.validTill)||(p.validTill=c.convertToServerDate(e.validTill)),d.isNullOrEmpty(e.lastUpdatedDate)||(p.lastUpdatedDate=c.convertToServerDate(e.lastUpdatedDate)),d.isEmpty(f))p.userEthnicities=[];else{for(var r=[],s=!1,t=e.userEthnicities,u=0;u<f.length;u++){if(!d.isEmpty(t))for(var v=0;v<t.length;v++)f[u]===t[v].ethnicity.id&&(r.push(t[v]),s=!0);s||r.push({id:null,ethnicity:{id:f[u]},user:{id:e.id}}),s=!1}p.userEthnicities=r}
//User additional details
if(!d.isEmpty(q)){d.isEmpty(q.guardianId)||d.isNullOrEmpty(q.guardianId.id)?d.isNullOrEmpty(q.guardianId)?(q.guardianId=null,q.guardianName=null):(q.guardianName=q.guardianId.value,q.guardianId=null):(q.guardianName=q.guardianId.value,q.guardianId=q.guardianId.id),/*userAdditionalDetails.occupation = null;
userAdditionalDetails.preferedMealTypeId = null;*/
d.isEmpty(q.occupation)||d.isEmpty(q.occupation.dataValue)||(q.occupation=q.occupation.dataValue),d.isEmpty(q.preferedMealTypeId)||d.isEmpty(q.preferedMealTypeId.dataValue)?delete q.preferedMealTypeId:q.preferedMealTypeId=q.preferedMealTypeId.dataValue,d.isEmpty(q.preferredContactModes)?q.preferredContactModes=null:q.preferredContactModes=q.preferredContactModes.join();for(var u=0;u<m.length;u++)0==u&&m[u].dataValue&&(q.userCategoryId1=m[u].dataValue),1==u&&m[u].dataValue&&(q.userCategoryId2=m[u].dataValue),2==u&&m[u].dataValue&&(q.userCategoryId3=m[u].dataValue),3==u&&m[u].dataValue&&(q.userCategoryId4=m[u].dataValue),4==u&&m[u].dataValue&&(q.userCategoryId5=m[u].dataValue);q.user={id:e.id},p.userAdditionalDetails=q}
//User Insurances
d.isEmpty(i)||d.isNullOrEmpty(i.insurancePolicyNo)?p.userInsurances=[]:(d.isEmpty(i.currency)||d.isEmpty(i.currency.dataValue)||(i.currency=i.currency.dataValue),d.isNullOrEmpty(i.insuranceValidFrom)||(i.insuranceValidFrom=c.convertToServerDate(i.insuranceValidFrom)),d.isNullOrEmpty(i.insuranceValidTill)||(i.insuranceValidTill=c.convertToServerDate(i.insuranceValidTill)),i.user={id:e.id},p.userInsurances=[],p.userInsurances[0]=i),a.postData(b.getUrl("UPDATE_USER_PROFILE"),p,function(a){n(a&&a.data?a.data:a)},function(a){o(a)})},this.getUserProfileDetails=function(c,d){var e={};e.userId=c,a.getData(b.getParameterizedUrl("GET_USER_PROFILE_BY_ID",e),null,function(a){a&&a.data&&d(a.data)},function(a){})},this.fetchCategotyLabels=function(c,d,e){a.postData(b.getUrl("FETCH_CATEGORIES"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getAllLanguagesList=function(c,d){a.getData(b.getUrl("GET_LANGUAGES"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getEthnicityPickList=function(c,d,e){var f={};f.type=c,a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.medicationEquivalenceModule").controller("equivalenceCtrl",["$scope","$rootScope","commonConstants","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","urlService","utilService","viewEquivalenceServices","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){
//getting accessabel system locations
function o(){j.getData(k.getParameterizedUrl("GET_ACCESSABLE_LOC"),null,function(b){a.accessabelLocation=b.data},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})}function p(b){var c=!1;return a.accessabelLocation&&!l.isEmpty(a.accessabelLocation)&&a.accessabelLocation.forEach(function(a){a&&b&&a==b&&(c=!0)}),c}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.medication=[],a.drugVariant={},a.equivalenceType={},a.diseaseVariant={},a.diseaseVariants={},a.equivalenceFilter={},a.equivalenceTypes={},a.equivalenceFilter.drugVariant={},a.checkOrganizationLocationAccess=p,a.addNewEquivalence=function(){e.go("manageequivalence",{type:""})},a.clear=function(){a.equivalenceFilter={},a.medicationVariants={},d.medicationId=null,d.diseaseVariantId=null,d.medicationVariantId=null,d.medication=null,d.medicationVariant=null,d.diseaseVariant=null,e.go("equlist",{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1}),a.fetchRecords()};d.medicationId&&d.diseaseVariantId&&(a.equivalenceFilter||(a.equivalenceFilter={}),a.equivalenceFilter.medicationId||a.equivalenceFilter.diseaseVariantId||(a.equivalenceFilter.medication={},a.equivalenceFilter.diseaseVariant={}),a.equivalenceFilter.medication.id=d.medicationId,a.equivalenceFilter.diseaseVariant.id=d.diseaseVariantId),a.fetchRecords=function(){var b={};d.medicationId&&d.diseaseVariantId&&(a.equivalenceFilter.medication={},a.equivalenceFilter.medication.id=d.medicationId,a.equivalenceFilter.diseaseVariant.id=d.diseaseVariantId,
//$scope.equivalenceFilter.medication=$stateParams.medication;
a.getVariant(d.medicationId)),a.equivalenceFilter.medication&&a.equivalenceFilter.medication.id&&(b.medication=a.equivalenceFilter.medication.id),a.equivalenceFilter.drugVariant&&a.equivalenceFilter.drugVariant.id&&(b.drugVariant=a.equivalenceFilter.drugVariant.id),a.equivalenceFilter.equivalenceType&&a.equivalenceFilter.equivalenceType.id&&(b.equivalenceType=a.equivalenceFilter.equivalenceType.code),a.equivalenceFilter.diseaseVariant&&a.equivalenceFilter.diseaseVariant.id&&(b.diseaseVariant=a.equivalenceFilter.diseaseVariant.id),a.equivalenceFilter.equivalenceType&&"GENERIC"==a.equivalenceFilter.equivalenceType.code&&b.diseaseVariant&&delete b.diseaseVariant,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,m.fetchRecords(b,function(b){b&&(a.equivalences=b.data,a.totalItems=b.totalRecords,a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems))},function(a){l.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})},o(),a.manageEquivalence=function(a,b){m.getEquivalenceById(a,function(c){var d=c,f="view";b&&(f="edit"),e.go("manageequivalence",{id:a,type:f,data:d})},function(a){})},a.deleteEquivalence=function(b){m.deleteEquivalenceById(b,function(b){l.isNullOrEmpty(b.successMessage)||(g("success",h.instant(b.successMessage)),a.fetchRecords())},function(a){})},a.getMedication=function(b){a.queryObj={},a.queryObj.keyword=b;var c=k.getParameterizedUrl("GET_MEDICATION_LIST_BY_KEYWORD",a.queryObj);if(c)return j.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){})},a.getVariant=function(b){a.queryObj={},a.queryObj.id=b;var c=k.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&j.getData(c,null,function(b){b&&b.data&&(a.medicationVariants=b.data)},function(a){})},a.getMedicationType=function(){j.getData(k.getUrl("GET_MED_TYPE"),null,function(b){b&&b.data&&(a.equivalenceTypes=b.data)},function(a){})},a.getDiseaseVariant=function(){j.getData(k.getUrl("GET_DISEASE_VARIANT_LIST"),null,function(b){b&&b.data&&(a.diseaseVariants=b.data)},function(a){})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()},a.getDiseaseVariant(),a.getMedicationType(),a.fetchRecords();
//data table config
var q=c.gridConfigurations;a.options=i.setOptionProperties(q),a.dtColumnDefs=i.setColumnProperties({})}]),angular.module("paripal.medicationEquivalenceModule").controller("manageequivalenceCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","urlService","utilService","manageEquivalenceServices","viewEquivalenceServices","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.disabled=!1,a.variantDisable=!0,a.equVariantDisable=!0,a.equivalence={},a.orgLocPermission=n.MEDICATION_EQUIVALENCE_ADD,a.cancel=function(){/*$state.go("equlist", {
                    type: ''
                });*/
k.goBackToPrevState()},a.getVariant=function(c){b.$broadcast("medication",c),a.queryObj={},a.queryObj.id=c;var d=j.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);d&&i.getData(d,null,function(b){b&&b.data&&(a.variantDisable=!1,a.medicationVariants=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getEquivalentVariant=function(c){b.$broadcast("medicationEquvalent",c),a.queryObj={},a.queryObj.id=c;var d=j.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);d&&i.getData(d,null,function(b){b&&b.data&&(a.equVariantDisable=!1,a.medicationEquivalentVariants=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.setData=function(b){a.medicationVariantId=b.medicationVariant.id,a.getVariant(b.medication.id),a.medicationEquivalentVariantId=b.medicationEquivalentVariant.id,a.getEquivalentVariant(b.medicationEquivalent.id),a.equivalenceTypeValue=b.equivalenceType},a.init=function(){a.manageOrgLocSpinner=!0,"add"===c.type&&(a.orgLocPermission=n.MEDICATION_EQUIVALENCE_ADD),"view"===c.type&&(a.pageState="view",a.disabled=!0),"edit"===c.type&&(a.orgLocPermission=n.MEDICATION_EQUIVALENCE_EDIT),c.data?(a.user={},a.equivalence=c.data,a.setData(a.equivalence),a.manageOrgLocSpinner=!1):c.id&&m.getEquivalenceById(c.id,function(b){a.manageOrgLocSpinner=!1,a.equivalence=b,a.setData(a.equivalence)},function(b){a.manageOrgLocSpinner=!1,a.error=b})},a.getMedication=function(b){a.queryObj={},a.queryObj.keyword=b;var c=j.getParameterizedUrl("GET_MEDICATION_LIST_BY_KEYWORD",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.medicationList=a.filterData(b.data),a.medicationList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},b.$on("medication",function(b,c){a.medicationId=c}),b.$on("medicationEquvalent",function(b,c){a.medicationId=c}),a.filterData=function(b){var c=[];return b.forEach(function(d,e){a.medicationId===d.id?b.splice(e,1):c.push(d)}),c},a.getCreatingOrgn=function(b){var c={};
//userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,i.getData(j.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getMedicationType=function(){i.getData(j.getUrl("GET_MED_TYPE"),null,function(b){b&&b.data&&(a.equivalenceTypes=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getDiseaseVariant=function(b){a.diseaseVariant={},a.diseaseVariant.searchKeyWord=b;var c=j.getParameterizedUrl("GET_DISEASE_VARIANTS_BY_SEARCHWORD",a.diseaseVariant);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.diseaseVariants=b.data,a.diseaseVariants},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.saveEquivalence=function(){var b=a.equivalence;
//  if(equivalence.creatingOrgn && equivalence.creatingOrgn.id ){
// 	 equivalence.creatingOrgn = equivalence.creatingOrgn.value;
//  }else{
// 	 equivalence.creatingOrgn = equivalence.creatingOrgn;
//  }
// if(equivalence.equivalenceType=='SPECIFIC' && (equivalence.diseaseVariant.id === undefined || equivalence.diseaseVariant.id == null)){
//   notify("error", $translate.instant("Select Disease Variant"));
//   return; 
// }
return b.medication&&!b.medication.id?void f("error",g.instant("Invalid Medication")):b.medicationEquivalent&&!b.medicationEquivalent.id?void f("error",g.instant("Invalid Medication Equivalent")):(b.equivalenceType&&(b.equivalenceType=b.equivalenceType),"SPECIFIC"!=b.equivalenceType||void 0!==b.diseaseVariant.id&&null!=b.diseaseVariant.id?void l.saveEquivalence(b,function(a){k.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),d.go("equlist"))},function(a){k.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))}):void f("error",g.instant("Select Disease Variant")))},a.init(),a.getDiseaseVariant(),a.getMedicationType()}]),angular.module("paripal.medicationEquivalenceModule").service("manageEquivalenceServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){"use strict";this.saveEquivalence=function(c,d,e){var f="";f=null!=c.id?"UPDATE_EQUIVALENCE":"SAVE_EQUIVALENCE",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getEquivalenceId=function(c,d){a.getData(b.getUrl("GET_EQU_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.medicationEquivalenceModule").service("viewEquivalenceServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){"use strict";this.fetchRecords=function(c,d,e){a.postData(b.getUrl("GET_EQUIVALENCE_LIST"),c,function(a){a&&a.data?(f(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.getEquivalenceById=function(c,d,e){var f={};f.equivalenceId=c,a.getData(b.getParameterizedUrl("GET_EQUIVALENCE_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteEquivalenceById=function(c,d,e){var f={};f.equivalenceId=c,a.deleteData(b.getParameterizedUrl("DELETE_EQUIVALENCE_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateRequestCreated=e("timestampToDate")(a.dateRequestCreated,b),a.whenNeeded=e("timestampToDate")(a.whenNeeded,b)})}}]),angular.module("paripal.medicationSideEffectModule").controller("manageSideEffectCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","urlService","manageSideEffectServices","viewUserSideEffectServices","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){return a.medication={},a.medication.medication=b,a.medicationLoad=!0,i.getData(j.getParameterizedUrl("SEARCH_MEDICATION",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}function p(b){a.queryObj={},a.queryObj.id=b;var c=j.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&i.getData(c,null,function(b){b&&b.data&&(a.variantList=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function q(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.sideEffectLoad=!0,i.getData(j.getParameterizedUrl("GET_SIDE_EFFECT",a.searchKeyWord),null,function(b){return a.sideEffectLoad=!1,a.sideEffect=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}function r(b){return a.userData={},a.userData.searchString=b,a.userNameAutoCmpLoading=!0,i.getData(j.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}function s(a,b,c,e,h){
// if(!(sideEffect && sideEffect.creatingOrgn && sideEffect.creatingOrgn.id)){
// 	notify("error", $translate.instant('CREATING_ORG_VALIDATION'))
// 	return;
// }
k.saveSideEffect(a,b,c,e,h,function(b){b&&(d.go("usersideeffectlist"),a&&a.id?f("success",g.instant("RECORD_UPDATED_SUCCESS")):f("success",g.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}/*function getRecordId() {
				if (!($scope.sideeffect && $scope.sideeffect.id)) {
					return httpService.getData(urlService.getUrl('GET_SIDEEFFECT_RECORD_ID'), null, function (response) {
						$scope.recordLoading = false;
						return $scope.sideeffect.sideEffectRecordId = response.data;
					}, function (error) {
						$scope.recordLoading = false;
						if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
							notify("error", $translate.instant(error.data.messages[0]));
						}
					});
				}
			}*/
function t(b){a.sideeffect=b,a.user=a.sideeffect.user.value,a.medication=a.sideeffect.medication.value,a.drugVariant=a.sideeffect.drugVariant.value,p(a.sideeffect.medication.id)}a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.sideeffect={},a.sideeffect.user="",a.getMedications=o,a.getVariant=p,a.getSideEffect=q,a.getUserNamesForRoleHistory=r,a.saveSideEffect=s,
//$scope.getRecordId = getRecordId;
a.updateRecord=t,a.minDate=new Date,a.orgLocPermission=n.USER_MEDICATION_SIDE_EFFECTS_ADD,a.cancel=function(){/*$state.go("usersideeffectlist", {
					type: ''
				});*/
m.goBackToPrevState()},a.init=function(){a.manageOrgLocSpinner=!0,"add"===c.type&&(a.orgLocPermission=n.USER_MEDICATION_SIDE_EFFECTS_ADD),"view"===c.type&&(a.pageState="view",a.viewmode=!0),"edit"===c.type&&(a.orgLocPermission=n.USER_MEDICATION_SIDE_EFFECTS_EDIT),c.data?(a.user={},a.sideeffect=c.data,a.user=a.sideeffect.user.value,a.medication=a.sideeffect.medication.value,a.drugVariant=a.sideeffect.drugVariant.value,a.drugVariantId=a.sideeffect.drugVariant.id,a.effect=a.sideeffect.sideEffect.value,p(a.sideeffect.medication.id),a.manageOrgLocSpinner=!1):c.id&&l.getSideEffectById(c.id,function(b){a.manageOrgLocSpinner=!1,a.sideeffect=b,a.user=a.sideeffect.user.value,a.medication=a.sideeffect.medication.value,a.drugVariant=a.sideeffect.drugVariant.value,a.drugVariantId=a.sideeffect.drugVariant.id,a.effect=a.sideeffect.sideEffect.value,p(a.sideeffect.medication.id)},function(b){a.manageOrgLocSpinner=!1,a.error=b,m.isEmpty(error.data)||m.isEmpty(error.data.messages[0])||f("error",g.instant(error.data.messages[0]))})},a.init(),a.getCreatedBy=function(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,i.getData(j.getParameterizedUrl("FIND_ACCESSIBLE_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.validate=function(a,b){"object"!=typeof a&&b.$setValidity("required",!1,null)}}]),angular.module("paripal.medicationSideEffectModule").controller("SideEffectListCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","urlService","viewMedicationSideEffectServices","commonConstants","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b){var b=angular.copy(b);b||(b={}),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,k.getStatistics(b,function(b){b&&(a.sideEffects=b.data,a.totalItems=b.totalRecords,a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems))},function(a){})}function o(b){return a.medication={},a.medication.medication=b,a.medicationLoad=!0,i.getData(j.getParameterizedUrl("SEARCH_MEDICATION",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1})}function p(b){a.queryObj={},a.queryObj.id=b;var c=j.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&i.getData(c,null,function(b){b&&b.data&&(a.variantList=b.data)},function(a){})}a.sideEffects=[];var q={};a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.getMedicationSideEffectList=n,a.getMedications=o,a.getVariant=p,a.sideeffect={},a.variantList={},a.clear=function(){a.sideeffect={},a.variantList={},n()},n(q);
//data table config
var r=l.gridConfigurations;a.pageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems),a.getMedicationSideEffectList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getMedicationSideEffectList()},a.options=h.setOptionProperties(r),a.dtColumnDefs=h.setColumnProperties({})}]),angular.module("paripal.medicationSideEffectModule").controller("userSideEffectListCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","urlService","commonConstants","viewUserSideEffectServices","dateconvertor","serverSidePagination","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(){if(
//$scope.filterSideEffect = angular.copy(sideEffect);
/*
		if(!filterSideEffect){
			filterSideEffect={};
		}*/
o.isFieldEmpty(a.sideeffect)||(b=angular.copy(a.sideeffect)),a.filterRecords={},a.filterRecords||(a.filterRecords={}),!o.isFieldEmpty(b)){if(c.medicationId&&c.variantId){var b={};b.medication={},b.variant={},b.medication.id=c.medicationId,b.variant.id=c.variantId,a.sideeffect.medication=c.medication;var d={};d.id=c.variantId,d.value=c.medicationVariant,a.variantList=[],a.variantList.push(d)}b.medication&&(a.filterRecords.medication=b.medication.id),b.medication&&b.variant&&(a.filterRecords.variant=b.variant.id),b.userId&&b.userId.id?a.filterRecords.userId=b.userId.id:b.userId&&!a.loginDetails.isOrganizationUser&&(a.filterRecords.userId=a.loginDetails.id),b.sideEffect&&(a.filterRecords.sideEffect=b.sideEffect.id)}a.filterRecords.pageNumber=a.currentPage,a.filterRecords.recordsPerPage=a.itemPerPage,l.getUserSideEffectList(a.filterRecords,function(b){b&&(a.sideEffects=b.data,a.totalItems=b.totalRecords,a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),x())},function(a){f("error",g.instant(a.data.messages[0]))})}function q(){l.getAccessibleLocation(function(b){a.accessableLoc=b,x()},function(a){f("error",g.instant(a.data.messages[0]))})}function r(a,b){l.getSideEffectById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("managesideeffect",{id:a,type:e,data:f})},function(a){f("error",g.instant(a.data.messages[0]))})}function s(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_LIST_BY_SEACRH_KEY";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),i.getData(j.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,f("error",g.instant(b.data.messages[0]))})}function t(b,c){var b={id:b};l.removeSideEffect(b,function(b){b&&(a.sideEffects.splice(c,1),f("success",g.instant("RECORD_DELETED_SUCCESSFULLY")))},function(a){f("error",g.instant(a.data.messages[0]))})}function u(b){return a.medication={},a.medication.medication=b,a.medicationLoad=!0,i.getData(j.getParameterizedUrl("SEARCH_MEDICATION",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,f("error",g.instant(b.data.messages[0]))})}function v(b){a.queryObj={},a.queryObj.id=b;var c=j.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&i.getData(c,null,function(b){b&&b.data&&(a.variantList=b.data)},function(a){f("error",g.instant(a.data.messages[0]))})}function w(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.sideEffectLoad=!0,i.getData(j.getParameterizedUrl("GET_SIDE_EFFECT",a.searchKeyWord),null,function(b){return a.sideEffectLoad=!1,a.sideEffect=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,f("error",g.instant(b.data.messages[0]))})}function x(){a.accessableLoc.length>0&&a.sideEffects&&a.sideEffects.length>0&&a.sideEffects.forEach(function(b){a.accessableLoc.indexOf(b.creatingOrgn.id)<0?b.accessable=!1:b.accessable=!0})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.sideeffect={},a.variantList={},a.accessableLoc=[],a.loginDetails=b.loggedInUserDetails,a.getUserSideEffectList=p,a.manageSideEffect=r,a.getUserNamesForRoleHistory=s,a.removeSideEffect=t,a.getMedications=u,a.getVariant=v,a.getSideEffect=w,a.getAccessibleLocation=q,a.checkAccessableLoc=x,a.loginDetails.isOrganizationUser||(a.sideeffect.userId=a.loginDetails.displayName);var y;c.medicationId&&c.variantId&&(y||(y={}),y.medication||y.variant||(y.medication={},y.variant={}),y.medication.id=c.medicationId,y.variant.id=c.variantId),a.initLoader=function(){p(),b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode&&q()},a.initLoader(),a.addNewSideEffect=function(){d.go("managesideeffect",{type:""})};
//data table config
var z=k.gridConfigurations;a.pageChanged=function(){a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),p()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,p()},a.options=h.setOptionProperties(z),a.dtColumnDefs=h.setColumnProperties({}),a.clear=function(){a.sideeffect={},a.variantList={},y={},a.filterRecords={},c.medicationId=null,c.variantId=null,d.go("usersideeffectlist",{notify:!1},{notify:!1}),a.getUserSideEffectList()}}]),angular.module("paripal.medicationSideEffectModule").service("manageSideEffectServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.saveSideEffect=function(d,e,f,g,h,i,j){var k="";e.id&&(d.user={},d.user.id=e.id),f.id&&(d.medication={},d.medication.id=f.id),h.id&&(d.sideEffect={},d.sideEffect.id=h.id),g.id&&(d.drugVariant={},d.drugVariant.id=g.id),k=null!=d.id?"UPDATE_SIDE_EFFECT":"SAVE_SIDE_EFFECT",d.date=c.convertToServerDate(d.date),a.postData(b.getUrl(k),d,function(a){a&&a.data?i(a.data):j(a)},function(a){j(a)})}}]),angular.module("paripal.medicationSideEffectModule").service("viewMedicationSideEffectServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.getStatistics=function(c,d,e){c.medication&&(c.medication=c.medication.id),c.variant&&(c.variant=c.variant.id),a.postData(b.getUrl("GET_STATISTICS"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.medicationSideEffectModule").service("viewUserSideEffectServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.getUserSideEffectList=function(c,d,e){var f={};
// if(sideEffectData.dateFrom){
// 	sideEffect.dateFrom = dateconvertor.convertToServerDate(sideEffectData.dateFrom);
// }
// if(sideEffectData.dateTill){
// 	sideEffect.dateTill = dateconvertor.convertToServerDate(sideEffectData.date);
// }
c.medication&&(f.medication=c.medication.id),c.sideEffect&&(f.sideEffect=c.sideEffect.id),c.variant&&(f.variant=c.variant.id),c.userId&&(f.userId=c.userId.id),a.postData(b.getUrl("GET_SIDE_EFFECT_LIST"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getSideEffectById=function(c,d,f){var g={};g.sideEffectId=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_SIDE_EFFECT_ID",g),null,function(a){a&&a.data?(a.data.date=e("timestampToDate")(a.data.date,h),d(a.data)):f(a)},function(a){f(a)})},this.removeSideEffect=function(c,d,e){a.deleteData(b.getParameterizedUrl("REMOVE_MEDICATION",c),null,function(a){a?d(a):e(a)},function(a){e(a)})};this.getAccessibleLocation=function(c,d){a.getData(b.getUrl("GET_ACCESSABLE_LOC"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),/**
 * Creating directive for navigation menu.
 *
 */
angular.module("paripal.menuModule").directive("navMenu",["$compile","utilService","$translate","$rootScope","$state",function(a,b,c,d,e){return{restrict:"E",template:'<div id="paripal-menu"></div>',scope:{menuData:"="},link:function(d,f,g){function h(){var a=!1;return function(b){(/(android|ipad|playbook|silk|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}d.navigationMenu="<nav id='mp-menu' class='mp-menu'></nav>";var i=h()?"click":"touchstart";d.createSubMenu=function(d,f){if(d&&b.isNullOrEmpty(d.children)&&b.isEmpty(d.children)){var g=d.parentId+"_level",h=angular.element(document.getElementById(g));if(!b.isNullOrEmpty(d.name)){var j=a("<li><a ng-click='test()' class='fa "+d.iconcls+"' ui-sref='"+d.state+"'>"+c.instant(d.name)+"</a></li>")(f);j[0].addEventListener(i,function(){e.go(d.state)}),h.append(j)}}if(d.children instanceof Array)for(var k in d.children){var l=d.children[k];if(b.isNullOrEmpty(l.children)&&b.isEmpty(l.children));else{var g=l.parentId+"_level",h=angular.element(document.getElementById(g));b.isNullOrEmpty(l.name)||h.append(a("<li class='fa fa-angle-left width100'><a ng-click='test()' class='fa "+l.iconcls+"' href='#'>"+c.instant(l.name)+"</a><div class='mp-level'><h2 class='icon icon-display'>"+c.instant(l.name)+"</h2><a class='mp-back' href='#'>back <span class='fa fa-caret-right pull-right'></span></a><ul id='"+l.id+"_level'></ul></div></li>")(f))}f.createSubMenu(l,f)}},d.createMenu=function(d,e,f){var g=angular.element(document.getElementById("paripal-menu"));g.empty(),g.append(a(e.navigationMenu)(e));var h=angular.element(document.getElementById("mp-menu"));null!=d.name&&""!=d.name?h.append(a("<div class='mp-level'><h2 class='fa "+d.iconcls+"'>"+c.instant(d.name)+"</h2><ul id='"+d.id+"_level'></ul></div>")(e)):h.append(a("<div class='mp-level'><ul id='"+d.id+"_level'></ul></div>")(e)),!b.isEmpty(d.children)&&d.children.length>0&&e.createSubMenu(d,e)},d.$watch("menuData",function(a){if(!b.isEmpty(a)){d.createMenu(a,d,f);new mlPushMenu(document.getElementById("mp-menu"),document.getElementById("trigger"),{type:"cover"})}},!0),d.test=function(){return $("#mp-menu").animate({scrollTop:0},"slow"),!1}}}}]),angular.module("paripal.messagingModule").controller("AdhocMessageRecipientCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","adhocMessageRecipientService","messagingGroupUserListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPageMsgGroup=1,a.itemPerPageMsgGroup=10,a.startRecordMsgGroup=(a.currentPageMsgGroup-1)*a.itemPerPageMsgGroup+1,a.endRecordMsgGroup=a.itemPerPageMsgGroup,a.pagingInfoMsgGroup={},a.WSAdhocMessage={},a.WSAdhocMessage.displayCode=null,a.WSAdhocMessage.msgCategory=null,a.WSAdhocMessage.magSubCategory=null,a.searchCriteriaMsgGroup={},a.WSMsgGroupList=[],a.msgGroupSpinner=!1,a.previousAdhocMsgForm=function(){d.go("manageAdhocMessage",{type:c.type,adhocMsgEventConfigId:c.adhocMsgEventConfigId})},a.cancelAdhocMessageForm=function(){l.goBackToPrevState()},
//Search messaging group list
a.searchMessageGroups=function(){a.msgGroupSpinner=!0,a.searchCriteriaMsgGroup.pageNumber=a.currentPageMsgGroup,a.searchCriteriaMsgGroup.recordsPerPage=a.itemPerPageMsgGroup,c.adhocMsgEventConfigId&&(a.searchCriteriaMsgGroup.adhocMsgEventConfigId=c.adhocMsgEventConfigId,m.searchMessageGroups(a.searchCriteriaMsgGroup,function(b){a.msgGroupSpinner=!1,a.WSMsgGroupList=b.data,a.totalItemsMsgGroup=b.totalRecords,a.pageMsgGroup=j(a.currentPageMsgGroup,a.itemPerPageMsgGroup,a.totalItemsMsgGroup),a.pagingInfoMsgGroup={startRecordMsgGroup:a.pageMsgGroup.startRecord,endRecordMsgGroup:a.pageMsgGroup.endRecord}},function(b){a.msgGroupSpinner=!1}))},a.deleteAdhocMessageGroup=function(b,c,d){if(c){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("DELETE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){m.deleteAdhocMessageGroup(c,function(b){f("success",g.instant(b)),a.searchMessageGroups()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},function(){})}},a.customizeMessageGroup=function(a,b,e,f){d.go("customizeMsgGroupUser",{type:c.type,organizationLocation:c.organizationLocation,msgGroupId:b,groupName:f,adhocMsgGroupId:e,displayCode:c.displayCode,adhocMsgEventConfigId:c.adhocMsgEventConfigId})},a.deleteAdhocMessageUsers=function(b,c,d){if(c){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("DELETE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){m.deleteAdhocMessageUsers(c,function(b){f("success",g.instant(b)),a.searchMessageGroupUsers()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},function(){})}},a.sendAdhocMessage=function(){m.sendAdhocMessage(c.adhocMsgEventConfigId,function(a){f("success",g.instant("RECORD_SAVED_SUCCESS")),d.go("adhocMessages")},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("FAILED_TO_SAVE_RECORD")):f("error",g.instant(a.data.messages[0]))})},a.addMessageGroup=function(a,b){d.go("addAdhocMessageGroup",{type:c.type,organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode})},
//Server side pagination module
a.pageChangedMsgGroup=function(){a.pagingInfoMsgGroup=j(a.currentPageMsgGroup,a.itemPerPageMsgGroup,a.totalItemsMsgGroup),a.searchMessageGroups()},
//set page record
a.setMaxRecordsMsgGroup=function(b){a.pageNumberMsgGroup=1,a.itemPerPageMsgGroup=b,a.searchMessageGroups()},/*
         * User List
         * */
a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSMsgGroupUsers=[],a.groupUserType=[],a.msgGroupUserSpinner=!1,
//Search messaging group user list
a.searchMessageGroupUsers=function(){a.msgGroupUserSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,c.adhocMsgEventConfigId&&(a.searchCriteria.adhocMsgEventConfigId=c.adhocMsgEventConfigId,m.searchMessageGroupUsers(a.searchCriteria,function(b){a.msgGroupUserSpinner=!1,a.WSMsgGroupUsers=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.msgGroupUserSpinner=!1}))},a.getGroupUserType=function(){var b={type:"groupUserType"};n.getGroupUserType(b,function(b){a.groupUserType=b},function(a){})},a.manageMessageGroupUser=function(b,e){var f=[];angular.forEach(a.WSMsgGroupUsers,function(a,c){b==a.groupUserType.code&&f.push(a.userId)}),b&&("GROUP_USER_INDIVIDUAL"===b?d.go("messagingOrgGroupUser",{type:c.type,menuNevigate:"adhocMessage",organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode,groupUserType:b,whetherAdmin:!1,userIds:f,isIndividualUserMode:a.isIndividualUserMode}):"GROUP_USER_ORG"===b?d.go("messagingOrgGroupUser",{type:c.type,menuNevigate:"adhocMessage",organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode,groupUserType:b,whetherAdmin:!0,userIds:f,isIndividualUserMode:a.isIndividualUserMode}):"GROUP_USER_CLIENT"===b&&d.go("messagingClientGroupUser",{type:c.type,menuNevigate:"adhocMessage",organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode,groupUserType:b,userIds:f}))},
//Fetch records
a.fetchRecords=function(){a.searchMessageGroupUsers()},
//clear search
a.clear=function(){a.searchCriteria={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchMessageGroupUsers()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchMessageGroupUsers()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.loggedInUser=angular.fromJson(localStorage.getItem("loggedInUser")),"add"===c.type?a.pageState="add":"edit"===c.type?a.pageState="edit":"view"===c.type&&(a.pageState="view"),c.isIndividualUserMode&&!a.loggedInUser.isOrganizationUserMode&&(a.isIndividualUserMode=c.isIndividualUserMode),l.isEmpty(c)||l.isNullOrEmpty(c.adhocMsgEventConfigId)||l.isEmpty(c.organizationLocation)||l.isNullOrEmpty(c.displayCode)?c.adhocMsgEventConfigId?d.go("manageAdhocMessage",{type:c.type,adhocMsgEventConfigId:c.adhocMsgEventConfigId}):c.adhocMsgEventConfigId||d.go("adhocMessages"):(a.WSAdhocMessage.displayCode=c.displayCode,a.getGroupUserType(),a.searchMessageGroups(),a.searchMessageGroupUsers())},a.init()}]),angular.module("paripal.messagingModule").controller("AdhocMessagingListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","adhocMessagingListService","$interval",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSAdhocMessageList=[],a.isSubCategoryDisabled=!0,a.adhocMessageSpinner=!1,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.$watch("searchCriteria.organizationLocation",function(b,c){b&&b.id?(a.category={queryUrl:"FIND_CUSTOM_MSG_CATEGORY_BY_ORG_LOCATION_ID",queryParameter:{organizationLocationId:b.id},jsonParameter:{}},a.$broadcast("loadSearchCriteriaCategory",a.category),a.isCategoryDisabled=!1,a.isSubCategoryDisabled=!1):(a.isCategoryDisabled=!0,a.isSubCategoryDisabled=!0,a.searchCriteria.category={},a.searchCriteria.subCategory={})},!0),a.$watch("searchCriteria.category",function(b,c){b&&b.id?(a.subCategory={queryUrl:"FIND_ALL_ADHOC_ACTIVE_SUB_CATEGORY_BY_CATEGORY_ID",queryParameter:{msgCategoryId:b.id},jsonParameter:{}},a.$broadcast("loadSearchCriteriaSubCategory",a.subCategory),a.isSubCategoryDisabled=!1):(a.isSubCategoryDisabled=!0,a.searchCriteria.subCategory={})},!0),
//Search messaging group list
a.searchAdhocMessages=function(){a.adhocMessageSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,m.searchAdhocMessages(a.searchCriteria,a.authorId,function(b){a.adhocMessageSpinner=!1,a.WSAdhocMessageList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.adhocMessageSpinner=!1})},a.manageAdhocMessage=function(b,c){d.go("manageAdhocMessage",{type:c,adhocMsgEventConfigId:b,isIndividualUser:a.isIndividualUserMode})},a.inactivateAdhocMessage=function(b,c,d){if(c){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){m.inactivateAdhocMessage(c,function(b){a.searchAdhocMessages()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},function(){})}},
//Fetch records
a.fetchRecords=function(){a.searchAdhocMessages()},
//clear search
a.clear=function(){a.searchCriteria={},a.searchAdhocMessages()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchAdhocMessages()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchAdhocMessages()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({});var p;a.requestStatusStart=function(){p=n(a.searchAdhocMessages,72e3)},a.requestStatusStop=function(){n.cancel(p)},a.requestStatusStart(),a.$on("$destroy",function(){a.requestStatusStop()}),a.init=function(){l.isFieldEmpty(c.user)||"professionalwall"===c.type&&(a.authorId=c.user.id,a.fromProfessionalWall=!0),a.searchAdhocMessages(),a.loggedInUser=angular.fromJson(localStorage.getItem("loggedInUser")),1==a.loggedInUser.whetherSubscriber&&(a.isIndividualUserMode=!0)},a.init()}]),angular.module("paripal.messagingModule").controller("AdhocMsgGroupListCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","datatableconfig","baseService","utilService","notify","$translate","serverSidePagination","adhocMsgGroupListService","manageAdhocMessageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSMsgGroupList=[],a.msgGroupSpinner=!1,a.groupType={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"groupType"},jsonParameter:{}},a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.selected=[],a.exists=function(a,b){return b.indexOf(a.id)>-1},a.toggle=function(b,c){var d=c.indexOf(b.id);d>-1?c.splice(d,1):c.push(b.id),a.selected=c},
//Search messaging group list
a.searchMessageGroups=function(){a.msgGroupSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,c.organizationLocation.id&&(a.searchCriteria.creatingOrgLocId=c.organizationLocation.id,a.searchCriteria.whetherActive=!0,l.searchMessageGroups(a.searchCriteria,function(b){a.msgGroupSpinner=!1,a.WSMsgGroupList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.msgGroupSpinner=!1}))},a.saveAdhocMessageGroup=function(b){c.adhocMsgEventConfigId&&(a.selected&&a.selected.length>0?m.saveAdhocMessageGroup(c.adhocMsgEventConfigId,a.selected,function(b){i("success",j.instant("ADDED_SUCCESS")),a.selected=[],a.searchMessageGroups()},function(a){h.isEmpty(a.data)||h.isEmpty(a.data.messages[0])?i("error",j.instant("FAILED_TO_SAVE_RECORD")):i("error",j.instant(a.data.messages[0]))}):i("warning",j.instant("SELECT_MSG_GROUP_MANDATORY")))},a.moveToPreviousStep=function(){d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode})},
//Fetch records
a.fetchRecords=function(){a.searchMessageGroups()},
//clear search
a.clear=function(){a.searchCriteria={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.searchMessageGroups()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchMessageGroups()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=f.setOptionProperties(n),a.dtColumnDefs=f.setColumnProperties({}),a.init=function(){h.isEmpty(c)||!c.organizationLocation||h.isNullOrEmpty(c.adhocMsgEventConfigId)?c.adhocMsgEventConfigId?d.go("manageAdhocMessage",{type:c.type,adhocMsgEventConfigId:c.adhocMsgEventConfigId}):c.adhocMsgEventConfigId||d.go("adhocMessages",{type:null,adhocMsgEventConfigId:null}):(a.organizationLocation=c.organizationLocation,a.searchMessageGroups())},a.init()}]),angular.module("paripal.messagingModule").controller("ClientQuickListCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","datatableconfig","notify","$translate","serverSidePagination","utilService","msgOrgLocClientListService","messagingGroupUserListService","manageAdhocMessageService","adhocMessageRecipientService","baseService","orgUserListService","manageOrgLocService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.addressInfoFilter={},a.orgLocationInfo={},a.user={},a.WSOrgLocationClientSearchCriteria={},a.WSOrgLocationClientSearchCriteria.whetherActive=!0,a.searchObj={},a.professionalList=["DOCTOR","SUPPORT_SERVICE_PROFESSIONAL","OTHER_HEALTH_SERVICE_PROFESSIONAL","COUNSELOR"],a.isSendToAll=!1,a.category=new Array,a.healthCategoryId1={},a.healthCategoryId2={},a.healthCategoryId3={},a.healthCategoryId4={},a.healthCategoryId5={},a.supportCategoryId1={},a.supportCategoryId2={},a.supportCategoryId3={},a.supportCategoryId4={},a.supportCategoryId5={},a.orglocclientlistSpinner=!1,a.clicked=!1,a.selected=[],a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.callSearchOrgLocClient=function(){a.selected=[],a.searchOrgLocClient()},a.searchOrgLocClient=function(){var b;j.isFieldEmpty(a.WSOrgLocationClientSearchCriteria)||j.isFieldEmpty(a.WSOrgLocationClientSearchCriteria.whetherAllStatus)||delete a.WSOrgLocationClientSearchCriteria.whetherAllStatus,a.WSOrgLocationClientSearchCriteria.pageNumber=a.currentPage,a.WSOrgLocationClientSearchCriteria.recordsPerPage=a.itemPerPage,a.orglocclientlistSpinner=!0,a.user&&!j.isFieldEmpty(a.user.userDataInfo)&&(b=a.user.userDataInfo),a.tempGender=angular.copy(a.WSOrgLocationClientSearchCriteria.gender),j.isNullOrEmpty(a.category)||angular.forEach(a.category,function(b,c){0!=c||j.isNullOrEmpty(b.dataValue)?1!=c||j.isNullOrEmpty(b.dataValue)?c>1&&!j.isNullOrEmpty(b.dataValue)&&(a.WSOrgLocationClientSearchCriteria.clientCategoryId3=b.dataValue):a.WSOrgLocationClientSearchCriteria.clientCategoryId2=b.dataValue:a.WSOrgLocationClientSearchCriteria.clientCategoryId1=b.dataValue}),k.searchOrgLocClient(a.WSOrgLocationClientSearchCriteria,a.orgLocationInfo,b,a.addressInfoFilter,function(b){a.createSearchObj(),a.orglocclientlistSpinner=!1,a.WSOrganizationLocationClient=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.tempGender&&a.tempGender.dataValue&&(a.WSOrgLocationClientSearchCriteria.gender={},a.WSOrgLocationClientSearchCriteria.gender.dataValue=angular.copy(a.tempGender.dataValue))},function(b){a.orglocclientlistSpinner=!1,a.error=b,a.tempGender&&a.tempGender.dataValue&&(a.WSOrgLocationClientSearchCriteria.gender={},a.WSOrgLocationClientSearchCriteria.gender.dataValue=angular.copy(a.tempGender.dataValue))})},a.fetchCategotyLabels=function(){var b=new Array;b.push("CLIENT_CATEGORY_1"),b.push("CLIENT_CATEGORY_2"),b.push("CLIENT_CATEGORY_3"),q.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.fetchCategotyLabels(),a.exists=function(b,c){return 1==a.isSendToAll||(b.client&&b.client.id?c.indexOf(b.client.id)>-1:c.indexOf(b.userId)>-1)},a.toggle=function(b,c){var d;if(b.client&&b.client.id)var d=c.indexOf(b.client.id);else var d=c.indexOf(b.userId);d>-1?c.splice(d,1):b.client&&b.client.id?c.push(b.client.id):c.push(b.userId),a.selected=c},a.createSearchObj=function(){a.searchObj={},a.WSOrgLocationClientSearchCriteria.gender&&a.WSOrgLocationClientSearchCriteria.gender.dataValue?a.searchObj.genderId=angular.copy(a.WSOrgLocationClientSearchCriteria.gender.dataValue.id):a.tempGender&&a.tempGender.dataValue&&(a.searchObj.genderId=angular.copy(a.tempGender.dataValue.id)),a.searchObj.maxAge=a.WSOrgLocationClientSearchCriteria.maxAge,a.searchObj.minAge=a.WSOrgLocationClientSearchCriteria.minAge,a.WSOrgLocationClientSearchCriteria.clientCategoryId1&&(a.searchObj.clientCategoryId1=a.WSOrgLocationClientSearchCriteria.clientCategoryId1),a.WSOrgLocationClientSearchCriteria.whetherSupportSrvcPrfssnl&&(a.searchObj.whetherSupportSrvcPrfssnl=a.WSOrgLocationClientSearchCriteria.whetherSupportSrvcPrfssnl),a.WSOrgLocationClientSearchCriteria.whetherOtherHealthSrvcPrfssnl&&(a.searchObj.whetherOtherHealthSrvcPrfssnl=a.WSOrgLocationClientSearchCriteria.whetherOtherHealthSrvcPrfssnl),a.WSOrgLocationClientSearchCriteria.clientCategoryId2&&(a.searchObj.clientCategoryId2=a.WSOrgLocationClientSearchCriteria.clientCategoryId2),a.WSOrgLocationClientSearchCriteria.clientCategoryId3&&(a.searchObj.clientCategoryId3=a.WSOrgLocationClientSearchCriteria.clientCategoryId3),a.WSOrgLocationClientSearchCriteria.supportCategoryId1&&(a.searchObj.supportCategoryId1=a.WSOrgLocationClientSearchCriteria.supportCategoryId1),a.WSOrgLocationClientSearchCriteria.supportCategoryId2&&(a.searchObj.supportCategoryId2=a.WSOrgLocationClientSearchCriteria.supportCategoryId2),a.WSOrgLocationClientSearchCriteria.supportCategoryId3&&(a.searchObj.supportCategoryId3=a.WSOrgLocationClientSearchCriteria.supportCategoryId3),a.WSOrgLocationClientSearchCriteria.supportCategoryId4&&(a.searchObj.supportCategoryId4=a.WSOrgLocationClientSearchCriteria.supportCategoryId4),a.WSOrgLocationClientSearchCriteria.supportCategoryId5&&(a.searchObj.supportCategoryId5=a.WSOrgLocationClientSearchCriteria.supportCategoryId5),a.WSOrgLocationClientSearchCriteria.healthCategoryId1&&(a.searchObj.healthCategoryId1=a.WSOrgLocationClientSearchCriteria.healthCategoryId1),a.WSOrgLocationClientSearchCriteria.healthCategoryId2&&(a.searchObj.healthCategoryId2=a.WSOrgLocationClientSearchCriteria.healthCategoryId2),a.WSOrgLocationClientSearchCriteria.healthCategoryId3&&(a.searchObj.healthCategoryId3=a.WSOrgLocationClientSearchCriteria.healthCategoryId3),a.WSOrgLocationClientSearchCriteria.healthCategoryId4&&(a.searchObj.healthCategoryId4=a.WSOrgLocationClientSearchCriteria.healthCategoryId4),a.WSOrgLocationClientSearchCriteria.healthCategoryId5&&(a.searchObj.healthCategoryId5=a.WSOrgLocationClientSearchCriteria.healthCategoryId5),a.user&&a.user.userDataInfo&&(a.searchObj.userName=a.user.userDataInfo),a.WSOrgLocationClientSearchCriteria.whetherActive?a.searchObj.whetherActive=a.WSOrgLocationClientSearchCriteria.whetherActive:a.searchObj.whetherActive=!1},a.addClientForMessagingGroup=function(b){a.selected&&a.selected.length>0||1==a.isSendToAll?m.saveAdhocMessageUsers(c.adhocMsgEventConfigId,c.userCatagory,a.selected,function(a){n.sendAdhocMessage(c.adhocMsgEventConfigId,function(a){g("success",h.instant("RECORD_SAVED_SUCCESS")),d.go("adhocMessages")},function(a){})},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])?g("error",h.instant("FAILED_TO_SAVE_RECORD")):g("error",h.instant(a.data.messages[0]))},a.orgLocationInfo.id,a.isSendToAll,a.pageForm,a.searchObj):g("warning",h.instant("SELECT_USER_MANDATORY"))},a.sendToAll=function(){"GROUP_USER_CLIENT"==c.userCatagory?a.searchOrgLocClient():a.searchOrgUser()},a.moveToPreviousStep=function(){"msgGroup"===c.menuNevigate?d.go("messagingGroupUser",{type:c.type,organizationLocation:c.organizationLocation,msgGroup:c.msgGroup,groupUserType:c.groupUserType}):"adhocMessage"===c.menuNevigate&&d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode})},a.clear=function(){/* $scope.WSOrgLocationClientSearchCriteria.gender = {}; */
delete a.WSOrgLocationClientSearchCriteria.maxAge,delete a.WSOrgLocationClientSearchCriteria.minAge,delete a.WSOrgLocationClientSearchCriteria.genderId,delete a.WSOrgLocationClientSearchCriteria.organizationLocationId,delete a.WSOrgLocationClientSearchCriteria.userName,delete a.WSOrgLocationClientSearchCriteria.gender,delete a.WSOrgLocationClientSearchCriteria.clientCategoryId1,delete a.WSOrgLocationClientSearchCriteria.clientCategoryId2,delete a.WSOrgLocationClientSearchCriteria.clientCategoryId3,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId1,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId2,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId3,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId4,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId5,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId1,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId2,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId3,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId4,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId5,delete a.WSOrgLocationClientSearchCriteria.whetherOtherHealthSrvcPrfssnl,delete a.WSOrgLocationClientSearchCriteria.whetherSupportSrvcPrfssnl,a.healthCategoryId1={},a.healthCategoryId2={},a.healthCategoryId3={},a.healthCategoryId4={},a.healthCategoryId5={},a.supportCategoryId1={},a.supportCategoryId2={},a.supportCategoryId3={},a.supportCategoryId4={},a.supportCategoryId5={},a.user={},a.category=new Array,a.selected=[],/* $scope.addressInfoFilter = {}; */
//$scope.orgLocationInfo = {};
/* $scope.userDataInfo = {};
            $scope.$broadcast("clearAddressData");
            $scope.$broadcast("clearProfessionalData"); */
/* $scope.WSOrganizationLocationClient = []; */
"GROUP_USER_CLIENT"==c.userCatagory?a.callSearchOrgLocClient():a.callSearchOrgUser()},a.fetchRecords=function(){},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),"GROUP_USER_CLIENT"==c.userCatagory?a.callSearchOrgLocClient():a.callSearchOrgUser()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,"GROUP_USER_CLIENT"==c.userCatagory?a.callSearchOrgLocClient():a.callSearchOrgUser()};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=f.setOptionProperties(r),a.dtColumnDefs=f.setColumnProperties({}),a.toggleSelection=function(){a.isSelectAll?"GROUP_USER_CLIENT"==c.userCatagory?(angular.forEach(a.WSOrganizationLocationClient,function(b,c){b.client.id&&a.selected.indexOf(b.client.id)==-1&&a.selected.push(b.client.id)}),a.searchOrgLocClient()):(angular.forEach(a.userList,function(b,c){b.userId&&a.selected.indexOf(b.userId)==-1&&a.selected.push(b.userId)}),a.searchOrgUser()):"GROUP_USER_CLIENT"==c.userCatagory?(angular.forEach(a.WSOrganizationLocationClient,function(b,c){b.client.id&&a.selected.indexOf(b.client.id)!=-1&&a.selected.splice(a.selected.indexOf(b.client.id),1)}),a.searchOrgLocClient()):(angular.forEach(a.userList,function(b,c){b.userId&&a.selected.indexOf(b.userId)!=-1&&a.selected.splice(a.selected.indexOf(b.userId),1)}),a.searchOrgUser())},a.callSearchOrgUser=function(){a.selected=[],a.searchOrgUser()},a.searchOrgUser=function(){var b;j.isFieldEmpty(a.WSOrgLocationClientSearchCriteria)||j.isFieldEmpty(a.WSOrgLocationClientSearchCriteria.whetherAllStatus)||delete a.WSOrgLocationClientSearchCriteria.whetherAllStatus,!j.isFieldEmpty(a.WSOrgLocationClientSearchCriteria)&&a.WSOrgLocationClientSearchCriteria.whetherOtherHealthSrvcPrfssnl?(a.healthCategoryId1&&a.healthCategoryId1.dataValue&&(a.WSOrgLocationClientSearchCriteria.healthCategoryId1=a.healthCategoryId1.dataValue.dataValue),a.healthCategoryId2&&a.healthCategoryId2.dataValue&&(a.WSOrgLocationClientSearchCriteria.healthCategoryId2=a.healthCategoryId2.dataValue.dataValue),a.healthCategoryId3&&a.healthCategoryId3.dataValue&&(a.WSOrgLocationClientSearchCriteria.healthCategoryId3=a.healthCategoryId3.dataValue.dataValue),a.healthCategoryId4&&a.healthCategoryId4.dataValue&&(a.WSOrgLocationClientSearchCriteria.healthCategoryId4=a.healthCategoryId4.dataValue.dataValue),a.healthCategoryId5&&a.healthCategoryId5.dataValue&&(a.WSOrgLocationClientSearchCriteria.healthCategoryId5=a.healthCategoryId5.dataValue.dataValue)):(delete a.WSOrgLocationClientSearchCriteria.whetherOtherHealthSrvcPrfssnl,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId1,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId2,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId3,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId4,delete a.WSOrgLocationClientSearchCriteria.healthCategoryId5),!j.isFieldEmpty(a.WSOrgLocationClientSearchCriteria)&&a.WSOrgLocationClientSearchCriteria.whetherSupportSrvcPrfssnl?(a.supportCategoryId1&&a.supportCategoryId1.dataValue&&(a.WSOrgLocationClientSearchCriteria.supportCategoryId1=a.supportCategoryId1.dataValue.dataValue),a.supportCategoryId2&&a.supportCategoryId2.dataValue&&(a.WSOrgLocationClientSearchCriteria.supportCategoryId2=a.supportCategoryId2.dataValue.dataValue),a.supportCategoryId3&&a.supportCategoryId3.dataValue&&(a.WSOrgLocationClientSearchCriteria.supportCategoryId3=a.supportCategoryId3.dataValue.dataValue),a.supportCategoryId4&&a.supportCategoryId4.dataValue&&(a.WSOrgLocationClientSearchCriteria.supportCategoryId4=a.supportCategoryId4.dataValue.dataValue),a.supportCategoryId5&&a.supportCategoryId5.dataValue&&(a.WSOrgLocationClientSearchCriteria.supportCategoryId5=a.supportCategoryId2.dataValue.dataValue)):(delete a.WSOrgLocationClientSearchCriteria.whetherSupportSrvcPrfssnl,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId1,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId2,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId3,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId4,delete a.WSOrgLocationClientSearchCriteria.supportCategoryId5),a.isIndividualUser=!o.getLoggedInUser().isOrganizationUserMode,a.WSOrgLocationClientSearchCriteria.pageNumber=a.currentPage,a.WSOrgLocationClientSearchCriteria.recordsPerPage=a.itemPerPage,a.user&&!j.isFieldEmpty(a.user.userDataInfo)&&(b=a.user.userDataInfo),a.tempGender=a.WSOrgLocationClientSearchCriteria.gender,p.searchUsers(a.WSOrgLocationClientSearchCriteria,a.addressInfoFilter,{},a.orgLocationInfo,function(b){
//$scope.selected = [];
a.createSearchObj(),a.userlistSpinner=!1,a.userList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.tempGender&&a.tempGender.dataValue&&(a.WSOrgLocationClientSearchCriteria.gender={},a.WSOrgLocationClientSearchCriteria.gender.dataValue=angular.copy(a.tempGender.dataValue))},function(b){a.userlistSpinner=!1,a.error=b,a.userList=null,a.currentPage=1,a.totalItems=0,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.tempGender&&a.tempGender.dataValue&&(a.WSOrgLocationClientSearchCriteria.gender={},a.WSOrgLocationClientSearchCriteria.gender.dataValue=angular.copy(a.tempGender.dataValue))},b)},a.init=function(){c.selectedOrg&&(a.selected=c.selectedOrg),j.isEmpty(c)||("msgGroup"===c.menuNevigate&&j.isEmpty(c.msgGroup)?d.go("messagingGroup"):"adhocMessage"===c.menuNevigate&&j.isNullOrEmpty(c.adhocMsgEventConfigId)?d.go("adhocMessages"):(a.orgLocationInfo=c.organizationLocation,"GROUP_USER_CLIENT"==c.userCatagory?(a.pageForm="CLIENT",a.searchOrgLocClient()):(a.pageForm="ORG_USER",a.searchOrgUser())));/* locationCategory label changes */
var b=o.getLocationCategory();a.gridLabel={},a.filterLabel={},j.isFieldEmpty(b)?(a.titleLabel=h.instant("ORGANIZATION_CLIENT_LIST"),a.gridLabel.user=h.instant("USER"),a.gridLabel.userID=h.instant("CLIENT_ID"),a.filterLabel.activeUser=h.instant("ACTIVE_CLIENT")):"EDUCATIONAL_INSTITUTION"==b.code?(a.titleLabel=h.instant("ORGANIZATION_STUDENT_LIST"),a.gridLabel.user=h.instant("STUDENT"),a.gridLabel.userID=h.instant("STUDENT_ID"),a.filterLabel.activeUser=h.instant("ACTIVE_STUDENT")):"CORPORATE"==b.code?(a.titleLabel=h.instant("ORGANIZATION_EMPLOYEE_LIST"),a.gridLabel.user=h.instant("EMPLOYEE"),a.gridLabel.userID=h.instant("EMPLOYEE_ID"),a.filterLabel.activeUser=h.instant("ACTIVE_EMPLOYEE")):"SERVICE_PROVIDER"==b.code&&(a.titleLabel=h.instant("ORGANIZATION_CLIENT_LIST"),a.gridLabel.user=h.instant("USER"),a.gridLabel.userID=h.instant("CLIENT_ID"),a.filterLabel.activeUser=h.instant("ACTIVE_CLIENT"))},a.init()}]),angular.module("paripal.messagingModule").controller("CustomizeMsgGroupUserCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","customizeMsgGroupUserService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSMsgGroupUsers=[],a.groupUserType=[],a.msgGroupUserSpinner=!1,a.selected=[],a.exists=function(a,b){return b.indexOf(a.userId)>-1},a.toggle=function(b,c){var d=c.indexOf(b.userId);d>-1?c.splice(d,1):c.push(b.userId),a.selected=c},
//Search messaging group user list
a.searchMessageGroupUsers=function(){a.msgGroupUserSpinner=!0,a.WSMsgGroupUsers=[],a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,c.msgGroupId&&(a.searchCriteria.groupId=c.msgGroupId,a.searchCriteria.adhocMsgEventConfigId=c.adhocMsgEventConfigId,m.searchMessageGroupUsers(a.searchCriteria,function(b){a.msgGroupUserSpinner=!1,a.WSMsgGroupUsers=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.msgGroupUserSpinner=!1}))},a.activateMsgGroupUser=function(b,d){a.selected&&a.selected.length>0?c.adhocMsgGroupId&&m.activateMsgGroupUser(c.adhocMsgGroupId,a.selected,function(b){f("success",g.instant("RECORD_ACTIVATE_SUCCESS")),/*var confirm = $mdDialog.confirm()
						.title($translate.instant("WARNING"))
						.textContent($translate.instant("ACTIVE_INACTIVE_CONFIRM_MESSAGE"))
						.targetEvent(ev)
						.ok($translate.instant("YES"))
						.cancel($translate.instant("NO"));
						$mdDialog.show().then(function () {
							$scope.selected = [];
							$scope.searchMessageGroupUsers();
						}, function () {
							$state.go("showAdhocMessageRecipient", {
								type: $stateParams.type,
								adhocMsgEventConfigId: $stateParams.adhocMsgEventConfigId,
								displayCode: $stateParams.displayCode
							});
						});*/
a.selected=[],a.searchMessageGroupUsers()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))}):f("warning",g.instant("SELECT_USER_MANDATORY"))},a.inActivateMsgGroupUser=function(b,d){a.selected&&a.selected.length>0?c.adhocMsgGroupId&&m.inActivateMsgGroupUser(c.adhocMsgGroupId,a.selected,function(b){f("success",g.instant("RECORD_INACTIVATE_SUCCESS")),/*		var confirm = $mdDialog.confirm()
						.title($translate.instant("WARNING"))
						.textContent($translate.instant("ACTIVE_INACTIVE_CONFIRM_MESSAGE"))
						.targetEvent(ev)
						.ok($translate.instant("YES"))
						.cancel($translate.instant("NO"));*/
/*$mdDialog.show().then(function () {
							$scope.selected = [];
							$scope.searchMessageGroupUsers();
						}, function () {
							$state.go("showAdhocMessageRecipient", {
								type: $stateParams.type,
								adhocMsgEventConfigId: $stateParams.adhocMsgEventConfigId,
								displayCode: $stateParams.displayCode
							});
						});*/
a.selected=[],a.searchMessageGroupUsers()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))}):f("warning",g.instant("SELECT_USER_MANDATORY"))},a.moveToPreviousStep=function(){d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode})},
//Fetch records
a.fetchRecords=function(){a.searchMessageGroupUsers()},
//clear search
a.clear=function(){a.searchCriteria={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchMessageGroupUsers()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchMessageGroupUsers()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(n),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){"add"===c.type?a.pageState="add":"edit"===c.type?a.pageState="edit":"view"===c.type&&(a.pageState="view"),c.displayCode&&c.groupName&&c.msgGroupId&&c.adhocMsgGroupId&&c.adhocMsgEventConfigId?(a.groupName=c.groupName,a.searchMessageGroupUsers()):d.go("adhocMessages")},a.init()}]),angular.module("paripal.messagingModule").controller("EventConfCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messageEventListService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(a,b,c,d,e){a.eventConfig=c,a.messageEventListService=d,/*if( config.sponsorCanOverride == false && config.autoSubscribe  == false){
            	$scope.whetherSelected = false;
            }*/
a.hide=function(){b.hide()},a.save=function(){var b={};b.id=a.eventConfig.msgEventSettingId,b.sponsorCanOverride=a.eventConfig.sponsorCanOverride,b.autoSubscribe=a.eventConfig.autoSubscribe,d.saveEventConfig(b,function(a){f("success",g.instant("RECORD_EDITED_SUCESS"))},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))}),a.ok()},a.ok=function(){b.cancel()}}o.$inject=["scope","$mdDialog","eventConfig","messageEventListService","parentScope"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},/*$scope.whetherSelected = true;*/
a.category={},a.subCategory={},a.wsMsgEventSearchCriteria={},a.WSEventList=[],a.mangeProfTreatmentSpinner=!1,
//Search User Address
a.searchEvents=function(){a.mangeProfTreatmentSpinner=!0,a.wsMsgEventSearchCriteria.pageNumber=a.currentPage,a.wsMsgEventSearchCriteria.recordsPerPage=a.itemPerPage,a.category.data&&a.category.data.id&&(a.wsMsgEventSearchCriteria.categoryId=a.category.data.id),a.subCategory.data&&a.subCategory.data.id&&(a.wsMsgEventSearchCriteria.subCategoryId=a.subCategory.data.id),m.searchEvents(a.wsMsgEventSearchCriteria,function(b){a.roleListSpinner=!1,a.WSEventList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.roleListSpinner=!1,f("error",g.instant("RECORD_NOT_FOUND"))})},a.fetchTemplates=function(b,c){m.fetchTemplates(b,function(a){d.go("manageTemplate",{msgEventConfigId:b,cat:c.msgCategory.msgCategory.code.value,subCat:c.msgCategory.code.value,event:c.eventName,templateList:a.data})},function(b){a.roleListSpinner=!1,f("error",g.instant("RECORD_NOT_FOUND"))})},a.inactivate=function(b){m.inactivate(b,function(b){a.searchEvents()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},
//Fetch records
a.fetchRecords=function(){a.searchEvents()},
//clear search
a.clear=function(){a.wsMsgEventSearchCriteria={},a.category={},a.subCategory={},a.WSMsgCategory={},a.searchEvents()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchEvents()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchEvents()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.searchEvents()},a.init(),a.msgEventConfig=function(b){var c={eventConfig:b,messageEventListService:m,parentScope:a};a.showModal(o,"app/modules/messaging/views/message_event_settings.html",c)},a.showModal=function(a,b,c){var d;h.show({controller:o,templateUrl:b,parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:n.dialogBox.clickOutsideToClose,locals:c}).then(function(){c.parentScope.init()},function(){c.parentScope.init()})}}]),angular.module("paripal.messagingModule").controller("EventOverrideConfCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messageEventOverrideListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.category={},a.subCategory={},a.filterCriteria={},a.wsMsgEventSearchCriteria={},a.WSEventList=[],a.roleListSpinner=!1;var n={};
//Search User Address
a.searchEvents=function(){a.roleListSpinner=!0,a.wsMsgEventSearchCriteria.pageNumber=a.currentPage,a.wsMsgEventSearchCriteria.recordsPerPage=a.itemPerPage,a.category.data&&a.category.data.id&&(a.wsMsgEventSearchCriteria.categoryId=a.category.data.id),a.subCategory.data&&a.subCategory.data.id&&(a.wsMsgEventSearchCriteria.subCategoryId=a.subCategory.data.id),m.searchEvents(a.wsMsgEventSearchCriteria,n,function(b){a.roleListSpinner=!1,a.WSEventList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.roleListSpinner=!1,f("error",g.instant("RECORD_NOT_FOUND"))})},a.fetchTemplates=function(b,c){m.fetchTemplates(b,n.id,function(a){d.go("manageTemplateOverride",{msgEventConfigId:b,cat:c.msgCategory.msgCategory.code.value,subCat:c.msgCategory.code.value,event:c.eventName,templateList:a,orgLoc:n,orgLocId:n.id})},function(b){a.roleListSpinner=!1,f("error",g.instant("RECORD_NOT_FOUND"))})},a.inactivate=function(b){m.inactivate(b,function(b){a.searchEvents()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},
//Fetch records
a.fetchRecords=function(){a.searchEvents()},
//clear search
a.clear=function(){a.WSMsgCategory={},a.category={},a.subCategory={},a.filterCriteria.orgLoc={},a.WSEventList=null,a.totalItems=null,a.pagingInfo={},a.wsMsgEventSearchCriteria={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchEvents()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchEvents()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){},a.init(),a.selectedOrgLoc=function(a){angular.copy(a.data,n)},a.override=function(b){m.override(b,n.id,function(b){f("success",g.instant("OVERRIDDEN_SUCCESS")),a.searchEvents()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a["default"]=function(b){m["default"](b,n.id,function(b){a.searchEvents()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.activate=function(b){m.activate(b,n.id,function(b){a.searchEvents()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.inactivate=function(b){m.inactivate(b,n.id,function(b){a.searchEvents()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})}}]),angular.module("paripal.messagingModule").controller("ManageAdhocMessageCtrl",["$scope","$rootScope","$stateParams","$state","$mdMedia","fileReader","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","fileOperations","commonConstants","applicationExceptionService","manageAdhocMessageService","messageEventListService","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";/*for (name  in  CKEDITOR.instances) {
            CKEDITOR.instances[name].destroy();
        }*/
CKEDITOR.editorConfig=function(a){a.language="en",a.uiColor="#F7B42C",a.height=300,a.toolbarCanCollapse=!0},a.dynamicData=[],a.tabIndexNumber=[],a.isMsgContent=!1,a.msgDeliveryMode=[],a.WSAdhocMessage={},a.WSAdhocMessage.id=null,a.WSAdhocMessage.organizationLocation={},a.WSAdhocMessage.version=null,a.WSAdhocMessage.msgCategory={},a.WSAdhocMessage.msgSubCategory={},a.WSAdhocMessage.whetherScheduled=!1,a.WSAdhocMessage.msgTemplateConfig={},a.WSAdhocMessage.adhocMsgDynamicAttachments=[],
//$scope.WSAdhocMessage.eventAttachments = [];
a.WSAdhocMessage.status={},a.email={},a.email.id=null,a.email.msgDeliveryMode={},a.email.subjectLine=null,a.email.msgContent=null,a.email.languageId=b.userSelectedLanguage.id,a.sms={},a.sms.id=null,a.sms.msgDeliveryMode={},a.sms.msgContent=null,a.sms.languageId=b.userSelectedLanguage.id,a.notification={},a.notification.id=null,a.notification.subjectLine=null,a.notification.msgDeliveryMode={},a.notification.msgContent=null,a.notification.languageId=b.userSelectedLanguage.id,a.selectedFileArray=[],a.whetherImmediate=!0,a.isSubCategoryDisabled=!0,a.disabledFormFields=!1,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},/*$scope.msgCategory = {
            queryUrl: "FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",
            queryParameter: {},
            jsonParameter: {}
        };*/
a.$watch("WSAdhocMessage.organizationLocation",function(b,c){b&&b.id?(a.msgCategory={queryUrl:"FIND_CUSTOM_MSG_CATEGORY_BY_ORG_LOCATION_ID",queryParameter:{organizationLocationId:b.id},jsonParameter:{}},a.$broadcast("loadWSAdhocMessageMsgCategory",a.msgCategory),a.isCategoryDisabled=!1,a.isSubCategoryDisabled=!1):(a.isCategoryDisabled=!0,a.isSubCategoryDisabled=!0,a.WSAdhocMessage.msgCategory={},a.WSAdhocMessage.msgSubCategory={})},!0),a.$watch("WSAdhocMessage.msgCategory",function(b,c){b&&b.id?(a.msgSubCategory={queryUrl:"FIND_ALL_ADHOC_ACTIVE_SUB_CATEGORY_BY_CATEGORY_ID",queryParameter:{msgCategoryId:b.id},jsonParameter:{}},a.$broadcast("loadWSAdhocMessageMsgSubCategory",a.msgSubCategory),a.isSubCategoryDisabled=!1):(a.isSubCategoryDisabled=!0,a.WSAdhocMessage.msgSubCategory={})},!0),a.$watch("WSAdhocMessage.whetherScheduled",function(b,c){b?a.whetherImmediate=!1:(a.whetherImmediate=!0,a.WSAdhocMessage.msgDueDate=null,a.WSAdhocMessage.msgDueTime=null)},!0),a.$watch("email.msgContent",function(b,c){m.isNullOrEmpty(a.email.msgContent)?a.isEmailContent=!1:a.isEmailContent=!0},!0),a.$watch("notification.msgContent",function(b,c){m.isNullOrEmpty(a.notification.msgContent)?a.isNotificationContent=!1:a.isNotificationContent=!0},!0),a.onSubjectFocus=function(){a.isMsgContent=!1},a.fetchDynamicData=function(){q.getUserRecipientType(function(b){b&&b.id&&r.fetchDynamicData(0,b.id,function(b){a.dynamicData=b,"add"===c.type?(a.pageState="add",c.adhocMsgEventConfigId&&(a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId))):"edit"===c.type?(a.pageState="edit",a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId)):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0,a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId))},function(a){})},function(a){})},a.onTabChanges=function(b){a.tabIndexNumber=b},a.dataChanged=function(b){a.data=b};/*$scope.data ={
                id: 5,
                value: "Test",
                code: "Test"
        };*/
var t;// A variable to store a reference to the current editor.
CKEDITOR.on("currentInstance",function(){t=CKEDITOR.currentInstance,a.isMsgContent=!0}),a.addDynamicData=function(){if(m.isNullOrEmpty(a.data))g("warning",h.instant("PLEASE_SELECT_DYNAMIC_DATA_FIRST"));else/*if ($scope.tabIndexNumber === 0 || $scope.tabIndexNumber === 2) {

                }*/
if(a.isMsgContent&&a.data)if(t&&t.document){var b="<span> `"+a.data.value+"` </span>",c=CKEDITOR.dom.element.createFromHtml(b,t.document);t.insertElement(c),t.focus()}else g("warning",h.instant("PLEASE_FOCUS_EDITOR_AREA"));else!a.isMsgContent&&a.data&&0===a.tabIndexNumber?m.isNullOrEmpty(a.email.subjectLine)?a.email.subjectLine=" `"+a.data.value:a.email.subjectLine=a.email.subjectLine+" `"+a.data.value+"` ":!a.isMsgContent&&a.data&&2===a.tabIndexNumber?m.isNullOrEmpty(a.notification.subjectLine)?a.notification.subjectLine=" `"+a.data.value:a.notification.subjectLine=a.notification.subjectLine+" `"+a.data.value+"` ":!a.isMsgContent&&a.data&&1===a.tabIndexNumber&&(m.isNullOrEmpty(a.sms.msgContent)?a.sms.msgContent=" `"+a.data.value:a.sms.msgContent=a.sms.msgContent+" `"+a.data.value+"` ")},a.getConvertedMsgContent=function(a,b){var c=a.split(/[``]/);if(c.length>0)for(var d=0;d<c.length;d++)for(var e=0;e<b.length;e++)if(c[d]==b[e].value){var f="`"+b[e].code+"`",g="`"+b[e].value+"`";a=a.replace(new RegExp(g,"g"),f)}return a},a.saveAdhocMessageForm=function(b){if(b.$valid)if(m.isNullOrEmpty(a.email.msgContent)&&m.isNullOrEmpty(a.sms.msgContent)&&m.isNullOrEmpty(a.notification.msgContent))g("warning",h.instant("PLEASE_ADD_ATLEAST_ONE_DELIVERY_MODE"));else{if(!m.isNullOrEmpty(a.email.subjectLine)&&m.isNullOrEmpty(a.email.msgContent))return void g("warning",h.instant("PLEASE_ADD_EMAIL_MESSAGE_CONTENT"));if(!m.isNullOrEmpty(a.notification.subjectLine)&&m.isNullOrEmpty(a.notification.msgContent))return void g("warning",h.instant("PLEASE_ADD_NOTIFICATION_MESSAGE_CONTENT"));var d=angular.copy(a.email),e=angular.copy(a.sms),f=angular.copy(a.notification);m.isEmpty(d.subjectLine)||(d.subjectLine=a.getConvertedMsgContent(d.subjectLine,a.dynamicData)),m.isEmpty(d.msgContent)||(d.msgContent=a.getConvertedMsgContent(d.msgContent,a.dynamicData)),m.isEmpty(e.msgContent)||(e.msgContent=a.getConvertedMsgContent(e.msgContent,a.dynamicData)),m.isEmpty(f.subjectLine)||(f.subjectLine=a.getConvertedMsgContent(f.subjectLine,a.dynamicData)),m.isEmpty(f.msgContent)||(f.msgContent=a.getConvertedMsgContent(f.msgContent,a.dynamicData));var i="",k="";if(!m.isNullOrEmpty(a.WSAdhocMessage.msgDueTime)){var l=new Date(a.WSAdhocMessage.msgDueTime);i=l.getHours()+":"+l.getMinutes()+":"+l.getSeconds()}if(m.isNullOrEmpty(a.WSAdhocMessage.msgDueDate)||(k=j.convertToServerDate(a.WSAdhocMessage.msgDueDate),k=k+" "+i),a.WSAdhocMessage.whetherScheduled&&!m.isNullOrEmpty(k)&&Date.parse(k)<new Date)return void g("warning",h.instant("PLEASE_ENTER_DATE_MORE_THAN_CURRENT_DATE_TIME"));a.WSAdhocMessage.whetherScheduled&&(a.WSAdhocMessage.scheduledDateTime=k),a.WSAdhocMessage.email=d,a.WSAdhocMessage.sms=e,a.WSAdhocMessage.notification=f,a.isIndividualUserMode&&(a.WSAdhocMessage.displayCode=a.loggedInUser.displayName+" "+(new Date).getTime(),m.isFieldEmpty(a.WSAdhocMessage.organizationLocation)||(a.WSAdhocMessage.displayCode=a.WSAdhocMessage.displayCode+" "+a.WSAdhocMessage.organizationLocation.value),a.WSAdhocMessage.msgSubCategory=a.msgSubCategoryId,a.WSAdhocMessage.whetherScheduled=!1),a.adhocMessageFormSpinner=!0,q.saveAdhocMessageForm(a.WSAdhocMessage,c.type,function(c){a.adhocMessageFormSpinner=!1,a.selectedFileArray&&a.selectedFileArray.length>0?a.saveDocumentIdInDocumentTable(b,c,a.WSAdhocMessage.organizationLocation.id):a.showSuccessMessageOnFormSave(c)},function(b){a.adhocMessageFormSpinner=!1,!m.isEmpty(b.data)&&b.data.messages.length>0&&!m.isEmpty(b.data.messages[0])?g("error",h.instant(b.data.messages[0])):g("error",h.instant("FAILED_TO_SAVE_RECORD"))})}},a.showSuccessMessageOnFormSave=function(b){"add"===c.type?(g("success",h.instant("ADHOC_MESSAGE_ADDED_SUCCESSFULLY")),d.go("showAdhocMessageRecipient",{type:"edit",organizationLocation:a.WSAdhocMessage.organizationLocation,adhocMsgEventConfigId:b,displayCode:a.WSAdhocMessage.displayCode,isIndividualUserMode:a.isIndividualUserMode})):(g("success",h.instant("ADHOC_MESSAGE_UPDATED_SUCCESSFULLY")),a.getAdhocMessageDetails(b,c.type),b&&a.fetchAttachmentList(b))},a.saveDocumentIdInDocumentTable=function(b,c,e){if(a.selectedFileArray&&a.selectedFileArray.length>0){var f={};f.documentType={},f.documentType.type=o.documentTypes.messaging,f.documentType.subType=o.documentSubTypes.adhocMsgTemplate,a.fileUploadSpinner=!0,n.saveAllDocuments(f,!1,a.selectedFileArray,function(b){a.fileUploadSpinner=!1,a.selectedFileArray&&a.selectedFileArray.length>0&&b?a.uploadFile(a.selectedFileArray,f,b,c,e):a.showSuccessMessageOnFormSave(c)},function(){a.fileUploadSpinner=!1,d.go("adhocMessages")})}},a.uploadFile=function(b,c,e,f,i){var j=new Object;j.docType=c.documentType.type,j.docSubType=c.documentType.subType,j.recordId=f,// add templateConfigId
e.response&&(j.resourceDetails=JSON.stringify(e.response)),a.fileUploadSpinner=!0,n.uploadMultipleFiles(j,b,function(b){a.fileUploadSpinner=!1,a.saveDocumentIdsWithAdhocMessage(e,f,i)},function(b){a.fileUploadSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING")),d.go("adhocMessages")})},a.saveDocumentIdsWithAdhocMessage=function(b,c,e){if(b){for(var f=b.response,i=new Array,j=0;j<f.length;j++){var k={};k.documentId=f[j].id,k.orgLocId=e,k.fileName=f[j].value,k.msgEventConfig={},k.msgEventConfig.id=c,k.documentSubType="ADHOC_MSG_TEMPLATE",i.push(k)}a.adhocMessageFormSpinner=!0,r.uploadFiles(i,function(b){a.adhocMessageFormSpinner=!1,a.showSuccessMessageOnFormSave(c)},function(b){d.go("adhocMessages"),a.adhocMessageFormSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING"))})}},a.moveToAddRecipientForm=function(){d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:a.WSAdhocMessage.organizationLocation,adhocMsgEventConfigId:a.WSAdhocMessage.id,displayCode:a.WSAdhocMessage.displayCode})},a.getMsgDeliveryMode=function(){q.getMsgDeliveryMode(function(b){a.msgDeliveryMode=b;for(var c=0;c<a.msgDeliveryMode.length;c++)"EMAIL"===a.msgDeliveryMode[c].code?a.email.msgDeliveryMode=a.msgDeliveryMode[c]:"SMS"===a.msgDeliveryMode[c].code?a.sms.msgDeliveryMode=a.msgDeliveryMode[c]:"NOTIFICATION"===a.msgDeliveryMode[c].code&&(a.notification.msgDeliveryMode=a.msgDeliveryMode[c])},function(a){})},a.getAdhocMessageDetails=function(b,c){a.adhocMessageFormSpinner=!0,m.isNullOrEmpty(b)||q.getAdhocMessageDetails(b,function(b){a.adhocMessageFormSpinner=!1,a.setDataToAdhocMsgForm(b)},function(a){g("error",h.instant("FAILED_TO_LOAD_RECORD"))})},a.fetchAttachmentList=function(b){r.fetchAttachmentList(b,null,function(c){a.selectedFileArray=c,angular.forEach(a.selectedFileArray,function(c){c.documentType=o.documentTypes.messaging,c.documentSubType=o.documentSubTypes.adhocMsgTemplate,c.recordId=b,c.deleteCallBack=function(b){a.deleteFile(b)}})},function(a){})},a.deleteFile=function(a){r.deleteFile(a,function(a){g("success",h.instant("RECORD_DELETED_SUCCESSFULLY"))},function(a){})},a.setDataToAdhocMsgForm=function(b){if(!m.isEmpty(b)&&(a.WSAdhocMessage.id=b.id,a.WSAdhocMessage.displayCode=b.displayCode,a.WSAdhocMessage.msgCategory=b.msgCategoryId,a.WSAdhocMessage.msgSubCategory=b.msgSubCategory,a.organizationLocationModel={id:b.orgLocId},b.msgDueDate&&(a.WSAdhocMessage.msgDueDate=i("timestampToDate")(b.msgDueDate,"MM/dd/yyyy"),a.WSAdhocMessage.msgDueTime=b.msgDueDate),a.WSAdhocMessage.whetherScheduled=b.whetherScheduled,a.WSAdhocMessage.status=b.status,a.WSAdhocMessage.adhocMsgDynamicAttachments=b.adhocMsgDynamicAttachments,a.WSAdhocMessage.organizationLocation={id:b.orgLocId,value:b.orgLocationName},b.msgTemplateConfig)){a.WSAdhocMessage.msgTemplateConfig={id:b.msgTemplateConfig.id};var c=b.msgTemplateConfig.messageTemplates;if(c.length>0)for(var d=0;d<c.length;d++)"EMAIL"===c[d].msgDeliveryMode.code?(a.email.id=c[d].id,a.email.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].subjectLine)||(a.email.subjectLine=a.setDataMsgContent(c[d].subjectLine,a.dynamicData),a.email.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),a.email.languageId=c[d].languageId):"SMS"===c[d].msgDeliveryMode.code?(a.sms.id=c[d].id,a.sms.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].msgContent)||(a.sms.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),a.sms.languageId=c[d].languageId):"NOTIFICATION"===c[d].msgDeliveryMode.code&&(a.notification.id=c[d].id,a.notification.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].msgContent)||(a.notification.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),m.isNullOrEmpty(c[d].subjectLine)||(a.notification.subjectLine=a.setDataMsgContent(c[d].subjectLine,a.dynamicData)),a.notification.languageId=c[d].languageId)}},a.setDataMsgContent=function(a,b){var c=a.split(/[``]/);if(c.length>0)for(var d=0;d<c.length;d++)for(var e=0;e<b.length;e++)if(c[d]==b[e].code){var f="`"+b[e].code+"`",g="`"+b[e].value+"`";a=a.replace(new RegExp(f,"g"),g)}return a},
// on cancel forward to search list
a.cancelAdhocMessageForm=function(){m.goBackToPrevState()},a.getCatagoryIdByCode=function(){q.getSubCatagoryByCode("INDIVIDUAL_USER_MSG",function(b){a.msgSubCategoryId={id:b.data.subCategoryId}},function(a){})},
//Init Method
a.init=function(){if(/*for(name in CKEDITOR.instances)
                    CKEDITOR.instances[name].destroy();*/
a.loggedInUser=angular.fromJson(localStorage.getItem("loggedInUser")),m.isFieldEmpty(c.isIndividualUser)||a.loggedInUser.isOrganizationUserMode?1!=a.loggedInUser.whetherSubscriber||a.loggedInUser.isOrganizationUserMode||(a.isIndividualUserMode=!0):a.isIndividualUserMode=!0,a.minDate=new Date,a.getMsgDeliveryMode(),a.fetchDynamicData(),a.getCatagoryIdByCode(),"add"===c.type){var b=s.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.WSAdhocMessage.organizationLocation=b.orgLoc)}},a.init()}]),angular.module("paripal.messagingModule").controller("ManageCategoryCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","manageCategoryService","featurePrivilegeConstants","listData","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.WSMsgCategory={},a.WSMsgCategory.whetherAdhoc=!0,a.orgLoc={},a.listData=p,a.addPermission=o.MSG_CATEGORY_ADD,a.saveCategory=function(){n.saveCategory(a.WSMsgCategory,a.orgLoc,a.parentCategory,p,function(a){"sub"===p.catType?g("success",h.instant("SUB_CATEGORY_ADDED_SUCCESSFULLY")):g("success",h.instant("CATEGORY_ADDED_SUCCESSFULLY")),e.cancel(),p.parentScope.fetchRecords()},function(a){a.data&&a.data.errorCode?g("warning",h.instant(a.data.errorCode)):g("error",h.instant("FAILED_TO_SAVE_RECORD"))})},
// on cancel forward to search list
a.cancel=function(){e.cancel()},a.hide=function(){e.hide()},
//Init Method
a.init=function(){if("sub"===p.catType&&"add"===p.type&&(a.WSMsgCategory.msgCategory=p.category),"parent"===p.catType&&"add"===p.type&&(a.WSMsgCategory=p.category),"add"===p.type){var b=q.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.orgLoc={data:b.orgLoc})}},a.init()}]),angular.module("paripal.messagingModule").controller("ManageMsgGroupCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","applicationExceptionService","manageMsgGroupService","stateParams","parentScope","featurePrivilegeConstants","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.featurePrivilegeConstantValue=s.MSG_GROUP_VIEW,c=q,a.WSMsgGroup={},a.version=null,a.WSMsgGroup.name=null,
//$scope.WSMsgGroup.whetherAvailableForServiceProvider = true;
a.WSMsgGroup.whetherCustomizable=!1,a.WSMsgGroup.organizationLocation={},a.WSMsgGroup.groupType={},a.isDynamicView=!1,a.disabledFormFields=!1,a.groupType={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"groupType"},jsonParameter:{}},a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.$watch("WSMsgGroup.groupType",function(b,c){b&&b.id&&("STATIC/SPECIFIC"===b.code?a.isDynamicView=!1:(a.isDynamicView=!0,a.WSMsgGroup.whetherCustomizable=!1))},!0),
// Add/update follow up EXCEPTION
a.saveMsgGroup=function(b){b.$valid&&p.saveMsgGroup(a.WSMsgGroup,c.type,function(a){"add"===c.type?h("success",i.instant("MESSAGE_GROUP_CREATED_SUCCESSFULLY")):h("success",i.instant("MESSAGE_GROUP_UPDATED_SUCCESSFULLY")),e.cancel(),r.searchMessageGroups()},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?h("error",i.instant("FAILED_TO_SAVE_RECORD")):h("error",i.instant(a.data.messages[0]))})},a.getMsgGroupDetails=function(b,c){n.isNullOrEmpty(b)||p.getMsgGroupDetails(b,function(b){a.setDataToMsgGroupForm(b)},function(a){h("error",i.instant("FAILED_TO_LOAD_RECORD"))})},a.setDataToMsgGroupForm=function(b){n.isEmpty(b)||(a.WSMsgGroup=b,b.creatingOrgLocId&&b.orgLocationName&&(a.WSMsgGroup.organizationLocation={id:b.creatingOrgLocId,value:b.orgLocationName}))},
// on cancel forward to search list
a.cancelMesgGroupForm=function(){e.cancel()},a.hide=function(){e.hide()},
//Init Method
a.init=function(){if("add"===c.type){a.pageState="add";var b=t.getDefaultOrgLocation();n.isFieldEmpty(b)||(a.WSMsgGroup.organizationLocation=b.orgLoc)}else"edit"===c.type?(a.pageState="edit",a.isEdit=!0,a.getMsgGroupDetails(c.msgGroupId,c.type)):"view"===c.type&&(a.showTotalClients=!0,a.pageState="view",a.disabledFormFields=!0,a.getMsgGroupDetails(c.msgGroupId,c.type))},a.init()}]),angular.module("paripal.messagingModule").controller("ManageQuickAdhocMsgCtrl",["$scope","$rootScope","$stateParams","$state","$mdMedia","fileReader","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","fileOperations","commonConstants","applicationExceptionService","manageAdhocMessageService","messageEventListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";/*for (name  in  CKEDITOR.instances) {
            CKEDITOR.instances[name].destroy();
        }*/
CKEDITOR.editorConfig=function(a){a.language="en",a.uiColor="#F7B42C",a.height=300,a.toolbarCanCollapse=!0},a.dynamicData=[],a.tabIndexNumber=[],a.isMsgContent=!1,a.msgDeliveryMode=[],a.WSAdhocMessage={},a.WSAdhocMessage.id=null,a.WSAdhocMessage.organizationLocation={},a.WSAdhocMessage.version=null,a.WSAdhocMessage.msgCategory={},a.WSAdhocMessage.msgSubCategory={},a.WSAdhocMessage.whetherScheduled=!1,a.WSAdhocMessage.msgTemplateConfig={},a.WSAdhocMessage.adhocMsgDynamicAttachments=[],
//$scope.WSAdhocMessage.eventAttachments = [];
a.WSAdhocMessage.status={},a.email={},a.email.id=null,a.email.msgDeliveryMode={},a.email.subjectLine=null,a.email.msgContent=null,a.email.languageId=b.userSelectedLanguage.id,a.sms={},a.sms.id=null,a.sms.msgDeliveryMode={},a.sms.msgContent=null,a.sms.languageId=b.userSelectedLanguage.id,a.notification={},a.notification.id=null,a.notification.subjectLine=null,a.notification.msgDeliveryMode={},a.notification.msgContent=null,a.notification.languageId=b.userSelectedLanguage.id,a.selectedFileArray=[],a.whetherImmediate=!0,a.isSubCategoryDisabled=!0,a.disabledFormFields=!1,a.pageCount=1,a.msgLength=0,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},/*$scope.msgCategory = {
            queryUrl: "FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",
            queryParameter: {},
            jsonParameter: {}
        };*/
a.$watch("sms.msgContent",function(b,c){a.sms.msgContent?a.msgLength=a.sms.msgContent.length:a.msgLength=0,a.pageCount=parseInt(a.msgLength/141)+1}),a.$watch("WSAdhocMessage.organizationLocation",function(b,c){b&&b.id?(a.msgCategory={queryUrl:"FIND_CUSTOM_MSG_CATEGORY_BY_ORG_LOCATION_ID",queryParameter:{organizationLocationId:b.id},jsonParameter:{}},a.$broadcast("loadWSAdhocMessageMsgCategory",a.msgCategory),a.isCategoryDisabled=!1,a.isSubCategoryDisabled=!1):(a.isCategoryDisabled=!0,a.isSubCategoryDisabled=!0,a.WSAdhocMessage.msgCategory={},a.WSAdhocMessage.msgSubCategory={})},!0),a.$watch("WSAdhocMessage.msgCategory",function(b,c){b&&b.id?(a.msgSubCategory={queryUrl:"FIND_ALL_ADHOC_ACTIVE_SUB_CATEGORY_BY_CATEGORY_ID",queryParameter:{msgCategoryId:b.id},jsonParameter:{}},a.$broadcast("loadWSAdhocMessageMsgSubCategory",a.msgSubCategory),a.isSubCategoryDisabled=!1):(a.isSubCategoryDisabled=!0,a.WSAdhocMessage.msgSubCategory={})},!0),a.$watch("WSAdhocMessage.whetherScheduled",function(b,c){b?a.whetherImmediate=!1:(a.whetherImmediate=!0,a.WSAdhocMessage.msgDueDate=null,a.WSAdhocMessage.msgDueTime=null)},!0),a.$watch("email.msgContent",function(b,c){m.isNullOrEmpty(a.email.msgContent)?a.isEmailContent=!1:a.isEmailContent=!0},!0),a.$watch("notification.msgContent",function(b,c){m.isNullOrEmpty(a.notification.msgContent)?a.isNotificationContent=!1:a.isNotificationContent=!0},!0),a.onSubjectFocus=function(){a.isMsgContent=!1},a.fetchDynamicData=function(){q.getUserRecipientType(function(b){b&&b.id&&r.fetchDynamicData(0,b.id,function(b){a.dynamicData=b,"add"===c.type?(a.pageState="add",c.adhocMsgEventConfigId&&(a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId))):"edit"===c.type?(a.pageState="edit",a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId)):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0,a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId))},function(a){})},function(a){})},a.onTabChanges=function(b){a.tabIndexNumber=b},a.dataChanged=function(b){a.data=b};/*$scope.data ={
                id: 5,
                value: "Test",
                code: "Test"
        };*/
var s;// A variable to store a reference to the current editor.
CKEDITOR.on("currentInstance",function(){s=CKEDITOR.currentInstance,a.isMsgContent=!0}),a.addDynamicData=function(){if(m.isNullOrEmpty(a.data))g("warning",h.instant("PLEASE_SELECT_DYNAMIC_DATA_FIRST"));else/*if ($scope.tabIndexNumber === 0 || $scope.tabIndexNumber === 2) {

                }*/
if(a.isMsgContent&&a.data)if(s&&s.document){var b="<span> `"+a.data.value+"` </span>",c=CKEDITOR.dom.element.createFromHtml(b,s.document);s.insertElement(c),s.focus()}else g("warning",h.instant("PLEASE_FOCUS_EDITOR_AREA"));else!a.isMsgContent&&a.data&&0===a.tabIndexNumber?m.isNullOrEmpty(a.email.subjectLine)?a.email.subjectLine=" `"+a.data.value:a.email.subjectLine=a.email.subjectLine+" `"+a.data.value+"` ":!a.isMsgContent&&a.data&&2===a.tabIndexNumber?m.isNullOrEmpty(a.notification.subjectLine)?a.notification.subjectLine=" `"+a.data.value:a.notification.subjectLine=a.notification.subjectLine+" `"+a.data.value+"` ":!a.isMsgContent&&a.data&&1===a.tabIndexNumber&&(m.isNullOrEmpty(a.sms.msgContent)?a.sms.msgContent=" `"+a.data.value:a.sms.msgContent=a.sms.msgContent+" `"+a.data.value+"` ")},a.getConvertedMsgContent=function(a,b){var c=a.split(/[``]/);if(c.length>0)for(var d=0;d<c.length;d++)for(var e=0;e<b.length;e++)if(c[d]==b[e].value){var f="`"+b[e].code+"`",g="`"+b[e].value+"`";a=a.replace(new RegExp(g,"g"),f)}return a},a.saveAdhocMessageForm=function(b){if(b.$valid)if(m.isNullOrEmpty(a.email.msgContent)&&m.isNullOrEmpty(a.sms.msgContent)&&m.isNullOrEmpty(a.notification.msgContent))g("warning",h.instant("PLEASE_ADD_ATLEAST_ONE_DELIVERY_MODE"));else{if(!m.isNullOrEmpty(a.email.subjectLine)&&m.isNullOrEmpty(a.email.msgContent))return void g("warning",h.instant("PLEASE_ADD_EMAIL_MESSAGE_CONTENT"));if(!m.isNullOrEmpty(a.notification.subjectLine)&&m.isNullOrEmpty(a.notification.msgContent))return void g("warning",h.instant("PLEASE_ADD_NOTIFICATION_MESSAGE_CONTENT"));var c=angular.copy(a.email),d=angular.copy(a.sms),e=angular.copy(a.notification);m.isEmpty(c.subjectLine)||(c.subjectLine=a.getConvertedMsgContent(c.subjectLine,a.dynamicData)),m.isEmpty(c.msgContent)||(c.msgContent=a.getConvertedMsgContent(c.msgContent,a.dynamicData)),m.isEmpty(d.msgContent)||(d.msgContent=a.getConvertedMsgContent(d.msgContent,a.dynamicData)),m.isEmpty(e.subjectLine)||(e.subjectLine=a.getConvertedMsgContent(e.subjectLine,a.dynamicData)),m.isEmpty(e.msgContent)||(e.msgContent=a.getConvertedMsgContent(e.msgContent,a.dynamicData));var f="",i="";if(!m.isNullOrEmpty(a.WSAdhocMessage.msgDueTime)){var k=new Date(a.WSAdhocMessage.msgDueTime);f=k.getHours()+":"+k.getMinutes()+":"+k.getSeconds()}if(m.isNullOrEmpty(a.WSAdhocMessage.msgDueDate)||(i=j.convertToServerDate(a.WSAdhocMessage.msgDueDate),i=i+" "+f),a.WSAdhocMessage.whetherScheduled&&!m.isNullOrEmpty(i)&&Date.parse(i)<new Date)return void g("warning",h.instant("PLEASE_ENTER_DATE_MORE_THAN_CURRENT_DATE_TIME"));a.WSAdhocMessage.whetherScheduled&&(a.WSAdhocMessage.scheduledDateTime=i),a.WSAdhocMessage.email=c,a.WSAdhocMessage.sms=d,a.WSAdhocMessage.notification=e,a.WSAdhocMessage.displayCode=a.loggedInUser.displayName+" "+(new Date).getTime(),m.isFieldEmpty(a.WSAdhocMessage.organizationLocation)||(a.WSAdhocMessage.displayCode=a.WSAdhocMessage.displayCode+" "+a.WSAdhocMessage.organizationLocation.value),a.WSAdhocMessage.msgSubCategory=a.msgSubCategoryId,a.WSAdhocMessage.whetherScheduled=!1,a.adhocMessageFormSpinner=!0,q.saveAdhocMessageForm(a.WSAdhocMessage,"add",function(c){a.adhocMessageFormSpinner=!1,a.selectedFileArray&&a.selectedFileArray.length>0?a.saveDocumentIdInDocumentTable(b,c,a.WSAdhocMessage.organizationLocation.id):a.showSuccessMessageOnFormSave(c)},function(b){a.adhocMessageFormSpinner=!1,!m.isEmpty(b.data)&&b.data.messages.length>0&&!m.isEmpty(b.data.messages[0])?g("error",h.instant(b.data.messages[0])):g("error",h.instant("FAILED_TO_SAVE_RECORD"))})}},a.showSuccessMessageOnFormSave=function(b){g("success",h.instant("ADHOC_MESSAGE_ADDED_SUCCESSFULLY")),"client"==c.type?(a.userCatagory="GROUP_USER_CLIENT",d.go("quickMsgClientList",{type:"edit",menuNevigate:"adhocMessage",organizationLocation:a.WSAdhocMessage.organizationLocation,adhocMsgEventConfigId:b,displayCode:a.WSAdhocMessage.displayCode,userCatagory:a.userCatagory})):(a.userCatagory="GROUP_USER_ORG",d.go("quickMsgOrgUserList",{type:"edit",menuNevigate:"adhocMessage",organizationLocation:a.WSAdhocMessage.organizationLocation,adhocMsgEventConfigId:b,displayCode:a.WSAdhocMessage.displayCode,userCatagory:a.userCatagory}))},a.saveDocumentIdInDocumentTable=function(b,c,e){if(a.selectedFileArray&&a.selectedFileArray.length>0){var f={};f.documentType={},f.documentType.type=o.documentTypes.messaging,f.documentType.subType=o.documentSubTypes.adhocMsgTemplate,a.fileUploadSpinner=!0,n.saveAllDocuments(f,!1,a.selectedFileArray,function(b){a.fileUploadSpinner=!1,a.selectedFileArray&&a.selectedFileArray.length>0&&b?a.uploadFile(a.selectedFileArray,f,b,c,e):a.showSuccessMessageOnFormSave(c)},function(){a.fileUploadSpinner=!1,d.go("adhocMessages")})}},a.uploadFile=function(b,c,e,f,i){var j=new Object;j.docType=c.documentType.type,j.docSubType=c.documentType.subType,j.recordId=f,// add templateConfigId
e.response&&(j.resourceDetails=JSON.stringify(e.response)),a.fileUploadSpinner=!0,n.uploadMultipleFiles(j,b,function(b){a.fileUploadSpinner=!1,a.saveDocumentIdsWithAdhocMessage(e,f,i)},function(b){a.fileUploadSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING")),d.go("adhocMessages")})},a.saveDocumentIdsWithAdhocMessage=function(b,c,e){if(b){for(var f=b.response,i=new Array,j=0;j<f.length;j++){var k={};k.documentId=f[j].id,k.orgLocId=e,k.fileName=f[j].value,k.msgEventConfig={},k.msgEventConfig.id=c,k.documentSubType="ADHOC_MSG_TEMPLATE",i.push(k)}a.adhocMessageFormSpinner=!0,r.uploadFiles(i,function(b){a.adhocMessageFormSpinner=!1,a.showSuccessMessageOnFormSave(c)},function(b){d.go("adhocMessages"),a.adhocMessageFormSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING"))})}},a.moveToAddRecipientForm=function(){d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:a.WSAdhocMessage.organizationLocation,adhocMsgEventConfigId:a.WSAdhocMessage.id,displayCode:a.WSAdhocMessage.displayCode})},a.getMsgDeliveryMode=function(){q.getMsgDeliveryMode(function(b){a.msgDeliveryMode=b;for(var c=0;c<a.msgDeliveryMode.length;c++)"EMAIL"===a.msgDeliveryMode[c].code?a.email.msgDeliveryMode=a.msgDeliveryMode[c]:"SMS"===a.msgDeliveryMode[c].code?a.sms.msgDeliveryMode=a.msgDeliveryMode[c]:"NOTIFICATION"===a.msgDeliveryMode[c].code&&(a.notification.msgDeliveryMode=a.msgDeliveryMode[c])},function(a){})},a.getAdhocMessageDetails=function(b,c){a.adhocMessageFormSpinner=!0,m.isNullOrEmpty(b)||q.getAdhocMessageDetails(b,function(b){a.adhocMessageFormSpinner=!1,a.setDataToAdhocMsgForm(b)},function(a){g("error",h.instant("FAILED_TO_LOAD_RECORD"))})},a.fetchAttachmentList=function(b){r.fetchAttachmentList(b,null,function(c){a.selectedFileArray=c,angular.forEach(a.selectedFileArray,function(c){c.documentType=o.documentTypes.messaging,c.documentSubType=o.documentSubTypes.adhocMsgTemplate,c.recordId=b,c.deleteCallBack=function(b){a.deleteFile(b)}})},function(a){})},a.deleteFile=function(a){r.deleteFile(a,function(a){g("success",h.instant("RECORD_DELETED_SUCCESSFULLY"))},function(a){})},a.setDataToAdhocMsgForm=function(b){if(!m.isEmpty(b)&&(a.WSAdhocMessage.id=b.id,a.WSAdhocMessage.displayCode=b.displayCode,a.WSAdhocMessage.msgCategory=b.msgCategoryId,a.WSAdhocMessage.msgSubCategory=b.msgSubCategory,a.organizationLocationModel={id:b.orgLocId},b.msgDueDate&&(a.WSAdhocMessage.msgDueDate=i("timestampToDate")(b.msgDueDate,"MM/dd/yyyy"),a.WSAdhocMessage.msgDueTime=b.msgDueDate),a.WSAdhocMessage.whetherScheduled=b.whetherScheduled,a.WSAdhocMessage.status=b.status,a.WSAdhocMessage.adhocMsgDynamicAttachments=b.adhocMsgDynamicAttachments,a.WSAdhocMessage.organizationLocation={id:b.orgLocId,value:b.orgLocationName},b.msgTemplateConfig)){a.WSAdhocMessage.msgTemplateConfig={id:b.msgTemplateConfig.id};var c=b.msgTemplateConfig.messageTemplates;if(c.length>0)for(var d=0;d<c.length;d++)"EMAIL"===c[d].msgDeliveryMode.code?(a.email.id=c[d].id,a.email.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].subjectLine)||(a.email.subjectLine=a.setDataMsgContent(c[d].subjectLine,a.dynamicData),a.email.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),a.email.languageId=c[d].languageId):"SMS"===c[d].msgDeliveryMode.code?(a.sms.id=c[d].id,a.sms.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].msgContent)||(a.sms.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),a.sms.languageId=c[d].languageId):"NOTIFICATION"===c[d].msgDeliveryMode.code&&(a.notification.id=c[d].id,a.notification.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].msgContent)||(a.notification.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),m.isNullOrEmpty(c[d].subjectLine)||(a.notification.subjectLine=a.setDataMsgContent(c[d].subjectLine,a.dynamicData)),a.notification.languageId=c[d].languageId)}},a.setDataMsgContent=function(a,b){var c=a.split(/[``]/);if(c.length>0)for(var d=0;d<c.length;d++)for(var e=0;e<b.length;e++)if(c[d]==b[e].code){var f="`"+b[e].code+"`",g="`"+b[e].value+"`";a=a.replace(new RegExp(f,"g"),g)}return a},
// on cancel forward to search list
a.cancelAdhocMessageForm=function(){m.goBackToPrevState()},a.getCatagoryIdByCode=function(){"client"==c.type?a.subCatagoryType="CLIENT_MSG":a.subCatagoryType="INTERNAL_USER_ MSG",q.getSubCatagoryByCode(a.subCatagoryType,function(b){a.msgSubCategoryId={id:b.data.subCategoryId}},function(a){})},
//Init Method
a.init=function(){/*for(name in CKEDITOR.instances)
                    CKEDITOR.instances[name].destroy();*/
a.loggedInUser=angular.fromJson(localStorage.getItem("loggedInUser")),m.isFieldEmpty(c.isIndividualUser)||a.loggedInUser.isOrganizationUserMode?1!=a.loggedInUser.whetherSubscriber||a.loggedInUser.isOrganizationUserMode||(a.isIndividualUserMode=!0):a.isIndividualUserMode=!0,a.minDate=new Date,a.getMsgDeliveryMode(),a.fetchDynamicData(),a.getCatagoryIdByCode(),localStorage.getItem("defaultOrgLoc")&&(a.WSAdhocMessage.organizationLocation=angular.fromJson(localStorage.getItem("defaultOrgLoc"))),m.isNullOrEmpty(c)||m.isNullOrEmpty(c.message)||m.isNullOrEmpty(c.sms)||(a.email.msgContent=c.message,a.sms.msgContent=c.sms,a.notification.msgContent=c.message)},a.init()}]),angular.module("paripal.messagingModule").controller("ManageTemplateCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messageEventListService","$document","otherDocumentService","fileOperations","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.category="",a.subCategory="",a.event="",a.msgEventConfigId,a.templateList=[],a.template={},a.documentUploadFile={},a.mangeProfTreatmentSpinner=!1,a.fetchTemplates=function(b){m.fetchTemplates(b,function(b){a.templateList=b},function(b){a.roleListSpinner=!1,f("error",g.instant("RECORD_NOT_FOUND"))})},a.configure=function(b){m.getTemplate(b.templateId,null,function(e){d.go("configureTemplate",{template:e,templateId:b.templateId,cat:a.category,subCat:a.subCategory,event:a.event,recipientTypeId:b.recipientTypeId,eventConfigId:c.msgEventConfigId})},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.addNewTranlation=function(b){m.getTemplate(b.templateId,null,function(e){d.go("configureTemplate",{template:e,templateId:b.templateId,cat:a.category,subCat:a.subCategory,event:a.event,recipientTypeId:b.recipientTypeId,type:"new",eventConfigId:c.msgEventConfigId})},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.dataChanged=function(){a.data},a.getTemplate=function(b,c){m.getTemplate(b,c,function(b){a.template=b},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchEvents()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchEvents()};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(r),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){c.msgEventConfigId&&(a.msgEventConfigId=c.msgEventConfigId),c.cat&&(a.category=c.cat),c.subCat&&(a.subCategory=c.subCat),c.event&&(a.event=c.event),c.template&&(a.template=c.template),c.templateList&&(a.templateList=c.templateList),c.msgEventConfigId&&!c.templateList&&a.fetchTemplates(a.msgEventConfigId)},a.init()}]),angular.module("paripal.messagingModule").controller("ManageTemplateOverrideCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messageEventOverrideListService","$document","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.category="",a.subCategory="",a.event="",a.msgEventConfigId,a.templateList=[],a.template={},a.orgLoc={},a.mangeProfTreatmentSpinner=!1,
//Search User Address
a.fetchTemplates=function(b,c){m.fetchTemplates(b,c,function(b){a.templateList=b},function(b){a.roleListSpinner=!1,f("error",g.instant("RECORD_NOT_FOUND"))})},a.configure=function(b){m.getTemplate(b.templateId,null,function(e){d.go("configureTemplateOverride",{template:e,templateId:b.templateId,cat:a.category,subCat:a.subCategory,event:a.event,overriden:b.overriden,orgLocId:c.orgLocId,recipientTypeId:b.recipientTypeId,templateConfigId:b.templateConfigId,eventConfigId:c.msgEventConfigId})},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.addNewTranlation=function(b){m.getTemplate(b.templateId,null,function(e){d.go("configureTemplateOverride",{template:e,templateId:b.templateId,cat:a.category,subCat:a.subCategory,event:a.event,overriden:b.overriden,orgLocId:c.orgLocId,recipientTypeId:b.recipientTypeId,templateConfigId:b.templateConfigId,type:"new",eventConfigId:c.msgEventConfigId})},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.dataChanged=function(){a.data},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchEvents()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchEvents()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){c.msgEventConfigId&&(a.msgEventConfigId=c.msgEventConfigId),c.cat&&(a.category=c.cat),c.subCat&&(a.subCategory=c.subCat),c.event&&(a.event=c.event),c.template&&(a.template=c.template),c.orgLoc&&(a.orgLoc=c.orgLoc),c.templateList&&(a.templateList=c.templateList),a.fetchTemplates(a.msgEventConfigId,c.orgLocId)},a.init()}]),angular.module("paripal.messagingModule").controller("MessageConversationAddCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","featurePrivilegeConstants","dateconvertor","messageConversationListService","manageAdhocMessageService","messageEventListService","commonConstants","fileOperations","adhocMessageRecipientService","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";/*for (name  in  CKEDITOR.instances) {
            CKEDITOR.instances[name].destroy();
        }*/
CKEDITOR.editorConfig=function(a){a.language="en",a.uiColor="#F7B42C",a.height=300,a.toolbarCanCollapse=!0},a.dynamicData=[],a.tabIndexNumber=[],a.isMsgContent=!1,a.msgDeliveryMode=[],a.WSAdhocMessage={},a.WSAdhocMessage.id=null,a.WSAdhocMessage.organizationLocation={},a.WSAdhocMessage.version=null,a.WSAdhocMessage.msgCategory={},a.WSAdhocMessage.msgSubCategory={},a.WSAdhocMessage.whetherScheduled=!1,a.WSAdhocMessage.msgTemplateConfig={},a.WSAdhocMessage.adhocMsgDynamicAttachments=[],
//$scope.WSAdhocMessage.eventAttachments = [];
a.WSAdhocMessage.status={},a.email={},a.email.id=null,a.email.msgDeliveryMode={},a.email.subjectLine=null,a.email.msgContent=null,a.email.languageId=b.userSelectedLanguage.id,a.sms={},a.sms.id=null,a.sms.msgDeliveryMode={},a.sms.msgContent=null,a.sms.languageId=b.userSelectedLanguage.id,a.notification={},a.notification.id=null,a.notification.subjectLine=null,a.notification.msgDeliveryMode={},a.notification.msgContent=null,a.notification.languageId=b.userSelectedLanguage.id,a.selectedFileArray=[],a.whetherImmediate=!0,a.isSubCategoryDisabled=!0,a.disabledFormFields=!1,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},/*$scope.msgCategory = {
            queryUrl: "FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",
            queryParameter: {},
            jsonParameter: {}
        };*/
a.$watch("WSAdhocMessage.organizationLocation",function(b,c){b&&b.id?(a.msgCategory={queryUrl:"FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",queryParameter:{organizationLocationId:b.id},jsonParameter:{}},a.$broadcast("loadWSAdhocMessageMsgCategory",a.msgCategory),a.isCategoryDisabled=!1,a.isSubCategoryDisabled=!1):(a.isCategoryDisabled=!0,a.isSubCategoryDisabled=!0,a.WSAdhocMessage.msgCategory={},a.WSAdhocMessage.msgSubCategory={})},!0),a.$watch("WSAdhocMessage.msgCategory",function(b,c){b&&b.id?(a.msgSubCategory={queryUrl:"FIND_ALL_ADHOC_ACTIVE_SUB_CATEGORY_BY_CATEGORY_ID",queryParameter:{msgCategoryId:b.id},jsonParameter:{}},a.$broadcast("loadWSAdhocMessageMsgSubCategory",a.msgSubCategory),a.isSubCategoryDisabled=!1):(a.isSubCategoryDisabled=!0,a.WSAdhocMessage.msgSubCategory={})},!0),a.$watch("WSAdhocMessage.whetherScheduled",function(b,c){b?a.whetherImmediate=!1:(a.whetherImmediate=!0,a.WSAdhocMessage.msgDueDate=null,a.WSAdhocMessage.msgDueTime=null)},!0),a.$watch("email.msgContent",function(b,c){m.isNullOrEmpty(a.email.msgContent)?a.isEmailContent=!1:a.isEmailContent=!0},!0),a.$watch("notification.msgContent",function(b,c){m.isNullOrEmpty(a.notification.msgContent)?a.isNotificationContent=!1:a.isNotificationContent=!0},!0),a.onSubjectFocus=function(){a.isMsgContent=!1},a.fetchDynamicData=function(){q.getUserRecipientType(function(b){b&&b.id&&r.fetchDynamicData(0,b.id,function(b){a.dynamicData=b,"add"===c.type?(a.pageState="add",c.adhocMsgEventConfigId&&(a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId))):"edit"===c.type?(a.pageState="edit",a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId)):"view"===c.type&&(a.pageState="view",a.disabledFormFields=!0,a.getAdhocMessageDetails(c.adhocMsgEventConfigId,c.type),c.adhocMsgEventConfigId&&a.fetchAttachmentList(c.adhocMsgEventConfigId))},function(a){})},function(a){})},a.onTabChanges=function(b){a.tabIndexNumber=b},a.dataChanged=function(){a.data};/*$scope.data ={
                id: 5,
                value: "Test",
                code: "Test"
        };*/
var w;// A variable to store a reference to the current editor.
CKEDITOR.on("currentInstance",function(){w=CKEDITOR.currentInstance,a.isMsgContent=!0}),a.addDynamicData=function(){if(m.isNullOrEmpty(a.data))f("warning",h.instant("PLEASE_SELECT_DYNAMIC_DATA_FIRST"));else/*if ($scope.tabIndexNumber === 0 || $scope.tabIndexNumber === 2) {

                }*/
if(a.isMsgContent&&a.data)if(w&&w.document){var b="<span> `"+a.data.value+"` </span>",c=CKEDITOR.dom.element.createFromHtml(b,w.document);w.insertElement(c),w.focus()}else f("warning",h.instant("PLEASE_FOCUS_EDITOR_AREA"));else!a.isMsgContent&&a.data&&0===a.tabIndexNumber?m.isNullOrEmpty(a.email.subjectLine)?a.email.subjectLine=" `"+a.data.value:a.email.subjectLine=a.email.subjectLine+" `"+a.data.value+"` ":!a.isMsgContent&&a.data&&2===a.tabIndexNumber?m.isNullOrEmpty(a.notification.subjectLine)?a.notification.subjectLine=" `"+a.data.value:a.notification.subjectLine=a.notification.subjectLine+" `"+a.data.value+"` ":!a.isMsgContent&&a.data&&1===a.tabIndexNumber&&(m.isNullOrEmpty(a.sms.msgContent)?a.sms.msgContent=" `"+a.data.value:a.sms.msgContent=a.sms.msgContent+" `"+a.data.value+"` ")},a.getConvertedMsgContent=function(a,b){var c=a.split(/[``]/);if(c.length>0)for(var d=0;d<c.length;d++)for(var e=0;e<b.length;e++)if(c[d]==b[e].value){var f="`"+b[e].code+"`",g="`"+b[e].value+"`";a=a.replace(new RegExp(g,"g"),f)}return a},a.saveAdhocMessageForm=function(b){if(b.$valid){if(!m.isNullOrEmpty(a.email.subjectLine)&&m.isNullOrEmpty(a.email.msgContent))return void f("warning",h.instant("PLEASE_ADD_EMAIL_MESSAGE_CONTENT"));if(!m.isNullOrEmpty(a.notification.subjectLine)&&m.isNullOrEmpty(a.notification.msgContent))return void f("warning",h.instant("PLEASE_ADD_NOTIFICATION_MESSAGE_CONTENT"));var e=angular.copy(a.email),g=angular.copy(a.sms),i=angular.copy(a.notification);m.isEmpty(e.subjectLine)||(e.subjectLine=a.getConvertedMsgContent(e.subjectLine,a.dynamicData)),m.isEmpty(e.msgContent)||(e.msgContent=a.getConvertedMsgContent(e.msgContent,a.dynamicData)),m.isEmpty(g.msgContent)||(g.msgContent=a.getConvertedMsgContent(g.msgContent,a.dynamicData)),m.isEmpty(i.subjectLine)||(i.subjectLine=a.getConvertedMsgContent(i.subjectLine,a.dynamicData)),m.isEmpty(i.msgContent)||(i.msgContent=a.getConvertedMsgContent(i.msgContent,a.dynamicData));var j="",k="";if(!m.isNullOrEmpty(a.WSAdhocMessage.msgDueTime)){var l=new Date(a.WSAdhocMessage.msgDueTime);j=l.getHours()+":"+l.getMinutes()+":"+l.getSeconds()}if(m.isNullOrEmpty(a.WSAdhocMessage.msgDueDate)||(k=o.convertToServerDate(a.WSAdhocMessage.msgDueDate),k=k+" "+j),!m.isNullOrEmpty(k)&&Date.parse(k)<new Date)return void f("warning",h.instant("PLEASE_ENTER_DATE_MORE_THAN_CURRENT_DATE_TIME"));a.WSAdhocMessage.whetherScheduled&&(a.WSAdhocMessage.scheduledDateTime=k),a.WSAdhocMessage.email=e,a.WSAdhocMessage.sms=g,a.WSAdhocMessage.notification=i,/*
    "adhocMsgDynamicAttachments": [],
    "status": {}*/
a.WSAdhocMessage.id=null,a.WSAdhocMessage.displayCode=a.WSAdhocMessage.to+" "+a.WSAdhocMessage.from+" "+new Date,a.filterData.whetherConv?a.WSAdhocMessage.msgSubCategory={code:a.WSAdhocMessage.topic}:a.WSAdhocMessage.msgSubCategory={code:"MSG_CONVERSATION"},a.WSAdhocMessage.whetherScheduled=!1,a.WSAdhocMessage.organizationLocation={id:1},a.WSAdhocMessage.msgTemplateConfig={templateConfigName:a.WSAdhocMessage.to+" "+a.WSAdhocMessage.from+" "+new Date,messageTemplates:[{id:null,msgContent:a.WSAdhocMessage.msgContent,msgDeliveryMode:{id:2,code:"NOTIFICATION",value:"Notification",whetherMsgSubjAvail:!0,whetherAttachmentSupported:!0},subjectLine:a.WSAdhocMessage.subject,languageId:1}]},a.WSAdhocMessage.notification={id:null,msgContent:a.WSAdhocMessage.msgContent,msgDeliveryMode:{id:3,code:"NOTIFICATION",value:"Notification",whetherMsgSubjAvail:!0,whetherAttachmentSupported:!0},subjectLine:a.WSAdhocMessage.subject,languageId:1},a.WSAdhocMessage.adhocMsgDynamicAttachments=[],a.WSAdhocMessage.status={},a.WSAdhocMessage.authorId=a.WSAdhocMessage.fromUserId,a.WSAdhocMessage.authorName=a.WSAdhocMessage.from,a.WSAdhocMessage.topicType=a.WSAdhocMessage.topicType,a.WSAdhocMessage.topic=a.WSAdhocMessage.topic,a.adhocMessageFormSpinner=!0,console.log(a.WSAdhocMessage),q.saveConversationMessageForm(a.WSAdhocMessage,"add",function(e){a.adhocMessageFormSpinner=!1,a.selectedFileArray&&a.selectedFileArray.length>0?a.saveDocumentIdInDocumentTable(b,e,a.WSAdhocMessage.organizationLocation.id):a.showSuccessMessageOnFormSave(e);var g="GROUP_USER_INDIVIDUAL",i=[a.WSAdhocMessage.toUserId];q.saveAdhocMessageUsers(e,g,i,function(a){f("success",h.instant("ADDED_SUCCESS")),d.go("msgconversation",{data:c.data}),u.sendAdhocMessage(e,function(a){f("success",h.instant("RECORD_SAVED_SUCCESS")),d.go("msgconversation",{data:c.data})},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("FAILED_TO_SAVE_RECORD")):f("error",h.instant(a.data.messages[0]))})},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("FAILED_TO_SAVE_RECORD")):f("error",h.instant(a.data.messages[0]))})},function(b){a.adhocMessageFormSpinner=!1,!m.isEmpty(b.data)&&b.data.messages.length>0&&!m.isEmpty(b.data.messages[0])?f("error",h.instant(b.data.messages[0])):f("error",h.instant("FAILED_TO_SAVE_RECORD"))})}},a.showSuccessMessageOnFormSave=function(a){"add"===c.type&&f("success",h.instant("ADDED_SUCCESS"))},a.saveDocumentIdInDocumentTable=function(b,c,e){if(a.selectedFileArray&&a.selectedFileArray.length>0){var f={};f.documentType={},f.documentType.type=s.documentTypes.messaging,f.documentType.subType=s.documentSubTypes.adhocMsgTemplate,a.fileUploadSpinner=!0,t.saveAllDocuments(f,!1,a.selectedFileArray,function(b){a.fileUploadSpinner=!1,a.selectedFileArray&&a.selectedFileArray.length>0&&b?a.uploadFile(a.selectedFileArray,f,b,c,e):a.showSuccessMessageOnFormSave(c)},function(){a.fileUploadSpinner=!1,d.go("adhocMessages")})}},a.uploadFile=function(b,c,e,g,i){var j=new Object;j.docType=c.documentType.type,j.docSubType=c.documentType.subType,j.recordId=g,// add templateConfigId
e.response&&(j.resourceDetails=JSON.stringify(e.response)),a.fileUploadSpinner=!0,t.uploadMultipleFiles(j,b,function(b){a.fileUploadSpinner=!1,a.saveDocumentIdsWithAdhocMessage(e,g,i)},function(b){a.fileUploadSpinner=!1,f("Error",h.instant("ERROR_WHILE_UPLOADING")),d.go("adhocMessages")})},a.saveDocumentIdsWithAdhocMessage=function(b,c,e){if(b){for(var g=b.response,i=new Array,j=0;j<g.length;j++){var k={};k.documentId=g[j].id,k.orgLocId=e,k.fileName=g[j].value,k.msgEventConfig={},k.msgEventConfig.id=c,k.documentSubType="ADHOC_MSG_TEMPLATE",i.push(k)}a.adhocMessageFormSpinner=!0,r.uploadFiles(i,function(b){a.adhocMessageFormSpinner=!1,a.showSuccessMessageOnFormSave(c)},function(b){d.go("adhocMessages"),a.adhocMessageFormSpinner=!1,f("Error",h.instant("ERROR_WHILE_UPLOADING"))})}},a.moveToAddRecipientForm=function(){d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:a.WSAdhocMessage.organizationLocation,adhocMsgEventConfigId:a.WSAdhocMessage.id,displayCode:a.WSAdhocMessage.displayCode})},a.getMsgDeliveryMode=function(){q.getMsgDeliveryMode(function(b){a.msgDeliveryMode=b;for(var c=0;c<a.msgDeliveryMode.length;c++)"EMAIL"===a.msgDeliveryMode[c].code?a.email.msgDeliveryMode=a.msgDeliveryMode[c]:"SMS"===a.msgDeliveryMode[c].code?a.sms.msgDeliveryMode=a.msgDeliveryMode[c]:"NOTIFICATION"===a.msgDeliveryMode[c].code&&(a.notification.msgDeliveryMode=a.msgDeliveryMode[c])},function(a){})},a.getAdhocMessageDetails=function(b,c){a.adhocMessageFormSpinner=!0,m.isNullOrEmpty(b)||q.getAdhocMessageDetails(b,function(b){a.adhocMessageFormSpinner=!1,a.setDataToAdhocMsgForm(b)},function(a){f("error",h.instant("FAILED_TO_LOAD_RECORD"))})},a.fetchAttachmentList=function(b){r.fetchAttachmentList(b,null,function(c){a.selectedFileArray=c,angular.forEach(a.selectedFileArray,function(c){c.documentType=s.documentTypes.messaging,c.documentSubType=s.documentSubTypes.adhocMsgTemplate,c.recordId=b,c.deleteCallBack=function(b){a.deleteFile(b)}})},function(a){})},a.deleteFile=function(a){r.deleteFile(a,function(a){f("success",h.instant("RECORD_DELETED_SUCCESSFULLY"))},function(a){})},a.setDataToAdhocMsgForm=function(b){if(!m.isEmpty(b)&&(a.WSAdhocMessage.id=b.id,a.WSAdhocMessage.displayCode=b.displayCode,a.WSAdhocMessage.msgCategory=b.msgCategoryId,a.WSAdhocMessage.msgSubCategory=b.msgSubCategory,a.organizationLocationModel={id:b.orgLocId},b.msgDueDate&&(a.WSAdhocMessage.msgDueDate=v("timestampToDate")(b.msgDueDate,"MM/dd/yyyy"),a.WSAdhocMessage.msgDueTime=b.msgDueDate),a.WSAdhocMessage.whetherScheduled=b.whetherScheduled,a.WSAdhocMessage.status=b.status,a.WSAdhocMessage.adhocMsgDynamicAttachments=b.adhocMsgDynamicAttachments,a.WSAdhocMessage.organizationLocation={id:b.orgLocId,value:b.orgLocationName},b.msgTemplateConfig)){a.WSAdhocMessage.msgTemplateConfig={id:b.msgTemplateConfig.id};var c=b.msgTemplateConfig.messageTemplates;if(c.length>0)for(var d=0;d<c.length;d++)"EMAIL"===c[d].msgDeliveryMode.code?(a.email.id=c[d].id,a.email.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].subjectLine)||(a.email.subjectLine=a.setDataMsgContent(c[d].subjectLine,a.dynamicData),a.email.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),a.email.languageId=c[d].languageId):"SMS"===c[d].msgDeliveryMode.code?(a.sms.id=c[d].id,a.sms.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].msgContent)||(a.sms.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),a.sms.languageId=c[d].languageId):"NOTIFICATION"===c[d].msgDeliveryMode.code&&(a.notification.id=c[d].id,a.notification.msgDeliveryMode=c[d].msgDeliveryMode,m.isNullOrEmpty(c[d].msgContent)||(a.notification.msgContent=a.setDataMsgContent(c[d].msgContent,a.dynamicData)),m.isNullOrEmpty(c[d].subjectLine)||(a.notification.subjectLine=a.setDataMsgContent(c[d].subjectLine,a.dynamicData)),a.notification.languageId=c[d].languageId)}},a.setDataMsgContent=function(a,b){var c=a.split(/[``]/);if(c.length>0)for(var d=0;d<c.length;d++)for(var e=0;e<b.length;e++)if(c[d]==b[e].code){var f="`"+b[e].code+"`",g="`"+b[e].value+"`";a=a.replace(new RegExp(f,"g"),g)}return a},
// on cancel forward to search list
a.cancelAdhocMessageForm=function(){m.goBackToPrevState()},
//Init Method
a.init=function(){/*for(name in CKEDITOR.instances)
                    CKEDITOR.instances[name].destroy();*/
a.WSAdhocMessage={},c.data&&(a.filterData=c.data,a.filterData.to&&(a.WSAdhocMessage.from=a.filterData.from),a.filterData.fromUserId&&(a.WSAdhocMessage.toUserId=a.filterData.toUserId),a.filterData.toUserId&&(a.WSAdhocMessage.fromUserId=a.filterData.fromUserId),a.filterData.from&&(a.WSAdhocMessage.to=a.filterData.to),a.filterData.topicType&&(a.WSAdhocMessage.topicType=a.filterData.topicType),a.filterData.topic&&(a.WSAdhocMessage.topic=a.filterData.topic),a.filterData.subject&&(a.WSAdhocMessage.subject=a.filterData.subject)),a.minDate=new Date,a.getMsgDeliveryMode(),a.fetchDynamicData()},a.init()}]),angular.module("paripal.messagingModule").controller("MessageConversationListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","featurePrivilegeConstants","dateconvertor","messageConversationListService","notificationMessagingService","$filter","$sce",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b};
//datatble config json
var t={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(t),a.dtColumnDefs=e.setColumnProperties({}),a.openMessage=function(b){b.whetherRead||q.changeMessageStatus(b.messageId,function(a){},function(b){a.error=b}),d.go("msgconversationview",{data:b,msgId:b.messageId,fromState:"messageConversation"})},a.addMessage=function(){c.data&&d.go("msgconversationadd",{data:c.data,type:"add"})},a.init=function(){if(a.messageList={},c.data){a.filterData=c.data,a.filterData.to&&(a.messageList.to=a.filterData.to),a.filterData.fromUserId&&(a.messageList.fromUserId=a.filterData.fromUserId),a.filterData.toUserId&&(a.messageList.toUserId=a.filterData.toUserId),a.filterData.from&&(a.messageList.from=a.filterData.from),a.filterData.topicType&&(a.messageList.topicType=a.filterData.topicType),a.filterData.topic&&(a.messageList.topic=a.filterData.topic),a.filterData.subject&&(a.messageList.subject=a.filterData.subject);var b=angular.copy(a.messageList);b.pageNumber=1,b.recordsPerPage=10,delete b.to,delete b.from,delete b.subject,p.getMsgConversationList(b,function(b){a.WSAllNotifications=b.data,angular.forEach(a.WSAllNotifications,function(a,b){a.msgContent=atob(a.msgContent),a.msgContent=r("limitTo")(a.msgContent,50),a.msgContent=s.trustAsHtml(a.msgContent)}),a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),0==a.totalItems||m.isFieldEmpty(a.totalItems)?a.buttonText=h.instant("INITIATE"):a.buttonText=h.instant("REPLY")})}},/**/
a.init()}]),angular.module("paripal.messagingModule").controller("MessageConversationViewCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","featurePrivilegeConstants","dateconvertor","messageConversationListService","notificationMessagingService","$filter","fileOperations","$sce",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},m.isEmpty(j.getLoggedInUser())||(a.userId=j.getLoggedInUser().id),a.professionalId=null,a.selected=[],a.exists=function(a,b){return b.indexOf(a.messageId)>-1},a.toggle=function(b,c){var d=c.indexOf(b.messageId);d>-1?c.splice(d,1):c.push(b.messageId),a.selected=c},a.findAllNotificationByUserId=function(){q.findAllNotificationByUserId(a.userId,function(c){b.WSAllNotifications=c,a.totalItems=c.length,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),angular.forEach(a.WSAllNotifications,function(a,b){a.msgContent=atob(a.msgContent),a.msgContent=r("limitTo")(a.msgContent,50),a.msgContent=t.trustAsHtml(a.msgContent)})},function(b){a.error=b},a.professionalId)},a.downloadAttachmentFile=function(a){if(!m.isEmpty(a)){var b=new Object;b.fileName=a.documentName,b.resourceId=a.documentId,b.recordId=a.msgEventConfigId,
//fileObject.docType = commonConstants.documentTypes.messaging;
// fileObject.docSubType = commonConstants.documentSubTypes.staticAttachment;
b.docType=a.type,b.docSubType=a.subType,b.orgLocId=a.orgLocId,m.isNullOrEmpty(a.userId)||(b.userId=a.userId),s.downloadFile(b,function(a){},function(a){})}},a.openMessage=function(c){c.whetherRead?u(c):q.changeMessageStatus(c.messageId,function(a){q.getMsgCount(function(a){b.msgCount=a.unreadCount},function(a){}),u(c)},function(b){a.error=b})};var u=function(a){var b={};b.msgId=a.messageId,b.data=a,b.fromState="notification","professionalwall"===c.type&&(b.fromState="professionalwall"),d.go("notification",b)};a.back=function(){m.goBackToPrevState()},a.deleteAllMessages=function(){q.deleteAllMessages(a.selected,function(b){a.findAllNotificationByUserId()},function(b){a.error=b})},a.deleteMessage=function(b){q.deleteMessages(b,function(a){d.go("notificationlist")},function(b){a.error=b})},a.getMessageData=function(b){q.getMessageDetails(b,function(b){a.WSNotificationData=b.data,a.WSNotificationData.msgContent=atob(a.WSNotificationData.msgContent),a.WSNotificationData.msgContent=t.trustAsHtml(a.WSNotificationData.msgContent),angular.forEach(a.WSNotificationData.msgDocuments,function(a,b){var c=a.documentName.indexOf(".");a.extension=a.documentName.substring(c+1)})},function(b){a.error=b})},a.init=function(){"professionalwall"===c.type&&(a.fromProfessionalWall=!0,a.professionalId=c.user.id),a.userId&&a.findAllNotificationByUserId(),"messageConversation"==c.fromState?a.getMessageData(c.msgId):"professionalwall"==c.fromState&&(a.getMessageData(c.msgId),a.fromProfessionalWall=!0)},a.init(),
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b};
//datatble config json
var v={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(v),a.dtColumnDefs=e.setColumnProperties({})}]),angular.module("paripal.messagingModule").controller("MessageEvtSubCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messageEvtSubService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.htmlEditor="...",a.user={},a.userData={},a.des={},
//$scope.user.id = 1;
a.eventSubList=[],
//Search User Address
a.searchEventSubscription=function(){var c={};a.roleListSpinner=!0,c.userId=b.loggedInUserDetails.id,c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,l.isFieldEmpty(a.userData.data)||(c.userId=a.userData.data.id),m.searchEventSubscription(c,function(b){a.roleListSpinner=!1,a.eventSubList=b;for(var c=0;c<=a.eventSubList.data.length;c++)l.isNullOrEmpty(a.eventSubList.data[c])||0==a.eventSubList.data[c].whetherSubscribed&&(a.eventSubList.data[c].sms=!1,a.eventSubList.data[c].email=!1,a.eventSubList.data[c].notification=!1);a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.roleListSpinner=!1})},a.onSubscribe=function(b,c,d,e,f){var g={};if(g.msgEventId=b,f.recipientTypeId&&(g.recipientTypeId=f.recipientTypeId),g.userId=a.user.id,l.isNullOrEmpty(d)||("undefined"!=typeof f&&(g.email=f.email,g.notification=f.notification),1==d?g.sms=!1:0==d&&(g.sms=!0)),l.isNullOrEmpty(e)||("undefined"!=typeof f&&(g.sms=f.sms,g.notification=f.notification),1==e?g.email=!1:0==e&&(g.email=!0)),0==c){for(var h=0;h<=a.eventSubList.data.length;h++)l.isNullOrEmpty(a.eventSubList.data[h])||a.eventSubList.data[h].msgEventId==b&&(a.eventSubList.data[h].sms=!1,a.eventSubList.data[h].email=!1,a.eventSubList.data[h].notification=!1);l.isNullOrEmpty(g.sms)||delete g.sms,l.isNullOrEmpty(g.email)||delete g.email}else f.sms||f.notification||f.email||!c||(g.email=!0,g.notification=!0,g.sms=!0);/* sub.email = email; */
// if ($scope.des.whetherSubscribe === 'Subscribed')
g.whetherSubscribed=c,/* sub.whetherSubscribed = true; */
// else
// sub.whetherSubscribed = sub;
m.subscribe(g,function(b){a.searchEventSubscription(a.user.id)},function(a){})},
//Fetch records
a.fetchRecords=function(){a.searchEventSubscription()},
//clear search
a.clear=function(){a.WSMsgCategory={},a.searchEventSubscription()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchEventSubscription()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchEventSubscription()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(n),a.dtColumnDefs=e.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchEventSubscription()},a.init=function(){/*if ($stateParams.user) {
                $scope.userData.id = $stateParams.user.id;
                $scope.userData.value = $stateParams.user.displayName;
                $scope.user = $stateParams.user;
                $scope.searchEventSubscription($stateParams.user.id);                            
            }*/
a.userData.id=b.loggedInUserDetails.id,a.userData.value=b.loggedInUserDetails.displayName,a.user=b.loggedInUserDetails,a.searchEventSubscription()},a.init()}]),angular.module("paripal.messagingModule").controller("MessageOrgUserListCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","datatableconfig","baseService","utilService","notify","$translate","serverSidePagination","messageOrgUserListService","messagingGroupUserListService","manageAdhocMessageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.userList=[],a.WSUserSearchCriteria={},a.error={},a.filterCriteria={},a.error={},a.addressInfo={},a.addressInfoFilter={},a.org={},a.orgLoc={},a.status={},a.status.AND="true",a.status.OR="false",a.userlistSpinner=!1,a.userListPageSpinner=!1,a.selected=[],a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.searchUsers=function(){h.isNullOrEmpty(c.whetherAdmin)||(a.WSUserSearchCriteria.pageNumber=a.currentPage,a.WSUserSearchCriteria.recordsPerPage=a.itemPerPage,a.userlistSpinner=!0,a.WSUserSearchCriteria.whetherAdmin=c.whetherAdmin,c.isIndividualUserMode?a.WSUserSearchCriteria.whetherAdmin?l.searchOrgUsers(a.WSUserSearchCriteria,a.addressInfo,a.orgLoc,function(b){
//$scope.selected = [];
a.userlistSpinner=!1,a.userList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),
// notify("success", $translate.instant("ORG_USER_LIST_SUCCESS"));
a.WSUserSearchCriteria.whetherAllStatus&&a.WSUserSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus="true":a.filterCriteria.whetherAllStatus="false"},function(b){a.userlistSpinner=!1,a.error=b,a.userList=null,a.currentPage=1,a.totalItems=0,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)}):l.searchStackHolders({},function(b){
//$scope.selected = [];
a.userlistSpinner=!1,a.userList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),
// notify("success", $translate.instant("ORG_USER_LIST_SUCCESS"));
a.WSUserSearchCriteria.whetherAllStatus&&a.WSUserSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus="true":a.filterCriteria.whetherAllStatus="false"},function(b){a.userlistSpinner=!1,a.error=b,a.userList=null,a.currentPage=1,a.totalItems=0,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)}):l.searchUsers(a.isIndividualUser,a.WSUserSearchCriteria,a.addressInfo,a.orgLoc,function(b){
//$scope.selected = [];
a.userlistSpinner=!1,a.userList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),
// notify("success", $translate.instant("ORG_USER_LIST_SUCCESS"));
a.WSUserSearchCriteria.whetherAllStatus&&a.WSUserSearchCriteria.whetherAllStatus?a.filterCriteria.whetherAllStatus="true":a.filterCriteria.whetherAllStatus="false"},function(b){a.userlistSpinner=!1,a.error=b,a.userList=null,a.currentPage=1,a.totalItems=0,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems)}))},a.exists=function(a,b){return b.indexOf(a.userId)>-1},a.toggle=function(b,c){var d=c.indexOf(b.userId);d>-1?c.splice(d,1):c.push(b.userId),a.selected=c},a.addOrgUserForMessagingGroup=function(b){h.isEmpty(c.groupUserType)||(a.selected&&a.selected.length>0?"msgGroup"===c.menuNevigate?m.saveMessageGroupUsers(c.msgGroup,c.groupUserType,a.selected,function(b){i("success",j.instant("MSG_USER_ADDED_SUCESSFULLY")),
//$scope.selected = [];
a.searchUsers()},function(a){h.isEmpty(a.data)||h.isEmpty(a.data.messages[0])?i("error",j.instant("FAILED_TO_SAVE_RECORD")):i("error",j.instant(a.data.messages[0]))}):"adhocMessage"===c.menuNevigate&&n.saveAdhocMessageUsers(c.adhocMsgEventConfigId,c.groupUserType,a.selected,function(b){i("success",j.instant("MSG_USER_ADDED_SUCESSFULLY")),
//$scope.selected = [];
a.searchUsers()},function(a){h.isEmpty(a.data)||h.isEmpty(a.data.messages[0])?i("error",j.instant("FAILED_TO_SAVE_RECORD")):i("error",j.instant(a.data.messages[0]))}):i("warning",j.instant("SELECT_USER_MANDATORY")))},a.moveToPreviousStep=function(){"msgGroup"===c.menuNevigate?d.go("messagingGroupUser",{type:c.type,msgGroup:c.msgGroup,groupUserType:c.groupUserType,isIndividualUserMode:c.isIndividualUserMode}):"adhocMessage"===c.menuNevigate&&d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode,isIndividualUserMode:c.isIndividualUserMode})},a.fetchRecords=function(){a.WSUserSearchCriteria=a.filterCriteria,a.addressInfo=a.addressInfoFilter,a.searchUsers()},a.clear=function(){a.WSUserSearchCriteria={},a.addressInfo={},a.org={},a.selected=[],
//$scope.orgLoc = {};
a.filterCriteria={},a.addressInfoFilter={},a.$broadcast("clearStatusData"),a.$broadcast("clearPicklistData"),a.$broadcast("clearAddressData"),a.searchUsers()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems),a.searchUsers()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchUsers()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=f.setOptionProperties(o),a.dtColumnDefs=f.setColumnProperties({}),a.init=function(){!c.whetherAdmin&&c.isIndividualUserMode&&(a.removeFilter=!0),/*To hide/show content when user select member is Individulal*/
a.isIndividualUser="GROUP_USER_INDIVIDUAL"==c.groupUserType,h.isEmpty(c)||("msgGroup"===c.menuNevigate&&h.isEmpty(c.msgGroup)?d.go("messagingGroup"):"adhocMessage"===c.menuNevigate&&h.isNullOrEmpty(c.adhocMsgEventConfigId)?d.go("adhocMessages"):(a.orgLoc=c.organizationLocation,a.searchUsers())),a.selected=c.userIds},a.init()}]),angular.module("paripal.messagingModule").controller("MessagingFailuresListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messagingFailureListService","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.showFailedMessages={value:"delivered"},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSMessageFailureList=[],a.isCategoryDisabled=!1,a.isSubCategoryDisabled=!1,a.senderData={},a.recipientData={},a.failureMessageSpinner=!1,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.category={queryUrl:"FIND_ALL_MESSAGE_CATEGORY",queryParameter:{organizationLocationId:1},jsonParameter:{}},/*$scope.$watch('searchCriteria.organizationLocation', function (newVal, oldVal) {
            if (newVal && newVal.id) {

                $scope.category = {
                    queryUrl: "FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",
                    queryParameter: {
                        organizationLocationId: newVal.id
                    },
                    jsonParameter: {}
                };

                $scope.$broadcast('loadSearchCriteriaCategory', $scope.category);
                $scope.isCategoryDisabled = false;
                $scope.isSubCategoryDisabled = false;
            } else {
                $scope.isCategoryDisabled = true;
                $scope.isSubCategoryDisabled = true;
                $scope.searchCriteria.category = {};
                $scope.searchCriteria.subCategory = {};
            }

        }, true);*/
a.$watch("searchCriteria.category",function(b,c){b&&b.id?(a.subCategory={queryUrl:"FIND_SUB_CATEGORY_BY_PARENT_CATEGIRY_ID",queryParameter:{msgCategoryId:b.id},jsonParameter:{}},a.$broadcast("loadSearchCriteriaSubCategory",a.subCategory),a.isSubCategoryDisabled=!1):(a.isSubCategoryDisabled=!0,a.searchCriteria.subCategory={})},!0),
//Search messaging failure list
a.searchFailedMessages=function(){var c=new Object;"failed"==a.showFailedMessages.value?a.searchCriteria.status="FAILED":"delivered"==a.showFailedMessages.value?a.searchCriteria.status="DELIVERED":"not_delivered"==a.showFailedMessages.value?a.searchCriteria.status="NOT_DELIVERED":"all"==a.showFailedMessages.value&&(a.searchCriteria.status="ALL"),angular.copy(a.searchCriteria,c),c.validFrom=n.convertToServerDate(a.searchCriteria.validFrom),c.validTill=n.convertToServerDate(a.searchCriteria.validTill),a.failedMessageSpinner=!0,c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,l.isFieldEmpty(a.senderData.data)||(c.senderData={id:a.senderData.data.id,value:a.senderData.nameValue}),l.isFieldEmpty(a.recipientData.data)||(c.recipientData={id:a.recipientData.data.id,value:a.recipientData.nameValue}),b.showSpinner=!0,m.searchFailedMessages(c,function(c){b.showSpinner=!1,a.failedMessageSpinner=!1,a.WSMessageFailureList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(c){b.showSpinner=!1,a.failedMessageSpinner=!1})},
//Fetch records
a.fetchRecords=function(){a.searchFailedMessages()},
//clear search
a.clear=function(){a.searchCriteria={},a.searchFailedMessages()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchFailedMessages()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchFailedMessages()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.searchFailedMessages()},a.init()}]),angular.module("paripal.messagingModule").controller("MessagingGroupDefinitionCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messagingGroupUserListService","commonConstants","httpService","urlService","conditionBuilderService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSMsgGroupUsers=[],a.groupUserType=[],a.msgGroupUserSpinner=!1,a.groupUserConditionObj={},a.groupUserConditionObj.conditionEntityDef=[],a.groupUserConditionObj.sqlQueryWhereDef={},a.dateObj={},a.paymentModes=[],a.isDateRquired=!1,a.currentDate=new Date,a.groupUserConditionObj.conditionUIDef={},a.condition={},a.subCategoryCode="",a.subCategories=[{code:"LOC_USERS"},{code:"LOC_CLIENTS"}];var r=function(){if(c.groupId){var b={msgGroupId:c.groupId};o.getData(p.getParameterizedUrl("FIND_MESSAGE_GROUP_BY_ID",b),null,function(b){l.isNullOrEmpty(b.data)||(a.groupUserConditionObject=b.data,a.groupId=b.data.id,a.groupName=b.data.name,a.groupType=b.data.groupType.value,a.organizationLocation=b.data.orgLocationName,b.data.subCategory&&(a.groupDetails=b.data,a.subCategoryCode=b.data.subCategory,s(a.groupDetails,a.subCategoryCode)))},function(a){})}else d.go("messagingGroup")},s=function(b,c){var d={category:"MESSAGING",subCategory:c};q.getQueryBuilderColumnConf(d,function(c){a.entityFields=c,l.isNullOrEmpty(b)||l.isNullOrEmpty(b.conditionUIDef)||(a.groupUserConditionObj.conditionUIDef=JSON.parse(b.conditionUIDef),a.groupUserConditionObj.sqlQueryWhereDef=b.sqlQueryWhereDef,a.groupUserConditionObj.conditionEntityDef=b.conditionEntityDef,a.groupUserConditionObj.conditionDesc=b.conditionDesc)},function(a){}),q.getQueryBuilderEntityConf(d,function(b){a.queryMetaData=b},function(a){})};a.subCategoryChanged=function(){s(a.groupDetails,a.subCategoryCode)},a.onChangeWhetherCondition=function(){a.groupUserConditionObj.whetherConditional?a.condition.open=!0:a.condition.open=!1},a.$on("form",function(b,c){a.conditionform=c.form});a.saveCondition=function(b){if(l.conditionBuilderNullCheck(a.groupUserConditionObj.conditionUIDef.group))
//$scope.conditionform.$submitted = true;
f("Error",g.instant("INVALID_CONDITION"));else if(b.$valid&&a.conditionform.$valid||b.$valid){a.groupUserConitionFormSpinner=!0;var c=angular.copy(a.groupUserConditionObj);c.conditionUIDef=JSON.stringify(c.conditionUIDef),a.groupUserConditionObject.conditionEntityDef=c.conditionEntityDef,a.groupUserConditionObject.conditionDesc=c.conditionDesc,a.groupUserConditionObject.conditionUIDef=c.conditionUIDef,a.groupUserConditionObject.sqlQueryWhereDef=c.sqlQueryWhereDef,a.groupUserConditionObject.category="MESSAGING",a.groupUserConditionObject.subCategory=a.subCategoryCode,t(a.groupUserConditionObject)}};var t=function(b){o.putData(p.getUrl("UPDATE_MESSAGE_GROUP"),b,function(b){l.isNullOrEmpty(b.data)||(f("success",g.instant("MSG_GROUP_DEFINATION_UPDATED")),a.cancel(),a.groupUserConitionFormSpinner=!1)},function(b){a.groupUserConitionFormSpinner=!1})};a.cancel=function(){d.go("messagingGroup")},a.init=function(){a.commonConstants=n,r()},a.init()}]),angular.module("paripal.messagingModule").controller("MessagingGroupListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messagingGroupListService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSMsgGroupList=[],a.msgGroupSpinner=!1,a.groupType={queryUrl:"GET_PICKLIST_DATA",queryParameter:{type:"groupType"},jsonParameter:{}},a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},
//Search messaging group list
a.searchMessageGroups=function(){a.msgGroupSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,m.searchMessageGroups(a.searchCriteria,function(b){a.msgGroupSpinner=!1,a.WSMsgGroupList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.msgGroupSpinner=!1})},a.manageMessageGroup=function(b,c,d){h.show({controller:"ManageMsgGroupCtrl",templateUrl:"app/modules/messaging/views/manage-message-group.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:n.dialogBox.clickOutsideToClose,locals:{stateParams:{type:d,msgGroupId:c},parentScope:a}}).then(function(){},function(){})},a.inactivateMsgGroup=function(b,c){if(c){var d=h.confirm().title(g.instant("WARNING")).textContent(g.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(d).then(function(){m.inactivateMsgGroup(c,function(b){f("sucess",g.instant("MESSAGE_GROUP_INACTIVATED")),a.searchMessageGroups()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},function(){})}},a.activateMsgGroup=function(b,c){c&&m.activateMsgGroup(c,function(b){f("sucess",g.instant("MESSAGE_GROUP_ACTIVATED")),a.searchMessageGroups()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.getUserDetails=function(a,b){/*if(row && row.whetherDefault){
				type= "view";
			}*/
a.id&&d.go("messagingGroupUser",{type:b,msgGroup:a,organizationLocation:{id:a.creatingOrgLocId,value:a.orgLocationName}})},a.manageGroupDefinition=function(a,b){/*if(row && row.whetherDefault){
				type= "view";
			}*/
a.id&&d.go("messagingGroupDefinition",{groupId:a.id,organizationLocation:{id:a.creatingOrgLocId,value:a.orgLocationName}})},
//Fetch records
a.fetchRecords=function(){a.searchMessageGroups()},
//clear search
a.clear=function(){a.searchCriteria={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchMessageGroups()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchMessageGroups()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.searchMessageGroups()},a.init()}]),angular.module("paripal.messagingModule").controller("MessagingGroupUserListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messagingGroupUserListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.WSMsgGroupUsers=[],a.groupUserType=[],a.msgGroupUserSpinner=!1,
//Search messaging group user list
a.searchMessageGroupUsers=function(){a.msgGroupUserSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.groupId&&(a.searchCriteria.groupId=a.groupId,m.searchMessageGroupUsers(a.searchCriteria,function(b){a.msgGroupUserSpinner=!1,a.WSMsgGroupUsers=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.msgGroupUserSpinner=!1}))},a.getGroupUserType=function(){var b={type:"groupUserType"};m.getGroupUserType(b,function(b){a.groupUserType=b},function(a){})},a.moveToPreviousStep=function(){d.go("messagingGroup")},a.manageMessageGroupUser=function(a,b){a&&("GROUP_USER_INDIVIDUAL"===a?d.go("messagingOrgGroupUser",{type:c.type,organizationLocation:c.organizationLocation,menuNevigate:"msgGroup",msgGroup:c.msgGroup,groupUserType:a,whetherAdmin:!1}):"GROUP_USER_ORG"===a?d.go("messagingOrgGroupUser",{type:c.type,organizationLocation:c.organizationLocation,menuNevigate:"msgGroup",msgGroup:c.msgGroup,groupUserType:a,whetherAdmin:!0}):"GROUP_USER_CLIENT"===a&&d.go("messagingClientGroupUser",{type:c.type,organizationLocation:c.organizationLocation,menuNevigate:"msgGroup",msgGroup:c.msgGroup,groupUserType:a}))},a.inactivateMsgGroupUser=function(b,c,d){if(c){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("INACTIVE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){m.inactivateMsgGroupUser(c,function(b){f("success",g.instant("RECORD_EDITED_SUCESS")),a.searchMessageGroupUsers()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},function(){})}},a.removeMsgGroupUser=function(b,c,d){if(c){var e=h.confirm().title(g.instant("WARNING")).textContent(g.instant("REMOVE_CONFIRM_MESSAGE")).targetEvent(b).ok(g.instant("OK")).cancel(g.instant("CANCEL"));h.show(e).then(function(){m.removeMsgGroupUser(c,function(b){f("success",g.instant("MSG_USER_DELETED_SUCESSFULLY")),a.searchMessageGroupUsers()},function(a){f("error",g.instant("FAILED_TO_DELETE_RECORD"))})},function(){})}},
//Fetch records
a.fetchRecords=function(){a.searchMessageGroupUsers()},
//clear search
a.clear=function(){a.searchCriteria={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchMessageGroupUsers()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchMessageGroupUsers()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(n),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){"add"===c.type?a.pageState="add":"edit"===c.type?a.pageState="edit":"view"===c.type&&(a.pageState="view"),c.msgGroup?("view"!==c.type&&a.getGroupUserType(),a.groupId=c.msgGroup.id,a.groupName=c.msgGroup.name,a.groupType=c.msgGroup.groupType.value,a.organizationLocation=c.msgGroup.orgLocationName,a.searchMessageGroupUsers()):d.go("messagingGroup")},a.init()}]),angular.module("paripal.messagingModule").controller("MessagingListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messagingListService","featurePrivilegeConstants","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.htmlEditor="...",a.WSMsgCategory={},a.category={},a.subCategory={},a.WSMsgCategoryList=[],a.mangeProfTreatmentSpinner=!1,
//Search User Address
a.searchCategories=function(){a.mangeProfTreatmentSpinner=!0,a.WSMsgCategory.pageNumber=a.currentPage,a.WSMsgCategory.recordsPerPage=a.itemPerPage,a.category.data&&a.category.data.id&&(a.WSMsgCategory.category=a.category.data.id),a.subCategory.data&&a.subCategory.data.id&&(a.WSMsgCategory.subCategory=a.subCategory.data.id),m.searchCategories(a.WSMsgCategory,function(b){a.roleListSpinner=!1,a.WSMsgCategoryList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.roleListSpinner=!1,a.WSMsgCategoryList=[],a.totalItems=0,a.pagingInfo={}})},a.showCategory=function(a){d.go("messageSubCategory",{cat:a})},a.manageCategory=function(b,c,d,e){h.show({controller:"ManageCategoryCtrl",templateUrl:"app/modules/messaging/views/manage_category_sub_category.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:o.dialogBox.clickOutsideToClose,locals:{listData:{type:d,catType:e,category:c,parentScope:a}}}).then(function(){},function(){})},a.addTranslation=function(b,c,d,e){var f=JSON.stringify(c),g=JSON.parse(f);h.show({controller:"MsgCatTranslationCtrl",templateUrl:"app/modules/messaging/views/msg-cat-translation.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:o.dialogBox.clickOutsideToClose,locals:{listData:{type:d,catType:e,category:g,parentScope:a}}}).then(function(){},function(){})},a.inactivate=function(b){m.inactivate(b,function(b){f("sucess",g.instant("MESSAGE_CATEGORY_INACTIVATED")),a.searchCategories()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.activate=function(b){m.activate(b,function(b){f("sucess",g.instant("MESSAGE_CATEGORY_ACTIVATED")),a.searchCategories()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},
//Fetch records
a.fetchRecords=function(){a.searchCategories()},
//clear search
a.clear=function(){a.WSMsgCategory={},a.$broadcast("clearCatData"),a.searchCategories()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchCategories()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchCategories()};
//datatble config json
var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){c.cat&&(a.WSMsgCategory.subCategoryId=c.cat.id),a.searchCategories()},a.init()}]),angular.module("paripal.messagingModule").controller("MessagingManagementCtrl",["$scope","utilService","$rootScope",function(a,b,c){"use strict";if(!b.isNullOrEmpty(c.dashboardMenu)){a.parentMenus=c.dashboardMenu.children;for(var d=0;d<=a.parentMenus.length;d++)null!=a.parentMenus[d]&&"MESSAGING"==a.parentMenus[d].name&&(a.childMenus=a.parentMenus[d].children)}}]),angular.module("paripal.messagingModule").controller("MessagingReportListCtrl",["$scope","$rootScope","$stateParams","datatableconfig","notify","$translate","serverSidePagination","baseService","utilService","messagingReportListService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.searchCriteria.deliveryMode=0,a.WSMsgGroupList=[],a.msgGroupSpinner=!1,a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},
//Search messaging group list
a.searchMessageGroups=function(){a.msgGroupSpinner=!0,a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,j.searchMessageReports(a.searchCriteria,function(b){a.msgGroupSpinner=!1,a.WSMsgGroupList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.msgGroupSpinner=!1})},
//Fetch records
a.fetchRecords=function(){a.searchMessageGroups()},
//clear search
a.clear=function(){a.searchCriteria={}},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchMessageGroups()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchMessageGroups()};
//datatble config json
var l={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=d.setOptionProperties(l),a.dtColumnDefs=d.setColumnProperties({}),a.init=function(){a.searchMessageGroups()},a.init()}]),angular.module("paripal.messagingModule").controller("MessagingSubCatListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messagingListService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.htmlEditor="...",a.WSMsgCategory={},a.category={},a.subCategory={},a.WSMsgCategoryList=[],a.locId=null,a.mangeProfTreatmentSpinner=!1,a.searchCriteria={},a.searchCriteria.msgCategory={},a.msgCategory={queryUrl:"FIND_MSG_CATEGORY_BY_ACCESSIBLE_ORG_LOCATION_IDS",queryParameter:{},jsonParameter:{}},a.$watch("searchCriteria.msgCategory",function(b,c){b&&(a.locId=b.creatingOrgLocId)},!0),
//Search User Address
a.searchCategories=function(){a.mangeProfTreatmentSpinner=!0,a.WSMsgCategory.pageNumber=a.currentPage,a.WSMsgCategory.recordsPerPage=a.itemPerPage,a.searchCriteria.msgCategory&&a.searchCriteria.msgCategory.id&&(a.WSMsgCategory.categoryId=a.searchCriteria.msgCategory.id,m.searchSubCategories(a.WSMsgCategory,function(b){a.roleListSpinner=!1,a.WSMsgCategoryList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.roleListSpinner=!1,a.WSMsgCategoryList=[],a.totalItems=0,a.pagingInfo={}}))},a.manageCategory=function(b,c,d,e){"sub"===e&&"add"===d&&(c={id:a.searchCriteria.msgCategory.id,code:{code:a.searchCriteria.msgCategory.code,value:a.searchCriteria.msgCategory.value}}),h.show({controller:"ManageCategoryCtrl",templateUrl:"app/modules/messaging/views/manage_category_sub_category.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:n.dialogBox.clickOutsideToClose,locals:{listData:{type:d,catType:e,category:c,parentScope:a}}}).then(function(){},function(){})},a.showCategory=function(a){d.go("messageCategorySubCategory",{cat:a})},a.addTranslation=function(b,c,d,e){var f=JSON.stringify(c),g=JSON.parse(f);h.show({controller:"MsgCatTranslationCtrl",templateUrl:"app/modules/messaging/views/msg-cat-translation.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:n.dialogBox.clickOutsideToClose,locals:{listData:{type:d,catType:e,category:g,parentScope:a}}}).then(function(){},function(){})},a.inactivate=function(b){m.inactivate(b,function(b){f("sucess",g.instant("MESSAGE_SUB_CATEGORY_INACTIVATED")),a.searchCategories()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.activate=function(b){m.activate(b,function(b){f("sucess",g.instant("MESSAGE_SUB_CATEGORY_ACTIVATED")),a.searchCategories()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},
//Fetch records
a.fetchRecords=function(){a.searchCategories()},
//clear search
a.clear=function(){a.WSMsgCategory={},a.$broadcast("clearCatData"),a.searchCategories()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=j(a.currentPage,a.itemPerPage,a.totalItems),a.searchCategories()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchCategories()};
//datatble config json
var o={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(o),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){c.cat&&(a.searchCriteria.msgCategory={id:c.cat.id,code:c.cat.code.code,value:c.cat.code.value,creatingOrgLocId:c.cat.location.id}),a.searchCategories()},a.init()}]),angular.module("paripal.messagingModule").controller("MsgCatTranslationCtrl",["$scope","$rootScope","$mdDialog","$mdMedia","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","listData",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.WSMsgCategory={},a.language={},a.translateCategory=function(){var b=[],c=a.language.id,d={};d.itemCode=a.WSMsgCategory.code.code,d.translatedValue=a.WSMsgCategory.code.value,d.systemLanguageId=c,d.itemId=a.WSMsgCategory.id,d.translationTableType="COMMON",b.push(d),i.postData(j.getUrl("UPDATE_TRANSLATEDDATA"),b,function(b){b.data.successMessage&&(e("success",b.data.successMessage),a.cancel())},function(b){a.progress=!1,e("error","Some Error"),a.cancel()})},
// on cancel forward to search list
a.cancel=function(){c.cancel()},a.hide=function(){c.hide()},
//Init Method
a.init=function(){a.WSMsgCategory=l.category},a.init()}]),angular.module("paripal.messagingModule").controller("MsgNotificationCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","baseService","utilService","notificationMessagingService","$sce","$filter","$injector","httpService","$interval","$mdSelect",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";j.isEmpty(i.getLoggedInUser())||(a.userId=i.getLoggedInUser().id),a.findLatestNotificationByUserId=function(){q.hide();var b=n.get("baseService");a.userId=b.getLoggedInUser().id,k.findLatestNotificationByUserId(a.userId,function(b){a.WSLatestNotifications=b,angular.forEach(a.WSLatestNotifications,function(a,b){a.msgContent=atob(a.msgContent),a.msgContent=m("limitTo")(a.msgContent,20),/*value.msgContent = $sce.trustAsHtml(value.msgContent);*/
a.msgContent=a.messageContent})},function(b){a.error=b})},a.openMessage=function(c){if(c.whetherRead)if(k.getMsgCount(function(a){b.msgCount=a.unreadCount},function(a){}),1==c.whetherConversation){var e=i.getLoggedInUser(),f={to:e.displayName,from:c.userName,fromUserId:c.userId,toUserId:e.id,topicType:c.topicType,topic:c.topic,subject:c.subject,whetherConv:!0};d.go("msgconversation",{data:f})}else d.go("notification",{msgId:c.messageId,data:c});else k.getMsgCount(function(a){b.msgCount=a.unreadCount},function(a){}),k.changeMessageStatus(c.recipientMsgId,function(a){var b=i.getLoggedInUser();if(1==c.whetherConversation){var e={to:b.displayName,from:c.userName,fromUserId:c.userId,toUserId:b.id,topicType:c.topicType,topic:c.topic,subject:c.subject,whetherConv:!0};d.go("msgconversation",{data:e})}else d.go("notification",{msgId:c.messageId,data:c})},function(b){a.error=b})};var r=function(){a.userId&&(a.findLatestNotificationByUserId(),k.getMsgCount(function(a){b.msgCount=a.unreadCount},function(a){}))};a.messageModifer=function(a){return j.isFieldEmpty(a)||(a=a.replace(/\n|\t|<p>|&nbsp|<pre>|;/g," ")),l.trustAsHtml(a)},p(function(){j.isEmpty(i.getLoggedInUser())||i.getLoggedInUser().id&&r()},6e4),a.init=function(){r()},a.init()}]),angular.module("paripal.messagingModule").controller("MsgNotificationListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","baseService","utilService","notificationMessagingService","fileOperations","commonConstants","$sce","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.pagination={},a.pagination.currentPage=1,1==a.cardView?a.pagination.itemPerPage=12:a.pagination.itemPerPage=10,a.startRecord=(a.pagination.currentPage-1)*a.pagination.itemPerPage+1,a.endRecord=a.pagination.itemPerPage,a.pagingInfo={},a.isCordova="undefined"!=typeof cordova,
//$scope.currentPage = 1;
//$scope.itemPerPage = 10;
//$scope.startRecord = ($scope.currentPage - 1) * $scope.itemPerPage + 1;
//$scope.endRecord = $scope.itemPerPage;
//$scope.pagingInfo = {};
j.isEmpty(i.getLoggedInUser())||(a.userId=i.getLoggedInUser().id),a.professionalId=null,a.selected=[],a.exists=function(a,b){return b.indexOf(a.messageId)>-1},a.toggle=function(b,c){var d=c.indexOf(b.messageId);d>-1?c.splice(d,1):c.push(b.messageId),a.selected=c},a.findAllNotificationByUserId=function(){var c={};c.pageNumber=a.pagination.currentPage,c.recordsPerPage=a.pagination.itemPerPage,c.userId=a.userId,k.findAllNotificationByUserIdWithPagination(c,function(c){b.WSAllNotifications=c,a.pagination.totalItems=c.totalRecords,a.pagingInfo=h(a.pagination.currentPage,a.pagination.itemPerPage,a.pagination.totalItems),angular.forEach(a.WSAllNotifications,function(a,b){/*value.msgContent = atob(value.messageContent);*/
/*value.msgContent = $filter('limitTo')(value.messageContent, 50)*/
/*value.msgContent = $sce.trustAsHtml(value.msgContent);*/
j.isNullOrEmpty(a.messageContent)||(a.msgContent=a.messageContent)})},function(b){a.error=b},a.professionalId)},a.downloadAttachmentFile=function(a){if(!j.isEmpty(a)){var b=new Object;b.fileName=a.documentName,b.resourceId=a.documentId,b.recordId=a.msgEventConfigId,
//fileObject.docType = commonConstants.documentTypes.messaging;
// fileObject.docSubType = commonConstants.documentSubTypes.staticAttachment;
b.docType=a.type,b.docSubType=a.subType,b.orgLocId=a.orgLocId,j.isNullOrEmpty(a.userId)||(b.userId=a.userId),l.downloadFile(b,function(a){},function(a){})}},a.openMessage=function(c){c.whetherRead?p(c):k.changeMessageStatus(c.messageId,function(a){k.getMsgCount(function(a){b.msgCount=a.unreadCount},function(a){}),p(c)},function(b){a.error=b})};var p=function(a){if(1==a.whetherConversation){var b=i.getLoggedInUser(),e={to:b.displayName,from:a.userName,fromUserId:a.userId,toUserId:b.id,topicType:a.topicType,topic:a.topic,subject:a.subject,whetherConv:!0};d.go("msgconversation",{data:e})}else{var f={};f.msgId=a.messageId,f.data=a,f.fromState="notification","professionalwall"===c.type&&(f.fromState="professionalwall"),d.go("notification",f)}};a.back=function(){
//utilService.goBackToPrevState();
d.go("notificationlist")},a.deleteAllMessages=function(){k.deleteAllMessages(a.selected,function(b){a.findAllNotificationByUserId(),a.selected=[]},function(b){a.error=b})},a.deleteMessage=function(b){k.deleteMessages(b,function(a){d.go("notificationlist")},function(b){a.error=b})},a.getMessageData=function(b){k.getMessageDetails(b,function(b){a.WSNotificationData=b.data,a.WSNotificationData.msgContent=atob(a.WSNotificationData.msgContent),/*$scope.WSNotificationData.msgContent = $sce.trustAsHtml($scope.WSNotificationData.msgContent);*/
a.WSNotificationData.msgContent=a.WSNotificationData.messageContent,angular.forEach(a.WSNotificationData.msgDocuments,function(a,b){var c=a.documentName.indexOf(".");a.extension=a.documentName.substring(c+1)})},function(b){a.error=b})},a.messageModifer=function(a){return a=a.replace(/\n|\t|<p>|&nbsp|<pre>|;/g," "),n.trustAsHtml(a)},a.init=function(){"professionalwall"===c.type&&(a.fromProfessionalWall=!0,a.professionalId=c.user.id),a.userId&&a.findAllNotificationByUserId(),"notification"==c.fromState?a.getMessageData(c.msgId):"professionalwall"==c.fromState&&(a.getMessageData(c.msgId),a.fromProfessionalWall=!0)},a.init(),/* CARD VIEW CHANGES START */
a.listView=!0,1==a.isCordova||"true"==a.isCordova?a.cardView=!0:a.cardView=!1,a.btnText=g.instant("LIST_VIEW"),a.toggleView=function(){1==a.listView?(a.cardView=!0,a.listView=!1,a.btnText=g.instant("LIST_VIEW"),a.pagination.itemPerPage=12,a.findAllNotificationByUserId()):(a.cardView=!1,a.listView=!0,a.btnText=g.instant("CARD_VIEW"),a.pagination.itemPerPage=10,a.findAllNotificationByUserId())},/* CARD VIEW CHANGES END */
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.pagination.totalItems),a.findAllNotificationByUserId()},
//set page record
a.setMaxRecords=function(b){a.pagination.currentPage=1,a.pagination.itemPerPage=b,a.findAllNotificationByUserId()};
//datatble config json
var q={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(q),a.dtColumnDefs=e.setColumnProperties({})}]),angular.module("paripal.messagingModule").controller("MsgOrgLocClientListCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","datatableconfig","notify","$translate","serverSidePagination","utilService","msgOrgLocClientListService","messagingGroupUserListService","manageAdhocMessageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.addressInfoFilter={},a.orgLocationInfo={},a.user={},a.WSOrgLocationClientSearchCriteria={},a.WSOrgLocationClientSearchCriteria.whetherActive=!0,a.professionalList=["DOCTOR","SUPPORT_SERVICE_PROFESSIONAL","OTHER_HEALTH_SERVICE_PROFESSIONAL","COUNSELOR"],a.orglocclientlistSpinner=!1,a.clicked=!1,a.selected=[],a.organizationLocation={queryUrl:"GET_ORG_LOC_LIST_BY_KEYWORD",queryParameter:{},jsonParameter:{}},a.searchOrgLocClient=function(){var b;a.WSOrgLocationClientSearchCriteria.pageNumber=a.currentPage,a.WSOrgLocationClientSearchCriteria.recordsPerPage=a.itemPerPage,a.orglocclientlistSpinner=!0,a.user&&!j.isFieldEmpty(a.user.userDataInfo)&&(b=a.user.userDataInfo),k.searchOrgLocClient(a.WSOrgLocationClientSearchCriteria,a.orgLocationInfo,b,a.addressInfoFilter,function(b){a.orglocclientlistSpinner=!1,a.WSOrganizationLocationClient=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.orglocclientlistSpinner=!1,a.error=b})},a.exists=function(a,b){return b.indexOf(a.client.id)>-1},a.toggle=function(b,c){var d=c.indexOf(b.client.id);d>-1?c.splice(d,1):c.push(b.client.id),a.selected=c},a.addClientForMessagingGroup=function(b){j.isEmpty(c.groupUserType)||(a.selected&&a.selected.length>0?"msgGroup"===c.menuNevigate?l.saveMessageGroupUsers(c.msgGroup,c.groupUserType,a.selected,function(b){g("success",h.instant("MSG_USER_ADDED_SUCESSFULLY")),a.searchOrgLocClient()},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])?g("error",h.instant("FAILED_TO_SAVE_RECORD")):g("error",h.instant(a.data.messages[0]))}):"adhocMessage"===c.menuNevigate&&m.saveAdhocMessageUsers(c.adhocMsgEventConfigId,c.groupUserType,a.selected,function(b){g("success",h.instant("MSG_USER_ADDED_SUCESSFULLY")),a.searchOrgLocClient()},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])?g("error",h.instant("FAILED_TO_SAVE_RECORD")):g("error",h.instant(a.data.messages[0]))}):g("warning",h.instant("SELECT_USER_MANDATORY")))},a.moveToPreviousStep=function(){"msgGroup"===c.menuNevigate?d.go("messagingGroupUser",{type:c.type,organizationLocation:c.organizationLocation,msgGroup:c.msgGroup,groupUserType:c.groupUserType}):"adhocMessage"===c.menuNevigate&&d.go("showAdhocMessageRecipient",{type:c.type,organizationLocation:c.organizationLocation,adhocMsgEventConfigId:c.adhocMsgEventConfigId,displayCode:c.displayCode})},a.clear=function(){a.WSOrgLocationClientSearchCriteria.userName&&delete a.WSOrgLocationClientSearchCriteria.userName,a.WSOrgLocationClientSearchCriteria.validFrom&&delete a.WSOrgLocationClientSearchCriteria.validFrom,a.WSOrgLocationClientSearchCriteria.validTill&&delete a.WSOrgLocationClientSearchCriteria.validTill,a.addressInfoFilter={},
//$scope.orgLocationInfo = {};
a.user={},a.$broadcast("clearAddressData"),/* $scope.$broadcast("clearProfessionalData"); */
a.WSOrganizationLocationClient=[],a.searchOrgLocClient()},a.fetchRecords=function(){},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchOrgLocClient()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchOrgLocClient()};
//datatble config json
var n={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=f.setOptionProperties(n),a.dtColumnDefs=f.setColumnProperties({}),a.init=function(){j.isEmpty(c)||("msgGroup"===c.menuNevigate&&j.isEmpty(c.msgGroup)?d.go("messagingGroup"):"adhocMessage"===c.menuNevigate&&j.isNullOrEmpty(c.adhocMsgEventConfigId)?d.go("adhocMessages"):(a.orgLocationInfo=c.organizationLocation,a.searchOrgLocClient())),a.selected=c.userIds},a.init()}]),angular.module("paripal.messagingModule").controller("SearchSmsCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","datatableconfig","notify","$translate","serverSidePagination","utilService","msgOrgLocClientListService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchOrgLocClient()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchOrgLocClient()},
//datatble config json
a.options=f.setOptionProperties(l.gridConfigurations);var m=function(){};m()}]),angular.module("paripal.messagingModule").controller("TemplateConfigureCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messageEventListService","$document","otherDocumentService","fileOperations","$window","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";for(name in CKEDITOR.instances)CKEDITOR.instances[name].destroy();a.category="",a.subCategory="",a.event="",a.msgEventConfigId,a.templateList=[],a.template={},a.documentUploadFile={},a.language={},a.mangeProfTreatmentSpinner=!1,a.type=!1,
//Search User Address
CKEDITOR.editorConfig=function(a){a.language="en",a.uiColor="#F7B42C",a.height=300,a.toolbarCanCollapse=!0},a.dataChanged=function(){a.data},a.saveDocumentIdInDocumentTable=function(){if(a.selectedFileArray&&a.selectedFileArray.length>0){a.fileUploadSpinner=!0,a.selectedFileArray;var b={};b.documentType={},b.documentType.type=r.documentTypes.messaging,b.documentType.subType=r.documentSubTypes.staticAttachment,/**[TODO] : Change pagestate [NKL]
                 */
p.saveAllDocuments(b,!1,a.selectedFileArray,function(c){a.manageUserTestSpiner=!1,a.selectedFileArray&&a.selectedFileArray.length>0&&c?a.uploadFile(a.selectedFileArray,b,c):a.saveTemplate()},function(){a.fileUploadSpinner=!1,a.manageUserTestSpiner=!1})}else a.saveTemplate()},a.uploadFile=function(b,d,e){var h=new Object;h.docType=d.documentType.type,h.docSubType=d.documentType.subType,h.recordId=c.eventConfigId,e.response&&(h.resourceDetails=JSON.stringify(e.response)),p.uploadMultipleFiles(h,b,function(b){for(var d=e.response,f=new Array,g=0;g<d.length;g++){var h={};h.documentId=d[g].id,
// wsMsgEventAttachment.orgLocId = $scope.template.languageId;
h.fileName=d[g].value,h.msgEventConfig={},h.msgEventConfig.id=c.eventConfigId,f.push(h)}f.length>0&&a.uploadFiles(f)},function(b){a.fileUploadSpinner=!1,f("Error",g.instant("ERROR_WHILE_UPLOADING"))})},a.uploadFiles=function(b){m.uploadFiles(b,function(b){a.saveTemplate()},function(b){a.saveTemplate()})},a.saveTemplate=function(){"new"==c.type&&a.language.id&&a.template.languageId!==a.language.id?(a.template.languageId=a.language.id,m.saveNewTemplate(a.template,a.dynamicData,function(b){f("success",g.instant("RECORD_EDITED_SUCESS")),c.templateId=b,c.type=null,a.type=!0,a.language={},c.eventConfigId&&a.fetchAttachmentList()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})):m.saveTemplate(a.template,a.dynamicData,function(a){f("success",g.instant("RECORD_EDITED_SUCESS"))},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))}),a.init()},a.addDynamicData=function(){if(a.show=!0,a.subject&&a.data&&(a.template.subjectLine=a.template.subjectLine+" `"+a.data.value+"` "),a.content&&a.data){var b="<span> `"+a.data.value+"` </span>",c=CKEDITOR.dom.element.createFromHtml(b,s.document);s.insertElement(c),s.focus()}a.sms&&a.data&&(a.template.msgContent=a.template.msgContent+" `"+a.data.value+"` ")};var s;// A variable to store a reference to the current editor.
CKEDITOR.on("currentInstance",function(){s=CKEDITOR.currentInstance,a.subject=!1,a.content=!0}),a.addToSubject=function(){a.subject=!0,a.content=!1},a.addToMsg=function(){a.subject=!1,a.content=!1,a.sms=!0},a.getTemplate=function(b,c){m.getTemplate(b,c,function(b){a.template=b},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.fetchDynamicData=function(){c.templateId&&c.recipientTypeId&&m.fetchDynamicData(c.templateId,c.recipientTypeId,function(b){a.dynamicData=b,!c.msgEventConfigId&&c.templateId&&a.getTemplate(c.templateId,a.dynamicData)},function(a){})},a.fetchAttachmentList=function(){m.fetchAttachmentList(c.eventConfigId,null,function(b){a.selectedFileArray=b,angular.forEach(a.selectedFileArray,function(b){b.documentType=r.documentTypes.messaging,b.documentSubType=r.documentSubTypes.staticAttachment,b.recordId=c.eventConfigId,b.deleteCallBack=function(b){a.deleteFile(b)}})},function(a){})},a.deleteFile=function(a){m.deleteFile(a,function(a){f("success",g.instant("RECORD_DELETED_SUCCESSFULLY"))},function(a){})},a.init=function(){c.msgEventConfigId&&(a.msgEventConfigId=c.msgEventConfigId),c.cat&&(a.category=c.cat),c.subCat&&(a.subCategory=c.subCat),c.event&&(a.event=c.event),c.template&&(a.template=c.template),c.templateList&&(a.templateList=c.templateList),c.msgEventConfigId&&!c.templateList&&a.fetchTemplates(a.msgEventConfigId),c.type||(a.type=!0),c.eventConfigId&&a.fetchAttachmentList(),a.fetchDynamicData()},a.init()}]),angular.module("paripal.messagingModule").controller("TemplateOverrideConfigureCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","$mdDialog","$mdMedia","serverSidePagination","baseService","utilService","messageEventOverrideListService","$document","$window","messageEventListService","commonConstants","fileOperations",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";for(name in CKEDITOR.instances)CKEDITOR.instances[name].destroy();a.category="",a.subCategory="",a.event="",a.msgEventConfigId,a.templateList=[],a.template={},a.orgLoc={},a.type=!1,a.language={},a.mangeProfTreatmentSpinner=!1,a.language={},a.type=!1,
//Search User Address
CKEDITOR.editorConfig=function(a){a.language="en",a.uiColor="#F7B42C",a.height=300,a.toolbarCanCollapse=!0},a.saveTemplate=function(){"new"==c.type&&a.language.id&&a.template.languageId!==a.language.id?(a.template.languageId=a.language.id,p.saveNewTemplate(a.template,a.dynamicData,function(a){c.overriden=!0,f("success",g.instant("RECORD_EDITED_SUCESS")),l.goBackToPrevState()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})):m.saveTemplate(a.template,c.overriden,c.orgLocId,c.templateConfigId,a.dynamicData,function(a){c.overriden=!0,f("success",g.instant("RECORD_EDITED_SUCESS")),l.goBackToPrevState()},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.addDynamicData=function(){if(a.show=!0,a.subject&&a.data&&(a.template.subjectLine=a.template.subjectLine+" `"+a.data.value+"` "),a.content&&a.data){var b="<span> `"+a.data.value+"` </span>",c=CKEDITOR.dom.element.createFromHtml(b,s.document);s.insertElement(c),s.focus()}};var s;// A variable to store a reference to the current editor.
CKEDITOR.on("currentInstance",function(){s=CKEDITOR.currentInstance,a.subject=!1,a.content=!0}),a.addToSubject=function(){a.subject=!0,a.content=!1},a.addToMsg=function(){a.subject=!1,a.content=!1,a.sms=!0},a.getTemplate=function(b,c){m.getTemplate(b,c,function(b){a.template=b},function(a){f("error",g.instant("FAILED_TO_SAVE_RECORD"))})},a.fetchDynamicData=function(){m.fetchDynamicData(c.templateId,c.recipientTypeId,function(b){a.dynamicData=b,a.getTemplate(c.templateId,a.dynamicData)},function(a){})},a.fetchAttachmentList=function(){p.fetchAttachmentList(c.eventConfigId,c.orgLocId,function(b){a.selectedFileArray=b,angular.forEach(a.selectedFileArray,function(b){b.documentType=q.documentTypes.messaging,b.documentSubType=q.documentSubTypes.staticAttachment,b.recordId=c.eventConfigId,b.deleteCallBack=function(b){a.deleteFile(b)}})},function(a){})},a.deleteFile=function(a){p.deleteFile(a,function(a){f("success",g.instant("RECORD_DELETED_SUCCESSFULLY"))},function(a){})},a.saveDocumentIdInDocumentTable=function(){if(a.selectedFileArray&&a.selectedFileArray.length>0){a.fileUploadSpinner=!0,a.selectedFileArray;var b={};b.documentType={},b.documentType.type=q.documentTypes.messaging,b.documentType.subType=q.documentSubTypes.staticAttachment,/**[TODO] : Change pagestate [NKL]
                 */
r.saveAllDocuments(b,!1,a.selectedFileArray,function(c){a.manageUserTestSpiner=!1,a.selectedFileArray&&a.selectedFileArray.length>0&&c?a.uploadFile(a.selectedFileArray,b,c):a.saveTemplate()},function(){a.fileUploadSpinner=!1,a.manageUserTestSpiner=!1})}else a.saveTemplate()},a.uploadFile=function(b,d,e){var h=new Object;h.docType=d.documentType.type,h.docSubType=d.documentType.subType,h.recordId=c.eventConfigId,e.response&&(h.resourceDetails=JSON.stringify(e.response)),r.uploadMultipleFiles(h,b,function(b){for(var d=e.response,f=new Array,g=0;g<d.length;g++){var h={};h.documentId=d[g].id,
// wsMsgEventAttachment.orgLocId = $scope.template.languageId;
h.fileName=d[g].value,h.msgEventConfig={},h.msgEventConfig.id=c.eventConfigId,h.orgLocId=c.orgLocId,h.documentSubType="SYSTEM_EVENT_DOCUMENT",f.push(h)}f.length>0&&a.uploadFiles(f)},function(b){a.fileUploadSpinner=!1,f("Error",g.instant("ERROR_WHILE_UPLOADING"))})},a.uploadFiles=function(b){p.uploadFiles(b,function(b){a.saveTemplate()},function(b){a.saveTemplate()})},a.init=function(){c.msgEventConfigId&&(a.msgEventConfigId=c.msgEventConfigId),c.cat&&(a.category=c.cat),c.subCat&&(a.subCategory=c.subCat),c.event&&(a.event=c.event),c.template&&(a.template=c.template),c.orgLoc&&(a.orgLoc=c.orgLoc),c.templateList&&(a.templateList=c.templateList),!c.templateList&&a.msgEventConfigId&&c.orgLocId&&a.fetchTemplates(a.msgEventConfigId,c.orgLocId),c.type||(a.type=!0),c.eventConfigId&&a.fetchAttachmentList(),a.fetchDynamicData()},a.init()}]),angular.module("paripal.messagingModule").service("adhocMessageRecipientService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchMessageGroups=function(c,d,e){a.postData(b.getUrl("ADHOC_MESSAGE_GROUP_FIND_BY_ID"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.searchMessageGroupUsers=function(c,d,e){a.postData(b.getUrl("ADHOC_MESSAGE_USER_FIND_BY_ID"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteAdhocMessageGroup=function(c,d,e){if(c){var f={adhocMsgGroupId:c};a.deleteData(b.getQueryParameterizedUrl("DELETE_ADHOC_MESSAGE_GROUP",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}},this.deleteAdhocMessageUsers=function(c,d,e){if(c){var f={adhocMsgRecepientId:c};a.deleteData(b.getQueryParameterizedUrl("DELETE_ADHOC_MESSAGE_USER",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}},this.sendAdhocMessage=function(c,d,e){var f={id:c};a.postData(b.getUrl("SEND_ADHOC_MESSAGE"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.messagingModule").service("adhocMessagingListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchAdhocMessages=function(c,d,f,g){var h={};h.displayCode=c.name,e.isEmpty(c.category)||(h.msgCategoryId=c.category.id),e.isEmpty(c.subCategory)||(h.msgSubCategoryId=c.subCategory.id),e.isEmpty(c.organizationLocation)||(h.orgLocId=c.organizationLocation.id),e.isFieldEmpty(d)||(h.authorId=d),h.pageNumber=c.pageNumber,h.recordsPerPage=c.recordsPerPage,a.postData(b.getUrl("SEARCH_ADOHOC_MESSAGE"),h,function(a){a&&a.data?f(a.data):g(a)},function(a){g(a)})}}]),angular.module("paripal.messagingModule").service("adhocMsgGroupListService",["httpService","urlService","utilService","dateconvertor","$filter",function(a,b,c,d,e){"use strict";this.searchMessageGroups=function(d,e,f){var g=angular.copy(d);c.isEmpty(g.organizationLocation)||delete g.organizationLocation,a.postData(b.getUrl("SEARCH_MESSAGE_GROUP"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.messagingModule").service("customizeMsgGroupUserService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchMessageGroupUsers=function(c,d,e){a.postData(b.getUrl("SEARCH_CUSTOMIZE_ADHOC_MSG_GROUP_USER"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.activateMsgGroupUser=function(c,d,e,f){var g={};g.id=c,g.msgGroupUserIds=d,a.postData(b.getParameterizedUrl("ACTIVATE_CUSTOMIZE_ADHOC_MSG_GROUP_USER",null),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.inActivateMsgGroupUser=function(c,d,e,f){var g={};g.id=c,g.msgGroupUserIds=d,a.postData(b.getParameterizedUrl("INACTIVATE_CUSTOMIZE_ADHOC_MSG_GROUP_USER",null),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.messagingModule").service("manageAdhocMessageService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveAdhocMessageForm=function(c,e,f,g){var h={};h.id=c.id,h.displayCode=c.displayCode,h.msgSubCategory={id:c.msgSubCategory.id},h.whetherScheduled=c.whetherScheduled,h.orgLocId=c.organizationLocation.id,/*if (!utilService.isNullOrEmpty(WSAdhocMessage.msgDueTime)) {
                var date = new Date(WSAdhocMessage.msgDueTime);
                msgDuetime = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
            }
            if (!utilService.isNullOrEmpty(WSAdhocMessage.msgDueDate)) {
                adhocMessageObj.msgDueDate = dateconvertor.convertToServerDate(WSAdhocMessage.msgDueDate);
                adhocMessageObj.msgDueDate = adhocMessageObj.msgDueDate + " " + msgDuetime;
            }
            if(!utilService.isNullOrEmpty(adhocMessageObj.msgDueDate) &&  Date.parse(adhocMessageObj.msgDueDate) < new Date()){
                notify("warning", $translate.instant("PLEASE_ENTER_DATE_MORE_THAN_CURRENT_DATE_TIME"));
                return;
            }*/
h.msgDueDate=null,c.whetherScheduled&&!d.isNullOrEmpty(c.scheduledDateTime)&&(h.msgDueDate=c.scheduledDateTime),h.msgTemplateConfig={id:c.msgTemplateConfig.id},h.msgTemplateConfig.templateConfigName=c.displayCode;var i=[];if(!d.isNullOrEmpty(c.email.msgContent)){var j={id:c.email.id,msgContent:c.email.msgContent,msgDeliveryMode:c.email.msgDeliveryMode,subjectLine:c.email.subjectLine,languageId:c.email.languageId};i.push(j)}if(!d.isNullOrEmpty(c.sms.msgContent)){var k={id:c.sms.id,msgContent:c.sms.msgContent,msgDeliveryMode:c.sms.msgDeliveryMode,languageId:c.sms.languageId};i.push(k)}if(!d.isNullOrEmpty(c.notification.msgContent)){var l={id:c.notification.id,msgContent:c.notification.msgContent,msgDeliveryMode:c.notification.msgDeliveryMode,subjectLine:c.notification.subjectLine,languageId:c.notification.languageId};i.push(l)}h.msgTemplateConfig.messageTemplates=i,h.adhocMsgDynamicAttachments=c.adhocMsgDynamicAttachments,h.eventAttachments=c.eventAttachments,h.status=c.status;"add"===e?a.postData(b.getUrl("SAVE_ADHOC_MESSAGE"),h,function(a){f(a.data)},function(a){g(a)}):"edit"===e&&a.putData(b.getUrl("UPDATE_ADHOC_MESSAGE"),h,function(a){f(a.data)},function(a){g(a)})},this.getAdhocMessageDetails=function(c,d){var e={};e.adhocMsgEventConfigId=c,a.getData(b.getParameterizedUrl("ADHOC_MESSAGE_FIND_BY_ID",e),null,function(a){d(a&&a.data?a.data:a)},function(a){})},this.getSubCatagoryByCode=function(c,d,e){var f={};f.subCategoryCode=c,a.getData(b.getParameterizedUrl("GET_CATAGORY_ID_BY_SUB_CATAGORY_CODE",f),null,function(a){d(a)},function(a){e(a)})},this.getMsgDeliveryMode=function(c){a.getData(b.getParameterizedUrl("FIND_ALL_MESSAGE_DELIVERY_MODE",null),null,function(a){c(a&&a.data?a.data:a)},function(a){})},this.saveAdhocMessageGroup=function(c,d,e,f){var g={adhocMsgEventConfigId:c,msgGroupIds:d};a.postData(b.getUrl("SAVE_ADHOC_MESSAGE_GROUP"),g,function(a){e(a.data)},function(a){f(a)})},this.saveAdhocMessageUsers=function(c,d,e,f,g,h,i,j,k){var l={};l="CLIENT"==j?{adhocMsgEventConfigId:c,groupUserType:{code:d},userIds:e,organizationLocationId:h,whetherSendToAllClient:i}:"ORG_USER"==j?{adhocMsgEventConfigId:c,groupUserType:{code:d},userIds:e,organizationLocationId:h,whetherSendToAllInternalUser:i}:{adhocMsgEventConfigId:c,groupUserType:{code:d},userIds:e,organizationLocationId:h},k&&(k.genderId&&(l.genderId=k.genderId),k.maxAge&&(l.maxAge=k.maxAge),k.minAge&&(l.minAge=k.minAge),k.userName&&(l.userName=k.userName),k.whetherActive?l.whetherActive=k.whetherActive:l.whetherActive=!1,k.whetherOtherHealthSrvcPrfssnl?l.whetherOtherHealthSrvcPrfssnl=k.whetherOtherHealthSrvcPrfssnl:l.whetherOtherHealthSrvcPrfssnl=!1,k.whetherSupportSrvcPrfssnl?l.whetherSupportSrvcPrfssnl=k.whetherSupportSrvcPrfssnl:l.whetherSupportSrvcPrfssnl=!1,k.clientCategoryId1&&(l.clientCategoryId1=k.clientCategoryId1.id),k.clientCategoryId2&&(l.clientCategoryId2=k.clientCategoryId2.id),k.clientCategoryId3&&(l.clientCategoryId3=k.clientCategoryId3.id),k.healthCategoryId1&&(l.healthCategoryId1=k.healthCategoryId1.id),k.healthCategoryId2&&(l.healthCategoryId2=k.healthCategoryId2.id),k.healthCategoryId3&&(l.healthCategoryId3=k.healthCategoryId3.id),k.healthCategoryId4&&(l.healthCategoryId4=k.healthCategoryId4.id),k.healthCategoryId5&&(l.healthCategoryId5=k.healthCategoryId5.id),k.supportCategoryId1&&(l.supportCategoryId1=k.supportCategoryId1.id),k.supportCategoryId2&&(l.supportCategoryId2=k.supportCategoryId2.id),k.supportCategoryId3&&(l.supportCategoryId3=k.supportCategoryId3.id),k.supportCategoryId4&&(l.supportCategoryId4=k.supportCategoryId4.id),k.supportCategoryId5&&(l.supportCategoryId5=k.supportCategoryId5.id)),a.postData(b.getUrl("SAVE_ADHOC_MESSAGE_USER"),l,function(a){f(a.data)},function(a){g(a)})},this.getUserRecipientType=function(c){a.getData(b.getParameterizedUrl("ADHOC_MESSAGE_USER_RECIPIENT",null),null,function(a){c(a&&a.data?a.data:a)},function(a){})},this.saveConversationMessageForm=function(c,e,f,g){var h={};h.id=c.id,h.displayCode=c.displayCode,h.msgSubCategory={code:c.msgSubCategory.code},h.whetherScheduled=c.whetherScheduled,h.orgLocId=c.organizationLocation.id,/*if (!utilService.isNullOrEmpty(WSAdhocMessage.msgDueTime)) {
                var date = new Date(WSAdhocMessage.msgDueTime);
                msgDuetime = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
            }
            if (!utilService.isNullOrEmpty(WSAdhocMessage.msgDueDate)) {
                adhocMessageObj.msgDueDate = dateconvertor.convertToServerDate(WSAdhocMessage.msgDueDate);
                adhocMessageObj.msgDueDate = adhocMessageObj.msgDueDate + " " + msgDuetime;
            }
            if(!utilService.isNullOrEmpty(adhocMessageObj.msgDueDate) &&  Date.parse(adhocMessageObj.msgDueDate) < new Date()){
                notify("warning", $translate.instant("PLEASE_ENTER_DATE_MORE_THAN_CURRENT_DATE_TIME"));
                return;
            }*/
c.whetherScheduled&&!d.isNullOrEmpty(c.scheduledDateTime)&&(h.msgDueDate=c.scheduledDateTime),h.msgTemplateConfig={id:c.msgTemplateConfig.id},h.msgTemplateConfig.templateConfigName=c.displayCode;var i=[];if(!d.isNullOrEmpty(c.email.msgContent)){var j={id:c.email.id,msgContent:c.email.msgContent,msgDeliveryMode:c.email.msgDeliveryMode,subjectLine:c.email.subjectLine,languageId:c.email.languageId};i.push(j)}if(!d.isNullOrEmpty(c.sms.msgContent)){var k={id:c.sms.id,msgContent:c.sms.msgContent,msgDeliveryMode:c.sms.msgDeliveryMode,languageId:c.sms.languageId};i.push(k)}if(!d.isNullOrEmpty(c.notification.msgContent)){var l={id:c.notification.id,msgContent:c.notification.msgContent,msgDeliveryMode:c.notification.msgDeliveryMode,subjectLine:c.notification.subjectLine,languageId:c.notification.languageId};i.push(l)}h.msgTemplateConfig.messageTemplates=i,h.adhocMsgDynamicAttachments=c.adhocMsgDynamicAttachments,h.eventAttachments=c.eventAttachments,h.status=c.status,h.topic=c.topic,h.topicType=c.topicType,h.authorId=c.authorId,h.authorName=c.authorName;"add"===e?a.postData(b.getUrl("SAVE_ADHOC_MESSAGE"),h,function(a){f(a.data)},function(a){g(a)}):"edit"===e&&a.putData(b.getUrl("UPDATE_ADHOC_MESSAGE"),h,function(a){f(a.data)},function(a){g(a)})}}]),angular.module("paripal.messagingModule").service("manageCategoryService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveCategory=function(c,d,e,f,g,h){if(c.msgCategory&&c.msgCategory.id){var i=c.msgCategory.id;c.msgCategory={},c.msgCategory.id=i}d.data&&d.data.id&&(c.location={},c.location.id=d.data.id),a.postData(b.getUrl("ADD_MSG_CATEGORY"),c,function(a){g(a.data)},function(a){h(a)})}}]),angular.module("paripal.messagingModule").service("manageMsgGroupService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveMsgGroup=function(c,d,e,f){var g=angular.copy(c);g.organizationLocation&&g.organizationLocation.id&&(g.creatingOrgLocId=g.organizationLocation.id,g.orgLocationName=g.organizationLocation.value,delete g.organizationLocation);"add"===d?a.postData(b.getUrl("ADD_MESSAGE_GROUP"),g,function(a){e(a.data)},function(a){f(a)}):"edit"===d&&a.putData(b.getUrl("UPDATE_MESSAGE_GROUP"),g,function(a){e(a.data)},function(a){f(a)})},this.getMsgGroupDetails=function(c,d){var e={};e.msgGroupId=c,a.getData(b.getParameterizedUrl("FIND_MESSAGE_GROUP_BY_ID",e),null,function(a){d(a&&a.data?a.data:a)},function(a){})}}]),angular.module("paripal.messagingModule").service("messageConversationListService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.getMsgConversationList=function(c,d){a.postData(b.getUrl("GET_MSG_CONVERSATION_LIST"),c,function(a){d(a&&a.data?a.data:a)},function(a){})}}]),angular.module("paripal.messagingModule").service("messageEventListService",["$rootScope","httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e,f){"use strict";this.searchEvents=function(a,d,e){b.postData(c.getUrl("SEARCH_MESSAGE_EVENT_PRECONFIG"),a,function(a){a.data&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchTemplates=function(a,d,e){var f={};f.msgEventConfigId=a,b.getData(c.getParameterizedUrl("MESSAGE_EVENT_TEMPLATE",f),null,function(a){a.data&&a.data?d(a.data):e(a)},function(a){e(a)})},this.inactivate=function(a,d,e){var f={};f.id=a,b.getData(c.getParameterizedUrl("INACTIVATE_SUB_MESSAGE_CATEGORY",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getEventById=function(a,d,f){var g={};g.id=a;var h="MM/dd/yyyy";b.getData(c.getParameterizedUrl("GET_HEALTH_PRO_REVIEW_BY_ID",g),null,function(a){a&&a.data?(a.data.reviewDate=e("timestampToDate")(a.data.reviewDate,h),d(a.data)):f(a)},function(a){f(a)})},this.fetchDynamicData=function(d,e,f,g){var h={};h.templateId=d,h.recipientTypeId=e,h.langId=a.userSelectedLanguage.id,b.getData(c.getParameterizedUrl("GET_DYNAMIC_DATA",h),null,function(a){a&&a.data?f(a.data):g(a)},function(a){g(a)})},this.getTemplate=function(a,d,e,g){var h={};h.id=a;b.getData(c.getParameterizedUrl("GET_TEMPLATE_BY_ID",h),null,function(a){if(a&&a.data){if(!f.isFieldEmpty(a.data.subjectLine)){var b=a.data.subjectLine.split(/[``]/);if(b.length>0&&d)for(var c=0;c<b.length;c++)for(var h=0;h<d.length;h++)if(b[c]==d[h].code){var i="`"+d[h].code+"`",j="`"+d[h].value+"`";a.data.subjectLine=a.data.subjectLine.replace(new RegExp(i,"g"),j)}}if(b=a.data.msgContent.split(/[``]/),b.length>0&&d)for(var c=0;c<b.length;c++)for(var h=0;h<d.length;h++)if(b[c]==d[h].code){var i="`"+d[h].code+"`",j="`"+d[h].value+"`";a.data.msgContent=a.data.msgContent.replace(new RegExp(i,"g"),j)}e(a.data)}else g(a)},function(a){g(a)})},this.saveTemplate=function(a,d,e,f){var g=a.subjectLine.split(/[``]/);if(g.length>0)for(var h=0;h<g.length;h++)for(var i=0;i<d.length;i++)if(g[h]==d[i].value){var j="`"+d[i].code+"`",k="`"+d[i].value+"`";a.subjectLine=a.subjectLine.replace(new RegExp(k,"g"),j)}if(g=a.msgContent.split(/[``]/),g.length>0)for(var h=0;h<g.length;h++)for(var i=0;i<d.length;i++)if(g[h]==d[i].value){var j="`"+d[i].code+"`",k="`"+d[i].value+"`";a.msgContent=a.msgContent.replace(new RegExp(k,"g"),j)}var l=null,m={};m.id=a.id,l=c.getParameterizedUrl("UPDATE_TEMPLATE",m),l&&b.putData(l,a,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.saveNewTemplate=function(a,d,e,f){var g=a.subjectLine.split(/[``]/);if(g.length>0)for(var h=0;h<g.length;h++)for(var i=0;i<d.length;i++)if(g[h]==d[i].value){var j="`"+d[i].code+"`",k="`"+d[i].value+"`";a.subjectLine=a.subjectLine.replace(new RegExp(k,"g"),j)}if(g=a.msgContent.split(/[``]/),g.length>0)for(var h=0;h<g.length;h++)for(var i=0;i<d.length;i++)if(g[h]==d[i].value){var j="`"+d[i].code+"`",k="`"+d[i].value+"`";a.msgContent=a.msgContent.replace(new RegExp(k,"g"),j)}var l=null,m={};m.id=a.id,l=c.getParameterizedUrl("SAVE_TEMPLATE",m),l&&b.putData(l,a,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.uploadFiles=function(a,d,e){var f=c.getUrl("UPDATE_ATTACHMENT");f&&b.postData(f,a,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchAttachmentList=function(a,d,e,f){var g=null,h={};h.msgEventConfigId=a,h.orgLocId=d,d||(h.orgLocId=-1),g=c.getParameterizedUrl("LIST_TEMPLATE_ATTACHMENT",h),g&&b.getData(g,null,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.deleteFile=function(a,d,e){var f=null,g={};g.id=a,f=c.getParameterizedUrl("MESSAGE_EVENT_ATTACHMENT_DELETE",g),f&&b.getData(f,null,function(a){d(a)},function(a){e(a)})},this.saveEventConfig=function(a,d,e){var f=null,g={};g.id=a.id,f=c.getParameterizedUrl("UPDATE_MSG_EVENT_SETTING",g),f&&b.putData(f,a,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.messagingModule").service("messageEventOverrideListService",["httpService","urlService","dateconvertor","$filter","$rootScope",function(a,b,c,d,e){"use strict";this.searchEvents=function(c,d,e,f){d&&d.id&&(c.orgLocId=d.id),a.postData(b.getUrl("SEARCH_MESSAGE_EVENT_OVERRIDE"),c,function(a){a.data&&a.data?e(a.data):f(a)},function(a){f(a)})},this.fetchTemplates=function(c,d,e,f){var g={};g.msgEventConfigId=c,g.orgLocId=d,a.getData(b.getParameterizedUrl("MESSAGE_OVEERRIDE_EVENT_TEMPLATE",g),null,function(a){a.data&&a.data?e(a.data):f(a)},function(a){f(a)})},this.activate=function(c,d,e,f){var g={};g.msgEventId=c,g.orgLocId=d,a.getData(b.getParameterizedUrl("ACTIVATE_MESSAGE_OVERRIDE",g),null,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.inactivate=function(c,d,e,f){var g={};g.msgEventId=c,g.orgLocId=d,a.getData(b.getParameterizedUrl("INACTIVATE_MESSAGE_OVERRIDE",g),null,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.override=function(c,d,e,f){var g={};g.msgEventId=c,g.orgLocId=d,a.getData(b.getParameterizedUrl("OVERRIDE_MSG_EVENT",g),null,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this["default"]=function(c,d,e,f){var g={};g.msgEventId=c,g.orgLocId=d,a.getData(b.getParameterizedUrl("DEFAULT_MSG_EVENT",g),null,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.getEventById=function(c,e,f){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_HEALTH_PRO_REVIEW_BY_ID",g),null,function(a){a&&a.data?(a.data.reviewDate=d("timestampToDate")(a.data.reviewDate,h),e(a.data)):f(a)},function(a){f(a)})},this.fetchDynamicData=function(c,d,f,g){var h={};h.templateId=c,h.recipientTypeId=d,h.langId=e.userSelectedLanguage.id,a.getData(b.getParameterizedUrl("GET_DYNAMIC_DATA",h),null,function(a){a&&a.data?f(a.data):g(a)},function(a){g(a)})},this.getTemplate=function(c,d,e,f){var g={};g.id=c;a.getData(b.getParameterizedUrl("GET_TEMPLATE_BY_ID",g),null,function(a){if(a&&a.data){if(null!=a.data.subjectLine){var b=a.data.subjectLine.split(/[``]/);if(b.length>0&&d)for(var c=0;c<b.length;c++)for(var g=0;g<d.length;g++)if(b[c]==d[g].code){var h="`"+d[g].code+"`",i="`"+d[g].value+"`";a.data.subjectLine=a.data.subjectLine.replace(new RegExp(h,"g"),i)}}if(b=a.data.msgContent.split(/[``]/),b.length>0&&d)for(var c=0;c<b.length;c++)for(var g=0;g<d.length;g++)if(b[c]==d[g].code){var h="`"+d[g].code+"`",i="`"+d[g].value+"`";a.data.msgContent=a.data.msgContent.replace(new RegExp(h,"g"),i)}e(a.data)}else f(a)},function(a){f(a)})},this.saveTemplate=function(c,d,e,f,g,h,i){var j=c.subjectLine.split(/[``]/);if(j.length>0)for(var k=0;k<j.length;k++)for(var l=0;l<g.length;l++)if(j[k]==g[l].value){var m="`"+g[l].code+"`",n="`"+g[l].value+"`";c.subjectLine=c.subjectLine.replace(new RegExp(n,"g"),m)}if(j=c.msgContent.split(/[``]/),j.length>0)for(var k=0;k<j.length;k++)for(var l=0;l<g.length;l++)if(j[k]==g[l].value){var m="`"+g[l].code+"`",n="`"+g[l].value+"`";c.msgContent=c.msgContent.replace(new RegExp(n,"g"),m)}var o=null,p={};p.id=c.id,p.orgLocId=e,p.templateConfigId=f,c.overriden=d,o=b.getParameterizedUrl("UPDATE_TEMPLATE_OVERRIDE",p),o&&a.putData(o,c,function(a){a&&a.data?h(a.data):i(a)},function(a){i(a)})},this.saveNewTemplate=function(c,d,e,f,g,h,i){var j=c.subjectLine.split(/[``]/);if(j.length>0)for(var k=0;k<j.length;k++)for(var l=0;l<g.length;l++)if(j[k]==g[l].value){var m="`"+g[l].code+"`",n="`"+g[l].value+"`";c.subjectLine=c.subjectLine.replace(new RegExp(n,"g"),m)}if(j=c.msgContent.split(/[``]/),j.length>0)for(var k=0;k<j.length;k++)for(var l=0;l<g.length;l++)if(j[k]==g[l].value){var m="`"+g[l].code+"`",n="`"+g[l].value+"`";c.msgContent=c.msgContent.replace(new RegExp(n,"g"),m)}var o=null,p={};p.id=c.id,p.orgLocId=e,p.templateConfigId=f,c.overriden=d,o=b.getParameterizedUrl("SAVE_TEMPLATE_OVERRIDE",p),o&&a.putData(o,c,function(a){a&&a.data?h(a.data):i(a)},function(a){i(a)})},this.saveEventConfig=function(c,d,e){var f=null,g={};g.id=c.id,f=b.getParameterizedUrl("UPDATE_MSG_EVENT_SETTING",g),f&&a.putData(f,c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.messagingModule").service("messageEvtSubService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchEventSubscription=function(c,d,e){/*var jsonObj = {};
            jsonObj.userId = userId;*/
//httpService.postData(urlService.getUrl('GET_EVENT_SUB_BY_USER_ID'), userObj, function (response) {
a.postData(b.getUrl("GET_EVENT_SUB_BY_USER_ID_RECP_TYPE"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.subscribe=function(c,d,e){a.postData(b.getParameterizedUrl("MANAGE_EVENT_SUB_BY"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.messagingModule").service("messageOrgUserListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchUsers=function(c,d,e,f,g,h){d.whetherAllStatus&&"true"===d.whetherAllStatus?d.whetherAllStatus=!0:d.whetherAllStatus=!1,e&&(e.cityValue&&e.cityValue.id&&(d.cityId=e.cityValue.id),e.districtValue&&e.districtValue.id&&(d.districtId=e.districtValue.id),e.stateValue&&e.stateValue.id&&(d.stateId=e.stateValue.id),e.countryValue&&e.countryValue.id&&(d.countryId=e.countryValue.id),e.postalCode&&(d.postalCode=e.postalCode)),f&&(d.organizationLocationId=f.id);var i="SEARCH_MESSAGING_ORG_LOC_USERS";c&&(i="GET_ALL_INDIVIDUAL_USERS",delete d.whetherAllStatus,delete d.whetherAdmin,delete d.organizationLocationId),a.postData(b.getUrl(i),d,function(a){a.data&&a.data.data?g(a.data):h(a)},function(a){h(a)})},this.searchOrgUsers=function(c,d,e,f,g){c.whetherAllStatus&&"true"===c.whetherAllStatus?c.whetherAllStatus=!0:c.whetherAllStatus=!1,d&&(d.cityValue&&d.cityValue.id&&(c.cityId=d.cityValue.id),d.districtValue&&d.districtValue.id&&(c.districtId=d.districtValue.id),d.stateValue&&d.stateValue.id&&(c.stateId=d.stateValue.id),d.countryValue&&d.countryValue.id&&(c.countryId=d.countryValue.id),d.postalCode&&(c.postalCode=d.postalCode)),e&&(c.organizationLocationId=e.id),a.postData(b.getUrl("GET_LIST_OF_ORG_USERS_FOR_IND_ADHOC_MSG"),c,function(a){a.data&&a.data.data?f(a.data):g(a)},function(a){g(a)})},this.searchStackHolders=function(c,d,e){c.whetherActive=!0,a.postData(b.getUrl("GET_LIST_OF_STACK_HOLDERS_FOR_IND_ADHOC_MSG"),c,function(a){a.data&&a.data.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.messagingModule").service("messagingFailureListService",["httpService","urlService","dateconvertor","$filter","utilService",function(a,b,c,d,e){"use strict";this.searchFailedMessages=function(c,d,f){var g={};g.displayCode=c.name,e.isEmpty(c.senderData)||(g.sender=c.senderData),e.isEmpty(c.recipientData)||(g.recipient=c.recipientData),e.isEmpty(c.category)||(g.msgCategory=c.category),e.isEmpty(c.subCategory)||(g.msgSubCategory=c.subCategory),e.isEmpty(c.organizationLocation)||(g.orgLocId=c.organizationLocation.id),e.isEmpty(c.validFrom)||(g.validFrom=c.validFrom),e.isEmpty(c.validTill)||(g.validTill=c.validTill),e.isEmpty(c.status)||(g.status=c.status),g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,a.postData(b.getUrl("SEARCH_MESSAGES_STATUS"),g,function(a){a&&a.data?d(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.messagingModule").service("messagingGroupListService",["httpService","urlService","utilService","dateconvertor","$filter",function(a,b,c,d,e){"use strict";this.searchMessageGroups=function(d,e,f){var g=angular.copy(d);c.isEmpty(g.organizationLocation)||(g.creatingOrgLocId=g.organizationLocation.id),delete g.organizationLocation,a.postData(b.getUrl("SEARCH_MESSAGE_GROUP"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.inactivateMsgGroup=function(c,d,e){var f={};f.msgGroupId=c,a.putData(b.getParameterizedUrl("INACTIVATE_MESSAGE_GROUP",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.activateMsgGroup=function(c,d,e){var f={};f.msgGroupId=c,a.putData(b.getParameterizedUrl("ACTIVATE_MESSAGE_GROUP",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.messagingModule").service("messagingGroupUserListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchMessageGroupUsers=function(c,d,e){a.postData(b.getUrl("SEARCH_MESSAGE_GROUP_USER"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.inactivateMsgGroupUser=function(c,d,e){var f={};f.msgGroupUserId=c,a.putData(b.getParameterizedUrl("INACTIVATE_MESSAGE_GROUP_USER",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.removeMsgGroupUser=function(c,d,e){var f={};f.msgGroupUserId=c,a.deleteData(b.getParameterizedUrl("REMOVE_MESSAGE_GROUP_USER",f),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.getGroupUserType=function(c,d,e){a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveMessageGroupUsers=function(c,d,e,f,g){var h={wsMsgGroup:{id:c.id},groupUserType:{code:d},userIds:e};a.postData(b.getUrl("SAVE_MESSAGE_GROUP_USER"),h,function(a){f(a.data)},function(a){g(a)})}}]),angular.module("paripal.messagingModule").service("messagingListService",["$rootScope","httpService","urlService","dateconvertor","$filter",function(a,b,c,d,e){"use strict";this.searchCategories=function(d,e,f){d.langId=a.userSelectedLanguage.id,b.postData(c.getUrl("SEARCH_MESSAGE_CATEGORY"),d,function(a){d.categoryId=null,d.subCategoryId=null,a.data&&a.data?e(a.data):f(a)},function(a){d.categoryId=null,d.subCategoryId=null,f(a)})},this.searchSubCategories=function(d,e,f){d.langId=a.userSelectedLanguage.id,b.postData(c.getUrl("SEARCH_MESSAGE_SUB_CATEGORY"),d,function(a){d.categoryId=null,d.subCategoryId=null,a.data&&a.data?e(a.data):f(a)},function(a){d.categoryId=null,d.subCategoryId=null,f(a)})},this.inactivate=function(a,d,e){var f={};f.id=a,b.getData(c.getParameterizedUrl("INACTIVATE_SUB_MESSAGE_CATEGORY",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.activate=function(a,d,e){var f={};f.id=a,b.getData(c.getParameterizedUrl("ACTIVATE_SUB_MESSAGE_CATEGORY",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getCategoryById=function(a,d,f){var g={};g.id=a;var h="MM/dd/yyyy";b.getData(c.getParameterizedUrl("GET_HEALTH_PRO_REVIEW_BY_ID",g),null,function(a){a&&a.data?(a.data.reviewDate=e("timestampToDate")(a.data.reviewDate,h),d(a.data)):f(a)},function(a){f(a)})},this.getSubCategoryById=function(a,d,f){var g={};g.id=a;var h="MM/dd/yyyy";b.getData(c.getParameterizedUrl("GET_HEALTH_PRO_REVIEW_BY_ID",g),null,function(a){a&&a.data?(a.data.reviewDate=e("timestampToDate")(a.data.reviewDate,h),d(a.data)):f(a)},function(a){f(a)})}}]),angular.module("paripal.messagingModule").service("messagingReportListService",["httpService","urlService","utilService","dateconvertor","$filter",function(a,b,c,d,e){"use strict";this.searchMessageReports=function(d,e,f){var g=angular.copy(d);c.isEmpty(g.organizationLocation)||(g.creatingOrgLocId=g.organizationLocation.id),delete g.organizationLocation,a.postData(b.getUrl("MESSAGE_REPORT_SEARCH_CRITERIA"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.messagingModule").service("msgOrgLocClientListService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.searchOrgLocClient=function(e,f,g,h,i,j){var k=angular.copy(e);d.isEmpty(f)||(k.organizationLocationId=f.id),/* if (WSOrgLocationClientSearchCriteria.userName) {
                delete WSOrgLocationClientSearchCriteria.userName;
            } */
d.isEmpty(g)?k.userName="":k.userName=g,d.isEmpty(h)||(d.isEmpty(h.cityValue)||(k.cityId=h.cityValue.id),d.isEmpty(h.districtValue)||(k.districtId=h.districtValue.id),d.isEmpty(h.stateValue)||(k.stateId=h.stateValue.id),d.isEmpty(h.countryValue)||(k.countryId=h.countryValue.id),d.isEmpty(h.postalCode)||(k.postalCode=h.postalCode)),e.validFrom&&(k.validFrom=c.convertToServerDate(e.validFrom)),e.validTill&&(k.validTill=c.convertToServerDate(e.validTill)),e.whetherActive||(e.whetherActive=!1),e.gender&&!e.gender.dataValue&&delete e.gender,e.gender&&e.gender.dataValue?k.genderId=angular.copy(e.gender.dataValue.id):k.genderId=null,delete k.gender,a.postData(b.getUrl("SEARCH_ORG_LOC_CLIENT"),k,function(a){a.data&&a.data.data?i(a.data):j(a)},function(a){j(a)})}}]),angular.module("paripal.messagingModule").service("notificationMessagingService",["httpService","urlService","dateconvertor","$filter","utilService","baseService",function(a,b,c,d,e,f){"use strict";this.findLatestNotificationByUserId=function(c,d,e){var f=b.getUrl("GET_LATEST_NOTIFICATION_BY_USER_ID");f+=c,a.getData(f,null,function(a){a.data?d(a.data):e(a)},function(a){e(a)})},this.findAllNotificationByUserId=function(c,d,f,g){var h=b.getUrl("GET_ALL_NOTIFICATION_BY_USER_ID");h+=c,e.isFieldEmpty(g)||(h=h+"&profUserId="+g),a.getData(h,null,function(a){a.data?d(a.data):f(a)},function(a){f(a)})},this.getMsgCount=function(c,d){var e=b.getUrl("GET_UNREAD_MESSAGE_COUNT_BY_USER");e+=f.getLoggedInUser().id,a.getData(e,null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.findAllNotificationByUserIdWithPagination=function(c,d,f,g){var h=b.getUrl("GET_ALL_NOTIFICATION_BY_USER");e.isFieldEmpty(g)||(c.profUserId=g),a.postData(h,c,function(a){a.data?d(a.data):f(a)},function(a){f(a)})},this.changeMessageStatus=function(c,d,e){var f=b.getUrl("CHANGE_MESSAGE_STATUS");f+=c,a.putData(f,null,function(a){a?d(a):e(a)},function(a){e(a)})},this.deleteAllMessages=function(c,d,e){var f={};f.messageIds=c,a.deleteData(b.getParameterizedUrl("DELETE_ALL_MESSAGES",f),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.deleteMessages=function(c,d,e){var f=b.getUrl("DELETE_MESSAGES");f+=c,a.deleteData(f,null,function(a){a?d(a):e(a)},function(a){e(a)})},this.getMessageDetails=function(c,d,e){var f=b.getUrl("GET_MESSAGE_DETAILS");f+=c,a.getData(f,null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("numbering").controller("NumberingCtrl",["$scope","$rootScope","urlService","httpService","notify","utilService","$filter","$uibModal","$state","$mdDialog","$translate","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.numbering.columnName=[],a.numbering.isManual=!1,a.selectedAttributes=[],a.dynamicAttributeList=[],a.wsRunningNoFormats=[],a.wsAlphaNumericFormats=[],a.wsDynamicIdFormats=[],a.wsDateIdFormats=[],a.whetherRequestSent=!1}function n(){a.requestObj.whetherManualId=a.numbering.isManual,a.requestObj.idEntitySetting=a.numbering.nameOfTable.id,a.requestObj.idColumn=a.numbering.columnObject,a.requestObj.organizationLocationId=a.numbering.organizationLocationId,f.isNullOrEmpty(a.numbering.id)?a.requestObj.id=0:a.requestObj.id=a.numbering.id,f.isNullOrEmpty(a.numbering.version)?a.requestObj.version=0:a.requestObj.version=a.numbering.version,f.isNullOrEmpty(a.numbering.formType)||(a.requestObj.idFormatType=a.numbering.formType),f.isEmpty(a.numbering.wsRunningNoFormats)||(a.requestObj.wsRunningNoFormats=[],a.requestObj.wsRunningNoFormats.push(a.numbering.wsRunningNoFormats)),f.isEmpty(a.numbering.WSIdFormatAlphanumeric)||(a.requestObj.wsAlphaNumericFormats=[],a.requestObj.wsAlphaNumericFormats.push(a.numbering.WSIdFormatAlphanumeric))}function o(){a.requestObj.wsRunningNoFormats=a.wsRunningNoFormats,a.requestObj.wsAlphaNumericFormats=a.wsAlphaNumericFormats,a.requestObj.wsDynamicIdFormats=a.wsDynamicIdFormats,a.requestObj.wsDateIdFormats=a.wsDateIdFormats}function p(){d.getData(c.getUrl("GET_IDEGENERATOR_DATA"),null,function(a){localStorage.setItem("idGeneratorJson",angular.toJson(a.data))})}a.formatList=[{id:1,format:"Running No"},{id:2,format:"Alpha Numeric"},{id:3,format:"Dynamic"}],a.dynamicAttributeFormatList=[{id:1,format:"Running No"},{id:2,format:"Alpha Numeric"},{id:3,format:"Dynamic"},{id:4,format:"Date"}],a.formType={RUNNING_NUMBER:"RUNNING_NUMBER",ALPHA_NUMERIC:"ALPHA_NUMERIC",DYNAMIC:"DYNAMIC"},a.setOrganization=function(b){a.numbering.organizationId=b.id},a.validateOrg=function(b){f.isFieldEmpty(b)&&(a.numbering.nameOfTable={},a.numbering.columnName={},a.tableList=[],a.columnList=[],a.allValid=!1,a.b=null)},a.onLocationSelect=function(b){a.numbering.organizationLocationId=b.id,a.requestObj={},a.tableList=[],a.columnList=[],a.allValid=!1,a.numbering.whetherManualId=!0,a.numbering.nameOfTable={},a.requestObj.organizationLocationId=a.numbering.organizationLocationId,d.getData(c.getUrl("GET_TABLES"),a.requestObj,function(b){a.tableList=angular.fromJson(b.data)},function(a){e("Error",k.instant("ERROR_OCCURED_WHILE_FETCHING_RECORD"))})},a.init=function(){a.numbering={},a.numbering.isManual=!1,a.selectedAttributes=[],a.tableList=[],a.columnList=[],a.dynamicAttributeList=[],a.wsRunningNoFormats=[],a.wsAlphaNumericFormats=[],a.wsDynamicIdFormats=[],a.wsDateIdFormats=[],a.organizationList=[],a.locations=[],a.whetherRequestSent=!1;var b=l.getDefaultOrgLocation();f.isFieldEmpty(b)||(a.a=b.org,a.b=b.orgLoc,a.setOrganization(a.a),a.validateOrg(a.a,a.b),a.onLocationSelect(a.b))},a.init(),a.getOrganizations=function(a){var b={};return b.keyword=a,d.getData(c.getParameterizedUrl("GET_ORG_LIST_BY_KEYWORD",b),null,function(a){if(a&&a.data)return angular.fromJson(a.data)},function(a){})},a.getOrganizationLocations=function(b){if(a.numbering.organizationId){a.locations=[],a.tableList=[],a.columnList=[],a.allValid=!1,a.numbering.whetherManualId=!0,a.numbering.organizationLocationId={};var e={};e.keyword=b,e.orgId=a.numbering.organizationId;var f=c.getParameterizedUrl("GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD",e);return d.getData(f,null,function(a){if(a&&a.data)return a.data},function(a){})}},a.saveNumbering=function(b){a.requestObj={},a.whetherRequestSent=!0;var f=!0;b.$valid?(n(),"DYNAMIC"==a.numbering.formType&&(o(),0==a.wsRunningNoFormats.length&&(f=!1,a.whetherRequestSent=!1,e("warning",g("translate")("SELECT_RUNNING_NO")))),f&&d.postData(c.getUrl("SAVE_NUMBERING"),angular.toJson(a.requestObj),function(c){m(),a.allValid=!1,b.$setPristine(),e("success",g("translate")("RECORD_SAVE")),p()})):a.whetherRequestSent=!1},a.getColumns=function(b){a.columnList=[],a.columnList=b.columns,a.allValid=!1,a.numbering.whetherManualId=!0,a.numbering.columnObject={}},/*Get records already exist or not*/
a.chkRecordsExist=function(){a.requestObj={},a.orgInfo={},a.requestObj.tableName=a.numbering.nameOfTable.rootTableName,a.requestObj.columnName=a.numbering.columnObject.columnName,a.orgInfo.organizationLocationId=a.numbering.organizationLocationId,d.getData(c.getParameterizedUrl("IS_RECORD_EXIST",a.requestObj),a.orgInfo,function(b){if(a.allValid=!0,"string"==typeof b.data)a.numbering.id=0,a.numbering.version=0,a.numbering.whetherManualId=!0,a.numbering.formType="RUNNING_NUMBER",a.numbering.wsRunningNoFormats=null,a.numbering.WSIdFormatAlphanumeric=null;else{var c=angular.fromJson(b.data);if(a.numbering.id=c.id,a.numbering.version=c.version,c.whetherManualId)a.numbering.isManual=c.whetherManualId;else switch(a.numbering.isManual=c.whetherManualId,c.idFormatType){case a.formType.RUNNING_NUMBER:a.numbering.formType=c.idFormatType,a.numbering.wsRunningNoFormats=c.wsRunningNoFormats[0];case a.formType.ALPHA_NUMERIC:a.numbering.formType=c.idFormatType,a.numbering.WSIdFormatAlphanumeric=c.wsAlphaNumericFormats[0];case a.formType.DYNAMIC:if(a.numbering.formType=c.idFormatType,a.selectedAttributes=[],c.wsRunningNoFormats.length>0)for(var d in c.wsRunningNoFormats)a.selectedAttributes.push({col2:c.wsRunningNoFormats[d].startFrom,col1:"Running No",seqNo:c.wsRunningNoFormats[d].seqNo});if(c.wsAlphaNumericFormats.length>0)for(var d in c.wsAlphaNumericFormats)a.selectedAttributes.push({col1:"Alphanumeric",col2:c.wsAlphaNumericFormats[d].suffix,seqNo:c.wsAlphaNumericFormats[d].seqNo});if(c.wsDynamicIdFormats.length>0)for(var d in c.wsDynamicIdFormats)a.selectedAttributes.push({col1:"Dynamic",col2:c.wsDynamicIdFormats[d].resultKey,seqNo:c.wsDynamicIdFormats[d].seqNo});a.selectedAttributes=f.sortArray(a.selectedAttributes,"seqNo");for(var d in a.selectedAttributes)"Running No"==a.selectedAttributes[d].col1&&(a.disableAddBtn=!0)}}},function(a){e("Error",k.instant("ERROR_OCCURED_WHILE_FETCHING_RECORD"))})},a.getAttributeType=function(b){a.formatId=b.id,/*id = 3 fro dynamic type*/
3==a.formatId&&(a.requestObj={},a.requestObj.tableName=a.numbering.nameOfTable.rootTableName,d.getData(c.getUrl("GET_DYNAMIC_FIELDS"),a.requestObj,function(b){a.dynamicAttributeList=angular.fromJson(b.data)},function(a){e("Error",k.instant("ERROR_OCCURED_WHILE_FETCHING_RECORD"))})),4==a.formatId&&d.getData(c.getUrl("GET_DATE_FORMATS"),null,function(b){a.dateFormatsList=angular.fromJson(b.data)},function(a){e("Error",k.instant("ERROR_OCCURED_WHILE_FETCHING_RECORD"))})},a.addAttributes=function(b){var c={};if(1==b.dynamicFormat.id)if(void 0!==b.startFrom&&void 0!==b.noOfDigit){c.col1=b.dynamicFormat.format,c.col2=b.startFrom,c.col3=b.noOfDigit,a.seqIndex=a.seqIndex+1;var d=a.seqIndex;c.seqNo=d,a.wsRunningNoFormats.push({startFrom:c.col2,seqNo:c.seqNo,numberOfDigit:c.col3}),a.startFromReq=!1,a.noOfDigitReq=!1}else void 0===b.startFrom?a.startFromReq=!0:a.startFromReq=!1,void 0===b.noOfDigit?a.noOfDigitReq=!0:a.noOfDigitReq=!1;if(2==b.dynamicFormat.id)if(void 0!==b.suffix){c.col1=b.dynamicFormat.format,c.col2=b.suffix,a.seqIndex=a.seqIndex+1;var d=a.seqIndex;c.seqNo=d,a.wsAlphaNumericFormats.push({suffix:c.col2,seqNo:c.seqNo}),a.suffixReq=!1}else a.suffixReq=!0;if(3==b.dynamicFormat.id)if(void 0!==b.dynamicAttributeValue){c.col1=b.dynamicFormat.format,c.col2=b.dynamicAttributeValue.fieldName,a.seqIndex=a.seqIndex+1;var d=a.seqIndex;c.seqNo=d,a.wsDynamicIdFormats.push({resultKey:b.dynamicAttributeValue.resultKey,seqNo:c.seqNo}),a.attributeReq=!1}else a.attributeReq=!0;if(4==b.dynamicFormat.id)if(void 0!==b.dynamicDateFormat){c.col1=b.dynamicFormat.format,c.col2=b.dynamicDateFormat,a.seqIndex=a.seqIndex+1;var d=a.seqIndex;c.seqNo=d,a.wsDateIdFormats.push({dateFormat:c.col2,seqNo:c.seqNo}),a.dateReq=!1}else a.dateReq=!0;f.isEmpty(c)||(a.selectedAttributes.push(c),a.numbering.dynamic.startFrom="",a.numbering.dynamic.noOfDigit="",a.numbering.dynamic.suffix="",a.numbering.dynamic.dynamicAttributeValue="",a.numbering.dynamic.dynamicDateFormat="");for(var e in a.selectedAttributes)"Running No"==a.selectedAttributes[e].col1&&(a.disableAddBtn=!0)},a.removeRecord=function(b){a.selectedAttributes.splice(b,1),a.disableAddBtn=!1,a.cancelPopup();for(var c in a.selectedAttributes)"Running No"==a.selectedAttributes[c].col1&&(a.disableAddBtn=!0)},a.showConfirm=function(b){a.data=b,a.modalInstance=h.open({scope:a,animation:!0,templateUrl:"app/modules/manage-roles/views/remove-privilege-popup.html",size:"sm",keyboard:!0,backdrop:!1})},a.cancelPopup=function(){a.modalInstance.close()},a.radioFn=function(){a.numbering.wsRunningNoFormats={},a.numbering.WSIdFormatAlphanumeric={},a.wsRunningNoFormats=[],a.wsAlphaNumericFormats=[],a.wsDynamicIdFormats=[],a.wsDateIdFormats=[],a.numbering.dynamic={},a.selectedAttributes=[],a.seqIndex=0,a.disableAddBtn=!1,a.formatId=1},a.cancel=function(){a.numbering={},a.tableList=[],a.columnList=[],a.locations=[],a.init(),a.allValid=!1},a.flushCache=function(){var a=j.confirm().title(k.instant("FLUSH_CACHE")).textContent(k.instant("FLUSH_CACHE_CONFIRM_MESSAGE")).ok(k.instant("OK")).cancel(k.instant("CANCEL"));j.show(a).then(function(){var a=c.getUrl("IDGEN_REMOVE_CACHE");d.putData(a,null,function(){},function(){e("error",k.instant("ERROR_IN_CLEAR_CACHE"))})},function(){})}}]),angular.module("paripal.orgHealthProfessionalSpecialization").controller("orgHealthProfessionalListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","utilService","$mdDialog","$mdMedia","orgHealthProfessionalService","httpService","urlService","featurePrivilegeConstants","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";
//popup controller starts
function q(a,b,c,d,e,h){a.typeMinLength=h.getSmartSearchMinLength("uiSideMinLength"),a.professional={},a.WSHealthProfessionalsData=c,a.professional.data=c.professional,a.editMode=!1,a.editTrue=!0,h.showSpinner=!1,a.orgLocPermission=e.HEALTH_PROF_SPECIALIZATION_ADD,a.fetchHealthSpecializations=function(){h.showSpinner=!0,m.getData(n.getUrl("GET_SPECIALIZATIONS"),null,function(b){a.specializationsData=angular.fromJson(b.data),h.showSpinner=!1},function(a){h.showSpinner=!1})},a.fetchHealthSpecializations(),a.fetchHealthSubSpecializations=function(b){var c=n.getUrl("GET_SUB_SPECIALIZATIONS");c+=b,m.getData(c,null,function(b){a.subSpecializationData=angular.fromJson(b.data)},function(a){})},i.isEmpty(c)?a.specializationSelectd=!0:i.isEmpty(c.specialization)?a.specializationSelectd=!0:(a.specializationSelectd=!1,a.editMode=!0,a.editTrue=!1,a.fetchHealthSubSpecializations(c.specialization.id)),a.WSHealthProfessionals=c,i.isEmpty(a.WSHealthProfessionals.specialization)&&(a.WSHealthProfessionals.whetherActive=!0),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.saveHealthProfessional=function(){a.orgHealthProfAddSpinner=!0,a.WSHealthProfessionals.id?a.type="edit":a.type="add",l.saveHealthProfessional(a.WSHealthProfessionals,a.type,function(c){a.orgHealthProfAddSpinner=!1,"add"==a.type?f("success",g.instant("HEALTH_PROFESSIONAL_SPECIALIZATION_ADDED_SUCCESSFULLY")):f("success",g.instant("HEALTH_PROFESSIONAL_SPECIALIZATION_UPDATED_SUCCESSFULLY")),b.hide(a.WSHealthProfessionals),d.searchHealthProfessionals(a.WSHealthProfessionals.professional)},function(b){a.orgHealthProfAddSpinner=!1})},a.getSpecializations=function(b){return i.isNullOrEmpty(b)?(a.specializationsDataResult=a.specializationsData,a.specializationsDataResult):(a.filtered=[],b=b.toLowerCase(),angular.forEach(a.specializationsData,function(c){c.value.toLowerCase().indexOf(b)>=0&&a.filtered.push(c)}),a.specializationsDataResult=a.filtered,a.specializationsDataResult)},a.getSubSpecializations=function(b){return i.isNullOrEmpty(b)?(a.subSpecializationsDataResult=a.subSpecializationData,a.subSpecializationsDataResult):(a.filtered=[],b=b.toLowerCase(),angular.forEach(a.subSpecializationData,function(c){c.value.toLowerCase().indexOf(b)>=0&&a.filtered.push(c)}),a.subSpecializationsDataResult=a.filtered,a.subSpecializationsDataResult)},a.onProfessionalSelect=function(b){a.WSHealthProfessionals.professional=b.data},a.onSpecializationSelect=function(b){a.WSHealthProfessionals.specialization=b,a.specializationSelectd=!1,a.fetchHealthSubSpecializations(b.id)},a.onSubSpecializationSelect=function(b){a.WSHealthProfessionals.subSpecialization=b},a.validateValue=function(b,c){i.isNullOrEmpty(b)&&"PROFESSIONALS"===c?(a.WSHealthProfessionals.professional="",a.WSHealthProfessionalsData.professional=""):i.isNullOrEmpty(b)&&"SPECIALIZATION"===c?(a.WSHealthProfessionals.specialization="",a.WSHealthProfessionalsData.specialization="",a.specializationSelectd=!0,a.WSHealthProfessionals.subSpecialization="",a.WSHealthProfessionalsData.subSpecialization=""):i.isNullOrEmpty(b)&&"SUB_BRANCH"===c&&(a.WSHealthProfessionals.subSpecialization="",a.WSHealthProfessionalsData.subSpecialization="")}}q.$inject=["$scope","$mdDialog","WSHealthProfessionalsValues","parentScope","featurePrivilegeConstants","$rootScope"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.customFullscreen=k("xs")||k("sm"),a.WSHealthProfessionalsValues={},a.WSOrgHealthProfessionalSearchCriteria={},a.WSHealthProfessionalsData={},a.orgHealthProfSpinner=!1,a.orgHealthProfAddSpinner=!1,a.professional={},a.searchHealthProfessionals=function(b){return a.orgHealthProfSpinner=!0,a.WSOrgHealthProfessionalSearchCriteria.pageNumber=a.currentPage,a.WSOrgHealthProfessionalSearchCriteria.recordsPerPage=a.itemPerPage,b?(a.WSHealthProfessionalsData.professional={id:b.id,value:b.value},a.WSOrgHealthProfessionalSearchCriteria.user={},a.WSOrgHealthProfessionalSearchCriteria.user.id=b.id,void l.searchHealthProfessionals(a.WSOrgHealthProfessionalSearchCriteria,function(b){a.orgHealthProfSpinner=!1,a.WSHealthProfessionalsList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.orgHealthProfSpinner=!1,a.error=b})):void(a.orgHealthProfSpinner=!1)},
//$scope.searchHealthProfessionals($scope.WSHealthProfessionalsData.professional);
a.addHeathProfessional=function(b){(k("sm")||k("xs"))&&a.customFullscreen;j.show({controller:q,templateUrl:"app/modules/org-health-professional-specializations/views/add-org-health-professional.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:p.dialogBox.clickOutsideToClose,
// fullscreen: useFullScreen,
locals:{WSHealthProfessionalsValues:a.WSHealthProfessionalsValues,parentScope:a}}).then(function(b){var c=angular.copy(a.WSHealthProfessionalsValues.professional);a.WSHealthProfessionalsValues={},a.WSHealthProfessionalsValues.professional=c},function(){var b=angular.copy(a.WSHealthProfessionalsValues.professional);a.WSHealthProfessionalsValues={},a.WSHealthProfessionalsValues.professional=b})},a.onProfessionalSelect=function(b){a.WSHealthProfessionalsData.professional=b.data,a.searchHealthProfessionals(b.data)},a.editHealthProfessionals=function(b,c){a.WSHealthProfessionalsValues=b,a.addHeathProfessional(c)},
//popup controller ends
a.$watch(function(){return k("xs")||k("sm")},function(b){a.customFullscreen=b===!0}),
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchHealthProfessionals(a.WSHealthProfessionalsData.professional)},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchHealthProfessionals(a.WSHealthProfessionalsData.professional)};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(r),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){i.isEmpty(c.professional)||(a.WSHealthProfessionalsData.professional={id:c.professional.id,value:c.professional.userName},a.professional.data={id:c.professional.id,value:c.professional.userName},a.WSHealthProfessionalsValues.professional=a.WSHealthProfessionalsData.professional,a.searchHealthProfessionals(a.WSHealthProfessionalsData.professional)),"professionalwall"===c.type&&(a.fromProfessionalWall=!0)},a.init()}]),angular.module("paripal.manageOrganisationLocationUser").service("orgHealthProfessionalService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.saveHealthProfessional=function(c,d,e,f){var g=null;"edit"===d?(g=b.getParameterizedUrl("UPDATE_HEALTH_PROFESSIONAL"),a.putData(g,c,function(a){a&&a.data&&e(a.data)},function(a){f(a)})):(g=b.getUrl("ADD_HEALTH_PROFESSIONAL"),a.postData(g,c,function(a){a&&a.data&&e(a.data)},function(a){f(a)}))},this.searchHealthProfessionals=function(c,d,e){a.postData(b.getUrl("SEARCH_ORG_HEALTH_PROFESSIONAL"),c,function(a){a.data&&a.data.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.organizationLocationAddress").controller("ManageOrgLocationAddressCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","manageOrgLocationAddressService","notify","$translate","$filter","baseService","httpService","urlService","utilService","fileOperations","commonConstants","GoogleMap","applicationExceptionService","NgMap","SearchHospitalService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.WSOrganizationLocationAddress={},a.WSOrganizationLocationAddress.organizationLocation={},a.WsOrgLocationAddressResponse={},a.version=null,a.category=new Array,a.WSOrganizationLocationAddress.whetherCurrentAddress=!0,a.disabledFormFields=!1,a.onEditDisabled=!1,a.labelList="",a.selectedFileArray=[],a.manageOrgLocAddressSpinner=!1,a.orgLocation={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.selectedFileArray=[],a.images=[],a.imageSliderMaxLength=0,a.fileExtensionArray=["JPG","JPEG","PNG","BMP","TIF"],a.getOrgLocImage=function(b,d){if(a.imageSliderMaxLength>0&&b<=a.imageSliderMaxLength)
//callback(true);
if(a.imageSliderMaxLength>a.images.length)if(m.isNullOrEmpty(a.selectedFileArray[b].documentId))d(!1);else{var e=new Object;e.fileName=a.selectedFileArray[b].fileName,e.resourceId=a.selectedFileArray[b].documentId,e.recordId=c.organizationLocationAddressId,e.docType=o.documentTypes.photo,e.docSubType=o.documentSubTypes.orgLocAddressPhoto,e.orgLocId=a.WSOrganizationLocationAddress.organizationLocation.id,a.manageOrgLocAddressSpinner=!0,n.getImageUrl(e,function(c){a.manageOrgLocAddressSpinner=!1,a.images.push({src:c,title:a.selectedFileArray[b].fileName,id:a.selectedFileArray[b].id}),d(!0)},function(){a.manageOrgLocAddressSpinner=!1})}else d(!0);else d(!1)},
// Add organization Location Address
a.saveOrgLocationAddress=function(b){b.$valid&&(a.manageOrgLocAddressSpinner=!0,"add"===c.type&&(a.version=null),r.getMap().then(function(d){a.WSOrganizationLocationAddress.addressLattitudes=d.getCenter().lat(),a.WSOrganizationLocationAddress.addressLongitudes=d.getCenter().lng(),f.saveOrgLocationAddress(c.organizationLocationAddressId,c.type,a.version,a.WSOrganizationLocationAddress,a.WSOrganizationLocationAddress,a.category,function(c){a.manageOrgLocAddressSpinner=!1,a.orgLocationAddressId=c.response,a.saveDocumentIdInDocumentTable(b)},function(b){a.manageOrgLocAddressSpinner=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?g("error",h.instant("FAILED_TO_SAVE_RECORD")):g("error",h.instant(b.data.messages[0]))})}))},a.showSuccessMessageOnFormSave=function(){"add"===c.type?g("success",h.instant("ADDED_SUCCESS")):g("success",h.instant("RECORD_EDITED_SUCESS")),d.go("orgLocationAddressList",c)},a.saveDocumentIdInDocumentTable=function(b){if(a.selectedFileArray&&a.selectedFileArray.length>0){var e={};e.documentType={},e.documentType.type=o.documentTypes.photo,e.documentType.subType=o.documentSubTypes.orgLocAddressPhoto,a.manageOrgLocAddressSpinner=!0,n.saveAllDocuments(e,!1,a.selectedFileArray,function(b){a.manageOrgLocAddressSpinner=!1,a.selectedFileArray&&a.selectedFileArray.length>0&&b?a.uploadFile(a.selectedFileArray,e,b,a.orgLocationAddressId):a.showSuccessMessageOnFormSave()},function(){a.manageOrgLocAddressSpinner=!1,d.go("orgLocationAddressList",c)})}else a.showSuccessMessageOnFormSave(),d.go("orgLocationAddressList",c)},a.uploadFile=function(b,e,f){var i=new Object;i.docType=e.documentType.type,i.docSubType=e.documentType.subType,i.recordId=a.orgLocationAddressId,// add templateConfigId
i.orgLocId=a.WSOrganizationLocationAddress.organizationLocation.id,f.response&&(i.resourceDetails=JSON.stringify(f.response)),a.manageOrgLocAddressSpinner=!0,n.uploadMultipleFiles(i,b,function(b){a.manageOrgLocAddressSpinner=!1,a.saveDocumentIdsWithAddressDetails(f,a.orgLocationAddressId)},function(b){a.manageOrgLocAddressSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING")),d.go("orgLocationAddressList",c)})},a.saveDocumentIdsWithAddressDetails=function(b){if(b){for(var e=b.response,i=new Array,j=0;j<e.length;j++){var k={};k.documentId=e[j].id,k.fileName=e[j].value,k.orgLocAddressId=a.orgLocationAddressId,i.push(k)}a.manageOrgLocAddressSpinner=!0,f.uploadFiles(i,function(b){a.manageOrgLocAddressSpinner=!1,a.showSuccessMessageOnFormSave()},function(b){d.go("orgLocationAddressList",c),a.manageOrgLocAddressSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING"))})}},a.fetchAttachmentList=function(b){f.fetchAttachmentList(b,function(c){a.selectedFileArray=[],a.selectedFileArray=c,a.imageSliderMaxLength=a.selectedFileArray.length,
//$scope.selectedFileArray = angular.copy($scope.selectedFileArray);
angular.forEach(a.selectedFileArray,function(c){c.documentType=o.documentTypes.photo,c.documentSubType=o.documentSubTypes.orgLocAddressPhoto,c.recordId=b,c.deleteCallBack=function(b){a.deleteFile(b)}})},function(a){})},a.deleteFile=function(b){a.manageOrgLocAddressSpinner=!0,f.deleteFile(b,function(c){a.manageOrgLocAddressSpinner=!1;for(var d=-1,e=0;e<a.images.length;e++)b===a.images[e].id&&(d=e);d>-1&&a.images.splice(d,1),
//$scope.fetchAttachmentList($stateParams.organizationLocationAddressId);
a.imageSliderMaxLength=a.selectedFileArray.length,g("success",h.instant("RECORD_DELETED_SUCCESSFULLY"))},function(b){a.manageOrgLocAddressSpinner=!1})},
// Get selected organization location address data
a.getOrganizationLocationAddressDetails=function(b,c){m.isNullOrEmpty(b)||(a.manageOrgLocAddressSpinner=!0,f.getOrganizationLocationAddressDetails(b,function(b){a.manageOrgLocAddressSpinner=!1,a.setDataToAddressForm(b),a.fetchAttachmentList(b.id),m.isFieldEmpty(b.addressLattitudes)||m.isFieldEmpty(b.addressLongitudes)?a.setAddress():a.currentPosition=[b.addressLattitudes,b.addressLongitudes]}))},
// set selected organization location address data
a.setDataToAddressForm=function(b){m.isEmpty(b)||(m.isNullOrEmpty(b.version)||(a.version=b.version),m.isEmpty(b.organizationLocation)||(a.WSOrganizationLocationAddress.organizationLocation={},a.WSOrganizationLocationAddress.organizationLocation={id:b.organizationLocation.id,value:b.organizationLocation.value}),m.isNullOrEmpty(b.addressLine1)||(a.WSOrganizationLocationAddress.addressLine1=b.addressLine1),m.isNullOrEmpty(b.addressLine2)||(a.WSOrganizationLocationAddress.addressLine2=b.addressLine2),m.isNullOrEmpty(b.addressLine3)||(a.WSOrganizationLocationAddress.addressLine3=b.addressLine3),m.isEmpty(b.postalCode)||(a.WSOrganizationLocationAddress.postalCode=b.postalCode),m.isEmpty(b.country)||(a.WSOrganizationLocationAddress.country={id:b.country.id,value:b.country.value}),m.isEmpty(b.state)||(a.WSOrganizationLocationAddress.state={id:b.state.id,value:b.state.value}),m.isEmpty(b.district)||(a.WSOrganizationLocationAddress.district={id:b.district.id,value:b.district.value}),m.isEmpty(b.city)||(a.WSOrganizationLocationAddress.city={id:b.city.id,value:b.city.value}),m.isEmpty(b.addressCategoryId1)||(a.category[0]={id:b.addressCategoryId1.id,value:b.addressCategoryId1.value}),m.isEmpty(b.addressCategoryId2)||(a.category[1]={id:b.addressCategoryId2.id,value:b.addressCategoryId2.value}),m.isEmpty(b.addressCategoryId3)||(a.category[2]={id:b.addressCategoryId3.id,value:b.addressCategoryId3.value}),m.isNullOrEmpty(b.whetherCurrentAddress)||(a.WSOrganizationLocationAddress.whetherCurrentAddress=!0),m.isEmpty(b.addressTypeId)||(a.WSOrganizationLocationAddress.addressTypeId=b.addressTypeId,a.addressTypeFieldId=a.WSOrganizationLocationAddress.addressTypeId.id,a.addressTypeDisable=!0),m.isNullOrEmpty(b.addressLine1)||(a.WSOrganizationLocationAddress.addressLine1=a.WSOrganizationLocationAddress.addressLine1),m.isNullOrEmpty(b.addressLine2)||(a.WSOrganizationLocationAddress.addressLine2=a.WSOrganizationLocationAddress.addressLine2),m.isNullOrEmpty(b.addressLine3)||(a.WSOrganizationLocationAddress.addressLine3=a.WSOrganizationLocationAddress.addressLine3),m.isNullOrEmpty(b.postalCode)||(a.WSOrganizationLocationAddress.postalCode=a.WSOrganizationLocationAddress.postalCode),m.isEmpty(b.country)||(a.stateDisabled=!1,a.WSOrganizationLocationAddress.country=a.WSOrganizationLocationAddress.country,a.countryId=a.WSOrganizationLocationAddress.country.id),m.isEmpty(b.state)||(a.WSOrganizationLocationAddress.state=a.WSOrganizationLocationAddress.state,a.cityDistValue=!1,a.stateId=a.WSOrganizationLocationAddress.state.id),m.isEmpty(b.district)||(a.WSOrganizationLocationAddress.district=a.WSOrganizationLocationAddress.district),m.isEmpty(b.city)||(a.WSOrganizationLocationAddress.city=a.WSOrganizationLocationAddress.city))},
// on cancel forward to search list
a.cancel=function(){m.goBackToPrevState()},a.fetchCategotyLabels=function(){var b=new Array;b.push("ORG_LOC_ADDRESS_CATEGORY_1"),b.push("ORG_LOC_ADDRESS_CATEGORY_2"),b.push("ORG_LOC_ADDRESS_CATEGORY_3"),f.fetchCategotyLabels(b,function(b){a.labelList=b},function(a){})},a.whetherMap=!0,/*$scope.parentCallbackFn = function(currentIndex, childCallBack){
            $scope.callback({
                currentIndex: currentIndex,
                callbackFn: childCallBack
            }, $scope);
        };

        $scope.$watch('imageLimit', function(value) {
            if(value){
                $scope.sliderMaxLength = value;
            }

        });*/
/* code for map integration */
a.getPosition=function(b){a.currentPosition=p.getCoordinates(b)},a.setAddress=function(b,c){if(a.whetherMap){var d="";m.isFieldEmpty(a.WSOrganizationLocationAddress.addressLine1)||(d=d+a.WSOrganizationLocationAddress.addressLine1+", "),m.isFieldEmpty(a.WSOrganizationLocationAddress.addressLine2)||(d=d+a.WSOrganizationLocationAddress.addressLine2+", "),m.isFieldEmpty(a.WSOrganizationLocationAddress.addressLine3)||(d=d+a.WSOrganizationLocationAddress.addressLine3+", "),m.isFieldEmpty(a.WSOrganizationLocationAddress.city)||(d=d+a.WSOrganizationLocationAddress.city.value+", "),m.isFieldEmpty(a.WSOrganizationLocationAddress.postalCode)||(d=d+a.WSOrganizationLocationAddress.postalCode+", "),m.isFieldEmpty(a.WSOrganizationLocationAddress.district)||(d=d+a.WSOrganizationLocationAddress.district.value+", "),m.isFieldEmpty(a.WSOrganizationLocationAddress.state)||(d=d+a.WSOrganizationLocationAddress.state.value+", "),m.isFieldEmpty(a.WSOrganizationLocationAddress.country)||(d+=a.WSOrganizationLocationAddress.country.value),a.currentPosition=d}};var t=function(){"add"===a.pageState&&(a.currentPosition="Pune, India, Maharashtra",s.getEventObject(function(b){a.currentPosition="current-location",
//$scope.WSEmergencyTransaction.emergencyLocation = successResponse;
//$scope.WSOrganizationLocationAddress = GoogleMap.getPosition();
a.tempVariable=b,a.$apply()},null,a)),a.WSOrganizationLocationAddress.whetherCurrentAddress=!0};if(/* code for map integration end */
a.stateDisabled=!0,a.cityDistValue=!0,a.populatedData=!0,a.disableAddress?a.disableValue=!0:a.disableValue=!1,a.getAddressTypes=function(){var b={};b.type="addressType",k.getData(l.getParameterizedUrl("GET_PICKLIST_DATA",b),null,function(b){a.addressTypes=angular.fromJson(b.data)},function(a){})},a.getAddressTypes(),/*$scope.addressTypeChanged = function () {
            $scope.WSOrganizationLocationAddress.addressTypeId = (JSON.parse($scope.WSOrganizationLocationAddress.addressTypeId));

        };*/
a.getOrgCountries=function(b){var c={};return c.searchString=b,k.getData(l.getParameterizedUrl("GET_COUNTRY_DATA",c),null,function(b){return a.countryData=angular.fromJson(b.data),a.countryData},function(a){})},a.onCountrySelect=function(b){a.WSOrganizationLocationAddress.country=b,a.countryId=b.id,a.stateDisabled=!1,a.clearData("country")},a.getOrgState=function(b){var c={};return c.searchString=b,c.countryId=a.countryId,k.getData(l.getParameterizedUrl("GET_STATE_DATA",c),null,function(b){return a.stateData=angular.fromJson(b.data),a.stateData},function(a){})},a.onStateSelect=function(b){a.WSOrganizationLocationAddress.state=b,a.stateId=b.id,a.cityDistValue=!1,a.clearData("state")},a.getOrgDists=function(b){var c={};return c.searchString=b,c.stateId=a.stateId,k.getData(l.getParameterizedUrl("GET_DISTRICT_DATA",c),null,function(b){return a.districtData=angular.fromJson(b.data),a.districtData},function(a){})},a.onDistrictSelect=function(b){a.WSOrganizationLocationAddress.district=b,a.districtId=b.id,a.clearData("district")},a.getOrgCities=function(b){var c={};return c.searchString=b,c.stateId=a.stateId,a.districtId?c.districtId=a.districtId:c.districtId=-1,k.getData(l.getParameterizedUrl("GET_CITY_DATA",c),null,function(b){return a.cityData=angular.fromJson(b.data),a.cityData},function(a){})},a.onCitySelect=function(b){a.WSOrganizationLocationAddress.city=b},a.validateValue=function(b,c){m.isNullOrEmpty(b)&&"country"===c?(a.clearData("country"),a.stateDisabled=!0,a.WSOrganizationLocationAddress.country=null,a.WSOrganizationLocationAddress.state=null,a.WSOrganizationLocationAddress.district=null,a.WSOrganizationLocationAddress.city=null,a.cityDistValue=!0):m.isNullOrEmpty(b)&&"state"===c?(a.clearData("state"),a.WSOrganizationLocationAddress.state=null,a.WSOrganizationLocationAddress.district=null,a.WSOrganizationLocationAddress.city=null,a.cityDistValue=!0):m.isNullOrEmpty(b)&&"district"===c&&(a.clearData("district"),a.WSOrganizationLocationAddress.district=null,a.WSOrganizationLocationAddress.city=null)},a.clearData=function(b){"country"===b?(a.WSOrganizationLocationAddress.state="",a.WSOrganizationLocationAddress.district="",a.WSOrganizationLocationAddress.city="",a.stateDisabled=!1):"state"===b?(a.WSOrganizationLocationAddress.district="",a.WSOrganizationLocationAddress.city="",a.cityDistValue=!1):"district"===b&&(a.WSOrganizationLocationAddress.city="")},a.addressTextValue=function(b,c){"addressLine1"===c&&(m.isNullOrEmpty(b)||(a.WSOrganizationLocationAddress.addressLine1=b)),"addressLine2"===c&&(m.isNullOrEmpty(b)||(a.WSOrganizationLocationAddress.addressLine2=b)),"addressLine3"===c&&(m.isNullOrEmpty(b)||(a.WSOrganizationLocationAddress.addressLine3=b)),"postalCode"===c&&(m.isNullOrEmpty(b)||(a.WSOrganizationLocationAddress.postalCode=b))},
//Init Method
a.init=function(){c.type?(a.fetchCategotyLabels(),"add"===c.type?(c.organizationLocation&&(a.WSOrganizationLocationAddress.organizationLocation={id:c.organizationLocation.id,value:c.organizationLocation.displayName}),a.pageState="add"):"edit"===c.type&&c.organizationLocationAddressId?(a.pageState="edit",a.onEditDisabled=!0,a.getOrganizationLocationAddressDetails(c.organizationLocationAddressId,c.type)):"view"===c.type&&c.organizationLocationAddressId?(a.pageState="view",a.disabledFormFields=!0,a.getOrganizationLocationAddressDetails(c.organizationLocationAddressId,c.type)):d.go("orgLocationAddressList")):d.go("orgLocationAddressList")},a.init(),a.whetherMap){a.div1css="col-xs-12 col-sm-12 col-md-4 col-lg-4",a.div2css="col-xs-12 col-sm-12 col-md-12 col-lg-12",a.zoom=11;t()}else a.whetherMap=!1,a.div1css="",a.div2css="col-xs-12 col-sm-12 col-md-4 col-lg-4"}]),angular.module("paripal.organizationLocationAddress").controller("OrgLocationAddressListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","baseService","utilService","orgLocationAddressListService","manageOrgLocationAddressService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.isFieldRequired=!0,a.filter={},a.filter.org={},a.filter.orgLoc={},a.wsOrgLocationAddressList=[],a.searchCriteria={},a.orgLocAddressSpinner=!1,a.$watch("org",function(b){j.isEmpty(b)?a.isFieldRequired=!0:j.isEmpty(b.data)||j.isNullOrEmpty(b.data.id)?a.isFieldRequired=!0:a.isFieldRequired=!1},!0),a.$watch("orgLoc",function(b){j.isEmpty(b)?a.isFieldRequired=!1:j.isEmpty(b.data)||j.isNullOrEmpty(b.data.id)?a.isFieldRequired=!1:a.isFieldRequired=!0},!0),a.moveToPreviousStep=function(){j.goBackToPrevState()},
//Search Organization Location Address
a.searchOrgLocationAddress=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,a.orgLocAddressSpinner=!0,k.searchOrgLocationAddress(a.searchCriteria,a.filter.org,a.filter.orgLoc,function(b){a.orgLocAddressSpinner=!1,a.wsOrgLocationAddressList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.orgLocAddressSpinner=!1})},
// Inactive organization Location Address
a.inactiveOrgLocationAddress=function(b){l.inActiveOrgLocationAddress(b,function(b){f("success",g.instant(b.successMessage)),a.searchOrgLocationAddress()},function(a){j.isEmpty(a)||j.isEmpty(a.messages)?f("error",g.instant("FAILED_TO_UPDATE_RECORD")):f("error",g.instant(a.messages[0]))})},
//Fetch records
a.fetchRecords=function(){a.searchOrgLocationAddress()},
//clear search
a.clear=function(){a.searchCriteria={},a.$broadcast("clearOrgLocData"),a.filter.org={},a.filter.orgLoc={},a.fetchRecords()},
//Dispaly add/edit/view organization location address form
a.manageOrgLocationAddress=function(e,f){var g={type:f,organizationLocationAddressId:e};a.filter.org&&a.filter.org.data?g.organization={id:a.filter.org.data.id,displayName:a.filter.org.data.value}:g.organization=null,!a.filter.orgLoc||!a.filter.orgLoc.data||b.loggedInUserDetails&&"SYSTEM"===b.loggedInUserDetails.userOrganizationCategoryType&&c.wallData.whetherSubscriberOrganization?g.organizationLocation=null:g.organizationLocation={id:a.filter.orgLoc.data.id,displayName:a.filter.orgLoc.data.value},d.go("manageOrgLocationAddress",g)},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchOrgLocationAddress()},
//set page record
a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchOrgLocationAddress()};
//datatble config json
var m={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(m),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){console.log(c),j.isEmpty(c.organization)||j.isEmpty(c.organizationLocation)||(a.filter.org.data={id:c.organization.id,value:c.organization.displayName},a.filter.orgLoc.data={id:c.organizationLocation.id,value:c.organizationLocation.displayName},a.searchOrgLocationAddress()),c.wallData&&(c.wallData.organization||c.wallData.orglocation)&&(/*$stateParams.organization = {
                        id: $stateParams.wallData.organization.id,
                        displayName: $stateParams.wallData.organization.value
                    };
                    if (!utilService.isFieldEmpty($stateParams.wallData.orglocation)) {
                        $stateParams.organizationLocation = {
                            id: $stateParams.wallData.orglocation.id,
                            displayName: $stateParams.wallData.orglocation.value
                        };
                    };*/
a.filter.org.data=c.wallData.organization,j.isFieldEmpty(c.wallData.orglocation)||(a.filter.orgLoc.data=c.wallData.orglocation),a.searchOrgLocationAddress())},a.init()}]),angular.module("paripal.organizationLocationAddress").service("manageOrgLocationAddressService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.saveOrgLocationAddress=function(c,e,f,g,h,i,j,k){var l="",m=angular.copy(g);m.hasOwnProperty("disabledAddressType")&&delete m.disabledAddressType,m.version=f,d.isNullOrEmpty(c)||(m.id=c);/*if (!utilService.isEmpty(WSOtherEntity.organizationLocation) && !utilService.isEmpty(WSOtherEntity.organizationLocation.data)) {
            	organizationLocationAddress.organizationLocation = WSOtherEntity.organizationLocation.data;
            }*/
for(var n=0;n<i.length;n++)0==n&&i[n].dataValue&&(m.addressCategoryId1=i[n].dataValue),1==n&&i[n].dataValue&&(m.addressCategoryId2=i[n].dataValue),2==n&&i[n].dataValue&&(m.addressCategoryId3=i[n].dataValue);g.whetherCurrentAddress?m.whetherCurrentAddress=g.whetherCurrentAddress:m.whetherCurrentAddress=!1,/* WSOrganizationLocationAddress.district = {
                id: 1
            };*/
l="add"===e?"ADD_ORG_LOCATION_ADDRESS":"UPDATE_ORG_LOCATION_ADDRESS",a.postData(b.getUrl(l),m,function(a){j(a&&a.data?a.data:a)},function(a){k(a)})},this.inActiveOrgLocationAddress=function(c,d,e){var f={};f.organizationLocationAddressId=c,a.putData(b.getParameterizedUrl("INACTIVE_ORG_LOCATION_ADDRESS",f),null,function(a){d(a&&a.data?a.data:a)},function(a){e(a)})},this.getOrganizationLocationAddressDetails=function(c,d,e){var f={};f.organizationLocationAddressId=c,a.getData(b.getParameterizedUrl("GET_ORG_LOC_ADDRESS_BY_ID",f),null,function(a){d(a&&a.data?a.data:a)},function(a){e(a)})},this.fetchCategotyLabels=function(c,d,e){a.postData(b.getUrl("FETCH_CATEGORIES"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.uploadFiles=function(c,d,e){var f=b.getUrl("UPLOAD_ORG_LOCATION_ADDRESS_PHOTO");f&&a.postData(f,c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchAttachmentList=function(c,d,e){var f=null,g={};g.orgLocAddressId=c,f=b.getParameterizedUrl("FIND_ORG_LOCATION_ADDRESS_PHOTO",null),f&&a.getData(f,g,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteFile=function(c,d,e){var f=null,g={};g.id=c,f=b.getParameterizedUrl("DELETE_ORG_LOCATION_ADDRESS_PHOTO",g),f&&a.deleteData(f,null,function(a){d(a)},function(a){e(a)})}}]),angular.module("paripal.organizationLocationAddress").service("orgLocationAddressListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchOrgLocationAddress=function(c,d,e,f,g){d.data&&(c.organizationId=d.data.id),e.data&&(c.organizationLocationId=e.data.id),a.postData(b.getUrl("SEARCH_ORG_LOC_ADDRESS"),c,function(a){f(a.data)},function(a){g(a)})}}]),angular.module("paripal.managePackages").controller("ManagePackagesCtrl",["$scope","$state","$stateParams","httpService","urlService","utilService","notify","dateconvertor","$filter","datatableconfig","$uibModal","serverSidePagination","commonConstants","valueConveter","getPicklistObject","$translate","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.packageObject={},a.today=new Date,a.packageObject.organizationId={},a.packageObject.organizationLocationId={},a.packageObject.whetherActive=!0,a.packageObject.whetherClientsOnly=n.booleanToString(!1),a.packageObject.whetherConsolidatedPrice=!1,a.serviceTypeList=[],a.feeRecordList=[],a.commonConstants=m,a.init=function(){d.getData(e.getUrl("GET_SERVICE_TYPE"),null,function(b){a.serviceTypeList=angular.fromJson(b.data)},function(a){}),a.checkPageState()},a.checkPageState=function(){if("edit"===c.type||"view"===c.type){a.pageState=c.type;var b=c.data;a.setPackageObject(b)}if("add"===c.type||f.isNullOrEmpty(c.type)){a.pageState="add";var d=q.getDefaultOrgLocation();f.isFieldEmpty(d)||(a.packageObject.organizationId={data:d.org},a.packageObject.organizationLocationId={data:d.orgLoc})}},a.validateActiveFlag=function(){a.packageObject.whetherActive=!f.dateComparator(a.packageObject.validFrom,a.today,"gt")},a.setPackageObject=function(b){f.isNullOrEmpty(b.validFrom)||(b.validFrom=h.convertToViewDate(b.validFrom)),f.isNullOrEmpty(b.validTill)||(b.validTill=h.convertToViewDate(b.validTill)),f.isNullOrEmpty(b.organizationId)||(b.organizationId={data:{id:b.organizationId,value:b.organizationDisplayName}}),f.isNullOrEmpty(b.organizationLocationId)||(b.organizationLocationId={data:{id:b.organizationLocationId,value:b.organizationLocationDisplayName}}),a.packageObject=b},/**
         * Create/Update package
         * @param {object} newPackageForm Form object to check if form is valid or not
         */
a.createPackage=function(b){if(a.dateErrorList=[],a.progress=!0,b.$valid){var c={};angular.copy(a.packageObject,c);if(f.isNullOrEmpty(c.validFrom)||(c.validFrom=h.convertToServerDate(a.packageObject.validFrom)),f.isNullOrEmpty(c.validTill)||(c.validTill=h.convertToServerDate(a.packageObject.validTill)),f.isEmpty(c.organizationId)||(c.organizationId=a.packageObject.organizationId.data.id),f.isEmpty(c.organizationLocationId)||(c.organizationLocationId=a.packageObject.organizationLocationId.data.id),f.isNullOrEmpty(c.whetherClientsOnly)||(c.whetherClientsOnly=n.stringToBoolean(a.packageObject.whetherClientsOnly)),f.isEmpty(c.feeRecord)||(c.feeRecord=angular.fromJson(c.feeRecord)),c.packageType=o.getObject(c.packageType),c.purpose=o.getObject(c.purpose),f.isNullOrEmpty(a.packageObject.id))d.postData(e.getUrl("CREATE_PACKAGE"),c,function(b){f.isNullOrEmpty(b.messages)?(g("success",b.data.successMessage),a.back()):(a.dateErrorList=angular.fromJson(b.messages),a.dateError=!0)},function(){a.progress=!1});else{var i={};i.packageId=a.packageObject.id,d.putData(e.getParameterizedUrl("UPDATE_PACKAGE",i),c,function(b){f.isNullOrEmpty(b.data.message)?(g("success",b.data.successMessage),a.back()):(a.dateErrorList=angular.fromJson(b.data.message),a.dateError=!0)},function(b){a.progress=!1})}}else g("warning",p.instant("FILL_MANDATORY_FIELDS")),a.progress=!1},a.back=function(){f.goBackToPrevState()},a.init()}]),angular.module("paripal.managePackages").controller("PackageInclusionListCtrl",["$scope","$filter","$state","datatableconfig","httpService","urlService","dateconvertor","notify","serverSidePagination","utilService","$uibModal","valueConveter","$stateParams","commonConstants","$mdMedia","$mdDialog","getPicklistObject","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){a.filterObj={},a.data={},a.commonConstants=n,a.today=new Date,a.filterObj.org={},a.isDisabled=!0,/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=a.commonConstants.defaultPageNo,a.itemPerPage=a.commonConstants.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.packageInclusionObject={},a.requestData={},/**
         * Called when controller loads
         */
a.init=function(){a.checkPageState();var b=r.getDefaultOrgLocation();j.isFieldEmpty(b)||(a.filterObj.org={data:b.org},a.isOrganizationEmpty())},a.isOrganizationEmpty=function(){a.isDisabled=j.isFieldEmpty(a.filterObj.org)},/**
         * Check if view is called from search packages
         */
a.checkPageState=function(){j.isNullOrEmpty(m.data)?a.totalItems=0:(a.filterObj.packageObj={},a.data.validFrom=m.data.validFrom,a.filterObj.packageObj.packageName=m.data.packageName,a.filterObj.packageObj.packageId=m.data.packageId,a.filterObj.packageObj.flag=m.data.whetherConsolidatedPrice,a.filterObj.packageObj.organizationLocationId=m.data.organizationLocationId,a.filterObj.org.data=m.data.organization,a.getPackageInclusions(m.data.packageId))},/**
         * Typeahead for packages
         * @param   {string} viewValue String as user enters
         * @returns {Array} Array of the list of packages
         */
a.getPackages=function(b,c){var d={};return a.packageList=[],d.packageName=b,d.organizationId=c.data.id,a.packageNameAutoCmp=!0,e.getData(f.getParameterizedUrl("FIND_PACKAGEBYNAME",d),null,function(b){return a.packageNameAutoCmp=!1,a.packageList=angular.fromJson(b.data)},function(b){a.packageNameAutoCmp=!1})},/**
         * Typeahead for Editable packages
         * @param   {string} viewValue String as user enters
         * @returns {Array} Array of the list of packages
         */
a.getEditablePackages=function(b){var c={};return a.editablepackageList=[],c.packageName=b,a.editablePackageAutoCmp=!0,e.getData(f.getParameterizedUrl("FIND_EDITABLE_PACKAGE",c),null,function(b){return a.editablePackageAutoCmp=!1,a.editablepackageList=angular.fromJson(b.data)},function(b){a.editablePackageAutoCmp=!1})},/**
         * Typeahead for diagnostic tests
         * @param   {string} viewValue String as user enters
         * @returns {Array} Array of the list of diagnostic tests
         */
a.getDiagnosticTestName=function(b){var c={};return a.diagnosticTestNameList=[],j.isFieldEmpty(b)&&(b=""),c.testName=b,c.locationId=a.packageInclusionObject.packageObj.organizationLocationId,a.diagnosticTestNameSpinner=!0,e.getData(f.getParameterizedUrl("FIND_TEST_BY_LOC",c),null,function(b){a.diagnosticTestNameSpinner=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticTestNameSpinner=!1})},/**
         * Get package constituent list linked to package ID
         * @param {number} packageId Package id
         */
a.getPackageInclusions=function(b){if(!j.isFieldEmpty(b)){var c={};c.id=b,c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,c.sorters=a.requestData.sorters,a.inclusionListSpinner=!0,e.postData(f.getUrl("GET_INCLUSIONSBYPACKAGEID"),c,function(b){a.inclusionListSpinner=!1,a.inclusionList=angular.fromJson(b.data.data),a.totalItems=angular.fromJson(b.data.totalRecords),a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.inclusionListSpinner=!1})}},/**
         * Popup for removing package constituent
         * @param {object} row Object from constituent list
         */
a.showConfirm=function(b){a.data=b,a.modalInstance=k.open({scope:a,animation:!0,templateUrl:"app/modules/packages-management/views/remove-package-inclusion-popup.html",size:"md",keyboard:!0,backdrop:!1})},/**
         * Disable/enable edit functionality
         * @param   {string} packageValidFrom Valid from date of selected package
         * @returns {boolean} If package valid from is less than todays date, returns true else false
         */
a.isEditable=function(b){return j.dateComparator(b,a.today,"let")},a.removePackageInclusion=function(b){var c={};c.packageInclusionId=b.constituentId,e.deleteData(f.getParameterizedUrl("REMOVE_PACKAGEINCLUSION",c),null,function(b){b.data.successMessage&&(h("success",b.data.successMessage),a.modalInstance.close(),a.getPackageInclusions(a.filterObj.packageObj.packageId))},function(){})},/**
         * Cancel functionality when remove popup is cancelled
         */
a.cancelPopup=function(){a.modalInstance.close()},/**
         * Get package inclusion by id
         * @param {object}   obj Object of selected package inclusion
         */
a.viewPackageInclusion=function(b,c){var d={};d.packageInclusionId=b.constituentId,e.getData(f.getParameterizedUrl("FIND_INCLUSIONBYINCLUSIONID",d),null,function(b){a.packageInclusionObject=angular.fromJson(b.data),a.packageInclusionObject.diagnosticTestNameObj={diagnosticTestId:a.packageInclusionObject.diagnosticTestId,diagnosticTestName:a.packageInclusionObject.diagnosticTestName},a.packageInclusionObject.packageObj=a.setPackageObject(a.filterObj.packageObj.packageId,a.filterObj.packageObj.packageName,a.filterObj.packageObj.flag)},function(){})},a.addViewPackageInclusion=function(c,d,e){j.isFieldEmpty(a.filterObj.packageObj)?h("warning",b("translate")("PLEASE_SELECT_PACKAGE")):a.isEditable(a.data.validFrom)&&"add"===e?h("warning",b("translate")("PACKAGE_ACTIVE_ERROR")):(p.show({scope:a,preserveScope:!0,templateUrl:"app/modules/packages-management/views/manage-package-inclusions.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:n.dialogBox.clickOutsideToClose,locals:{packageInclusionObject:a.packageInclusionObject}}).then(function(a){},function(){a.packageInclusionObject={}}),a.checkPageStateForInclusion(c,e))},a.reloadPage=function(b){j.isEmpty(b)&&(a.data={},a.totalItems=0,a.pagingInfo={},a.inclusionList=[])},a.setValidFromDate=function(b){a.data={},a.data.validFrom=b.validFrom,a.getPackageInclusions(b.packageId)},a.checkPageStateForInclusion=function(b,c){"view"===c&&(a.pageState="view",a.viewPackageInclusion(b)),"add"===c&&(a.pageState="add"),j.isEmpty(a.filterObj.packageObj)||(a.packageInclusionObject.packageObj=a.setPackageObject(a.filterObj.packageObj.packageId,a.filterObj.packageObj.packageName,a.filterObj.packageObj.flag,a.filterObj.packageObj.organizationLocationId),a.getDiagnosticTestName())},a.setPackageObject=function(a,b,c,d){var e={};return e={id:a,value:b,flag:c,organizationLocationId:d}},a.hide=function(){p.hide()},a.cancel=function(){p.cancel()},a.savePackageInclusion=function(b){if(b.$valid){a.isRequestSent=!0;var c={};angular.copy(a.packageInclusionObject,c),j.isEmpty(a.packageInclusionObject.packageObj)||(c.testPackageId=a.packageInclusionObject.packageObj.id,delete c.packageObj),j.isEmpty(a.packageInclusionObject.diagnosticTestNameObj)||(c.diagnosticTestId=a.packageInclusionObject.diagnosticTestNameObj.diagnosticTestId,delete c.diagnosticTestNameObj),c.diagnosticTestType=q.getObject(c.diagnosticTestType),e.postData(f.getUrl("CREATE_PACKAGEINCLUSION"),c,function(b){j.isNullOrEmpty(b.data.successMessage)||(a.isRequestSent=!1,h("success",b.data.successMessage),a.filterObj.packageObj={packageId:a.packageInclusionObject.packageObj.id,packageName:a.packageInclusionObject.packageObj.value,flag:a.packageInclusionObject.packageObj.flag,organizationLocationId:a.packageInclusionObject.packageObj.organizationLocationId},a.getPackageInclusions(a.packageInclusionObject.packageObj.id),a.cancel())},function(b){a.isRequestSent=!1})}},/*
                $scope.pageChanged = function () {
                    $scope.pagingInfo = serverSidePagination($scope.currentPage, $scope.itemPerPage, $scope.totalItems);
                    // $scope.applyFilters();
                };
        */
a.setMaxRecords=function(c){j.isEmpty(a.filterObj.packageObj)?h("warning",b("translate")("PACKAGE_OBJECT_NULL_ERROR")):(a.currentPage=1,a.itemPerPage=c,a.getPackageInclusions(a.filterObj.packageObj.packageId))},a.clear=function(){a.filterObj={},a.packageId="",a.getPackageInclusions(a.packageId)},a.init();var s=n.gridConfigurations;a.options=d.setOptionProperties(s)}]),angular.module("paripal.manageRole").controller("PackageStatisticsCtrl",["$scope",function(a){}]),angular.module("paripal.managePackages").controller("SearchPackagesCtrl",["$scope","$filter","$state","datatableconfig","httpService","urlService","dateconvertor","notify","serverSidePagination","utilService","$uibModal","valueConveter","commonConstants","UserOrgListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.organizationsList=[],a.filter={},a.filter.organization={},a.filter.orgLocation={},a.requestData={},a.today=new Date,a.commonConstants=m,a.test=function(a,b){var b=b;a.preventDefault(),a.stopPropagation(),angular.element(b).siblings().removeClass("open"),angular.element(b).toggleClass("open")},a.goToPackageUserCount=function(a){var b={};b.id=a.packageId,b.packageName=a.packageName,c.go("packagereports",{data:b})},/*$scope.goToMonthlyPackageTypeUserCount = function (rowObj) {
    var packageObject = {};
    packageObject.id = rowObj.packageId;
    packageObject.packageName = rowObj.packageName;
    $state.go("monthlypackagetypeusercount", {
        data: packageObject
    });
};
$scope.goToMonthlyPackageWiseUserCount = function (rowObj) {
    var packageObject = {};
    packageObject.id = rowObj.packageId;
    packageObject.packageName = rowObj.packageName;
    $state.go("monthlypackagewiseusercount", {
        data: packageObject
    });
};*/
/*
         * For Pagination defaults value
         * Default records per page
         */
a.currentPage=m.defaultPageNo,a.itemPerPage=m.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.toggleActiveStatus=function(b,c){n.toggleActiveStatus(b,c,"testPackages",null,function(){a.searchPackages()},function(){})},a.isEditable=function(b){return j.dateComparator(b,a.today,"let")},a.searchPackages=function(){a.data=[];var b={};a.packagesListSpinner=!0,angular.copy(a.filter,b),j.isEmpty(b.organization)||(b.organizationId=b.organization.data.id),delete b.organization,j.isEmpty(b.orgLocation)||(b.organizationLocationId=b.orgLocation.data.id),delete b.orgLocation,j.isEmpty(a.filter.purposeObj)||(b.purposeCode=a.filter.purposeObj.dataValue.code),delete b.purposeObj,!j.isNullOrEmpty(a.filter.packageValidFrom),!j.isNullOrEmpty(a.filter.packageValidTill),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,e.postData(f.getUrl("SEARCH_PACKAGES"),b,function(b){a.packagesListSpinner=!1,a.data=angular.fromJson(b.data),a.totalItems=a.data.totalRecords,a.packages=a.data.data,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.packagesListSpinner=!1})},a.searchPackages(),a.clear=function(){a.filter={},a.filter.organization={},a.filter.orgLocation={},a.searchPackages()},a.addNewPackage=function(){c.go("managepackage",{type:"add"})},a.viewPackageStatistics=function(a){},a.getPackageById=function(a,b){var d=a.packageId,g={packageId:d},h={};e.getData(f.getParameterizedUrl("FIND_PACKAGEBYID",g),null,function(a){h=angular.fromJson(a.data),
//whetherClientsOnly
h.whetherClientsOnly=l.booleanToString(a.data.whetherClientsOnly),c.go("managepackage",{type:b,data:h})})},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchPackages()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchPackages()},a.goToPackageInclusionList=function(a){c.go("packageinclusionlist",{data:a})};var o=m.gridConfigurations;a.options=d.setOptionProperties(o)}]),angular.module("paripal.managePackages").service("getPicklistObject",function(){var a={};return a.getObject=function(a){var b={};return b=a.dataValue},a}),angular.module("paripal.managePackages").service("loadCommonList",["httpService","urlService",function(a,b){var c=[],d=[],e=[],f={};return f.getFeeRecordList=function(){return a.getData(b.getUrl("GET_FEERECORDLIST"),null,function(a){return c=a.data})},f.getServiceType=function(){return a.getData(b.getUrl("GET_SERVICE_TYPE"),null,function(a){return d=a.data})},f.getDiagnostictestType=function(){return a.getData(b.getUrl("GET_DIAGNOSTICTESTTYPE"),null,function(a){return e=a.data})},f}]),angular.module("paripal.managePackages").service("valueConveter",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.stringToBoolean=function(a){return"true"===a},this.booleanToString=function(a){return a===!0?"true":"false"}}]),angular.module("paripal.patientRecordModule").controller("vpr_ctrl",["$scope","$state","$rootScope","$mdDialog","utilService","urlService","httpService","vprService","notify","$translate","PatientRecord","serverSidePagination","viewUserSymptomsService","searchBloodRequestServices","searchBloodDonationServices","viewUserIncidentService","searchUserIssueService","viewUserTreatmentService","viewUserVaccinationServices","viewUserMedicationService","orgLocClientListService","myReqService","appointmentsListService","featurePrivilegeConstants","userTestListService","commonBillingService","commonConstants","manageUserProfileService","viewReceiptPaymentService","searchUserFamilyHistoryService","$stateParams","baseService","$timeout","appointmentsListService","commonCalendarService","userStackholderRequestListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,w,H,I){function J(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,g.getData(f.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.userInfo.orgLocationCode=b.data[0],localStorage.setItem("location",JSON.stringify(a.userInfo.orgLocationCode)),a.userInfo.orgLocationCode},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function K(){if(a.invisible=!0,a.invisible=!1,E.id&&E.displayName&&E.locationId&&E.locationValue)a.invisible=!0,a.patient={},a.patient.getName={},a.userInfo.getName=E.displayName,a.patient.getName.id=E.id,a.patient.getName.value=E.displayName,a.patientrecord.userId=E.id,a.patientrecord.name=E.displayName,a.userInfo.orgLocationCode={},a.userInfo.orgLocationCode.id=E.locationId,a.userInfo.orgLocationCode.value=E.locationValue,a.patientrecord.location=E.locationId,a.patientrecord.locationName=E.locationValue,localStorage.setItem("client",JSON.stringify(a.patient.getName)),localStorage.setItem("location",JSON.stringify(a.userInfo.orgLocationCode)),k.vprUserDetails=angular.copy(a.patientrecord),O(),a.filter=!0;else if(localStorage.getItem("client")){var b=localStorage.getItem("client"),c=JSON.parse(b);if(c.id&&(a.userInfo.getName={},a.userInfo.getName.id=c.id,a.userInfo.getName.value=c.value,a.patientrecord.userId=c.id,a.patientrecord.name=c.value),localStorage.getItem("location")){var d=localStorage.getItem("location"),b=JSON.parse(d);a.patientrecord.location=b.id,a.patientrecord.locationName=b.value,a.userInfo.orgLocationCode={},a.userInfo.orgLocationCode.id=b.id,a.userInfo.orgLocationCode.value=b.value,a.patientrecord.location=b.id,a.patientrecord.locationName=b.value,k.vprUserDetails=angular.copy(a.patientrecord),O(),a.filter=!0}}}function L(){var b={},c=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessShowNotes=c,b.accessKeyId=c.patientRecord.accessKeyId,b.currentOTP=c.patientRecord.otp,g.getData(f.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",b),null,function(a){a&&1==a.data&&K()},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error","OTP Has Expired Or Invalid Access")})}function M(){var a=localStorage.getItem("location"),b=JSON.parse(a);return b}function N(b){if(a.filter=!1,!b)return i("Alert","User Not Found");if(Yb&&Yb.isOrganizationUserMode){if(!b.getName.id)return i("Alert","Please select user from filter");a.patientrecord.userId=b.getName.id,a.patientrecord.name=b.getName.value,localStorage.setItem("client",JSON.stringify(b.getName))}else if(Yb&&!Yb.isOrganizationUserMode)b.getName.requestFrom?(b.getName.requestFrom&&b.getName.status?(a.redirectStkUser="stakeHolderUserDPR",a.restrictAdd=!0):(a.restrictAdd=!1,a.redirectStkUser=null),b.getName.requestFrom&&b.getName.status&&b.getName.whetherSharingAllowed?a.shareForbidden=!1:b.getName.requestFrom&&!b.getName.status?a.shareForbidden=!1:a.shareForbidden=!0,a.patientrecord.userId=b.getName.requestFrom.id,a.patientrecord.name=b.getName.requestFrom.value,localStorage.setItem("client",JSON.stringify(b.getName))):(a.patientrecord.userId=Yb.id,a.patientrecord.name=b.getName);else if(!Yb){if(!b.getName.id)return i("Alert","Please select user from filter");a.patientrecord.userId=b.getName.id,a.patientrecord.name=b.getName.value,localStorage.setItem("client",JSON.stringify(b.getName))}if(b.orgLocationCode){if(!b.orgLocationCode||!b.orgLocationCode.id)return i("Alert","Please select location from filter");Wb=b.orgLocationCode,localStorage.setItem("location",JSON.stringify(b.orgLocationCode)),a.patientrecord.location=b.orgLocationCode.id,a.patientrecord.locationName=b.orgLocationCode.value,P(a.patientrecord.location)}k.vprUserDetails=angular.copy(a.patientrecord),O()}/****************************************VPR Fetch Records Start*****************************************/
function O(){a.vprIssue={},a.vprTreatment={},a.vprMedication={},a.vprVaccination={},a.vprFamilyHistory={},a.vprIncident={},a.vprSymptom={},a.vprBloodDonation={},a.vprBloodRequest={},a.vprBill={},a.vprComplaint={},a.vprlocation={},a.vprDependent={},a.vprRequest={},a.vprCertificate={},a.vprAppointment={},a.vprPaymentMade={},a.vprDiagnosticTest={},T(),R(),S(),X(a.vprIssue),ca(a.vprTreatment),ia(a.vprMedication),oa(a.vprVaccination),ta(a.vprFamilyHistory),ya(a.vprIncident),Ea(a.vprSymptom),Ka(a.vprBill),Ua(a.vprBloodDonation),Za(a.vprBloodRequest),db(a.vprlocation),gb(a.vprComplaint),Oa(a.vprDependent),pb(a.vprRequest),lb(a.vprCertificate),ub(a.vprAppointment),Db(a.vprDiagnosticTest),Jb(a.vprUserMeasurement),Qb(a.vprPaymentMade)}function P(b){return a.orgObj={},a.orgObj.organizationLocationId=b,g.getData(f.getParameterizedUrl("GET_ORG_LOC_BY_ID",a.orgObj),null,function(b){b.data&&(a.selectedOrganization=b.data)},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}/****************************************VPR Fetch Records end*****************************************/
/****************************************User Smart Search Start*****************************************/
function Q(b){a.userData={},a.userData.searchString=b,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_LIST_BY_SEACRH_KEY";return c.loggedInUserDetails&&!c.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),g.getData(f.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1,e.isEmpty(b.data)||e.isEmpty(b.data.messages[0])||i("error",j.instant(b.data.messages[0]))})}/****************************************User Smart Search Start*****************************************/
/*******************************************VPR UserDetails Start********************************************/
function R(){h.userDetails(a.patientrecord,function(b){b.data&&(a.patientrecord.name=b.data.displayName,a.patientrecord.phone=b.data.cell1,a.patientrecord.email=b.data.email1,a.patientrecord.age=b.data.age,a.patientrecord.phone2=b.data.cell2,b.data.userAddress&&b.data.userAddress.city&&b.data.userAddress.city.id&&(a.patientrecord.cityId=b.data.userAddress.city.id,a.patientrecord.city=b.data.userAddress.city.value),b.data.bloodGroupId&&b.data.bloodGroupId.id&&(a.patientrecord.bloodgroup=b.data.bloodGroupId.value))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function S(){if(a.patientrecord.userId){var b="FIND_CLIENT_BY_USER_ID",c={};return c.userId=a.patientrecord.userId,a.patientrecord.userId&&a.patientrecord.location&&(b="FIND_CLIENT_BY_USER_ID_LOC_ID",c.locId=a.patientrecord.location),g.getData(f.getParameterizedUrl(b,c),null,function(b){a.WSSetDataObj=b.data,a.patientrecord.hospitaluid=a.WSSetDataObj.patientId,a.patientrecord.patientsince=a.WSSetDataObj.validFrom,a.clientId=a.WSSetDataObj.id,a.filter=!0},function(b){e.isEmpty(b.data)||"RECORD_NOT_FOUND"!=b.data.errorCode?e.isEmpty(b.data)||e.isEmpty(b.data.messages[0])||(i("Alert",j.instant(b.data.messages[0])),a.filter=!1):(i("Alert","User is not a client of selected Location"),a.filter=!1)})}}function T(){h.userPersonalInfo(a.patientrecord,function(b){b&&b.data.gender&&(a.patientrecord.sex=b.data.gender.value)},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}/*******************************************VPR UserDetails End*****************************************/
/*******************************************Share Tab for Vpr Start*****************************************/
//share tab
function U(b){var c={};/*clientId.orgLocId = issue.lastTreatedIn.id;
                clientId.userId = issue.userId.id;*/
/*clientId.orgLocId = issue.lastTreatedIn.id;
                clientId.userId = issue.userId.id;*/
return a.patientrecord.userId?(c.userId=a.patientrecord.userId,a.patientrecord.location?(c.orgLocId=a.patientrecord.location,void g.getData(f.getQueryParameterizedUrl("GET_CLIENT_BY_USER_ID_LOC_ID",c),null,function(a){a&&a.data&&("advanceShare"==b?V("advanceShare",a.data):"share"==b&&V("share",a.data))},function(a){})):i("Alert","Please select location from filter")):i("Alert","Please select user from filter")}function V(c,d){if("share"==c){var f=new Object;if(f.mode="add",f.shareType="DPR",f.advanceShareType="ALL",f.entityId=d.id,f.onBehalfOf=a.userInfo.getName.id,e.isEmpty(a.userInfo.orgLocationCode)||(f.lastTreatedIn=a.userInfo.orgLocationCode),a.userInfo.getName.requestFrom)f.sharedEntityName="DPR-"+a.userInfo.getName.requestFrom.value.replace(/ +/g,""),NaN+a.userInfo.orgLocationCode.value.replace(/ +/g,"");else if(a.userInfo&&a.userInfo.getName&&a.userInfo.getName.value&&a.userInfo.orgLocationCode&&a.userInfo.orgLocationCode.value)f.sharedEntityName="DPR-"+a.userInfo.getName.value.replace(/ +/g,""),NaN+a.userInfo.orgLocationCode.value.replace(/ +/g,"");else{if(""==a.userInfo.orgLocationCode)return i("Alert","Please enter the Location");f.sharedEntityName="DPR-"+a.userInfo.getName.replace(/ +/g,""),NaN+a.userInfo.orgLocationCode.value.replace(/ +/g,"")}
//shareEntity.chainSharingId = recordId.chainSharingId;
f.callBackFun=function(){a.modeChange()},a.shareObject.init(f)}else"advanceShare"==c&&b.go("advancesharinglist",{type:"vpr",id:d.id,orgLocId:a.patientrecord.location})}/*******************************************Share Tab for Vpr End*****************************************/
/******************************************* VPR Issue Start********************************************************/
//Other Actions
function W(c,d,e){if("share"==d){var f=new Object;f.mode=d,f.shareType="USER_ISSUE",f.advanceShareType="ALL",f.entityId=c.id,f.sharedEntityName=c.diseaseVariant.value,f.chainSharingId=c.chainSharingId,f.lastTreatedIn=c.lastTreatedIn,f.callBackFun=function(){a.modeChange()},a.shareObject.init(f)}else if("list"==d){var g={userId:a.patientrecord.userId,value:a.patientrecord.name};if(a.patientrecord.location)var h={orgLocId:a.patientrecord.location,value:a.patientrecord.locationName};else var h=null;b.go("searchUserIssue",{orgLocId:h,user:g,fromState:a.redirectStkUser})}else"advanceshare"==d?b.go("advancesharinglist",{type:"diseasevarient",id:c.id,orgLocId:c.lastTreatedIn.id}):q.getUserIssueById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageUserIssue",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageUserIssue",{id:c,type:e,data:f})):"add"==d&&b.go("manageUserIssue",{id:c,type:e,data:f})},function(a){i("error",j.instant(a.data.messages[0]))})}
//Issue List
function X(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprIssue.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprIssue.creatingLocId=a.patientrecord.location),a.vprIssue.pageNumber=a.currentPage,a.vprIssue.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprIssue=angular.copy(b),h.getIssueList(c,function(b){if(b){a.patientRecordList.IssuesList=b.data,k.vprIssue.pageNumber=b.pageNumber,k.vprIssue.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprIssue.pagingInfo=c,k.vprIssue.pageNumber==k.vprIssue.totalPages||0==k.vprIssue.totalPages?k.vprIssue.issueNext=!0:k.vprIssue.issueNext=!1,1==k.vprIssue.pageNumber?k.vprIssue.issuePrev=!0:k.vprIssue.issuePrev=!1,a.vprIssue.issuePrev=angular.copy(k.vprIssue.issuePrev),a.vprIssue.issueNext=angular.copy(k.vprIssue.issueNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}
//Issue Filter
function Y(){d.show({templateUrl:"app/modules/patient-record/view/issue-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprIssue=k.vprIssue,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getIssueList=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprIssue={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(Wb.id)f.creatingLocId=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.creatingLocId=g.id)}else k.vprIssue={},d.cancel();k.vprIssue=angular.copy(f),h.getIssueList(f,function(b){b&&(a.patientRecordList.IssuesList=b.data,k.vprIssue.totalPages=b.totalPages,k.vprIssue.pageNumber=b.pageNumber,k.vprIssue.pageNumber==k.vprIssue.totalPages||0==k.vprIssue.totalPages?k.vprIssue.issueNext=!0:k.vprIssue.issueNext=!1,1==k.vprIssue.pageNumber?k.vprIssue.issuePrev=!0:k.vprIssue.issuePrev=!1,c.issuePage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprIssue={}}}]})}function Z(){k.vprIssue.pageNumber!=k.vprIssue.totalPages&&(k.vprIssue.pageNumber+=1),vprIssue=angular.copy(k.vprIssue),X(vprIssue)}function $(){k.vprIssue.pageNumber>=2&&(k.vprIssue.pageNumber-=1),vprIssue=angular.copy(k.vprIssue),X(vprIssue)}
//check access for managing data
function _(b){var c=!1;return a.accessibleSubscriberLocationForIssue&&!e.isEmpty(a.accessibleSubscriberLocationForIssue)&&a.accessibleSubscriberLocationForIssue.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}
// for share location hide other action
function aa(){if(E.transactionType)return a.shareLocation=!0,a.shareLocation}/******************************************* VPR Issue End********************************************************/
/*******************************************VPR Treatments Start*****************************************/
//Other Actions
function ba(c,d){if("share"==d){var f=new Object;f.mode=d,f.shareType="TREATMENT",f.advanceShareType="ALL",f.entityId=c.id,f.sharedEntityName=c.diseaseVariant.value,f.chainSharingId=c.chainSharingId,f.callBackFun=function(){a.modeChange()},a.shareObject.init(f)}else"list"==d?b.go("viewUserTreatment",{userId:a.patientrecord.userId,userName:a.patientrecord.name,locationId:a.patientrecord.location,locationName:a.patientrecord.locationName,fromState:a.redirectStkUser}):"advanceShare"==d?b.go("advancesharinglist",{type:"treatment",id:c.id}):r.getUserTreatmentById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageUserTreatment",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageUserTreatment",{id:c,type:e,data:f})):"add"==d&&b.go("manageUserTreatment")},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}
// $scope.newManageTreatment = function(){
//     $state.go("manageUserTreatment");
// }
//Fetch Treatments Record
function ca(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprTreatment.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprTreatment.treatmentLocation=a.patientrecord.location),a.vprTreatment.pageNumber=a.currentPage,a.vprTreatment.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprTreatment=angular.copy(b),h.fetchTreatmentRecords(c,function(b){if(b){a.patientRecordList.vprTreatmentsList=b.data,k.vprTreatment.pageNumber=b.pageNumber,k.vprTreatment.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprTreatment.pagingInfo=c,k.vprTreatment.pageNumber==k.vprTreatment.totalPages||0==k.vprTreatment.totalPages?k.vprTreatment.treatmentNext=!0:k.vprTreatment.treatmentNext=!1,1==k.vprTreatment.pageNumber?k.vprTreatment.treatmentPrev=!0:k.vprTreatment.treatmentPrev=!1,a.vprTreatment.treatmentPrev=angular.copy(k.vprTreatment.treatmentPrev),a.vprTreatment.treatmentNext=angular.copy(k.vprTreatment.treatmentNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function da(){k.vprTreatment.pageNumber!=k.vprTreatment.totalPages&&(k.vprTreatment.pageNumber+=1),vprTreatment=angular.copy(k.vprTreatment),ca(vprTreatment)}function ea(){k.vprTreatment.pageNumber>=2&&(k.vprTreatment.pageNumber-=1),vprTreatment=angular.copy(k.vprTreatment),ca(vprTreatment)}function fa(){d.show({templateUrl:"app/modules/patient-record/view/treatments-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.getTreatmentIssuetype=function(b){return a.name={},a.name.searchKeyWord=b,a.sideEffectLoad=!0,g.getData(f.getParameterizedUrl("TREATMENT_ISSUE_SERACHKEYWORD",a.name),null,function(b){return a.sideEffectLoad=!1,a.treatmentType=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,i("error",j.instant(b.data.messages[0]))})},a.patientrecord={},a.vprTreatment=k.vprTreatment,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.fetchTreatmentRecords=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprTreatment={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(Wb.id)f.treatmentLocation=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.treatmentLocation=g.id)}else k.vprTreatment={},d.cancel();k.vprTreatment=angular.copy(f),h.fetchTreatmentRecords(f,function(b){b&&(a.patientRecordList.vprTreatmentsList=b.data,k.vprTreatment.totalPages=b.totalPages,k.vprTreatment.pageNumber=b.pageNumber,k.vprTreatment.pageNumber==k.vprTreatment.totalPages||0==k.vprTreatment.totalPages?k.vprTreatment.treatmentNext=!0:k.vprTreatment.treatmentNext=!1,1==k.vprTreatment.pageNumber?k.vprTreatment.treatmentPrev=!0:k.vprTreatment.treatmentPrev=!1,c.treatmentPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprTreatment={}}}]})}
//check access for managing data
function ga(b){var c=!1;return a.accessibleSubscriberLocationForTreatment&&!e.isEmpty(a.accessibleSubscriberLocationForTreatment)&&a.accessibleSubscriberLocationForTreatment.forEach(function(a){if(a&&b&&a.id==parseInt(b))return c=!0}),c}/*******************************************VPR Treatments End*******************************************/
/*******************************************VPR Medication Start*****************************************/
//Other Actions
function ha(c,d){if("list"==d){var f={userid:a.patientrecord.userId,value:a.patientrecord.name},g={orgLocId:a.patientrecord.location,value:a.patientrecord.locationName};b.go("usermedication",{orgLocId:g,user:f,fromState:a.redirectStkUser})}else t.getUserMedicationById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageusermedication",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageusermedication",{id:c,type:e,data:f})):"add"==d&&b.go("manageusermedication")},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}
//Fetch Medication Record
function ia(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprMedication.user=a.patientrecord.userId,a.patientrecord.location&&(a.vprMedication.orgLocation=a.patientrecord.location),
//$scope.vprMedication.user=$scope.patientrecord.userId;
a.vprMedication.pageNumber=a.currentPage,a.vprMedication.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprMedication=angular.copy(c),h.fetchMedicationRecords(c,function(b){if(b){a.patientRecordList.vprMedicationsList=b.data,k.vprMedication.totalPages=b.totalPages,k.vprMedication.pageNumber=b.pageNumber;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprMedication.pagingInfo=c,k.vprMedication.pageNumber==k.vprMedication.totalPages||0==k.vprMedication.totalPages?k.vprMedication.medicationNext=!0:k.vprMedication.medicationNext=!1,1==k.vprMedication.pageNumber?k.vprMedication.medicationPrev=!0:k.vprMedication.medicationPrev=!1,a.vprMedication.medicationPrev=angular.copy(k.vprMedication.medicationPrev),a.vprMedication.medicationNext=angular.copy(k.vprMedication.medicationNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function ja(){k.vprMedication.pageNumber!=k.vprMedication.totalPages&&(k.vprMedication.pageNumber+=1),vprMedication=angular.copy(k.vprMedication),ia(vprMedication)}function ka(a){k.vprMedication.pageNumber>=2&&(k.vprMedication.pageNumber-=1),vprMedication=angular.copy(k.vprMedication),ia(vprMedication)}function la(){d.show({templateUrl:"app/modules/patient-record/view/medications-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope","PatientRecord",function(a,b){a.patientrecord={},a.vprMedication=b.vprMedication,a.patientrecord.userId=b.vprUserDetails.userId,a.patientRecordList=b.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.getTreatmenttype=function(b){return a.name={},a.name.name=b,a.sideEffectLoad=!0,g.getData(f.getParameterizedUrl("TREATMENT_TYPE",a.name),null,function(b){return a.sideEffectLoad=!1,a.treatmentType=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,i("error",j.instant(b.data.messages[0]))})},a.fetchMedicationRecords=function(f){if("clear"==f.fclear&&(f={}),!a.patientrecord.userId)return b.vprMedication={},d.cancel(),i("Alert","Please select user from filter");f.user=a.patientrecord.userId,f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage;var g=angular.copy(f);if(Wb.id)g.orgLocation=Wb.id;else if(localStorage.getItem("location")){var k=M();k.id&&(g.orgLocation=k.id)}else b.vprMedication={},d.cancel();b.vprMedication=angular.copy(g),h.fetchMedicationRecords(g,function(d){d&&(a.patientRecordList.vprMedicationsList=d.data,b.vprMedication.totalPages=d.totalPages,b.vprMedication.pageNumber=d.pageNumber,b.vprMedication.pageNumber==b.vprMedication.totalPages||0==b.vprMedication.totalPages?b.vprMedication.medicationNext=!0:b.vprMedication.medicationNext=!1,1==b.vprMedication.pageNumber?b.vprMedication.medicationPrev=!0:b.vprMedication.medicationPrev=!1,c.medicationPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprMedication={}},a.getTreatmentTypeId=function(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,g.getData(f.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,e.isEmpty(b.data)||e.isEmpty(b.data.messages[0])?i("error",j.instant("RECORD_SERACH_FAILURE")):i("Alert",j.instant(b.data.messages[0]))})}}]})}function ma(b){var c=!1;return a.accessabelSystemLocationForMedication&&!e.isEmpty(a.accessabelSystemLocationForMedication)&&a.accessabelSystemLocationForMedication.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}/*******************************************VPR Medication End***********************************/
/*******************************************VPR measurement Filter End***********************************/
/*******************************************Vaccination List Start**************************************/
//Manage Vaccination
function na(c,d){if("list"==d){var f={id:a.patientrecord.userId,value:a.patientrecord.name};if(a.patientrecord.location)var g={id:a.patientrecord.location,value:a.patientrecord.locationName};else var g=null;b.go("uservaccinations",{orgLocId:g,user:f,fromState:a.redirectStkUser})}else s.getUserVaccinationById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageuservaccinations",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageuservaccinations",{id:c,type:e,data:f})):"add"==d&&b.go("manageuservaccinations")},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}
//Fetch Vaccination Record
function oa(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprVaccination.id=a.patientrecord.userId,a.patientrecord.location&&(a.vprVaccination.location=a.patientrecord.location),a.vprVaccination.pageNumber=a.currentPage,a.vprVaccination.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprVaccination=angular.copy(c),h.fetchVaccintionRecords(c,function(b){if(b){a.patientRecordList.vprVaccinationsList=b.data,k.vprVaccination.pageNumber=b.pageNumber,k.vprVaccination.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprVaccination.pagingInfo=c,k.vprVaccination.pageNumber==k.vprVaccination.totalPages||0==k.vprVaccination.totalPages?k.vprVaccination.vaccinationNext=!0:k.vprVaccination.vaccinationNext=!1,1==k.vprVaccination.pageNumber?k.vprVaccination.vaccinationPrev=!0:k.vprVaccination.vaccinationPrev=!1,a.vprVaccination.vaccinationPrev=angular.copy(k.vprVaccination.vaccinationPrev),a.vprVaccination.vaccinationNext=angular.copy(k.vprVaccination.vaccinationNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function pa(){k.vprVaccination.pageNumber!=k.vprVaccination.totalPages&&(k.vprVaccination.pageNumber+=1),vprVaccination=angular.copy(k.vprVaccination),oa(vprVaccination)}function qa(){k.vprVaccination.pageNumber>=2&&(k.vprVaccination.pageNumber-=1),vprVaccination=angular.copy(k.vprVaccination),oa(vprVaccination)}/*******************************************Vaccination List End************************************************/
/*******************************************VPR Vaccination Filter Start****************************************/
//Filter Popup
function ra(){d.show({templateUrl:"app/modules/patient-record/view/vaccinations-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope","PatientRecord",function(a,b){a.vprVaccination=b.vprVaccination,a.patientrecord={},a.patientrecord.userId=b.vprUserDetails.userId,a.patientRecordList=b.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.fetchVaccintionRecords=function(f){if("clear"==f.filter&&(f={}),!a.patientrecord.userId)return b.vprVaccination={},d.cancel(),i("Alert","Please select user from filter");f.id=a.patientrecord.userId,f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage;var g=angular.copy(f);if(b.vprVaccination=angular.copy(f),Wb.id)g.location=Wb.id;else if(localStorage.getItem("location")){var k=M();k.id&&(g.location=k.id)}else b.vprVaccination={},d.cancel();b.vprVaccination=angular.copy(g),h.fetchVaccintionRecords(g,function(d){d&&(a.patientRecordList.vprVaccinationsList=d.data,b.vprVaccination.pageNumber=d.pageNumber,b.vprVaccination.totalPages=d.totalPages,b.vprVaccination.pageNumber==b.vprVaccination.totalPages||0==b.vprVaccination.totalPages?b.vprVaccination.vaccinationNext=!0:b.vprVaccination.vaccinationNext=!1,1==b.vprVaccination.pageNumber?b.vprVaccination.vaccinationPrev=!0:b.vprVaccination.vaccinationPrev=!1,c.vaccinationPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprVaccination={}}}]})}/*******************************************VPR Vaccination Filter End**********************************/
/*******************************************Family History List Start**************************************/
function sa(c,d){if("list"==d){if(a.patientrecord.location)var f={id:a.patientrecord.location,value:a.patientrecord.locationName};else var f=null;b.go("searchUserFamilyHistory",{orgLoc:f,userId:a.patientrecord.userId,userName:a.patientrecord.name,fromState:a.redirectStkUser})}else D.getUserFamilyById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageUserFamilyHistory",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageUserFamilyHistory",{id:c,type:e,data:f})):"add"==d&&b.go("manageUserFamilyHistory")},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}
//Fetch Vaccination Record
function ta(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprFamilyHistory.id=a.patientrecord.userId,a.patientrecord.location&&(a.vprFamilyHistory.location=a.patientrecord.location),a.vprFamilyHistory.pageNumber=a.currentPage,a.vprFamilyHistory.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprFamilyHistory=angular.copy(c),h.fetchFamilyHistoryRecords(c,function(b){if(b){a.patientRecordList.vprFamilyHistoryList=b.data,k.vprFamilyHistory.pageNumber=b.pageNumber,k.vprFamilyHistory.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprFamilyHistory.pagingInfo=c,k.vprFamilyHistory.pageNumber==k.vprFamilyHistory.totalPages||0==k.vprFamilyHistory.totalPages?k.vprFamilyHistory.familyHistoryNext=!0:k.vprFamilyHistory.familyHistoryNext=!1,1==k.vprFamilyHistory.pageNumber?k.vprFamilyHistory.familyHistoryPrev=!0:k.vprFamilyHistory.familyHistoryPrev=!1,a.vprFamilyHistory.familyHistoryPrev=angular.copy(k.vprFamilyHistory.familyHistoryPrev),a.vprFamilyHistory.familyHistoryNext=angular.copy(k.vprFamilyHistory.familyHistoryNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function ua(){k.vprFamilyHistory.pageNumber!=k.vprFamilyHistory.totalPages&&(k.vprFamilyHistory.pageNumber+=1),vprFamilHistory=angular.copy(k.vprFamilyHistory),ta(vprFamilHistory)}function va(){k.vprFamilyHistory.pageNumber>=2&&(k.vprFamilyHistory.pageNumber-=1),vprFamilHistory=angular.copy(k.vprFamilyHistory),ta(vprFamilHistory)}/*******************************************Family History List End************************************************/
/*******************************************VPR Family History Filter Start****************************************/
//Filter Popup
function wa(){d.show({templateUrl:"app/modules/patient-record/view/family-history-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope","PatientRecord",function(a,b){a.vprFamilyHistory=b.vprFamilyHistory,a.patientrecord={},a.patientrecord.userId=b.vprUserDetails.userId,a.patientRecordList=b.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=f.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return g.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.fetchFamilyHistoryRecords=function(f){if("clear"==f.fclear&&(f={}),!a.patientrecord.userId)return b.vprFamilyHistory={},d.cancel(),i("Alert","Please select user from filter");f.id=a.patientrecord.userId,f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage;var g=angular.copy(f);if(b.vprFamilyHistory=angular.copy(f),f.disease&&f.disease.id&&(g.diseaseId=f.disease.id),Wb.id)g.location=Wb.id;else if(localStorage.getItem("location")){var k=M();k.id&&(g.location=k.id)}else b.vprFamilyHistory={},d.cancel();b.vprFamilyHistory=angular.copy(g),h.fetchFamilyHistoryRecords(g,function(d){d&&(a.patientRecordList.vprFamilyHistoryList=d.data,b.vprFamilyHistory.pageNumber=d.pageNumber,b.vprFamilyHistory.totalPages=d.totalPages,b.vprFamilyHistory.pageNumber==b.vprFamilyHistory.totalPages||0==b.vprFamilyHistory.totalPages?b.vprFamilyHistory.familyHistoryNext=!0:b.vprFamilyHistory.familyHistoryNext=!1,1==b.vprFamilyHistory.pageNumber?b.vprFamilyHistory.familyHistoryPrev=!0:b.vprFamilyHistory.familyHistoryPrev=!1,c.familyHistoryPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprFamilyHistory={}}}]})}/*******************************************Family History List End**************************************/
/*******************************************VPR Incidents Start******************************************/
//Manage Incident
function xa(c,d){if("list"==d){/*$state.go("userincident");*/
var f={userId:a.patientrecord.userId,value:a.patientrecord.name};b.go("userincident",{orgLocId:a.patientrecord.location,user:f,fromState:a.redirectStkUser})}else p.getUserIncidentById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageuserincident",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageuserincident",{id:c,type:e,data:f})):"add"==d&&b.go("manageuserincident")},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}
//Fetch Incidents Record
function ya(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprIncident.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprIncident.orgLocation=a.patientrecord.location),a.vprIncident.pageNumber=a.currentPage,a.vprIncident.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprIncident=angular.copy(c),h.fetchIncidentRecords(c,function(b){if(b){a.patientRecordList.vprIncidentsList=b.data,k.vprIncident.totalPages=b.totalPages,k.vprIncident.pageNumber=b.pageNumber;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprIncident.pagingInfo=c,k.vprIncident.pageNumber==k.vprIncident.totalPages||0==k.vprIncident.totalPages?k.vprIncident.incidentNext=!0:k.vprIncident.incidentNext=!1,k.vprIncident.pageNumber<=1?k.vprIncident.incidentPrev=!0:k.vprIncident.incidentPrev=!1,a.vprIncident.incidentPrev=angular.copy(k.vprIncident.incidentPrev),a.vprIncident.incidentNext=angular.copy(k.vprIncident.incidentNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function za(){k.vprIncident.pageNumber!=k.vprIncident.totalPages&&(k.vprIncident.pageNumber+=1),vprIncident=angular.copy(k.vprIncident),ya(vprIncident)}function Aa(){k.vprIncident.pageNumber>=2&&(k.vprIncident.pageNumber-=1),vprIncident=angular.copy(k.vprIncident),ya(vprIncident)}function Ba(){d.show({templateUrl:"app/modules/patient-record/view/incidents-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprIncident=k.vprIncident,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.fetchIncidentRecords=function(b){var f=angular.copy(b);if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprIncident={},d.cancel(),i("Alert","Please select user from filter");if(b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,f=angular.copy(b),b.linkedToDiseaseAdd&&b.linkedToDiseaseAdd.id&&(f.linkedToDisease=b.linkedToDiseaseAdd.id),b.symptom&&b.symptom.id&&(f.symptom=b.symptom.id),Wb.id)f.orgLocation=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.orgLocation=g.id)}else k.vprIncident={},d.cancel();k.vprIncident=angular.copy(f),h.fetchIncidentRecords(f,function(b){b&&(a.patientRecordList.vprIncidentsList=b.data,k.vprIncident.totalPages=b.totalPages,k.vprIncident.pageNumber=b.pageNumber,k.vprIncident.pageNumber==k.vprIncident.totalPages||0==k.vprIncident.totalPages?k.vprIncident.incidentNext=!0:k.vprIncident.incidentNext=!1,k.vprIncident.pageNumber<=1?k.vprIncident.incidentPrev=!0:k.vprIncident.incidentPrev=!1,c.incidentPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),d.cancel()},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=f.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return g.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.getSymptom=function(b){a.queryObj={},a.queryObj.symptomName=b;var c=f.getParameterizedUrl("FIND_SYMPTOMNAME",a.queryObj);if(c)return g.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.cancel=function(){d.cancel()},a.clear=function(){a.vprIncident={}}}]})}
//check access for managing data
function Ca(b){var c=!1;return a.accessibleSubscriberLocationForIncident&&!e.isEmpty(a.accessibleSubscriberLocationForIncident)&&a.accessibleSubscriberLocationForIncident.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}/*******************************************VPR Incidents End********************************************/
/******************************************* VPR Symptom Start********************************************************/
//Manage Symptom
function Da(c,d){"list"==d?/*$state.go("viewUserSymptoms");*/
b.go("viewUserSymptoms",{userId:a.patientrecord.userId,userName:a.patientrecord.name,locationId:a.patientrecord.location,locationName:a.patientrecord.locationName,fromState:a.redirectStkUser}):m.getSymptomById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageUserSymptoms",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageUserSymptoms",{id:c,type:d,data:f})):"add"==d&&b.go("manageUserSymptoms")},function(a){i("error",j.instant(a.data.messages[0]))})}function Ea(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprSymptom.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprSymptom.creatingOrgLocId=a.patientrecord.location),a.vprSymptom.pageNumber=a.currentPage,a.vprSymptom.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprSymptom=angular.copy(c),h.getSymptomList(c,function(b){if(b){a.patientRecordList.symptomList=b.data,k.vprSymptom.totalPages=b.totalPages,k.vprSymptom.pageNumber=b.pageNumber;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprSymptom.pagingInfo=c,k.vprSymptom.pageNumber==k.vprSymptom.totalPages||0==k.vprSymptom.totalPages?k.vprSymptom.symptomNext=!0:k.vprSymptom.symptomNext=!1,k.vprSymptom.pageNumber<=1?k.vprSymptom.symptomPrev=!0:k.vprSymptom.symptomPrev=!1,a.vprSymptom.symptomPrev=angular.copy(k.vprSymptom.symptomPrev),a.vprSymptom.symptomNext=angular.copy(k.vprSymptom.symptomNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}function Fa(){k.vprSymptom.pageNumber!=k.vprSymptom.totalPages&&(k.vprSymptom.pageNumber+=1),vprSymptom=angular.copy(k.vprSymptom),Ea(vprSymptom)}function Ga(){k.vprSymptom.pageNumber>=2&&(k.vprSymptom.pageNumber-=1),vprSymptom=angular.copy(k.vprSymptom),Ea(vprSymptom)}function Ha(){d.show({templateUrl:"app/modules/patient-record/view/symptoms-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprSymptom=k.vprSymptom,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getSymptomList=function(b){var f=angular.copy(b);if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprSymptom={},d.cancel(),i("Alert","Please select user from filter");if(b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b.linkedToDiseaseAdd&&b.linkedToDiseaseAdd.id&&(b.linkedToDisease=b.linkedToDiseaseAdd.id),f=angular.copy(b),Wb.id)f.creatingOrgLocId=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.creatingOrgLocId=g.id)}else k.vprSymptom={},d.cancel();k.vprSymptom=angular.copy(f),h.getSymptomList(f,function(b){b&&(a.patientRecordList.symptomList=b.data,k.vprSymptom.totalPages=b.totalPages,k.vprSymptom.pageNumber=b.pageNumber,k.vprSymptom.pageNumber==k.vprSymptom.totalPages||0==k.vprSymptom.totalPages?k.vprSymptom.symptomNext=!0:k.vprSymptom.symptomNext=!1,k.vprSymptom.pageNumber<=1?k.vprSymptom.symptomPrev=!0:k.vprSymptom.symptomPrev=!1,c.symptomPage())},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),d.cancel()},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=f.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return g.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.cancel=function(){d.cancel()},a.clear=function(){a.vprSymptom={}}}]})}
//check access for managing data
function Ia(b){var c=!1;return a.accessibleSubscriberLocationForSymptom&&!e.isEmpty(a.accessibleSubscriberLocationForSymptom)&&a.accessibleSubscriberLocationForSymptom.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}/******************************************* VPR Symptom End********************************************************/
/*******************************************VPR Bills Filter Start***************************************/
function Ja(a,c){if("add"==c)b.go("createbill",{billId:null,data:null});else if("edit"==c){({id:a.id});b.go("managebill",{billId:a.id,type:"edit"})}else if("view"==c){({id:a.id});b.go("managebill",{billId:a.id,type:"view"})}else b.go("searchbill")}function Ka(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprBill.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprBill.raisedOnLocationId=a.patientrecord.location),
//$scope.vprBill.userId=$scope.patientrecord.userId;
a.vprBill.pageNumber=a.currentPage,a.vprBill.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprBill=angular.copy(c),h.billList(c,function(b){if(b){a.patientRecordList.billList=b.data,k.vprBill.totalPages=b.totalPages,k.vprBill.pageNumber=b.pageNumber;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprBill.pagingInfo=c,k.vprBill.pageNumber==k.vprBill.totalPages||0==k.vprBill.totalPages?k.vprBill.billNext=!0:k.vprBill.billNext=!1,k.vprBill.pageNumber<=1?k.vprBill.billPrev=!0:k.vprBill.billPrev=!1,a.vprBill.billPrev=angular.copy(k.vprBill.billPrev),a.vprBill.billNext=angular.copy(k.vprBill.billNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}function La(){k.vprBill.pageNumber!=k.vprBill.totalPages&&(k.vprBill.pageNumber+=1),vprBill=angular.copy(k.vprBill),Ka(vprBill)}function Ma(){k.vprBill.pageNumber>=2&&(k.vprBill.pageNumber-=1),vprBill=angular.copy(k.vprBill),Ka(vprBill)}function Na(){d.show({templateUrl:"app/modules/patient-record/view/billsraised-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprBill=k.vprBill,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getBillsList=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprBill={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(Wb.id)f.raisedOnLocationId=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.raisedOnLocationId=g.id)}else k.vprBill={},d.cancel();k.vprBill=angular.copy(f),h.billList(f,function(b){b&&(a.patientRecordList.billList=b.data,k.vprBill.totalPages=b.totalPages,k.vprBill.pageNumber=b.pageNumber,k.vprBill.pageNumber==k.vprBill.totalPages||0==k.vprBill.totalPages?k.vprBill.billNext=!0:k.vprBill.billNext=!1,k.vprBill.pageNumber<=1?k.vprBill.billPrev=!0:k.vprBill.billPrev=!1,c.billsPage())},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprBill={}}}]})}/*******************************************VPR Bills Filter End*****************************************/
/*******************************************VPR dependents Filter Start**********************************/
function Oa(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprDependent.userId=a.patientrecord.userId,a.vprDependent.pageNumber=a.currentPage,a.vprDependent.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprDependent=angular.copy(b),h.getDependentsList(c,function(b){if(b){a.patientRecordList.dependentList=b.data,k.vprDependent.pageNumber=b.pageNumber,k.vprDependent.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprDependent.pagingInfo=c,k.vprDependent.pageNumber==k.vprDependent.totalPages||0==k.vprDependent.totalPages?k.vprDependent.dependentNext=!0:k.vprDependent.dependentNext=!1,1==k.vprDependent.pageNumber?k.vprDependent.dependentPrev=!0:k.vprDependent.dependentPrev=!1,a.vprDependent.dependentPrev=angular.copy(k.vprDependent.dependentPrev),a.vprDependent.dependentNext=angular.copy(k.vprDependent.dependentNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}function Pa(){k.vprDependent.pageNumber!=k.vprDependent.totalPages&&(k.vprDependent.pageNumber+=1),vprDependent=angular.copy(k.vprDependent),getDependentsList(vprDependent)}function Qa(){k.vprDependent.pageNumber>=2&&(k.vprDependent.pageNumber-=1),vprDependent=angular.copy(k.vprDependent),getDependentsList(vprDependent)}/*******************************************VPR dependents Filter End**********************************/
/******************************************* VPR dependents CRUD Start********************************************************/
//Other Actions
function Ra(a,c){B.getUserProfileDetails(a,function(d){var e,f=d;"edit"==c?(e="edit",b.go("myProfile",{id:a,type:e,data:f})):"view"==c?(e="view",b.go("myProfile",{id:a,type:e,data:f})):"list"==c&&b.go("myProfile",{id:a,type:e,data:f})},function(a){i("error",j.instant(a.data.messages[0]))})}/******************************************* VPR dependents CRUD End********************************************************/
function Sa(){d.show({templateUrl:"app/modules/patient-record/view/dependents-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.cancel=function(){d.cancel()}}]})}/*******************************************VPR dependents Filter End************************************/
/******************************************* VPR Blood Donation Start********************************************************/
function Ta(c,d){if("list"==d){var f={id:a.patientrecord.userId,value:a.patientrecord.name};b.go("blooddonations",{orgLoc:a.patientrecord.locationName,user:f,fromState:a.redirectStkUser})}else o.getBloodDonationById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("manageblooddonation",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("manageblooddonation",{id:c,type:e,data:f})):"add"==d&&b.go("manageblooddonation")},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}function Ua(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprBloodDonation.userId=a.patientrecord.userId,a.patientrecord.locationName&&(a.vprBloodDonation.orgLocationName=a.patientrecord.locationName),a.vprBloodDonation.pageNumber=a.currentPage,a.vprBloodDonation.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprBloodDonation=angular.copy(c),h.getBloodDonationList(c,function(b){if(b){a.patientRecordList.bloodDonationsList=b.data,k.vprBloodDonation.pageNumber=b.pageNumber,k.vprBloodDonation.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprBloodDonation.pagingInfo=c,k.vprBloodDonation.pageNumber==k.vprBloodDonation.totalPages||0==k.vprBloodDonation.totalPages?k.vprBloodDonation.donationNext=!0:k.vprBloodDonation.donationNext=!1,1==k.vprBloodDonation.pageNumber?k.vprBloodDonation.donationPrev=!0:k.vprBloodDonation.donationPrev=!1,a.vprBloodDonation.donationPrev=angular.copy(k.vprBloodDonation.donationPrev),a.vprBloodDonation.donationNext=angular.copy(k.vprBloodDonation.donationNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}function Va(){k.vprBloodDonation.pageNumber!=k.vprBloodDonation.totalPages&&(k.vprBloodDonation.pageNumber+=1),vprBloodDonation=angular.copy(k.vprBloodDonation),Ua(vprBloodDonation)}function Wa(){k.vprBloodDonation.pageNumber>=2&&(k.vprBloodDonation.pageNumber-=1),vprBloodDonation=angular.copy(k.vprBloodDonation),Ua(vprBloodDonation)}function Xa(){d.show({templateUrl:"app/modules/patient-record/view/blooddonations-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope","$rootScope",function(a,b){a.patientrecord={},
//$scope.loginDetails = $rootScope.loggedInUserDetails;
a.patientrecord=k.vprUserDetails,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.vprBloodDonation=k.vprBloodDonation,a.getBloodDonationList=function(c){if("clear"==c.fclear&&(c={}),!a.patientrecord.userId)return k.vprBloodDonation={},d.cancel(),i("Alert","Please select user from filter");c.userId=a.patientrecord.userId,c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage;var f=angular.copy(c);if(Wb.id)f.orgLocationName=Wb.value;else if(localStorage.getItem("location")){var g=M();g.id&&(f.orgLocationName=g.value)}else k.vprBloodDonation={},d.cancel();k.vprBloodDonation=angular.copy(f),h.getBloodDonationList(f,function(c){c&&(a.patientRecordList.bloodDonationsList=c.data,k.vprBloodDonation.pageNumber=c.pageNumber,k.vprBloodDonation.totalPages=c.totalPages,k.vprBloodDonation.pageNumber==k.vprBloodDonation.totalPages||0==k.vprBloodDonation.totalPages?k.vprBloodDonation.donationNext=!0:k.vprBloodDonation.donationNext=!1,1==k.vprBloodDonation.pageNumber?k.vprBloodDonation.donationPrev=!0:k.vprBloodDonation.donationPrev=!1,b.bloodDonationPage())},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprBloodDonation={}}}]})}/******************************************* VPR Blood Donation End********************************************************/
/******************************************* VPR Blood Request Start ********************************************************/
function Ya(c,d){"list"==d?b.go("bloodreqlist",{orgLoc:a.patientrecord.locationName,fromState:a.redirectStkUser}):n.getBloodRequestById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("managebloodreq",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("managebloodreq",{id:c,type:e,data:f})):"add"==d&&b.go("managebloodreq")},function(a){})}function Za(b){if(!a.patientrecord.name)return i("Alert","Please select user from filter");a.vprBloodRequest.requestBy=a.patientrecord.name,a.vprBloodRequest.pageNumber=a.currentPage,a.vprBloodRequest.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprBloodRequest=angular.copy(c),h.BloodRequestSearchFilter(c,function(b){if(b){a.patientRecordList.bloodRequestList=b.data,k.vprBloodRequest.pageNumber=b.pageNumber,k.vprBloodRequest.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprBloodRequest.pagingInfo=c,k.vprBloodRequest.pageNumber==k.vprBloodRequest.totalPages||0==k.vprBloodRequest.totalPages?k.vprBloodRequest.requestNext=!0:k.vprBloodRequest.donationNext=!1,1==k.vprBloodRequest.pageNumber?k.vprBloodRequest.requestPrev=!0:k.vprBloodRequest.requestPrev=!1,a.vprBloodRequest.requestPrev=angular.copy(k.vprBloodRequest.requestPrev),a.vprBloodRequest.requestNext=angular.copy(k.vprBloodRequest.requestNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}function $a(){k.vprBloodRequest.pageNumber!=k.vprBloodRequest.totalPages&&(k.vprBloodRequest.pageNumber+=1),vprBloodRequest=angular.copy(k.vprBloodRequest),Za(vprBloodRequest)}function _a(){k.vprBloodRequest.pageNumber>=2&&(k.vprBloodRequest.pageNumber-=1),vprBloodRequest=angular.copy(k.vprBloodRequest),Za(vprBloodRequest)}function ab(){d.show({templateUrl:"app/modules/patient-record/view/bloodrequests-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope","$rootScope","serverSidePagination",function(a,b,c){a.patientrecord={},a.patientrecord.name=k.vprUserDetails.name,a.bloodGroups=["A+","A-","O+","O-","B+","B-","AB+","AB-"],a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.vprBloodRequest=k.vprBloodRequest,a.getBloodRequest=function(c){if("clear"==c.fclear&&(c={}),!a.patientrecord.name)return k.vprBloodRequest={},d.cancel(),i("Alert","Please select user from filter");c.requestBy=a.patientrecord.name,c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage;var f=angular.copy(c);k.vprBloodRequest=angular.copy(f),h.BloodRequestSearchFilter(f,function(c){c&&(a.patientRecordList.bloodRequestList=c.data,k.vprBloodRequest.pageNumber=c.pageNumber,k.vprBloodRequest.totalPages=c.totalPages,k.vprBloodRequest.pageNumber==k.vprBloodRequest.totalPages||0==k.vprBloodRequest.totalPages?k.vprBloodRequest.requestNext=!0:k.vprBloodRequest.donationNext=!1,1==k.vprBloodRequest.pageNumber?k.vprBloodRequest.requestPrev=!0:k.vprBloodRequest.requestPrev=!1,b.bloodRequestPage())},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprBloodRequest={}}}]})}
//getting accessabel locations users
function bb(){Yb&&g.getData(f.getParameterizedUrl("FIND_USER_BY_LOGGED_IN_ORG_USER"),null,function(b){a.allAccessibleOrgUsersForBloodRequest=b.data},function(a){i("error",j.instant(a.data.messages[0]))})}/******************************************* VPR Blood Request END********************************************************/
/*******************************************VPR Client Location Start***********************************/
//Other Actions
function cb(c,d){a.clientId&&u.getOrgLocClientById(a.clientId,function(c){var e=c;"view"===d||"edit"===d?b.go("addorglocclient",{type:d,data:e,clientId:a.clientId}):"add"==d?b.go("addorglocclient"):"list"==d&&b.go("orglocclientlist")},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}
//Fetch Client Location Details
function db(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprlocation.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprlocation.organizationLocationId=a.patientrecord.location),a.vprlocation.pageNumber=a.currentPage,a.vprlocation.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprlocation=angular.copy(b),h.locDetails(c,function(b){if(b){a.patientRecordList.vprLocationsList=b.data,a.vprlocation.pageNumber=b.pageNumber,a.vprlocation.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprlocation.pagingInfo=c,a.vprlocation.pageNumber==a.vprlocation.totalPages||0==a.vprlocation.totalPages?a.vprlocation.locationNext=!0:a.vprlocation.locationNext=!1,1==a.vprlocation.pageNumber?a.vprlocation.locationPrev=!0:a.vprlocation.locationPrev=!1}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function eb(b){"next"==b?a.vprlocation.pageNumber!=a.vprlocation.totalPages&&(k.vprlocation.pageNumber+=1):a.vprlocation.pageNumber>=2&&(k.vprlocation.pageNumber-=1),vprlocation=angular.copy(k.vprlocation),db(vprlocation)}/*function clientPrevPage(){

                 vprlocation=angular.copy( PatientRecord.vprlocation)
                 getLocdetails(vprlocation);
            };*/
/*******************************************VPR  Client Locations End************************************/
/*******************************************VPR complaintsMade Filter Start******************************/
function fb(c,d,e){if("add"==e){var f={type:e,navigateFrom:"patientrecord",complaintId:null};b.go("addComplaints",f)}if("edit"==e||"view"==e){var f={type:e,navigateFrom:"patientrecord",complaintId:c,complaintCode:d};b.go("manageComplaints",f)}"list"==e&&b.go("complaintsList",{orgLocId:a.patientrecord.location,fromState:a.redirectStkUser})}function gb(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprComplaint.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprComplaint.orgLocationId=a.patientrecord.location),a.vprComplaint.pageNumber=a.currentPage,a.vprComplaint.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprComplaint=angular.copy(b),h.fetchComplaintRecords(c,function(b){if(b){a.patientRecordList.complaintList=b.data,k.vprComplaint.pageNumber=b.pageNumber,k.vprComplaint.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprComplaint.pagingInfo=c,k.vprComplaint.pageNumber==k.vprComplaint.totalPages||0==k.vprComplaint.totalPages?k.vprComplaint.complaintNext=!0:k.vprComplaint.complaintNext=!1,1==k.vprComplaint.pageNumber?k.vprComplaint.complaintPrev=!0:k.vprComplaint.complaintPrev=!1,a.vprComplaint.complaintPrev=angular.copy(k.vprComplaint.complaintPrev),a.vprComplaint.complaintNext=angular.copy(k.vprComplaint.complaintNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function hb(){k.vprComplaint.pageNumber!=k.vprComplaint.totalPages&&(k.vprComplaint.pageNumber+=1),vprComplaint=angular.copy(k.vprComplaint),gb(vprComplaint)}function ib(){k.vprComplaint.pageNumber>=2&&(k.vprComplaint.pageNumber-=1),vprComplaint=angular.copy(k.vprComplaint),gb(vprComplaint)}function jb(){d.show({templateUrl:"app/modules/patient-record/view/complaints-made-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprComplaint=k.vprComplaint,a.patientrecord=k.vprUserDetails,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getComplaintType=function(b){return a.name={},a.name.searchString=b,a.sideEffectLoad=!0,g.getData(f.getParameterizedUrl("FIND_COMPLAINT_TYPE",a.name),null,function(b){return a.sideEffectLoad=!1,a.typeselect=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,i("error",j.instant(b.data.messages[0]))})},a.fetchComplaintRecords=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprComplaint={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(k.vprComplaint=angular.copy(f),b.complaintTypeId&&b.complaintTypeId.id&&(f.complaintTypeId=b.complaintTypeId.id),Wb.id)f.orgLocationId=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.orgLocationId=g.id)}else k.vprComplaint={},d.cancel();h.fetchComplaintRecords(f,function(b){b&&(a.patientRecordList.complaintList=b.data,k.vprComplaint.totalPages=b.totalPages,k.vprComplaint.pageNumber=b.pageNumber,k.vprComplaint.pageNumber==k.vprComplaint.totalPages||0==k.vprComplaint.totalPages?k.vprComplaint.complaintNext=!0:k.vprComplaint.complaintNext=!1,k.vprComplaint.pageNumber<=1?k.vprComplaint.complaintPrev=!0:k.vprComplaint.complaintPrev=!1,c.complaintsPage())},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),d.cancel()},a.clear=function(){a.vprComplaint={}},a.cancel=function(){d.cancel()}}]})}/*******************************************VPR complaintsMade Filter End********************************/
/*******************************************VPR certificate Filter Start*********************************/
function kb(a,c){"list"==c?
// $state.go("requestmgntlist");
rb("REQ_MEDICAL_CERTIFICATE"):v.getRequestListById(a,function(d){var e,f=d;"edit"==c?(e="edit",b.go("createrequest",{id:a,type:e,data:f})):"view"==c?(e="view",b.go("createrequest",{id:a,type:e,data:f})):"add"==c&&b.go("createrequest")},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function lb(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprCertificate.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprCertificate.orgLocation=a.patientrecord.location),a.vprCertificate.pageNumber=a.currentPage,a.vprCertificate.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprCertificate=angular.copy(b),h.fetchCertificatesList(c,function(b){if(b){a.patientRecordList.certificatesList=b.data,k.vprCertificate.pageNumber=b.pageNumber,k.vprCertificate.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprCertificate.pagingInfo=c,k.vprCertificate.pageNumber==k.vprCertificate.totalPages||0==k.vprCertificate.totalPages?k.vprCertificate.certificateNext=!0:k.vprCertificate.certificateNext=!1,1==k.vprCertificate.pageNumber?k.vprCertificate.certificatePrev=!0:k.vprCertificate.certificatePrev=!1,a.vprCertificate.certificatePrev=angular.copy(k.vprCertificate.certificatePrev),a.vprCertificate.certificateNext=angular.copy(k.vprCertificate.certificateNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function mb(a){"next"==a?k.vprCertificate.pageNumber!=k.vprCertificate.totalPages&&(k.vprCertificate.pageNumber+=1):k.vprCertificate.pageNumber>=2&&(k.vprCertificate.pageNumber-=1),vprCertificate=angular.copy(k.vprCertificate),lb(vprCertificate)}function nb(){d.show({templateUrl:"app/modules/patient-record/view/certificates-issued.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprCertificate=k.vprCertificate,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.fetchCertificatesRecord=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprCertificate={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(Wb.id)f.orgLocation=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.orgLocation=g.id)}else k.vprCertificate={},d.cancel();k.vprCertificate=angular.copy(b),h.fetchCertificatesList(f,function(b){b&&(a.patientRecordList.certificatesList=b.data,k.vprCertificate.pageNumber=b.pageNumber,k.vprCertificate.totalPages=b.totalPages,k.vprCertificate.pageNumber==k.vprCertificate.totalPages||0==k.vprCertificate.totalPages?k.vprCertificate.certificateNext=!0:k.vprCertificate.certificateNext=!1,1==k.vprCertificate.pageNumber?k.vprCertificate.certificatePrev=!0:k.vprCertificate.certificatePrev=!1,c.certificatesPage())},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprCertificate={}}}]})}/*******************************************VPR certificate Filter End***********************************/
/*******************************************VPR Requests Start***********************************/
function ob(a,c){"list"==c?rb("REQ_OTHER_REQUEST"):v.getRequestListById(a,function(d){var e,f=d;"edit"==c?(e="edit",b.go("createrequest",{id:a,type:e,data:f})):"view"==c?(e="view",b.go("createrequest",{id:a,type:e,data:f})):"add"==c&&b.go("createrequest")},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function pb(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprRequest.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprRequest.orgLocation=a.patientrecord.location),a.vprRequest.pageNumber=a.currentPage,a.vprRequest.recordsPerPage=a.itemPerPage;var c=angular.copy(b);c.transactionType=a.patientrecord.transactionType,k.vprRequest=angular.copy(b),h.fetchOtherRequests(c,function(b){if(b){a.patientRecordList.requestList=b.data,k.vprRequest.pageNumber=b.pageNumber,k.vprRequest.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprRequest.pagingInfo=c,k.vprRequest.pageNumber==k.vprRequest.totalPages||0==k.vprRequest.totalPages?k.vprRequest.requestNext=!0:k.vprRequest.requestNext=!1,1==k.vprRequest.pageNumber?k.vprRequest.requestPrev=!0:k.vprRequest.requestPrev=!1,a.vprRequest.requestPrev=angular.copy(k.vprRequest.requestPrev),a.vprRequest.requestNext=angular.copy(k.vprRequest.requestNext)}},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))})}function qb(a){"next"==a?k.vprRequest.pageNumber!=k.vprRequest.totalPages&&(k.vprRequest.pageNumber+=1):k.vprRequest.pageNumber>=2&&(k.vprRequest.pageNumber-=1),vprRequest=angular.copy(k.vprRequest),pb(vprRequest)}function rb(d){var h={};h.code=d,g.putData(f.getParameterizedUrl("GET_REQUEST_TYPE_BY_CODE",h),null,function(d){if(d&&d.data)return a.requestType={},requestType=d.data,c.loggedInUserDetails&&c.loggedInUserDetails.isOrganizationUserMode?b.go("requestmgntlist",{requestType:requestType.id,userId:a.patientrecord.userId,userName:a.patientrecord.name,fromState:a.redirectStkUser}):b.go("myReq",{requestType:requestType.id,fromState:a.redirectStkUser}),d.data},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function sb(){d.show({templateUrl:"app/modules/patient-record/view/otherrequest-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprRequest=k.vprRequest,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.fetchRequestRecords=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprRequest.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprRequest.orgLocation=a.patientrecord.location),a.vprRequest.pageNumber=a.currentPage,a.vprRequest.recordsPerPage=a.itemPerPage;
// var filterRequest = angular.copy(vprRequest);
// if(locationBasedByUser.id){
//                 filterRequest.orgLocation = locationBasedByUser.id;
// }else if(localStorage.getItem('location')){
//                 var location = getLocationJsonObj();
//                 if(location.id){
//                     filterRequest.orgLocation = location.id;
//                 }
//             }else{
//     PatientRecord.vprRequest={};
//     $mdDialog.cancel();
//     return notify("Alert","Please select location from filter");
// }
var c=angular.copy(b);
// filterRequest.transactionType=$scope.patientrecord.transactionType;
k.vprRequest=angular.copy(b),k.vprRequest=angular.copy(b),h.fetchOtherRequests(c,function(b){b&&(a.patientRecordList.requestList=b.data,k.vprRequest.pageNumber=b.pageNumber,k.vprRequest.totalPages=b.totalPages,k.vprRequest.pageNumber==k.vprRequest.totalPages||0==k.vprRequest.totalPages?k.vprRequest.requestNext=!0:k.vprRequest.requestNext=!1,1==k.vprRequest.pageNumber?k.vprRequest.requestPrev=!0:k.vprRequest.requestPrev=!1,a.vprRequest.requestPrev=angular.copy(k.vprRequest.requestPrev),a.vprRequest.requestNext=angular.copy(k.vprRequest.requestNext))},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprRequest={}}}]})}/*******************************************VPR Requests End***********************************/
/*******************************************VPR Document Start***********************************/
function tb(){
//$state.go("myDocuments");
Yb.isOrganizationUserMode?b.go("myDocuments",{parentState:"patientrecord",type:"orgUser",data:a.userInfo}):b.go("myDocuments",{parentState:"patientrecord",type:"indUser",data:a.userInfo})}/*******************************************VPR Document End***********************************/
/*******************************************VPR Appointment  Module Start***********************************/
//Appointment List
function ub(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprAppointment.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprAppointment.orgLocationId=a.patientrecord.location),a.vprAppointment.pageNumber=a.currentPage,a.vprAppointment.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprAppointment=angular.copy(b),h.getAppointmentList(c,function(b){if(b){a.patientRecordList.appointmentList=b.data,k.vprAppointment.pageNumber=b.pageNumber,k.vprAppointment.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprAppointment.pagingInfo=c,k.vprAppointment.pageNumber==k.vprAppointment.totalPages||0==k.vprAppointment.totalPages?k.vprAppointment.appointmentNext=!0:k.vprAppointment.appointmentNext=!1,1==k.vprAppointment.pageNumber?k.vprAppointment.appointmentPrev=!0:k.vprAppointment.appointmentPrev=!1,a.vprAppointment.appointmentPrev=angular.copy(k.vprAppointment.appointmentPrev),a.vprAppointment.appointmentNext=angular.copy(k.vprAppointment.appointmentNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}/******************************************* VPR Appointment CRUD Start********************************************************/
//Other Actions
function vb(c,d){var e=angular.fromJson(localStorage.getItem("stateParamsData")),f=null,g=null;e&&e.patientRecord&&(f=e.patientRecord.accessKeyId,g=e.patientRecord.otp),"list"==d?
//$state.go("appointmentsList");
b.go("individualAppointmentsList",{onBehalfOf:a.userInfo.getName,orgLoc:a.userInfo.orgLocationCode}):w.getAppointmentById(c,function(a){var e,h=a;"edit"==d?(e="edit",b.go("manageFixAppointment",{appointmentId:c,type:e,data:h,otp:g,accessKeyId:f})):"view"==d?(e="view",b.go("manageFixAppointment",{appointmentId:c,type:e,data:h,otp:g,accessKeyId:f,dprUserId:h.patient.id})):"add"==d?b.go("manageFixAppointment",{appointmentId:c,type:e,data:h,otp:g,accessKeyId:f}):"list"==d&&b.go("appointmentsList",{appointmentId:c,type:e,data:h,otp:g,accessKeyId:f})},function(a){i("error",j.instant(a.data.messages[0]))})}function wb(c){a.cusObj={},a.cusObj.appointmentId=c.id,H.viewCustomAppointment(a.cusObj,function(c){var e=c,f="view";d.show({controller:"CustomAppointmentCtrl",templateUrl:"app/modules/fullCalendar/views/custom-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:A.dialogBox.clickOutsideToClose,locals:{calendarRequestData:a.calendarMasterObject,appointmentData:e,mode:f}}).then(function(b){a.WSHealthProfessionalsValues={}},function(c){a.WSHealthProfessionalsValues={},c&&b.reload()})},function(a){i("error",j.instant(a.data.messages[0]))})}function xb(d){var e="false";d.nonParipalAppointment&&(e="true"),c.loggedInUserDetails?b.go("appointmentnotes",{appointmentId:d.id,type:"view",isCustomAppointment:e}):b.go("appointmentnotes",{appointmentId:d.id,type:"view",isCustomAppointment:e,accessKeyId:a.accessShowNotes.patientRecord.accessKeyId,otp:a.accessShowNotes.patientRecord.otp})}function yb(a){var b={};b.id=a,w.goToUploadDownload(b)}/******************************************* VPR Appointment CRUD End********************************************************/
/*******************************************VPR Appointment Filter Start*********************************/
function zb(){d.show({templateUrl:"app/modules/patient-record/view/appointments-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprAppointment=k.vprAppointment,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.getTreatmentTypeId=function(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,g.getData(f.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,e.isEmpty(b.data)||e.isEmpty(b.data.messages[0])?i("error",j.instant("RECORD_SERACH_FAILURE")):i("Alert",j.instant(b.data.messages[0]))})},a.endRecord=a.itemPerPage,a.getAppointmentList=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprAppointment={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(Wb.id)f.orgLocationId=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.orgLocationId=g.id)}else k.vprAppointment={},d.cancel();return k.vprAppointment=angular.copy(f),b&&b.treatmentId&&!b.treatmentId.id?void i("error",j.instant("INVALID_TREATMENT_TYPE")):(h.getAppointmentList(f,function(b){b&&(a.patientRecordList.appointmentList=b.data,k.vprAppointment.totalPages=b.totalPages,k.vprAppointment.pageNumber=b.pageNumber,k.vprAppointment.pageNumber==k.vprAppointment.totalPages||0==k.vprAppointment.totalPages?k.vprAppointment.appointmentNext=!0:k.vprAppointment.appointmentNext=!1,1==k.vprAppointment.pageNumber?k.vprAppointment.appointmentPrev=!0:k.vprAppointment.appointmentPrev=!1,c.appointmentPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),void d.cancel())},a.cancel=function(){d.cancel()},a.clear=function(){a.vprAppointment={}}}]})}function Ab(){k.vprAppointment.pageNumber!=k.vprAppointment.totalPages&&(k.vprAppointment.pageNumber+=1),vprAppointment=angular.copy(k.vprAppointment),ub(vprAppointment)}function Bb(){k.vprAppointment.pageNumber>=2&&(k.vprAppointment.pageNumber-=1),vprAppointment=angular.copy(k.vprAppointment),ub(vprAppointment)}
//check access for managing data
function Cb(b){var c=!1;return a.accessibleSubscriberLocationForAppointment&&!e.isEmpty(a.accessibleSubscriberLocationForAppointment)&&a.accessibleSubscriberLocationForAppointment.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}/******************************************* VPR Appointment Access Control End********************************************************/
/*******************************************VPR Appointment Module End***********************************/
/*******************************************VPR Diagnostic Tests  Module Start***********************************/
//Diagnostic Tests List
function Db(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprDiagnosticTest.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprDiagnosticTest.organizationLocationId=a.patientrecord.location),a.vprDiagnosticTest.pageNumber=a.currentPage,a.vprDiagnosticTest.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprDiagnosticTest=angular.copy(b),h.getDiagnosticTestList(c,function(b){if(b){a.patientRecordList.diagnosticTestList=b.data,k.vprDiagnosticTest.pageNumber=b.pageNumber,k.vprDiagnosticTest.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprDiagnosticTest.pagingInfo=c,k.vprDiagnosticTest.pageNumber==k.vprDiagnosticTest.totalPages||0==k.vprDiagnosticTest.totalPages?k.vprDiagnosticTest.diagnosticTestNext=!0:k.vprDiagnosticTest.diagnosticTestNext=!1,1==k.vprDiagnosticTest.pageNumber?k.vprDiagnosticTest.diagnosticTestPrev=!0:k.vprDiagnosticTest.diagnosticTestPrev=!1,a.vprDiagnosticTest.diagnosticTestPrev=angular.copy(k.vprDiagnosticTest.diagnosticTestPrev),a.vprDiagnosticTest.diagnosticTestNext=angular.copy(k.vprDiagnosticTest.diagnosticTestNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}/******************************************* VPR Diagnostic Test CRUD Start********************************************************/
//Other Actions
function Eb(c,d){"list"==d?
// var user={"userId":$scope.patientrecord.userId,"userName":$scope.patientrecord.name}
// var orgLocId={"orgLocId":$scope.patientrecord.location,"value":$scope.patientrecord.locationName}
b.go("usertestlist",{userId:a.patientrecord.userId,userName:a.patientrecord.name,fromState:a.redirectStkUser}):y.viewDiagnosticTestById(c,function(a){var e,f=a;"edit"==d?(e="edit",b.go("addEditUserTests",{id:c,type:e,data:f})):"view"==d?(e="view",b.go("addEditUserTests",{id:c,type:e,data:f})):"add"==d&&b.go("addEditUserTests",{id:c,type:e,data:f})},function(a){i("error",j.instant(a.data.messages[0]))})}/******************************************* VPR Diagnostic Test CRUD End********************************************************/
/*******************************************VPR Diagnostic Filter Start**********************************/
function Fb(){d.show({templateUrl:"app/modules/patient-record/view/diagnostic-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.getDiagnosticTestName=function(b,c){var d={};d.diagnosticTestName=b;var e=f.getParameterizedUrl("FIND_DIAGNOSTICTESTNAME",d);return c?(a.diagnosticTestNameAutoCmp=!0,e=e+"&whetherActive="+c):a.diagnosticNameAutoCmp=!0,g.getData(e,null,function(b){return a.diagnosticTestNameAutoCmp=!1,a.diagnosticNameAutoCmp=!1,a.diagnosticTestNameList=angular.fromJson(b.data)},function(b){a.diagnosticTestNameAutoCmp=!1,a.diagnosticNameAutoCmp=!1})},a.patientrecord={},a.vprDiagnosticTest=k.vprDiagnosticTest,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getDiagnosticTestList=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprDiagnosticTest={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(Wb.id)f.organizationLocationId=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.organizationLocationId=g.id)}else k.vprDiagnosticTest={},d.cancel();return k.vprDiagnosticTest=angular.copy(f),b&&b.diagnosticTestId&&!b.diagnosticTestId.diagnosticTestId?void i("error",j.instant("INVALID_TEST")):(h.getDiagnosticTestList(f,function(b){b&&(a.patientRecordList.diagnosticTestList=b.data,k.vprDiagnosticTest.totalPages=b.totalPages,k.vprDiagnosticTest.pageNumber=b.pageNumber,k.vprDiagnosticTest.pageNumber==k.vprDiagnosticTest.totalPages||0==k.vprDiagnosticTest.totalPages?k.vprDiagnosticTest.diagnosticTestNext=!0:k.vprDiagnosticTest.diagnosticTestNext=!1,1==k.vprDiagnosticTest.pageNumber?k.vprDiagnosticTest.diagnosticTestPrev=!0:k.vprDiagnosticTest.diagnosticTestPrev=!1,c.diagnosticTestPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),void d.cancel())},a.cancel=function(){d.cancel()},a.clear=function(){a.vprDiagnosticTest={}}}]})}function Gb(){k.vprDiagnosticTest.pageNumber!=k.vprDiagnosticTest.totalPages&&(k.vprDiagnosticTest.pageNumber+=1),vprDiagnosticTest=angular.copy(k.vprDiagnosticTest),Db(vprDiagnosticTest)}function Hb(){k.vprDiagnosticTest.pageNumber>=2&&(k.vprDiagnosticTest.pageNumber-=1),vprDiagnosticTest=angular.copy(k.vprDiagnosticTest),Db(vprDiagnosticTest)}
//check access for managing data
function Ib(b){var c=!1;return a.accessibleSubscriberLocationForDiagnosticTest&&!e.isEmpty(a.accessibleSubscriberLocationForDiagnosticTest)&&a.accessibleSubscriberLocationForDiagnosticTest.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}/******************************************* VPR Diagnostic Tests  Access Control End********************************************************/
/*******************************************VPR Diagnostic Tests  Module End***********************************/
/*******************************************VPR User Measurement Module Start***********************************/
//User Measurement List
function Jb(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprUserMeasurement.userId=a.patientrecord.userId,a.vprUserMeasurement.pageNumber=a.currentPage,a.vprUserMeasurement.recordsPerPage=a.itemPerPage;var c=angular.copy(b);k.vprUserMeasurement=angular.copy(b),h.getUserMeasurementList(c,function(b){if(b){a.patientRecordList.userMeasurementList=b.data,k.vprUserMeasurement.pageNumber=b.pageNumber,k.vprUserMeasurement.totalPages=b.totalPages;var c=l(b.pageNumber,a.itemPerPage,b.totalRecords);c.totalItems=b.totalRecords,a.vprUserMeasurement.pagingInfo=c,k.vprUserMeasurement.pageNumber==k.vprUserMeasurement.totalPages||0==k.vprUserMeasurement.totalPages?k.vprUserMeasurement.userMeasurementNext=!0:k.vprUserMeasurement.userMeasurementNext=!1,1==k.vprUserMeasurement.pageNumber?k.vprUserMeasurement.userMeasurementPrev=!0:k.vprUserMeasurement.userMeasurementPrev=!1,a.vprUserMeasurement.userMeasurementPrev=angular.copy(k.vprUserMeasurement.userMeasurementPrev),a.vprUserMeasurement.userMeasurementNext=angular.copy(k.vprUserMeasurement.userMeasurementNext)}},function(a){e.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}/******************************************* VPR User Measurement Test CRUD Start********************************************************/
//Other Actions
function Kb(c,h,i){if("list"==h){var j={};j.user={id:a.patientrecord.userId,value:a.patientrecord.name},b.go("usermeasurementlist",{
//'data':newData,
fromState:a.redirectStkUser})}else{var k={};k.id=c,g.getData(f.getParameterizedUrl("USERMEASUREMENT_BY_ID",k),null,function(f){if(f&&f.data)if(a.measurementData=f.data,"view"==h||"edit"==h)if("add"!==h)d.show({controller:Lb,templateUrl:"app/modules/labCRM/views/manage-user-measurement.html",parent:angular.element(document.body),targetEvent:i,clickOutsideToClose:A.dialogBox.clickOutsideToClose,locals:{data:a.measurementData,type:h}}).then(function(){a.searchData()},function(){});else{var g={};g.user={id:a.measurementData.userObj.id,value:a.measurementData.userObj.value},e.isFieldEmpty(a.measurementData.diagnosticTest)||(g.diagnosticTest=a.measurementData.diagnosticTest),b.go("addusermeasurement",{data:g})}else"add"==h&&b.go("addusermeasurement",{id:c,type:type,data:a.measurementData})},function(a){})}}/**
             * Popup for edit/view functionality of a user-measurement indicator
             * @param {string} pageType Either edit/view
             * @param {object} data     Object to be edited or viewed
             */
function Lb(a,b,c,d){function h(){j()}function j(){a.pageState=d}a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.update=function(c,d){if(c.$valid&&d.id){a.isRequestSent=!0;var h=angular.copy(d);delete h.measurementDate;var j={};j.id=d.id,g.putData(f.getParameterizedUrl("UPDATE_USERMEASUREMENT",j),h,function(c){a.isRequestSent=!1,e.isEmpty(c.data)||(i("success",c.data.successMessage),b.hide())},function(){a.isRequestSent=!1})}},h(),a.userMeasurementObject=angular.copy(c)}/******************************************* VPR User Measurement CRUD End********************************************************/
/*******************************************VPR User Measurement Filter Start**********************************/
function Mb(){d.show({templateUrl:"app/modules/patient-record/view/measurements-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.getIndicatorList=function(b){if(!e.isNullOrEmpty(b))return a.requestObject={},a.requestObject.measurementIndicatorName=b,g.getData(f.getParameterizedUrl("GET_INDICATORNAME",a.requestObject),null,function(b){return a.indicatorList=angular.fromJson(b.data)},function(a){})},a.patientrecord={},a.vprUserMeasurement=k.vprUserMeasurement,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getUserMeasurementList=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprUserMeasurement={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);return k.vprUserMeasurement=angular.copy(f),b&&b.measurementIndicator&&!b.measurementIndicator.id?void i("error",j.instant("INVALID_IDICATOR")):(h.getUserMeasurementList(f,function(b){b&&(a.patientRecordList.userMeasurementList=b.data,k.vprUserMeasurement.totalPages=b.totalPages,k.vprUserMeasurement.pageNumber=b.pageNumber,k.vprUserMeasurement.pageNumber==k.vprUserMeasurement.totalPages||0==k.vprUserMeasurement.totalPages?k.vprUserMeasurement.userMeasurementNext=!0:k.vprUserMeasurement.userMeasurementNext=!1,1==k.vprUserMeasurement.pageNumber?k.vprUserMeasurement.userMeasurementPrev=!0:k.vprUserMeasurement.userMeasurementPrev=!1,c.userMeasurementPage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),void d.cancel())},a.cancel=function(){d.cancel()},a.clear=function(){a.vprUserMeasurement={}}}]})}function Nb(){k.vprUserMeasurement.pageNumber!=k.vprUserMeasurement.totalPages&&(k.vprUserMeasurement.pageNumber+=1),vprUserMeasurement=angular.copy(k.vprUserMeasurement),Jb(vprUserMeasurement)}function Ob(){k.vprUserMeasurement.pageNumber>=2&&(k.vprUserMeasurement.pageNumber-=1),vprUserMeasurement=angular.copy(k.vprUserMeasurement),Jb(vprUserMeasurement)}
//check access for managing data
function Pb(b){var c=!1;return a.accessibleSubscriberLocationForUserMeasurement&&!e.isEmpty(a.accessibleSubscriberLocationForUserMeasurement)&&a.accessibleSubscriberLocationForUserMeasurement.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}/******************************************* VPR Measurement  Benchmark  End********************************************************/
/*******************************************VPR User Measurement Module End***********************************/
/*******************************************VPR Payment Made Module Start***********************************/
//User Measurement List
function Qb(b){if(!a.patientrecord.userId)return i("Alert","Please select user from filter");a.vprPaymentMade.userId=a.patientrecord.userId,a.patientrecord.location&&(a.vprPaymentMade.organizationLocationId=a.patientrecord.location),
//$scope.vprIssue.userId=$scope.patientrecord.userId;
a.vprPaymentMade.pageNumber=a.currentPage,a.vprPaymentMade.recordsPerPage=a.itemPerPage;var d=angular.copy(b);k.vprPaymentMade=angular.copy(b);var e=x.RECEIPT_VIEW;h.getPaymentMadeList(d,function(b){a.patientRecordList.paymentMadeList=b.data,k.vprPaymentMade.totalPages=b.totalPages,k.vprPaymentMade.pageNumber=b.pageNumber;var d=l(b.pageNumber,a.itemPerPage,b.totalRecords);d.totalItems=b.totalRecords,a.vprPaymentMade.pagingInfo=d,k.vprPaymentMade.pageNumber==k.vprPaymentMade.totalPages||0==k.vprPaymentMade.totalPages?k.vprPaymentMade.paymentMadeNext=!0:k.vprPaymentMade.paymentMadeNext=!1,1==k.vprPaymentMade.pageNumber?k.vprPaymentMade.paymentMadePrev=!0:k.vprPaymentMade.paymentMadePrev=!1,a.vprPaymentMade.paymentMadePrev=angular.copy(k.vprPaymentMade.paymentMadePrev),a.vprPaymentMade.paymentMadeNext=angular.copy(k.vprPaymentMade.paymentMadeNext),c.showSpinner=!1},function(a){},e)}/******************************************* VPR Payment Made CRUD Start********************************************************/
//Other Actions
function Rb(a,c){var d,e,f={id:a};C.getReceiptPaymentDetails(f,function(a){d=a},function(a){i("error",j.instant("ERROR"))}),/*commonBillingService.generateBill(paymentId, function (sucessResponse){
                    var paymentById = sucessResponse;*/
"edit"==c?(e="edit",b.go("managereceiptpayment",{type:e,receiptId:a,data:d})):"view"==c?(e="view",b.go("managereceiptpayment",{type:e,receiptId:a,data:d})):"add"==c?b.go("managereceiptpayment",{type:e}):"list"==c&&b.go("searchreceipt")}/******************************************* VPR Payment Made CRUD End********************************************************/
/*******************************************VPR Payment Made Filter Start**********************************/
function Sb(){d.show({templateUrl:"app/modules/patient-record/view/payments-made-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.patientrecord={},a.vprPaymentMade=k.vprPaymentMade,a.patientrecord.userId=k.vprUserDetails.userId,a.patientRecordList=k.PatientRecordList,a.currentPage=1,a.itemPerPage=5,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.getPaymentMadeList=function(b){if("clear"==b.fclear&&(b={}),!a.patientrecord.userId)return k.vprPaymentMade={},d.cancel(),i("Alert","Please select user from filter");b.userId=a.patientrecord.userId,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var f=angular.copy(b);if(k.vprPaymentMade=angular.copy(f),Wb.id)f.organizationLocationId=Wb.id;else if(localStorage.getItem("location")){var g=M();g.id&&(f.organizationLocationId=g.id)}else k.vprPaymentMade={},d.cancel();h.getPaymentMadeList(f,function(b){b&&(a.patientRecordList.paymentMadeList=b.data,k.vprPaymentMade.totalPages=b.totalPages,k.vprPaymentMade.pageNumber=b.pageNumber,k.vprPaymentMade.pageNumber==k.vprPaymentMade.totalPages||0==k.vprPaymentMade.totalPages?k.vprPaymentMade.paymentMadeNext=!0:k.vprPaymentMade.paymentMadeNext=!1,k.vprPaymentMade.pageNumber<=1?k.vprPaymentMade.paymentMadePrev=!0:k.vprPaymentMade.paymentMadePrev=!1,c.paymentMadePage())},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("Alert",j.instant(a.data.messages[0]))}),d.cancel()},a.cancel=function(){d.cancel()},a.clear=function(){a.vprPaymentMade={}}}]})}function Tb(){k.vprPaymentMade.pageNumber!=k.vprPaymentMade.totalPages&&(k.vprPaymentMade.pageNumber+=1),vprPaymentMade=angular.copy(k.vprPaymentMade),Qb(vprPaymentMade)}function Ub(){k.vprPaymentMade.pageNumber>=2&&(k.vprPaymentMade.pageNumber-=1),vprPaymentMade=angular.copy(k.vprPaymentMade),Qb(vprPaymentMade)}
//check access for managing data
function Vb(b){var c=!1;return a.accessibleSubscriberLocationForPaymentMade&&!e.isEmpty(a.accessibleSubscriberLocationForPaymentMade)&&a.accessibleSubscriberLocationForPaymentMade.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}Lb.$inject=["$scope","$mdDialog","data","type"],a.patientrecord={},a.patientrecord.transactionType=E.transactionType,a.getPatientRecord=N,a.fetchRecords=O,a.loginDetails=c.loggedInUserDetails,a.authenticateOTP=L,a.allowAccessOTP=K,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.patientRecordList=k.PatientRecordList,a.getUserNamesForRoleHistory=Q,a.gotoDocument=tb,a.manageAppointments=vb,a.manageDiagnosticTest=Eb,a.managePayment=Rb,a.getClientDetails=S,a.userPersonalInfo=T,a.clientId;var Wb={};a.minLength=c.getSmartSearchMinLength("clientSearchMinLength"),a.patientRecordList.vprUserDetails={},a.patientRecordList.IssuesList={},a.patientRecordList.vprTreatmentsList={},a.patientRecordList.vprMedicationsList={},a.patientRecordList.vprVaccinationsList={},a.patientRecordList.vprFamilyHistoryList={},a.patientRecordList.vprIncidentsList={},a.patientRecordList.symptomList={},a.patientRecordList.billList={},a.patientRecordList.bloodDonationsList={},a.patientRecordList.bloodRequestList={},a.patientRecordList.vprLocationsList={},a.patientRecordList.complaintList={},a.patientRecordList.dependentsList={},a.patientRecordList.requestList={},a.patientRecordList.certificatestList={},a.patientRecordList.appointmentList={},a.patientRecordList.dependentList={},a.patientRecordList.diagnosticTestList={},a.patientRecordList.billList={},a.patientRecordList.userMeasurementList={},a.patientRecordList.paymentMadeList={},a.selectedOrganization={},F.validateListing("DIGITAL_PATIENT_RECORD_SUB"),
//User
a.getUserdetails=R,a.vprlocation=k.vprlocation,a.manageClient=cb,a.clientPage=eb;/* locationCategory label changes START */
var Xb=F.getLocationCategory();
//Fetching Login Details
if(a.filterLabel={},a.cardLabel={},e.isFieldEmpty(Xb)?(a.titleLabel=j.instant("PATIENT_RECORD"),a.filterLabel.user=j.instant("USER"),a.cardLabel.userLocations=j.instant("CLIENT_LOCATIONS")):"EDUCATIONAL_INSTITUTION"==Xb.code?(a.titleLabel=j.instant("STUDENT_HEALTH_RECORD"),a.filterLabel.user=j.instant("STUDENT"),a.cardLabel.userLocations=j.instant("STUDENT_LOCATIONS")):"CORPORATE"==Xb.code?(a.titleLabel=j.instant("EMPLOYEE_HEALTH_RECORD"),a.filterLabel.user=j.instant("EMPLOYEE"),a.cardLabel.userLocations=j.instant("EMPLOYEE_LOCATIONS")):"SERVICE_PROVIDER"==Xb.code?(a.titleLabel=j.instant("PATIENT_RECORD"),a.filterLabel.user=j.instant("USER"),a.cardLabel.userLocations=j.instant("CLIENT_LOCATIONS")):"RESIDENTIAL_SOCIETY"==Xb.code?(a.titleLabel=j.instant("PATIENT_RECORD"),a.filterLabel.user=j.instant("RESIDENT"),a.cardLabel.userLocations=j.instant("RESIDENT_LOCATIONS")):(a.titleLabel=j.instant("PATIENT_RECORD"),a.filterLabel.user=j.instant("USER"),a.cardLabel.userLocations=j.instant("CLIENT_LOCATIONS")),/* locationCategory label changes END */
//User Vaccination
a.vprVaccination=k.vprVaccination,a.fetchVaccintionRecords=oa,a.manageUserVaccination=na,a.vaccinationFilter=ra,a.vaccinationNextPage=pa,a.vaccinationPrevPage=qa,
//User Family History
a.vprFamilyHistory=k.vprFamilyHistory,a.fetchFamilyHistoryRecords=ta,a.manageUserFamilyHistory=sa,a.familyHistoryFilter=wa,a.familyHistoryNextPage=ua,a.familyHistoryPrevPage=va,
//User Incident
a.vprIncident=k.vprIncident,a.fetchIncidentRecords=ya,a.manageUserIncident=xa,a.incidentFilter=Ba,a.incidentNextPage=za,a.incidentPrevPage=Aa,a.checkOrganizationLocationAccessForIncident=Ca,a.hasAccessibleSubscriberLocationForIncident=!1,a.orgLocPermissionForIncident=x.USER_INCIDENT_VPR_ADD,
//User Issue
a.vprIssue=k.vprIssue,a.getIssueList=X,a.issuePopupFilter=Y,a.issueNextPage=Z,a.issuePrevPage=$,a.manageIssue=W,a.checkOrganizationLocationAccessForIssue=_,a.issueShareLocation=aa,a.hasAccessibleSubscriberLocationForIssue=!1,a.shareLocation=!1,a.orgLocPermissionForIssue=x.USER_ISSUE_VPR_ADD,a.shareObject={},a.isLoggedInUserClient=U,"false"==localStorage.isLoggedIn?a.isLoggedIn=!1:a.isLoggedIn=!0,
//User Medication
a.vprMedication=k.vprMedication,a.fetchMedicationRecords=ia,a.medicationFilter=la,a.prev=ka,a.next=ja,a.manageMedication=ha,a.checkOrganizationLocationAccessForMedication=ma,a.whetherAccessbleUserForMedication=!1,a.orgLocPermissionForMedication=x.USER_MEDICATION_VPR_ADD,a.hasAccessabelSystemLocationForMedication=!1,
//User treatment
a.vprTreatment=k.vprTreatment,
//$scope.fetchTreatmentRecords=fetchTreatmentRecords;
a.fetchTreatmentRecords=ca,a.treatmentFilter=fa,a.treatmentNextPage=da,a.treatmentNext,a.treatmentPrevPage=ea,a.treatmentPrev,a.manageTreatment=ba,a.checkOrganizationLocationAccessForTreatment=ga,a.orgLocPermissionForTreatment=x.USER_TREATMENT_VPR_ADD,a.hasAccessibleSubscriberLocationForTreatment=!1,
//UserSymptom
a.vprSymptom=k.vprSymptom,a.symptomPopupFilter=Ha,a.symptomNext,a.symptomPrev,a.symptomPrevPage=Ga,a.symptomNextPage=Fa,a.crudUserSymptom=Da,a.checkOrganizationLocationAccessForSymptom=Ia,a.hasAccessibleSubscriberLocationForSymptom=!1,a.orgLocPermissionForSymptom=x.USER_SYMPTOM_VPR_ADD,
//Blood Request
a.vprBloodRequest=k.vprBloodRequest,a.getBloodRequest=Za,a.vprEditBloodRequest=Ya,a.bloodRequestPopupFilter=ab,a.requestNextPage=$a,a.requestPrevPage=_a,a.getAllAccessibleOrgUsersForBloodRequest=bb,
//Blood Donation
a.vprBloodDonation=k.vprBloodDonation,a.getBloodDonationList=Ua,a.manageBloodDonation=Ta,a.bloodDonationPopupFilter=Xa,a.donationNextPage=Va,a.donationPrevPage=Wa,
//Bills Raised
a.vprIncident=k.vprIncident,a.getBillsList=Ka,a.manageBill=Ja,a.billsFilter=Na,a.billNextPage=La,a.billPrevPage=Ma,
//User Complaint
a.vprComplaint=k.vprComplaint,a.fetchComplaintRecords=gb,a.complaintFilter=jb,a.manageComplaints=fb,a.complaintNextPage=hb,a.complaintPrevPage=ib,
//Dependents
a.manageDependent=Ra,a.fetchdependentsList=Oa,a.vprDependent=k.vprvprDependent,a.dependentNextPage=Pa,a.dependentPrevPage=Qa,
//Other Requests
a.fetchRequestRecords=pb,a.vprRequest=k.vprRequest,a.otherReqPageChange=qb,a.manageRequest=ob,
//Certificates Issued
a.vprCertificate=k.vprCertificate,a.manageCertificate=kb,a.fetchCertificatesRecord=lb,a.certificatePageChange=mb,a.cerificate=[],a.getPcklstReqType=rb,
//Filter Function Declaration
a.appointmentFilter=zb,a.diagnosticFilter=Fb,a.measurementFilter=Mb,a.paymentsFilter=Sb,a.dependentsFilter=Sa,a.certificateFilter=nb,a.otherRequestFilter=sb,
//Appointments
a.appointmentNextPage=Ab,a.appointmentPrevPage=Bb,a.vprAppointment=k.vprAppointment,a.getAppointmentList=ub,a.hasAccessibleSubscriberLocationForAppointment=!1,a.checkOrganizationLocationAccessForAppointment=Cb,a.orgLocPermissionForAppointment=x.USER_APPOINTMENT_VPR_ADD,a.showNotes=xb,a.showAttachments=yb,a.customAppointmentview=wb,
//Diagnostic Tests
a.diagnosticTestNextPage=Gb,a.diagnosticTestPrevPage=Hb,a.vprDiagnosticTest=k.vprDiagnosticTest,a.getDiagnosticTestsList=Db,a.hasAccessibleSubscriberLocationForDiagnosticTest=!1,a.checkOrganizationLocationAccessForDiagnosticTest=Ib,a.orgLocPermissionForDiagnosticTest=x.USER_DIAGNOSTICTEST_VPR_ADD,
//User Measurement
a.userMeasurementNextPage=Nb,a.userMeasurementPrevPage=Ob,a.vprUserMeasurement=k.vprUserMeasurement,a.getUserMeasurementList=Jb,a.hasAccessibleSubscriberLocationForUserMeasurement=!1,a.checkOrganizationLocationAccessForUserMeasurement=Pb,a.orgLocPermissionForUserMeasurement=x.USER_MEASUREMENT_VPR_ADD,a.manageUserMeasurement=Kb,
//Payment Made
a.paymentMadeNextPage=Tb,a.paymentMadePrevPage=Ub,a.vprPaymentMade=k.vprPaymentMade,a.getPaymentMadeList=Qb,a.hasAccessibleSubscriberLocationForPaymentMade=!1,a.checkOrganizationLocationAccessForPaymentMade=Vb,a.orgLocPermissionForPaymentMade=x.USER_PAYMENT_MADE_VPR_ADD,a.orgLocPermission=x.VPR_CARDS_VIEW,
//Pagination
a.currentPage=1,a.itemPerPage=5,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.getOrgDetails=P,a.getSystemOrg=J,a.getLocationJsonObj=M,a.filter=!1,a.userInfo={},JSON.parse(localStorage.getItem("vprCurrentTab"))?(a.currentTab=JSON.parse(localStorage.getItem("vprCurrentTab")),a.value=localStorage.vprCurrentTab):(a.currentTab=1,a.tabValue=1,a.value=1),a.clearVpr=function(){a.patientrecord={},a.filter=!1,Wb.id&&(delete Wb.id,delete Wb.value),localStorage.removeItem("location"),localStorage.removeItem("client"),Yb.isOrganizationUserMode?(delete a.userInfo.getName,delete a.userInfo.orgLocationCode):delete a.userInfo.orgLocationCode,a.patientRecordList.vprUserDetails={},a.patientRecordList.IssuesList={},a.patientRecordList.vprTreatmentsList={},a.patientRecordList.vprMedicationsList={},a.patientRecordList.vprVaccinationsList={},a.patientRecordList.vprFamilyHistoryList={},a.patientRecordList.vprIncidentsList={},a.patientRecordList.symptomList={},a.patientRecordList.billList={},a.patientRecordList.bloodDonationsList={},a.patientRecordList.bloodRequestList={},a.patientRecordList.vprLocationsList={},a.patientRecordList.complaintList={},a.patientRecordList.dependentsList={},a.patientRecordList.requestList={},a.patientRecordList.certificatestList={},a.patientRecordList.appointmentList={},a.patientRecordList.dependentList={},a.patientRecordList.diagnosticTestList={},a.patientRecordList.billList={},a.patientRecordList.userMeasurementList={},a.patientRecordList.paymentMadeList={},k.PatientRecordList=angular.copy(a.patientRecordList),k.vprAppointment={},k.vprBill={},k.vprBloodDonation={},k.vprBloodRequest={},k.vprCertificate={},k.vprComplaint={},k.vprDependent={},k.vprDiagnosticTest={},k.vprIncident={},k.vprIssue={},k.vprlocation={},k.vprMedication={},k.vprPaymentMade={},k.vprUserDetails={},k.vprRequest={},k.vprSymptom={},k.vprTreatment={},k.vprUserMeasurement={},k.vprVaccination={},k.vprFamilyHistory={}},
//TAB View
a.healthCard=function(b){1==b?(a.test1=!0,a.test2=!1,a.test3=!1):2==b?(a.test1=!1,a.test2=!0,a.test3=!1):3==b&&(a.test1=!1,a.test2=!1,a.test3=!0),a.currentTab=b,localStorage.setItem("vprCurrentTab",b)},a.healthCard(a.value),a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&localStorage.client,a.getStakeHolder=function(){a.wsStackholderSearchCriteria={},a.loginDetails&&!a.loginDetails.isOrganizationUserMode&&I.searchUserStackholdersRequests(a.wsStackholderSearchCriteria,a.userData,function(b){b.data&&(a.activeUsers=[],b.data.forEach(function(b){b.whetherActive&&b.whetherViewHealthRecord&&a.activeUsers.push(b)}));var c={};return c.requestFrom={id:a.loginDetails.id,value:a.loginDetails.displayName},a.activeUsers.push(c),a.userStackholderRequestList=a.activeUsers},function(a){})},a.getStakeHolder(),localStorage.loggedInUser){var Yb={};Yb=localStorage.loggedInUser,Yb=JSON.parse(Yb),a.patient={},a.patient.getName={}}
// var loggedInUserDetails={};
// loggedInUserDetails=localStorage.loggedInUser;
// loggedInUserDetails=JSON.parse(loggedInUserDetails);
// $scope.patient={};
// $scope.patient.getName = {};
if(Yb&&!Yb.isOrganizationUserMode)if(E.id&&E.displayName&&E.locationId&&E.locationValue)a.invisible=!0,a.userInfo.getName=E.displayName,a.patient.getName.id=E.id,a.patient.getName.value=E.displayName,a.patientrecord.userId=E.id,a.patientrecord.name=E.displayName,a.userInfo.orgLocationCode={},a.userInfo.orgLocationCode.id=E.locationId,a.userInfo.orgLocationCode.value=E.locationValue,a.patientrecord.location=E.locationId,a.patientrecord.locationName=E.locationValue,localStorage.setItem("client",JSON.stringify(a.patient.getName)),localStorage.setItem("location",JSON.stringify(a.userInfo.orgLocationCode)),k.vprUserDetails=angular.copy(a.patientrecord),P(E.locationId),O(),a.filter=!0;else{if(localStorage.client){var Zb=JSON.parse(localStorage.getItem("client"));
//$scope.userInfo.getName =clientDet.requestFrom.value
a.userInfo.getName=Zb,Zb&&Zb.requestFrom?(a.patientrecord.userId=Zb.requestFrom.id,a.patientrecord.name=Zb.requestFrom.value):(a.patientrecord.userId=Zb.id,a.patientrecord.name=Zb.value),a.userInfo.getName.requestFrom&&(a.userInfo.getName.requestFrom&&a.userInfo.getName.status?(a.redirectStkUser="stakeHolderUserDPR",a.restrictAdd=!0):(a.restrictAdd=!1,a.redirectStkUser=null),a.userInfo.getName.requestFrom&&a.userInfo.getName.status&&a.userInfo.getName.whetherSharingAllowed?a.shareForbidden=!1:a.userInfo.getName.requestFrom&&!a.userInfo.getName.status?a.shareForbidden=!1:a.shareForbidden=!0)}else a.userInfo.getName=Yb.displayName,a.patientrecord.userId=Yb.id,a.patientrecord.name=Yb.displayName,O();
//$scope.patientrecord.userId = loggedInUserDetails.id;
//$scope.patientrecord.name = loggedInUserDetails.displayName;
if(
// $scope.userInfo.getName = loggedInUserDetails.displayName;
//getSystemOrg();
a.invisible=!0,localStorage.getItem("location")){var $b=localStorage.getItem("location"),_b=JSON.parse($b);a.patientrecord.location=_b.id,a.patientrecord.locationName=_b.value,a.userInfo.orgLocationCode={},a.userInfo.orgLocationCode.id=_b.id,a.userInfo.orgLocationCode.value=_b.value,k.vprUserDetails=angular.copy(a.patientrecord),P(a.userInfo.orgLocationCode.id),O(),a.filter=!0}}else if(!Yb&&a.localCheck&&null!=a.localCheck.patientRecord.otp)L();else if(Yb&&Yb.isOrganizationUserMode)if(a.invisible=!1,E.id&&E.displayName&&E.locationId&&E.locationValue)a.invisible=!0,a.userInfo.getName=E.displayName,a.patient.getName.id=E.id,a.patient.getName.value=E.displayName,a.patientrecord.userId=E.id,a.patientrecord.name=E.displayName,a.userInfo.orgLocationCode={},a.userInfo.orgLocationCode.id=E.locationId,a.userInfo.orgLocationCode.value=E.locationValue,a.patientrecord.location=E.locationId,a.patientrecord.locationName=E.locationValue,localStorage.setItem("client",JSON.stringify(a.patient.getName)),localStorage.setItem("location",JSON.stringify(a.userInfo.orgLocationCode)),k.vprUserDetails=angular.copy(a.patientrecord),P(E.locationId),O(),a.filter=!0;else if(localStorage.getItem("client")){var _b=localStorage.getItem("client"),ac=JSON.parse(_b);if(ac.id&&(a.userInfo.getName={},a.userInfo.getName.id=ac.id,a.userInfo.getName.value=ac.value,a.patientrecord.userId=ac.id,a.patientrecord.name=ac.value),localStorage.getItem("location")){var $b=localStorage.getItem("location"),_b=JSON.parse($b);a.patientrecord.location=_b.id,a.patientrecord.locationName=_b.value,a.userInfo.orgLocationCode={},a.userInfo.orgLocationCode.id=_b.id,a.userInfo.orgLocationCode.value=_b.value,a.patientrecord.location=_b.id,a.patientrecord.locationName=_b.value,k.vprUserDetails=angular.copy(a.patientrecord),P(a.patientrecord.location),O(),a.filter=!0}}a.getCreatedBy=function(b){if(Yb&&!Yb.isOrganizationUserMode){var c={};return c.keyword=b,g.getData(f.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}var c={};
//return httpService.getData(urlService.getParameterizedUrl('GET_ORG_LOC_BY_ALL', userObj), null, function (response) {
return c.keyword=b,g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},c.issuePage=function(){a.vprIssue.issuePrev=angular.copy(k.vprIssue.issuePrev),a.vprIssue.issueNext=angular.copy(k.vprIssue.issueNext)},
//get subscribed accessible location
a.getAccessibleSubscriberLocationForIssue=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForIssue=b.data,a.accessibleSubscriberLocationForIssue&&a.accessibleSubscriberLocationForIssue.length>0&&(a.hasAccessibleSubscriberLocationForIssue=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForIssue})},a.getAccessibleSubscriberLocationForIssue(),c.treatmentPage=function(){a.vprTreatment.treatmentPrev=angular.copy(k.vprTreatment.treatmentPrev),a.vprTreatment.treatmentNext=angular.copy(k.vprTreatment.treatmentNext)},
//get subscribed accessible location
a.getAccessibleSubscriberLocationForTreatment=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForTreatment=b.data,a.accessibleSubscriberLocationForTreatment&&a.accessibleSubscriberLocationForTreatment.length>0&&(a.hasAccessibleSubscriberLocationForTreatment=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForTreatment})},a.getAccessibleSubscriberLocationForTreatment(),a.newManageMedication=function(){b.go("manageusermedication")},c.medicationPage=function(){a.vprMedication.medicationPrev=angular.copy(k.vprMedication.medicationPrev),a.vprMedication.medicationNext=angular.copy(k.vprMedication.medicationNext)},a.getAccessabelSystemLocationForMedication=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessabelSystemLocationForMedication=b.data,a.accessabelSystemLocationForMedication&&a.accessabelSystemLocationForMedication.length>0&&(a.hasAccessabelSystemLocationForMedication=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForMedication})},a.getAccessabelSystemLocationForMedication(),a.newManageUserVaccination=function(){b.go("manageuservaccinations")},c.vaccinationPage=function(){a.vprVaccination.vaccinationPrev=angular.copy(k.vprVaccination.vaccinationPrev),a.vprVaccination.vaccinationNext=angular.copy(k.vprVaccination.vaccinationNext)},a.newManageUserFamilyHistory=function(){b.go("manageUserFamilyHistory")},c.familyHistoryPage=function(){a.vprFamilyHistory.familyHistoryPrev=angular.copy(k.vprFamilyHistory.familyHistoryPrev),a.vprFamilyHistory.familyHistoryNext=angular.copy(k.vprFamilyHistory.familyHistoryNext)},a.newManageUserIncident=function(){b.go("manageuserincident")},c.incidentPage=function(){a.vprIncident.incidentPrev=angular.copy(k.vprIncident.incidentPrev),a.vprIncident.incidentNext=angular.copy(k.vprIncident.incidentNext)},
//get subscribed accessible location
a.getAccessibleSubscriberLocationForIncident=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForIncident=b.data,a.accessibleSubscriberLocationForIncident&&a.accessibleSubscriberLocationForIncident.length>0&&(a.hasAccessibleSubscriberLocationForIncident=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForIncident})},a.getAccessibleSubscriberLocationForIncident(),a.newCrudUserSymptom=function(){b.go("manageUserSymptoms")},c.symptomPage=function(){a.vprSymptom.symptomPrev=angular.copy(k.vprSymptom.symptomPrev),a.vprSymptom.symptomNext=angular.copy(k.vprSymptom.symptomNext)},
//get subscribed accessible location
a.getAccessibleSubscriberLocationForSymptom=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForSymptom=b.data,/*if($scope.accessibleSubscriberLocation &&  $scope.accessibleSubscriberLocation.length>0){*/
a.accessibleSubscriberLocationForSymptom&&!e.isEmpty(a.accessibleSubscriberLocationForSymptom)&&(a.hasAccessibleSubscriberLocationForSymptom=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForSymptom})},a.getAccessibleSubscriberLocationForSymptom(),a.newManageBill=function(){b.go("managebill")},c.billsPage=function(){a.vprBill.billPrev=angular.copy(k.vprBill.billPrev),a.vprBill.billNext=angular.copy(k.vprBill.billNext)},c.dependentPage=function(){a.vprDependent.dependentPrev=angular.copy(k.vprDependent.dependentPrev),a.vprDependent.dependentNext=angular.copy(k.vprDependent.dependentNext)},a.newManageBloodDonation=function(){b.go("manageblooddonation")},c.bloodDonationPage=function(){a.vprBloodDonation.donationPrev=angular.copy(k.vprBloodDonation.donationPrev),a.vprBloodDonation.donationNext=angular.copy(k.vprBloodDonation.donationNext)},a.newVprEditBloodRequest=function(){b.go("managebloodreq")},c.bloodRequestPage=function(){a.vprBloodRequest.requestPrev=angular.copy(k.vprBloodRequest.requestPrev),a.vprBloodRequest.requestNext=angular.copy(k.vprBloodRequest.requestNext)},a.getAllAccessibleOrgUsersForBloodRequest(),
//check weather the record created by this users organization
a.checkUserAccessForBloodRequest=function(b){var d=!1;if(a.isOrganizationUserMode)a.allAccessibleOrgUsersForBloodRequest&&!e.isEmpty(a.allAccessibleOrgUsersForBloodRequest)&&a.allAccessibleOrgUsersForBloodRequest.forEach(function(a){if(a&&b&&b.id&&a.id==b.id)return d=!0});else if(c.loggedInUserDetails&&c.loggedInUserDetails.id&&b&&b.id&&b.id==c.loggedInUserDetails.id)return d=!0;return d},a.newManageClient=function(){b.go("addorglocclient")},a.newManageComplaints=function(){b.go("manageComplaints")},c.complaintsPage=function(){a.vprComplaint.complaintPrev=angular.copy(k.vprComplaint.complaintPrev),a.vprComplaint.complaintNext=angular.copy(k.vprComplaint.complaintNext)},c.certificatesPage=function(){a.vprCertificate.certificatePrev=angular.copy(k.vprCertificate.certificatePrev),a.vprCertificate.certificateNext=angular.copy(k.vprCertificate.certificateNext)},a.newManageRequest=function(){b.go("createrequest")},c.appointmentPage=function(){a.vprAppointment.appointmentPrev=angular.copy(k.vprAppointment.appointmentPrev),a.vprAppointment.appointmentNext=angular.copy(k.vprAppointment.appointmentNext)},a.newManageAppointments=function(){b.go("manageFixAppointment")},/*******************************************VPR Appointment Filter End***********************************/
/******************************************* VPR Appointment Access Control Start********************************************************/
//get subscribed accessible location
a.getAccessibleSubscriberLocationForAppointment=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForAppointment=b.data,a.accessibleSubscriberLocationForAppointment&&a.accessibleSubscriberLocationForAppointment.length>0&&(a.hasAccessibleSubscriberLocationForAppointment=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForAppointment})},a.getAccessibleSubscriberLocationForAppointment(),c.diagnosticTestPage=function(){a.vprDiagnosticTest.diagnosticTestPrev=angular.copy(k.vprDiagnosticTest.diagnosticTestPrev),a.vprDiagnosticTest.diagnosticTestNext=angular.copy(k.vprDiagnosticTest.diagnosticTestNext)},a.newManageDiagnosticTest=function(){b.go("addEditUserTests")},/*******************************************VPR Diagnostic Filter End************************************/
/******************************************* VPR Diagnostic Tests  Access Control Start********************************************************/
//get subscribed accessible location
a.getAccessibleSubscriberLocationForDiagnosticTest=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForDiagnosticTest=b.data,a.accessibleSubscriberLocationForDiagnosticTest&&a.accessibleSubscriberLocationForDiagnosticTest.length>0&&(a.hasAccessibleSubscriberLocationForDiagnosticTest=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForDiagnosticTest})},a.getAccessibleSubscriberLocationForDiagnosticTest(),c.userMeasurementPage=function(){a.vprUserMeasurement.userMeasurementPrev=angular.copy(k.vprUserMeasurement.userMeasurementPrev),a.vprUserMeasurement.userMeasurementNext=angular.copy(k.vprUserMeasurement.userMeasurementNext)},a.newManageUserMeasurement=function(){b.go("addusermeasurement")},/*******************************************VPR User Measurement Filter End************************************/
/******************************************* VPR Measurement  Access Control Start********************************************************/
//get subscribed accessible location
a.getAccessibleSubscriberLocationForUserMeasurement=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForUserMeasurement=b.data,a.accessibleSubscriberLocationForUserMeasurement&&a.accessibleSubscriberLocationForUserMeasurement.length>0&&(a.hasAccessibleSubscriberLocationForUserMeasurement=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForUserMeasurement})},a.getAccessibleSubscriberLocationForUserMeasurement(),/******************************************* VPR Measurement  Access Control End********************************************************/
/******************************************* VPR Measurement  Benchmark start********************************************************/
a.goToBenchmarkList=function(){b.go("benchmarkchartdatalist")},c.paymentMadePage=function(){a.vprPaymentMade.paymentMadePrev=angular.copy(k.vprPaymentMade.paymentMadePrev),a.vprPaymentMade.paymentMadeNext=angular.copy(k.vprPaymentMade.paymentMadeNext)},a.newManagePayment=function(){b.go("managereceiptpayment")},/*******************************************VPR Payment Made Filter End************************************/
/******************************************* VPR Payment Made Access Control Start********************************************************/
//get subscribed accessible location
a.getAccessibleSubscriberLocationForPaymentMade=function(b){return g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocationForPaymentMade=b.data,a.accessibleSubscriberLocationForPaymentMade&&a.accessibleSubscriberLocationForPaymentMade.length>0&&(a.hasAccessibleSubscriberLocationForPaymentMade=!0))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermissionForPaymentMade})},a.getAccessibleSubscriberLocationForPaymentMade(),a.addShareDocument=function(b,c){if(!e.isEmpty(b)){var d=new Object;d.mode="add",d.shareType="DPR",d.advanceShareType="ALL",d.entityId=//clientId;
d.sharedEntityName="vpr-displayusername-locationname",
// shareEntity.chainSharingId = shareDocument.chainSharingId;
d.callBackFun=function(){a.modeChange()},a.shareObject.init(d)}},/******************************************* VPR Payment Made Access Control End********************************************************/
/*******************************************VPR Payment Made Module End***********************************/
a.newManageissue=function(a){d.show({templateUrl:"app/modules/user-issue/views/user-issue-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{type:"add",userId:a.getName},controller:["$scope","$mdDialog","locals","manageUserIssueService",function(a,d,h,k){function l(){if(E.transactionType)return a.shareLocation=!0,a.shareLocation}function m(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,g.getData(f.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.issue.creatingLocId=b.data[0],a.issue.creatingLocId},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function n(b){if(1!=a.loginDetails.userAccountStatusDTO.whetherSubscriber||a.loginDetails.isOrganizationUserMode){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,g.getData(f.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.queryUserId=b.data},function(b){a.userNameAutoCmpLoading=!1,e.isEmpty(b.data)||e.isEmpty(b.data.messages[0])||i("Alert",j.instant(b.data.messages[0]))})}return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,g.getData(f.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.queryUserId=b.data},function(b){a.userNameAutoCmpLoading=!1})}
// function getDisease(viewValue) {
//     $scope.searchKeyWord = {};
//     $scope.searchKeyWord.searchKeyWord = viewValue;
//     $scope.diseaseLoad = true;
//     return httpService.getData(urlService.getParameterizedUrl('GET_DISEASE_BY_KEYWORD',
//         $scope.searchKeyWord), null, function (response) {
//         $scope.diseaseLoad = false;
//         return $scope.disease = angular.fromJson(response.data);
//     }, function (errorResponse) {
//         $scope.diseaseLoad = false;
//         if (!utilService.isEmpty(errorResponse.data) &&
//             !utilService.isEmpty(errorResponse.data.messages[0])) {
//             notify("Alert", $translate.instant(errorResponse.data.messages[0]));
//         } else {
//             notify("error", $translate.instant("RECORD_SEARCH_FAILURE"));
//         }
//     });
// }
function o(b){a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=b;var c=f.getParameterizedUrl("FIND_DISEASE_BY_VARIANT_ID",a.searchKeyWord);if(c)return g.getData(c,null,function(b){b&&b.data&&(a.issue.disease=b.data)},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function p(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=f.getParameterizedUrl("GET_DISEASE_VARIANTS_BY_SEARCHWORD",a.queryObj);if(c)return g.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}
// function getDiseaseVariant(viewValue) {
//     $scope.searchKeyWord = {};
//     $scope.searchKeyWord.searchKeyWord = viewValue;
//     // if ($scope.issue && $scope.issue.disease) {
//     //     $scope.searchKeyWord.diseaseId = $scope.issue.disease.id;
//     // } else {
//     //     notify("error", $translate.instant("Select Disease"));
//     //     return;
//     // }
//     $scope.diseaseVariantLoad = true;
//     return httpService.getData(urlService.getParameterizedUrl('GET_VARIANT_LIST_BY_ID',
//         $scope.searchKeyWord), null, function (response) {
//         $scope.diseaseVariantLoad = false;
//         return $scope.diseaseVariantLoad = angular.fromJson(response.data);
//     }, function (errorResponse) {
//         $scope.diseaseVariantLoad = false;
//         if (!utilService.isEmpty(errorResponse.data) &&
//             !utilService.isEmpty(errorResponse.data.messages[0])) {
//             notify("Alert", $translate.instant(errorResponse.data.messages[0]));
//         } else {
//             notify("error", $translate.instant("RECORD_SEARCH_FAILURE"));
//         }
//     });
// }
function q(b,c){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var d={};d.searchKeyword=b;var h="GET_ORG_LOC_BY_ALL"}else{var d={};d.searchKeyword=b;
//userObj.userId = userId.value.id;   
var h="FIND_SUBSCRIBED_LOCATION"}var d={};return d.searchKeyword=b,g.getData(f.getParameterizedUrl(h,d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function r(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function s(b){var c={};return c.organizationLocationId=b,g.getData(f.getParameterizedUrl("GET_ORG_LOC_BY_ID",c),null,function(b){b&&b.data&&1==b.data.whetherSubscriber?a.isSubscribedLoc=!0:a.isSubscribedLoc=!1},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error","OTP Has Expired Or Invalid Access")})}function t(){if(a.issue.userId.value&&a.issue.userId.value.id?(a.issue.userId.id=a.issue.userId.value.id,a.issue.userId.value=a.issue.userId.value.value,delete a.issue.userId.value.value):(delete a.issue.userId.code,delete a.issue.userId.organizationLocationId),a.issue.serviceType.id&&a.issue.serviceType.value&&(a.issue.serviceType.id=a.issue.serviceType.id,a.issue.serviceType.value=a.issue.serviceType.value,delete a.issue.serviceType.code,delete a.issue.serviceType.organizationLocationId),a.issue&&a.issue.firstDiagnosedIn&&a.issue.firstDiagnosedIn.id?a.issue.firstDiagnosedIn=a.issue.firstDiagnosedIn:a.issue&&a.issue.firstDiagnosedIn&&!a.issue.firstDiagnosedIn.id&&(a.issue.firstDiagnosedValue=a.issue.firstDiagnosedIn),a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&(a.issue.lastTreatedIn=a.issue.lastTreatedIn),(a.issue&&a.issue.lastTreatedIn&&!a.issue.lastTreatedIn.id||a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&0==a.isSubscribedLoc)&&(
//$scope.issue.lastTreatedValue=$scope.issue.lastTreatedIn;
a.issue.treatmentType={},a.issue.treatmentType.id=a.issue.serviceType.id,a.issue.treatmentType.value=a.issue.serviceType.value,delete a.issue.serviceType),a.issue&&a.issue.lastTreatedIn&&!a.issue.lastTreatedIn.id&&(a.issue.lastTreatedValue=a.issue.lastTreatedIn,delete a.issue.lastTreatedIn),a.issue&&a.issue.lastTreatedBy&&a.issue.lastTreatedBy.id)a.issue.lastTreatedBy=a.issue.lastTreatedBy,delete a.issue.lastTreatedBy.version,delete a.issue.lastTreatedBy.displayName,delete a.issue.lastTreatedBy.professionalId;else if(a.issue&&a.issue.lastTreatedBy&&!a.issue.lastTreatedBy.id){var c=a.issue.lastTreatedBy;a.issue.lastTreatedBy={},a.issue.lastTreatedByValue=c,delete a.issue.lastTreatedBy}a.issue&&a.issue.creatingLocId&&a.issue.creatingLocId.id&&(a.issue.creatingLocId=a.issue.creatingLocId.id),
//$scope.issue.dateFirstDiagnosed = dateconvertor.convertToServerDate($scope.issue.dateFirstDiagnosed);
//$scope.issue.dateLastTreated = dateconvertor.convertToServerDate($scope.issue.dateLastTreated);
//$scope.issue.nextAppointmentScheduledOn = dateconvertor.convertToServerDate($scope.issue.nextAppointmentScheduledOn);
k.saveUserIssue(a.issue,function(c){c&&(d.cancel(),b.go("searchUserIssue"),a.issue&&a.issue.id?i("success",j.instant("RECORD_UPDATED_SUCCESS")):i("success",j.instant("RECORD_SAVED_SUCCESS")))},function(b){return a.issue&&a.issue.userId&&!a.issue.userId.id?void i("error",j.instant("INVALID_USER")):a.issue&&a.issue.disease&&!a.issue.disease.id?void i("error",j.instant("INVALID_DISEASE")):a.issue&&a.issue.diseaseVariant&&!a.issue.diseaseVariant.id?void i("error",j.instant("INVALID_DISEASE_VARIANT")):a.issue&&a.issue.serviceType&&!a.issue.serviceType.id?void i("error",j.instant("INVALID_SERVICE")):void(!e.isEmpty(b.data)&&!e.isEmpty(b.data.messages)&&b.data.messages.length>0&&i("error",j.instant(b.data.messages[0])))})}a.issue={},a.getUserNamesForRoleHistory=n,a.getDisease=o,a.getDiseaseVariant=p,a.getServiceProvider=q,a.getCreatingLocation=r,a.loginDetails=c.loggedInUserDetails,a.checkWhetherSubscribedLocation=s,a.getSystemOrg=m,a.saveUserIssue=t,a.issueShareLocation=l,a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.issue.userId={},a.issue.userId.value=a.loginDetails.displayName,a.issue.userId.id=a.loginDetails.id,m());var u=angular.fromJson(localStorage.getItem("defaultOrgLoc"));null!=u&&(a.issue.lastTreatedIn={id:u.id,value:u.value},a.issue.creatingLocId={id:u.id,value:u.value},s(a.issue.lastTreatedIn.id)),a.loginDetails&&a.loginDetails.isorganiizationUser&&h.userId&&(a.issue.userId=h.userId),a.cancel1=function(){d.cancel()},a.callManageIssue=function(c){a.newIssue=c,d.cancel(),b.go("manageUserIssue",{type:"add",data:a.newIssue})},p(),a.getServiceType=function(b){if(a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&1==a.isSubscribedLoc){a.queryObj={},a.queryObj.locationId=a.issue.lastTreatedIn.id,a.queryObj.searchString=b;var c=f.getParameterizedUrl("FIND_SERVICE_TYPE_BY_LOCID",a.queryObj);if(c)return g.getData(c,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}else{a.queryObj={},a.queryObj.name=b;var c=f.getParameterizedUrl("TREATMENT_TYPE",a.queryObj);if(c)return g.getData(c,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}}}]})},a.newManageTreatment=function(a){d.show({templateUrl:"app/modules/disease-treatment/views/user-treatment-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{type:"add",userId:a.getName},controller:["$scope","$mdDialog","locals","manageUserTreatmentService",function(a,d,h,k){function l(){var b={};return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,g.getData(f.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.treatment.creatingOrgLoc=b.data[0],m(a.treatment.user.id,a.treatment.creatingOrgLoc.id),n(a.treatment.user.id,a.treatment.creatingOrgLoc.id),a.treatment.creatingOrgLoc},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function m(b,c){var d={};d.userId=b,d.locationId=c;var h=f.getParameterizedUrl("GET_INCIDENT_ID_FOR_TREATMENT",d);if(h)return g.getData(h,null,function(b){if(b&&b.data)return a.incidentId=b.data,a.incidentId},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function n(b,c){if(a.whethersub){var d={};d.userId=b,d.creatingOrgId=c;var h=f.getParameterizedUrl("FIND_DISEASEVARIANT_FOR_IND_SUB",d)}else{var d={};d.userId=b,
//searchKeyWord.locId=locId;
d.creatingOrgId=c;
//var url = urlService.getParameterizedUrl('FIND_DISEASE_VARIANT_BY_USER_AND_LOCATION',searchKeyWord);
var h=f.getParameterizedUrl("FIND_DISEASEVARIANT_FOR_IND_SUB",d)}if(h)return g.getData(h,null,function(b){if(b&&b.data)return a.diseaseVariant=b.data,a.diseaseVariant},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function o(b){a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=b;var c=f.getParameterizedUrl("FIND_DISEASE_BY_VARIANT_ID",a.searchKeyWord);if(c)return g.getData(c,null,function(b){b&&b.data&&(a.treatment.disease=b.data)},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}function p(b){if(a.loginDetails.userAccountStatusDTO.whetherSubscriber=!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,g.getData(f.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,g.getData(f.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,e.isEmpty(b.data)||e.isEmpty(b.data.messages[0])||i("Alert",j.instant(b.data.messages[0]))})}function q(b){var c={};return c.keyword=b,g.getData(f.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function r(b){var c={};return c.searchKeyword=b,g.getData(f.getParameterizedUrl("GET_ORG_LOC_BY_ALL",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function s(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,g.getData(f.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,e.isEmpty(b.data)||e.isEmpty(b.data.messages[0])?i("error",j.instant("RECORD_SERACH_FAILURE")):i("Alert",j.instant(b.data.messages[0]))})}function t(){
//$scope.treatment.insuranceClaimCurrency.value=$scope.treatment.insuranceClaimCurrency.dataValue.value;
return a.treatment&&a.treatment.currencyOnTreatment&&a.treatment.currencyOnTreatment.dataValue&&(a.treatment.currencyOnTreatment.id=a.treatment.currencyOnTreatment.dataValue.id,a.treatment.currencyOnTreatment.value=a.treatment.currencyOnTreatment.dataValue.value,delete a.treatment.currencyOnTreatment.dataValue),a.treatment&&a.treatment.insuranceClaimCurrency&&a.treatment.insuranceClaimCurrency.dataValue&&(a.treatment.insuranceClaimCurrency.id=a.treatment.insuranceClaimCurrency.dataValue.id,a.treatment.insuranceClaimCurrency.value=a.treatment.insuranceClaimCurrency.dataValue.value,delete a.treatment.insuranceClaimCurrency.dataValue),a.treatment.clinicalProtocol&&!a.treatment.clinicalProtocol.id?void i("error",j.instant("INVALID_PROTOCOL")):(a.treatment&&a.treatment.treatmentLocation&&!a.treatment.treatmentLocation.id&&(a.treatment.treatmentLocationValue=a.treatment.treatmentLocation,delete a.treatment.treatmentLocation),a.treatment&&a.treatment.mainProfessionalAssociated&&a.treatment.mainProfessionalAssociated.id&&(delete a.treatment.mainProfessionalAssociated.version,delete a.treatment.mainProfessionalAssociated.displayName,delete a.treatment.mainProfessionalAssociated.professionalId),a.treatment&&""==a.treatment.mainProfessionalAssociated&&delete a.treatment.mainProfessionalAssociated,a.treatment&&""==a.treatment.clinicalProtocol&&delete a.treatment.clinicalProtocol,a.treatment&&a.treatment.mainProfessionalAssociated&&!a.treatment.mainProfessionalAssociated.id&&(a.treatment.professionalName=a.treatment.mainProfessionalAssociated,delete a.treatment.mainProfessionalAssociated),a.treatment&&a.treatment.clinicalProtocol&&a.treatment.clinicalProtocol.id&&(a.treatment.clinicalProtocol.id=a.treatment.clinicalProtocol.id,a.treatment.clinicalProtocol.value=a.treatment.clinicalProtocol.protocol,a.treatment.clinicalProtocol.organizationLocationId=a.treatment.clinicalProtocol.organizationLocationId,delete a.treatment.clinicalProtocol.version,delete a.treatment.clinicalProtocol.creatingOrgLoc,delete a.treatment.clinicalProtocol.disease,delete a.treatment.clinicalProtocol.diseaseVariant,delete a.treatment.clinicalProtocol.documentId,delete a.treatment.clinicalProtocol.protocolFile,delete a.treatment.clinicalProtocol.whetherActive,delete a.treatment.clinicalProtocol.dateAdded,delete a.treatment.clinicalProtocol.description,delete a.treatment.clinicalProtocol.protocol),!e.isEmpty(a.treatment)&&a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload&&(a.treatment.treatmentSummaryFile=a.userTreatmentFile.fileToBeUpload.name),!e.isEmpty(a.treatment)&&a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload&&(a.treatment.feedbackFromScan=a.userTreatmentScanFile.fileToBeUpload.name),void(a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload?(a.documentUpload.document.fileName=a.userTreatmentFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.userTreatmentFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.treatment.creatingOrganization.id,a.documentUpload.document.documentType={subType:A.documentSubTypes.userTreatments},"add"!=E.type&&a.treatment.documentId&&(a.documentUpload.document.id=a.treatment.documentId),k.saveDocumentDetails(a.documentUpload.document,E.type,function(b){a.attachmentFormSpinner=!1,a.userTreatmentFile.fileToBeUpload&&(a.userTreatmentFile&&a.userTreatmentFile.fileToBeUpload&&a.userTreatmentFile.fileToBeUpload.name&&a.uploadFile1(a.userTreatmentFile,a.treatment,b),a.treatment&&a.treatment.id?i("success",j.instant("RECORD_UPDATED_SUCCESS")):i("success",j.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload?(a.documentUpload2.document.fileName=a.userTreatmentScanFile.fileToBeUpload.name,a.documentUpload2.document.fileSize=a.userTreatmentScanFile.fileToBeUpload.size,a.documentUpload2.document.organizationLocationId=a.treatment.creatingOrganization.id,a.documentUpload2.document.documentType={subType:A.documentSubTypes.userTreatments},"add"!=E.type&&a.treatment.feedbackDocumentId&&(a.documentUpload2.document.id=a.treatment.feedbackDocumentId),k.saveDocumentDetails(a.documentUpload2.document,E.type,function(b){a.attachmentFormSpinner=!1,a.userTreatmentScanFile.fileToBeUpload&&(a.userTreatmentScanFile&&a.userTreatmentScanFile.fileToBeUpload&&a.userTreatmentScanFile.fileToBeUpload.name&&a.uploadFile2(a.userTreatmentScanFile,a.treatment,b),a.treatment&&a.treatment.id?i("success",j.instant("RECORD_UPDATED_SUCCESS")):i("success",j.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):k.save(a.treatment,function(b){b&&(d.cancel(),E.id?(a.stateParamValue=E.id,a.disable=!1):(E.id=b.response,a.stateParamValue=E.id,a.disable=!1),
//$state.go('viewUserTreatment');
null!=a.treatment.id?i("success",j.instant("RECORD_UPDATED_SUCCESS")):i("success",j.instant("RECORD_SAVED_SUCCESS")))},function(a){e.isEmpty(a.data)||e.isEmpty(a.data.messages[0])?i("error",j.instant("RECORD_UPDATE_FAILURE")):i("Alert",j.instant(a.data.messages[0]))})))}a.treatment={},a.getSystemOrg=l,a.getDiseaseVariant=n,a.getDisease=o,a.getTreatmentTypeId=s,a.getUserNamesForRoleHistory=p,a.getCreatingOrgLoc=q,a.getCreatingOrgTreatLoc=r,a.loginDetails=c.loggedInUserDetails,a.getIncidentId=m,a.save=t,
// for  user treatment summary popup 
a.cancel1=function(){d.cancel()},a.callManageTreatment=function(c){a.newTreatment=c,d.cancel(),b.go("manageUserTreatment",{type:"add",data:a.newTreatment})},a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!c.loggedInUserDetails.isOrganizationUserMode&&(a.whethersub=!0,a.treatment.user={},a.treatment.user.value=a.loginDetails.displayName,a.treatment.user.id=a.loginDetails.id,l());var u=angular.fromJson(localStorage.getItem("defaultOrgLoc"));a.loginDetails&&a.loginDetails.isOrganizationUserMode&&h.userId&&(a.treatment.user=h.userId),null!=u&&(a.treatment.treatmentLocation={id:u.id,value:u.value},a.treatment.creatingOrgLoc={id:u.id,value:u.value},n(a.treatment.user.id,a.treatment.creatingOrgLoc.id))}]})}}]),angular.module("paripal.patientRecordModule").factory("PatientRecord",function(){var a={vprVaccinationsList:void 0,vprLocationsList:void 0,vprIncidentsList:void 0,vprMedicationsList:void 0,vprTreatmentsList:void 0,bloodRequestList:void 0,bloodDonationsList:void 0,symptomList:void 0,IssuesList:void 0,billList:void 0,complaintList:void 0,dependentsList:void 0,requestList:void 0,certificatesList:void 0,appointmentList:void 0,diagnosticTestList:void 0,userMeasurementList:void 0,paymentMadeList:void 0},b={},c={},d={},e={},f={},g={},h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={};return{PatientRecordList:a,vprMedication:b,vprTreatment:c,vprIssue:d,vprVaccination:e,vprSymptom:f,vprIncident:g,vprBloodDonation:h,vprBloodRequest:i,vprUserDetails:j,vprBill:k,vprComplaint:l,vprlocation:m,vprDependent:n,vprRequest:o,vprCertificate:p,vprAppointment:q,vprDiagnosticTest:r,vprUserMeasurement:s,vprPaymentMade:t}}),angular.module("paripal.patientRecordModule").service("vprService",["httpService","urlService","$filter","dateconvertor","PatientRecord",function(a,b,c,d){"use strict";/*******************User Details Start *******************/
this.userDetails=function(c,d,e){var f={};f.userId=c.userId,a.getData(b.getParameterizedUrl("GET_USER_DETAILS",f),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.userPersonalInfo=function(c,d,e){var f={};f.userId=c.userId,a.getData(b.getParameterizedUrl("GET_USER_PROFILE_BY_ID",f),null,function(a){a?d(a):e(a)},function(a){e(a)})},/*******************User Details End *******************/
/*******************location Start *******************/
this.locDetails=function(c,d,e){var f={};f.userId=c.userId,f.organizationLocationId=c.organizationLocationId,f.pageNumber=c.pageNumber,f.recordsPerPage=c.recordsPerPage,a.postData(b.getUrl("GET_VPR_CLIENT_LOCATION_LIST"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getClientByLocIdAndUserId=function(c,d,e,f){a.getData(b.getUrl("GET_CLIENT_BY_USER_ID_LOC_ID")+"?userId="+d+"&orgLocId="+c,null,function(a){a?e(a):errorCallBack(a)},function(a){errorCallBack(a)})},/*******************Location End *******************/
/*******************Vaccinations Details Start *******************/
this.fetchVaccintionRecords=function(c,e,f){var g={};g.userId=c.id,g.location=c.location,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.transactionType=c.transactionType,c.status&&(g.status=c.status),(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.till=d.convertToServerDate(c.till)),a.postData(b.getUrl("GET_VPR_USER_VACCINATION_LIST"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/*******************Vaccinations Details End *******************/
/*******************Family History Details Start *******************/
this.fetchFamilyHistoryRecords=function(c,d,e){var f={};f.userId=c.id,f.creatingOrgnId=c.location,f.pageNumber=c.pageNumber,f.recordsPerPage=c.recordsPerPage,f.diseaseId=c.diseaseId,f.transactionType=c.transactionType,a.postData(b.getUrl("FAMILY_HISTORY_VPR_FINDBY_CRITERIA"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},/*******************Family History Details End *******************/
/*******************User Medication Details Start *******************/
this.fetchMedicationRecords=function(c,e,f){var g={};g.user=c.user,g.orgLocation=c.orgLocation,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.transactionType=c.transactionType,c.status&&(g.status=c.status),(c.startDate||c.dateStopped)&&(g.startDate=d.convertToServerDate(c.startDate),g.dateStopped=d.convertToServerDate(c.dateStopped)),a.postData(b.getUrl("USER_MEDICATION_VPR_FIND_BY_CRITERIA"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/*******************User Medication Details End *******************/
/*******************User Incidents Details Start *******************/
this.fetchIncidentRecords=function(c,d,e){var f={};f.userId=c.userId,f.orgLocation=c.orgLocation,f.pageNumber=c.pageNumber,f.recordsPerPage=c.recordsPerPage,f.transactionType=c.transactionType,c.linkedToDisease&&(f.linkedToDisease=c.linkedToDisease),//requestObj.symptomselect = patientrecord.symptomselect;
a.postData(b.getUrl("USER_INCIDENT_VPR_FIND_BY_CRITERIA"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},/*******************User Incidents Details End *******************/
/*******************User Treatments Details Start *******************/
this.fetchTreatmentRecords=function(c,e,f){var g={},h="";g.userId=c.userId,g.treatmentLocation=c.treatmentLocation,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.transactionType=c.transactionType,(c.dateStart||c.dateEnd)&&(g.dateStart=d.convertToServerDate(c.dateStart),g.dateEnd=d.convertToServerDate(c.dateEnd)),/*if(patientrecord && patientrecord.continuing){
 	if(patientrecord.continuing=="ongoing")
	{
 	requestObj.continuing = true;
	
	} 
 	else if(patientrecord.continuing=="stopped")	{
 	requestObj.continuing = false;
	
	}
 	}*/
c.status&&(g.status=c.status),c.issueId&&(g.issueId=c.issueId.id),h=c.continuing&&g.dateStart&&g.dateEnd&&c.issueId?"GET_USER_TREATMENT_BY_VPR_CRITERIA":"FIND_USER_TREATMENT_BY_VPR_CRITERIA",a.postData(b.getUrl(h),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.fetchAllTreatmentRecords=function(c,e,f){var g={};g.userId=c.userId,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,(c.dateStart||c.dateEnd)&&(g.dateStart=d.convertToServerDate(c.dateStart),g.dateEnd=d.convertToServerDate(c.dateEnd)),c&&c.continuing&&(1==c.continuing?g.continuing=!0:0==c.continuing&&(g.continuing=!1)),c.issueId&&(g.issueId=c.issueId.id),a.postData(b.getUrl("GET_USER_TREATMENT_BY_VPR_CRITERIA_FOR_ALL_RECORDS"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/*******************User Treatments Details End *****************************************************/
/**************************start blood request service************************************************/
this.BloodRequestSearchFilter=function(c,e,f){var g={};g.requestBy=c.requestBy,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.bloodGroups=c.bloodGroup,(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.till=d.convertToServerDate(c.till)),a.postData(b.getUrl("GET_BLOOD_REQUEST_FILTER_SEARCH_LIST"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End blood request service************************************************/
/**************************start blood donation service************************************************/
this.getBloodDonationList=function(c,e,f){var g={};g.userId=c.userId,g.orgLocationName=c.orgLocationName,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.till=d.convertToServerDate(c.till)),a.postData(b.getUrl("GET_BLOOD_DONATION_FILTER_SEARCH_LIST"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************start blood donation service************************************************/
/**************************start Symptom service************************************************/
this.getSymptomList=function(c,d,e){var f={};f.userId=c.userId,f.creatingOrgLocId=c.creatingOrgLocId,f.pageNumber=c.pageNumber,f.recordsPerPage=c.recordsPerPage,f.transactionType=c.transactionType,c.linkedToDisease&&(f.diseaseId=c.linkedToDisease),a.postData(b.getUrl("GET_SYMPTOM_FILTER_SEARCH_LIST"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},/**************************End Symptom service************************************************/
/**************************start issue service start************************************************/
this.getIssueList=function(c,e,f){var g={};g.user=c.userId,g.creatingLocId=c.creatingLocId,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.transactionType=c.transactionType,c.status&&(g.status=c.status),(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.till=d.convertToServerDate(c.till)),a.postData(b.getUrl("SEARCH_USER_VPRISSUE_FINDBY_CRITERIA"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End issue service end************************************************/
/*******************Bills  Start *******************/
this.billList=function(c,e,f){var g={};g.userId=c.userId,g.raisedOnLocationId=c.raisedOnLocationId,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.dateTill=d.convertToServerDate(c.till)),c.status&&c.status&&(g.status=c.status),a.postData(b.getUrl("GET_VPR_BILL_LIST_FIND_BY_CRITERIA"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/*******************Bills  End *******************/
/**************************start complaints service************************************************/
this.fetchComplaintRecords=function(c,e,f){var g={};g.userId=c.userId,g.orgLocationId=c.orgLocationId,g.complaintTypeId=c.complaintTypeId,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,(c.dateFrom||c.till)&&(g.registeredFromDate=d.convertToServerDate(c.dateFrom),g.registeredTillDate=d.convertToServerDate(c.till)),a.postData(b.getUrl("VPR_COMPLAINT_LIST"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End complaints service************************************************/
/*******************Dependents  Start *******************/
this.getDependentsList=function(c,d,e){var f={};f.userId=c.userId,f.pageNumber=c.pageNumber,f.recordsPerPage=c.recordsPerPage,a.postData(b.getUrl("VPR_FIND_WARD_USER_BY_USER_ID"),f,function(a){
//httpService.getData(urlService.getParameterizedUrl('VPR_FIND_WARD_USER_BY_USER_ID',requestObj),null, function (response) {
a&&a.data?d(a.data):e(a)},function(a){e(a)})},/*******************Dependents  End *******************/
/**************************start Request service************************************************/
this.fetchOtherRequests=function(c,e,f){var g={};g.requestInitiator=c.userId,g.orgLocation=c.orgLocation,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.transactionType=c.transactionType,(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.dateTill=d.convertToServerDate(c.till)),a.postData(b.getUrl("VPR_REQUEST_LIST"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End Request service************************************************/
/**************************start Certificate service************************************************/
this.fetchCertificatesList=function(c,e,f){var g={};g.requestInitiator=c.userId,g.orgLocation=c.orgLocation,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.transactionType=c.transactionType,(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.dateTill=d.convertToServerDate(c.till)),a.postData(b.getUrl("VPR_CERTIFICATES_LIST"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End Certificate service************************************************/
/**************************Start Appointment service ************************************************/
this.getAppointmentList=function(c,e,f){var g={};c.treatmentId&&c.treatmentId.id&&(g.treatmentId=c.treatmentId.id),g.userId=c.userId,g.orgLocationId=c.orgLocationId,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,(c.dateFrom||c.till)&&(g.startDate=d.convertToServerDate(c.dateFrom),g.endDate=d.convertToServerDate(c.till)),a.postData(b.getUrl("SEARCH_APPOINTMENTS_BY_FINDBY_CRITERIA"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End Appointment service ************************************************/
/**************************Start Diagnostic Test service ************************************************/
this.getDiagnosticTestList=function(c,e,f){var g={};c.diagnosticTestId&&c.diagnosticTestId.diagnosticTestId&&(g.diagnosticTestId=c.diagnosticTestId.diagnosticTestId),c.status&&c.status&&(g.status=c.status),g.userId=c.userId,g.organizationLocationId=c.organizationLocationId,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.dateTill=d.convertToServerDate(c.till)),a.postData(b.getUrl("SEARCH_DIAGNOSTICTESTUSERS_BY_FINDBY_CRITERIA"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End Diagnostic Test service ************************************************/
/**************************Start User Measurement service ************************************************/
this.getUserMeasurementList=function(c,e,f){var g={};c.measurementIndicator&&c.measurementIndicator.id&&(g.measurementIndicator={},g.measurementIndicator.id=c.measurementIndicator.id),/*if(appData.status && appData.status){
		requestObj.status=appData.status;	
	}*/
g.userId=c.userId,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.dateTill=d.convertToServerDate(c.till)),a.postData(b.getUrl("SEARCH_USER_MEASUREMENT_BY_FINDBY_CRITERIA"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/**************************End User Measurement service ************************************************/
/**************************Start Payment Made service ************************************************/
this.getPaymentMadeList=function(c,e,f){var g={};(c.dateFrom||c.till)&&(g.dateFrom=d.convertToServerDate(c.dateFrom),g.dateTill=d.convertToServerDate(c.till)),c.status&&c.status&&(g.statusCode=c.status),g.onBehalfOfUserId=c.userId,g.onBehalfOfLocationId=c.organizationLocationId,g.typeCode="RECEIPT",g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,a.postData(b.getUrl("FILTER_RECEIPT_PAYMENT_VPR"),g,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.pharmacyInteractionModule").controller("LocationMedicationCtrl",["$scope","$rootScope","$stateParams","datatableconfig","$state","notify","$translate","serverSidePagination","httpService","urlService","utilService","commonConstants","userStatusService","baseService","$mdDialog","featurePrivilegeConstants","addUserTestService","dateconvertor","EmergencyTransactionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.commonConstants=l,a.medicationObj={},a.medicationVariants=[],a.medicationObj.whetherTaxesApplicable=!1,a.cancel=function(){k.goBackToPrevState()},a.mappedTaxes=[],a.testArray=[],a.medicationTaxes=[{}],a.addMed=function(){a.medicationTaxes.push({})},a.removeMed=function(b){a.medicationTaxes.splice(b,1),a.testArray.splice(b,1),a.mappedTaxes.splice(b,1)},/* NEW CODE START */
a.taxApplicableClicked=function(b){1==b&&(a.mappedTaxes=[],a.testArray=[],a.medicationTaxes=[{}])},a.getLocationTaxes=function(b){var c={locId:b.id};i.getData(j.getParameterizedUrl("COUNTRY_TAX",c),null,function(b){a.testTax=b.data.response},function(a){f("error",g.instant("RECORD_SEARCH_FAILURE"))})},a.getMedication=function(b){return a.searchKeyWord={},a.searchKeyWord.medication=b,a.medicationLoad=!0,i.getData(j.getParameterizedUrl("SEARCH_MEDICATION",a.searchKeyWord),null,function(b){return a.medicationLoad=!1,a.medication=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SEARCH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})},a.getMedicationVariant=function(b){a.queryObj={},a.queryObj.id=b;var c=j.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&i.getData(c,null,function(b){b&&b.data&&(a.medicationVariants=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",i.getData(j.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},a.onTaxSelect=function(b,c,d,e){var h=!1;angular.forEach(a.mappedTaxes,function(c,d){if(d==e){h=!0;var i={};i=b,/*pushValue.id = null;
                        pushValue.location = $scope.defOrgLoc;*/
a.testArray[d]=b,a.mappedTaxes[d]=i}else c&&b.tax==c.tax&&(h=!0,angular.forEach(a.testArray,function(c,d){b.id==c.id&&(delete a.testArray[e],delete a.mappedTaxes[e],a.medicationTaxes.splice(e,1),a.testArray=a.testArray.filter(function(a){return void 0!=a}),a.mappedTaxes=a.mappedTaxes.filter(function(a){return void 0!=a}),f("error",g.instant("TAX_ALREADY_APPLICABLE")))}))}),0==h&&(k.isNullOrEmpty(b)||a.mappedTaxes.push(b))},a.submitLocMed=function(){b.showSpinner=!0;var d={};d=angular.copy(a.medicationObj),d.countryTaxRateList=angular.copy(a.mappedTaxes),"edit"==c.pageState?(a.url="LOC_MEDICATION_EDIT",i.postData(j.getUrl(a.url),d,function(a){f("success",g.instant(a.data.successMessage)),b.showSpinner=!1,e.go("locationmedicationlist")},function(a){b.showSpinner=!1})):(a.url="CREATE_LOC_MEDICATION",i.postData(j.getUrl(a.url),d,function(a){a&&a.data&&(f("success",g.instant(a.data.successMessage)),b.showSpinner=!1,e.go("locationmedicationlist"))},function(a){b.showSpinner=!1}))};/* NEW CODE END */
var t=function(){if(!k.isNullOrEmpty(c)&&!k.isNullOrEmpty(c.pageState)&&!k.isNullOrEmpty(c.data)&&"edit"==c.pageState){a.pageState=c.pageState;var d={};d.id=angular.fromJson(c.data),i.getData(j.getParameterizedUrl("LOC_MEDICATION_EDIT_FETCH",d),null,function(b){b&&b.data&&(a.medicationObj=b.data,a.medicationVariants.push(a.medicationObj.medicationVariant),a.medicationTaxes=b.data.countryTaxRateList,a.testArray=b.data.countryTaxRateList,a.mappedTaxes=b.data.countryTaxRateList)},function(a){b.showSpinner=!1})}if(!k.isNullOrEmpty(c)&&!k.isNullOrEmpty(c.pageState)&&"add"==c.pageState){var e=n.getDefaultOrgLocation();k.isFieldEmpty(e)||(a.defOrgLoc=e.orgLoc,a.medicationObj.organizationLocation=a.defOrgLoc,a.getLocationTaxes(a.medicationObj.organizationLocation))}};t()}]),angular.module("paripal.pharmacyInteractionModule").controller("LocationMedicationListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$mdDialog","$translate","serverSidePagination","baseService","httpService","urlService","utilService","eventListService","manageComplaintsService","featurePrivilegeConstants","dateconvertor","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.searchCriteria={},a.maxDateValidFrom=new Date,/* NEW CODE START */
a.getLocationTaxes=function(b){var c={locId:b.id};k.getData(l.getParameterizedUrl("COUNTRY_TAX",c),null,function(b){a.testTax=b.data.response},function(a){f("error",h.instant("RECORD_SEARCH_FAILURE"))})},a.getMedication=function(b){return a.searchKeyWord={},a.searchKeyWord.medication=b,a.medicationLoad=!0,k.getData(l.getParameterizedUrl("SEARCH_MEDICATION",a.searchKeyWord),null,function(b){return a.medicationLoad=!1,a.medication=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})},a.getMedicationVariant=function(b){a.queryObj={},a.queryObj.id=b;var c=l.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&k.getData(c,null,function(b){b&&b.data&&(a.medicationVariants=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.findLocation=function(c){a.locationNameAutoCmp=!0;var d={},e=[];d.keyword=c;var f="";return f=b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?"FIND_ACCESSIBLE_LOCATION":"GET_ORG_LOC_OF_CLIENT",k.getData(l.getParameterizedUrl(f,d),null,function(b){return a.locationNameAutoCmp=!1,e=angular.fromJson(b.data)},function(b){a.locationNameAutoCmp=!1})},/* NEW CODE END */
a.manageMed=function(a,b){m.isNullOrEmpty(b)||m.isNullOrEmpty(b.id)?d.go("locationmedication",{pageState:a}):d.go("locationmedication",{pageState:a,data:b.id})},a.deleteAllergyRecord=function(c){b.showSpinner=!0;var d={id:c.id};k.postData(l.getParameterizedUrl("ALLERGY_DELETE",d),null,function(c){b.showSpinner=!1,a.getMedList(),f("success",h.instant("ALLERGY_RECORD_DELETED"))},function(a){b.showSpinner=!1})},a.getMedList=function(){a.searchCriteria.pageNumber=a.currentPage,a.searchCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0;var c={};c=angular.copy(a.searchCriteria),k.postData(l.getUrl("LOC_MEDICATION_LIST"),c,function(c){c&&c.data&&(b.showSpinner=!1,a.locMedList=angular.fromJson(c.data.data),a.totalItems=c.data.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.clear=function(){a.searchCriteria={},a.getMedList()},a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getMedList()},
//set page record
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getMedList()};
//datatble config json
var s={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(s),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){a.getMedList()},a.init()}]),angular.module("paripal.pharmacyInteractionModule").controller("fulfillmentAndAlternativeCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$q","$translate","$timeout","$filter","dateconvertor","utilService","managePharmacyOrderFulfillmentService","httpService","urlService","serverSidePagination","managePharmacyOrderService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(b){a.alternatives&&b<a.alternatives.qty?a.showAlternative=!0:a.showAlternative=!1}a.alternatives={},a.alternativess={},a.whetherDisable={},a.showAlternative=!1,a.btnField=!1,a.alternatives.medication1="",b.$on("pageData",function(b,c){a.pageDetails={id:c.id,type:c.type}}),a.changeAltStatus=s,1==b.loggedInUserDetails.isOrganizationUserMode&&(//individual user mode case
a.whetherDisable=!1),a.cancel=function(){localStorage.getItem("id");d.go("managepharmacyorderfulfillment",{id:localStorage.getItem("id"),type:localStorage.getItem("type")})},a.changeAlternatives=function(){a.whetherActive1=!1,a.whetherActive2=!1,a.whetherActive3=!1,a.whetherActiveField1&&(a.whetherActive2=!0,a.whetherActive3=!0),a.whetherActiveField2&&(a.whetherActive1=!0,a.whetherActive3=!0),a.whetherActiveField3&&(a.whetherActive1=!0,a.whetherActive2=!0)},a.setSuggestMedication=function(b,c,d,e){
//var flag = $scope.whetherActiveField1;
b?(a.alternatives.medicationSugg={},a.alternatives.medicationVariantSugg={},a.alternatives.unitCost=0,a.alternatives.lineAmount=parseInt(a.alternatives.lineAmount)-e*a.alternatives.suggQty):(c&&(a.alternatives.medicationSugg={},a.alternatives.medicationSugg.id=c.id,a.alternatives.medicationSugg.value=c.value),d&&(a.alternatives.medicationVariantSugg={},a.alternatives.medicationVariantSugg.id=d.id,a.alternatives.medicationVariantSugg.value=d.value),a.alternatives.unitCost=e,a.alternatives.lineAmount=parseInt(a.alternatives.lineAmount)+e*a.alternatives.suggQty)},a.getQuantity=function(b,c){c>b&&(a.alternatives.suggQty=parseInt(c)-parseInt(b))},a.getLineAmount=function(){parseInt(a.alternatives.qtyCanFulfill)>a.alternatives.qty&&a.alternatives.qtyCanFulfill.length>0?(a.qtylimit=!0,a.btnField=!0):0==a.alternatives.qtyCanFulfill.length?(a.btnField=!0,a.qtylimit=!1):(a.btnField=!1,a.qtylimit=!1),a.alternatives.lineAmount=a.alternatives.qtyCanFulfill*a.alternatives.medicationCost},a.fulfillmentUpdate=function(){var a={};a.id=c.id,a.status="Fulfillment Details Updated";var b="";b="UPDATE_ORDER_STATUS",o.putData(p.getParameterizedUrl(b,a),null,function(a){!m.isNullOrEmpty(a.data.successMessage)&&a.data&&(f("success",h.instant("ORDER_PLACED_SUCCESSFULLY")),d.go("managepharmacyorderfulfillment",{id:localStorage.getItem("id"),type:localStorage.getItem("type")}))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.saveOrderFullfilment=function(){r.updateMedicationFullfilment(a.alternatives,function(a){m.isNullOrEmpty(a.successMessage)||(d.go("managepharmacyorderfulfillment",{id:localStorage.getItem("id"),type:localStorage.getItem("type")}),f("success",h.instant(a.successMessage)))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.getMedication=function(b){a.queryObj={},a.queryObj.keyword=b;var c=p.getParameterizedUrl("GET_MEDICATION_LIST_BY_KEYWORD",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.medicationList=a.filterData(b.data),a.medicationList},function(a){})},b.$on("medication",function(b,c){a.medicationId=c});var t=[];a.filterData=function(a){var b=[];return a.forEach(function(a,c){t.indexOf(a.id)<0&&b.push(a)}),b},a.getVariant=function(b,c){a.queryObj={},a.queryObj.id=b;var d=p.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);d&&o.getData(d,null,function(d){d&&d.data&&("medication1"===c&&(a.medicationVariants1=d.data),"medication2"===c&&(a.medicationVariants2=d.data),"medication3"===c&&(a.medicationVariants3=d.data),a.pushMedicationId(b))},function(a){})},a.pushMedicationId=function(a){for(var b=0;b<t.length;b++)if(t[b]!=a){t.push(a);break}},a.setData=function(b){b.medication1&&a.getVariant(b.medication1.id,"medication1"),b.medication2&&a.getVariant(b.medication2.id,"medication2"),b.medication3&&a.getVariant(b.medication3.id,"medication3"),b.medicationVariant1&&(a.medVariant1Id=b.medicationVariant1.id),b.medicationVariant2&&(a.medVariant2Id=b.medicationVariant2.id),b.medicationVariant3&&(a.medVariant3Id=b.medicationVariant3.id)},a.init=function(){c.data?(t=[],a.alternatives=c.data,a.alternatives.suggQty=parseInt(a.alternatives.qty)-parseInt(a.alternatives.qtyCanFulfill),a.setData(a.alternatives),t.push(a.alternatives.medication.id),a.alternatives&&a.alternatives.qtyCanFulfill>=0&&s(a.alternatives.qtyCanFulfill)):c.id&&n.getmedicationOrderById(c.id,function(b){a.alternatives=b,a.alternatives.suggQty=parseInt(a.alternatives.qty)-parseInt(a.alternatives.qtyCanFulfill),a.setData(a.alternatives),t.push(a.alternatives.medication.id),a.alternatives&&a.alternatives.qtyCanFulfill>=0&&s(a.alternatives.qtyCanFulfill)},function(a){}),"edit"==c.type&&(a.medFields1=!0,a.medFields2=!0,a.medFields3=!0),"view"==c.type&&(
//$scope.disabled = true;
null!=a.alternatives.medication1?a.medFields1=!0:a.medFields1=!1,null!=a.alternatives.medication2?a.medFields2=!0:a.medFields2=!1,null!=a.alternatives.medication3?a.medFields3=!0:a.medFields3=!1)},a.init()}]),angular.module("paripal.pharmacyInteractionModule").controller("managePharmacyOrderCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$q","$timeout","$filter","dateconvertor","utilService","managePharmacyOrderService","myReqService","httpService","urlService","commonConstants","serverSidePagination","pharmacyOrderListService","manageRequestService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";
// request mgmnt
function v(b){localStorage.setItem("requestId",b.id),b.organization&&b.organization.id&&(a.pharmacyOrder.pharmacy={},a.pharmacyOrder.pharmacy.id=b.organization.id,a.pharmacyOrder.pharmacy.value=b.organization.value),b.symptom&&b.symptom.id&&(a.pharmacyOrder.symptom={},a.pharmacyOrder.symptom.id=b.symptom.id,a.pharmacyOrder.symptom.name=b.symptom.value),b.disease&&b.disease.id&&(a.pharmacyOrder.disease={},a.pharmacyOrder.disease.id=b.disease.id,a.pharmacyOrder.disease.value=b.disease.value)}if(a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.pharmacyOrder={},a.pharmacyOrder.status="New",a.status=!0,a.pickupmode=["Deliver at home","Pickup from Store"],a.paymentmode=["Cash on Delivery","Online"],a.medicationOrderList=[],a.pharmacyOrderMedication={},a.minDate=new Date,a.visibleViewPres=!0,a.inlineEnabled=!1,a.loginDetails=b.loggedInUserDetails,a.cancel=function(){d.go("pharmacyorderlist",{type:""})},a.addNewOrder=function(){d.go("orderpharmacy")},a.addMedicationOrder=function(){var b={};a.inlineEnabled=!0,a.medicationOrderList.push(b)},
//table toogle for responsive
a.column=!1,a.toggle=function(){a.column=!a.column},a.saveMedicationFullfilment=function(b){
//var variantId=pharmacyOrderMedication.medicationVariant.id;
//pharmacyOrderMedication.medicationVariant={};
//pharmacyOrderMedication.medicationVariant.id=variantId;
//delete $scope.pharmacyOrderMedication.medicationVariant;
return b.medicationVariant&&b.medicationVariant.id?!b.qty||b.qty<=0?void f("error","Please enter atleast one qty"):(a.model.selected={},c.id&&(b.pharmacyOrder={},b.pharmacyOrder.id=c.id),void n.updateMedicationFullfilment(b,function(c){c&&!m.isNullOrEmpty(c.successMessage)&&(a.visibleViewPres=!0,b.id?(b.version+=1,a.inlineEnabled=!1):
//  $state.go('pharmacyorderlist');
a.getmedicationOrderList(),f("success",h.instant("RECORD_ADDED_SUCCESSFULLY")),a.visiblePlaceOrder=!0)},function(b){m.isNullOrEmpty(b.data.messages[0])||f("Alert",h.instant("REQUIRED")),a.inlineEnabled=!1})):void f("error","Please select variant")},a.getmedicationOrderList=function(){if(c.id){var b={};b.id=c.id,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,n.getmedicationOrderList(b,function(b){b&&(a.medicationOrderList=b.data,a.medicationOrderList.length>0?a.visiblePlaceOrder=!0:a.visiblePlaceOrder=!1,a.totalItems=b.totalRecords,a.pagingInfo=s(a.currentPage,a.itemPerPage,a.totalItems),a.inlineEnabled=!1)},function(b){a.inlineEnabled=!1})}else a.medicationOrderList=[]},c.requestId){var w=parseInt(c.requestId);o.getRequestListById(w,function(b){if(a.manageOrgLocSpinner=!1,b){v(b);a.reqplace=!0}},function(b){a.manageOrgLocSpinner=!1,a.error=b})}a.savePharmacyOrder=function(){if(/*if(!angular.isString($scope.pharmacyOrder.onBehalfOf)){
    	  	$scope.pharmacyOrder.onBehalfOf = $scope.pharmacyOrder.onBehalfOf.displayName;
    	   }*/
a.pharmacyOrder.symptom&&(delete a.pharmacyOrder.symptom.version,delete a.pharmacyOrder.symptom.name,delete a.pharmacyOrder.symptom.organizationLocationId,delete a.pharmacyOrder.symptom.symptomDescription,delete a.pharmacyOrder.symptom.whetherActive),""==a.pharmacyOrder.symptom&&delete a.pharmacyOrder.symptom,""==a.pharmacyOrder.disease&&delete a.pharmacyOrder.disease,a.pharmacyOrder.symptom&&!a.pharmacyOrder.symptom.id)return a.pharmacyOrder.symptom="",void f("Alert",h.instant("Please Select Valid Symptom"));if(a.pharmacyOrder.disease&&!a.pharmacyOrder.disease.id)return a.pharmacyOrder.disease="",void f("Alert",h.instant("Please Select Valid disease"));
// if($scope.pharmacyOrder.pharmacy && !$scope.pharmacyOrder.pharmacy.id){
//   notify("alert", $translate.instant("Enter Valid Pharmacy"));
// }
c.requestId&&(a.pharmacyOrder.createRequest={},a.pharmacyOrder.createRequest.id=c.requestId),a.pharmacyOrder.orderDate=l.convertToServerDate(a.pharmacyOrder.orderDate);var b;b=a.pharmacyOrder.id?"UPDATE_PHARMACY_ORDER":"SAVE_PHARMACY_ORDER",n.savePharmacyOrder(b,a.pharmacyOrder,function(b){m.isNullOrEmpty(b.successMessage)||(c.id=b.response,
//$scope.visiblePlaceOrder = true;
a.invisibleBtn=!0,f("success",h.instant(b.successMessage)),a.pharmacyOrder&&!a.pharmacyOrder.id?(a.pharmacyOrder.id=b.response,c.data=a.pharmacyOrder,a.visibleaddnew1=!0):a.pharmacyOrder&&a.pharmacyOrder.id&&("New"===a.pharmacyOrder.status?a.visibleaddnew1=!0:a.visibleaddnew1=!1))},function(b){return a.pharmacyOrder&&a.pharmacyOrder.pharmacy&&!a.pharmacyOrder.pharmacy.id?(a.pharmacyOrder.pharmacy="",void f("Alert",h.instant("Please Select Valid Pharmacy"))):void(m.isNullOrEmpty(b.data.message[0])||f("alert",h.instant(b.data.message[0])))})},a.setData=function(b){b.symptom&&(a.pharmacyOrder.symptom.id=b.symptom.id,a.pharmacyOrder.symptom.name=b.symptom.value)},a.placeOrder=function(){if(!(a.medicationOrderList&&a.medicationOrderList.length>0))return void f("error",h.instant("ORDER_MEDICATION_VALIDATION"));var b={};b.id=c.id,b.status="Ordered",b.requestId=0;var d="";d="UPDATE_ORDER_STATUS",p.putData(q.getParameterizedUrl(d,b),null,function(b){!m.isNullOrEmpty(b.data.successMessage)&&b.data&&(a.confirmOrderStatus=!0,a.pharmacyOrder.status="Ordered",
//$scope.confirmDeliveryStatus = true;
// $scope.getpharmacyOrderList();
f("success",h.instant("ORDER_PLACED_SUCCESSFULLY")))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.getSymptom=function(b){a.queryObj={},a.queryObj.symptomName=b;var c=q.getParameterizedUrl("FIND_SYMPTOMNAME",a.queryObj);if(c)return p.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=q.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return p.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.getUserNamesForRoleHistory=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_LIST_BY_SEACRH_KEY";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),p.getData(q.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},a.getMedications=function(b){return a.medication={},a.medication.medication=b,a.medicationLoad=!0,p.getData(q.getParameterizedUrl("SEARCH_MEDICATION",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1})},a.getVariant=function(b){a.queryObj={},a.queryObj.id=b;var c=q.getParameterizedUrl("GET_MED_VARIANT_LIST_BY_KEYWORD",a.queryObj);c&&p.getData(c,null,function(b){b&&b.data&&(a.medicationVariants=b.data)},function(a){})},a.checkVisiblePlaceOrder=function(){
//    return true;
return"New"===a.pharmacyOrder.status?a.visiblePlaceOrder=!0:(a.visiblePlaceOrder=!1,a.visibleaddnew1=!1),a.visiblePlaceOrder},a.initByPharmacyOrder=function(){a.manageOrgLocSpinner=!0,"add"===c.type&&(a.pharmacyOrder.orderDate=new Date,a.pageState="add",a.btndisabled=!0,a.field=!0,a.visibleaddnew=!0,b.loggedInUserDetails&&(a.pharmacyOrder.onBehalfOf={},a.pharmacyOrder.onBehalfOf.id=b.loggedInUserDetails.id,a.pharmacyOrder.onBehalfOf.value=b.loggedInUserDetails.displayName),a.loginDetails.isOrganizationUserMode||(a.queryObj={},a.queryObj.userId=a.loginDetails.id,u.getAddressByUserId(a.queryObj,function(b){b.addressLine1&&b.addressLine2&&b.addressLine3?a.pharmacyOrder.deliveryAddress=b.addressLine1+b.addressLine2+b.addressLine3:b.addressLine1&&b.addressLine2?a.pharmacyOrder.deliveryAddress=b.addressLine1+b.addressLine2:b.addressLine1&&(a.pharmacyOrder.deliveryAddress=b.addressLine1)},function(a){}))),c.data?(a.pharmacyOrder=c.data,"New"===a.pharmacyOrder.status?(a.visiblePlaceOrder=!0,a.visibleaddnew1=!0):(a.disableMode=!0,a.visibleaddnew1=!1),"Confirmed"===a.pharmacyOrder.status&&(a.allMode=!0,a.visibleaddnew1=!1),a.setData(a.pharmacyOrder)):c.id&&t.getPharmacyOrderById(c.id,function(b){a.pharmacyOrder=b,"New"===a.pharmacyOrder.status?(a.visiblePlaceOrder=!0,a.visibleaddnew1=!0):(a.disableMode=!0,a.visibleaddnew1=!1),a.setData(a.pharmacyOrder)},function(a){}),"edit"===c.type&&(a.invisibleBtn=!1,a.getmedicationOrderList()),"view"===c.type&&(a.viewMode=!0,a.pageState="view",a.getmedicationOrderList())},a.initByPharmacyOrder(),a.pageChanged=function(){a.pagingInfo=s(a.currentPage,a.itemPerPage,a.totalItems),a.getpharmacyOrderList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getpharmacyOrderList()},/*$scope.getOnBehalfOf = function (orgLocationValue) {
          $scope.queryObj = {};
          $scope.queryObj.keyword = orgLocationValue;
          var url = urlService.getParameterizedUrl('GET_ORG_LOC_LIST_BY_KEYWORD', $scope.queryObj);
          if (url) {
            return httpService.getData(url, null, function (response) {
              if (response && response.data) {
                $scope.orgLocList = response.data;
                return $scope.orgLocList;
              }
            }, function (error) {},{'orgLocPermission':$scope.orgLocPermission});
          }

        };*/
a.getPharmacy=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=q.getParameterizedUrl("FIND_PHARMACY",a.queryObj);if(c)return p.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},a.deleteOrder=function(b){var c={};c.id=b,n.deleteOrder(c,function(b){m.isNullOrEmpty(b.successMessage)||(a.getmedicationOrderList(),f("success",h.instant(b.successMessage)))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.cancelOrderMedication=function(){a.reset(),a.getmedicationOrderList()};
//data table config
var x=r.gridConfigurations;a.options=g.setOptionProperties(x),a.dtColumnDefs=g.setColumnProperties({}),/* inline edit strat*/
a.model={selected:{}},
// gets the template to ng-include for a table row / item
a.getTemplate=function(b){return b.id===a.model.selected.id?"edit":"display"},a.editContact=function(b){a.visibleViewPres=!1,a.inlineEnabled=!0,a.model.selected=angular.copy(b),a.getVariant(b.medication.id)},a.saveContact=function(b){console.log("Saving contact"),a.model.contacts[b]=angular.copy(a.model.selected),a.reset()},a.reset=function(){a.model.selected={},a.visibleViewPres=!0}}]),angular.module("paripal.pharmacyInteractionModule").controller("managePharmacyOrderFulfillmentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$q","$timeout","$filter","dateconvertor","utilService","managePharmacyOrderFulfillmentService","httpService","urlService","serverSidePagination","pharmacyOrderFulfillmentListService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){a.orderFulfillment.tax?a.orderFulfillment.net=parseInt(a.orderFulfillment.totalCost)-parseInt(a.orderFulfillment.discount)+parseInt(a.orderFulfillment.tax):a.orderFulfillment.net=parseInt(a.orderFulfillment.totalCost)-parseInt(a.orderFulfillment.discount)}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.whetherDisable=!0,a.orgUserVisibleField=!0,
//$scope.statuses = ['Pending','Close'];
a.pickupmode=["Deliver at home","Pickup from Store"],a.paymentmode=["Cash on Delivery","Online"],a.medicationOrderList=[],b.pageData={},a.sum=t,a.addNewOrder=function(){d.go("orderpharmacy")},a.addMedicationOrder=function(){var b={};a.medicationOrderList.push(b)},1==b.loggedInUserDetails.isOrganizationUserMode&&(//individual user mode case
a.whetherDisable=!1),a.saveOrderFullfilment=function(){a.orderFulfillment.symptom&&(delete a.orderFulfillment.symptom.version,delete a.orderFulfillment.symptom.name,delete a.orderFulfillment.symptom.organizationLocationId,delete a.orderFulfillment.symptom.symptomDescription,delete a.orderFulfillment.symptom.whetherActive),angular.isString(a.orderFulfillment.onBehalfOf)||(a.orderFulfillment.onBehalfOf=a.orderFulfillment.onBehalfOf),a.orderFulfillment.status="Fulfillment Details Updated",a.orderFulfillment.discount&&a.orderFulfillment.totalCost&&a.orderFulfillment.tax&&(a.orderFulfillment.net=parseInt(a.orderFulfillment.totalCost)-parseInt(a.orderFulfillment.discount)+parseInt(a.orderFulfillment.tax)),n.saveOrderFullfilment(a.orderFulfillment,function(a){m.isNullOrEmpty(a.successMessage)||(d.go("pharmacyorderlist"),f("success",h.instant(a.successMessage)))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.manageMedicationOrderFulfilment=function(a,b){n.getmedicationOrderById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("fulfillmentandalternatives",{id:a,type:e,data:f})},function(a){})},a.getmedicationFulfilmentOrderList=function(){c.id?(a.pageNumber=a.currentPage,a.recordsPerPage=a.itemPerPage,n.getmedicationOrderList(c.id,a.pageNumber,a.recordsPerPage,function(b){b&&(a.medicationOrderList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=q(a.currentPage,a.itemPerPage,a.totalItems))},function(a){})):a.medicationOrderList=[]},a.setData=function(b){b.symptom&&(a.orderFulfillment.symptom.id=b.symptom.id,a.orderFulfillment.symptom.name=b.symptom.value)},a.initByPharmacyOrder=function(){a.manageOrgLocSpinner=!0,c.data?(a.orderFulfillment=c.data,a.setData(a.orderFulfillment),"edit"==c.type&&1==b.loggedInUserDetails.isOrganizationUserMode&&"Ordered"===a.orderFulfillment.status&&(a.orgUserVisibleField=!1)):c.id&&r.getPharmacyOrderById(c.id,function(d){a.orderFulfillment=d,a.setData(a.orderFulfillment),a.getmedicationFulfilmentOrderList(),"edit"===c.type&&1==b.loggedInUserDetails.isOrganizationUserMode&&"Ordered"===a.orderFulfillment.status&&(a.orgUserVisibleField=!1)},function(a){}),"edit"===c.type&&(a.disabled=!0,localStorage.setItem("id",c.id),localStorage.setItem("type",c.type),a.getmedicationFulfilmentOrderList()),"view"===c.type&&(a.pageState="view",a.disabled=!0,a.viewMode=!0,a.orgUserVisibleField=!0,localStorage.setItem("id",c.id),localStorage.setItem("type",c.type),a.getmedicationFulfilmentOrderList())},a.initByPharmacyOrder(),a.getOnBehalfOf=function(b){a.queryObj={},a.queryObj.keyword=b;var c=p.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},a.getPharmacy=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=p.getParameterizedUrl("FIND_PHARMACY",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})};
//data table config
var u=s.gridConfigurations;a.options=g.setOptionProperties(u),a.dtColumnDefs=g.setColumnProperties({}),a.ordercancel=function(){d.go("pharmacyorderlist",{type:""})},a.getSymptom=function(b){a.queryObj={},a.queryObj.symptomName=b;var c=p.getParameterizedUrl("FIND_SYMPTOMNAME",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=p.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.getUserNamesForRoleHistory=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_LIST_BY_SEACRH_KEY";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),o.getData(p.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.pageChanged=function(){a.pagingInfo=q(a.currentPage,a.itemPerPage,a.totalItems),a.getpharmacyOrderFulfillmentList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getpharmacyOrderFulfillmentList()}}]),angular.module("paripal.pharmacyInteractionModule").controller("pharmacyOrderFulfillmentListCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$q","$timeout","$filter","dateconvertor","utilService","pharmacyOrderFulfillmentListService","httpService","urlService","serverSidePagination","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.order={},a.disease={},a.indUser=!1,a.statuses=["Pending","Close"],a.pickupmode=["Deliver at home","Pickup from Store"],a.paymentmode=["Cash on Delivery","Online"],a.addNewOrder=function(){e.go("manageorderpharmacy")},a.clear=function(){a.order={},a.disease={}},a.addMedicationOrder=function(){var b={};a.medicationOrderList.push(b)},b.loggedInUserDetails.isOrganizationUser||(a.order.onBehalfOf=b.loggedInUserDetails.displayName,a.indUser=!0),a.getpharmacyOrderFulfillmentList=function(b,c){n.isEmpty(b)&&n.isEmpty(c)?b={}:(b.onBehalfOf=b.onBehalfOf.displayName,c.data&&(b.disease=c.data.id)),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,o.getpharmacyOrderList(b,function(b){b&&(a.pharmacyOrderList=[],a.pharmacyOrderList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=r(a.currentPage,a.itemPerPage,a.totalItems))},function(a){})},a.curdPharmacyOrder=function(a,b){o.getPharmacyOrderById(a,function(c){var d,f=c;d=b?"edit":"view",e.go("managepharmacyorderfulfillment",{id:a,type:d,data:f})},function(a){})},a.getOnBehalfOf=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,p.getData(q.getParameterizedUrl("FIND_USERBYNAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.pageChanged=function(){a.pagingInfo=r(a.currentPage,a.itemPerPage,a.totalItems),a.getpharmacyOrderFulfillmentList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getpharmacyOrderFulfillmentList()};
//data table config
var s=d.gridConfigurations;a.options=h.setOptionProperties(s),a.dtColumnDefs=h.setColumnProperties({}),/* inline edit strat*/
/* $scope.model = {
        
        selected: {}
    };

    // gets the template to ng-include for a table row / item
    $scope.getTemplate = function (order) {
        if (order.id === $scope.model.selected.id) return 'edit';
        else return 'display';
    };

    $scope.editContact = function (order) {
        $scope.model.selected = angular.copy(order);
    };

    $scope.saveContact = function (idx) {
        console.log("Saving contact");
        $scope.model.contacts[idx] = angular.copy($scope.model.selected);
        $scope.reset();
    };

    $scope.reset = function () {
         $scope.model.selected = {};
    };
       */
/*inline edit end*/
a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=q.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return p.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},/* $scope.fetchRecords = function(order)
     {
    	 order.onBehalfOf = onBehalfOf.value;
    	 var disease =order.disease;
    	 order.disease = disease.id;
    	 pharmacyOrderFulfillmentListService.fetchRecords(order, function (sucessResponse){
        {
          order.dateFrom = dateconvertor.convertToServerDate(order.dateFrom);
          order.tillDate = dateconvertor.convertToServerDate(order.tillDate);
                 if(sucessResponse)
                 {
                 
                 $scope.pharmacyOrderList=[];
                 $scope.pharmacyOrderList = sucessResponse.data; 
                 
                 }
             }
         }, function (errorResponse) {
             
         });
     }*/
a.getpharmacyOrderFulfillmentList()}]),angular.module("paripal.pharmacyInteractionModule").controller("pharmacyOrderListCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","$q","$timeout","$filter","dateconvertor","utilService","pharmacyOrderListService","httpService","urlService","serverSidePagination","commonConstants","$mdDialog","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.order={},a.disease={},a.confirmOrderStatus=!1,a.dispatchOrderStatus=!1,a.rejectOrderStatus=!1,a.indUserMode=!1,a.confirmDeliveryStatus=!0,/*$scope.order.symptom = '';  */
a.statuses=["New","Ordered","Confirmed","Fulfillment Details Updated","Dispatched","Delivered","Rejected"],a.pickupmode=["Deliver at home","Pickup from Store"],a.paymentmode=["Cash on Delivery","Online"],a.indUserMode=!1,t.validateListing("PHARMACY_ORDER_RECORD_SUB"),a.addNewOrder=function(){d.go("manageorderpharmacy")},a.addMedicationOrder=function(){var b={};a.medicationOrderList.push(b)},b.loggedInUserDetails.isOrganizationUserMode||(a.indUserMode=!0),/*if (!$rootScope.loggedInUserDetails.isOrganizationUserMode) {
                $scope.indUserMode = true;
              }*/
a.clear=function(){a.order={},a.disease={},a.statuses=[]},a.getpharmacyOrderList=function(b,c){m.isEmpty(b)&&m.isEmpty(c)?b={}:
//  if(pharmacyOrderList.onBehalfOf){
//  var onBehalfOf = pharmacyOrderList.onBehalfOf;
//    pharmacyOrderList.onBehalfOf={};
//  pharmacyOrderList.onBehalfOf.id = onBehalfOf.id;
//  }
c.data&&(b.disease=c.data.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,n.getpharmacyOrderList(b,function(b){b&&(a.pharmacyOrderList=[],a.pharmacyOrderList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=q(a.currentPage,a.itemPerPage,a.totalItems))},function(a){})},a.goToPharmacyOrderFulfillment=function(a){n.getPharmacyOrderFulfillmentById(a,function(b){var c=b;d.go("managepharmacyorderfulfillment",{id:a,type:"edit",data:c})},function(a){})},a.curdPharmacyOrder=function(a,b){n.getPharmacyOrderById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageorderpharmacy",{id:a,type:e,data:f})},function(a){})},/*$scope.getOnBehalfOf = function (viewValue) {
                    $scope.userData = {};
                    $scope.userData.userName = viewValue;
                    $scope.userNameAutoCmpLoading = true;
                    return httpService.getData(urlService.getParameterizedUrl('FIND_USERBYNAME', $scope.userData), null, function (response) {
                        $scope.userNameAutoCmpLoading = false;
                        return $scope.users = angular.fromJson(response.data);
                    }, function (error) {
                        $scope.userNameAutoCmpLoading = false;
                    });
              };*/
a.getOnBehalfOf=function(c){a.userData={},a.userData.searchString=c,a.onBehalfOfAutoCmpLoading=!0;
// var url='GET_PATIENTS_LIST_BY_SEACRH_KEY';
var d="SEARCH_USER_BY_NAME";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),o.getData(p.getParameterizedUrl(d,a.userData),null,function(b){return a.onBehalfOfAutoCmpLoading=!1,a.users=b.data},function(b){a.onBehalfOfAutoCmpLoading=!1})},a.pageChanged=function(){a.pagingInfo=q(a.currentPage,a.itemPerPage,a.totalItems),a.getpharmacyOrderList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getpharmacyOrderList()};
//data table config
var u=r.gridConfigurations;a.options=g.setOptionProperties(u),a.dtColumnDefs=g.setColumnProperties({}),/* inline edit strat*/
a.model={selected:{}},
// gets the template to ng-include for a table row / item
a.getTemplate=function(b){return b.id===a.model.selected.id?"edit":"display"},a.editContact=function(b){a.model.selected=angular.copy(b)},a.saveContact=function(b){console.log("Saving contact"),a.model.contacts[b]=angular.copy(a.model.selected),a.reset()},a.reset=function(){a.model.selected={},a.getpharmacyOrderList(),a.order={}},/*inline edit end*/
a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=p.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},a.dispatchOrderStatus=!1,a.confirmOrderStatus=!1,a.rejectOrderStatus=!1,
//$scope.confirmDeliveryStatus = false;
a.confirmOrder=function(b){var c={};c.id=b.id,c.status="Confirmed",localStorage.getItem("requestId")?c.requestId=localStorage.getItem("requestId"):c.requestId=0;var d="";d="UPDATE_ORDER_STATUS",o.putData(p.getParameterizedUrl(d,c),null,function(b){!m.isNullOrEmpty(b.data.successMessage)&&b.data&&(a.confirmOrderStatus=!0,
//$scope.confirmDeliveryStatus = true;
a.getpharmacyOrderList(),f("success",h.instant("ORDER_CONFIRMED_SUCCESSFULLY")))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.despatchOrder=function(b){var c={};c.id=b.id,c.status="Dispatched",c.requestId=0;var d="";d="UPDATE_ORDER_STATUS",o.putData(p.getParameterizedUrl(d,c),null,function(b){!m.isNullOrEmpty(b.data.successMessage)&&b.data&&(a.dispatchOrderStatus=!0,a.getpharmacyOrderList(),f("success",h.instant("ORDER_DISPATCHED_SUCCESSFULLY")))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.deliveryOrder=function(b){var c={};c.id=b.id,c.status="Delivered",c.requestId=0;var d="";d="UPDATE_ORDER_STATUS",o.putData(p.getParameterizedUrl(d,c),null,function(b){!m.isNullOrEmpty(b.data.successMessage)&&b.data&&(a.getpharmacyOrderList(),f("success",h.instant("ORDER_CONFIRMED_DELIVERY_SUCCESSFULLY")))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.rejectOrder=function(b){var c={};c.id=b.id,c.status="Rejected",c.requestId=0;var d="";d="UPDATE_ORDER_STATUS",o.putData(p.getParameterizedUrl(d,c),null,function(b){!m.isNullOrEmpty(b.data.successMessage)&&b.data&&(a.rejectOrderStatus=!0,a.getpharmacyOrderList(),f("success",h.instant("ORDER_REJECTED_SUCCESSFULLY")))},function(a){m.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.getpharmacyOrderList()}]),angular.module("paripal.pharmacyInteractionModule").service("managePharmacyOrderFulfillmentService",["httpService","urlService","$timeout","$filter","$stateParams","dateconvertor",function(a,b,c,d,e,f){"use strict";this.getpharmacyOrderList=function(c,d,e){a.postData(b.getUrl("FINDBY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getmedicationOrderList=function(c,d,e,f,g){var h={};h.id=c,h.pageNumber=d,h.recordsPerPage=e,a.getData(b.getParameterizedUrl("GET_ORDER_MEDICATION_FULFILLMENT_BY_ORDER_ID",h),null,function(a){a&&a.data?f(a.data):g(a)},function(a){g(a)})},this.getOrderId=function(c,d){a.getData(b.getUrl("GET_ORDER_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.saveOrderFullfilment=function(c,d,e){c.orderDate=f.convertToServerDate(c.orderDate),a.postData(b.getUrl("UPDATE_ORDER_FULLFILMENT"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getmedicationOrderById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_ORDER_MEDICATION_FULFILLMENT_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.pharmacyInteractionModule").service("managePharmacyOrderService",["httpService","urlService","$timeout","$filter","dateconvertor",function(a,b,c,d,e){"use strict";this.savePharmacyOrder=function(c,d,e,f){a.postData(b.getUrl(c),d,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/*this.getOrderId = function (successCallback, errorCallback) {
             httpService.getData(urlService.getUrl('GET_ORDER_ID'),null, function (response) {
              
              if (response && response.data)
              {
                successCallback(response.data);
              }
                  else
                      errorCallback(response);

              }, function (error) {
                  errorCallback(error);
              });

          };*/
this.updateMedicationFullfilment=function(c,d,e){var f="SAVE_MEDICATION_ORDER";null!=c.id&&(f="UPDATE_MEDICATION_FULLFILMENT"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getmedicationOrderList=function(c,d,e){a.getData(b.getParameterizedUrl("GET_ORDER_MEDICATION_BY_ORDER_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteOrder=function(c,d,e){a.deleteData(b.getParameterizedUrl("DELETE_MEDICATION_ORDER",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.pharmacyInteractionModule").service("pharmacyOrderFulfillmentListService",["httpService","urlService","$timeout","$filter","dateconvertor",function(a,b,c,d,e){"use strict";this.getpharmacyOrderList=function(c,d,e){
//httpService.getData(urlService.getUrl('GET_PHARMACY_LIST'),null, function (response) {
a.postData(b.getUrl("FINDBY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getPharmacyOrderById=function(c,e,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_ORDER_FULFILMENT_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.orderDate=d("timestampToDate")(a.data.orderDate,b),e(a.data)):f(a)},function(a){f(a)})},this.fetchRecords=function(c,d,e){
//  if(order.dateFrom && order.tillDate){
//  order.dateFrom = dateconvertor.convertToServerDate(order.dateFrom);
//  order.tillDate = dateconvertor.convertToServerDate(order.tillDate);
// }
a.postData(b.getUrl("FINDBY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})};this.fetchRecords=function(c,d,e){
//   if(order.dateFrom && order.tillDate){
//   order.dateFrom = dateconvertor.convertToServerDate(order.dateFrom);
//   order.tillDate = dateconvertor.convertToServerDate(order.tillDate);
// }
a.postData(b.getUrl("FINDBY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.pharmacyInteractionModule").service("pharmacyOrderListService",["httpService","urlService","$timeout","$filter","dateconvertor",function(a,b,c,d,e){"use strict";this.getpharmacyOrderList=function(c,d,e){a.postData(b.getUrl("FINDBY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getPharmacyOrderById=function(c,e,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_PHARMACY_ORDER_REQUEST_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.orderDate=d("timestampToDate")(a.data.orderDate,b),e(a.data)):f(a)},function(a){f(a)})},this.getPharmacyOrderFulfillmentById=function(c,e,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_ORDER_FULFILMENT_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.orderDate=d("timestampToDate")(a.data.orderDate,b),e(a.data)):f(a)},function(a){f(a)})}}]),angular.module("paripal.professionalWallModule").controller("ManageProfessionalWallCtrl",["$scope","commonConstants","$state","userStatusService","utilService","ManageProfessionalWallService",function(a,b,c,d,e,f){a.commonConstants=b,a.WSProfessionalWallInfo={};var g=function(){return e.isFieldEmpty(c.params.callingUrl)?void c.go("home.view"):(a.professional=c.params.userData,void f.getProfWallByUserId(a.professional,function(b){e.isFieldEmpty(b)||angular.copy(b,a.WSProfessionalWallInfo)}))};a.manageProfessionalWall=function(){f.manageProfessionalWall(a.WSProfessionalWallInfo,a.professional,function(b){a.cancel()})},a.cancel=function(){e.goBackToPrevState()},g()}]),angular.module("paripal.professionalWallModule").controller("ViewProfessionalWallCtrl",["$scope","ManageProfessionalWallService","baseService","utilService","fileOperations","commonConstants","$stateParams","$state","$rootScope","$mdDialog","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k){a.WSProfessionalWallInfo={},a.WSOrgLoc={orgLoc:{}},a.count=500,a.isShowMore=!1;var l=function(){return d.isFieldEmpty(g.userData)?void h.go("home.view"):(a.userDetails=g.userData,a.whetherUserLoggedIn=k.isUserLoggedIn(),a.loggedInUser={},a.whetherUserLoggedIn&&(a.loggedInUser=k.userStatus().userData),a.orgLocationParam={userId:a.userDetails.userId},i.showSpinner=!0,b.getProfWallDetailsByUserId(g.userData,function(b){a.WSProfessionalWallInfo=b,i.showSpinner=!1,a.userProfilePic="app/images/user-profile-img.png",d.isFieldEmpty(a.WSProfessionalWallInfo)||(d.isFieldEmpty(a.WSProfessionalWallInfo.supportProfessionalTypeId)||d.isFieldEmpty(a.WSProfessionalWallInfo.supportProfessionalSubTypeId)||(a.whetherSupportSrvcProfessional=!0),d.isFieldEmpty(a.WSProfessionalWallInfo.healthProfessionalTypeId)||d.isFieldEmpty(a.WSProfessionalWallInfo.healthProfessionalSubTypeId)||(a.whetherHealthProfessional=!0),m(a.WSProfessionalWallInfo))}),a.getStars=function(a){
// Get the value
var b=parseFloat(a),c=b/5*100;return c+"%"},b.getProfessionalWallMenu(function(b){a.menuList=b}),void b.getAllOrgLocations(a.userDetails,function(b){b.length>0&&(a.WSOrgLoc.orgLoc={data:b[0]},a.setMap(a.WSOrgLoc.orgLoc))}))},m=function(b){var c={logoDocumentId:b.resourceId,logoFileName:b.fileName};if(!d.isFieldEmpty(c.logoDocumentId)&&!d.isFieldEmpty(c.logoFileName)){var g=new Object;g.fileName=c.logoFileName,g.resourceId=c.logoDocumentId,g.docType=f.documentTypes.userIdDocument,g.docSubType=f.documentSubTypes.profilePhoto,g.userId=a.userDetails.userId,i.showSpinner=!0,e.getImageUrl(g,function(b){a.userProfilePic=b,i.showSpinner=!1},function(){})}};a.setMap=function(b){a.orgLocation=[b.data.addressLattitudes,b.data.addressLongitudes]},a.manageProfessionalWall=function(){h.go("manageprofessionalwall",{callingUrl:"professionalwall",userData:a.userDetails})};var n=function(a,b){h.go(a,b)};a.conditionalChecks=function(b){var c=!0;return("SPECIALIZATIONS"!=b.name&&"TREATMENT_TYPES"!=b.name&&"REVIEWS_OF_HEALTH_PROFESSIONAL"!=b.name||a.whetherHealthProfessional)&&("SUPPORT_SERVICE_CATEGORIES"!=b.name&&"REVIEWS_OF_SUPPORT_SERVICE_PROFESSIONAL"!=b.name&&"DISEASE_VARIANTS"!=b.name||a.whetherSupportSrvcProfessional)?"MY_TRANSATIONS"!=b.name&&"MESSAGE_HISTORY"!=b.name&&"FORUMS"!=b.name||a.whetherUserLoggedIn||(c=!1):c=!1,c},a.loadMore=function(){a.isShowMore=!0,a.count=a.WSProfessionalWallInfo.wsProfessionalWallDetails.descriptiveText.length},a.showLess=function(){a.isShowMore=!1,a.count=500},a.goToMenuItem=function(c,d){c.preventDefault();var e={};/** Route for Summary and Location **/
if("SUMMARY"===d.name||"LOCATIONS"===d.name)return e.wallData={userName:a.userDetails.userName,type:"professionalwall",subType:d.name},void n(d.href,e);if("ADDRESSES"===d.name)return angular.copy(a.userDetails,e),e.navigateFrom="professionalwall",void n(d.href,e);if("CALENDAR"===d.name){var f={};return f.entityId=a.userDetails.userId,f.organizationLocationId=a.WSOrgLoc.orgLoc.data.id,f.entityTypeCode="CAL_ORGANIZATION_USER",void b.searchCalendar(f,function(a){var b={type:"regular",data:a[0]};n(d.href,b)},function(a){})}e[d.property]={id:a.userDetails[d.id]},e[d.property][d.value]=a.userDetails.userName,e.type="professionalwall",/*** Call popup to see review of either of Health Professional or Support Professional ***/
/*if (menuItem.name === 'REVIEWS') {
            reviewForPopup(ev, param);
            return;
        }*/
/*}*/
n(d.href,e)},l()}]),angular.module("paripal.professionalWallModule").service("ManageProfessionalWallService",["utilService","httpService","urlService","notify","userStatusService","$translate",function(a,b,c,d,e,f){this.getProfessionalWallMenu=function(a){b.getJsonData(c.getJsonFileUrl("PROFESSIONAL_WALL_MENU",null),function(b){b&&b.data&&a(b.data)},function(a){})},this.manageProfessionalWall=function(a,e,f,g){a.professionalId=e.professionalId,b.postData(c.getUrl("MANAGE_PROFESSIONAL_WALL"),a,function(a){d("success",a.data.successMessage),f(a)})},this.getProfWallByUserId=function(d,e){var f=d.professionalId;if(!a.isFieldEmpty(f)){var g=c.getUrl("GET_PROF_WALL_BY_PROF_ID");g+=f,b.getData(g,null,function(a){e(a.data)})}},this.searchCalendar=function(a,e,g){b.postData(c.getUrl("SEARCH_CALENDAR_BY_PROFESSIONAL"),a,function(a){a.data.length>0?e(a.data):d("warning",f.instant("CALENDAR_NOT_CONFIGURED"))},function(a){g(a)})},this.getAllOrgLocations=function(a,d){var e={};e.userId=a.userId,e.keyword=" ",b.getData(c.getParameterizedUrl("GET_PROFESSIONALS_ORG_LOCATIONS",e),null,function(a){d(a.data)},function(){})},this.getProfWallDetailsByUserId=function(a,d){var e=c.getUrl("GET_PROF_WALL_DETAILS_BY_PROF_ID");e+=a.professionalId,b.getData(e,null,function(a){d(a.data)})}}]),angular.module("paripal.reportsModule").controller("complaintClosedCtrl",["$scope","dateconvertor","reportsService","$rootScope","$state","$translate",function(a,b,c,d,e,f){a.filterCriteria={},a.filterCriteria.complaintTypeIds=[],a.filterCriteria.closureReasonIds=[],a.filterCriteria.orgLocationIds=[],a.status={open:!0},a.reportsList=[{name:"COMPLAINT_CLOSED",value:"getComplaintClosedReport"},{name:"COMPLAINT_WISE_SERVICE_LEVEL_CHART",value:"getComplaintWiseServiceLevelReport"},{name:"ALL_COMPLAINT_COUNT",value:"getAllComplaintCountReport"},{name:"STATUS_WISE_COMPLAINT_COUNT",value:"getStatusWiseComplaintCountReport"}],a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getFilteredValues=function(e,g){d.showSpinner=!0,a.filterCriteria.countFrom=b.convertToServerDate(e),a.filterCriteria.countTill=b.convertToServerDate(g);var h=angular.copy(a.filterCriteria);delete h.selectedReport,a.filterCriteria.orgLocation&&(h.orgLocation=a.filterCriteria.orgLocation.data),c[a.filterCriteria.selectedReport.value](h,function(b){if(d.showSpinner=!1,"getStatusWiseComplaintCountReport"==a.filterCriteria.selectedReport.value){var c=angular.fromJson(b);a.createData(c)}else if("getComplaintWiseServiceLevelReport"==a.filterCriteria.selectedReport.value){var e=angular.fromJson(b),g=[];e&&(angular.forEach(e,function(a){var b={groupName:a.groupName,attribute:f.instant("OUT_SIDE_SERVICE_LEVEL"),count:a.countOutsideServiceLevel};g.push(b);var c={groupName:a.groupName,attribute:f.instant("WITH_IN_SERVICE_LEVEL"),count:a.countWithinServiceLevel};g.push(c)}),a.chartData=g,a.groupBarChartCreateFunction())}else if("getAllComplaintCountReport"==a.filterCriteria.selectedReport.value)a.chartData=b,a.groupBarChartCreateFunction();else if("getComplaintClosedReport"==a.filterCriteria.selectedReport.value){var h=b;a.chartData=h,a.groupBarChartCreateFunction()}})},a.createData=function(b){a.groups=[],a.columnData=[],angular.forEach(b,function(b,c){$.inArray(b.groupName.replace(/\./g,""),a.groups)==-1&&a.groups.push(b.groupName.replace(/\./g,""))});var c=f.instant("SYSTEM_OPEN_STATUS"),d=f.instant("SYSTEM_CLOSED_STATUS"),e=f.instant("USER_OPEN_STATUS"),g=f.instant("USER_CLOSED_STATUS");a.categorieData=[c,d,e,g],a.groupData=[[c,d],[e,g]];for(var h=0;h<a.groups.length;h++){var i={};angular.forEach(b,function(b,f){a.groups[h]==b.groupName.replace(/\./g,"")&&(i[c]=b.countSysStatusOpen,i[d]=b.countSysStatusClosed,i[e]=b.countUserStatusOpen,i[g]=b.countUserStatusClosed)}),i.group=a.groups[h],a.columnData.push(i)}a.groupBarChartCreateFunction()},a.clear=function(){e.reload()},a.init=function(){a.currDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("eventWiseRatingCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$translate","serverSidePagination","datatableconfig","notify","commonConstants","utilService","$state","baseService","$timeout","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterCriteria={},a.status={open:!0},a.options={value:"getEventWiseRatingReport"},a.commonConstants=k;var q={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.dataTableConfig=i.setOptionProperties(q),a.dtColumnDefs=i.setColumnProperties({}),a.getStars=function(a){var b=parseFloat(a),c=b/10*100;return c+"%"},a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.getFilteredValues(a.isSearched)},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getFilteredValues(a.isSearched)},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.eventName={queryUrl:"SEARCH_EVENT_BY_EVENT_NAME",queryParameter:{}},a.conductedBy={queryUrl:"GET_ACCESSIBLE_ORG_LOC_LIST_KEYWORD",queryParameter:{orgId:0}},a.getPartyNameData=function(d,e){var f={};return a.userNameAutoCmpLoading=!0,f.searchKeyword=d,l.isFieldEmpty(e)?f.eventName="":f.eventName=e.value,b.getData(c.getParameterizedUrl("GET_PROFESSIONAL_FOR_EVENT_REPORT",f),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.partyNameSelected=function(b){a.professional=b},a.checkProf=function(b){l.isFieldEmpty(b)?delete a.professional:a.professional=b},a.getFilteredValues=function(){if(a.filterCriteria.eventName||a.filterCriteria.conductedBy||a.professional){var b=angular.copy(a.filterCriteria);l.isFieldEmpty(a.professional)||(b.professionalName=a.professional.displayName),/*delete $scope.filterCriteria.professional;*/
a.filterCriteria.conductedBy&&(b.conductedBy=a.filterCriteria.conductedBy.id),a.filterCriteria.eventName&&(b.eventName=a.filterCriteria.eventName.value),"getEventWiseRatingReport"!==a.options.value&&"getProfWiseRatingReport"!==a.options.value||(b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage),e[a.options.value](b,function(b){f.showSpinner=!1,"getEventRatingDistReport"==a.options.value?(a.chartData=b.data,a.groupBarChartCreateFunction()):"getProfWiseRatingReport"!=a.options.value&&"getEventWiseRatingReport"!=a.options.value||(a.WSEventList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems))})}else j(g.instant("INFO"),g.instant("PLEASE_SELECT_ONE"))},a.reportChange=function(){a.WSEventList={}},a.clear=function(){a.filterCriteria={},m.reload()},a.init=function(){},a.init()}]),angular.module("paripal.reportsModule").controller("labStatisticsReportsCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$translate","$stateParams","utilService","$state","notify","dateconvertor","$timeout","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.filterCriteria={},a.testDimension=[],a.diseaseDimension=[],a.locDimension=[],a.orgLocPermission=n.LAB_CRM_USER_TEST_REPORT_UPLOAD_VIEW,a.locId={orgId:0},a.testSmartSearchScope={},a.diseaseSmartSearchScope={},a.locSmartSearchScope={},a.chartTypeFilter="NORMAL",a.filterCriteria.whetherMonthly=!1,a.status={open:!0},a.options={value:"transactionCount"},a.chartsList=[{category:"NORMAL",name:"BAR_CHART"},{category:"NORMAL",name:"PIE_CHART"},{category:"GROUP",name:"GROUP_BAR_CHART"},{category:"GROUP",name:"STACK_BAR_CHART"}],a.setTestSmartSearchScope=function(b,c){a.testSmartSearchScope=b},a.setDiseaseSmartSearchScope=function(b,c){a.diseaseSmartSearchScope=b},a.setLocSmartSearchScope=function(b,c){a.locSmartSearchScope=b},a.selectedLocation=function(b){(a.locDimension.length>=2&&a.testDimension.length>=2||a.diseaseDimension.length>=2&&a.testDimension.length>=2||a.locDimension.length>=2&&a.diseaseDimension.length>=2)&&(b.contacts.splice(b.contacts.length-1,1),b.setData(b.contacts),k("error",g.instant("ONLY_ONE_MULTI_SELECT_SMART_SEARCH"))),a.getFilteredValues(),1==a.filterCriteria.whetherMonthly&&(a.locDimension.length>1||a.testDimension.length>1||a.diseaseDimension.length>1)?a.chartTypeFilter="GROUP":a.chartTypeFilter="NORMAL"},a.setDirectiveFn=function(b){a.chartCreateFunction=b},a.chartChanged=function(){i.isFieldEmpty(a.filterCriteria.dateFrom)||i.isFieldEmpty(a.filterCriteria.dateTill)||m(function(){a.chartCreateFunction()},0)},a.getFilteredValues=function(b,c){f.showSpinner=!0,i.isFieldEmpty(b)||(a.filterCriteria.dateFrom=l.convertToServerDate(b)),i.isFieldEmpty(c)||(a.filterCriteria.dateTill=l.convertToServerDate(c)),i.isFieldEmpty(a.testDimension)||(a.filterCriteria.testId=a.testDimension),i.isFieldEmpty(a.diseaseDimension)||(a.filterCriteria.diseaseId=a.diseaseDimension),i.isFieldEmpty(a.locDimension)||(a.filterCriteria.locationId=a.locDimension);var d=angular.copy(a.filterCriteria);delete d.selectedChart,e.getLabStatisticsReports(d,function(b){f.showSpinner=!1,a.chartData=b;for(var c=0;c<a.chartData.length;c++)null==a.chartData[c].attribute&&(a.chartData[c].attribute=g.instant("CONDUCTED_TEST"));a.chartChanged()})},a.clear=function(){j.reload()},a.init=function(){var b=new Date;a.dateTillString=l.convertToViewDate(b),a.dateFromString=l.convertToViewDate(b.setFullYear(b.getFullYear()-1)),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("locServiceTypeReportCtrl",["$scope","urlService","httpService","$rootScope","$stateParams","utilService","$state",function(a,b,c,d,e,f,g){a.filterCriteria={},a.filterCriteria.supportServiceTypeIdList=[],a.filterCriteria.orgLocationIdList=[];var h=[];a.chartData=[],a.options={selectedReport:"GET_MONTH_SUPP_SERVC_TYPE_TRANS_COUNT",reportForUserCount:"trans_count",reportForFeeStats:"service_provider"},a.serviceTypes=[],a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.reportSelected=function(b){a.chartData=[]},a.reportsList=[{id:"GET_MONTH_SUPP_SERVC_TYPE_TRANS_COUNT",value:"MONTHLY_TRANS_COUNT"},{id:"GET_SUPP_SERVC_TYPE_USER_COUNT",value:"USER_COUNT"},{id:"GET_SUPP_SERVC_TYPE_USER_COUNT_FOR_PERIOD",value:"USER_COUNT_FOR_PERIOD"},{id:"GET_USER_TRANS_COUNT_BY_ORG_LOC_AND_SUPP_SERVC_TYPE",value:"USER_TRANS_COUNT_BY_ORG_LOC"},{id:"GET_USER_TRANS_COUNT_BY_SUPP_SERVC_TYPE",value:"USER_TRANS_COUNT"},{id:"GET_ORG_LOC_SERVICE_TYPE_FEE_STATISTICS",value:"FEE_STATISTICS"}],a.getServiceTypeList=function(){var d={};a.filterCriteria.supportServiceTypeIdList=[],d.whetherSupportRelated=!0,d.orgLocIds=angular.copy(a.filterCriteria.orgLocationIdList),c.postData(b.getUrl("GET_SUPPORT_SRVC_TYPE_AND_TRANS_TYPE"),d,function(b){a.serviceTypeList=angular.copy(b.data)},function(a){})},a.getFilteredValues=function(){d.showSpinner=!0;var e={};angular.copy(a.filterCriteria,e),f.isFieldEmpty(e.currencyId)||f.isFieldEmpty(e.currencyId.dataValue)||(e.currencyId=e.currencyId.dataValue.id),"GET_ORG_LOC_SERVICE_TYPE_FEE_STATISTICS"!=a.options.selectedReport&&delete e.currencyId,c.postData(b.getUrl(a.options.selectedReport),e,function(b){d.showSpinner=!1,angular.copy(b.data,h),a.populateChart()},function(a){d.showSpinner=!1})},a.populateChart=function(){if(angular.copy(h,a.chartData),"GET_ORG_LOC_SERVICE_TYPE_FEE_STATISTICS"===a.options.selectedReport)for(var b=0;b<a.chartData.length;b++)"system"==a.options.reportForFeeStats?a.chartData[b].count=h[b].sysCount:"service_provider"==a.options.reportForFeeStats&&(a.chartData[b].count=h[b].servProvcount);a.groupBarChartCreateFunction()},a.clear=function(){g.reload()},a.init=function(){if(f.isNullOrEmpty(e.orgLocation)||(a.defaultLoc=[],a.defaultLoc.push(e.orgLocation)),f.isNullOrEmpty(e.serviceType)||(a.defaultTreatments=[],a.defaultTreatments.push(e.serviceType)),e.data){var b=[];b.push(e.data),a.stateParamTreatment=b}a.getServiceTypeList(),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("locTransactionTypeReportCtrl",["$scope","urlService","httpService","$rootScope","$stateParams","utilService","$state",function(a,b,c,d,e,f,g){a.filterCriteria={},a.filterCriteria.transactionTypeIdList=[],a.filterCriteria.orgLocationIdList=[];var h=[];a.chartData=[],a.options={selectedReport:"GET_MONTH_TRANSACTION_TYPE_TRANS_COUNT",reportFor:"trans_count",reportForFeeStats:"service_provider"},a.transactionTypes=[],a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.reportSelected=function(){a.chartData=[]},a.reportsList=[{id:"GET_MONTH_TRANSACTION_TYPE_TRANS_COUNT",name:"MONTHLY_TRANS_COUNT"},{id:"GET_TRANSACTION_TYPE_USER_COUNT",name:"USER_COUNT"},{id:"GET_TRANSACTION_TYPE_USER_COUNT_FOR_PERIOD",name:"USER_COUNT_FOR_PERIOD"},{id:"GET_USER_TRANS_COUNT_BY_ORG_LOC_AND_TRANS_TYPE",name:"USER_TRANS_COUNT_BY_ORG_LOC"},{id:"GET_USER_TRANS_COUNT_BY_TRANS_TYPE",name:"USER_TRANS_COUNT"},{id:"GET_ORG_LOC_TRANSACTION_TYPE_FEE_STATISTICS",name:"FEE_STATISTICS"}];var i=function(){var d={};d.type="transactionType",c.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",d),null,function(b){a.transactionTypes=angular.copy(b.data)},function(a){})};a.getFilteredValues=function(){d.showSpinner=!0;var e={};angular.copy(a.filterCriteria,e),f.isFieldEmpty(e.currencyId)||(e.currencyId=e.currencyId.id),c.postData(b.getUrl(a.options.selectedReport),e,function(b){d.showSpinner=!1,angular.copy(b.data,h),a.populateChart()},function(a){})},a.populateChart=function(){if(angular.copy(h,a.chartData),"GET_ORG_LOC_TRANSACTION_TYPE_FEE_STATISTICS"===a.options.selectedReport)for(var b=0;b<a.chartData.length;b++)"system"==a.options.reportForFeeStats?a.chartData[b].count=h[b].sysCount:"service_provider"==a.options.reportForFeeStats&&(a.chartData[b].count=h[b].servProvcount);a.groupBarChartCreateFunction()},a.clear=function(){g.reload()},a.init=function(){if(f.isNullOrEmpty(e.orgLocation)||(a.defaultLoc=[],a.defaultLoc.push(e.orgLocation)),f.isNullOrEmpty(e.transactionType)||(a.defaultTreatments=[],a.defaultTreatments.push(e.transactionType)),e.data){var b=[];b.push(e.data),a.stateParamTreatment=b}i(),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("locTreatTypeMonthlyClientCountChartCtrl",["$scope","$http","reportsService","$rootScope","$stateParams","utilService","$state","httpService","urlService",function(a,b,c,d,e,f,g,h,i){a.filterCriteria={},a.filterCriteria.treatmentTypeIdList=[],a.filterCriteria.orgLocationIdList=[],a.filterCriteria.reportForFeeStats="service_provider";var j=[];a.treatmentTypes=[],a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.reportSelected=function(b){a.selectedReportName=b.name,a.chartData=[]},a.reportsList=[{name:"MONTHLY_CLIENT_COUNT",value:"getLocTreatTypeMonthlyClientCountReport"},{name:"MONTHLY_TRANS_COUNT",value:"getLocTreatTypeMonthlyTransCountReport"},{name:"LOC_TREAT_CLIENT_BY_LOC",value:"getLocTreatTypeTransCountByOrgLocReport"},{name:"LOC_TREAT_TRANS_BY_LOC",value:"getLocTreatTypeTransCountByOrgLocReport"},{name:"OVERALL_TRANS_COUNT",value:"getTreatmentTypeUserCountForPeriod"},{name:"FEE_STATISTICS",value:"getTreatmentTypeFeeStats"}],a.getFilteredValues=function(){d.showSpinner=!0;var b=angular.copy(a.filterCriteria);delete b.selectedReport,/*delete requestData.reportFor;*/
delete b.reportForFeeStats,f.isFieldEmpty(b.currencyId)||"FEE_STATISTICS"!==a.filterCriteria.selectedReport.name||(b.currencyId=b.currencyId.dataValue.id),c[a.filterCriteria.selectedReport.value](b,function(b){d.showSpinner=!1,angular.copy(b,j),a.populateChart()})},a.populateChart=function(){if(angular.copy(j,a.chartData),"FEE_STATISTICS"===a.filterCriteria.selectedReport.name)for(var b=0;b<a.chartData.length;b++)"system"==a.filterCriteria.reportForFeeStats?a.chartData[b].count=j[b].sysCount:"service_provider"==a.filterCriteria.reportForFeeStats&&(a.chartData[b].count=j[b].servProvcount);a.groupBarChartCreateFunction()},a.clear=function(){g.reload()},a.validateCondition=function(){return("LOC_TREAT_CLIENT_BY_LOC"==a.selectedReportName||"LOC_TREAT_TRANS_BY_LOC"==a.selectedReportName||"OVERALL_TRANS_COUNT"==a.selectedReportName)&&0==a.filterCriteria.treatmentTypeIdList.length&&0==a.filterCriteria.orgLocationIdList.length},a.getTreatmentTypeList=function(){if(f.isFieldEmpty(a.filterCriteria.orgLocationIdList))a.treatTypeList=[],a.filterCriteria.treatmentTypeIdList=[];else{var b={};a.filterCriteria.treatmentTypeIdList=[],b.whetherSupportRelated=!1,b.orgLocIds=angular.copy(a.filterCriteria.orgLocationIdList),h.postData(i.getUrl("GET_SUPPORT_SRVC_TYPE_AND_TRANS_TYPE"),b,function(b){a.treatTypeList=angular.copy(b.data)},function(a){})}},a.init=function(){if(a.selectedReportName="MONTHLY_CLIENT_COUNT",f.isNullOrEmpty(e.orgLocation)||(a.defaultLoc=[],a.defaultLoc.push(e.orgLocation)),f.isNullOrEmpty(e.treatmentType)||(a.defaultTreatments=[],a.defaultTreatments.push(e.treatmentType)),e.data){var b=[];b.push(e.data),a.stateParamTreatment=b}if(e.wallData){var c=[];c.push(e.wallData.orglocation),a.stateParamOrganization=c,e.wallData.reportType&&(a.selectedReportName=e.wallData.reportType)}a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("monthlyClientCountForProfTreatmentTypeChartCtrl",["$scope","commonConstants","httpService","urlService","utilService","dateconvertor","$state","featurePrivilegeConstants","userStatusService","$filter","$http","reportsService","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.filterCriteria={},a.filterCriteria.treatmentTypeIdList=[],a.commonConstants=b,a.yearList=[],a.treatmentTypes=[],a.testUrl="GET_TREATMENT_TYPES",a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getPartyNameData=function(b){return a.requestData={},a.userNameAutoCmpLoading=!0,a.requestData.searchKeyword=b,c.getData(d.getUrl("FIND_PROFESSIONAL_FOR_ACT_SMT"),a.requestData,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1},{orgLocPermission:h.ACC_STMT_VIEW})},a.partyNameSelected=function(b){a.filterCriteria.professional=b.id},a.getFilteredValues=function(){m.showSpinner=!0,null!=a.filterCriteria.monthFromNo&&null!=a.filterCriteria.monthTillNo&&(a.filterCriteria.monthFromNo=a.filterCriteria.monthFromNo.id,a.filterCriteria.monthTillNo=a.filterCriteria.monthTillNo.id);var b=angular.copy(a.filterCriteria);a.filterCriteria.treatmentTypeIdList=a.treatmentTypes,l.getMonthlyClientCountForProfTreatmentTypeReport(b,function(b){a.chartData=b,a.groupBarChartCreateFunction(),m.showSpinner=!1},function(a){m.showSpinner=!1})},a.clear=function(){a.filterCriteria={}},a.init=function(){k.get("app/jsonResponse/common/year.json").then(function(b){a.yearList=b.data})},a.init()}]),angular.module("paripal.reportsModule").controller("monthlyFailedMsgCountCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$stateParams","utilService","dateconvertor","$translate","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.filterCriteria={},a.category={},a.subCategory={},a.orgLocationId={},a.chartData={},a.filterCriteria.subCatIds=[],a.disableCategory=!0,a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.onLocationChanged=function(d){a.categoryDisabled=!1;var e={};d&&(e.organizationLocationId=d.data.id,b.getData(c.getParameterizedUrl("FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",e),null,function(b){a.categoryList=angular.fromJson(b.data)},function(a){}))},a.getUserData=function(d){a.userNameAutoCmp=!0;var e={},f=[];return e.userName=d,b.getData(c.getParameterizedUrl("GET_ALL_USERS",e),null,function(b){return a.userNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.onRecipientSelect=function(b){/*$scope.recipientValue = item.displayName;*/
a.recipient={},a.recipient=b},a.onSenderSelect=function(b){a.filterCriteria.senderId=b.id},a.getFilteredValues=function(){f.showSpinner=!0;var d=angular.copy(a.filterCriteria);d.dateFrom=i.convertToServerDate(a.filterCriteria.dateFrom),d.dateTill=i.convertToServerDate(a.filterCriteria.dateTill),h.isEmpty(a.filterCriteria.orgLocationId)?delete d.orgLocationId:d.orgLocationId=a.filterCriteria.orgLocationId.data.id,h.isEmpty(a.categoryId)||(d.messageTypeId=a.categoryId.id),h.isEmpty(a.recipient)||(d.recipientId=a.recipient.id),h.isEmpty(a.filterCriteria.subCatIds)||(d.messageSubTypeIds=a.filterCriteria.subCatIds),delete d.subCatIds,/*if (!utilService.isNullOrEmpty(requestData.orgLocationId)) {
    delete requestData.orgLocationId;
}*/
b.postData(c.getUrl("GET_MONTHLY_FAILED_MSG_COUNT"),d,function(b){f.showSpinner=!1;var c=angular.fromJson(b.data);a.createData(c)},function(a){f.showSpinner=!1})},a.createData=function(b){var c=[],d=[],e=j.instant("MSG_COUNT"),f=[e];angular.forEach(b,function(a,b){var f={};f.group=a.groupName,f[e]=a.eventCount,d.push(f),c.push(a.groupName)}),a.chartData.columnData=d,a.chartData.categorieData=f,a.chartData.groups=c,a.groupBarChartCreateFunction()},a.clear=function(){k.reload()},a.categorySelected=function(b){a.categoryId={},a.categoryId.id=b},a.init=function(){a.categoryDisabled=!0,h.isNullOrEmpty(g.professional)||(a.partyName=g.professional,a.filterCriteria.professional=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("monthlyMsgRcpntCountCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$stateParams","utilService","dateconvertor","$translate","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.filterCriteria={},a.category={},a.subCategory={},a.orgLocationId={},a.chartData={},a.filterCriteria.subCatIds=[],a.status={open:!0},a.messageStatsList=[{name:"MONTHLY_MSG_RCPNT_COUNT",value:"GET_MONTHLY_MSG_RCPNT_COUNT"},{name:"MONTHLY_FAILED_MSG_COUNT",value:"GET_MONTHLY_FAILED_MSG_COUNT"},{name:"MESSAGE_SUBTYPE_REPORT",value:"GET_MSG_SUBTYPE_COUNT"}],a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.onLocationChanged=function(d){a.categoryDisabled=!1;var e={};h.isFieldEmpty(d)||h.isFieldEmpty(d.data)||(e.organizationLocationId=d.data.id,b.getData(c.getParameterizedUrl("FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",e),null,function(b){a.categoryList=angular.fromJson(b.data)},function(a){}))},a.getUserData=function(d){a.userNameAutoCmp=!0;var e={},f=[];return e.userName=d,b.getData(c.getParameterizedUrl("GET_ALL_USERS",e),null,function(b){return a.userNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.onRecipientSelect=function(b){a.filterCriteria.recipientId=b.id},a.onSenderSelect=function(b){a.filterCriteria.senderId=b.id},a.statSelected=function(b){a.selectedMessageStat=b},a.getFilteredValues=function(){f.showSpinner=!0;var d=angular.copy(a.filterCriteria);d.dateFrom=i.convertToServerDate(a.filterCriteria.dateFrom),d.dateTill=i.convertToServerDate(a.filterCriteria.dateTill),h.isEmpty(a.filterCriteria.orgLocationId)?delete d.orgLocationId:d.orgLocationId=a.filterCriteria.orgLocationId.data.id,h.isEmpty(a.categoryId)||(d.messageTypeId=a.categoryId.id),h.isEmpty(a.filterCriteria.subCatIds)||(d.messageSubTypeIds=a.filterCriteria.subCatIds),delete d.subCatIds,/*if (!utilService.isNullOrEmpty(requestData.orgLocationId)) {
    delete requestData.orgLocationId;
}*/
b.postData(c.getUrl(a.selectedMessageStat),d,function(b){f.showSpinner=!1;var c=angular.fromJson(b.data);"GET_MONTHLY_FAILED_MSG_COUNT"==a.selectedMessageStat?a.createDataForMsgFailure(c):a.createData(c)},function(a){f.showSpinner=!1})},a.createData=function(b){var c=[],d=[],e=j.instant("EVENT_COUNT"),f=j.instant("RECIPIENT_COUNT"),g=[e,f];angular.forEach(b,function(a,b){var g={};g.group=a.groupName,g[e]=a.eventCount,g[f]=a.recpntCount,d.push(g),c.push(a.groupName)}),a.chartData.columnData=d,a.chartData.categorieData=g,a.chartData.groups=c,a.groupBarChartCreateFunction()},a.createDataForMsgFailure=function(b){var c=[],d=[],e=j.instant("MSG_COUNT"),f=[e];angular.forEach(b,function(a,b){var f={};f.group=a.groupName,f[e]=a.eventCount,d.push(f),c.push(a.groupName)}),a.chartData.columnData=d,a.chartData.categorieData=f,a.chartData.groups=c,a.groupBarChartCreateFunction()},a.clear=function(){k.reload()},a.categorySelected=function(b){a.categoryId={},a.categoryId.id=b},a.init=function(){a.categoryDisabled=!0,h.isNullOrEmpty(g.professional)||(a.partyName=g.professional,a.filterCriteria.professional=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("monthlyProfTreatmentTransChartCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$translate","$stateParams","utilService","$state",function(a,b,c,d,e,f,g,h,i,j){a.filterCriteria={},a.treatmentTypes=[],a.status={open:!0},a.options={value:"transactionCount"},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getPartyNameData=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.name=d,b.getData(c.getParameterizedUrl("GET_ACCESSIBLE_PROFESSIONALS",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.partyNameSelected=function(b){a.filterCriteria.professional=b.id},a.getFilteredValues=function(){f.showSpinner=!0;var b=angular.copy(a.filterCriteria);a.filterCriteria.treatmentTypeIdList=a.treatmentTypes,"transactionCount"===a.options.value?e.getMonthlyProfTreatmentTransReport(b,function(b){f.showSpinner=!1,a.chartData=b,a.groupBarChartCreateFunction()}):"clientCount"===a.options.value?e.getMonthlyClientCountForProfTreatmentTypeReport(b,function(b){f.showSpinner=!1,a.chartData=b,a.groupBarChartCreateFunction()}):"transCountByDiseaseVar"===a.options.value&&e.getTransCountOfTreatmentTypeByDisVarReport(b,function(b){f.showSpinner=!1,a.chartData=b,a.groupBarChartCreateFunction()})},a.clear=function(){j.reload()},a.init=function(){i.isNullOrEmpty(h.professional)||(a.partyName=h.professional,a.filterCriteria.professional=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("monthlyUserCountByDisVarForDiseaseChartCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$stateParams","utilService","$state",function(a,b,c,d,e,f,g,h,i){a.filterCriteria={},a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getDiseases=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.keyword=d,b.getData(c.getParameterizedUrl("GET_DISEASES",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.diseaseSelected=function(b){a.filterCriteria.disease=b},a.getPartyNameData=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.name=d,b.getData(c.getParameterizedUrl("GET_ACCESSIBLE_PROFESSIONALS",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.partyNameSelected=function(b){a.filterCriteria.professional=b.id},a.getFilteredValues=function(){f.showSpinner=!0;var b=angular.copy(a.filterCriteria);e.getMonthlyUserCountByDisVarForDiseaseReport(b,function(b){f.showSpinner=!1,a.chartData=b,a.groupBarChartCreateFunction()})},a.clear=function(){i.reload()},a.init=function(){h.isNullOrEmpty(g.professional)||(a.partyName=g.professional,a.filterCriteria.professional=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("monthlyUserCountByDiseaseForProfChartCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$stateParams","utilService","$state",function(a,b,c,d,e,f,g,h,i){a.filterCriteria={},a.diseases=[],a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getPartyNameData=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.name=d,b.getData(c.getParameterizedUrl("GET_ACCESSIBLE_PROFESSIONALS",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.partyNameSelected=function(b){a.filterCriteria.professional=b.id},a.getFilteredValues=function(){f.showSpinner=!0,null!=a.diseases&&(a.filterCriteria.diseaseList=a.diseases);var b=angular.copy(a.filterCriteria);e.getMonthlyUserCountByDiseaseForProfReport(b,function(b){f.showSpinner=!1,a.chartData=b,a.groupBarChartCreateFunction()})},a.clear=function(){i.reload()},a.init=function(){h.isNullOrEmpty(g.professional)||(a.partyName=g.professional,a.filterCriteria.professional=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("msgSubtypeWiseReportCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$stateParams","utilService","dateconvertor","$translate","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.filterCriteria={},a.category={},a.subCategory={},a.orgLocationId={},a.chartData={},a.filterCriteria.subCatIds=[],a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.onLocationChanged=function(d){a.categoryDisabled=!1;var e={};d&&(e.organizationLocationId=d.data.id,b.getData(c.getParameterizedUrl("FIND_MSG_CATEGORY_BY_ORG_LOCATION_ID",e),null,function(b){a.categoryList=angular.fromJson(b.data)},function(a){}))},a.getUserData=function(d){a.userNameAutoCmp=!0;var e={},f=[];return e.userName=d,b.getData(c.getParameterizedUrl("GET_ALL_USERS",e),null,function(b){return a.userNameAutoCmp=!1,f=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.onRecipientSelect=function(b){a.filterCriteria.recipientId=b.id},a.onSenderSelect=function(b){a.filterCriteria.senderId=b.id},a.getFilteredValues=function(){f.showSpinner=!0;var d=angular.copy(a.filterCriteria);d.dateFrom=i.convertToServerDate(a.filterCriteria.dateFrom),d.dateTill=i.convertToServerDate(a.filterCriteria.dateTill),h.isEmpty(a.filterCriteria.orgLocationId)?delete d.orgLocationId:d.orgLocationId=a.filterCriteria.orgLocationId.data.id,h.isEmpty(a.categoryId)||(d.messageTypeId=a.categoryId.id),h.isEmpty(a.filterCriteria.subCatIds)||(d.messageSubTypeIds=a.filterCriteria.subCatIds),delete d.subCatIds,/*if (!utilService.isNullOrEmpty(requestData.orgLocationId)) {
    delete requestData.orgLocationId;
}*/
b.postData(c.getUrl("GET_MSG_SUBTYPE_COUNT"),d,function(b){f.showSpinner=!1;var c=angular.fromJson(b.data);a.createData(c)},function(a){f.showSpinner=!1})},a.createData=function(b){var c=[],d=[],e=j.instant("EVENT_COUNT"),f=j.instant("RECIPIENT_COUNT"),g=[e,f];angular.forEach(b,function(a,b){var g={};g.group=a.groupName,g[e]=a.eventCount,g[f]=a.recpntCount,d.push(g),c.push(a.groupName)}),a.chartData.columnData=d,a.chartData.categorieData=g,a.chartData.groups=c,a.groupBarChartCreateFunction()},a.clear=function(){k.reload()},a.categorySelected=function(b){a.categoryId={},a.categoryId.id=b},a.init=function(){a.categoryDisabled=!0,h.isNullOrEmpty(g.professional)||(a.partyName=g.professional,a.filterCriteria.professional=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("orgLocServiceTypeFeeStatisticsCtrl",["$scope","$http","reportsService","$rootScope","$stateParams","utilService","httpService","urlService","$translate","$timeout","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.filterCriteria={},a.filterCriteria.serviceTypeIdList=[],a.filterCriteria.orgLocationIdList=[],a.data={option:"system"};var l;a.treatmentTypes=[],a.currency={queryUrl:"GET_CURRENCYLIST_DATA",queryParameter:{},jsonParameter:{}},a.status={open:!0},a.loadAllServiceGroup=function(){return g.getData(h.getParameterizedUrl("FIND_ALL_SERVICE_GROUP",null),null,function(b){if(b&&b.data){for(var c=[],d=0;d<b.data.length;d++)c.push({id:b.data[d],value:i.instant(b.data[d])});return a.wsServiceGroup=c,a.wsServiceGroup}},function(a){},a.orgLocPermissionVal)},a.onSelectServiceGroupChanged=function(){a.postParams={},f.isFieldEmpty(a.filterCriteria.serviceGroupData)||(a.postParams.serviceGroup=a.filterCriteria.serviceGroupData.id,a.postParams.locationIds=a.filterCriteria.orgLocationIdList,j(function(){l.getListOnLoadFunction()},0))},a.setDirectiveFn=function(b){a.barChartCreateFunction=b},a.getFilteredValues=function(){d.showSpinner=!0;var b={};angular.copy(a.filterCriteria,b),f.isFieldEmpty(b.currencyId)||(b.currencyId=b.currencyId.id),delete b.serviceGroupData,g.postData(h.getUrl("GET_ORG_LOC_SERVICE_TYPE_FEE_STATISTICS"),b,function(b){a.chartData=b.data;for(var c=0;c<a.chartData.length;c++)"system"==a.data.option?a.chartData[c].count=b.data[c].sysCount:"service_provider"==a.data.option&&(a.chartData[c].count=b.data[c].servProvcount);d.showSpinner=!1,a.barChartCreateFunction()},function(a){d.showSpinner=!1})},a.clear=function(){k.reload()},a.init=function(){if(f.isNullOrEmpty(e.orgLocation)||(a.defaultLoc=[],a.defaultLoc.push(e.orgLocation)),f.isNullOrEmpty(e.treatmentType)||(a.defaultTreatments=[],a.defaultTreatments.push(e.treatmentType)),e.data){var b=[];b.push(e.data),a.stateParamTreatment=b}a.loadAllServiceGroup()},a.currentDate=new Date,a.getDirectiveScope=function(a){l=a},a.init()}]),angular.module("paripal.reportsModule").controller("orgLocTransactionTypeFeeStatisticsCtrl",["$scope","$http","reportsService","$rootScope","$stateParams","utilService","httpService","urlService","$state",function(a,b,c,d,e,f,g,h,i){a.filterCriteria={},a.filterCriteria.transactionTypeIdList=[],a.filterCriteria.orgLocationIdList=[],a.data={option:"system"},a.currency={queryUrl:"GET_CURRENCYLIST_DATA",queryParameter:{},jsonParameter:{}},a.treatmentTypes=[],a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getFilteredValues=function(){d.showSpinner=!0;var b={};angular.copy(a.filterCriteria,b),f.isFieldEmpty(b.currencyId)||(b.currencyId=b.currencyId.id),g.postData(h.getUrl("GET_ORG_LOC_TRANSACTION_TYPE_FEE_STATISTICS"),b,function(b){a.chartData=b.data;for(var c=0;c<a.chartData.length;c++)"system"==a.data.option?a.chartData[c].count=b.data[c].sysCount:"service_provider"==a.data.option&&(a.chartData[c].count=b.data[c].servProvcount);d.showSpinner=!1,a.groupBarChartCreateFunction()},function(a){d.showSpinner=!1})},a.clear=function(){i.reload()},a.init=function(){if(f.isNullOrEmpty(e.orgLocation)||(a.defaultLoc=[],a.defaultLoc.push(e.orgLocation)),f.isNullOrEmpty(e.treatmentType)||(a.defaultTreatments=[],a.defaultTreatments.push(e.treatmentType)),e.data){var b=[];b.push(e.data),a.stateParamTreatment=b}a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("orgLocTreatmentTypeFeeStatisticsCtrl",["$scope","$http","reportsService","$rootScope","$stateParams","utilService","httpService","urlService","notify","$translate","$state",function(a,b,c,d,e,f,g,h,i,j,k){a.filterCriteria={},a.filterCriteria.treatmentTypeIdList=[],a.filterCriteria.orgLocationIdList=[],a.data={option:"system"},a.treatmentTypes=[],a.currency={queryUrl:"GET_CURRENCYLIST_DATA",queryParameter:{},jsonParameter:{}},a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getFilteredValues=function(){if(f.isFieldEmpty(a.filterCriteria.orgLocationIdList)&&f.isFieldEmpty(a.filterCriteria.treatmentTypeIdList))i("warning",j.instant("PLEASE_SELECT_EITHER_ORGLOC_OR_TREAT_TYPES"));else{d.showSpinner=!0;var b={};angular.copy(a.filterCriteria,b),f.isFieldEmpty(b.currencyId)||(b.currencyId=b.currencyId.id),g.postData(h.getUrl("GET_ORG_LOC_TREATMENT_TYPE_FEE_STATISTICS"),b,function(b){a.chartData=b.data;for(var c=0;c<a.chartData.length;c++)"system"==a.data.option?a.chartData[c].count=b.data[c].sysCount:"service_provider"==a.data.option&&(a.chartData[c].count=b.data[c].servProvcount);d.showSpinner=!1,a.groupBarChartCreateFunction()},function(a){d.showSpinner=!1})}},a.clear=function(){k.reload()},a.init=function(){if(f.isNullOrEmpty(e.orgLocation)||(a.defaultLoc=[],a.defaultLoc.push(e.orgLocation)),f.isNullOrEmpty(e.treatmentType)||(a.defaultTreatments=[],a.defaultTreatments.push(e.treatmentType)),e.data){var b=[];b.push(e.data),a.stateParamTreatment=b}a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("orgReviewReportCtrl",["$scope","$http","reportsService","$rootScope","$stateParams","utilService","httpService","urlService","$state","$translate",function(a,b,c,d,e,f,g,h,i,j){function k(b){var c={},d=[];if("GET_MONTHLY_AVG_RATING_FOR_ORG"===a.options.value||"GET_DIS_VAR_WISE_AVG_RATING_FOR_ORG"===a.options.value||"GET_TREATMENT_WISE_AVG_RATING_FOR_ORG"===a.options.value){var e=j.instant("CARE"),f=j.instant("TREATEMENT"),g=j.instant("PROCESS"),h=j.instant("INFO");c.categorieData=[e,f,g,h],angular.forEach(b,function(a){d.push(a.groupName),a.group=a.groupName,delete a.groupName,a[e]=a.avgCareRating,delete a.avgCareRating,a[f]=a.avgTreatmentRating,delete a.avgTreatmentRating,a[g]=a.avgProcessRating,delete a.avgProcessRating,a[h]=a.avgInfoRating,delete a.avgInfoRating}),c.groups=d,c.columnData=b,a.chartData=c}else if("GET_MONTHLY_AVG_RATING_COUNT_FOR_ORG"===a.options.value||"GET_DIS_VAR_WISE_REVIEW_COUNT_FOR_ORG"===a.options.value||"GET_TREATMENT_WISE_REVIEW_COUNT_FOR_ORG"===a.options.value){a.groups=[],a.columnData=[];var i=j.instant("CARE_POSITIVE_COUNT"),k=j.instant("CARE_NEGATIVE_COUNT"),l=j.instant("TREATMENT_POSITIVE_COUNT"),m=j.instant("TREATMENT_NEGATIVE_COUNT"),n=j.instant("INFO_POSITIVE_COUNT"),o=j.instant("INFO_NEGATIVE_COUNT"),p=j.instant("PROCESS_POSITIVE_COUNT"),q=j.instant("PROCESS_NEGATIVE_COUNT");a.categorieData=[i,k,l,m,n,o,p,q],a.groupData=[[i,k],[l,m],[n,o],[p,q]],angular.forEach(b,function(b,c){var d={};d.group=b.groupName,d[i]=b.carePositiveCount,d[k]=b.careNegativeCount,d[l]=b.treatmentPositiveCount,d[m]=b.treatmentNegativeCount,d[n]=b.infoPositiveCount,d[o]=b.infoNegativeCount,d[p]=b.processPositiveCount,d[q]=b.processNegativeCount,a.columnData.push(d),a.groups.push(b.groupName)})}else if("GET_RATING_WISE_USER_COUNT_FOR_ORG"===a.options.value){c=[];var r=j.instant("CARE"),s=j.instant("TREATEMENT"),t=j.instant("INFO"),u=j.instant("PROCESS");angular.forEach(b,function(a,b){d.push(b);var e={group:b};e[r]=a.careUserCount,e[s]=a.treatmentUserCount,e[t]=a.infoUserCount,e[u]=a.processUserCount,c.push(e)}),a.chartData={},a.chartData.categorieData=[r,s,t,u],a.chartData.groups=d,a.chartData.columnData=angular.copy(c),c={}}else a.chartData=b;/*
                if (!utilService.isFieldEmpty(chartData)) {
                    $scope.chartData = chartData;
                }*/
a.groupBarChartCreateFunction()}a.filterCriteria={},a.rangeSlider={},a.filterCriteria={includeNegativeRating:!1},a.filterCriteria.diseaseVariantIds=[],a.filterCriteria.ratingMinValue=0,a.filterCriteria.ratingMaxValue=10,a.chartLabel={xaxis:"MONTH",yaxis:"AVG_RATING"};var l={GET_MONTHLY_AVG_RATING_FOR_ORG:{xaxis:"MONTH",yaxis:"AVG_RATING"},GET_MONTHLY_AVG_RATING_COUNT_FOR_ORG:{xaxis:"MONTH",yaxis:"AVG_RATING"},GET_RATING_WISE_USER_COUNT_FOR_ORG:{xaxis:"RATING",yaxis:"USER_COUNT"},GET_DIS_VAR_WISE_AVG_RATING_FOR_ORG:{xaxis:"DISEASE_VARIANT",yaxis:"AVG_RATING"},GET_DIS_VAR_WISE_REVIEW_COUNT_FOR_ORG:{xaxis:"DISEASE_VARIANT",yaxis:"USER_COUNT"},GET_TREATMENT_WISE_AVG_RATING_FOR_ORG:{xaxis:"TREATMENT_TYPE",yaxis:"AVG_RATING"},GET_TREATMENT_WISE_REVIEW_COUNT_FOR_ORG:{xaxis:"TREATMENT_TYPE",yaxis:"USER_COUNT"}};a.data={option:"system"},a.options={value:"GET_MONTHLY_AVG_RATING_FOR_ORG"},a.chartTypes=[{id:"GET_MONTHLY_AVG_RATING_FOR_ORG",/*group-bar | x-axis = month | y-axis = avg rating | per bar = parameters*/
value:"ORGANIZATION_AVG_RATING"},{id:"GET_MONTHLY_AVG_RATING_COUNT_FOR_ORG",/*group-stack-bar | x-axis = months | y-axis=review count | per bar = parameters | stack = pos-neg*/
value:"ORGANIZATION_POSITIVE_NEGATIVE_FEEDBACK_RATING"},{id:"GET_RATING_WISE_USER_COUNT_FOR_ORG",/*group-bar | x-axis = rating scale | y-axis = no of users | per bar = parameter*/
value:"NO_OF_USERS_IN_EACH_RATING_SCALE"},{id:"GET_DIS_VAR_WISE_AVG_RATING_FOR_ORG",/*group-bar | x-axis = dis var names | y-axis = avg rating | per bar = parameter*/
value:"DIS_VARWISE_AVG_RATING"},{id:"GET_DIS_VAR_WISE_REVIEW_COUNT_FOR_ORG",/*group-bar | x-axis = dis var name | y-axis = no of users | per bar = params*/
value:"DIS_VARWISE_USER_COUNT"},{id:"GET_TREATMENT_WISE_AVG_RATING_FOR_ORG",/*group-bar | x-axis = treatment names | y-axis = avg rating | per bar = params*/
value:"TREATMENT_TYPE_WISE_AVG_RATING"},{id:"GET_TREATMENT_WISE_REVIEW_COUNT_FOR_ORG",/*group-bar | x-axis = treatment name | y-axis = no of users | per bar = params*/
value:"TREATMENT_TYPE_WISE_REVIEW_COUNT"}],a.organizationLocation={queryUrl:"FIND_SUBSCRIBER_LOCATION",queryParameter:{whetherSubscriber:!0}},a.treatmentType={queryUrl:"GET_TREATMENT_TYPES",queryParameter:{},jsonParameter:{}},a.status={open:!0},a.getDiseaseNameData=function(b){var c={};return a.userNameAutoCmpLoading=!0,c.keyword=b,g.getData(h.getParameterizedUrl("GET_DISEASES",c),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.diseaseNameSelected=function(b){var c={};c.diseaseId=b.id,g.getData(h.getParameterizedUrl("GET_VARIANT_BY_DISEASE_ID",c),null,function(b){a.userNameAutoCmpLoading=!1,a.disVariantData=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.changeChartLabels=function(b){a.chartData=[],a.categorieData=[],a.columnData=[],a.chartLabel=l[b]},a.getFilteredValues=function(){d.showSpinner=!0;var b={};angular.copy(a.filterCriteria,b),f.isFieldEmpty(b.orgLocId)||(b.orgLocId=b.orgLocId.id),f.isFieldEmpty(b.treatementTypeId)||(b.treatementTypeId=b.treatementTypeId.id),/*if ($scope.options.value === 'GET_RATING_WISE_USER_COUNT_FOR_ORG') {
            requestData.includeNegativeRating = $scope.filterCriteria.includeNegativeRating;
        }*/
g.postData(h.getUrl(a.options.value),b,function(a){d.showSpinner=!1,k(a.data)},function(a){d.showSpinner=!1})},a.clear=function(){i.reload()},a.init=function(){if(f.isNullOrEmpty(e.orgLocation)||(a.defaultLoc=[],a.defaultLoc.push(e.orgLocation)),f.isNullOrEmpty(e.treatmentType)||(a.defaultTreatments=[],a.defaultTreatments.push(e.treatmentType)),f.isFieldEmpty(e.wallData)||f.isFieldEmpty(e.wallData.orglocation)||(a.filterCriteria.orgLocId=e.wallData.orglocation),e.data){var b=[];b.push(e.data),a.stateParamTreatment=b}a.rangeSlider.minValue=0,a.rangeSlider.maxValue=10,/*loadParams();*/
a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("packagewiseUserCountCtrl",["$scope","httpService","urlService","$rootScope","$stateParams","utilService","dateconvertor","$translate","$timeout","$state",function(a,b,c,d,e,f,g,h,i,j){a.filterCriteria={},a.filterCriteria.orgLocationId=[],a.filterCriteria.purposeId=[],a.filterCriteria.packageTypeId=[],a.filterCriteria.packageId=[],a.options={value:"GET_PACKAGE_USER_COUNT"},a.status={open:!0},a.setDirectiveFn=function(b){a.barAndGroupChartCreateFunction=b},a.getPartyNameData=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.searchKeyword=d,b.getData(c.getParameterizedUrl("GET_ALL_PROFESSIONALS",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.partyNameSelected=function(b){a.filterCriteria.professionalId=b.id},a.getFilteredValues=function(){var e=angular.copy(a.filterCriteria);e.dateFrom=g.convertToServerDate(a.filterCriteria.dateFrom),e.dateTill=g.convertToServerDate(a.filterCriteria.dateTill),f.isNullOrEmpty(a.filterCriteria.orgLocationId)&&e["delete"](orgLocationId),d.showSpinner=!0,b.postData(c.getUrl(a.options.value),e,function(b){d.showSpinner=!1,a.chartData=b.data,a.barAndGroupChartCreateFunction()},function(a){})},a.clear=function(){j.reload()},a.init=function(){if(f.isNullOrEmpty(e.professional)||(a.partyName=e.professional,a.filterCriteria.professional=a.partyName.id),e.data){var b=[];b.push(e.data),/*packageList.push({
    id: 1,
    packageName: "abcd"
});*/
a.stateParamPackage=b}a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("porfReviewAverageRatingCtrl",["$scope","httpService","urlService","$rootScope","$stateParams","utilService","dateconvertor","$translate","$timeout","$state",function(a,b,c,d,e,f,g,h,i,j){function k(b){var c={},d=[],e=h.instant("CARE"),f=h.instant("TREATEMENT"),g=h.instant("INFO");c.categorieData=[e,f,g],angular.forEach(b,function(a){d.push(a.groupName),a.group=a.groupName,delete a.groupName,a[e]=a.avgCareRating,delete a.avgCareRating,a[f]=a.avgTreatmentRating,delete a.avgTreatmentRating,a[g]=a.avgInfoRating,delete a.avgInfoRating}),c.groups=d,c.columnData=b,a.chartData=c,a.groupBarChartCreateFunction()}function l(b){var c=[],d=[],e=h.instant("CARE"),f=h.instant("TREATEMENT"),g=h.instant("INFO");angular.forEach(b,function(a,b){d.push(b);var h={group:b};h[e]=a.careUserCount,h[f]=a.treatmentUserCount,h[g]=a.infoUserCount,c.push(h)}),a.chartData={},a.chartData.categorieData=[e,f,g],a.chartData.groups=d,a.chartData.columnData=c,a.groupBarChartCreateFunction()}function m(b){var c={},d=[],e=h.instant("CARE"),f=h.instant("TREATEMENT"),g=h.instant("INFO");c.categorieData=[e,f,g],angular.forEach(b,function(a){d.push(a.groupName),a.group=a.groupName,delete a.groupName,a[e]=a.avgCareRating,delete a.avgCareRating,a[f]=a.avgTreatmentRating,delete a.avgTreatmentRating,a[g]=a.avgInfoRating,delete a.avgInfoRating}),c.groups=d,c.columnData=b,a.chartData=c,a.groupBarChartCreateFunction()}a.filterCriteria={diseaseVariantIds:[]},a.diseases=[],a.status={open:!0},a.obj={searchSubscriber:"true"},a.filterCriteria.ratingMinValue=0,a.filterCriteria.ratingMaxValue=10,a.filterCriteria.includeNegativeRating=!0,a.reportsList=[{name:"PROFESSIONAL_AVERAGE_RATING",value:"GET_PROF_REVIEW_RATING_REPORT"},{name:"REVIEW_POS_NEG_RATINGS",value:"GET_PROF_REVIEW_POS_NEG_RATING"},{name:"PROFESSIONAL_USER_RATING_SCALE",value:"GET_PROF_REVIEW_RATING_EACH_SCALE"},{name:"SUB_NON_SUB_USER_COUNT",value:"GET_PROF_REVIEW_SUB_NON_SUB_COUNT"},{name:"PROFESSIONAL_DISEASE_VARIANTWISE_AVG_RATING",value:"GET_PROF_REVIEW_AVG_RATING_BY_DISVAR"},{name:"PROFESSIONAL_DISEASE_VARIANTWISE_REVIEW_USER_COUNT",value:"GET_PROF_REVIEW_REVIEW_USER_COUNT_BY_DISVAR"}],a.reportSelected=function(){a.chartData=[],a.filterCriteria.diseaseVariantIds=[],"PROFESSIONAL_DISEASE_VARIANTWISE_AVG_RATING"!=a.filterCriteria.selectedReport.name&&"PROFESSIONAL_DISEASE_VARIANTWISE_REVIEW_USER_COUNT"!=a.filterCriteria.selectedReport.name&&delete a.filterCriteria.diseaseId},a.getDiseaseNameData=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.keyword=d,b.getData(c.getParameterizedUrl("GET_DISEASES",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.diseaseNameSelected=function(d){var e={};e.diseaseId=d.id,a.filterCriteria.diseaseId=d.id,
// api by Manasi
b.getData(c.getParameterizedUrl("GET_VARIANT_BY_DISEASE_ID",e),null,function(b){a.userNameAutoCmpLoading=!1,a.disVariantData=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.getPartyNameData=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.name=d,b.getData(c.getParameterizedUrl("GET_ACCESSIBLE_PROFESSIONALS",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.partyNameSelected=function(b){a.filterCriteria.professionalId=b.id},a.getFilteredValues=function(){var e=angular.copy(a.filterCriteria);delete e.selectedReport,e.diseaseId&&(e.diseaseIds=[],e.diseaseIds.push(e.diseaseId),delete e.diseaseId),e.ratingFrom=g.convertToServerDate(a.filterCriteria.ratingFrom),e.ratingTill=g.convertToServerDate(a.filterCriteria.ratingTill),d.showSpinner=!0,b.postData(c.getUrl(a.filterCriteria.selectedReport.value),e,function(b){if(d.showSpinner=!1,"PROFESSIONAL_AVERAGE_RATING"==a.filterCriteria.selectedReport.name)k(b.data);else if("REVIEW_POS_NEG_RATINGS"==a.filterCriteria.selectedReport.name){var c=angular.fromJson(b.data);a.createData(c)}else if("PROFESSIONAL_USER_RATING_SCALE"==a.filterCriteria.selectedReport.name)l(b.data);else if("SUB_NON_SUB_USER_COUNT"==a.filterCriteria.selectedReport.name){var c=angular.fromJson(b.data);a.createDataForSubNonSubUserCount(c)}else"PROFESSIONAL_DISEASE_VARIANTWISE_AVG_RATING"==a.filterCriteria.selectedReport.name?m(b.data):"PROFESSIONAL_DISEASE_VARIANTWISE_REVIEW_USER_COUNT"==a.filterCriteria.selectedReport.name&&(a.chartData=b.data,a.groupBarChartCreateFunction())},function(a){})},a.createData=function(b){a.groups=[],a.columnData=[];var c=h.instant("CARE_POSITIVE_COUNT"),d=h.instant("CARE_NEGATIVE_COUNT"),e=h.instant("TREATMENT_POSITIVE_COUNT"),f=h.instant("TREATMENT_NEGATIVE_COUNT"),g=h.instant("INFO_POSITIVE_COUNT"),i=h.instant("INFO_NEGATIVE_COUNT");a.categorieData=[c,d,e,f,g,i],a.groupData=[[c,d],[e,f],[g,i]],a.colors={},a.colors[c]="#e6e600",a.colors[d]="#CCC100",a.colors[e]="#00997a",a.colors[f]="#33ffd6",a.colors[g]="#77b300",a.colors[i]="#ccff66",angular.forEach(b,function(b,h){var j={};j.group=b.groupName,j[c]=b.carePositiveCount,j[d]=b.careNegativeCount,j[e]=b.treatmentPositiveCount,j[f]=b.treatmentNegativeCount,j[g]=b.infoPositiveCount,j[i]=b.infoNegativeCount,a.columnData.push(j),a.groups.push(b.groupName)}),a.groupBarChartCreateFunction()},a.createDataForSubNonSubUserCount=function(b){a.groups=[];var c={},d=[],e=[],f=h.instant("CARE_SUBSCRIBER_COUNT"),g=h.instant("CARE_NON_SUBSCRIBER_COUNT"),i=h.instant("TREATMENT_SUBSCRIBER_COUNT"),j=h.instant("TREATMENT_NON_SUBSCRIBER_COUNT"),k=h.instant("INFO_SUBSCRIBER_COUNT"),l=h.instant("INFO_NON_SUBSCRIBER_COUNT"),m=[f,i,k],n=[g,j,l];angular.forEach(b,function(c,h){a.filterCriteria.includeNegativeRating||h!=-1||delete b[-1],d.push(h);var m={};m.group=h,"true"==a.obj.searchSubscriber?(m[f]=c.subsCareCount,m[i]=c.subsTreatmentCount,m[k]=c.subsInformationCount):(m[g]=c.nonSubsCareCount,m[j]=c.nonSubsTreatmentCount,m[l]=c.nonSubsInformationCount),e.push(m)}),c.categorieData="true"==a.obj.searchSubscriber?m:n,c.groups=d,c.columnData=e,a.chartData=c,a.groupBarChartCreateFunction()},a.clear=function(){j.reload()},a.init=function(){f.isNullOrEmpty(e.professional)||(a.partyName=e.professional,a.filterCriteria.professionalId=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("supportProfPositiveNegativeRatingCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$translate","$stateParams","utilService","dateconvertor","$state",function(a,b,c,d,e,f,g,h,i,j,k){function l(){b.getData(c.getParameterizedUrl("GET_SUPPORT_SERVICE_TREATMENT_TYPE"),null,function(b){a.serviceTypes=angular.fromJson(b.data)},function(a){})}function m(b){var c=[],d=[],e=g.instant("POSITIVE_REVIEW_COUNT"),f=g.instant("NEGATIVE_REVIEW_COUNT");angular.forEach(b,function(a){d.push(a.groupName);var b={group:a.groupName};b[e]=a.positiveRatingCount,b[f]=a.negativeRatingCount,c.push(b)}),a.chartData={},a.chartData.categorieData=[e,f],a.chartData.groups=d,a.chartData.columnData=c,a.groupBarChartCreateFunction()}a.filterCriteria={ratingMinValue:0,ratingMaxValue:10},a.obj={searchSubscriber:"true"},a.filterCriteria.serviceTypeIds=[],a.serviceTypes=[],a.options={value:"GET_SUPPORT_PROF_REVIEW_AVG_RATING"},a.chartTypes=[{name:"SUPPORT_PROF_AVERAGE_RATING",urlKey:"GET_SUPPORT_PROF_REVIEW_AVG_RATING"},{name:"REVIEW_POS_NEG_RATINGS",urlKey:"GET_SUPPORT_PROF_REVIEW_POSITIVE_NEGATIVE_RATING"},{name:"SUPPORT_PROF_SERVICETYPEWISE_AVG_RATING",urlKey:"GET_SUPPORT_PROF_SERVICETYPEWISE_AVG_RATING"},{name:"SERVICE_TYPEWISE_USER_COUNT_CHART",urlKey:"GET_SUPPORT_PROF_SERVICETYPEWISE_USER_COUNT"},{name:"SUB_NON_SUB_USER_COUNT",urlKey:"GET_SUPPORT_PROF_SUBS_NONSUB_USER_COUNT"},{name:"SUPPORT_PROF_RATINGWISE_REVIEW_COUNT",urlKey:"GET_SUPPORT_PROF_RATINGWISE_REVIEW_COUNT"}],a.reportSelected=function(){a.chartData=[]},a.professional={queryUrl:"GET_SUPPORT_PROFESSIONAL_USER",queryParameter:{},jsonParameter:{}},a.status={open:!0},a.setDirectiveFn=function(b){a.groupBarChartCreateFunction=b},a.onProfessionalSelect=function(b){i.isFieldEmpty(b)||(a.filterCriteria.professionalId=b.id)},a.getFilteredValues=function(d,e){f.showSpinner=!0;var g=angular.copy(a.filterCriteria);g.ratingFrom=j.convertToServerDate(d),g.ratingTill=j.convertToServerDate(e),"GET_SUPPORT_PROF_REVIEW_AVG_RATING"===a.options.value&&delete g.serviceTypeIds,"GET_SUPPORT_PROF_SUBS_NONSUB_USER_COUNT"!==a.options.value&&"GET_SUPPORT_PROF_RATINGWISE_REVIEW_COUNT"!==a.options.value&&(delete g.ratingMinValue,delete g.ratingMaxValue,g.includeNegativeRating&&delete g.includeNegativeRating),"GET_SUPPORT_PROF_SUBS_NONSUB_USER_COUNT"!=a.options.value&&"GET_SUPPORT_PROF_RATINGWISE_REVIEW_COUNT"!=a.options.value||(g.includeNegativeRating=!i.isFieldEmpty(a.filterCriteria.includeNegativeRating)&&a.filterCriteria.includeNegativeRating),b.postData(c.getUrl(a.options.value),g,function(b){f.showSpinner=!1,"GET_SUPPORT_PROF_REVIEW_POSITIVE_NEGATIVE_RATING"===a.options.value?m(b.data):(a.chartData=b.data,a.groupBarChartCreateFunction())},function(a){})},a.clear=function(){k.reload()},a.init=function(){l(),i.isNullOrEmpty(h.professional)||(a.partyName=h.professional,a.filterCriteria.professionalId=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").controller("userCountByDiseaseForPeriodChartCtrl",["$scope","httpService","urlService","$http","reportsService","$rootScope","$stateParams","utilService","$state",function(a,b,c,d,e,f,g,h,i){a.filterCriteria={},a.status={open:!0},a.setDirectiveFn=function(b){a.barChartCreateFunction=b},a.getDiseases=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.keyword=d,b.getData(c.getParameterizedUrl("GET_DISEASES",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.diseaseSelected=function(b){a.filterCriteria.disease=b},a.getPartyNameData=function(d){var e={};return a.userNameAutoCmpLoading=!0,e.name=d,b.getData(c.getParameterizedUrl("GET_ACCESSIBLE_PROFESSIONALS",e),null,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.partyNameSelected=function(b){a.filterCriteria.professional=b.id},a.getFilteredValues=function(){f.showSpinner=!0;var b=angular.copy(a.filterCriteria);e.getUserCountByDiseaseForPeriodReport(b,function(b){f.showSpinner=!1,a.chartData=b,a.barChartCreateFunction()})},a.clear=function(){i.reload()},a.init=function(){h.isNullOrEmpty(g.professional)||(a.partyName=g.professional,a.filterCriteria.professional=a.partyName.id),a.currentDate=new Date},a.init()}]),angular.module("paripal.reportsModule").directive("barChart",["utilService","$translate",function(a,b){"use strict";return{restrict:"E",template:'<div id="bar"></div>',scope:{chartData:"=",legend:"@",height:"@",width:"@",xaxisLabel:"@",yaxisLabel:"@",callBack:"&"},link:function(c,d,e){c.showGraph=function(){c.chart=c3.generate({/*size: {
                        height: scope.height,
                        width: scope.width
                    },*/
bindto:"#bar",data:{type:"bar",labels:!0,json:c.columnData,keys:{x:"group",value:["Count"]}},subchart:{show:c.showSubChart},axis:{x:{extent:c.extentWidth,type:"category",label:{text:b.instant(c.xaxisLabel),position:"inner-right"}},y:{label:{text:b.instant(c.yaxisLabel),position:"outer-middle"}}},bar:{width:{ratio:.3}},legend:{/*show: scope.legend,*/
show:!1,position:"right"}})},c.createData=function(){c.categorieData=[],c.columnData=[],c.showSubChart=!1;var b={};a.isEmpty(c.$parent.chartData)||(c.chartData=c.$parent.chartData,c.$parent.chartData.length>5?(c.showSubChart=!0,c.extentWidth=[0,3]):c.showSubChart=!1),angular.forEach(c.chartData,function(d,e){b.group=a.isFieldEmpty(d.attribute)?"null":d.attribute.replace(/\./g,""),b.Count=d.count,c.columnData.push(b),b={}}),c.showGraph()},c.$on("chartData",function(){c.createData()}),c.callBack({returnFunction:c.createData})}}}]),angular.module("paripal.reportsModule").directive("groupBarChart",["utilService","$translate",function(a,b){"use strict";return{restrict:"E",template:'<div id="groupBar"></div>',scope:{chartData:"=",legend:"@",height:"@",groupVariable:"@",attributeVariable:"@",contvariable:"@",width:"@",xaxisLabel:"@",yaxisLabel:"@",callBack:"&",callBack2:"&"},link:function(c,d,e){c.showGraph=function(){c.chart=c3.generate({/*size: {
                        height: scope.height,
                        width: scope.width
                    },*/
bindto:"#groupBar",data:{type:"bar",labels:!0,json:c.columnData,keys:{x:"group",value:c.categorieData}},grid:{focus:{show:!1}},bar:{width:{ratio:.3}},legend:{show:c.legend,position:"right"},subchart:{show:c.showSubChart},axis:{x:{extent:c.extentWidth,type:"category",label:{text:b.instant(c.xaxisLabel),position:"inner-right"}},y:{label:{text:b.instant(c.yaxisLabel),position:"outer-middle"}},y2:{show:!1}},tooltip:{contents:function(a,b,c,d){var e,f,g,h,i,j,k=this,l=k.config,m=l.tooltip_format_title||b,n=l.tooltip_format_name||function(a){return a},o=l.tooltip_format_value||c;for(f=0;f<a.length;f++)a[f]&&(a[f].value||0===a[f].value)&&(e||(g=m?m(a[f].x):a[f].x,e="<table class='"+k.CLASS.tooltip+"'>"+(g||0===g?"<tr><th colspan='2'>"+g+"</th></tr>":"")),i=n(a[f].name),h=o(a[f].value,a[f].ratio,a[f].id,a[f].index),j=k.levelColor?k.levelColor(a[f].value):d(a[f].id),e+="<tr class='"+k.CLASS.tooltipName+"-"+a[f].id+"'>",e+="<td class='name'><span style='background-color:"+j+"'></span>"+i+"</td>",e+="<td class='value'>"+h+"</td>",e+="</tr>");return e+"</table>"}}})},/*
             * This function is
             */
c.createData=function(){a.isEmpty(e.contvariable)?c.contvariable="count":c.contvariable=e.contvariable,a.isEmpty(e.groupVariable)?c.groupVariable="groupName":c.groupVariable=e.groupVariable,a.isEmpty(e.attributeVariable)?c.attributeVariable="attribute":c.attributeVariable=e.attributeVariable,c.categorieData=[],c.groups=[],c.columnData=[],c.showSubChart=!1,a.isEmpty(c.$parent.chartData)?c.chartData={}:c.chartData=c.$parent.chartData,angular.forEach(c.chartData,function(a,b){$.inArray((""+a[c.attributeVariable]).replace(/\./g,""),c.categorieData)==-1&&c.categorieData.push((""+a[c.attributeVariable]).replace(/\./g,"")),$.inArray((""+a[c.groupVariable]).replace(/\./g,""),c.groups)==-1&&c.groups.push((""+a[c.groupVariable]).replace(/\./g,""))}),"true"==e.sortByGroup&&c.groups.sort();for(var d=0;d<c.groups.length;d++){var f={};angular.forEach(c.chartData,function(a,b){c.groups[d]==(""+a[c.groupVariable]).replace(/\./g,"")&&(f[(""+a[c.attributeVariable]).replace(/\./g,"")]=a[c.contvariable])});var g=c.groups[d];if("true"==e.whetherMonthTranslation){var h=g.split("-");h.length>1&&(g=b.instant(h[0])+"-"+h[1])}f.group=g,c.columnData.push(f),c.columnData.length>5?(c.showSubChart=!0,c.extentWidth=[0,3]):c.showSubChart=!1}c.showGraph()},c.loadGraphData2=function(){a.isEmpty(c.$parent.chartData)||(c.chartData=c.$parent.chartData,
//Object.keys(scope.$parent.chartData).length
c.$parent.chartData.columnData.length>5?(c.showSubChart=!0,c.extentWidth=[0,3]):c.showSubChart=!1),c.categorieData=c.chartData.categorieData,c.groups=c.chartData.groups,"true"==e.sortByGroup?c.columnData=c.chartData.columnData.sort(function(a,b){return a.group-b.group}):c.columnData=c.chartData.columnData,c.showGraph()},c.$on("chartData",function(){c.createData()}),c.refreshChart=function(){c.showGraph()},c.callBack({returnFunction:c.createData}),c.callBack2({returnFunction:c.loadGraphData2})}}}]),angular.module("paripal.reportsModule").directive("groupStackBarChart",["utilService","$translate",function(a,b){"use strict";return{restrict:"E",template:'<div id="groupStackBar"></div>',scope:{columnData:"=",categorieData:"=",groupData:"=",legend:"@",height:"@",width:"@",xaxisLabel:"@",yaxisLabel:"@",callBack:"&",colors:"="},link:function(c,d,e){c.showGraph=function(){a.isEmpty(c.$parent.columnData)||(c.columnData=c.$parent.columnData,c.categorieData=c.$parent.categorieData,c.groupData=c.$parent.groupData),c.colors=c.$parent.colors,a.isEmpty(c.columnData)||(c.chart=c3.generate({/*size: {
                                height: scope.height,
                                width: scope.width
                            },*/
bindto:"#groupStackBar",data:{type:"bar",labels:{format:function(a,b,c,d){return a||""}},json:c.columnData,keys:{x:"group",value:c.categorieData},colors:c.colors,groups:c.groupData},legend:{show:c.legend,position:"right"},bar:{width:{ratio:.4}},axis:{x:{type:"category",label:{text:b.instant(c.xaxisLabel),position:"inner-middle"}},y:{label:{text:b.instant(c.yaxisLabel),position:"outer-middle"}},y2:{show:!1}}}))},/*scope.createData = function(){
                    scope.groups = [];
                    scope.columnData = []
                    angular.forEach(scope.chartData, function(value,key){
                        if( $.inArray(value.groupName, scope.groups) == -1){
                            scope.groups.push(value.groupName);
                        }
                    });
                    scope.categorieData = ['System Open Status','System Closed Status','User Open Status','User Closed Status'];
                    scope.groupData = [
                                     ['System Open Status','System Closed Status'],
                                     ['User Open Status','User Closed Status']
                                 ];
                    for(var i=0; i <=scope.groups.length;i++){
                        var obj = {};
                        angular.forEach(scope.chartData, function(value,key){
                            if(scope.groups[i] == value.groupName){
                                obj['System Open Status'] = value.countSysStatusOpen;
                                obj['System Closed Status'] = value.countSysStatusClosed;
                                obj['User Open Status'] = value.countUserStatusOpen;
                                obj['User Closed Status'] = value.countUserStatusClosed;
                            }
                        });
                        obj['group'] = scope.groups[i];
                        scope.columnData.push(obj);
                    }

                };*/
//scope.createData();scope.showGraph();
c.$on("columnData",function(){c.showGraph()}),c.callBack({returnFunction:c.showGraph})}}}]),angular.module("paripal.reportsModule").directive("pieChart",["utilService",function(a){"use strict";return{restrict:"E",template:'<div id="pie"></div>',scope:{chartData:"=",legend:"@",height:"@",width:"@",callBack:"&"},link:function(b,c,d){b.showGraph=function(){b.chart=c3.generate({/*size: {
                            height: scope.height,
                            width: scope.width
                        },*/
bindto:"#pie",data:{json:b.columnData,keys:{value:b.categorieData},type:"pie"},pie:{label:{format:function(a,b,c){return a}}},legend:{show:b.legend}})},b.createData=function(){b.categorieData=[],b.columnData=[];var c={};a.isEmpty(b.$parent.chartData)||(b.chartData=b.$parent.chartData),angular.forEach(b.chartData,function(d,e){b.categorieData.push(a.isFieldEmpty(d.attribute)?"null":d.attribute.replace(/\./g,"")),c[a.isFieldEmpty(d.attribute)?"null":d.attribute.replace(/\./g,"")]=d.count}),b.columnData.push(c),b.showGraph()},b.$on("chartData",function(){b.createData()}),b.callBack({returnFunction:b.createData})}}}]),angular.module("paripal.reportsModule").directive("stackBarChart",["utilService","$translate",function(a,b){"use strict";return{restrict:"E",template:'<div id="stackBar"></div>',scope:{chartData:"=",legend:"@",height:"@",width:"@",xaxisLabel:"@",yaxisLabel:"@",callBack:"&"},link:function(c,d,e){c.showGraph=function(){c.chart=c3.generate({/*size: {
                            height: scope.height,
                            width: scope.width
                        },*/
bindto:"#stackBar",data:{type:"bar",labels:{format:function(a,b,c,d){return a||""}},json:c.columnData,keys:{x:"group",value:c.categorieData},groups:[c.categorieData]},legend:{show:c.legend},bar:{width:{ratio:.3}},axis:{x:{type:"category",label:{text:b.instant(c.xaxisLabel),position:"outer-center"}},y:{label:{text:b.instant(c.yaxisLabel),position:"outer-middle"}},y2:{show:!1}}})},c.createData=function(){c.categorieData=[],c.groups=[],c.columnData=[],a.isEmpty(c.$parent.chartData)||(c.chartData=c.$parent.chartData),angular.forEach(c.chartData,function(a,b){$.inArray(a.attribute.replace(/\./g,""),c.categorieData)==-1&&c.categorieData.push(a.attribute.replace(/\./g,"")),$.inArray(a.groupName.replace(/\./g,""),c.groups)==-1&&c.groups.push(a.groupName.replace(/\./g,""))});for(var b=0;b<c.groups.length;b++){var d={};angular.forEach(c.chartData,function(a,e){c.groups[b]==a.groupName.replace(/\./g,"")&&(d[a.attribute.replace(/\./g,"")]=a.count)}),d.group=c.groups[b],c.columnData.push(d)}c.showGraph()},c.$on("chartData",function(){c.createData()}),c.callBack({returnFunction:c.createData})}}}]),angular.module("paripal.requestManagementModule").controller("organizationCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","fileReader","notify","$translate","$filter","manageRequestService","serverSidePagination","utilService","urlService","httpService","orgLocListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.responseRequest={},a.addressData={},a.responseByDoctor=["sort by doctor name","sort by years of experience","sort by rating","sort by price low to high","sort by price high to low"],a.responseByOrg=["sort by organisation name","sort by rating","sort by price low to high","sort by price high to low"],a.currentPage=1,a.itemPerPage=10,a.getOrgList=function(){a.responseRequest.pageNumber=a.currentPage,a.responseRequest.recordsPerPage=a.itemPerPage;var c=angular.copy(a.responseRequest);b.reqsTyp&&(c.requestTypes=b.reqsTyp),b.limitToUserlocation&&(c.currentLocation=b.limitToUserlocation.id),b.treatmentType&&(c.treatmentType=b.treatmentType.id),c.specialization&&(c.specialization=c.specialization.id),c.disease&&(c.disease=c.disease.id),c.diseaseVariant&&(c.diseaseVariant=c.diseaseVariant.id),c.symptom&&(c.symptom=c.symptom.id),c.branch&&(c.branch=c.branch.id),c.addressData&&c.addressData.country&&(c.country=c.addressData.country.id),c.addressData&&c.addressData.state&&(c.state=c.addressData.state.id),c.addressData&&c.addressData.district&&(c.district=c.addressData.district.id),c.addressData&&c.addressData.city&&(c.city=c.addressData.city.id),delete c.addressData,c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,j.getOrgList(c,function(b){b&&(a.orgList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems))},function(a){l.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})},a.getOrgList(),a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getDiseaseVariant=function(b){var c={};if(c.searchKeyWord=b,a.responseRequest&&a.responseRequest.disease)return c.diseaseId=a.responseRequest.disease.id,a.diseaseVariantLoad=!0,n.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||g("error",h.instant(b.data.messages[0]))})},
//Symptom method
a.getSymptom=function(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,n.getData(m.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?g("error",h.instant("RECORD_SEARCH_FAILURE")):g("Alert",h.instant(b.data.messages[0]))})},a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",n.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getSpecializations(),a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",n.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getSubbranch(),a.cancel=function(){e.cancel()},a.clear=function(){a.responseRequest={},getOrgList()},a.select=function(c,d){b.$broadcast("organization",c,d),a.cancel()},a.manageOrgLoc=function(b,c){a.orgLocListPageSpinner=!0,o.getOrganizationLocationById(b,function(e){a.orgLocListPageSpinner=!1;var f="view",g="manageorglocView";c&&(f="edit",g="manageorgloc");var h=e;d.go(g,{type:f,data:h,orgLocId:b})},function(b){a.orgLocListPageSpinner=!1,a.error=b,g("error",h.instant("FAILED_TO_LOAD_RECORD"))})}}]),angular.module("paripal.requestManagementModule").controller("adviceTransactionViewCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","applicationExceptionService","commonConstants","adviceTransactionViewservice","manageRequestService","datatableconfig","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";function w(){var b=angular.copy(a.advicetransactionView);b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var d={};d.id=c.id,t.getRequestId(d,function(b){p.isNullOrEmpty(b)||b&&(a.advicetransactionView=b,a.advicetransactionView&&a.advicetransactionView.requestsType&&(a.reqType=a.advicetransactionView.requestsType.value),a.advicetransactionView&&a.advicetransactionView.requestDate&&(a.advicetransactionView.requestDate=j("timestampToDate")(a.advicetransactionView.requestDate,"MM/dd/yyyy")),a.requestFulfilmentFilter&&a.requestFulfilmentFilter.start&&(a.requestFulfilmentFilter.start=j("timestampToDate")(a.requestFulfilmentFilter.start,"MM/dd/yyyy")),a.requestFulfilmentFilter&&a.requestFulfilmentFilter.end&&(a.requestFulfilmentFilter.end=j("timestampToDate")(a.requestFulfilmentFilter.end,"MM/dd/yyyy")))},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])?h("error",i.instant("RECORD_GENERATE_FAILURE")):h("Alert",i.instant(a.data.messages[0]))});var e={};e.requestId=c.id,s.getTransactionList(e,function(b){b&&(a.advicetransactionViewlst=b,a.totalItems=b.totalRecords,a.pagingInfo=v(a.currentPage,a.itemPerPage,a.totalItems))},function(a){p.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})}a.advicetransactionView={},a.advicetransactionViewlst={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.currencyTypeList={},a.options=["sortbyTransaction Id","SortbyDate","sortbyservicedate","sortbysystembillamount","sortbyserviceProviderbillAmount"],a.getTransactionList=w,a.viewPayments=function(){d.go("ReceiptsAndPaymentsPage")},w(),a.pageChanged=function(){a.pagingInfo=v(a.currentPage,a.itemPerPage,a.totalItems),a.getRequestList()},a.viewTransaction=function(){d.go("viewtransaction",{
// type: pageType,
id:a.advicetransactionViewlst[0].id})},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getScheduleList()};var x=r.gridConfigurations;a.options=u.setOptionProperties(x),a.dtColumnDefs=u.setColumnProperties({}),a.cancel=function(){p.goBackToPrevState()},a.clear=function(){a.WSOrganizationSearchCriteria={},a.visitScheduleExp={},a.getScheduleList()}}]),angular.module("paripal.requestManagementModule").controller("healthProfessionalCtrl",["$scope","$rootScope","$stateParams","$mdDialog","$state","fileReader","notify","$translate","$filter","manageRequestService","serverSidePagination","utilService","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.responseRequest={},a.responseByDoctor=["sort by doctor name","sort by years of experience","sort by rating","sort by price low to high","sort by price high to low"],a.responseByOrg=["sort by organisation name","sort by rating","sort by price low to high","sort by price high to low"],a.hlthProf={},a.addressData={},a.currentPage=1,a.itemPerPage=10,a.getHpList=function(){a.responseRequest.pageNumber=a.currentPage,a.responseRequest.recordsPerPage=a.itemPerPage;var c=angular.copy(a.responseRequest);return b.reqsTyp&&(c.requestTypes=b.reqsTyp),b.limitToUserlocation&&(c.currentLocation=b.limitToUserlocation.id),b.treatmentType&&(c.treatmentType=b.treatmentType.id),b.reqOrganization&&b.reqOrganization.id?(c.organization=b.reqOrganization.id,c.specialization&&(c.specialization=c.specialization.id),c.disease&&(c.disease=c.disease.id),c.diseaseVariant&&(c.diseaseVariant=c.diseaseVariant.id),c.symptom&&(c.symptom=c.symptom.id),c.branch&&(c.branch=c.branch.id),c.addressData&&c.addressData.country&&(c.country=c.addressData.country.id),c.addressData&&c.addressData.state&&(c.state=c.addressData.state.id),c.addressData&&c.addressData.district&&(c.district=c.addressData.district.id),c.addressData&&c.addressData.city&&(c.city=c.addressData.city.id),delete c.addressData,c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,void j.getHpList(c,function(b){b&&(a.getList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=k(a.currentPage,a.itemPerPage,a.totalItems))},function(a){l.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})):g("Alert","Select Organization")},a.getHpList(),a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getDiseaseVariant=function(b){var c={};if(c.searchKeyWord=b,a.responseRequest&&a.responseRequest.disease)return c.diseaseId=a.responseRequest.disease.id,a.diseaseVariantLoad=!0,n.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||g("error",h.instant(b.data.messages[0]))})},
//Symptom method
a.getSymptom=function(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,n.getData(m.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?g("error",h.instant("RECORD_SEARCH_FAILURE")):g("Alert",h.instant(b.data.messages[0]))})},a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",n.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getSpecializations(),a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",n.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getSubbranch(),a.cancel=function(){d.cancel()},a.clear=function(){a.responseRequest={},getHpList()},a.select=function(c,d){b.$broadcast("hlthprofession",c,d),a.cancel()}}]),angular.module("paripal.requestManagementModule").controller("mngEntityMsgCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","manageBloodRequestServices","searchBloodRequestServices","utilService","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.mngEntityMsg={},a.entityTypes=["Request","Transaction","Diagnostic Test","Pharmacy Order","Share"]}]),angular.module("paripal.requestManagementModule").controller("mngEntityMsgCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","manageBloodRequestServices","searchBloodRequestServices","utilService","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.mngEntityMsg={},a.entityTypes=["Request","Transaction","Diagnostic Test","Pharmacy Order","Share"]}]),angular.module("paripal.requestManagementModule").controller("reqAttachmentCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","applicationExceptionService","myReqService","datatableconfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict"}]),angular.module("paripal.requestManagementModule").controller("manageReqAttachmentCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","applicationExceptionService","manageRequestAttachmentService","datatableconfig","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";a.requestManagement={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1}]),angular.module("paripal.requestManagementModule").controller("manageRequestCtrl",["$scope","$window","$rootScope","$stateParams","$state","$cookieStore","$mdDialog","fileReader","notify","$translate","$filter","dateconvertor","manageRequestService","myReqService","utilService","urlService","httpService","nonUserDetailService","userStatusService","appointmentsUploadDownloadService","commonConstants","requestFulfilmentListingService","EmergencyTransactionService","orgLocListService","RequestDetails","serverSidePagination","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";function B(){d.id&&/*var createId = parseInt($stateParams.id);
                      manageRequestService.getRequestId(createId, function(sucessResponse) {
                          $scope.manageOrgLocSpinner = false;
                          $scope.createRequest = sucessResponse;
                          if(sucessResponse){
                              $scope.createRequest=sucessResponse;
                          }
                      }, function (errorResponse) {
                          $scope.manageOrgLocSpinner = false;
                          $scope.error = errorResponse;
                      });*/
e.go("manageorderpharmacy",{requestId:a.createRequest.id})}
//  function msgSending() {
//  var dataObj = {
//     "to":$scope.createRequest.healthProfessional.value,
//     "from":$scope.createRequest.initiator.value,
//     "fromUserId":$scope.createRequest.initiator.id,
//     "toUserId": $scope.createRequest.healthProfessional.id,
//     "topicType": "Request",
//     "topic":$scope.createRequest.id,
//     "subject": "Requester: " + $scope.createRequest.initiator.value + "Responder : " + $scope.createRequest.healthProfessional.value  + "For Request Type : " + $scope.createRequest.requestsType.value + " on Request Date: " + $scope.createRequest.requestDate,
// };
//  $state.go("msgconversation", {
//     data: dataObj
// });
// }
function C(b){var c;
//                        url='TREATMENT_TYPE';
return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,"Home Visit"!=a.createRequest.requestsType.value&&"Online Advice"!=a.createRequest.requestsType.value&&"Urgent Clarification"!=a.createRequest.requestsType.value&&"Other Requests"!=a.createRequest.requestsType.value&&"General Enquiry"!=a.createRequest.requestsType.value||(a.searchKeyWord.flag=!1,"Other Requests"==a.createRequest.requestsType.value&&(a.searchKeyWord.flag=!0),c="TREATMENT_TYPE_AND_SUPPORT_SERVICE_FLAG"),"Medical Certificate"==a.createRequest.requestsType.value||"Medicine Availability"==a.createRequest.requestsType.value?null:q.getData(p.getParameterizedUrl(c,a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])?i("error",j.instant("RECORD_SERACH_FAILURE")):i("Alert",j.instant(b.data.messages[0]))})}function D(){a.treatMentObj={};var b;return a.treatmentTypeLoad=!0,b="GET_TREATMENT_TYPE_FOR_CERTIFICATE_AND_MEDICINE","Medical Certificate"==a.createRequest.requestsType.value?a.treatMentObj.type="Medical Certificate":"Medicine Availability"==a.createRequest.requestsType.value?a.treatMentObj.type="Medicine Availability":"Home Visit"==a.createRequest.requestsType.value&&(a.treatMentObj.type="Home Visit"),q.getData(p.getParameterizedUrl(b,a.treatMentObj),null,function(b){a.treatmentTypeLoad=!1,a.createRequest.treatmentType={},a.createRequest.treatmentType.id=b.data[0].id,a.createRequest.treatmentType.value=b.data[0].value,a.createRequest.treatmentType.code=b.data[0].code,a.customMode=!0},function(b){a.treatmentTypeLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])?i("error",j.instant("RECORD_SERACH_FAILURE")):i("Alert",j.instant(b.data.messages[0]))})}
//change Status
function E(){a.createRequest&&a.createRequest.requestsType&&"Other Requests"==a.createRequest.requestsType.value||a.createRequest&&a.createRequest.requestsType&&"Medicine Availability"==a.createRequest.requestsType.value||a.createRequest&&a.createRequest.requestsType&&"General Enquiry"==a.createRequest.requestsType.value?a.hideTab=!1:a.hideTab=!0}function F(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,q.getData(p.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&G()},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error","OTP Has Expired Or Invalid Access")})}function G(){var b={};b.id=parseInt(d.id),m.getRequestId(b,function(b){a.manageOrgLocSpinner=!1,a.createRequest=b,a.getTillDate(a.createRequest.start),b&&(a.createRequest=b,
//added by anbu
a.updateSchedule(),a.getOrgDetails(a.createRequest),a.getHpDetails(a.createRequest),a.createRequest.broadcast=b.broadcast,a.createRequest.organization=b.organization.value,a.createRequest.healthProfessional=b.healthProfessional.value,a.createRequest.organization&&a.createRequest.organization.id&&(M(a.createRequest.organization.id),a.isOrgSelected=!0),a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id&&(N(a.createRequest.healthProfessional.id),a.isOrgSelected=!0))},function(b){a.manageOrgLocSpinner=!1,a.error=b})}function H(){o.isFieldEmpty(d.data)||(angular.copy(d.data,a.WScReqUserDetails),o.isFieldEmpty(a.WScReqUserDetails.requestDate)||(a.WScReqUserDetails.requestDate=k("timestampToDate")(a.WScReqUserDetails.requestDate)))}function I(){
//update schedule id
if(d.scheduleId){var b={};b.schedule={},b.schedule.id=d.scheduleId,b.id=a.createRequest.id,q.postData(p.getUrl("UPDATE_REQUEST_SCHEDULE"),b,function(b){b&&b.data?(
// $scope.createRequest.schedule={};
// $scope.createRequest.schedule.id = $stateParams.scheduleId;
a.createRequest=b.data,a.createRequest.schedule={},a.createRequest.schedule.id=d.scheduleId,a.createRequest=b.data,a.createRequest.schedule={},a.createRequest.schedule.id=d.scheduleId,a.createRequest.start&&""!=a.createRequest.start&&(a.createRequest.start=l.convertToViewDate(a.createRequest.start)),a.createRequest.end&&""!=a.createRequest.end&&(a.createRequest.end=l.convertToViewDate(a.createRequest.end)),a.createRequest.requestDate=l.convertToViewDate(b.data.requestDate),a.createRequest.expiryDate=l.convertToViewDate(b.data.expiryDate)):errorCallback(b)},function(a){errorCallback(a)})}}function J(b){a.requestObject.userId=b,c.$broadcast("getAttachmentList")}function K(b){1!=b||a.checkMandatory()?2!=b||a.checkMandatory()?(3==b&&!a.checkMandatory()||3==b&&"uploadDownload"==d.stateFlag)&&(a.step1=!1,a.step2=!1,a.step3=!0,a.step4=!1,R.addClass("btn-primary").removeClass("btn-default"),P.addClass("btn-default").removeClass("btn-primary"),Q.addClass("btn-default").removeClass("btn-primary"),S.addClass("btn-default").removeClass("btn-primary")):(a.step1=!1,a.step2=!0,a.step3=!1,a.step4=!1,/*step2.addClass('btn-primary').removeClass('btn-default');*/
P.addClass("btn-default").removeClass("btn-primary"),R.addClass("btn-default").removeClass("btn-primary"),S.addClass("btn-default").removeClass("btn-primary")):(a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,P.addClass("btn-primary").removeClass("btn-default"),Q.addClass("btn-default").removeClass("btn-primary"),R.addClass("btn-default").removeClass("btn-primary"),S.addClass("btn-default").removeClass("btn-primary"))}function L(b){if("add"===d.type)a.preRequestList.length>0&&a.preRequestList.includes(b)&&a.preRequestList.splice(a.preRequestList.indexOf(b),1);else if("edit"===d.type){var c=b.id;m.deletePrevRequestId(c,function(c){o.isNullOrEmpty(c.successMessage)||(i("success",j.instant(c.successMessage)),c&&a.preRequestList.splice(a.preRequestList.indexOf(b),1))},function(a){})}}
//for org details
function M(b){a.orgShow=!0;var c={};return c.locId=b,q.getData(p.getParameterizedUrl("FIND_ORG_DETAILS_BY_ID",c),null,function(b){if(b&&b.data){
//$scope.hlthProf=null;
if(a.organization1=b.data,a.WSOrganizationLocation=b.data,a.tempProfessional)return void(a.tempProfessional=void 0);a.createRequest.healthProfessional=void 0,a.hlthProf=void 0,a.hpShow=!1}},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}
//one hp DEATIL data
function N(b){
//        $scope.hpShow=true;
var c={};return a.createRequest&&a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id&&(c.userId=a.createRequest.healthProfessional.id),q.getData(p.getParameterizedUrl("FIND_HEALTH_PROFESSIONAL_DETAILS_BY_ID",c),null,function(b){b&&b.data&&(a.hlthProf=b.data,a.hpShow=!0)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function O(b){a.endDate=b}a.createRequest={forNonUser:!1,templateAttached:!1,whetherBilled:!1,broadcast:!0},a.WScReqUserDetails={},a.nextstep=!1;a.currentPage=1,a.itemPerPage=10,a.commonConstants=u,a.isBillableStatus=!0,a.addressFilter={},a.preRequestList={},a.removeReq=L,a.minDate=new Date,a.currentDate=new Date;a.addMode=!1,a.viewMode=!1,a.editMode=!1,a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,a.iconStep1=!0,a.iconStep2=!0,a.iconStep3=!0,a.iconStep4=!0,a.type=d.type,a.loginDetails=c.loggedInUserDetails,a.profession=["Health Professional","Organization"],a.orgDtl=!1,a.organization1={},a.sessionStorage={},a.nonUserDtlId={},a.orgShow=!1,a.hpShow=!1,a.getOrgDetails=M,a.getHpDetails=N,a.createRequest.requestStatus={},a.createRequest.onBehalfOf={},a.nonUserDtl={},a.prevRequests=[],a.prevRequests=a.requestIdList,a.addmode=!0,a.WScReqUserDetails={},
// $scope.msgSending=msgSending;
a.getTreatmentType=C,a.orgLocPermission=A.MY_REQUEST_ADD,a.hideTab=!0,a.hideTabs=E,a.placeOrder=B,a.createRequest={},a.selectedUser=J,a.checkUserMode=angular.fromJson(localStorage.getItem("loggedInUser")),a.otherreqnextstep=!1,a.isOrgSelected=!1,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=F,a.allowAccessOTP=G,a.getTreatmentTypeForSupportService=D,a.customMode=!1,a.goToNextStep=K,
//$scope.getSpecializations1 = getSpecializations1;
a.disableSave=!1,a.createRequest&&a.createRequest.organization&&a.createRequest.organization.id?a.isOrgSelected=!0:d.data&&d.data.organization&&d.data.organization.id&&(a.isOrgSelected=!0),a.createRequest&&a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id?a.isOrgSelected=!0:d.data&&d.data.healthProfessional&&d.data.healthProfessional.id&&(a.isOrgSelected=!0),a.getTillDate=O;var P=angular.element(document.querySelector("#wizard1")),Q=angular.element(document.querySelector("#wizard2")),R=angular.element(document.querySelector("#wizard3")),S=angular.element(document.querySelector("#wizard4"));a.updateSchedule=I;var T={};a.broadcostVisibleChange=function(){a.createRequest&&a.createRequest.requestsType&&("REQ_OTHER_REQUEST"==a.createRequest.requestsType.code||"REQ_MEDICINE_AVAILABILITY"==a.createRequest.requestsType.code||"REQ_GENERAL_ENQUIRY"==a.createRequest.requestsType.code)?a.profession=["Organization"]:a.profession=["Health Professional","Organization"]},c.loggedInUserDetails&&c.loggedInUserDetails.isOrganizationUserMode&&(a.reqTypeVisible=!0),a.getRequestStatus=function(){var b={};b.code="REQUEST_STATUS",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){if(b&&b.data){if("add"==d.type&&a.createRequest&&a.createRequest.id){var c={};c.status="REQ_STS_REQUESTED",q.putData(p.getParameterizedUrl("GET_NEW_REQUEST_STATUS",c),null,function(b){!o.isNullOrEmpty(b)&&b.data&&(a.createRequest.requestStatus=b.data)},function(a){o.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}a.requestStatuss=b.data}},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getRequestStatus(),a.getRequestType=function(){var b={};b.code="REQUEST_TYPE",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.requestType=b.data)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getRequestType(),a.checkMandatory=function(){return document.forms.createreq.treatmentType.validity.valueMissing?(document.forms.createreq.treatmentType.focus(),!0):document.forms.createreq.datepicker&&document.forms.createreq.datepicker.length>=1&&document.forms.createreq.datepicker[1].validity&&document.forms.createreq.datepicker[1].validity.valueMissing?(document.forms.createreq.datepicker&&document.forms.createreq.datepicker.length>=1&&document.forms.createreq.datepicker[1].focus(),!0):!(!a.prblmDesFieldMandatory||!document.forms.createreq.requestDescription.validity.valueMissing)&&(document.forms.createreq.requestDescription.focus(),!0)},a.setRequest=function(){var b={};b.status="REQ_STS_NEW",q.putData(p.getParameterizedUrl("GET_NEW_REQUEST_STATUS",b),null,function(b){!o.isNullOrEmpty(b)&&b.data&&(a.createRequest.requestStatus=b.data)},function(a){o.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),a.pageType="add",c.loggedInUserDetails&&"add"==d.type&&(a.createRequest.initiator={},a.createRequest.initiator.value=c.loggedInUserDetails.displayName,a.createRequest.initiator.id=c.loggedInUserDetails.id,a.createRequest.onBehalfOf={},a.createRequest.onBehalfOf.value=c.loggedInUserDetails.displayName,a.createRequest.onBehalfOf.id=c.loggedInUserDetails.id),a.field=!0,a.disabled=!0,a.loginDetails.hasGuardian||(a.Guardian=!0)},
//init method
a.init=function(){H(),"view"!==d.type||c.loggedInUserDetails||null==a.localCheck.patientRecord.otp||(a.pageState="view",a.viewmode=!0,a.IsVisible=!0,a.disabled=!0,F()),a.requestObject={},a.requestObject.module="requestId",a.requestObject.moduleNameAndUser="findAttachmentByRequestAndUser",a.requestObject.moduleName="deleteAttachmentsByRequestIdAndDocId",d.id&&(a.requestObject.forId=parseInt(d.id)),a.requestObject.userId=s.userData().userId;var b={pathName:"findUsersByRequestId",id:a.requestObject.forId};if(a.requestObject&&a.requestObject.forId&&t.getUsersByAppointmentOrRequestId(b,function(b){a.WScReqUserDetails.userList=b}),a.checkUserMode&&(a.isBillableStatus=!1),d.id&&(a.nextstep=!0),a.checked=!0,"add"===d.type){a.addMode=!0,a.loginDetails.isOrganizationUserMode||(a.queryObj={},a.queryObj.userId=a.loginDetails.id,m.getAddressByUserId(a.queryObj,function(b){b&&(a.createRequest.requestToBeLimitedToCountry=b.country,a.createRequest.requestToBeLimitedToState=b.state,a.createRequest.requestToBeLimitedToDistrict=b.district,a.createRequest.requestToBeLimitedToCity=b.city,b.addressLine1&&b.addressLine2&&b.addressLine3?a.createRequest.address=b.addressLine1+","+b.addressLine2+","+b.addressLine3+","+b.city.value+","+b.district.value+","+b.state.value+","+b.country.value+","+b.postalCode:b.addressLine1&&b.addressLine2?a.createRequest.address=b.addressLine1+","+b.addressLine2+","+b.city.value+","+b.district.value+","+b.state.value+","+b.country.value+","+b.postalCode:b.addressLine1&&(a.createRequest.address=b.addressLine1+","+b.city.value+","+b.district.value+","+b.state.value+","+b.country.value+","+b.postalCode))},function(a){})),a.orgLocPermission=A.MY_REQUEST_ADD;var e=new Date;if(a.createRequest.requestDate=k("timestampToDate")(e,"MM/dd/yyyy"),"undefined"!=localStorage.getItem("createRequest")){var f=angular.fromJson(localStorage.getItem("createRequest"));if(f){a.createRequest=f,d.data=a.createRequest,a.createRequest&&a.createRequest.organization&&a.createRequest.organization.id?a.isOrgSelected=!0:d.data&&d.data.organization&&d.data.organization.id&&(a.isOrgSelected=!0),a.createRequest&&a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id?a.isOrgSelected=!0:d.data&&d.data.healthProfessional&&d.data.healthProfessional.id&&(a.isOrgSelected=!0),a.createRequest.organization&&a.createRequest.organization.id&&M(a.createRequest.organization.id),a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id?N(a.createRequest.healthProfessional.id):a.hpShow=!1;var g;if(localStorage.setItem("createRequest",g),a.requestIdList=y.ReqDetails,a.requestIdList&&!a.requestIdList.length)return;m.getPrevRequestId(a.requestIdList,function(b){if(b){var c=[];b.forEach(function(a){var b={id:"",createRequest:"",priviousRequest:a};c.push(b)}),a.preRequestList=c}},function(a){}),y.ReqDetails={}}else a.setRequest()}else a.setRequest()}if(a.manageOrgLocSpinner=!0,d.data){a.createRequest=d.data,a.createRequest.locSpecIds&&a.createRequest.locSpecIds.length>0&&angular.forEach(a.createRequest.locSpecIds,function(b){m.getPicklistById(b,function(b){b&&
//$scope.createRequest.locSpecialization={}
a.createRequest.locSpecialization.push(b)})}),a.createRequest.treatmentType&&a.createRequest.treatmentType.id&&(a.createRequest.treatmentType.id=d.data.treatmentType.id),a.createRequest.treatmentType&&a.createRequest.treatmentType.code&&(a.createRequest.treatmentType.code=d.data.treatmentType.code),a.createRequest.treatmentType&&a.createRequest.treatmentType.value&&(a.createRequest.treatmentType.value=d.data.treatmentType.value),a.createRequest.requestsType&&a.createRequest.requestsType.id&&(a.tempRequestType=angular.copy(a.createRequest.requestsType.id)),a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id&&(a.tempProfessional=angular.copy(a.createRequest.healthProfessional.id)),a.createRequest.organization&&a.createRequest.organization.id&&(a.tempOrganization=angular.copy(a.createRequest.organization.id)),
//                $scope.treatmentTypeLoad=$stateParams.data.treatmentType;
//                getTreatmentType($stateParams.data.treatmentType.value);
a.updateSchedule(),a.getTillDate(a.createRequest.start),a.createRequest.broadcast=d.data.broadcast,a.createRequest.organization&&a.createRequest.organization.id&&(M(a.createRequest.organization.id),a.isOrgSelected=!0),a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id&&(N(a.createRequest.healthProfessional.id),a.isOrgSelected=!0);var h={};h.id={},h.id=a.createRequest.id,m.getpreviousReqId(h,function(b){a.manageOrgLocSpinner=!1,a.prevRequests=b,b&&b.length>0&&(a.preRequestList=b)}),a.createRequest.symptom&&(a.createRequest.symptom.name=a.createRequest.symptom.value,a.createRequest.symptom.id=a.createRequest.symptom.id)}else if(d.id){var i={};i.id=parseInt(d.id),m.getRequestId(i,function(b){a.manageOrgLocSpinner=!1,a.createRequest=b,a.getTillDate(a.createRequest.start),b&&(a.createRequest=b,
//added by anbu
a.updateSchedule(),a.getOrgDetails(a.createRequest),a.getHpDetails(a.createRequest),a.createRequest.broadcast=b.broadcast,a.createRequest.organization=b.organization.value,a.createRequest.healthProfessional=b.healthProfessional.value,a.createRequest.organization&&a.createRequest.organization.id&&(M(a.createRequest.organization.id),a.isOrgSelected=!0),a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id&&(N(a.createRequest.healthProfessional.id),a.isOrgSelected=!0))},function(b){a.manageOrgLocSpinner=!1,a.error=b})}"view"===d.type&&c.loggedInUserDetails&&(a.pageState="view",a.viewmode=!0,a.IsVisible=!0,a.disabled=!0),"edit"===d.type&&c.loggedInUserDetails&&(a.orgLocPermission=A.MY_REQUEST_EDIT,
//$scope.createRequest.onBehalfOf={};
//$scope.createRequest.onBehalfOf={};
//    $scope.createRequest.onBehalfOf= $stateParams.data.onBehalfOf;
//    $scope.createRequest.onBehalfOf.id = $stateParams.data.onBehalfOf.id;
a.pageState="edit",a.IsVisible=!0,a.disabled=!0,
//$scope.viewmode = true;
a.editmode=!0,"uploadDownload"==d.stateFlag&&K(3)),"menuNavigation"===d.callingUrl&&(o.isFieldEmpty(d.callingUrlData)||(a.requestTypeCode=d.callingUrlData)),"requestmanagement"===d.callingUrl&&(o.isFieldEmpty(d.callingUrlData)||(a.requestTypeCode=d.callingUrlData))},a.init(),
//   $scope.getOnBehalfOf = function(viewValue) {
//     $scope.userData = {};
//      $scope.userData.searchString = viewValue;
//     $scope.userNameAutoCmpLoading = true;
//     var url;
//   //var url='GET_PATIENTS_LIST_BY_SEACRH_KEY';
//     if($rootScope.loggedInUserDetails && !$rootScope.loggedInUserDetails.isOrganizationUserMode){
//         url='FIND_WARD_USER_BY_SEARCH_STRING';
//     }
//     return httpService.getData(urlService.getParameterizedUrl(url, $scope.userData), null, function (response) {
//         $scope.userNameAutoCmpLoading = false;
//         if(response.data && response.data.length==0){
//             notify("error", $translate.instant("INVALID_USER"));
//         }
//         return $scope.users = response.data;
//     }, function (error) {
//         $scope.userNameAutoCmpLoading = false;
//     });
// }
a.getOnBehalfOf=function(b){a.userData={},
//$scope.userData.searchString = viewValue;
a.userData.organizationLocationId=0,a.userData.searchKeyWord=b,a.userNameAutoCmpLoading=!0;var c;return c="FIND_CLIENT_BY_ORG_LOC_ID",q.getData(p.getParameterizedUrl(c,a.userData),null,function(b){
// if (response.data && response.data.length == 0) {
//     notify("error", $translate.instant("INVALID_USER"));
// }
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},a.getTransactionId=function(){d.requestId;v.getFulfimentListById()},a.getTransactionId=function(){var b={};b.requestId=d.id,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var c={};c.id=d.requestId,v.getFulfimentList(b,function(b){b&&(a.transactionId=b.data[0].transaction.id,a.totalItems=b.totalRecords,a.pagingInfo=z(a.currentPage,a.itemPerPage,a.totalItems))},function(a){o.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})},
//link to previous request
a.prevReq=function(){localStorage.setItem("createRequest",JSON.stringify(a.createRequest)),a.prevReq=!0,e.go("myReq",{prevReq:a.prevReq})},a.changeReqType=function(b){// non user
//hp/org dropdown
//broadcast
//start end
//addtional /hp
// why
// non user
// non user
// non user
// non user
// non user
// non user
return"Medical Certificate"==b.value&&("add"===d.type&&(a.createRequest.onBehalfOf="",a.createRequest.broadcast=!1,a.Guardian=!1),a.visible=!0,a.visible1=!1,a.visible2=!1,a.visible3=!1,a.visible4=!0,a.visible5=!0,a.orderButton=!1,a.prblmDesFieldMandatory=!1,a.hpMandatory=!0,D(),a.customMode=!0),"Home Visit"==b.value&&(c.loggedInUserDetails.isOrganizationUserMode||"add"!=d.type||(a.createRequest.onBehalfOf={},a.createRequest.onBehalfOf.value=c.loggedInUserDetails.displayName,a.createRequest.onBehalfOf.id=c.loggedInUserDetails.id),"add"==d.type&&(a.createRequest.broadcast=!0),a.visible=!1,a.visible1=!0,a.visible2=!0,a.visible3=!0,a.visible4=!0,a.visible5=!1,a.orderButton=!1,a.prblmDesFieldMandatory=!0,a.hpMandatory=!1,D(),a.customMode=!1,a.createRequest.expiryDate=new Date),"Online Advice"==b.value&&(c.loggedInUserDetails.isOrganizationUserMode||"add"!=d.type||(a.createRequest.onBehalfOf={},a.createRequest.onBehalfOf.value=c.loggedInUserDetails.displayName,a.createRequest.onBehalfOf.id=c.loggedInUserDetails.id),"add"==d.type&&(a.createRequest.broadcast=!0),a.visible=!1,a.visible1=!0,a.visible2=!0,a.visible3=!0,a.visible4=!0,a.visible5=!1,a.orderButton=!1,a.prblmDesFieldMandatory=!0,a.hpMandatory=!1,a.customMode=!1),"Urgent Clarification"==b.value&&(c.loggedInUserDetails.isOrganizationUserMode||"add"!=d.type||(a.createRequest.onBehalfOf={},a.createRequest.onBehalfOf.value=c.loggedInUserDetails.displayName,a.createRequest.onBehalfOf.id=c.loggedInUserDetails.id),"add"==d.type&&(a.createRequest.broadcast=!1),a.visible=!1,a.visible1=!1,a.visible2=!1,a.visible3=!1,a.visible4=!0,a.visible5=!1,a.orderButton=!1,a.prblmDesFieldMandatory=!1,a.hpMandatory=!0,a.customMode=!1),"Other Requests"==b.value&&(c.loggedInUserDetails&&!c.loggedInUserDetails.isOrganizationUserMode&&"add"==d.type&&(a.createRequest.onBehalfOf={},a.createRequest.onBehalfOf.value=c.loggedInUserDetails.displayName,a.createRequest.onBehalfOf.id=c.loggedInUserDetails.id),"add"==d.type&&(a.createRequest.broadcast=!0),a.visible=!1,a.visible2=!0,a.visible1=!0,a.visible3=!1,a.visible4=!1,a.visible5=!1,a.orderButton=!1,a.prblmDesFieldMandatory=!1,a.hpMandatory=!1,a.customMode=!1),"General Enquiry"==b.value&&(c.loggedInUserDetails&&!c.loggedInUserDetails.isOrganizationUserMode&&"add"==d.type&&(a.createRequest.onBehalfOf={},a.createRequest.onBehalfOf.value=c.loggedInUserDetails.displayName,a.createRequest.onBehalfOf.id=c.loggedInUserDetails.id),"add"==d.type&&(a.createRequest.broadcast=!0),a.visible=!1,a.visible2=!0,a.visible1=!0,a.visible3=!1,a.visible4=!1,a.visible5=!1,a.orderButton=!1,a.prblmDesFieldMandatory=!1,a.hpMandatory=!1,a.customMode=!1),"Medicine Availability"==b.value&&(c.loggedInUserDetails.isOrganizationUserMode||"add"!=d.type||(a.createRequest.onBehalfOf={},a.createRequest.onBehalfOf.value=c.loggedInUserDetails.displayName,a.createRequest.onBehalfOf.id=c.loggedInUserDetails.id),"add"==d.type&&(a.createRequest.broadcast=!0),a.visible=!1,a.visible2=!0,a.visible1=!0,a.visible3=!1,a.visible4=!1,a.visible5=!1,a.orderButton=!0,a.prblmDesFieldMandatory=!1,a.hpMandatory=!1,D(),a.customMode=!0),a.tempRequestType==b.id?void(a.tempRequestType=void 0):(a.createRequest.treatmentType=null,a.createRequest.healthProfessional=void 0,a.hlthProf=void 0,a.hpShow=!1,a.createRequest.organization=void 0,a.organization1=void 0,a.WSOrganizationLocation=void 0,a.orgShow=!1,void(a.isOrgSelected=!1))},
// /************Appointment Starts***********/CAL_EVENT_ONLINE
a.setAppointment=function(){var b={};b.parentState="createrequest",// calling  State
// params.type="add";
b.parentType=d.type,b.parentId=d.id,
// params.requestId=$scope.createRequest;
a.createRequest.schedule&&a.createRequest.schedule.id?(b.scheduleId=a.createRequest.schedule.id,b.type="edit"):(b.scheduleId=null,b.type="add"),b.entityType={id:418,value:"Organization User",code:"CAL_ORGANIZATION_USER"},"REQ_HOME_VISIT"==a.createRequest.requestsType.code&&(b.eventType={code:"CAL_EVENT_HOME_VISIT",id:422,value:"Home Visit"}),"REQ_ONLINE_ADVICE"==a.createRequest.requestsType.code&&(b.eventType={code:"CAL_EVENT_ONLINE",id:423,value:"Online Advice"}),b.serviceType={id:a.createRequest.treatmentType.id,value:a.createRequest.treatmentType.value},b.onBehalfOf={id:a.createRequest.onBehalfOf.id,value:a.createRequest.onBehalfOf.value},a.createRequest.healthProfessional&&(b.doctor={id:a.createRequest.healthProfessional.id,value:a.createRequest.healthProfessional.value}),b.problemDescription=a.createRequest.requestDescription,b.loggedInUserId=c.loggedInUserDetails.id,b.onBehalfOfCellPhone=c.loggedInUserDetails.cell1,b.onBehalfOfAddress="karvenagar",e.go("managedefineschedule",b)},/************Appointment Ends***********/
a.requestDetailsPopup=function(a){g.show({templateUrl:"app/modules/request-management/views/request-Details.html",parent:angular.element(document.body),clickOutsideToClose:u.dialogBox.clickOutsideToClose,controller:["$scope",function(b){if("add"===d.type){var c={};c.id=a.id,m.getRequestId(c,function(a){b.reqDetail=a,b.reqDetail.requestDate=l.convertToServerDate(b.reqDetail.requestDate),b.reqDetail.requestsType=a.requestsType,b.reqDetail.requestStatus=a.requestStatus,b.reqDetail.treatmentType=a.treatmentType,b.reqDetail.expiryDate=l.convertToServerDate(b.reqDetail.expiryDate)},function(a){})}if("edit"===d.type||"view"===d.type){var e={};e.id=a.id,m.getRequestId(e,function(a){b.reqDetail=a,b.reqDetail.requestDate=l.convertToServerDate(b.reqDetail.requestDate),b.reqDetail.requestsType=a.requestsType,b.reqDetail.requestStatus=a.requestStatus,b.reqDetail.treatmentType=a.treatmentType,b.reqDetail.expiryDate=l.convertToServerDate(b.reqDetail.expiryDate)},function(a){})}b.cancel=function(){g.cancel()}}]})},a.nonUserPopupFilter=function(b){1==a.createRequest.forNonUser&&g.show({templateUrl:"app/modules/request-management/views/Non-user-details.html",parent:angular.element(document.body),clickOutsideToClose:u.dialogBox.clickOutsideToClose,controller:["$scope",function(a){"view"==d.type&&(a.viewmode=!0);var c={};c.id=b.id,a.nonUserDtl={};if(m.getNonuserId(c,function(b){b&&b.length>0&&(a.nonUserDtl.name=b[0].name,a.nonUserDtl.email=b[0].email,a.nonUserDtl.genderId=b[0].genderId,a.nonUserDtl.age=b[0].age,a.nonUserDtl.motherName=b[0].motherName,a.nonUserDtl.fatherName=b[0].fatherName,a.nonUserDtl.spouseName=b[0].spouseName,a.nonUserDtl.phone=b[0].phone,a.nonUserDtl.id=b[0].id)},function(a){}),"add"==d.type&&localStorage.nonUser){var e=angular.fromJson(localStorage.getItem("nonUser"));a.nonUserDtl={},a.nonUserDtl.name=e.name,a.nonUserDtl.email=e.email,a.nonUserDtl.genderId=e.genderId,a.nonUserDtl.age=e.age,a.nonUserDtl.motherName=e.motherName,a.nonUserDtl.fatherName=e.fatherName,a.nonUserDtl.spouseName=e.spouseName,a.nonUserDtl.phone=e.phone}a.getGender=function(){var b={};b.code="GENDER",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.gender=b.data)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getGender(),a.cancel=function(){a.nonUserDtl&&localStorage.setItem("nonUser",JSON.stringify(a.nonUserDtl)),g.cancel()},a.saveNonUserDetail=function(){a.nonUserId=b.id,a.nonUserDtl.createRequest={},a.nonUserDtl.createRequest.id=a.nonUserId,angular.parseInt=a.nonUserDtl.createRequest,a.nonUserDtl.createRequest&&a.nonUserDtl.createRequest.id?r.saveNonUserDetail(a.nonUserDtl,function(b){a.nonUserDtl.createRequest.id?o.isNullOrEmpty(b.successMessage)||(i("success",j.instant("RECORD_UPDATED_SUCCESS")),localStorage.removeItem("nonUser"),g.cancel()):a.nonUserDtl.createRequest&&(o.isNullOrEmpty(b.successMessage)||(i("success",j.instant("RECORD_SAVED_SUCCESS")),localStorage.removeItem("nonUser"),g.cancel()))},function(a){o.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}):f.put("nonUserDtl",a.nonUserDtl)}}]})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=p.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return q.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getDiseaseVariant=function(b){var c={};if(c.searchKeyWord=b,a.createRequest&&a.createRequest.disease)return c.diseaseId=a.createRequest.disease.id,a.diseaseVariantLoad=!0,q.getData(p.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||i("error",j.instant(b.data.messages[0]))})},
//Symptom method
a.getSymptom=function(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,q.getData(p.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])?i("error",j.instant("RECORD_SEARCH_FAILURE")):i("Alert",j.instant(b.data.messages[0]))})},
//org loc wall
a.manageOrgLoc=function(b,c){a.orgLocListPageSpinner=!0,x.getOrganizationLocationById(b,function(d){a.orgLocListPageSpinner=!1;var f="view",g="manageorglocView";c&&(f="edit",g="manageorgloc");var h=d;e.go(g,{type:f,data:h,orgLocId:b})},function(b){a.orgLocListPageSpinner=!1,a.error=b,i("error",j.instant("FAILED_TO_LOAD_RECORD"))})},
//smart entry
a.getOrgName=function(b){if(!a.createRequest.treatmentType)return i("Alert","Select Service Type"),null;
//   			if($scope.createRequest && $scope.createRequest.requestsType &&
//   					($scope.createRequest.requestsType.code =='REQ_MEDICINE_AVAILABILITY' || 
//   							$scope.createRequest.requestsType.code =='REQ_MEDICAL_CERTIFICATE')){
//   				$scope.createRequest.treatmentType.id=0;
//   				
//   			}
var c={},d="";
//        	  url='FIND_PHARMACY'
return c.searchKeyWord=b,a.createRequest&&a.createRequest.requestsType&&"REQ_MEDICINE_AVAILABILITY"==a.createRequest.requestsType.code?(c.currentLocation=a.createRequest.requestToBeLimitedToCity.id,d="FIND_PHARMACY_LOC_BY_CRITERIA"):a.createRequest&&a.createRequest.requestsType&&"REQ_URGENT_CLARIFICATION"!=a.createRequest.requestsType.code&&"REQ_MEDICAL_CERTIFICATE"!=a.createRequest.requestsType.code?(d="GET_ORG_LOC_LIST_BY_KEYWORD_AND_SEARCH_CRITERIA_AND_SUPPORT_SERVICE",c.treatmentType=a.createRequest.treatmentType.id,c.requestTypes=a.createRequest.requestsType.code,c.currentLocation=a.createRequest.requestToBeLimitedToCity.id):(d="GET_ORG_LOC_LIST_BY_KEYWORD_AND_SEARCH_CRITERIA",c.treatmentType=a.createRequest.treatmentType.id,c.requestTypes=a.createRequest.requestsType.code),q.postData(p.getUrl(d),c,function(b){if(b&&b.data)return a.organization=b.data,a.organization},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},
//smart entry hp wth org id
a.getHealthProf=function(b){return a.createRequest.organization&&a.createRequest.organization.id?a.getHealthProfByLocation(b):i("Alert","Select Organization")},
//smart entry hp wth org id
a.getHealthProfByLocation=function(b){var c={};
//                FIND_HEALTHPROFESSION_BY_ORGLOCATION_AND_TYPE
return c.orgLocationId=a.createRequest.organization.id,c.searchKeyword=b,c.type=a.createRequest.requestsType.code,c.treatmentType=a.createRequest.treatmentType.id,a.userNameAutoCmpLoading=!0,q.getData(p.getParameterizedUrl("FIND_HEALTHPROFESSION_BY_ORGLOCATION_AND_TYPE_TREATMENT_TYPE",c),null,function(b){return a.userNameAutoCmpLoading=!1,b.data},function(b){a.userNameAutoCmpLoading=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||i("Alert",j.instant(b.data.messages[0]))})},
// smart entry Notby location GET_ADVISED_BY_SEACRH_KEY
a.getHealthProfByAllLocation=function(b){var c={};return c.name=b,c.type=a.createRequest.requestsType.code,a.userNameAutoCmpLoading=!0,q.getData(p.getParameterizedUrl("FIND_HEALTHPROFESSION_BY_USERID",c),null,function(b){return a.userNameAutoCmpLoading=!1,b.data},function(b){a.userNameAutoCmpLoading=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||i("Alert",j.instant(b.data.messages[0]))})},a.getSpecializations=function(){if(a.createRequest.requestsType&&"REQ_GENERAL_ENQUIRY"!=a.createRequest.requestsType.code){var b={};a.createRequest.requestsType&&"REQ_OTHER_REQUEST"==a.createRequest.requestsType.code||a.createRequest.requestsType&&"REQ_MEDICINE_AVAILABILITY"==a.createRequest.requestsType.code?b.code="supportProfSpecialization":(a.createRequest.requestsType&&"REQ_HOME_VISIT"==a.createRequest.requestsType.code||a.createRequest.requestsType&&"REQ_ONLINE_ADVICE"==a.createRequest.requestsType.code)&&(b.code="healthProfSpecialization"),q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}else if(a.createRequest.requestsType&&"REQ_GENERAL_ENQUIRY"==a.createRequest.requestsType.code){var b={};b.code="healthProfSpecialization",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){if(b&&b.data){a.specializations1=b.data;var c={};c.code="supportProfSpecialization",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",c),null,function(b){if(b&&b.data){var c=[];c=b.data,a.specializations=c.concat(a.specializations1)}},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}},a.getSpecializations(),a.getSpecializations1=function(){var b={};b.code="ORG_LOCATION_CATEGORY_1",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.locSpecializations=b.data)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getSpecializations1(),a.getSubbranch=function(){if(a.createRequest.requestsType&&"REQ_GENERAL_ENQUIRY"!=a.createRequest.requestsType.code){var b={};a.createRequest.requestsType&&"REQ_OTHER_REQUEST"==a.createRequest.requestsType.code||a.createRequest.requestsType&&"REQ_MEDICINE_AVAILABILITY"==a.createRequest.requestsType.code?b.code="supportProfSubSpecialization":(a.createRequest.requestsType&&"REQ_HOME_VISIT"==a.createRequest.requestsType.code||a.createRequest.requestsType&&"REQ_ONLINE_ADVICE"==a.createRequest.requestsType.code)&&(b.code="healthProfSubSpecialization"),
//branch.code="SUB_BRANCH";
q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}else if(a.createRequest.requestsType&&"REQ_GENERAL_ENQUIRY"==a.createRequest.requestsType.code){var b={};b.code="healthProfSubSpecialization",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){if(b&&b.data){a.subBranches1=b.data;var c={};c.code="supportProfSubSpecialization",q.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",c),null,function(b){if(b&&b.data){var c=[];c=b.data,a.subBranches=c.concat(a.subBranches1)}},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})}},a.getSubbranch(),a.getOrgCountries=function(b){a.queryObj={},a.queryObj.searchString=b;var c=p.getParameterizedUrl("GET_COUNTRY_DATA",a.queryObj);if(c)return q.getData(c,null,function(b){if(b&&b.data)return a.requestToBeLimitedToCountry=b.data,a.requestToBeLimitedToCountry},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getState=function(b){a.queryObj={},a.queryObj.searchString=b,a.queryObj.countryId=a.createRequest.requestToBeLimitedToCountry.id;var c=p.getParameterizedUrl("GET_STATE_DATA",a.queryObj);if(c)return q.getData(c,null,function(b){if(b&&b.data)return a.requestToBeLimitedToState=b.data,a.requestToBeLimitedToState},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getDistrict=function(b){a.queryObj={},a.queryObj.searchString=b,a.queryObj.stateId=a.createRequest.requestToBeLimitedToState.id;var c=p.getParameterizedUrl("GET_DISTRICT_DATA",a.queryObj);if(c)return q.getData(c,null,function(b){if(b&&b.data)return a.requestToBeLimitedToDistrict=b.data,a.requestToBeLimitedToDistrict},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getCity=function(b){a.queryObj={},a.queryObj.searchString=b,a.queryObj.stateId=a.createRequest.requestToBeLimitedToState.id,a.queryObj.districtId=a.createRequest.requestToBeLimitedToDistrict.id;var c=p.getParameterizedUrl("GET_CITY_DATA",a.queryObj);if(c)return q.getData(c,null,function(b){if(b&&b.data)return a.requestToBeLimitedToCity=b.data,a.requestToBeLimitedToCity},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.hlthProfPopupFilter=function(){if("Health Professional"==a.createRequest.onHealthProfOrganization){if(!a.organization1||!a.organization1.id)return i("Alert","Select Organization"),null;c.reqsTyp=a.createRequest.requestsType.code,c.limitToUserlocation=a.createRequest.requestToBeLimitedToCity,c.treatmentType=a.createRequest.treatmentType,c.reqOrganization=a.createRequest.organization,g.show({templateUrl:"app/modules/request-management/views/health-professional-popup.html",parent:angular.element(document.body),clickOutsideToClose:u.dialogBox.clickOutsideToClose})}else if("Organization"==a.createRequest.onHealthProfOrganization){if(!a.createRequest.treatmentType||!a.createRequest.treatmentType.id)return i("Alert","Select Service Type"),null;c.reqsTyp=a.createRequest.requestsType.code,c.limitToUserlocation=a.createRequest.requestToBeLimitedToCity,c.treatmentType=a.createRequest.treatmentType,g.show({templateUrl:"app/modules/request-management/views/OrgnizationPopUp.html",parent:angular.element(document.body),clickOutsideToClose:u.dialogBox.clickOutsideToClose})}},a.cancel=function(){o.goBackToPrevState()},
//profession wall
a.manageProfessionalWall=function(b){e.go("",{callingUrl:"createrequest",userData:a.hlthProf})},
//accretiation
a.manageProfessionalAccreditations=function(b){var c=a.hlthProf;c.userName=a.hlthProf.healthProfessional,localStorage.setItem("createRequest",JSON.stringify(a.createRequest)),e.go("manageprofessionalwall",{callingUrl:"createrequest",userData:c})},
// rating professionList
a.getStars=function(a){
// Get the value
// var val = parseFloat(rating);
// Turn value into number/100
// var size = val / 5 * 100;
// return size + '%';
var b=parseFloat(a),c=b/5*100;
// return size + '%';
return c+"%"},
//
//
a.getCareRating=function(a,b,c){var d=0;if(null!=a){var e=b+c;d=a/e/2}return d},a.$on("hlthprofession",function(b,c,d){a.createRequest.healthProfessional={},a.createRequest.healthProfessional.id=c,a.createRequest.healthProfessional.value=d,a.getHpDetails(c)}),a.$on("organization",function(b,c,d){a.createRequest.organization={},a.createRequest.organization.id=c,a.createRequest.organization.value=d,a.getOrgDetails(c)}),a.save=function(){if(a.disableSave=!0,"add"===d.type&&(a.nextstep=!0),(a.createRequest&&a.createRequest.requestsType&&"Other Requests"==a.createRequest.requestsType.value||a.createRequest&&a.createRequest.requestsType&&"General Enquiry"==a.createRequest.requestsType.value)&&(a.otherreqnextstep=!0),
//$scope.save
a.otherreqnextstep=!0,a.createRequest.organization&&a.createRequest.organization.orgLocationId){var b={};b.id=a.createRequest.organization.orgLocationId,a.createRequest.organization=b}if(a.createRequest.symptom&&a.createRequest.symptom.id&&(/* var symptom = {};
                            symptom.id =$scope.createRequest.symptom.id;
                            $scope.createRequest.symptom=symptom;*/
delete a.createRequest.symptom.version,delete a.createRequest.symptom.name,delete a.createRequest.symptom.organizationLocationId,delete a.createRequest.symptom.symptomDescription,delete a.createRequest.symptom.whetherActive),""==a.createRequest.disease&&(a.createRequest.disease=null),""==a.createRequest.diseaseVariant&&(a.createRequest.diseaseVariant=null),""==a.createRequest.symptom&&(a.createRequest.symptom=null),a.createRequest.healthProfessional||delete a.createRequest.healthProfessional,a.createRequest.healthProfessional&&a.createRequest.healthProfessional.id){var c={};c.id=a.createRequest.healthProfessional.id,c.value=a.createRequest.healthProfessional.value,a.createRequest.healthProfessional=c}var e=!0;if(a.createRequest&&a.createRequest.id&&(e=!1),T=a.createRequest.requestsType,a.createRequest.treatmentType&&!a.createRequest.treatmentType.id)return i("Alert","Select valid Service Type");
// if($scope.createRequest.healthProfessional && $scope.createRequest.healthProfessional == 'undefined' ){
//    delete $scope.createRequest.healthProfessional;
//  }
// if($scope.createRequest.healthProfessional && !$scope.createRequest.healthProfessional.id ){
// 	return notify("Alert","Select valid Professional");
// }
if(a.createRequest.organization&&!a.createRequest.organization.id)return i("Alert","Select valid Organizations");if(!a.createRequest.broadcast){if(!a.createRequest.organization)return i("Alert","Select valid Organizations");if(!a.createRequest.healthProfessional&&"REQ_MEDICINE_AVAILABILITY"!=a.createRequest.requestsType.code&&"REQ_OTHER_REQUEST"!=a.createRequest.requestsType.code&&"REQ_GENERAL_ENQUIRY"!=a.createRequest.requestsType.code&&"REQ_HOME_VISIT"!=a.createRequest.requestsType.code)return i("Alert","Select valid Professional")}if(a.createRequest.locSpecialization){a.locSpecialization="";for(var h=0;a.createRequest.locSpecialization.length>h;h++)0==h?a.locSpecialization=a.createRequest.locSpecialization[h].id:a.locSpecialization=a.locSpecialization+","+a.createRequest.locSpecialization[h].id;a.createRequest.locSpecialization=a.locSpecialization}""==a.createRequest.locSpecialization&&delete a.createRequest.locSpecialization,!a.loginDetails||a.loginDetails.isOrganizationUser||a.loginDetails.isOrganizationUserMode||(a.createRequest.isIndividualCreated=!0),a.createRequest.broadcast?(
//$scope.createRequest.isIndividualCreated = true;
a.createRequest.isLead=!0,a.createRequest.isConfirmed=!1):(
//$scope.createRequest.isIndividualCreated = true;
a.createRequest.isLead=!1,a.createRequest.isConfirmed=!1),m.save(a.createRequest,function(b){if(!o.isNullOrEmpty(b.successMessage)){if(d.id||(a.createRequest=b.response,
// $scope.createRequest.id=successResponse.response;
a.requestObject.forId=a.createRequest.id,a.createRequest.requestsType&&a.createRequest.requestsType.value&&(a.createRequest.requestsType=T),a.createRequest.start&&""!=a.createRequest.start&&(a.createRequest.start=l.convertToViewDate(a.createRequest.start)),a.createRequest.end&&""!=a.createRequest.end&&(a.createRequest.end=l.convertToViewDate(a.createRequest.end)),a.createRequest.requestDate=l.convertToViewDate(a.createRequest.requestDate),a.createRequest.expiryDate=l.convertToViewDate(a.createRequest.expiryDate)),"Medical Certificate"==a.createRequest.requestsType.value&&b.response&&b.response&&e){var c=f.get("nonUserDtl");void 0!=c&&(c.createRequest={},c.createRequest.id=a.createRequest.id,r.saveNonUserDetail(c,function(a){o.isNullOrEmpty(a.successMessage)||(i("success",j.instant("RECORD_SAVED_SUCCESS")),localStorage.removeItem("nonUser"),g.cancel())},function(a){o.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))}),f.remove("nonUserDtl"))}if(!o.isNullOrEmpty(a.requestIdList)){var h={};h.priviousRequests=[],a.requestIdList.forEach(function(a){var b={};b.id=a,h.priviousRequests.push(b)}),h.createRequest={},h.createRequest.id=a.createRequest.id,m.savePrevReq(h,function(a){})}i("success",j.instant(b.successMessage)),localStorage.removeItem("nonUser")}},function(a){d.type="add",o.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}}]),angular.module("paripal.requestManagementModule").controller("myReqctrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","RequestDetails","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","manageRequestService","applicationExceptionService","myReqService","respondToRequestService","datatableconfig","searchRequestManagementService","serverSidePagination","commonConstants","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";
//get list
function A(){var b=angular.copy(a.myReq);b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b&&b.healthProfessional&&(b.healthProfessional=b.healthProfessional.id),b&&b.initiator&&(b.initiator=b.initiator.id),b&&b.requestDate&&(b.requestDate=n.convertToServerDate(b.requestDate)),b&&b.expiryDate&&(b.expiryDate=n.convertToServerDate(b.expiryDate)),b&&b.requestStatus&&b.requestStatus.length>0&&(b.requestStatus=C(b.requestStatus)),b&&b.requestType&&b.requestType.length>0&&(b.requestType=D(b.requestType)),t.getRequestList(b,function(b){b&&(a.myReqList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=x(a.currentPage,a.itemPerPage,a.totalItems))},function(a){q.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}
//getRequestList();
//change status to rejected
function B(a){var b={};b.id=a,b.status="REQ_FULFILMENT_CANCELLED";var c="UPDATE_REQUEST_STATUS";o.putData(p.getParameterizedUrl(c,b),null,function(a){!q.isNullOrEmpty(a)&&a.data&&(A(),i("success",j.instant("REQUEST_CANCELLED_SUCCESSFULLY")))},function(a){q.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})}
//multiple selection in requestStatus
function C(a){var b=[];return a.forEach(function(a){b.push(a.id)}),b}
//multiple selection in requestType
function D(a){var b=[];return a.forEach(function(a){b.push(a.id)}),b}function E(b){a.requestIdList||(a.requestIdList=[]),a.requestIdList.length>0&&a.requestIdList.includes(b)?a.requestIdList.splice(a.requestIdList.indexOf(b),1):a.requestIdList.push(b),g.ReqDetails=angular.copy(a.requestIdList)}function F(b){w.getRequestListById(b,function(c){var e=c;e&&e.requestsType&&(a.reqType=e.requestsType.value,d.go("reqFulfilLst",{requestId:b,requestsType:a.reqType}))})}function G(a){
// type='view';
// respondToRequestService.getReqResListById(id, function(sucessResponse){
// var respondList = sucessResponse;
d.go("respondtoReq",{requestId:a,type:"view"})}function H(a){var c={to:a.healthProfessional.value,from:b.loggedInUserDetails.displayName,fromUserId:b.loggedInUserDetails.id,toUserId:a.healthProfessional.id,topicType:"Request",topic:a.id,subject:"Requester: "+a.initiator.value+",  Responder : "+a.healthProfessional.value+",  For Request Type : "+a.requestsType.value+",  on Request Date: "+n.convertToViewDate(a.requestDate)};d.go("msgconversation",{data:c})}
//$scope.dateList = [{name:"12/12/2016"}]
a.myReq={},a.currentPage=1,a.itemPerPage=10,a.minDate=new Date,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.getRequestList=A,a.requestIdList=[],
//$scope.requestIdList = RequestDetails.ReqDetails;
a.selectRequest=E,a.cancelReq=B,a.viewFulfilment=F,a.medical=!0,a.urgent=!0,a.viewrespond=G,a.msgSending=H,c.prevReq&&(a.visibleCheckBox=!0),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,z.validateListing("MEDICINAL_AVAILABILITY_RECORD_SUB"),c.requestType&&(
//$scope.myReq.requestType = [];
//$scope.myReq.requestType[0] = {};
//$scope.myReq.requestType[0].id = $stateParams.requestType;
//$scope.getRequestTypes();
a.requestTypeCode=c.requestType),
//add new request
a.addNewMyRequest=function(){
//$scope.requestIdList = RequestDetails.ReqDetails = {};
d.go("createrequest",{
//            type: ''
type:"add",callingUrl:"requestmanagement",callingUrlData:"REQ_MEDICINE_AVAILABILITY"})},a.okRequest=function(){history.back()},
//dropdown for request status
a.getRequestStatus=function(){var b={};b.code="REQUEST_STATUS",o.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.requestStatuses=b.data)},function(a){q.isEmpty(a.data)||q.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getRequestStatus(),
//other actions
a.myRequests=function(a,b,c){t.getRequestListById(a,function(c){var e=c;"edit"==b?d.go("createrequest",{id:a,type:b,data:e}):"view"==b?d.go("createrequest",{id:a,type:b,data:e}):"respond"==b?d.go("respondtoReq",{requestId:a,type:b,data:e}):"transaction"==b?d.go("adviceTransactionView",{id:a,type:b,data:e}):"mail"==b?d.go("adviceTransactionView",{id:a,type:b,data:e}):"Diagnostic"==b?d.go("",{id:a,type:b,data:e}):"Prescriptions"==b?d.go("",{id:a,type:b,data:e}):"responseToRequest"==b?d.go("responsetorequest",{id:a,type:b,data:e}):"shareRequest"==b&&d.go("",{id:a,type:b,data:e})},function(a){})},
//dropdown for Request type
a.getRequestTypes=function(){var b={};b.code="REQUEST_TYPE",o.getData(p.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.requestTypes=b.data,c.requestType&&(a.myReq.requestType=a.requestTypes.filter(function(a){return a.code==c.requestType})),A())},function(a){q.isEmpty(a.data)||q.isEmpty(a.data.messages[0])||i("error",j.instant(a.data.messages[0]))})},a.getRequestTypes(),a.pageChanged=function(){a.pagingInfo=x(a.currentPage,a.itemPerPage,a.totalItems),a.getRequestList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,A()};var I=y.gridConfigurations;a.options=v.setOptionProperties(I),a.dtColumnDefs=v.setColumnProperties({}),a.cancel=function(){a.myReq={},a.getRequestList()},a.getUserNamesForRoleHistory=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_LIST_BY_SEACRH_KEY";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),o.getData(p.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1,i("error",j.instant(b.data.messages[0]))})},a.markAsComplete=function(a){var b={};b.id=a,b.status="REQ_STS_COMPLETE";var c="UPDATE_REQUEST_STATUS";o.putData(p.getParameterizedUrl(c,b),null,function(a){!q.isNullOrEmpty(a)&&a.data&&(A(),i("success",j.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){q.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})},a.markAsNotComplete=function(a){var b={};b.id=a,b.status="REQ_STS_NOT_COMPLETE";var c="UPDATE_REQUEST_STATUS";o.putData(p.getParameterizedUrl(c,b),null,function(a){!q.isNullOrEmpty(a)&&a.data&&(A(),i("success",j.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){q.isNullOrEmpty(a.data.message[0])||i("alert",j.instant(a.data.message[0]))})},a.getAppointmentListForScheduleId=function(a){e.show({templateUrl:"app/modules/request-management/views/request-appointment-schedule-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{scheduleId:a},controller:["$scope","$mdDialog","locals","httpService",function(a,b,c,d){a.getByScheduleId=function(){var b={};b.scheduleId=c.scheduleId;var e="FIND_LIST_OF_APPOINTMENTS_FOR_SCHEDULE_ID";d.getData(p.getParameterizedUrl(e,b),null,function(b){return a.userNameAutoCmpLoading=!1,a.scheduleList=angular.fromJson(b.data),a.scheduleList.forEach(function(a){new Date(a.apptDate)<new Date?a.applyClass=!0:a.applyClass=!1}),console.log(a.scheduleList),a.scheduleList},function(b){a.userNameAutoCmpLoading=!1,i("error",j.instant(b.data.messages[0]))})},a.getByScheduleId(),a.cancel=function(){b.hide()}}]})}}]),angular.module("paripal.requestManagementModule").controller("nonuserCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","manageBloodRequestServices","searchBloodRequestServices","utilService","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.nonUserDtl={}}]),angular.module("paripal.requestManagementModule").controller("nonuserCtrl",["$scope","$cookieStore","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","nonUserDetailService","utilService","urlService","httpService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.nonUserDtl={},a.nonUserDtlId={},a.nonUserPopupFilter=function(c){1==a.createRequest.forNonUser&&$mdDialog.show({templateUrl:"app/modules/request-management/views/Non-user-details.html",parent:angular.element(document.body),clickOutsideToClose:n.dialogBox.clickOutsideToClose,controller:["$scope",function(a){a.getGender=function(){var b={};b.code="GENDER",m.getData(l.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.gender=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getGender(),a.cancel=function(){$mdDialog.cancel()},a.saveNonUserDetail=function(){a.createRequest={};a.nonUserId=c.id,a.nonUserDtl.createRequest=a.nonUserId,angular.parseInt=a.nonUserDtl.createRequest,a.createRequest.id?j.saveNonUserDetail(a.nonUserDtl,function(a){k.isNullOrEmpty(a.successMessage)||(g("success",h.instant("RECORD_SAVED_SUCCESS")),$mdDialog.cancel())},function(a){k.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))}):b.put("nonUserDtl",a.nonUserDtl)}}]})}}]),angular.module("paripal.requestManagementModule").controller("pageEntityShareLstCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","applicationExceptionService","commonConstants","pageEntityShareLstService","datatableconfig","serverSidePagination",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(){var b=angular.copy(a.pageEnSharingLst);b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,s.getEntityList(b,function(b){b&&(a.list=b.data,a.totalItems=b.totalRecords,a.pagingInfo=u(a.currentPage,a.itemPerPage,a.totalItems))},function(a){p.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})}function w(){searchRequestManagementService.getEntityShareListById(id,function(a){var b=a;"edit"==manage&&d.go("respondtoReq",{id:id,type:manage,data:b}),"add"==manage&&d.go("respondtoReq",{type:manage}),"view"==manage&&d.go("createrequest",{id:id,type:manage,data:b})},function(a){})}
//$scope.results = [{name:"12/12/2016"}]
a.pageEnSharingLst={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.getEntityList=v,a.manageShareEntityList=w,a.getEntityList(),a.clear=function(){a.requestManagement={},getRequestList()},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=u(a.currentPage,a.itemPerPage,a.totalItems),getRequestList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,getRequestList()};
//data table config
r.gridConfigurations}]),angular.module("paripal.requestManagementModule").controller("reqFulfilLstCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","dateconvertor","httpService","urlService","utilService","requestFulfilmentListingService","commonConstants","manageRequestService","searchRequestManagementService","datatableconfig","serverSidePagination","commonBillingService","appointmentsListService","baseService","storageService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";function z(a){e.show({templateUrl:"app/modules/request-management/views/requestFulfilment-appointment-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{scheduleId:a},controller:["$scope","$mdDialog","locals","manageUserTreatmentService",function(a,b,e,f){var g={};g.scheduleId=e.scheduleId,l.getData(m.getParameterizedUrl("FIND_LIST_OF_APPOINTMENTS_FOR_SCHEDULE_ID",g),null,function(b){b&&b.data&&0!=b.data.length&&(a.appointmentDate=b.data)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))}),a.cancel=function(){b.cancel()},a.goToAddFulfillment=function(a){b.cancel(),d.go("requeststatus",{type:"",requestId:c.requestId,appointmentId:a.id})}}]})}function A(){var b={};b.requestId=a.requestFulfilmentFilter.id,b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage;var d={};d.id=c.requestId,q.getRequestId(d,function(b){n.isNullOrEmpty(b)||b&&(a.requestFulfilmentFilter=b,a.requestFulfilmentFilter&&a.requestFulfilmentFilter.requestDate&&(a.requestFulfilmentFilter.requestDate=j("timestampToDate")(a.requestFulfilmentFilter.requestDate,"MM/dd/yyyy"),a.requestFulfilmentFilter.requestId=b.requestId),a.requestFulfilmentFilter&&a.requestFulfilmentFilter.start&&(a.requestFulfilmentFilter.start=j("timestampToDate")(a.requestFulfilmentFilter.start,"MM/dd/yyyy")),a.requestFulfilmentFilter&&a.requestFulfilmentFilter.end&&(a.requestFulfilmentFilter.end=j("timestampToDate")(a.requestFulfilmentFilter.end,"MM/dd/yyyy")))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?h("error",i.instant("RECORD_GENERATE_FAILURE")):h("Alert",i.instant(a.data.messages[0]))}),o.getFulfimentList(b,function(b){b&&(a.requestFulfilmentList=b.data,"Home Visit"==c.requestsType||"Online Advice"==c.requestsType?a.addnew=!0:0==a.requestFulfilmentList.length?a.addnew=!0:a.addnew=!1,a.totalItems=b.totalRecords,a.pagingInfo=t(a.currentPage,a.itemPerPage,a.totalItems))},function(a){n.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})}function B(a,b,d,e,f,g){a.prescriptionList=d,a.cancel=function(){b.cancel()},a.viewPrescriptionCall=function(a){var d="PRESCRIPTION_REFERENCE_FORM",e=c;/*prevStateParam.stateName = "appointmentsList";*/
//         prevStateParam.data = {
//         };
b.cancel(),g.loadNewFormRunner(a.id,d,a.organizationLocation.id,1,e,null,0,null)}}function C(b,c){o.getFulfimentListById(b,function(e){a.requestFulfilment=e;var f,g=a.requestFulfilment.createRequest.id;f=c?"edit":"view",d.go("requeststatus",{id:b,requestId:g,type:f,data:a.requestFulfilment})},function(a){})}function D(a){var b={};b.id=a,b.status="REQ_STS_COMPLETE";var c="UPDATE_REQUEST_STATUS";l.putData(m.getParameterizedUrl(c,b),null,function(a){!n.isNullOrEmpty(a)&&a.data&&(A(),h("success",i.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){n.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})}function E(a){var b={};b.id=a,b.status="REQ_STS_NOT_COMPLETE";var c="UPDATE_REQUEST_STATUS";l.putData(m.getParameterizedUrl(c,b),null,function(a){!n.isNullOrEmpty(a)&&a.data&&(A(),h("success",i.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){n.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})}function F(b){var c;c="FULFILMENT_FULFILED",a.changeStatus(b,c)}function G(b){var c;c="FULFILMENT_STARTED",a.changeStatus(b,c)}function H(a,b,c,d,e,f,g,h){a.cancel=function(){b.cancel()},a.later=function(){b.cancel()},a.viewBill=function(){b.cancel();var a={};a.entityName=WSAppointment.entityName,a.apptDate=WSAppointment.apptDate,a.event=WSAppointment.eventName,f.go("managebill",{parentState:"APPOINTMENT",billId:WSAppointment.billIdWithResidualFS,type:"view",createReceipt:!0,appointmentDetails:a})},a.prepareAdhocBill=function(){b.cancel();var a={};n.isNullOrEmpty(h.transaction)||(a.transactionId=h.transaction.id),n.isNullOrEmpty(h.createRequest.organization)||(a.locationId=h.createRequest.organization.id),n.isNullOrEmpty(h.createRequest.treatmentType)||n.isNullOrEmpty(h.createRequest.treatmentType.id)||(a.serviceTypeId=h.serviceTypeTreatmenttype),a.whetherWalkinAppointment=!1,l.postData(m.getUrl("GET_ADHOC_BILL_SETUP"),a,function(c){if(n.isFieldEmpty(c.data))b.cancel();else{b.cancel();/* SERVER params to be sent */
var d=angular.copy(c.data);d.fromCheckIn=!0,d.raisedOnDetails={raisedOnUserId:d.raisedOnUserId.id,raisedOnName:d.raisedOnUserId.value},d.transaction={id:a.transactionId},f.go("createbill",{type:"DEBIT",data:d,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0})}},function(a){})},a.generateBill=function(){if(b.cancel(),h.transaction&&h.transaction.id){var a=[h.transaction.id];c.generateBill(a,function(a){e("success",a.successMessage),a.response&&f.go("managebill",{type:"view",billId:a.response,createReceipt:!0})},function(a){a.data&&a.data.messages&&a.data.messages.length>0?e("error",i.instant(a.data.messages[0])):e("error",i.instant("FAILED_TO_SAVE_RECORD"))})}}}
//$scope.visitNumberList=[{name:"1"}]
B.$inject=["$scope","$mdDialog","prescriptionList","$filter","baseService","orbeonFormRunner"],H.$inject=["$scope","$mdDialog","commonBillingService","manageCheckInOutAllotService","notify","$state","$rootScope","requestFulfilmentpay"],a.requestFulfilment={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.getFulfimentList=A,a.manageFulfimentList=C,a.requestFulfilmentList={},a.requestFulfilmentFilter={},a.addnew=!1,a.markAsComplete=D,a.markAsNotComplete=E,a.markAsFulfilled=F,a.markReqFulfiledStart=G,a.fulfilled=!1,a.getAppointmentListForScheduleId=z,c.requestId&&(a.requestFulfilmentFilter.id=c.requestId),b.loggedInUserDetails.isOrganizationUserMode?a.isOrganizationUser=!0:a.isOrganizationUser=!1,a.checkPermissionForAddButton=function(){
//var individualFeaturePrivileges = storageService.getLocationFeaturePrivileges();
a.isOrganizationUser?x.hasFeaturePrivilege(y.REQUEST_STATUS_ADD)?a.hasAddAccess=!0:x.hasFeaturePrivilege(y.RESPOND_TO_REQ_MED_AVAILABILITY)?a.hasAddAccess=!0:x.hasFeaturePrivilege(y.RESPOND_TO_REQ_OTHER)&&(a.hasAddAccess=!0):a.hasAddAccess=!1},a.checkPermissionForAddButton(),a.addNewRequestFulfilment=function(){var b={};b.id=c.requestId,q.getRequestId(b,function(b){n.isNullOrEmpty(b)||(b&&null!=b.schedule?(a.creRequest=b,z(a.creRequest.schedule.id)):d.go("requeststatus",{type:"",requestId:c.requestId}))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||h("Alert",i.instant(a.data.messages[0]))})},
//cancel
a.cancel=function(){n.goBackToPrevState()},a.viewReq=function(a){r.getRequestListById(a,function(b){var c=b;b&&d.go("createrequest",{id:a,type:"view",data:c})},function(a){})},a.clear=function(){a.requestFulfilmentFilter={},A()},a.viewPrescriptionForRequest=function(b){null!=b.appointmentId?v.getPrescriptionByAppId(b.appointmentId,function(b){e.show({controller:B,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:w}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){}):o.getApptIdByScheduleId(b.createRequest.schedule.id,function(b){b&&(a.reqFulApptId=b,v.getPrescriptionByAppId(a.reqFulApptId,function(b){e.show({controller:B,templateUrl:"app/modules/appointment/views/view-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{prescriptionList:b.data,baseService:w}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},function(a){}))},function(b){a.manageOrgLocSpinner=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||h("error",i.instant(b.data.messages[0]))})},A(),a.pageChanged=function(){a.pagingInfo=t(a.currentPage,a.itemPerPage,a.totalItems),A()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,A()};
//data table config
var I=p.gridConfigurations;a.options=s.setOptionProperties(I),a.dtColumnDefs=s.setColumnProperties({}),a.goToUploadDownload=function(b){o.getFulfimentListById(b.id,function(c){a.requestFulfilment=c;var e=a.requestFulfilment.createRequest.id,f="edit",g="uploadDownload";d.go("requeststatus",{id:b.id,requestId:e,type:f,data:a.requestFulfilment,stateFlag:g})},function(a){})},a.goToAppointmentNotes=function(b){o.getFulfimentListById(b.id,function(c){a.requestFulfilment=c;var e=a.requestFulfilment.createRequest.id,f=a.requestFulfilment.appointmentId,g="edit",h="diagnosis";d.go("requeststatus",{id:b.id,requestId:e,type:g,data:a.requestFulfilment,stateFlag:h,appointmentId:f})},function(a){})},a.changeStatus=function(a,b){var c={};c.id=a,c.status=b;var d="SET_FULFILMENT_REQUEST_STATUS";l.putData(m.getParameterizedUrl(d,c),null,function(a){!n.isNullOrEmpty(a)&&a.data&&(A(),h("success",i.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){})},a.fulfilmentGetById=function(a){if(1==a.whetherBillExistForTransaction){var c={};// raisedOn OR PARTY_TYPE value
c.raisedOn="INDIVIDUAL",// partyNameId.id OR RAISED_ON object /
c.partyNameId={id:a.createRequest.initiator.id,value:a.createRequest.initiator.value},// type OR SELECT_BILL_TYPE value /
c.type="DEBIT",// locationId OR SELECT_ORG_LOCATION object /
c.inFavorOfOrgList={id:a.createRequest.organization.id,value:a.createRequest.organization.value},// dateFromString OR DATE_FROM /
c.dateFromString=a.createRequest.schedule.fromDate,c.dateTillString=a.createRequest.schedule.tillDate,d.go("searchbill",{data:c})}else b.loggedInUserDetails.isOrganizationUser&&e.show({controller:H,templateUrl:"app/modules/appointment/views/payment-confirm-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{
//successResponse: successResponse,
requestFulfilmentpay:a}})}}]),angular.module("paripal.requestManagementModule").controller("RequestManagementCtrl",["$scope","$state","$stateParams","baseService","utilService","$rootScope",function(a,b,c,d,e,f){"use strict";if(a.createRequest=function(){b.go("createrequest",{type:"add",callingUrl:"requestmanagement",callingUrlData:c.requestType})},a.requestList=function(){1==d.getLoggedInUser().isOrganizationUserMode?b.go("requestmgntlist",{requestType:c.requestType}):b.go("myReq")},!e.isNullOrEmpty(f.dashboardMenu)){a.parentMenus=f.dashboardMenu.children;for(var g=0;g<=a.parentMenus.length;g++)null!=a.parentMenus[g]&&("HOME_VISITS"!=a.parentMenus[g].name&&"ONLINE_CONSULTING"!=a.parentMenus[g].name&&"URGENT_CLARIFICATION"!=a.parentMenus[g].name&&"OTHER_REQUESTS"!=a.parentMenus[g].name&&"MEDICAL_CERTIFICATE"!=a.parentMenus[g].name||(a.childMenus=a.parentMenus[g].children))}a.redirectTo=function(a,d){a.preventDefault(),"CREATE_REQUEST"==d.name?b.go(d.state,{type:"add",callingUrl:"requestmanagement",callingUrlData:c.requestType}):"REQUEST_LIST"==d.name&&("requestmgntlist"==d.state?b.go(d.state,{requestType:c.requestType}):b.go(d.state,{requestType:c.requestType}))}}]),angular.module("paripal.requestManagementModule").controller("requestStatusCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","manageBloodRequestServices","searchBloodRequestServices","utilService","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_BY_SEACRH_KEY";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),m.getData(l.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.initiator=b.data},function(b){a.userNameAutoCmpLoading=!1,f("error",g.instant(b.data.messages[0]))})}/*$scope.requestStatus = {};
      $scope.step1 = true;
			$scope.step2 = false;
			$scope.step3 = false;
	    $scope.step4 = false;
			
			$scope.iconStep1 = true;
			$scope.iconStep2 = true;
			$scope.iconStep3 = true;
      $scope.iconStep4 = true;
			$scope.modeTypes= ['Audio','Video','Chat','Message'];
			$scope.clinicalTypes= ['Diagnosis','Observations','Proprietary Diagnosis','Investigations','Notes','Complaints','Vital Signs'];
		 $scope.flwDate = {
            "Before": 'Before',
            "After": "After",
            
        }
			$scope.changeflwDate = function(flwDate){
				 if(flwDate == 'Before'){
				 $scope.flwDateBefore = true;
					 $scope.flwDateAfter = false;
					
				 }
				 if(flwDate == 'After'){
					 $scope.flwDateBefore = false;
					 $scope.flwDateAfter = true;
				 }
			}
            	});*/
a.reqStatus={fulfiled:!1,Completed:!1,notCompleted:!1,incorrectlyFulfiled:!1},a.getUserNamesForRoleHistory=n,a.minDate=new Date,a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,a.iconStep1=!0,a.iconStep2=!0,a.iconStep3=!0,a.iconStep4=!0,a.type=c.type;var o=angular.element(document.querySelector("#wizard1")),p=angular.element(document.querySelector("#wizard2")),q=angular.element(document.querySelector("#wizard3")),r=angular.element(document.querySelector("#wizard4"));a.goToNextStep=function(b){
// if($stateParams.type !== 'view'){
1==b?(a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,o.addClass("btn-primary").removeClass("btn-default"),p.addClass("btn-default").removeClass("btn-primary"),q.addClass("btn-default").removeClass("btn-primary"),r.addClass("btn-primary").removeClass("btn-primary")):2==b?(a.step1=!1,a.step2=!0,a.step3=!1,a.step4=!1,p.addClass("btn-primary").removeClass("btn-default"),o.addClass("btn-default").removeClass("btn-primary"),q.addClass("btn-default").removeClass("btn-primary"),r.addClass("btn-primary").removeClass("btn-primary")):3==b?(a.step1=!1,a.step2=!1,a.step3=!0,a.step4=!1,q.addClass("btn-primary").removeClass("btn-default"),o.addClass("btn-default").removeClass("btn-primary"),p.addClass("btn-default").removeClass("btn-primary"),r.addClass("btn-default").removeClass("btn-primary")):4==b&&(a.step1=!1,a.step2=!1,a.step3=!1,a.step4=!0,r.addClass("btn-primary").removeClass("btn-default"),o.addClass("btn-default").removeClass("btn-primary"),p.addClass("btn-default").removeClass("btn-primary"),q.addClass("btn-default").removeClass("btn-primary"))},a.getFulfilmentStatus=function(){var b={};b.code="FULFILMENT_STATUS",m.getData(l.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.fulfilmentStatus=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getFulfilmentStatus(),a.cancel=function(){d.go("",{type:""})},a.save=function(){if(a.reqStatus.requestsType){var b=a.reqStatus.requestsType;delete a.reqStatus.requestsType,a.reqStatus.requestsType={},b.id&&(a.reqStatus.requestsType.id=b.id)}if(a.reqStatus.requestStatus){var e=a.reqStatus.requestStatus;delete a.reqStatus.requestStatus,a.reqStatus.requestStatus={},e.id&&(a.reqStatus.requestStatus.id=e.id)}if(a.reqStatus.serviceType){var h=a.reqStatus.serviceType;delete a.reqStatus.serviceType,a.reqStatus.serviceType={},h.id&&(a.reqStatus.serviceType.id=h.id)}manageRequestService.save(a.reqStatus,function(a){k.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),d.go("requestmgntlist"))},function(a){c.type="add",k.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})}}]),angular.module("paripal.requestManagementModule").controller("requestStatusCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","fileReader","notify","$translate","$filter","utilService","urlService","httpService","commonConstants","fileOperations","requestStatusService","EmergencyTransactionService","commonBillingService","searchRequestManagementService","manageRequestService","manageAttachmentService","userStatusService","appointmentsUploadDownloadService","requestFulfilmentListingService","skypeService","MakePrescriptionFactory","manageUserMedicationService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";function A(){
// if ($scope.requestStatus.createRequest.requestsType.value = "Other Requests" || $scope.requestStatus.createRequest.requestsType.value = "Medical Certificate" ){
return a.requestStatus.createRequest&&a.requestStatus.createRequest.requestsType&&(requestsType.value="Other Requests")?a.hideTab=!1:a.hideTab=!0,a.hideTab}
//for skype
function B(){var b={},e={},f={};b.id=c.id,l.getData(k.getParameterizedUrl("GET_FULFILMENT_BY_ID",b),null,function(b){if(b.data)if(L=b.data.conversationLog,M=b.data.createRequest,L){if("NOT_YET_STARTED"!=L.status)return g("alert","You have Completed a Call previously");e.convId=L.id,f.type="APPOINTMENT",////Todo based on requst type
f.location=M.organization.id,//Change wrt logged in user
f.status="NOT_STARTED",e.userId=a.loggedInUserDetails.id,e.userName=a.loggedInUserDetails.displayName,d.go("skypeHome",{convId:e.convId,convType:f.type,userId:e.userId,userName:e.userName})}else C()},function(a){j.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//creating Conversation and User
function C(){var b={};b.createdDate=new Date,b.type="APPOINTMENT",//Todo based on requst type
b.location=M.organization.id,b.status="NOT_YET_STARTED",x.placeRequest(b,function(c){if(a.skype.convId=c.response,c){var e={},f={};a.loggedInUserDetails.isOrganizationUser?(
//Ading Doctor
e.userType="DOCTOR",e.userId=a.loggedInUserDetails.id,e.convId=a.skype.convId,e.userName=a.loggedInUserDetails.displayName,
//Ading Patient
f.userType="PATIENT",f.userId=M.initiator.id,f.convId=a.skype.convId,f.userName=M.initiator.value,D(e),D(f),d.go("skypeHome",{convId:e.convId,convType:b.type,userId:e.userId,userName:e.userName})):(f.userType="PATIENT",f.userId=M.initiator.id,f.convId=a.skype.convId,f.userName=M.initiator.value,D(f),M.healthProfessional&&(e.userType="DOCTOR",e.userId=M.healthProfessional.id,e.convId=a.skype.convId,e.userName=M.healthProfessional.value,D(e)),d.go("skypeHome",{convId:f.convId,convType:b.type,userId:f.userId,userName:f.userName})),E()}},function(a){j.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Add Conversation User
function D(a){var b={};b.convId=a.convId,b.userType=a.userType,b.userId=a.userId,b.userName=a.userName,x.addConvUser(b,function(a){},function(a){j.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function E(){var b={};b.convId=a.skype.convId,b.requestId=c.id,l.postData(k.getParameterizedUrl("UPDATE_CONV_ID",b),null,function(a){}),function(a){j.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))}}
//document upload functionality for check page
function F(){j.isFieldEmpty(c.data)||(angular.copy(c.data,a.WScReqUserDetails),j.isFieldEmpty(a.WScReqUserDetails.requestDate)||(a.WScReqUserDetails.requestDate=i("timestampToDate")(a.WScReqUserDetails.requestDate)))}function G(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")}function H(){if(c.id){var b,d={};if(null!=c.appointmentId?(d.appointmentId=c.appointmentId,b=k.getParameterizedUrl("GET_CLINICAL_NOTES_FOR_APPOINTMENT",d)):(d.fulfilmentRecordId=c.id,b=k.getParameterizedUrl("TREATMENT_CLINICAL_NOTE_BY_FULFILMENT_REC_ID",d)),b)return l.getData(b,null,function(b){if(b&&b.data)return a.clinicalNotes=b.data,a.clinicalNotes},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})}else a.clinicalNotes=[]}function I(){var b={};return b.recId=parseInt(a.requestStatus.appointmentId),l.getData(k.getParameterizedUrl("GET_CLINICAL_NOTES_FOR_APPTID_BY_FULFILMENTID",b),null,function(b){b&&b.data&&(a.clinicalAptList=[],b.data.forEach(function(b){for(var c in b){var d=b[c];d.length>0&&a.clinicalAptList.push(d)}}),a.clinAptNts=a.clinicalAptList)},function(a){!j.isEmpty(a.data)&&!j.isEmpty(a.data.messages[0])})}function J(){
//update schedule id
if(c.scheduleId){var b={};b.schedule={},b.schedule.id=c.scheduleId,
//reqStatus.id=$scope.requestStatus.id;
b.id=c.requestId,l.postData(k.getUrl("UPDATE_REQUEST_SCHEDULE"),b,function(b){b&&b.data?(a.requestStatus.createRequest.schedule={},a.requestStatus.createRequest.schedule.id=c.scheduleId):errorCallback(b)},function(a){errorCallback(a)})}}
//file upload
function K(c,d,e){var f=new Object;f.file=d.fileToBeUpload,f.orgLocId=b.loggedInUserDetails.organizationId,f.docType=m.documentTypes.request,f.docSubType=m.documentSubTypes.requestFulfillment,f.isThumbnailRequired=!1,j.isNullOrEmpty(e.response)||(f.recordId=e.response),n.uploadFile(f,function(a){j.isNullOrEmpty(e.successMessage)||g("success",e.successMessage)},function(b){j.isNullOrEmpty(e.response)||o.deleteRequestStatusById(e.response,function(b){g("Error",h.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()},function(a){g("Error",h.instant("ERROR_WHILE_UPLOADING"))})})}a.viewmode=!1,a.minDate=new Date,a.fulStatus=!1;a.commonConstants=m,a.requestStatus={},a.clinical={},a.clinicalNotes=[],a.clinical={},a.requestStatus.createRequest={},a.reqType={},a.requestStatus.fulfilmentStatus={},a.skype={},a.chat=!0;var L={},M={};a.stateType=c.type,a.getCliniclList=H,a.linkToChatAudioVideo=B,
//$scope.placeRequest=placeRequest;
a.addConvUser=D,a.creatSkypeConversation=C,a.updateConvId=E,a.WScReqUserDetails={},a.disableSave=!1,a.view=!1,a.getclinicalForAppointmentId=I,
//$scope.updateFulfilmentStatus = updateFulfilmentStatus;
a.uploadFile=K,a.consolidateClinicalNotes=[],
//$scope.viewPrintFile=viewPrintFile;
a.hide=!0,a.disabled=!1,a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,a.iconStep1=!0,a.iconStep2=!0,a.iconStep3=!0,a.iconStep4=!0,a.type=c.type,a.add=!0,a.IsVisible=!1,a.certificateDocFile={},a.certificateDocFile.fileToBeUpload=null,a.documentUpload={},a.documentUpload.document={},a.selectedUser=G,a.loginDetails=b.loggedInUserDetails,a.hideTab=!0,a.hideTabs=A,a.requestStatus.transaction={},a.updateSchedule=J,b.loggedInUserDetails.isOrganizationUserMode||(a.makepres=!0),a.fulfilstatusvisible=angular.fromJson(localStorage.getItem("loggedInUser"));var N=angular.element(document.querySelector("#wizard1")),O=angular.element(document.querySelector("#wizard2")),P=angular.element(document.querySelector("#wizard3")),Q=angular.element(document.querySelector("#wizard4")),R=angular.element(document.querySelector("#step-1")),S=angular.element(document.querySelector("#step-2")),T=angular.element(document.querySelector("#step-3")),U=angular.element(document.querySelector("#step-4"));a.goToNextStep=function(c){if(1==c)a.step1=!0,a.step2=!1,a.step3=!1,a.step4=!1,N.addClass("btn-primary").removeClass("btn-default"),O.addClass("btn-default").removeClass("btn-primary"),P.addClass("btn-default").removeClass("btn-primary"),Q.addClass("btn-default").removeClass("btn-primary"),R.css("display","block"),S.css("display","none"),T.css("display","none"),U.css("display","none");else if(2==c)a.step1=!1,a.step2=!0,a.step3=!1,a.step4=!1,O.addClass("btn-primary").removeClass("btn-default"),N.addClass("btn-default").removeClass("btn-primary"),P.addClass("btn-default").removeClass("btn-primary"),Q.addClass("btn-default").removeClass("btn-primary"),R.css("display","none"),S.css("display","block"),T.css("display","none"),U.css("display","none");else if(3==c)a.step1=!1,a.step2=!1,a.step3=!0,a.step4=!1,P.addClass("btn-primary").removeClass("btn-default"),N.addClass("btn-default").removeClass("btn-primary"),O.addClass("btn-default").removeClass("btn-primary"),Q.addClass("btn-default").removeClass("btn-primary"),R.css("display","none"),S.css("display","none"),T.css("display","block"),U.css("display","none");else if(4==c){a.step1=!1,a.step2=!1,a.step3=!1,a.step4=!0,Q.addClass("btn-primary").removeClass("btn-default"),N.addClass("btn-default").removeClass("btn-primary"),O.addClass("btn-default").removeClass("btn-primary"),P.addClass("btn-default").removeClass("btn-primary"),R.css("display","none"),S.css("display","none"),T.css("display","none"),U.css("display","block");var e={to:a.requestStatus.createRequest.initiator.value,from:b.loggedInUserDetails.displayName,fromUserId:b.loggedInUserDetails.id,toUserId:a.requestStatus.createRequest.id,topicType:"Request",topic:a.requestStatus.createRequest.id,subject:"Requester: "+b.loggedInUserDetails.displayName+",  Responder : "+a.requestStatus.createRequest.initiator.value+",  For Request Type : "+a.requestStatus.createRequest.requestsType.value+",   on Request Date: "+a.requestStatus.createRequest.requestDate};d.go("msgconversation",{data:e})}},a.flwDate={Before:"Before",After:"After"},a.changeflwDate=function(b){"Before"==b&&(a.flwDateBefore=!0,a.flwDateAfter=!1),"After"==b&&(a.flwDateBefore=!1,a.flwDateAfter=!0)},a.getFulfilmentStatus=function(){var b={};b.code="FULFILMENT_STATUS",l.getData(k.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){if(b&&b.data&&(a.fulfilmentStatuses=b.data,"add"===c.type)){var d={};d.status="NEW_FULFILMENT",l.putData(k.getParameterizedUrl("GET_NEW_FULFILMENT_REQUEST_STATUS",d),null,function(b){!j.isNullOrEmpty(b)&&b.data&&(a.requestStatus.fulfilmentStatus=b.data)},function(a){j.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getFulfilmentStatus(),a.cancel=function(){j.goBackToPrevState()},a.getMode=function(){var b={};b.code="MODE",l.getData(k.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.modeTypes=b.data)},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},a.getMode(),
//skype ends here
a.save=function(){a.disableSave=!0,!j.isEmpty(a.requestStatus)&&a.certificateDocFile&&a.certificateDocFile.fileToBeUpload&&(a.requestStatus.linkToTheFulfilmentFile=a.certificateDocFile.fileToBeUpload.name),
// if ($scope.requestStatus.fulfilmentInstanceNo) {
//     $scope.requestStatus.fulfilmentInstanceNo = parseInt($scope.requestStatus.fulfilmentInstanceNo);
// }
a.chat=!0,a.certificateDocFile&&a.certificateDocFile.fileToBeUpload?(a.documentUpload.document.fileName=a.certificateDocFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.certificateDocFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.requestStatus.createRequest.organization.id,a.documentUpload.document.documentType={subType:m.documentSubTypes.requestFulfillment},"add"!=c.type&&a.requestStatus.document&&(a.documentUpload.document.id=a.requestStatus.document.id),z.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.certificateDocFile.fileToBeUpload&&(a.certificateDocFile&&a.certificateDocFile.fileToBeUpload&&a.certificateDocFile.fileToBeUpload.name&&a.uploadFile(a.requestStatus,a.certificateDocFile,b),a.requestStatus&&a.requestStatus.id?g("success",h.instant("RECORD_UPDATED_SUCCESS")):g("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):o.save(a.requestStatus,function(b){if(!j.isNullOrEmpty(b.successMessage)&&b.response){a.requestStatus=b.response;
// $scope.requestStatus.version=3;
var e={};e.response=b.response.id,a.certificateDocFile&&a.certificateDocFile.fileToBeUpload&&a.certificateDocFile.fileToBeUpload.name&&a.uploadFile(a.requestStatus,a.certificateDocFile,e),g("success",h.instant(b.successMessage)),c.id=b.response.id,a.stateParamValue=c.id}b&&b.response&&b.response.createRequest&&b.response.createRequest.requestsType&&("Other Requests"==b.response.createRequest.requestsType.value||"Medical Certificate"==b.response.createRequest.requestsType.value)&&d.go("reqFulfilLst",{requestId:a.requestStatus.createRequest.id,requestsType:a.requestStatus.createRequest.requestsType.value})},function(a){j.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})},a.uploadFile=function(b,c,d){var e=new Object;e.file=c.fileToBeUpload,e.orgLocId=a.requestStatus.createRequest.organization.id,e.docType=m.documentTypes.request,e.docSubType=m.documentSubTypes.requestFulfillment,e.isThumbnailRequired=!1,j.isNullOrEmpty(d.response)||(
//paramObject.recordId = successParentResponse.response;
e.resourceId=d.response),n.uploadFile(e,function(b){j.isNullOrEmpty(b)||(a.requestStatus.document={id:d.response},o.save(a.requestStatus,function(a){a&&g("success",a.successMessage)},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))}))},function(a){j.isNullOrEmpty(a.response)||viewUserVaccinationServices.deleteUserVaccinationById(successParentResponse.response,function(a){g("Error",h.instant("ERROR_WHILE_UPLOADING"))},function(a){g("Error",h.instant("ERROR_WHILE_UPLOADING"))})})},/*   $scope.viewPrintFile = function (ev, resource) {

        if (!utilService.isEmpty(resource)) {
            var fileObject = new Object();
            fileObject.fileName = resource.linkToTheFulfilmentFile;
            fileObject.orgLocId = $scope.requestStatus.createRequest.organization.id;
            fileObject.resourceId = resource.document.id;
            fileObject.docType = commonConstants.documentTypes.request;
            fileObject.docSubType = commonConstants.documentSubTypes.requestFulfillment;
            $scope.fileResource = fileObject;
            $scope.viewFileContent = true;
            $scope.isHidingPrintButton = !resource.whetherDownloadable;

        }
    };
*/
a.viewPrintFile=function(a,b){e.show({templateUrl:"app/modules/request-management/views/RequestManagementFilePopup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope","commonConstants","fileExtensionConstants",function(a,c,d){if(!j.isEmpty(b)){var f=new Object;f.fileName=b.linkToTheFulfilmentFile,f.orgLocId=b.createRequest.organization.id,f.resourceId=b.document.id,f.docType=c.documentTypes.request,f.docSubType=c.documentSubTypes.requestFulfillment,a.fileResource=f,a.viewFileContent=!0,a.isHidingPrintButton=!b.whetherDownloadable}a.viewFileContent=function(b,c){if(!j.isEmpty(b)){a.userId?b.userId=a.userId:b.userId=null;var d=angular.element(document.getElementById(c));d&&(d.attr("src",""),a.iframeCMP=d);var e,f={};
//obj.fileName = fileResource.fileName;
"video"==c?(b.isResource?(f.resourceId=b.resourceId,e=k.getParameterizedUrl("GET_RESOURCE_VIDEO",f)):(f.documentId=b.resourceId,e=k.getParameterizedUrl("GET_DOCUMENT_VIDEO",f)),d.attr("src",e),
//window.plugins.streamingMedia.playVideo(url);
//$(element).modal('hide');
angular.element(document.getElementById("audio-video-loader")).removeClass("audio-loader")):"audioPlayer"==c?(b.isResource?(f.resourceId=b.resourceId,e=k.getParameterizedUrl("GET_RESOURCE_AUDIO",f)):(f.documentId=b.resourceId,e=k.getParameterizedUrl("GET_DOCUMENT_AUDIO",f)),d.attr("src",e),
//window.plugins.streamingMedia.playAudio(url);
//$(element).modal('hide');
angular.element(document.getElementById("audio-video-loader")).removeClass("audio-loader")):(delete b.isResource,n.viewFileContent(b,function(a){j.isNullOrEmpty(a)||d&&(d.attr("src",a),angular.element(document.getElementById("audio-video-loader")).removeClass("audio-loader"))},function(a){}))}},a.$watch(function(){return a.fileResource},function(b){if(a.whetherPhoto)a.viewFileContent(a.fileResource,"viewPhotoImage");else if(!j.isNullOrEmpty(b)){var c=b.fileName.substring(b.fileName.lastIndexOf(".")+1,b.fileName.length).toLowerCase(),e=d.AUDIO,f=d.VIDEO,g=d.IMAGE;j.checkStringInArray(e,c)?(a.viewFileContent(a.fileResource,"reqAudioPlayer"),angular.element(document.getElementById("reqAudioPlayer")).css("display","block"),angular.element(document.getElementById("reqAudioPlayer")).addClass("audioPlayer"),angular.element(document.getElementById("reqViewFileFrame")).css("display","none"),angular.element(document.getElementById("reqVideo")).css("display","none"),angular.element(document.getElementById("reqImgTag")).css("display","none")):j.checkStringInArray(f,c)?(angular.element(document.getElementById("audio-video-loader")).addClass("audio-loader"),a.viewFileContent(a.fileResource,"reqVideo"),angular.element(document.getElementById("reqViewFileFrame")).css("display","none"),angular.element(document.getElementById("reqAudioPlayer")).removeClass("audioPlayer"),angular.element(document.getElementById("reqAudioPlayer")).css("display","none"),angular.element(document.getElementById("reqVideo")).css("display","block"),angular.element(document.getElementById("reqImgTag")).css("display","none")):j.checkStringInArray(g,c)?(a.viewFileContent(a.fileResource,"reqImgTag"),angular.element(document.getElementById("reqImgTag")).css("display","block"),angular.element(document.getElementById("reqViewFileFrame")).css("display","none"),angular.element(document.getElementById("reqAudioPlayer")).removeClass("audioPlayer"),angular.element(document.getElementById("reqAudioPlayer")).css("display","none"),angular.element(document.getElementById("reqVideo")).css("display","none")):(angular.element(document.getElementById("audio-video-loader")).addClass("audio-loader"),a.viewFileContent(a.fileResource,"reqViewFileFrame"),angular.element(document.getElementById("reqViewFileFrame")).css({display:"block",height:"500px"}),angular.element(document.getElementById("reqAudioPlayer")).removeClass("audioPlayer"),angular.element(document.getElementById("reqAudioPlayer")).css("display","none"),angular.element(document.getElementById("reqVideo")).css("display","none"),angular.element(document.getElementById("reqImgTag")).css("display","none"))}}),a.cancel=function(){e.cancel()},a.clear=function(){a.vprIncident={}}}]})},a.closePopUp=function(){$(element).modal("hide"),a.iframeCMP.attr("src","")},a.init=function(){F(),a.requestObject={},a.requestObject.module="requestId",a.requestObject.moduleNameAndUser="findAttachmentByRequestAndUser",a.requestObject.moduleName="deleteAttachmentsByRequestIdAndDocId",a.requestObject.forId=parseInt(c.requestId),a.requestObject.userId=u.userData().userId;var d={pathName:"findUsersByRequestId",id:a.requestObject.forId};if(v.getUsersByAppointmentOrRequestId(d,function(b){a.WScReqUserDetails.userList=b}),a.manageOrgLocSpinner=!0,""==c.id&&""!=c.scheduleId&&"requeststatus"==c.fromState&&(c.requestId=localStorage.getItem("requestStatusId"),c.id=localStorage.getItem("requestId"),c.type=localStorage.getItem("requestType"),localStorage.removeItem("requestStatusId"),localStorage.removeItem("requestId"),localStorage.removeItem("requestType")),"add"===c.type){a.pageState="add",a.chat=!1;var e={};e.id=c.requestId,a.viewId=e,s.getRequestId(e,function(b){j.isNullOrEmpty(b)||(a.requestStatus&&(a.requestStatus={}),a.requestStatus.createRequest=b,
// $scope.requestStatus.createRequest.id = successResponse.id;
//  =successResponse.id;
a.requestStatus.createRequest&&a.requestStatus.createRequest.organizationLocationId&&(a.requestStatus.createRequest.organization=a.requestStatus.createRequest.organizationLocationId),a.requestStatus.createRequest&&a.requestStatus.createRequest.requestDate&&(a.requestStatus.createRequest.requestDate=i("timestampToDate")(a.requestStatus.createRequest.requestDate,"MM/dd/yyyy")),a.requestStatus.createRequest&&a.requestStatus.createRequest.requestsType&&(a.reqType=a.requestStatus.createRequest.requestsType.value),a.requestStatus.createRequest&&a.requestStatus.createRequest.whetherBilled&&(a.requestStatus.isBillable=a.requestStatus.createRequest.whetherBilled)),c.appointmentId&&(a.requestStatus.appointmentId=c.appointmentId),a.getOnBehalfOfDetails()},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])?g("error",h.instant("RECORD_GENERATE_FAILURE")):g("Alert",h.instant(a.data.messages[0]))})}else"view"===c.type?(a.pageState="view",a.viewId=c.requestId,a.viewmode=!0,a.IsVisible=!0,a.disabled=!0):"edit"===c.type&&(a.viewmode=!1,a.viewId=c.requestId,a.fulfilstatusvisible&&(a.fulStatus=!0),a.pageState="edit",a.IsVisible=!0);c&&c.id&&("view"===c.type||"edit"===c.type)&&w.getFulfimentListById(c.id,function(d){a.stateParamValue=c.id,a.requestStatus=d,
// if($scope.requestStatus.appointmentId){
//     getclinicalForAppointmentId();
// }
//getCliniclList();
"diagnosis"==c.stateFlag?a.goToNextStep(2):"uploadDownload"==c.stateFlag&&a.goToNextStep(3),a.getOnBehalfOfDetails(),localStorage.setItem("WSRequestStatus",angular.toJson(a.requestStatus)),a.getNxtAppDate(),a.fulfilstatusvisible&&(a.fulStatus=!0),a.requestStatus.transaction&&a.requestStatus.transaction.id,b.loggedInUserDetails.isOrganizationUserMode?a.fulStatus=!1:a.fulStatus=!0,a.requestStatus.createRequest&&a.requestStatus.createRequest.requestsType&&(a.reqType=a.requestStatus.createRequest.requestsType.value),a.flag=!1,a.requestStatus.createRequest&&a.requestStatus.createRequest.whetherBilled&&(a.flag=!0)},function(b){a.manageOrgLocSpinner=!1,a.error=b,j.isEmpty(b.data)||j.isEmpty(error.data.messages[0])||g("error",h.instant(error.data.messages[0]))})},a.init(),H(),
// make prescription
a.makePrescription1=y.makePrescription,a.makePrescription=function(b,c,d,e,f,g,h,i){
// if(requestManagement.organization) {
if("undefined"==typeof g)var g=null;var f={};f.stateName="requestmgntlist";
//var appointmentId = null;
var h=null;a.makePrescription1(b,c,d,e,f,g,h,i)},a.getNxtAppDate=function(){if(a.requestStatus.createRequest&&a.requestStatus.createRequest.schedule&&a.requestStatus.createRequest.schedule.id){var b={};b.date=i("timestampToDate")(a.requestStatus.createdDate,"MM/dd/yyyy"),b.scheduleId=a.requestStatus.createRequest.schedule.id,l.getData(k.getParameterizedUrl("GET_SCHEDULE_DATE_BY_SCHEDULE_ID",b),null,function(b){b&&b.data&&(a.requestAppointmentDate=b.data)},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})}},a.getOnBehalfOfDetails=function(){var b={};b.userId=a.requestStatus.createRequest.onBehalfOf.id,l.getData(k.getParameterizedUrl("GET_USER_DETAILS",b),null,function(b){b&&b.data&&(a.onBehalfOfDetails=b.data)},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})},/************Appointment Starts***********/
a.setAppointment=function(){localStorage.setItem("requestStatusId",a.requestStatus.createRequest.id),localStorage.setItem("requestId",c.id),localStorage.setItem("requestType",c.type);var e={};e.parentState="requeststatus",// calling  State
// params.scheduleId = null;
// if(params.type =='add'){
//     params.scheduleId=null;
// }else{
//     params.scheduleId=$scope.requestStatus.createRequest.schedule;
// }
a.requestStatus.createRequest.schedule&&a.requestStatus.createRequest.schedule.id&&b.loggedInUserDetails.isOrganizationUserMode?(e.scheduleId=a.requestStatus.createRequest.schedule.id,e.type="edit"):a.requestStatus.createRequest.schedule&&a.requestStatus.createRequest.schedule.id&&!b.loggedInUserDetails.isOrganizationUserMode?(e.scheduleId=a.requestStatus.createRequest.schedule.id,e.type="view"):(e.scheduleId=null,e.type="add"),e.entityType={id:a.requestStatus.createRequest.id,value:"Organization User",code:"CAL_ORGANIZATION_USER"},"REQ_HOME_VISIT"==a.requestStatus.createRequest.requestsType.code&&(e.eventType={code:"CAL_EVENT_HOME_VISIT",id:a.requestStatus.createRequest.requestsType.id,value:"Home Visit"}),"REQ_ONLINE_ADVICE"==a.requestStatus.createRequest.requestsType.code&&(e.eventType={code:"CAL_EVENT_ONLINE",id:a.requestStatus.createRequest.requestsType.id,value:"Online Advice"}),e.serviceType={id:a.requestStatus.createRequest.treatmentType.id,value:a.requestStatus.createRequest.treatmentType.value},e.onBehalfOf={id:a.requestStatus.createRequest.onBehalfOf.id,value:a.requestStatus.createRequest.onBehalfOf.value},a.requestStatus.createRequest.healthProfessional&&(e.doctor={id:a.requestStatus.createRequest.healthProfessional.id,value:a.requestStatus.createRequest.healthProfessional.value}),e.problemDescription=a.requestStatus.createRequest.requestDescription,e.loggedInUserId=b.loggedInUserDetails.id,b.loggedInUserDetails&&b.loggedInUserDetails.cell1?e.onBehalfOfCellPhone=b.loggedInUserDetails.cell1:g("alert","User mobile does not exists"),b.loggedInUserDetails&&b.loggedInUserDetails.userAddressDTO&&b.loggedInUserDetails.userAddressDTO.addressLine1?e.onBehalfOfAddress=b.loggedInUserDetails.userAddressDTO.addressLine1:g("alert","User address does not exists"),
//params.onBehalfOfCellPhone = $scope.onBehalfOfDetails.cell1;
//params.onBehalfOfAddress = $scope.onBehalfOfDetails.userAddress.addressLine1;
d.go("managedefineschedule",e)},a.updateSchedule(),/************Appointment Ends***********/
/*************PaymentGateway Starts*****************/
a.paymentGateway=function(){1==b.loggedInUserDetails.isOrganizationUserMode?a.generateBill():a.paymentCall()},
// make payment manual method
a.generateBill=function(){if(a.requestStatus.transaction&&a.requestStatus.transaction.id){var b=[a.requestStatus.transaction.id];q.generateBill(b,function(a){g("success",a.successMessage),a.response&&d.go("managebill",{type:"view",billId:a.response,createReceipt:!0})},function(a){a.data&&a.data.messages&&a.data.messages.length>0?g("error",h.instant(a.data.messages[0])):g("error",h.instant("FAILED_TO_SAVE_RECORD"))})}},
//MAKE PAYMENT auto method
a.paymentCall=function(){var b={transactionId:a.requestStatus.transaction.id},c=a.requestStatus.createRequest.requestsType.code;p.getAutoBillDetails(b,c,function(b){localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:a.requestStatus.createRequest.requestsType.code})),d.go("billsummaryview",{transactionId:angular.fromJson(localStorage.getItem("WSRequestStatus")).transaction.id}),localStorage.removeItem("WSRequestStatus")},function(a){var b=e.confirm().title(h.instant("FEE_TYPE_NOT_FOUND_TITLE")).textContent(h.instant("FEE_TYPE_NOT_FOUND_BODY")).ok(h.instant("OK")).cancel(h.instant("CANCEL"));e.show(b).then(function(){},function(){d.go("requeststatus")})},{handleError:!1})},/*************PaymentGateway Ends *******************/
// for getting payable amount
/*$scope.getPayableAmount = function(){
        if($scope.requestStatus && $scope.requestStatus.transaction.id) {
            var payableAmount ={};
            payableAmount.locationId ='';
            payableAmount.serviceTypeId = $scope.requestStatus.createRequest.treatmentType.id;
            payableAmount.transProfUserId ='';
            payableAmount.transUserId = '';
            payableAmount.transactionTypeCode = $scope.requestStatus.createRequest.requestsType.code
                httpService.getData(urlService.getParameterizedUrl('SHOW_SERVICE_CHARGES', payableAmount), null, function (response) {
                    if (response && response.data) {
                        //$scope.donepayment=true;
                        $scope.requestStatus.paymentAmount = response.data.amount;
                        $scope.requestStatus.paymentId =response.data.id;
                    }
                }, function (error) {

                });
            }
        }
        $scope.getPayableAmount();*/
//for getting amount
a.getAmount=function(){if(a.requestStatus&&a.requestStatus.transaction.id){var b={};b.transactionId=a.requestStatus.transaction.id,l.getData(k.getParameterizedUrl("FIND_BILL_BY_TRANSACTION_ID",b),null,function(b){b&&b.data&&(a.donepayment=!0,a.requestStatus.paymentAmount=b.data.amount,a.requestStatus.paymentId=b.data.id)},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||g("Alert",h.instant("Bill Is Not Available"))})}},
//$scope.getAmount();
//view request
a.viewReq=function(){var a={};a=parseInt(c.requestId),
//viewstatreq.id = viewstatreq;
r.getRequestListById(a,function(b){var c=b;b&&d.go("createrequest",{id:a,type:"view",data:c})},function(a){})},/* function viewPrintFile(ev, resource) {
     if (!utilService.isEmpty(resource)) {
     var fileObject = new Object();
     fileObject.fileName = resource.linkToTheFulfilmentFile;
     fileObject.orgLocId = $rootScope.loggedInUserDetails.organizationId;
     fileObject.recordId = resource.id;
     fileObject.docType = commonConstants.documentTypes.request;
     fileObject.docSubType = commonConstants.documentSubTypes.requestFulfillment;
     $scope.fileResource = fileObject;
     $scope.viewFileContent = true;
     $scope.isHidingPrintButton = !resource.whetherDownloadable;
     /!*fileOperations.viewFileContent(fileObject,function (params) {

     }, function (errorResponse) {

     });*!/
     }
     };*/
a.downloadFile=function(a){if(!j.isEmpty(a)){var c=new Object;c.fileName=a.linkToTheFulfilmentFile,c.orgLocId=b.loggedInUserDetails.organizationId,c.recordId=a.id,c.docType=m.documentTypes.request,c.docSubType=m.documentSubTypes.requestFulfillment,n.downloadFile(c,function(a){a&&resourceListService.updateDownloadStatistics(c,function(a){},function(a){})},function(a){})}}}]),angular.module("paripal.requestManagementModule").controller("respondToReqCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","respondToRequestService","searchRequestManagementService","manageRequestService","httpService","urlService","utilService","applicationExceptionService","userStatusService","RequestDetails","appointmentsUploadDownloadService","commonConstants","datatableconfig","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){function A(c){a.requestObject.userId=c,b.$broadcast("getAttachmentList")}a.responseToRequest={},a.responseToRequest.requestId={},a.addRes=!0,a.reqType={},a.reqTypeCode="",a.responseToRequest.healthProfessional=a.data,a.commonConstants=x,a.selectedUser=A,a.WScReqUserDetails={},a.viewmode=!1,a.step1=!0,a.step2=!1,a.iconStep1=!0,a.iconStep2=!0,a.orgLocPermission=z.RESPOND_TO_REQUEST_ADD;var B=angular.element(document.querySelector("#wizard1")),C=angular.element(document.querySelector("#wizard2"));
//view functionality in response to request screen
if(a.goToNextStep=function(b){1==b?(a.step1=!0,a.step2=!1,B.addClass("btn-primary").removeClass("btn-default"),C.addClass("btn-default").removeClass("btn-primary")):2==b&&(a.step1=!1,a.step2=!0,C.addClass("btn-primary").removeClass("btn-default"),B.addClass("btn-default").removeClass("btn-primary"))},
//cancel
a.cancel=function(){v.viewReqDetail={},s.goBackToPrevState()},"view"==c.type){var D=c.id;n.getViewResponseId(D,function(b){if(b&&(a.viewmode=!0,a.responseToRequest=b,a.responseToRequest&&a.responseToRequest.requestId&&a.responseToRequest.requestId.requestsType&&(a.reqType=a.responseToRequest.requestId.requestsType.value,a.reqTypeCode=a.responseToRequest.requestId.requestsType.code),a.responseToRequest&&a.responseToRequest.mode)){var c=JSON.parse(a.responseToRequest.mode);a.responseToRequest.mode=c,a.mode=new Array;for(var d=0;a.responseToRequest.mode.length>d;d++)a.mode.push(a.responseToRequest.mode[d].id)}},function(a){})}
//save
a.save=function(){if(a.responseToRequest.requestId){var c=a.responseToRequest.requestId;delete a.responseToRequest.requestId,a.responseToRequest.requestId={},a.responseToRequest.requestId.id=c.id,a.responseToRequest.requestId.requestId=c.requestId,a.responseToRequest.requestId.requestDate=m.convertToServerDate(c.requestDate),a.responseToRequest.requestId.requestDescription=c.requestDescription,a.responseToRequest.requestId.initiator=c.initiator}
// if(!($scope.responseToRequest && $scope.responseToRequest.healthProfessional &&
//  $scope.responseToRequest.healthProfessional.id && ($scope.reqTypeCode=="REQ_HOME_VISIT"
//  || $scope.reqTypeCode=='REQ_ONLINE_ADVICE' ||$scope.reqTypeCode=="REQ_MEDICINE_AVAILABILITY"||$scope.reqTypeCode=="REQ_URGENT_CLARIFICATION"||$scope.reqTypeCode=="REQ_MEDICAL_CERTIFICATE"))){
//       notify("error","Please select Doctor/HealthProfessional");
//     return;
// }
if(a.responseToRequest&&a.responseToRequest.healthProfessional&&!a.responseToRequest.healthProfessional.id)return void h("error","Please select Doctor/HealthProfessional");if(a.responseToRequest&&a.responseToRequest.mode){var d=JSON.stringify(a.responseToRequest.mode);a.responseToRequest.mode=d}if(a.responseToRequest.responseId&&(a.responseToRequest.responseId=parseInt(a.responseToRequest.responseId)),a.responseToRequest.healthProfessional&&a.responseToRequest.healthProfessional.id){var e={};e.id=a.responseToRequest.healthProfessional.id,e.value=a.responseToRequest.healthProfessional.value,a.responseToRequest.healthProfessional=e}if(null==a.responseToRequest.reqAccepted&&(a.responseToRequest.reqAccepted=!1),null==a.responseToRequest.reqRejected&&(a.responseToRequest.reqRejected=!1),a.responseToRequest.organization&&a.responseToRequest.organization.id){var f={};f.id=a.responseToRequest.organization.id,f.value=a.responseToRequest.organization.value,a.responseToRequest.organization=f}b.showSpinner=!0,n.save(a.responseToRequest,function(a){s.isNullOrEmpty(a.successMessage)||
//getHealthProf(sucessResponse.healthProfessional.value);
h("success",i.instant(a.successMessage)),b.showSpinner=!1},function(a){s.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0])),b.showSpinner=!1}),v.viewReqDetail={}},
//view request
a.viewReq=function(b){v.viewReqDetail=angular.copy(a.responseToRequest),
//localStorage.setItem('respondToreq',JSON.stringify($scope.responseToRequest))
o.getRequestListById(b,function(a){var c=a;a&&d.go("createrequest",{id:b,type:"view",data:c})},function(a){})},
//init function
a.init=function(){a.requestObject={},a.requestObject.module="requestId",a.requestObject.moduleNameAndUser="findAttachmentByRequestAndUser",a.requestObject.moduleName="deleteAttachmentsByRequestIdAndDocId",a.requestObject.forId=parseInt(c.requestId),a.requestObject.userId=u.userData().userId;var b={pathName:"findUsersByRequestId",id:a.requestObject.forId};w.getUsersByAppointmentOrRequestId(b,function(b){a.WScReqUserDetails.userList=b}),"add"==c.type&&(a.orgLocPermission=z.RESPOND_TO_REQUEST_ADD),"edit"==c.type&&(a.orgLocPermission=z.RESPOND_TO_REQUEST_EDIT),n.getReqResListById(c.requestId,function(b){if(b&&b.length>0&&"view"===c.type&&(a.viewmode=!0,a.responseToRequest=b[0],a.responseToRequest&&a.responseToRequest.requestId&&a.responseToRequest.requestId.requestsType&&(a.reqType=a.responseToRequest.requestId.requestsType.value,a.reqTypeCode=a.responseToRequest.requestId.requestsType.code)),b&&b.length>0){if(c.type="edit",a.responseToRequest=b[0],a.responseToRequest.requestId&&a.responseToRequest.requestId.healthProfessional&&(a.responseToRequest.healthProfessional=b.healthProfessional),a.responseToRequest.requestId&&a.responseToRequest.requestId.organization&&(a.responseToRequest.organization=b.organization),a.responseToRequest&&a.responseToRequest.requestId&&a.responseToRequest.requestId.requestsType&&(a.reqType=a.responseToRequest.requestId.requestsType.value,a.reqTypeCode=a.responseToRequest.requestId.requestsType.code,"Urgent Clarification"==a.reqType||"Medical Certificate"==a.reqType?a.responseToRequest.organization=b.organization:a.getHealthProf=function(b){var c={};return c.orgLocationId=a.responseToRequest.organization.id,c.searchKeyword=b,a.userNameAutoCmpLoading=!0,q.getData(r.getParameterizedUrl("FIND_HEALTHPROFESSION_BY_ORGLOCATION",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.healthProfessional=b.data,a.healthProfessional},function(b){a.userNameAutoCmpLoading=!1,s.isEmpty(b.data)||s.isEmpty(b.data.messages[0])||h("Alert",i.instant(b.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}),a.responseToRequest&&a.responseToRequest.mode){var d=JSON.parse(a.responseToRequest.mode);a.responseToRequest.mode=d,a.mode=new Array;for(var e=0;a.responseToRequest.mode.length>e;e++)a.mode.push(a.responseToRequest.mode[e].id)}}else{c.type="add",a.addRes=!1;var f={};f.id=c.requestId,p.getRequestId(f,function(b){s.isNullOrEmpty(b)||(a.responseToRequest&&(a.responseToRequest={}),a.responseToRequest.requestId=b,null==a.responseToRequest.requestId.organization&&q.getData(r.getParameterizedUrl("GET_ACCESSABLE_LOC_NAME"),null,function(b){if(a.accessabelLocation=b.data,a.accessabelLocation&&!s.isEmpty(a.accessabelLocation)&&1==a.accessabelLocation.length?(a.LocationFlag=!0,a.responseToRequest.organization=a.accessabelLocation[0]):a.LocationFlag=!1,null==a.responseToRequest.requestId.healthProfessional){var c={};c.locationId=a.accessabelLocation[0].id,q.getData(r.getParameterizedUrl("FIND_PROFESSIONALS_BY_ACCESIBLE_LOCATION",c),null,function(b){a.LocationProfession=b.data,a.LocationProfession&&!s.isEmpty(a.LocationProfession)&&1==a.LocationProfession.length?(a.professionFlag=!0,a.responseToRequest.healthProfessional=a.LocationProfession[0],a.responseToRequest.healthProfessional&&a.responseToRequest.healthProfessional.value&&a.responseToRequest.healthProfessional.displayName&&(a.responseToRequest.healthProfessional.value=a.responseToRequest.healthProfessional.displayName)):a.professionFlag=!1},function(a){s.isEmpty(a.data)||s.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})}},function(a){s.isEmpty(a.data)||s.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))}),a.responseToRequest.requestId&&a.responseToRequest.requestId.requestDate&&(a.responseToRequest.requestId.requestDate=j("timestampToDate")(a.responseToRequest.requestId.requestDate)),a.responseToRequest.requestId&&a.responseToRequest.requestId.healthProfessional&&(a.responseToRequest.healthProfessional=b.healthProfessional),a.responseToRequest.requestId&&a.responseToRequest.requestId.organization&&(a.responseToRequest.organization=b.organization),a.responseToRequest.requestId&&a.responseToRequest.requestId.requestsType&&(a.reqType=a.responseToRequest.requestId.requestsType.value,a.reqTypeCode=a.responseToRequest.requestId.requestsType.code,"Urgent Clarification"==a.reqType||"Medical Certificate"==a.reqType?a.responseToRequest.organization=b.organization:a.getHealthProf=function(b){
// if($scope.responseToRequest.requestId.requestsType.code = 'REQ_HOME_VISIT'{
//     userObj.
// }
var c={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_HEALTHPROFESSION_BY_ORGLOCATION', userObj),null, function (response) {
return c.orgLocationId=a.responseToRequest.organization.id,c.searchKeyword=b,a.userNameAutoCmpLoading=!0,c.type=a.responseToRequest.requestId.requestsType.code,q.getData(r.getParameterizedUrl("FIND_HEALTHPROFESSION_BY_ORGLOCATION_AND_REQ_TYPE",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.healthProfessional=b.data,a.healthProfessional},function(b){a.userNameAutoCmpLoading=!1,s.isEmpty(b.data)||s.isEmpty(b.data.messages[0])||h("Alert",i.instant(b.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}))},function(a){s.isEmpty(a.data)||s.isEmpty(a.data.messages[0])?h("error",i.instant("RECORD_GENERATE_FAILURE")):h("Alert",i.instant(a.data.messages[0]))})}})},a.init(),
//multiple mode selection
a.getMode=function(){var b={};b.code="MODE",q.getData(r.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.modeSupports=b.data)},function(a){s.isEmpty(a.data)||s.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getMode(),
//organization smart search
a.getOrgName=function(b){var c={};return c.keyword=b,q.getData(r.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.organization=b.data,a.organization},function(a){s.isEmpty(a.data)||s.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}}]),angular.module("paripal.requestManagementModule").controller("responseRequestCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","manageBloodRequestServices","searchBloodRequestServices","utilService","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(b){a.selectedItem=b}function o(b){a.selectedType=b}a.step1=!0,a.step2=!1,a.responseRequest={},a.responseByDoctor=["sort by doctor name","sort by years of experience","sort by rating","sort by price low to high","sort by price high to low"],a.responseByOrg=["sort by organisation name","sort by rating","sort by price low to high","sort by price high to low"],a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.setItem=n,a.setType=o}]),angular.module("paripal.requestManagementModule").controller("responseRequestCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","requestResponseService","utilService","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(b){a.selectedItem=b}function n(b){a.selectedType=b}a.step1=!0,a.step2=!1,a.responseRequest={},a.addressFilter={},a.responseByDoctor=["sort by doctor name","sort by years of experience","sort by rating","sort by price low to high","sort by price high to low"],a.responseByOrg=["sort by organisation name","sort by rating","sort by price low to high","sort by price high to low"],a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=k.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return l.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){})},a.getDiseaseVariant=function(b){var c={};if(c.searchKeyWord=b,a.responseRequest&&a.responseRequest.disease)return c.diseaseId=a.responseRequest.disease.id,a.diseaseVariantLoad=!0,l.getData(k.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,j.isEmpty(b.data)||j.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})},
//Symptom method
a.getSymptom=function(b){return a.symptomName={},a.symptomName.searchKeyWord=b,a.symptomLoad=!0,l.getData(k.getParameterizedUrl("GET_SYMPTOMS",a.searchKeyWord),null,function(b){return a.symptomLoad=!1,a.symptomLoad=angular.fromJson(b.data)},function(b){a.symptomLoad=!1,j.isEmpty(b.data)||j.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SEARCH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})},a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",l.getData(k.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getSpecializations(),a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",l.getData(k.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){j.isEmpty(a.data)||j.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getSubbranch(),a.prevReq=function(){d.go("myReq")},a.cancel=function(){j.goBackToPrevState()},a.save=function(){i.save(a.responseRequest,function(a){j.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),d.go("createrequest"))},function(a){c.type="add",j.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})},a.setItem=m,a.setType=n}]),angular.module("paripal.requestManagementModule").controller("responseToRequestCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","requestResponseService","respondToRequestService","orgLocListService","utilService","urlService","httpService","serverSidePagination","dateconvertor","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(b){var c={to:b.responderName,from:a.createRequest.initiator.value,fromUserId:a.loginDetails.id,toUserId:b.responderId,topicType:"Request",topic:a.createRequest.id,subject:"Requester: "+a.createRequest.initiator.value+",  Responder : "+b.responderName+",  For Request Type : "+a.createRequest.requestsType.value+",  on Request Date: "+p.convertToViewDate(a.createRequest.requestDate)};d.go("msgconversation",{data:c})}function s(b){a.selectedItem=b}function t(b){a.selectedType=b}if(
//$scope.step1=true;
//$scope.step2=false;
a.responseToRequest={},a.addressFilter={},a.responseByDoctor=["sort by doctor name","sort by years of experience","sort by rating","sort by price low to high","sort by price high to low"],a.responseByOrg=["sort by organisation name","sort by rating","sort by price low to high","sort by price high to low"],a.getResponseList,a.responseRequests=[],a.responseRequest={},a.createRequest={},a.myRequest=c.id,a.currentPage=1,a.itemPerPage=10,a.toggleChangeStatus,a.hide=!1,a.orgList=[],a.msgSending=r,a.loginDetails=b.loggedInUserDetails,a.orgLogo={},a.userLogo={},c.id){var u=parseInt(c.id);a.response={},a.response.id=u,i.getRequestId(a.response,function(b){a.manageOrgLocSpinner=!1,a.createRequest=b,
//if($scope.createRequest.whether){}
b&&"Online Advice"==b.requestsType.value?a.step1=!0:(a.step1=!1,a.step2=!0)},function(b){a.manageOrgLocSpinner=!1,a.error=b})}a.seletedReq=function(){var b=parseInt(a.myRequest),c="";c="respond",d.go("respondtoReq",{requestId:b,type:c,data:a.responseRequest})},a.manageOrgLoc=function(b,c){a.orgLocListPageSpinner=!0,k.getOrganizationLocationById(b,function(e){a.orgLocListPageSpinner=!1;var f="view",g="manageorglocView";c&&(f="edit",g="manageorgloc");var h=e;d.go(g,{type:f,data:h,orgLocId:b})},function(b){a.orgLocListPageSpinner=!1,a.error=b,f("error",g.instant("FAILED_TO_LOAD_RECORD"))})},
//if($scope.createRequest.requestsType =='online Advice'){
a.getDocList=function(){a.responseRequest.pageNumber=a.currentPage,a.responseRequest.recordsPerPage=a.itemPerPage;var b=angular.copy(a.responseRequest);b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b.requestId=c.id,i.getDocList(b,function(b){b&&(a.responseRequests=b.data,a.responseRequests.forEach(function(a){var b=new Object;b.fileName=a.logoFileName,b.resourceId=a.logoDocumentId,b.organizationId=a.id,b.docType=q.documentTypes.orgLogo,b.docSubType=q.documentSubTypes.orgLogo,i.getImageUrl(b,function(b){a.logUrl=b})}),a.totalItems=b.totalRecords,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems))},function(a){l.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})},a.getDocList(),
//professionwall
a.manageProfessionalWall=function(a){d.go("",{callingUrl:"responsetorequest",userData:a})},
//accretiation
a.manageProfessionalAccreditations=function(a){d.go("manageprofessionalwall",{callingUrl:"responsetorequest",userData:a})},
// rating professionList
a.getStars=function(a){
// Get the value
// var val = parseFloat(rating);
// Turn value into number/100
// var size = val / 5 * 100;
// return size + '%';
null==a&&(a=0);var b=parseFloat(a),c=b/10*100;
// return size + '%';
return c+"%"},a.getCareRating=function(a,b,c){var d=0;if(null!=a){var e=b+c;d=a/e/2}return d},a.checkSelected=function(a){var b=!1;return a.whetherSelected&&(b=!0),b},a.checkAnyOneSelected=function(){var b=!1;return a.orgList.forEach(function(a){a.whetherSelected&&(b=!0)}),b},a.checkAnyOneHpSelected=function(){var b=!1;return a.responseRequests.forEach(function(a){a.whetherSelected&&(b=!0)}),b},
//if($scope.createRequest.requestsType =='Home Visit' ||$scope.createRequest.requestsType =='Other Requests' ){
a.getOrganisationList=function(){a.responseRequest.pageNumber=a.currentPage,a.responseRequest.recordsPerPage=a.itemPerPage;var b=angular.copy(a.responseRequest);b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,b.requestId=c.id,i.getOrganisationList(b,function(b){b&&(a.orgList=b.data,a.orgList.forEach(function(a){var b=new Object;b.fileName=a.logoFilePath,b.resourceId=a.logoDocumentId,
//fileObject.organizationId = response.id;
b.orgLocId=a.organizationLocationId,b.docType=q.documentTypes.orgLocLogo,b.docSubType=q.documentSubTypes.orgLocLogo,
//  fileObject.isCompressedVersion = true;
i.getImageUrl(b,function(b){""==b?a.logoUrl="app/images/billing/hospital.png":a.logoUrl=b})}),a.totalItems=b.totalRecords,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems))},function(a){l.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})},a.getOrganisationList(),a.getSpecializations=function(){var b={};b.code="supportProfSpecialization",n.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.specializations=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getSpecializations(),a.getState=function(b){a.queryObj={},a.queryObj.searchString=b,a.queryObj.countryId=a.createRequest.requestToBeLimitedToCountry.id;var c=m.getParameterizedUrl("GET_STATE_DATA",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.requestToBeLimitedToState=b.data,a.requestToBeLimitedToState},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getDistrict=function(b){a.queryObj={},a.queryObj.searchString=b,a.queryObj.stateId=a.createRequest.requestToBeLimitedToState.id;var c=m.getParameterizedUrl("GET_DISTRICT_DATA",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.requestToBeLimitedToDistrict=b.data,a.requestToBeLimitedToDistrict},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getCity=function(b){a.queryObj={},a.queryObj.searchString=b,a.queryObj.stateId=a.createRequest.requestToBeLimitedToState.id,a.queryObj.districtId=a.createRequest.requestToBeLimitedToDistrict.id;var c=m.getParameterizedUrl("GET_CITY_DATA",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.requestToBeLimitedToCity=b.data,a.requestToBeLimitedToCity},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getDiseaseVariant=function(b){var c={};if(c.searchKeyWord=b,a.responseRequest&&a.responseRequest.disease)return c.diseaseId=a.responseRequest.disease.id,a.diseaseVariantLoad=!0,n.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})},a.getSymptom=function(b){return a.symptomName={},a.symptomName.searchKeyWord=b,a.symptomLoad=!0,n.getData(m.getParameterizedUrl("GET_SYMPTOMS",a.searchKeyWord),null,function(b){return a.symptomLoad=!1,a.symptomLoad=angular.fromJson(b.data)},function(b){a.symptomLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SEARCH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})},/*$scope.selected=function(id){

        }*/
a.getSubbranch=function(){var b={};b.code="SUB_BRANCH",n.getData(m.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.subBranches=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getSubbranch(),a.prevReq=function(){d.go("myReq")},a.cancel=function(){l.goBackToPrevState()},a.viewrespond=function(a){i.getViewResponseId(a,function(a){a&&d.go("respondtoReq",{requestId:a.requestId.id,type:"view",data:a})},function(a){})},a.save=function(b){if(a.orgList.length>0){var c={};c.id=b.responseId,i.save(c,function(a){a&&(
//$scope.hide=true;
b.whetherSelected=!0,
//$scope.responseRequest[index].active = !$scope.responseRequest[index].active;
f("success",g.instant("RECORD_UPDATED_SUCCESS")))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("RECORD_UPDATE_FAILURE")):f("Alert",g.instant(a.data.messages[0]))})}else if(a.responseRequests.length>0){var c={};c.id=b.responseId,i.save(c,function(a){a&&(
//$scope.hide=true;
b.whetherSelected=!0,
//$scope.responseRequest[index].active = !$scope.responseRequest[index].active;
f("success",g.instant("RECORD_UPDATED_SUCCESS")))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",g.instant("RECORD_UPDATE_FAILURE")):f("Alert",g.instant(a.data.messages[0]))})}},a.getOrgLogo=function(a,b){var c=new Object;c.fileName=a.logoFileName,c.resourceId=a.logoDocumentId,"ORGANIZATION"==b?(c.organizationId=a.id,c.docType=q.documentTypes.orgLocLogo,c.docSubType=q.documentSubTypes.orgLocLogo):(c.userId=a.id,c.docType=q.documentTypes.userIdDocument,c.docSubType=q.documentSubTypes.profilePhoto),i.getImageUrl(c,function(a){return a})},a.setItem=s,a.setType=t}]),angular.module("paripal.requestManagementModule").controller("searchReqManagementCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","applicationExceptionService","MakePrescriptionFactory","searchRequestManagementService","respondToRequestService","datatableconfig","serverSidePagination","commonConstants","manageRequestService","GoogleMap","GeoCoder","NgMap","appointmentsListService","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){"use strict";function D(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,n.getData(o.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SERACH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})}function E(){
//update schedule id
if(c.scheduleId&&c.id){var a={};a.schedule={},a.schedule.id=c.scheduleId,a.id=c.id,
// createRequest1.requestStatus=$scope.createRequest.requestStatus;
// createRequest1.requestsType=$scope.createRequest.requestsType;
n.postData(o.getUrl("UPDATE_REQUEST_SCHEDULE"),a,function(a){a&&a.data||errorCallback(a)},function(a){errorCallback(a)})}}function F(){b.showSpinner=!0,R=angular.copy(a.requestManagement),R.pageNumber=a.currentPage,R.recordsPerPage=a.itemPerPage,R&&R.treatmentType&&(R.treatmentType=R.treatmentType.id),R&&R.requestDate&&(R.requestDate=m.convertToServerDate(R.requestDate)),R&&R.expiryDate&&(R.expiryDate=m.convertToServerDate(R.expiryDate)),R&&R.requestStatus&&R.requestStatus.length>0&&(R.requestStatus=J(R.requestStatus)),R&&R.requestType&&R.requestType.length>0&&(R.requestType=K(R.requestType)),R&&R.requestInitiator&&(R.requestInitiator=R.requestInitiator.id),
// filterRecords.topicType = "Request";
// filterRecords.topic = $scope.requestManagement.requestId;
// filterRecords.userId = $rootScope.loggedInUserDetails.id;
//"userId": $rootScope.loggedInUserDetails.id,
//"topicType": "Request",
//"topic": requestManagement.id,
s.getRequestList(R,function(c){c&&(
// for (var i = 0; sucessResponse.data.length > i; i++) {
// if($scope.loginDetails.organizationId==sucessResponse.data[i].organization.id){
// $scope.requestList = sucessResponse.data;
//                 $scope.totalItems = sucessResponse.totalRecords;
//                 $scope.pagingInfo = serverSidePagination($scope.currentPage, $scope.itemPerPage, $scope.totalItems);
//                     }
// }
//if((sucessResponse.subscriber) || (sucessResponse.notSubscriber) ||  (sucessResponse.forNonUser)){
a.requestList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=v(a.currentPage,a.itemPerPage,a.totalItems),b.showSpinner=!1)},function(a){p.isNullOrEmpty(a.data)||p.isNullOrEmpty(a.data.message[0])||(h("alert",i.instant(a.data.message[0])),b.showSpinner=!1)})}function G(a){var c=!1;return a&&b.loggedInUserDetails.id==a?c=!0:c}function H(a){var c={to:a.initiator.value,from:b.loggedInUserDetails.displayName,fromUserId:b.loggedInUserDetails.id,toUserId:a.initiator.id,topicType:"Request",topic:a.id,subject:"Requester: "+b.loggedInUserDetails.displayName+",  Responder: "+a.initiator.value+",  For Request Type : "+a.requestsType.value+",   on Request Date: "+m.convertToViewDate(a.requestDate)};d.go("msgconversation",{data:c})}function I(c){var d,e={};return e.searchString=c,a.userNameAutoCmpLoading=!0,d=b.loggedInUserDetails.userAccountStatusDTO.whetherDoctor?"FIND_USER_BY_REQUEST_INITIATOR":"GET_PATIENTS_LIST_BY_SEACRH_KEY",n.getData(o.getParameterizedUrl(d,e),null,function(b){
// $scope.users.forEach(function(element) {
// 	element.value=element.displayName;
// 	delete element.displayName;
// });
return a.userNameAutoCmpLoading=!1,a.users=b.data,a.users},function(b){a.userNameAutoCmpLoading=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])||h("error",i.instant(b.data.messages[0]))})}function J(a){var b=[];return a.forEach(function(a){b.push(a.id)}),b}
//multiple selection in requestType
function K(a){var b=[];return a.forEach(function(a){b.push(a.id)}),b}function L(b,c,e){s.getRequestListById(b,function(e){var f=e;f&&f.requestsType&&(a.reqType=f.requestsType.value),"edit"==c&&d.go("createrequest",{id:b,type:c,data:f}),"view"==c&&d.go("createrequest",{id:b,type:c,data:f}),"fulfilment"==c&&d.go("reqFulfilLst",{type:c,data:f,requestId:b,requestsType:f.requestsType.value})},function(a){})}function M(a){d.go("respondtoReq",{requestId:a})}
//getting accessabel system locations
function N(){n.getData(o.getParameterizedUrl("GET_ACCESSABLE_LOC"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})}function O(b){var c=!1;if(a.accessabelSystemLocation&&!p.isEmpty(a.accessabelSystemLocation))for(var d=0;d<a.accessabelSystemLocation.length;d++){if(a.accessabelSystemLocation[d]&&b&&a.accessabelSystemLocation[d]==b)return a.reqmgnt="ORG_SELECTED",c=!0;a.reqmgnt="ORG_SELECTED_FOR_OTHERS"}return c}function P(a,b,c){var d=angular.fromJson(localStorage.getItem("defaultOrgLoc"));
//$scope.newRequetsData = angular.fromJson(localStorage.getItem("CRequestData"));
a.createRequest={},c&&c.healthProfessional&&c.healthProfessional.id&&(a.createRequest.healthProfessional={id:c.healthProfessional.id,value:c.healthProfessional.value}),a.markAsSelected=function(a){var b={};b.id=a,b.status="REQ_STS_SELECTED";var c="UPDATE_REQUEST_STATUS";n.putData(o.getParameterizedUrl(c,b),null,function(a){!p.isNullOrEmpty(a)&&a.data&&(F(),h("success",i.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){p.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})},a.getHealthProf=function(b){var e={};return e.orgLocationId=d.id,e.searchKeyword=b,e.type=c.requestsType.code,e.treatmentType=c.treatmentType.id,a.userNameAutoCmpLoading=!0,n.getData(o.getParameterizedUrl("FIND_HEALTHPROFESSION_BY_ORGLOCATION_AND_TYPE_TREATMENT_TYPE",e),null,function(b){return a.userNameAutoCmpLoading=!1,b.data},function(b){a.userNameAutoCmpLoading=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])||h("Alert",i.instant(b.data.messages[0]))})},a.updateRequestProfessional=function(d){var e={};e=c,e.healthProfessional=d.healthProfessional,x.save(e,function(c){p.isNullOrEmpty(c.successMessage)||(c&&c.response&&a.markAsSelected(c.response.id),h("success",i.instant("RECORD_UPDATED_SUCCESS")),
//localStorage.removeItem("CRequestData");
b.cancel())},function(a){p.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})},a.cancel=function(){
//localStorage.removeItem("CRequestData");
b.cancel()}}function Q(a,c,d,e,f,g,j,k,l,m){function q(b){a.createRequest.end=angular.copy(b)}var r=angular.fromJson(localStorage.getItem("defaultOrgLoc"));a.requestType=d,a.notNewUser=!1,a.getTillDate=q,a.createRequest={},a.createRequest.isConfirmed=!1,a.createRequest.isLead=!0,a.leadChange=function(){0==a.createRequest.isLead&&(a.createRequest.isConfirmed=!0)},a.cancel=function(){c.cancel()},a.getTreatmentType=function(b){var c;
//                    if($scope.createRequest.requestsType.value=="Medical Certificate" ||  $scope.createRequest.requestsType.value=="Medicine Availability"){
// //                        url='GET_SUPPORT_SERVICE_TREATMENT_TYPE_BY_KEY_WORD';
//                        return null;
//                    }
return a.searchKeyWord={},a.searchKeyWord.name=b,a.searchKeyWord.orgLocId=r.id,a.treatmentTypeLoad=!0,"REQ_HOME_VISIT"!=d&&"REQ_ONLINE_ADVICE"!=d&&"REQ_URGENT_CLARIFICATION"!=d&&"REQ_OTHER_REQUEST"!=d&&"REQ_GENERAL_ENQUIRY"!=d||(a.searchKeyWord.flag=!1,"REQ_OTHER_REQUEST"==d&&(a.searchKeyWord.flag=!0),c="TREATMENT_TYPE_AND_SUPPORT_SERVICE_FLAG_AND_ORGLOCID"),n.getData(o.getParameterizedUrl(c,a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])?h("error",i.instant("RECORD_SERACH_FAILURE")):h("Alert",i.instant(b.data.messages[0]))})},a.checkNewUser=function(){a.createRequest&&a.createRequest.onBehalfOf&&a.createRequest.onBehalfOf.id?(a.notNewUser=!1,a.getAddressForOnBehalfOf(a.createRequest.onBehalfOf.id)):a.notNewUser=!0},a.getAddressForOnBehalfOf=function(b){var c={};c.userId=b,e.getAddressByUserId(c,function(b){b&&(b.addressLine1&&b.addressLine2&&b.addressLine3?a.createRequest.address=b.addressLine1+","+b.addressLine2+","+b.addressLine3+","+b.city.value+","+b.district.value+","+b.state.value+","+b.country.value+","+b.postalCode:b.addressLine1&&b.addressLine2?a.createRequest.address=b.addressLine1+","+b.addressLine2+","+b.city.value+","+b.district.value+","+b.state.value+","+b.country.value+","+b.postalCode:b.addressLine1&&(a.createRequest.address=b.addressLine1+","+b.city.value+","+b.district.value+","+b.state.value+","+b.country.value+","+b.postalCode))},function(a){})},a.getOnBehalfOf=function(b){a.userData={},a.userData.organizationLocationId=0,a.userData.searchKeyWord=b,a.userNameAutoCmpLoading=!0;var c;return c="FIND_CLIENT_BY_ORG_LOC_ID",n.getData(o.getParameterizedUrl(c,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},
//$scope.getHealthProf = function () {
a.getHealthProf=function(b){var c={};
//                FIND_HEALTHPROFESSION_BY_ORGLOCATION_AND_TYPE
return c.orgLocationId=r.id,c.searchKeyword=b,c.type=g.code,c.treatmentType=a.createRequest.treatmentType.id,a.userNameAutoCmpLoading=!0,n.getData(o.getParameterizedUrl("FIND_HEALTHPROFESSION_BY_ORGLOCATION_AND_TYPE_TREATMENT_TYPE",c),null,function(b){return a.userNameAutoCmpLoading=!1,b.data},function(b){a.userNameAutoCmpLoading=!1,p.isEmpty(b.data)||p.isEmpty(b.data.messages[0])||h("Alert",i.instant(b.data.messages[0]))})},a.getSelectedStatus=function(){var c={};c.pickListCode="REQUEST_STATUS",c.pickListItemCode="REQ_STS_SELECTED",e.getPicklistWSByCode(c,function(b){a.selectedrequestStatus=b.data},function(a){b.showSpinner=!1})},a.getSelectedStatus(),a.saveCreateRequest=function(){b.showSpinner=!0;
//if (row && !broadcast) {
var d=angular.fromJson(localStorage.getItem("defaultOrgLoc"));
//}
if(a.createRequest.organization={id:d.id,value:d.value},a.createRequest&&a.createRequest.referralAmount&&!a.createRequest.referrerName)return b.showSpinner=!1,void h("Alert","Please Enter Referrer Name");a.createRequest.requestDate=j("date")(new Date,"yyyy-MM-dd");m.getLoggedInUser();if(a.createRequest.onBehalfOf&&a.createRequest.onBehalfOf.id&&(a.createRequest.initiator={id:a.createRequest.onBehalfOf.id,value:a.createRequest.onBehalfOf.value}),a.createRequest.requestStatus=a.selectedrequestStatus,a.createRequest.requestsType=g,a.createRequest.broadcast=l,
//This flag is set to false for org user who creates create request
a.createRequest.isIndividualCreated=!1,a.createRequest.onBehalfOf&&!a.createRequest.onBehalfOf.id){a.createRequest.isNewUser=!0;var f=a.createRequest.onBehalfOf.split(" ");if(void 0==f[1])return b.showSpinner=!1,void h("Alert","Please Enter Last Name");a.createRequest.userBasicDetails={},a.createRequest.userBasicDetails.userId=null,a.createRequest.userBasicDetails.firstName=f[0],a.createRequest.userBasicDetails.lastName=f[1],a.createRequest.userBasicDetails.userAddress=a.createRequest.address,a.createRequest.userBasicDetails.userPhone=a.createRequest.phoneNumber}e.save(a.createRequest,function(a){b.showSpinner=!1,h("success",i.instant("MSG_WITH_REQUEST_ID")+a.response.requestId),c.cancel(),F()},function(a){b.showSpinner=!1})}}P.$inject=["$scope","$mdDialog","requestMgmt"],Q.$inject=["$scope","$mdDialog","requestType","manageRequestService","requestStatus","requestsType","$filter","addressInfoFilter","broadcast","baseService"],a.requestManagement={},a.currentPage=1,a.itemPerPage=10,a.minDate=new Date,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.getRequestList=F,a.respondToReq=M,a.manageRequest=L,a.checkEditPermission=G,a.reqType={},a.getAccessabelSystemLocation=N,a.checkOrganizationLocationAccess=O,a.user=angular.fromJson(localStorage.getItem("loggedInUser")),a.msgSending=H,a.loginDetails=b.loggedInUserDetails,a.updateSchedule=E,a.getTreatmentType=D,a.getUserNamesForRoleHistory=I,a.requestManagement.isLead=!1;var R;a.user&&(a.userId=a.user.id),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,a.loginDetails.isOrganizationUser&&(a.locationCategory=angular.fromJson(localStorage.getItem("locationCategory"))),a.getRequestStatus=function(){var b={};b.code="REQUEST_STATUS",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.requestStatuses=b.data)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getRequestStatus(),
//dropdown for Request type
a.getRequestTypes=function(){var b={};b.code="REQUEST_TYPE",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.requestTypes=b.data,c.requestType&&(a.requestManagement.requestType=a.requestTypes.filter(function(a){return a.code==c.requestType}))),F()},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getRequestTypes(),a.updateSchedule(),a.viewAppointment=function(a){d.go("manageFixAppointment",{
//id: apptId,
id:2894,type:"view"})},a.manageAppointmentForm=function(a,b,c,e,f){var g={appointmentType:c};a&&a.id&&(g.appointmentId=a.id),g.urlState=b,f.entityType?g.entityType=f.entityType:a.entityType&&a.entityTypeId&&(g.entityType={id:a.entityTypeId,code:a.entityType}),f.entityName?g.entityName=f.entityName:a.entityId&&a.entityName&&(g.entityName={id:a.entityId,value:a.entityName}),f.eventType?g.eventType=f.eventType:a&&a.eventType&&(g.eventType=a.eventType),f.eventName&&f.eventName.id?g.eventName=f.eventName:a&&a.event&&(g.eventName=a.event),g.appDate=new Date,g.clientId=f.clientId,g.requestId=f.requestId,
//if (!utilService.isNullOrEmpty(row) && !utilService.isNullOrEmpty(row.organizationLocationId)) {
// $scope.organizationDetails = baseService.getDefaultOrgLocation();
// params.orgLocation = $scope.organizationDetails.orgLoc.id;
// params.locationName = $scope.organizationDetails.orgLoc.value;
//} else if ($scope.WSAppoinrmentList[0]) {
// params.orgLocation = $scope.WSAppoinrmentList[0].organizationLocationId;
// params.locationName = $scope.WSAppoinrmentList[0].locationName;
//}debugger;
d.go(b,g)},
// /************Appointment Starts***********/CAL_EVENT_ONLINE
a.setAppointment=function(c){if(a.locationCategory&&"SERVICE_PROVIDER_HO"==a.locationCategory.code&&a.loginDetails.isOrganizationUser&&"REQ_OTHER_REQUEST"==c.requestsType.code){c.latestAppointmentId&&d.go("manageFixAppointment",{appointmentId:c.latestAppointmentId,type:"view"});
//$scope.manageAppointmentForm(null, 'manageAppointmentWalkIn', 'RECORDWALKIN', null);
var e={};e.pickListCode="calendarEntityType",e.pickListItemCode="CAL_ORGANIZATION_USER",x.getPicklistWSByCode(e,function(b){var d={};d.appDate=new Date,d.appointmentType="RECORDWALKIN",d.urlState="manageAppointmentWalkIn",d.entityType=b.data,d.entityName={id:c.healthProfessional.id,value:c.healthProfessional.value},d.clientId=c.onBehalfOf.id,d.requestId=c.id,a.manageAppointmentForm(null,"manageAppointmentWalkIn","RECORDWALKIN",null,d)},function(a){})}else{var f={};f.parentState="requestmgntlist",// calling  State
f.parentType="list",f.parentId=c.id,c.schedule&&c.schedule.id?(f.scheduleId=c.schedule.id,f.type="edit"):(f.scheduleId=null,f.type="add"),f.entityType={id:c.id,value:"Organization User",code:"CAL_ORGANIZATION_USER"},f.requestId=c.id,"REQ_HOME_VISIT"==c.requestsType.code&&(f.eventType={code:"CAL_EVENT_HOME_VISIT",id:c.requestsType.id,value:"Home Visit"}),"REQ_ONLINE_ADVICE"==c.requestsType.code&&(f.eventType={code:"CAL_EVENT_ONLINE",id:c.requestsType.id,value:"Online Advice"}),f.serviceType={id:c.treatmentType.id,value:c.treatmentType.value},f.onBehalfOf={id:c.onBehalfOf.id,value:c.onBehalfOf.value},c.start&&(f.fromDate=c.start),c.end&&(f.tillDate=c.end),c.healthProfessional&&(f.doctor={id:c.healthProfessional.id,value:c.healthProfessional.value}),
//params.onBehalfOfAddress = requestManagement.address;
f.problemDescription=c.requestDescription,f.loggedInUserId=b.loggedInUserDetails.id,b.loggedInUserDetails&&b.loggedInUserDetails.cell1?f.onBehalfOfCellPhone=b.loggedInUserDetails.cell1:h("alert","User mobile does not exists"),
//if($rootScope.loggedInUserDetails && $rootScope.loggedInUserDetails.userAddressDTO && $rootScope.loggedInUserDetails.userAddressDTO.addressLine1){
//  params.onBehalfOfAddress = $rootScope.loggedInUserDetails.userAddressDTO.addressLine1;
//}
c&&c.address?f.onBehalfOfAddress=c.address:h("alert","User address does not exists"),d.go("managedefineschedule",f)}},c.userId&&(a.requestManagement.requestInitiator={},a.requestManagement.requestInitiator.value=c.userName,a.requestManagement.requestInitiator.id=c.userId),c.userId&&a.getRequestList(),c.requestType&&(a.status={open:!1},/*$scope.requestManagement.requestType=[];
        $scope.requestManagement.requestType[0]={};
        $scope.requestManagement.requestType[0].id=$stateParams.requestType;*/
a.requestTypeCode=c.requestType),a.makePrescription1=r.makePrescription,a.makePrescription=function(b,c,d,e){
// if(requestManagement.organization) {
var f={};f.stateName="requestmgntlist",a.makePrescription1(b,c,d,e,f)},a.clear=function(){a.requestManagement={},a.requestManagement.isLead=!1,F()},N(),a.pageChanged=function(){a.pagingInfo=v(a.currentPage,a.itemPerPage,a.totalItems),F()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,F()};
//data table config
var S=w.gridConfigurations;a.options=u.setOptionProperties(S),a.dtColumnDefs=u.setColumnProperties({}),a.markAsFulfilled=function(a){var b={};b.id=a,b.status="REQ_STS_REQUEST_FULFILED";var c="UPDATE_REQUEST_STATUS";n.putData(o.getParameterizedUrl(c,b),null,function(a){!p.isNullOrEmpty(a)&&a.data&&(F(),h("success",i.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){p.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})},a.markAsSelected=function(a){var b={};b.id=a,b.status="REQ_STS_SELECTED";
//myreqlst.isConfirmed = true;
// var url = 'UPDATE_REQUEST_STATUS_SELECTED';
var c="UPDATE_REQUEST_STATUS";n.putData(o.getParameterizedUrl(c,b),null,function(a){!p.isNullOrEmpty(a)&&a.data&&(F(),h("success",i.instant("RECORD_UPDATED_SUCCESSFULLY")))},function(a){p.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})},a.markAsConfirmed=function(c){var d={};d=c,d.isConfirmed=!0,
//$scope.markAsSelected(requestMgmt.id);
x.save(d,function(c){b.showSpinner=!1,h("success",i.instant("RECORD_UPDATED_SUCCESS")),
//$mdDialog.cancel();
c&&c.response&&a.markAsSelected(c.response.id)},function(a){b.showSpinner=!1})},a.reportScreen=function(){d.go("organizationRequestStatistics")},a.requestForHomeVisit=function(){a.broadcast=!1,b.showSpinner=!0,a.type=c.requestType;var d={};d.pickListCode="REQUEST_TYPE",d.pickListItemCode=a.type,x.getPicklistWSByCode(d,function(c){a.requestsType=c.data,d.pickListCode="REQUEST_STATUS",d.pickListItemCode="REQ_STS_NEW",x.getPicklistWSByCode(d,function(c){a.requestStatus=c.data,b.showSpinner=!1,a.openPopup()},function(a){b.showSpinner=!1})},function(a){b.showSpinner=!1}),a.createRequest={}},a.createRequestDownload=function(a){e.show({
//controller: ShowProfessionalAvailabilityCtrl,
templateUrl:"app/modules/request-management/views/createRequestExcelDownloadPopup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{stateParams:c},controller:["$scope","stateParams","$http",function(a,d,f){a.createRequest={};var g=angular.fromJson(localStorage.getItem("defaultOrgLoc"));null!=g&&(a.createRequest.partyName={},a.createRequest.partyName.orgLocation={id:g.id,value:g.value}),a.getPartyNameData=function(a){var c={};if(b.isLoggedIn&&b.loggedInUserDetails.isOrganizationUser)return c.keyword=a,n.getData(o.getParameterizedUrl("FIND_ACCESSIBLE_ORG_LOC_BY_KEY",c),null,function(a){return angular.fromJson(a.data)},function(a){})},c.requestType&&(a.requestTypeCode=c.requestType),a.cancel=function(){e.cancel()},a.getRequestType=function(){var b={};b.code="REQUEST_TYPE",n.getData(o.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.requestType=b.data)},function(a){p.isEmpty(a.data)||p.isEmpty(a.data.messages[0])||h("error",i.instant(a.data.messages[0]))})},a.getRequestType(),a.downloadFile=function(a,b,c){var d=d||function(a){if(!("undefined"==typeof a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var o,p=this,q=b.type,r=q===j,s=function(){m(p,"writestart progress write writeend".split(" "))},t=function(){if((h||r&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;"),c=a.open(b,"_blank");c||(a.location.href=b),b=void 0,p.readyState=p.DONE,s()},d.readAsDataURL(b),void(p.readyState=p.INIT)}if(o||(o=c().createObjectURL(b)),r)a.location.href=o;else{var e=a.open(o,"_blank");e||(a.location.href=o)}p.readyState=p.DONE,s(),l(o)};return p.readyState=p.INIT,e?(o=c().createObjectURL(b),void setTimeout(function(){d.href=o,d.download=i,f(d),s(),l(o),p.readyState=p.DONE})):void t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=d:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return d});var g=o.getUrl("GET_CREATE_REQUEST_TEMPLATE"),h=a.requestsTypeName.id,i=Date.parse(a.startDate),j=Date.parse(a.endDate),k=a.partyName.orgLocation.id;g=g+"/"+k+"/"+h+"/"+i+"/"+j,f({url:g,method:"POST",data:{},//this is your json data string
headers:{"Content-type":"application/json"},responseType:"arraybuffer"}).success(function(a,b,c,f){var g="CreateRequestTemplate.xls",h=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});d(h,g),e.cancel()}).error(function(a,b,c,d){})}}]})},a.selectHealthProfessional=function(a){
//localStorage.setItem("CRequestData", angular.toJson(requestManagement));
e.show({controller:P,templateUrl:"app/modules/request-management/views/select-professional-other-action-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{requestMgmt:a}})},a.init=function(){c.requestType&&("REQ_HOME_VISIT"==c.requestType?a.filterName="Home Visit Request":"REQ_OTHER_REQUEST"==c.requestType?a.filterName="Other Request":"REQ_ONLINE_ADVICE"==c.requestType?a.filterName="Online Advice Request":"REQ_URGENT_CLARIFICATION"==c.requestType?a.filterName="Urgernt Cllarification Request":"REQ_GENERAL_ENQUIRY"==c.requestType?a.filterName="General Enquiry Request":"REQ_MEDICINE_AVAILABILITY"==c.requestType?a.filterName="Medicine Availability Request":"REQ_MEDICAL_CERTIFICATE"==c.requestType?a.filterName="Medical Certificate Request":a.filterName="")},a.init(),a.openPopup=function(){e.show({controller:Q,templateUrl:"app/modules/request-management/views/create-request-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{requestType:a.type,manageRequestService:x,requestStatus:a.requestStatus,requestsType:a.requestsType,addressInfoFilter:a.addressInfoFilter,broadcast:a.broadcast}})},A.getMap().then(function(b){k(function(){a.map=b},0),b.addListener("zoom_changed",function(){12!==b.getZoom()&&b.setZoom(12)})}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.locationPopup=function(a){e.show({templateUrl:"app/modules/request-management/views/request-management-Maps-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{address:a},controller:["$scope","$mdDialog","locals","manageUserTreatmentService","SearchHospitalService","orgLocListService",function(a,b,c,d,e,f){function g(a){var b=new google.maps.Geocoder,c={};b.geocode({address:a},function(a,b){b==google.maps.GeocoderStatus.OK&&(c.latitude=a[0].geometry.location.lat(),c.longitude=a[0].geometry.location.lng()),i(c.latitude,c.longitude)})}a.filterCriteria={},a.filterCriteria.organization={},a.filterCriteria.radius=2e3,a.filterCriteria.slider=2;var h=c.address;a.getLatLngFromAddress=g,A.getMap().then(function(b){k(function(){a.map=b},0),b.addListener("zoom_changed",function(){12!==b.getZoom()&&b.setZoom(12)})}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.cancel=function(){b.hide()},a.init=function(){g(h)},a.init();var i=function(b,c){a.filterCriteria.addressLattitudes=b,a.filterCriteria.addressLongitudes=c;var d={latLng:new google.maps.LatLng(b,c)};a.changeLocation(d)};a.changeLocation=function(b){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filterCriteria.addressLattitudes=b.latLng.lat(),a.filterCriteria.addressLongitudes=b.latLng.lng(),a.locationChanged=!0,a.isFiltered=!1,e.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,addressLattitudes:b.latLng.lat(),addressLongitudes:b.latLng.lng()}}),a.currentLocationObject={organizationLocationAddressId:1e8,organizationLocationId:0,location:[a.filterCriteria.addressLattitudes,a.filterCriteria.addressLongitudes],isDraggable:!1,organizationTypeIcon:a.marker,isSelected:!1,id:0,displayName:"You dragged here"}}}]})},a.goToUploadDownload=function(a){d.go("createrequest",{id:a.id,type:"edit",data:a,stateFlag:"uploadDownload"})},
/////Appointment list summary method
a.addEditAppointmentSummary=function(a){if(a&&a.latestAppointmentId){var b={};b=a.latestAppointmentId,B.getSummaryByApptId(b,function(b){""!=b.data?e.show({controller:"AppointmentSummaryCtrl",templateUrl:"app/modules/appointment/views/appointment-summary.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{summaryObj:b.data,appointmentId:{id:a.latestAppointmentId}}}).then(function(a){},function(a){a&&d.reload()}):e.show({controller:"AppointmentSummaryCtrl",templateUrl:"app/modules/appointment/views/appointment-summary.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{summaryObj:null,appointmentId:{id:a.latestAppointmentId}}}).then(function(a){},function(a){a&&d.reload()})},function(a){})}}}]),angular.module("paripal.requestManagementModule").controller("visitscheduleCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","fileReader","notify","$translate","$filter","manageBloodRequestServices","searchBloodRequestServices","utilService","urlService","httpService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.visitSchedule={},a.frequency={Weekly:"Weekly",Daily:"Daily",Adhoc:"Adhoc","Defined per Visit":"Defined per Visit","Single Appointment":"Single Appointment"},a.changeFrequency=function(b){"Weekly"==b&&(a.frequencyWeekly=!0,a.frequencyDaily=!1,a.frequencyAdhoc=!1,a.frequencyDefinedPerVisit=!1,a.frequencySingleAppointment=!1),"Daily"==b&&(a.frequencyWeekly=!1,a.frequencyDaily=!0,a.frequencyAdhoc=!1,a.frequencyDefinedPerVisit=!1,a.frequencySingleAppointment=!1),"Adhoc"==b&&(a.frequencyWeekly=!1,a.frequencyDaily=!1,a.frequencyAdhoc=!0,a.frequencyDefinedPerVisit=!1,a.frequencySingleAppointment=!1),"Defined per Visit"==b&&(a.frequencyWeekly=!1,a.frequencyDaily=!1,a.frequencyAdhoc=!1,a.frequencyDefinedPerVisit=!0,a.frequencySingleAppointment=!1),"Single Appointment"==b&&(a.frequencyWeekly=!1,a.frequencyDaily=!1,a.frequencyAdhoc=!1,a.frequencyDefinedPerVisit=!1,a.frequencySingleAppointment=!0)},a.addNewVisitSchedule=function(){d.go("  ",{type:""})};
//data table config
var p=o.gridConfigurations;a.options=e.setOptionProperties(p),a.dtColumnDefs=e.setColumnProperties({})}]),angular.module("paripal.requestManagementModule").controller("visitScheduleExpCtrl",["$scope","$rootScope","$stateParams","$state","$mdDialog","$mdMedia","fileReader","notify","$translate","$filter","$timeout","$q","dateconvertor","httpService","urlService","utilService","applicationExceptionService","visitScheduleExceptionservice","datatableconfig","serverSidePagination","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(){var b=angular.copy(a.visitScheduleExp);/*if(!filterRecords)
    		{
    		filterRecords = {};
    		}*/
b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,r.getScheduleList(b,function(b){b&&(a.scheduleList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=t(a.currentPage,a.itemPerPage,a.totalItems))},function(a){p.isNullOrEmpty(a.data.message[0])||h("alert",i.instant(a.data.message[0]))})}function w(a,b){r.getScheduleListById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("managebloodreq",{id:a,type:e,data:f})},function(a){})}
//$scope.dateList=[{name:"06/12/2016"}]
a.visitScheduleExp={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.getScheduleListById=w,a.getScheduleList=v,a.addNewSchedule=function(){d.go("definevisitschedule",{type:""})},a.getScheduleList(),a.pageChanged=function(){a.pagingInfo=t(a.currentPage,a.itemPerPage,a.totalItems),a.getRequestList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getScheduleList()};var x=u.gridConfigurations;a.options=s.setOptionProperties(x),a.dtColumnDefs=s.setColumnProperties({}),a.clear=function(){a.WSOrganizationSearchCriteria={},a.visitScheduleExp={},a.getScheduleList()}}]),angular.module("paripal.requestManagementModule").factory("RequestDetails",function(){var a=[],b={};return{ReqDetails:a,viewReqDetail:b}}),angular.module("paripal.requestManagementModule").service("organizationService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict"}]),angular.module("paripal.requestManagementModule").service("adviceTransactionViewservice",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateRequestCreated=e("timestampToDate")(a.dateRequestCreated,b),a.whenNeeded=e("timestampToDate")(a.whenNeeded,b)})};this.getTransactionList=function(c,d,e){a.getData(b.getParameterizedUrl("GET_TRANSACTIONLIST_BY_REQ_ID",c),null,function(a){a&&a.data?(f(a.data.data),d(a.data)):e(a)},function(a){e(a)})},
//getby requestid 
this.getDataByRequestId=function(c,d,e){a.getData(b.getParameterizedUrl("GET_REQUEST_LIST_BY_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule").service("healthProfessionalService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.save=function(c,d,e){var f="";f=null!=c.id?"UPDATE_REQUEST":"SAVE_REQUEST",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule").service("manageRequestAttachmentService",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){}]),angular.module("paripal.requestManagementModule").service("manageRequestService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.save=function(c,e,f){c.requestDate=d.convertToServerDate(c.requestDate),c.expiryDate=d.convertToServerDate(c.expiryDate),c.start&&""!=c.start&&(c.start=d.convertToServerDate(c.start)),c.end&&""!=c.end&&(c.end=d.convertToServerDate(c.end)),c.fulfilledOn&&""!=c.fulfilledOn&&(c.fulfilledOn=d.convertToServerDate(c.fulfilledOn)),c.completedOn&&""!=c.completedOn&&(c.completedOn=d.convertToServerDate(c.completedOn));var g="";g=null!=c.id?"UPDATE_REQUEST":"SAVE_REQUEST",a.postData(b.getUrl(g),c,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},
//previous request save
this.savePrevReq=function(c,d,e){var f="";f="SAVE_PREVIOUS_REQUEST",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},
//primary key id
this.getRequestId=function(c,d,e){var f={};f.id=c.id,a.getData(b.getParameterizedUrl("GET_REQUEST_LIST_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},
//picklist getby id
this.getPicklistById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("FIND_PICKLIST_BY_ID",f),null,function(a){
//var dateFormat = 'MM/dd/yyyy';
a&&a.data?d(a.data):e(a)},function(a){e(a)})},
//Link to previous request id add
this.getPrevRequestId=function(c,d,e){a.postData(b.getUrl("GET_PREV_REQUEST_LIST_BY_ID"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deletePrevRequestId=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_PREV_REQUEST_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getpreviousReqId=function(c,d,e){a.getData(b.getParameterizedUrl("GET_PRE_REQUEST_LIST_BY_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},
//Non-User key id
this.getNonuserId=function(c,d,e){a.getData(b.getParameterizedUrl("GET_NON_USER_DETAIL_BY_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},
//auto generated
this.generateRequestId=function(c,d){a.getData(b.getUrl("GET_REQUEST_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},
//HealthProfessional list popup
this.getHpList=function(c,d,e){a.postData(b.getUrl("SEARCH_HEALTHPROFESSION_LIST_FINDBY_CRITERIA"),c,function(a){a&&a.data?
// convertListOfDate(response.data.data);
d(a.data):e(a)},function(a){e(a)})},
//  GETTING ORG WALL
this.getOrganizationById=function(c,d,e){var f={};f.organizationId=c,a.getData(b.getParameterizedUrl("GET_ORG_BY_ID",f),null,function(a){a&&a.data?
// response.data.commencementDate = $filter('timestampToDate')(response.data.commencementDate, 'MM/dd/yyyy');
d(a.data):e(a)},function(a){e(a)})},this.getOrgList=function(c,d,e){a.postData(b.getUrl("SEARCH_ORGANIZATION_LIST_FINDBY_CRITERIA"),c,function(a){a&&a.data?
// convertListOfDate(response.data.data);
d(a.data):e(a)},function(a){e(a)})},this.getPicklistWSByCode=function(c,d,e){a.getData(b.getParameterizedUrl("GET_PICKLIST_WS_BY_PICKLISTCODE",c),null,function(a){d(a)},function(a){e(a)})},this.getAddressByUserId=function(c,d,e){a.getData(b.getParameterizedUrl("USER_ADDRESS_BY_USER_ID",null),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule").service("myReqService",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.getRequestList=function(c,d,e){a.postData(b.getUrl("SEARCH_MYREQUEST_LIST_FINDBY_CRITERIA"),c,function(a){a&&a.data?(f(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.getRequestListById=function(c,d,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_REQUEST_LIST_BY_ID",g),null,function(a){a&&a.data?(a.data.requestDate=e("timestampToDate")(a.data.requestDate,"MM/dd/yyyy"),a.data.expiryDate=e("timestampToDate")(a.data.expiryDate,"MM/dd/yyyy"),a.data.start=e("timestampToDate")(a.data.start,"MM/dd/yyyy"),a.data.end=e("timestampToDate")(a.data.end,"MM/dd/yyyy"),d(a.data)):f(a)},function(a){f(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.requestDate=e("timestampToDate")(a.requestDate,b)})}}]),angular.module("paripal.requestManagementModule").service("nonUserDetailService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";
//Non-User key id 
this.getNonuserId=function(c,d,e){a.getData(b.getParameterizedUrl("GET_NON_USER_DETAIL_BY_ID",nonUserDetails),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveNonUserDetail=function(c,d,e){var f="";f=c.id?"UPDATE_NON_USER_DETAIL":"SAVE_NON_USER_DETAIL",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule").service("pageEntityShareLstService",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.getEntityList=function(c,d,e){a.postData(b.getUrl("MY_REQUEST_LIST_FINDBY_CRITERIA"),c,function(a){a&&a.data?(f(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.getEntityShareListById=function(c,d,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_REQUEST_LIST_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.dateRequestCreated=e("timestampToDate")(a.data.dateRequestCreated,b),a.data.whenNeeded=e("timestampToDate")(a.data.whenNeeded,b),d(a.data)):f(a)},function(a){f(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateRequestCreated=e("timestampToDate")(a.dateRequestCreated,b),a.whenNeeded=e("timestampToDate")(a.whenNeeded,b)})}}]),angular.module("paripal.requestManagementModule").service("requestFulfilmentListingService",["httpService","urlService","dateconvertor","$timeout","$filter","$state",function(a,b,c,d,e,f){this.getFulfimentListById=function(c,d,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_FULFILMENT_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.followUpDate=e("timestampToDate")(a.data.followUpDate,b),a.data.requestAppointmentDate=e("timestampToDate")(a.data.requestAppointmentDate,b),a.data.createRequest&&(a.data.createRequest.requestDate=e("timestampToDate")(a.data.createRequest.requestDate,b)),
//response.data.followUpDate = $filter('timestampToDate')(response.data.followUpDate, dateFormat);
//response.data.requestAppointmentDate = $filter('timestampToDate')(response.data.requestAppointmentDate, dateFormat);
//response.data.requestDate = $filter('timestampToDate')(response.data.requestDate, dateFormat);
d(a.data)):f(a)},function(a){f(a)})};var g=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.followUpDate=e("timestampToDate")(a.followUpDate,b),a.requestAppointmentDate=e("timestampToDate")(a.requestAppointmentDate,b)})};this.getFulfimentList=function(c,d,e){a.postData(b.getUrl("SEARCH_REQUEST_FULFILMENT_LIST_FINDBY_CRITERIA"),c,function(a){a&&a.data?(g(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.goToUploadDownload=function(c){var d={};d.appointmentId=c.appointmentId,a.getData(b.getParameterizedUrl("GET_USER_DETAILS_BY_APPT_ID",d),null,function(a){a.data.appointmentId=c.id,a.type="edit",f.go("appointmentsuploadlist",a)})},this.getApptIdByScheduleId=function(c,d,e){var f={};f.scheduleId=c,a.getData(b.getParameterizedUrl("GET_APPOINTMENT_BY_SCHEDULE_ID",f),null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule").service("requestResponseService",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.save=function(c,d,e){a.getData(b.getParameterizedUrl("UPDATE_SELECTED_RESPONSE",c),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.getImageUrl=function(c,d,e){var f=b.getUrl("DOWNLOAD_FILE"),g="";a.downloadFileData(f,c,function(a){if(a&&a.data){var b=new Uint8Array(a.data),c=new Blob([b],{type:""});window.URL.createObjectURL(c)&&(g=window.URL.createObjectURL(c)),d(g)}else d(g)},function(a){d(g)})},this.getOrganizationById=function(c,d,e){var f={};f.organizationId=c,a.getData(b.getParameterizedUrl("GET_ORG_BY_ID",f),null,function(a){a&&a.data?
//response.data.commencementDate = $filter('timestampToDate')(response.data.commencementDate, 'MM/dd/yyyy');
d(a.data):e(a)},function(a){e(a)})},
//view response  
this.getViewResponseId=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_RESPONDTOREQLST_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getResponseId=function(c,d,e){a.getData(b.getParameterizedUrl("GET_REQUEST_LIST_BY_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getRequestId=function(c,d,e){a.getData(b.getParameterizedUrl("GET_REQUEST_LIST_BY_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDocList=function(c,d,e){a.postData(b.getUrl("GET_RESPONSED_DOCTOR_DETAILS"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getOrganisationList=function(c,d,e){a.postData(b.getUrl("GET_RESPONSED_ORG_DETAILS"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule").service("requestStatusService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";
//save or update fulfillment(request status) 
this.save=function(c,e,f){c.createRequest&&(c.createRequest.requestDate=d.convertToServerDate(c.createRequest.requestDate)),c.followUpDate=d.convertToServerDate(c.followUpDate),c.requestAppointmentDate=d.convertToServerDate(c.requestAppointmentDate);
//requestStatus.orderDate = dateconvertor.convertToServerDate(requestStatus.orderDate);
//requestStatus.Date = dateconvertor.convertToServerDate(requestStatus.Date);
// requestStatus.completedOn = dateconvertor.convertToServerDate(requestStatus.completedOn);
var g="SAVE_REQUEST_FuLFILMENT";null!=c.id&&(g="UPDATE_REQUEST_FuLFILMENT"),a.postData(b.getUrl(g),c,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},
//generate visit no. 
this.generateVisitNoId=function(c,d){a.getData(b.getUrl("GET_VISIT_NO"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},
//get fulfilment by id
this.getRequestId=function(c,d,e){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_FULFILMENT_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.createRequest&&a.data.createRequest.requestDate&&(a.data.createRequest.requestDate=f("timestampToDate")(a.data.requestDate,b)),d(a.data)):e(a)},function(a){e(a)})},this.getTreatmentClinicalById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_TREATMENT_CLINICAL_NOTE_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveTreatmentClinical=function(c,d,e){var f="TREATMENT_CLINICAL_NOTE_SAVE";null!=c.id&&(f="TREATMENT_CLINICAL_NOTE_UPDATE"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteTreatmentClinical=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("TREATMENT_CLINICAL_NOTE_DELETE",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteRequestStatusById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_USER_MEDICATION_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getClinicalListByRecId=function(c,d,e){var f={};f.fulfilmentRecordId=c,a.getData(b.getParameterizedUrl("TREATMENT_CLINICAL_NOTE_BY_FULFILMENT_REC_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.requestManagementModule").service("respondToRequestService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";this.save=function(c,d,e){var f="SAVE_RESPONSE_REQUEST";null!=c.id&&(f="UPDATE_RESPONSE_REQUEST"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},
//view response
this.getViewResponseId=function(c,d,e){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_RESPONDTOREQLST_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.requestDate=f("timestampToDate")(a.data.requestDate,b),d(a.data)):e(a)},function(a){e(a)})},this.getReqResListById=function(c,d,e){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_LIST_BY_REQUEST_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.requestDate=f("timestampToDate")(a.data.requestDate,b),
// response.data.expiryDate = $filter('timestampToDate')(response.data.expiryDate, dateFormat);
// response.data.start = $filter('timestampToDate')(response.data.start, dateFormat);
// response.data.end = $filter('timestampToDate')(response.data.end, dateFormat);
d(a.data)):e(a)},function(a){e(a)})},this.getResponseListById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("GET_RESPONDTOREQLST_BY_ID",f),null,function(a){
//var dateFormat = 'MM/dd/yyyy';
a&&a.data?
// response.data.requestDate = $filter('timestampToDate')(response.data.requestDate, dateFormat);
// response.data.expiryDate = $filter('timestampToDate')(response.data.expiryDate, dateFormat);
// response.data.start = $filter('timestampToDate')(response.data.start, dateFormat);
// response.data.end = $filter('timestampToDate')(response.data.end, dateFormat);
d(a.data):e(a)},function(a){e(a)})},
//AUTO GENERATE ID
this.generateResponseId=function(c,d){a.getData(b.getUrl("GET_RESPONSE_AUTO_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.requestManagementModule").service("searchRequestManagementService",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.getRequestList=function(c,d,e){a.postData(b.getUrl("SEARCH_REQUEST_LIST_FINDBY_CRITERIA"),c,function(a){a&&a.data?
//convertListOfDate(response.data.data);
d(a.data):e(a)},function(a){e(a)})},this.getRequestListById=function(c,d,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_REQUEST_LIST_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.requestDate=e("timestampToDate")(a.data.requestDate,b),a.data.expiryDate=e("timestampToDate")(a.data.expiryDate,b),a.data.start=e("timestampToDate")(a.data.start,b),a.data.end=e("timestampToDate")(a.data.end,b),d(a.data)):f(a)},function(a){f(a)})}}]),angular.module("paripal.requestManagementModule").service("visitScheduleExceptionservice",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.getScheduleList=function(c,d,e){a.postData(b.getUrl("MY_REQUEST_LIST_FINDBY_CRITERIA"),c,function(a){a&&a.data?(convertListOfDate(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.getScheduleListById=function(c,d,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("getScheduleListById",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.dateRequestCreated=e("timestampToDate")(a.data.dateRequestCreated,b),a.data.whenNeeded=e("timestampToDate")(a.data.whenNeeded,b),d(a.data)):f(a)},function(a){f(a)})}}]),angular.module("paripal.manageResources").controller("ManageResourceCtrl",["$scope","$rootScope","$stateParams","$state","$location","$filter","$translate","DTOptionsBuilder","DTColumnDefBuilder","$uibModal","service","notify","dateconvertor","utilService","urlService","httpService","resourceListService","fileOperations","fileExtensionConstants","commonConstants","featurePrivilegeConstants","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){a.resourceDetail={},a.organization={},a.organization.data={},a.organizationLocation={},a.selectedDocumentAccessType={},a.showOrgLocCombo=!1,a.showOrganizationCombo=!1,a.providerSelected=!0,a.resourceTypeList=[],a.restrictToList=[],a.serviceProviderList=[],a.manageResourceSpinner=!1,a.isVisibleCheckListFields=!1,a.loadListOfResourceTypes=function(){q.loadListOfResourceTypes(function(b){n.isEmpty(b)||(a.resourceTypeList=b)},function(a){})},a.loadListOfRestictTo=function(){q.loadListOfRestictTo(function(b){n.isEmpty(b)||(a.restrictToList=b)},function(a){})},a.loadListOfServiceProviders=function(){q.loadListOfServiceProviders(function(b){n.isEmpty(b)||(a.serviceProviderList=b)},function(a){},{orgLocPermission:u.RESOURCE_UPLOAD_DOWNLOAD_ADD})},a.loadListOfCheckListTypes=function(){q.loadListOfCheckListTypes(function(b){n.isEmpty(b)||(a.checkListTypeList=b)},function(a){})},a.loadCheckListLinkTypes=function(b){a.checkListLinkTypeList=[],a.resourceDetail.linkedTypes=void 0,a.checkListValue=b.value,n.isEmpty(b)||n.isNullOrEmpty(b.code)||q.loadListOfCheckListLinkTypes(b.code,function(b){n.isEmpty(b)||(a.checkListLinkTypeList=b,(a.editMode||a.viewMode)&&a.getCheckListLinkedType(a.resourceDetail.id,a.resourceDetail.checklistName))},function(a){})},a.loadListOfFirstAidTypes=function(){q.loadListOfFirstAidTypes(function(b){n.isEmpty(b)||(a.firstAidTypeList=b)},function(a){})},a.firstAidTypeChanged=function(b){a.firstAidTypeValue=b,a.resourceDetail.firstAidTypeId=b.id},a.getDownloadStatistics=function(b){n.isEmpty(b)||q.getDownloadStatistics(b,function(b){n.isEmpty(b)||(a.downloadStatistics=b),a.manageResourceSpinner=!1},function(b){a.manageResourceSpinner=!1})},a.getCheckListLinkedType=function(b,c){if(!n.isNullOrEmpty(b)&&!n.isNullOrEmpty(c)){var d=new Object;d.resourceId=b,d.checklistName=c,a.manageResourceSpinner=!0,q.getCheckListLinkedType(d,function(b){if(a.manageResourceSpinner=!1,!n.isEmpty(b)){var c=new Array;angular.forEach(b,function(a){n.isEmpty(a)||c.push(a.id)}),c.length>0&&(a.resourceDetail.linkedTypes=c)}},function(b){a.manageResourceSpinner=!1})}},a.getUserResourceRatings=function(b){if(!n.isNullOrEmpty(b)){var c=new Object;c.resourceId=b,a.manageResourceSpinner=!0,q.getUserResourceRatings(c,function(b){a.manageResourceSpinner=!1,n.isEmpty(b)||(a.ratings=b)},function(b){a.manageResourceSpinner=!1})}},a.loadListOfResourceTypes(),a.loadListOfRestictTo(),a.loadListOfServiceProviders(),a.loadListOfCheckListTypes(),a.loadListOfFirstAidTypes(),a.checkFileExtensionWRTResourceType=function(a){var b=!1;if(!n.isEmpty(s)&&!n.isNullOrEmpty(a.documentResourceType.type)&&!n.isNullOrEmpty(a.fileName)){var c=a.fileName,d=a.documentResourceType.type,e=c.substring(c.lastIndexOf(".")+1,c.length).toLowerCase();if(!n.isEmpty(s[d.toUpperCase()])&&s[d.toUpperCase()].length>0){var f=s[d.toUpperCase()];if(n.checkStringInArray(f,e))return b=!0;var h=!1,i="",j="";for(j in s)if(s.hasOwnProperty(j)){var k=s[j];n.checkStringInArray(k,e)&&(h=!0,i=j)}return h?(l("Error",g.instant("INVALID_RESOURCE_TYPE")+i+g.instant("RES_TYPE")),b):(l("Error",g.instant("INVALID_FILE_SELECTION")),b)}return l("Error",g.instant("RESOURCE_TYPE_NOT_PRESENT")),b}return b},a.saveResourceDetails=function(b){if(b.$valid&&!n.isEmpty(a.resourceDetail)){var c=!0;a.resourceDetail.whetherFirstAid&&n.isEmpty(a.firstAidTypeValue)&&(c=!1),a.resourceDetail.whetherChecklist&&n.isNullOrEmpty(a.checkListValue)&&n.isNullOrEmpty(a.checkListLinkedValue)&&(c=!1);var d="",e="";a.editMode?(e=!0,d=o.getUrl("UPDATE_RESOURCE_DETAILS"),n.isNullOrEmpty(a.resourceDetail.createdDate)||(a.resourceDetail.createdDate=m.convertToServerDate(a.resourceDetail.createdDate))):(d=o.getUrl("SAVE_RESOURCE_DETAILS"),e=!1),n.isEmpty(a.resourceFileDetail)||(a.resourceDetail.fileName=a.resourceFileDetail.fileToBeUpload.name,a.resourceDetail.fileSize=a.resourceFileDetail.fileToBeUpload.size),a.resourceDetail.whetherChecklist||(a.resourceDetail.checklistType=null),n.isEmpty(a.organization)||n.isEmpty(a.organization.data)||(a.resourceDetail.organization=a.organization.data),n.isEmpty(a.organizationLocation)||n.isEmpty(a.organizationLocation.data)||(a.resourceDetail.orgLoc=a.organizationLocation.data);var f=function(b){var c=b.split(",");if(c.length>1){for(var d="",e=0;e<c.length;e++)d+=null==a.resourceDetail.identifier.match(c[e])?c[e]+",":"";if(","==d.charAt(d.length-1)){var f=d.length;d=d.slice(0,f-1)+d.slice(f)}return d}return null==a.resourceDetail.identifier.match(b)?b+", ":""},h=a.checkFileExtensionWRTResourceType(a.resourceDetail);if(h&&c){a.manageResourceSpinner=!0,!n.isEmpty(a.resourceDetail.linkedTypes)&&a.resourceDetail.linkedTypes.length>0&&a.resourceDetail.whetherChecklist&&(a.createLinkedTypeArrayOfObjects(),a.resourceDetail.identifier=a.resourceDetail.identifier+", "+f(a.checkListValue)+f(a.checkListLinkedValue)),a.resourceDetail.whetherFirstAid&&a.firstAidTypeValue&&!e&&(a.resourceDetail.identifier=a.resourceDetail.identifier+", "+f("First Aid")+f(a.firstAidTypeValue.value).replace(", ",""),a.resourceDetail.firstAidTypeId=a.firstAidTypeValue.id),"Video"==a.resourceDetail.documentResourceType.type?a.isThumbnailRequired=!0:a.isThumbnailRequired=!1;var i=angular.copy(a.resourceDetail);delete i.firstAidTypes,a.resourceDetail.whetherFirstAid&&(delete i.checklistType,delete i.linkedTypes),a.resourceDetail.whetherChecklist&&delete i.firstAidTypes,i.documentAccessType=a.selectedDocumentAccessType,q.saveResourceDetails(i,d,e,function(b){n.isEmpty(a.resourceFileDetail)?(n.isNullOrEmpty(b.successMessage)||l("success",b.successMessage),a.goToListingScreen()):a.uploadFile(a.resourceFileDetail,a.resourceDetail,b,a.isThumbnailRequired)},function(b){a.manageResourceSpinner=!1})}a.resourceDetail.whetherFirstAid&&!c?l("warning",g.instant("SELECT_FIRSTAID_TYPE")):a.resourceDetail.whetherChecklist&&!c&&l("warning",g.instant("SELECT_CHECKLIST"))}},a.createLinkedTypeArrayOfObjects=function(){var b=new Array;a.checkListLinkedValue="",angular.forEach(a.resourceDetail.linkedTypes,function(c){if(!n.isNullOrEmpty(c)){var d=new Object;d.id=c,b.push(d),angular.forEach(a.checkListLinkTypeList,function(b,d){b.id==c&&(a.checkListLinkedValue+=b.value+",")})}}),b.length>0&&(a.resourceDetail.linkedTypes=null,a.resourceDetail.linkedTypes=b)},a.hideShowOrgLocCombo=function(b){if(!n.isNullOrEmpty(b)){var c=null;if(angular.forEach(a.restrictToList,function(a,d){a.id==b.id&&(c=a)}),null!=c)switch(c.id){case 2:case 5:a.showOrganizationCombo=!0,a.showOrgLocCombo=!1;break;case 3:case 6:a.showOrganizationCombo=!1,a.showOrgLocCombo=!0;break;default:a.showOrganizationCombo=!1,a.showOrgLocCombo=!1}}},a.uploadFile=function(b,c,d,e){var f=new Object;f.file=b.fileToBeUpload,f.orgLocId=c.serviceProviderId,f.docType=t.documentTypes.resource,f.docSubType=t.documentSubTypes.resource,f.isThumbnailRequired=e,n.isNullOrEmpty(d.response)||(f.resourceId=d.response),r.uploadFile(f,function(b){n.isNullOrEmpty(d.successMessage)||l("success",d.successMessage),a.goToListingScreen()},function(c){n.isNullOrEmpty(d.response)||"UPLOAD_THUMBNAIL_EXCEPTION"!=c.errorCode&&q.deleteResourceDetails(d.response,function(c){delete f.file,f.fileName=b.fileToBeUpload.name,f.isThumbnailRequired=!1,q.deleteResourceFileDetails(f,function(b){l("Error",g.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()},function(b){l("Error",g.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()})},function(b){l("Error",g.instant("ERROR_WHILE_UPLOADING")),a.goToListingScreen()})})},a.goToListingScreen=function(){a.manageResourceSpinner=!1,a.resourceDetail={},d.go("resourcelist")},a.back=function(){n.goBackToPrevState()},a.onCheckListChkBox=function(b){a.isRequiredCheckListFields=b,a.isRequiredFirstAidFields=!1,b&&(/*   $scope.resourceDetail.linkedTypes = [];
                    $scope.resourceDetail.checklistType = {};
                } else {*/
a.resourceDetail.whetherFirstAid=!1)},a.onFirstAidChkBox=function(b){a.isRequiredFirstAidFields=b,a.isRequiredCheckListFields=!1,b&&(/*  $scope.resourceDetail.linkedTypes = [];
                      $scope.resourceDetail.checklistType = {};*/
a.resourceDetail.whetherChecklist=!1)},a.hideShowRestrictTo=function(){a.providerSelected=!1,a.resourceDetail.documentAccessType={},a.organizationLocation={},a.organization={},a.showOrganizationCombo=!1,a.showOrgLocCombo=!1},a.orgSelectFun=function(b){"2"!=b&&"5"!=b||angular.forEach(a.serviceProviderList,function(b,c){b.orgLocationId==a.resourceDetail.serviceProviderId&&(a.organization.data={id:b.orgId,value:b.orgName})}),"3"!=b&&"6"!=b||angular.forEach(a.serviceProviderList,function(b,c){b.orgLocationId==a.resourceDetail.serviceProviderId&&(a.organization.data={id:b.orgId,value:b.orgName},a.organizationLocation.data={id:b.orgLocationId,value:b.orgLocationName})}),"1"!=b&&"7"!=b||angular.forEach(a.serviceProviderList,function(b,c){a.organization.data={},a.organizationLocation.data={}})},a.init=function(){if(a.disableOrganization=!1,a.disableOrganizationLocation=!1,a.disableRestrictTo=!1,("add"===c.type||n.isFieldEmpty(c.type))&&q.getResourceId(function(b){n.isNullOrEmpty(b)||(a.resourceDetail.code=b)},function(a){}),"edit"===c.type&&(a.editMode=!0),"view"===c.type&&(a.viewMode=!0),"edit"===c.type||"view"===c.type){a.manageResourceSpinner=!0,a.disableRestrictTo=!0,a.resourceDetail=c.data,a.resourceDetail.identifier=","==a.resourceDetail.identifier.charAt(0)?a.resourceDetail.identifier.slice(1):a.resourceDetail.identifier,a.documentResourceTypeId=c.data.documentResourceType.id,n.isEmpty(c.data.checklistType)||n.isNullOrEmpty(c.data.checklistType.id)||(a.checklistTypeId=c.data.checklistType.id),n.isEmpty(c.data.documentAccessType)||(2==c.data.documentAccessType.id||5==c.data.documentAccessType.id?(a.showOrganizationCombo=!0,a.disableOrganization=!0,n.isEmpty(c.data.organization)||(a.organization.data=c.data.organization)):3!=c.data.documentAccessType.id&&6!=c.data.documentAccessType.id||(a.showOrgLocCombo=!0,a.disableOrganization=!0,a.disableOrganizationLocation=!0,n.isEmpty(c.data.organization)||(a.organization.data=c.data.organization),n.isEmpty(c.data.orgLoc)||(a.organizationLocation.data=c.data.orgLoc)),a.selectedDocumentAccessType=c.data.documentAccessType,a.resourceDetail.serviceProviderId=c.data.serviceProviderId),c.data.firstAidTypeId&&(a.firstAidTypeId=c.data.firstAidTypeId),a.getDownloadStatistics(a.resourceDetail);var b=new Object;b.up=a.resourceDetail.voteUp,b.down=a.resourceDetail.voteDown,a.ratings=b}if(n.isNullOrEmpty(a.resourceDetail.createdDate)||(a.resourceDetail.createdDate=m.convertToViewDate(a.resourceDetail.createdDate)),"add"===c.type||n.isFieldEmpty(c.type)){var d=v.getDefaultOrgLocation();n.isFieldEmpty(d)||(a.serviceProId=d.orgLoc,a.hideShowRestrictTo())}},a.init()}]),angular.module("paripal.manageResources").controller("ResourceListCtrl",["$scope","$rootScope","$filter","$stateParams","$state","$location","datatableconfig","$uibModal","httpService","urlService","service","dateconvertor","notify","$translate","serverSidePagination","resourceListService","utilService","fileOperations","baseService","commonConstants","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a){var b;
//find & remove protocol (http, ftp, etc.) and get hostname
//find & remove port number
//find & remove "?"
return b=a.indexOf("//")>-1?a.split("/")[2]:a.split("/")[0],b=b.split(":")[0],b=b.split("?")[0],"www.paripal.com"==b?"https://"+b+"/paripal-web/rest/media/public/downloadResourceVideo/":"test.paripal.com"==b?"https://"+b+"/rest/media/public/downloadResourceVideo/":"http://localhost:8080/paripal-web/rest/media/public/downloadResourceVideo/"}function w(a,b,c,d,e){a.link=c,a.cancel=function(){b.hide()},a.copyLink=function(){$("<input>").val(a.link).appendTo("body").select();document.execCommand("copy"),e("info",d.instant("LINK_COPIED_TO_CLIPBOARD"))},a.openUrl=function(){window.open(a.link,"_blank")}}w.$inject=["$scope","$mdDialog","link","$translate","notify"],a.resource={},a.resourceTypeList={},a.deleteDialogBox={},a.restrictToList=[],a.serviceProviderList=[],a.resourceList=[],a.checkListTypeList=[],a.checkListLinkTypeList=[],a.resourceListSpinner=!1,a.currentPage=1,1==a.listView?a.itemPerPage=10:a.itemPerPage=12,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.loadListOfResourceTypes=function(){p.loadListOfResourceTypes(function(b){q.isEmpty(b)||(a.resourceTypeList=b)},function(a){})},a.loadListOfRestictTo=function(){p.loadListOfRestictTo(function(b){q.isEmpty(b)||(a.restrictToList=b)},function(a){})},a.loadListOfServiceProviders=function(){p.loadListOfServiceProviders(function(b){q.isEmpty(b)||(a.serviceProviderList=b)},function(a){})},a.loadListOfCheckListTypes=function(){p.loadListOfCheckListTypes(function(b){q.isEmpty(b)||(a.checkListTypeList=b)},function(a){})},a.loadCheckListLinkTypes=function(b){a.checkListLinkTypeList=[],q.isEmpty(b)||q.isNullOrEmpty(b.code)||p.loadListOfCheckListLinkTypes(b.code,function(b){q.isEmpty(b)||(a.checkListLinkTypeList=b)},function(a){})},a.getResourceByCriteria=function(c,d){var e=new Object;e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,q.isEmpty(c)||(q.isNullOrEmpty(c.whetherAllIdentifier)||(e.whetherAllIdentifier=c.whetherAllIdentifier),q.isNullOrEmpty(c.resourceName)||(e.resourceName=c.resourceName),q.isNullOrEmpty(c.resourceNameContains)||(e.resourceNameContains=c.resourceNameContains),q.isEmpty(c.resourceType)||q.isNullOrEmpty(c.resourceType.id)||(e.resourceType=c.resourceType.id),q.isEmpty(c.restrictTo)||q.isNullOrEmpty(c.restrictTo.id)||(e.restrictTo=c.restrictTo.id),q.isEmpty(c.serviceProvider)||q.isNullOrEmpty(c.serviceProvider.orgLocationId)||(e.serviceProvider=c.serviceProvider.orgLocationId),q.isNullOrEmpty(c.validFrom)||(e.validFrom=l.convertToServerDate(c.validFrom)),q.isNullOrEmpty(c.validTill)||(e.validTill=l.convertToServerDate(c.validTill)),q.isEmpty(c.checkListType)||q.isNullOrEmpty(c.checkListType.id)||(e.checklistTypeId=c.checkListType.id),q.isEmpty(c.checkListLinkType)||q.isNullOrEmpty(c.checkListLinkType)||(e.linkedType=c.checkListLinkType),q.isNullOrEmpty(c.sorters)||(e.sorters=c.sorters)),q.isFieldEmpty(a.createdById)||(e.createdById=a.createdById),
//            if (baseService.getLoggedInUser() !== null) {
//                resourceFilterParamObject.loggedInUserId = baseService.getLoggedInUser().id;
//            }
q.isEmpty(c)||q.isEmpty(c.recordStatus)||(e.whetherChecklist="checklist"==c.recordStatus),q.isEmpty(c)||q.isEmpty(c.recordStatus)||(e.whetherFirstAid="firstAid"==c.recordStatus),b.showSpinner=!0,p.getResourceByCriteria(e,function(c){c&&(b.showSpinner=!1,a.resourceList=c.data,q.isEmpty(b.loggedInUserDetails)&&angular.forEach(a.resourceList,function(a,c){angular.forEach(b.resourceVotedObj,function(b,c){a.id==b.resourceId&&1==b.vote?a.whetherVotedUp=!0:a.id==b.resourceId&&0==b.vote&&(a.whetherVotedUp=!1)})}),a.totalItems=c.totalRecords,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems))},function(a){b.showSpinner=!1})},a.updateVoteForResource=function(c,d){if(a.isVoted=!1,!q.isNullOrEmpty(c)&&!q.isNullOrEmpty(d)&&(q.isEmpty(b.loggedInUserDetails)||//use case for public user
!q.isEmpty(b.loggedInUserDetails)&&0==b.loggedInUserDetails.isOrganizationUserMode)){var e=new Object;e.vote=c,e.resource={id:d},e.user={},q.isEmpty(b.loggedInUserDetails)&&(angular.forEach(b.resourceVotedObj,function(b,e){b.resourceId==d&&b.vote==c?a.isVoted=!0:b.resourceId==d&&b.vote==!c}),a.isVoted||b.resourceVotedObj.push({resourceId:d,vote:c}));var f=null;null!==s.getLoggedInUser()&&(f=s.getLoggedInUser().id,e.user={id:f}),a.isVoted||p.updateVoteForResource(e,f,function(b){/*if (!utilService.isNullOrEmpty(successResponse)) {
                            angular.forEach($scope.resourceList, function (resourceObject) {
                                if (resourceObject.id == resourceId) {
                                    resourceObject.whetherVotedUp = vote;
                                }
                            });
                        }*/
a.getResourceByCriteria(a.resource)},function(a){})}},a.createNewResource=function(){e.go("manageresource",{type:"add",data:null})},a.showResourceDetails=function(a,b){e.go("manageresource",{type:b,data:a})},a.deleteResource=function(b){q.isEmpty(b)||(a.deleteDialogBox.header=n.instant("DELETE_RESOURCE"),a.deleteDialogBox.onOkBtnClick=function(){var c=new Object;c.fileName=b.fileName,c.orgLocId=b.serviceProviderId,c.resourceId=b.id,c.docType=t.documentTypes.resource,c.docSubType=t.documentSubTypes.resource,p.deleteResourceFileDetails(c,function(c){p.deleteResourceDetails(b.id,function(b){q.isNullOrEmpty(b.successMessage)||m("success",b.successMessage),a.getResourceByCriteria(a.resource)},function(a){})},function(a){})},a.deleteDialogBox.init())},a.downloadFile=function(a){if(!q.isEmpty(a)){var b=new Object;b.fileName=a.fileName,b.orgLocId=a.serviceProviderId,b.resourceId=a.id,b.docType=t.documentTypes.resource,b.docSubType=t.documentSubTypes.resource,r.downloadFile(b,function(a){a&&p.updateDownloadStatistics(b,function(a){},function(a){})},function(a){})}},a.viewPrintFile=function(b){var c=new Object;c.fileName=b.fileName,c.orgLocId=b.serviceProviderId,q.isNullOrEmpty(b.resourceId)?q.isNullOrEmpty(b.id)||(c.resourceId=b.id):c.resourceId=b.resourceId,c.docType=t.documentTypes.resource,c.docSubType=t.documentSubTypes.resource,c.isResource=!0,a.fileResource=c,a.viewFileContent=!0,"Document"==b.resourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0},a.urlLink=v(window.location.href),a.viewLink=function(b){var c=a.urlLink+b;u.show({controller:w,templateUrl:"app/modules/resource-management/views/show-link-popup.html",parent:angular.element(document.body),clickOutsideToClose:t.dialogBox.clickOutsideToClose,locals:{link:c}}).then(function(){},function(){})},a.sendLink=function(b){var c='<a href="'+a.urlLink+b+'">'+a.urlLink+b+"</a>",d=a.urlLink+b;e.go("quickClientMsg",{message:c,sms:d})},/* CARD VIEW CHANGES START */
a.listView=!1,a.cardView=!0,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1,a.itemPerPage=12,a.getResourceByCriteria(null,a.createdById)):(a.cardView=!1,a.listView=!0,a.itemPerPage=10,a.getResourceByCriteria(null,a.createdById)),"Card view"===c?"List View":"Card view"})}),/* CARD VIEW CHANGES END */
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems),a.getResourceByCriteria(a.resource)},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getResourceByCriteria(a.resource)},$("#data-table").on("click",".clickCls",function(){var b=$(this).attr("vote").valueOf(),c=$(this).attr("data").valueOf();q.isNullOrEmpty(b)||q.isNullOrEmpty(c)||a.updateVoteForResource("true"===b,Number(c))}),a.voteChanged=function(b,c){var b=b,d=c;q.isNullOrEmpty(b)||q.isNullOrEmpty(d)||a.updateVoteForResource("true"===b,Number(d))};
//datatble config json
var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=g.setOptionProperties(x),a.dtColumnDefs=g.setColumnProperties({}),a.clear=function(){a.resource={},a.getResourceByCriteria(null,a.createdById)},a.init=function(){/*********  changed by Anbu mitosis team ********/
if(q.isNullOrEmpty(b.loggedInUserDetails)?a.orgUser=!1:0==b.loggedInUserDetails.isOrganizationUserMode?a.orgUser=!1:a.orgUser=!0,q.isFieldEmpty(d.user)||q.isFieldEmpty(d.type)||(a.createdById=d.user.id),"professionalwall"===d.type&&(a.fromProfessionalWall=!0),a.loadListOfResourceTypes(),a.loadListOfRestictTo(),a.loadListOfServiceProviders(),d.resourceNameContains){var c={};c.resourceNameContains=d.resourceNameContains,c.checkListType={},c.checkListType.id=d.checklistTypeId,c.whetherResourceChecklist=!0,a.resource=c,a.getResourceByCriteria(c,a.createdById)}else a.getResourceByCriteria(null,a.createdById);/*----------------         -----------*/
a.loadListOfCheckListTypes()},a.init()}]),angular.module("paripal.manageResources").service("manageResourceService",["httpService","urlService","utilService",function(a,b,c){"use strict"}]),angular.module("paripal.manageResources").service("resourceListService",["httpService","urlService","utilService",function(a,b,c){"use strict";this.loadListOfResourceTypes=function(c,d){a.getData(b.getUrl("GET_RESOURCE_TYPES"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.loadListOfRestictTo=function(c,d){a.getData(b.getUrl("GET_RESTRICT_TO_LIST"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.loadListOfServiceProviders=function(c,d,e){a.getData(b.getUrl("GET_SERVICE_PROVIDERS"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)},e)},this.loadListOfCheckListTypes=function(c,d){a.getData(b.getUrl("FIND_ALL_CHECKLIST_TYPES"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getCheckListTypeByCode=function(c,d,e){var f={};f.pickListItemCode=c,a.getData(b.getParameterizedUrl("FIND_CHECKLIST_TYPE_BY_CODE",f),null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.loadListOfCheckListLinkTypes=function(c,d,e){var f=b.getUrl("FIND_ALL_CHECKLIST_LINK_TYPES")+"?code="+c;a.getData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.loadListOfFirstAidTypes=function(c,d){a.getData(b.getUrl("GET_FIRST_AID_TYPES"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getResourceByCriteria=function(c,d,e){var f=b.getUrl("GET_RESOURCE_LIST"),g=new Object;g.whetherAllIdentifier=c.whetherAllIdentifier,g.resourceIdentifier=c.resourceNameContains,g.resourceName=c.resourceName,g.fromDate=c.validFrom,g.tillDate=c.validTill,g.documentResourceTypeId=c.resourceType,g.restrictionTypeId=c.restrictTo,g.pageNumber=c.pageNumber,g.recordsPerPage=c.recordsPerPage,g.whetherResourceChceklist=c.whetherResourceChceklist,g.checkListType=c.checkListType,g.checklistTypeId=c.checklistTypeId,g.linkedType=c.linkedType,g.whetherChecklist=c.whetherChecklist,g.whetherFirstAid=c.whetherFirstAid,g.loggedInUserId=c.loggedInUserId,g.firstAidTypeId=c.firstAidTypeId,g.sorters=c.sorters,g.createdById=c.createdById,/*paramObject.serviceProviderId = resourceFilterParamObject.serviceProvider;*/
a.postData(f,g,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.saveResourceDetails=function(b,c,d,e,f){d?a.putData(c,b,function(a){a&&a.data&&e(a.data)},function(a){f(a)}):a.postData(c,b,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.deleteResourceFileDetails=function(c,d,e){var f=b.getUrl("DELETE_FILE");a.postData(f,c,function(a){a&&d(a)},function(a){e(a)})},this.deleteResourceDetails=function(c,d,e){var f=b.getUrl("DELETE_RESOURCE_DETAILS");f&&(f=f+"?resourceId="+c),a.deleteData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.getDownloadStatistics=function(c,d,e){var f=b.getUrl("GET_DOWNLOAD_STATISTICS");f&&(f=f+"?resourceId="+c.id),a.getData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.updateDownloadStatistics=function(c,d,e){var f=b.getUrl("UPDATE_DOWNLOAD_STATISTICS");f&&(f=f+"?resourceId="+c.resourceId),a.putData(f,null,function(a){a&&d(a)},function(a){e(a)})},this.getResourceId=function(c,d){a.getData(b.getUrl("GET_RESOURCE_ID"),null,function(a){a&&a.data&&c(a.data)},function(a){d(a)})},this.getCheckListLinkedType=function(c,d,e){var f=b.getQueryParameterizedUrl("GET_CHECKLIST_LINK_TYPE",c);a.getData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})},this.updateVoteForResource=function(c,d,e,f){a.putData(b.getUrl("UPDATE_RESOURCE_RATING"),c,function(a){a&&e(a)},function(a){f(a)})},this.getUserResourceRatings=function(c,d,e){var f=b.getQueryParameterizedUrl("GET_USER_RESOURCE_RATINGS",c);a.getData(f,null,function(a){a&&a.data&&d(a.data)},function(a){e(a)})}}]),angular.module("paripal.manageReviews").controller("HealthProReviewListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","healthProReviewListService","notify","$translate","serverSidePagination","httpService","urlService","$mdDialog","$mdMedia","orgUserListService","orbeonFormRunner","utilService","featurePrivilegeConstants","baseService","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(a,b,c,d){a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.language={},a.orgLocPermission=b.ORGANIZATION_USER_HEALTH_PROFESSIONAL_VIEW,a.organizationLocation={queryUrl:"FIND_ACCESSIBLE_LOCATION_BY_PROFESSIONAL",queryParameter:{id:c.recordUserId,type:c.type},jsonParameter:{}},a.loadForm=function(b){var d="HEALTH_REVIEW",e={};e.stateName="healthproreviewlist",e.data={id:"1"},o.loadNewFormRunner(c.recordId,d,a.searchCriteria.orgLoc.id,a.searchCriteria.language.id,e,null,0,c.recordUserId),l.hide()},a.hide=function(){l.hide()},a.cancel=function(){l.cancel()}}
// $stateParams = stateParams;
t.$inject=["$scope","featurePrivilegeConstants","dialogParams","parentScope"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.reviewList=[],a.WSReviewSearchCriteria={},a.error={},a.filterCriteria={},
//$scope.filterCriteria.userData = {};
a.filterCriteriadiseaseVariant={},a.filterCriteria.ratingFrom=1,a.filterCriteria.ratingTill=10,a.error={},a.parameters={},a.healthproReviewSpinner=!1,a.healthproReviewPageSpinner=!1,a.filterCriteria.organizationLocation={},a.professional={};var u={};a.isDisable=!0,a.a={},a.a.whetherUserId=!0;var v={};a.showReport=function(a,b){d.go(a,{professional:{id:b.professional.id,value:b.professional.user.value}})},p.isEmpty(r.getLoggedInUser())||(a.loggedInUserId=r.getLoggedInUser().id),a.searchReviews=function(){a.WSReviewSearchCriteria.reviewUserId=null,a.a.whetherUserId&&(p.isEmpty(r.getLoggedInUser())||(a.WSReviewSearchCriteria.reviewUserId=r.getLoggedInUser().id)),a.WSReviewSearchCriteria.pageNumber=a.currentPage,a.WSReviewSearchCriteria.recordsPerPage=a.itemPerPage,a.healthproReviewSpinner=!0,f.searchReviews(a.WSReviewSearchCriteria,u,a.rangeSlider,function(b){a.healthproReviewSpinner=!1,a.reviewList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.healthproReviewSpinner=!1,a.totalItems=0,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.reviewList=null,a.error=b})},a.fetchRecords=function(){a.WSReviewSearchCriteria=a.filterCriteria,u=a.filterCriteria.organizationLocation,a.searchReviews()},a.clear=function(){a.WSReviewSearchCriteria={},a.filterCriteria={},/*****If user comes from professional wall******/
"professionalwall"!=c.type||p.isFieldEmpty(v)||(a.filterCriteria.userData=angular.copy(v)),/***********************************************/
//$scope.organizationLocation.data = null;
a.fetchRecords(),a.isDisable=!0},
//Add new Organisation
a.addReview=function(){var b={};p.isFieldEmpty(a.filterCriteria.userData)||(b=a.filterCriteria.userData),d.go("managehealthproreview",{type:"add",professional:b})},
//Edit new User
a.getReview=function(b,c){a.healthproReviewPageSpinner=!0,f.getReviewById(b,function(e){a.healthproReviewPageSpinner=!1;var f=e;d.go("managehealthproreview",{type:c,data:f,reviewId:b})},function(b){a.healthproReviewPageSpinner=!1,a.error=b,g("error",h.instant("REVIEW_FETCH_FAILURE"))})},a.buildOrgLocArray=function(a){var b=[];if(a)for(var c=0;c<a.length;c++)b[c]=a[c].id;return b},a.selectOrbeonForm1=function(b,c,e){n.getAccesibleOrgLocationsByUserId(e,function(b){var f=a.buildOrgLocArray(b);d.go("availableformlist",{recordId:c,recordUserId:e,recordUserOrgLocIds:f,referenceEntityType:"HEALTH_REVIEW"})},function(b){a.error=b,g("error",h.instant("REVIEW_USER_ORG_LOC_FETCH_FAILURE"))})},a.selectOrbeonForm=function(b,c,d,e){var f=(m("sm")||m("xs"))&&a.customFullscreen,f=m("gt-sm");l.show({controller:t,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:s.dialogBox.clickOutsideToClose,fullscreen:f,locals:{dialogParams:{recordId:c,recordUserId:d,type:e},parentScope:a}}).then(function(){},function(){})},a.onOrgSelect=function(b){p.isFieldEmpty(b.data)||(u=b,a.isDisable=!0,b.data.id&&(a.isDisable=!1))},a.onProfessionalSelect=function(b){a.filterCriteria.userData=b.data,a.WSReviewSearchCriteria.userData=b.data},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchReviews()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchReviews()};
//datatble config json
var w={searching:!1,lengthChange:!1,info:!1,responsive:!0};a.options=e.setOptionProperties(w),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){p.isFieldEmpty(c.professional)||(a.filterCriteria.userData={},a.filterCriteria.userData.id=c.professional.id,a.filterCriteria.userData.value=c.professional.userName,angular.copy(a.filterCriteria.userData,v),a.professional.data={id:c.professional.id,value:c.professional.userName},a.fromProfessionalWall="professionalwall"==c.type,1!=localStorage.isLoggedIn&&"true"!=localStorage.isLoggedIn||a.filterCriteria.userData.id===r.getLoggedInUser().professionalId||(a.a.whetherUserId=!1));var d=r.getLoggedInUser();d&&!p.isNullOrEmpty(d.id)&&(a.profId=d.id),d.userAccountStatusDTO&&1==d.userAccountStatusDTO.whetherDoctor&&(a.whetherDoctor=!0),1==d.whetherServiceProviderAdmin&&(a.whetherAdmin=!0),b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode&&(a.a.whetherUserId=!1),f.loadParams(function(b){a.parameters=b},function(a){}),a.fetchRecords()},a.viewDocumentPdf=function(c,d){b.showSpinner=!1;var e=c.document;d.preventDefault();var f=new Object;f.fileName=e.fileName,f.resourceId=e.id,f.recordId=c.recordId,f.userId=c.documentCreatedForId,a.userId=c.documentCreatedForId,f.orgLocId=c.documentOrgLocationId,f.docType=e.documentType.type,f.docSubType=e.documentType.subType,a.fileResource=f,a.viewFileContent=!0,a.isHidingPrintButton=!1},
//Range slider config
a.rangeSlider={minValue:0,maxValue:10,options:{floor:0,ceil:10,disabled:!0,hideLimitLabels:!1}},a.init(),a.$watch("filterCriteria.parameter.length",function(b){b<0||!b?(a.rangeSlider.options.disabled=!0,a.disableSwitch=!0,a.filterCriteria.ratingNegative=!1):b>=1&&(a.filterCriteria.ratingNegative||(a.rangeSlider.options.disabled=!1,a.filterCriteria.ratingNegative=!1),a.disableSwitch=!1)},!0),a.$watch("filterCriteria.ratingNegative",function(b){b?(a.rangeSlider.minValue=0,a.rangeSlider.maxValue=10,a.rangeSlider.options.disabled=!0):a.filterCriteria.parameter&&a.filterCriteria.parameter.length<=1&&(a.rangeSlider.options.disabled=!1)},!0),a.showFeedback=function(a){var b=l.alert().title(h.instant("FEEDBACK")).htmlContent('<div class="padding-t-10  textAlign-J"><b>'+a+"</b></div>").ok(h.instant("OK"));l.show(b).then(function(){},function(){})}}]),angular.module("paripal.manageReviews").controller("ManageHealthProReviewCtrl",["$scope","$rootScope","manageHealthProReviewService","$stateParams","$state","notify","$translate","healthProReviewListService","baseService","httpService","urlService","$filter","utilService","userStatusService","messaging",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.review={},a.reviewResponse="",a.disabled=!1,a.review.careRating=5,a.review.treatmentRating=5,a.review.informationRating=5;var p="MM/dd/yyyy";a.review.reviewDate=l("timestampToDate")(new Date,p),a.review.reviewUser={},
//$scope.review.professional = {};
a.review.careNegative=!1,a.review.informationNegative=!1,a.review.treatmentNegative=!1,a.healthProReviewSpinner=!1,a.transactionIdList=[],a.diseaseVarientList=[],a.professional={},a.isProfSelected=!1,a.setData=function(){a.disabled=!1,"view"===a.pageState&&(a.disabled=!0,a.isHideContent=!0,n.isUserLoggedIn()&&n.isOrgUser()&&(a.isHideContent=!1)),"add"===a.pageState&&(m.isEmpty(d.professional)||"object"!=typeof d.professional||(a.review.professional=d.professional),m.isEmpty(d.professionalId)||c.getProfessionalById(d.professionalId,function(b){a.professional={data:b},a.onProfessionalSelect(a.professional,!0)},function(a){}),m.isEmpty(d.transactionId)||c.getTransactionById(d.transactionId,function(b){a.review.transaction=b},function(a){})),"add"!==a.pageState&&"edit"!==a.pageState||(i.getLoggedInUser()&&(a.review.reviewUser.value=i.getLoggedInUser().displayName,a.review.reviewUser.id=i.getLoggedInUser().id),a.isHideContent=!1),a.sliderCare.value=a.review.careRating,a.sliderTreatment.value=a.review.treatmentRating,a.sliderInformation.value=a.review.informationRating,"edit"===d.type&&(0==a.sliderCare.value&&(a.sliderCare.options.disabled=!0),0==a.sliderTreatment.value&&(a.sliderTreatment.options.disabled=!0),0==a.sliderInformation.value&&(a.sliderInformation.options.disabled=!0))},a.manageReview=function(){a.healthProReviewSpinner=!0,c.updateReview(a.review,a.sliderCare,a.sliderTreatment,a.sliderInformation,a.pageState,function(b){if(a.healthProReviewSpinner=!1,a.reviewResponse=b,"add"===a.pageState){f("success",g.instant("ADDED_SUCCESS"));var c="HEALTH_REVIEW";o.triggerMessageEvent(c,b,-1,function(a){e.go("healthproreviewlist",{type:""})},function(a){})}else f("success",g.instant("RECORD_EDITED_SUCESS")),e.go("healthproreviewlist",{type:""})},function(b){a.healthProReviewSpinner=!1,a.reviewResponse=b})},a.cancel=function(){m.goBackToPrevState()},a.init=function(){a.stateData=d,i.getLoggedInUser()?(a.healthProReviewSpinner=!0,"add"===d.type?(a.pageState="add",a.setData(),a.healthProReviewSpinner=!1):"edit"===d.type?(a.pageState="edit",a.isProfSelected=!0):"view"===d.type&&(a.pageState="view",a.sliderTreatment.options.disabled=!0,a.sliderInformation.options.disabled=!0,a.sliderCare.options.disabled=!0),d.data?(a.professional.data=d.data.professional,q(d.data.professional.id),a.review=d.data,a.setData(),a.healthProReviewSpinner=!1):d.reviewId&&h.getReviewById(d.reviewId,function(b){a.healthProReviewSpinner=!1,a.review=b,a.professional.data=b.professional,a.setData()},function(b){a.healthProReviewSpinner=!1,a.review=null,a.error=b})):e.go("login",{callbackState:d,callbackUrl:"managehealthproreview",username:d.username})},a.onProfessionalSelect=function(b,c){if(a.isProfSelected=!1,m.isFieldEmpty(b.data)||(a.review.professional=b.data,q(b.data.id),a.isProfSelected=!0,a.review.diseaseVariant=null),1!=c){var d={};a.transactionIdList=[],d.professionalId=b.data.id,a.review.transaction=null,j.getData(k.getParameterizedUrl("GET_TRANSACTION_TYPE_BY_PROFESSIONAL",d),null,function(b){a.transactionIdList=angular.fromJson(b.data)})}},a.getDisease=function(b){a.diseaseNameAutoCmpLoading=!0;var c={};c.searchKeyWord=b;var d=[];return j.getData(k.getParameterizedUrl("GET_DISEASE_VARIANTS",c),null,function(b){return a.diseaseNameAutoCmpLoading=!1,d=angular.fromJson(b.data)},function(b){a.diseaseNameAutoCmpLoading=!1})};var q=function(b){var c={};a.transactionIdList=[],a.diseaseVarientList=[],c.professionalId=b,d.professionalId&&d.transactionId&&(a.linkCall=!0),/*Get Transaction ID List*/
j.getData(k.getParameterizedUrl("GET_TRANSACTION_TYPE_BY_PROFESSIONAL",c),null,function(b){a.transactionIdList=angular.fromJson(b.data)}),/*Get Disease Varient List*/
j.getData(k.getParameterizedUrl("GET_DISEASE_VARIANTS_BY_PROFEESSIONAL",c),null,function(b){a.diseaseVarientList=angular.fromJson(b.data)})};a.sliderCare={value:0,options:{floor:0,ceil:10,showSelectionBar:!0,disabled:!1}},a.sliderTreatment={value:0,options:{floor:0,ceil:10,showSelectionBar:!0,disabled:!1}},a.sliderInformation={value:0,options:{floor:0,ceil:10,showSelectionBar:!0,disabled:!1}},a.$watch("review.careNegative",function(b){b?(a.sliderCare.value=0,a.sliderCare.options.disabled=!0):a.sliderCare.options.disabled=!1},!0),a.$watch("review.informationNegative",function(b){b?(a.sliderInformation.value=0,a.sliderInformation.options.disabled=!0):a.sliderInformation.options.disabled=!1},!0),a.$watch("review.treatmentNegative",function(b){b?(a.sliderTreatment.value=0,a.sliderTreatment.options.disabled=!0):a.sliderTreatment.options.disabled=!1},!0),a.init()}]),angular.module("paripal.manageReviews").controller("ManageOrgLocUserReviewsCtrl",["$scope","$state","$stateParams","utilService","ManageOrgLocUserReviewsService","userStatusService","$rootScope","dateconvertor","commonConstants",function(a,b,c,d,e,f,g,h,i){"use strict";a.commonConstants=i,a.sliderCare={},a.sliderTreatment={},a.sliderInformation={},a.sliderProcess={},a.review={},a.review.reviewDate=h.convertToViewDate(new Date),a.review.careNegative=!1,a.review.treatmentNegative=!1,a.review.informationNegative=!1,a.review.processNegative=!1,a.reviewFor=[],a.parameters=[{code:"whetherForHealthServices",value:"HEALTH_SERVICES"},{code:"whetherForSupportServices",value:"SUPPORT_SERVICES"}];var j={},k=function(){f.isUserLoggedIn()&&(a.review.reviewUser={},angular.copy(f.userStatus().userData,a.review.reviewUser)),a.pageState=d.isFieldEmpty(c.type)?"add":c.type;/****** Slider initial state ******/
var b={value:0,options:{floor:0,ceil:10,showSelectionBar:!0,disabled:!1}};/**********************************/
/****** Copying the slider init in scope variable ******/
angular.copy(b,a.sliderCare),a.sliderCare.options.id="sliderCare",angular.copy(b,a.sliderTreatment),a.sliderTreatment.options.id="sliderTreatment",angular.copy(b,a.sliderInformation),a.sliderInformation.options.id="sliderInformation",angular.copy(b,a.sliderProcess),a.sliderProcess.options.id="sliderProcess",/**********************************/
l()},l=function(){"add"!==a.pageState&&e.setReviewObject(c.data,function(b){a.review=b,b.whetherForHealthServices&&a.reviewFor.push("whetherForHealthServices"),b.whetherForSupportServices&&a.reviewFor.push("whetherForSupportServices"),a.sliderCare.value=b.careRating,a.sliderCare.options.disabled="view"===a.pageState||b.careNegative,a.sliderTreatment.value=b.treatmentRating,a.sliderTreatment.options.disabled="view"===a.pageState||b.treatmentNegative,a.sliderInformation.value=b.informationRating,a.sliderInformation.options.disabled="view"===a.pageState||b.informationNegative,a.sliderProcess.value=b.processRating,a.sliderProcess.options.disabled="view"===a.pageState||b.processNegative})};a.getTreatmentRecord=function(b){e.getTreatmentRecord(b,function(b){d.isFieldEmpty(b)?(a.review.diseaseVariant=null,a.review.treatmentRecordId=""):(a.treatmentIdList=[],angular.copy(b,a.treatmentIdList),1==b.length&&(a.review.treatmentRecordId=b[0],a.setDiseaseVariant(b[0])))}),e.getDiseaseVariants(b,function(b){d.isFieldEmpty(b)?(a.review.diseaseVariant=null,a.review.treatmentRecordId=""):(a.diseaseVariantList=[],angular.copy(b,a.diseaseVariantList),1==b.length?a.review.diseaseVariant=b[0]:a.review.diseaseVariant=null)},function(a){})},a.onTreatmentRecordSelect=function(b){d.isFieldEmpty(b)?(a.disableDiseaseVariant=!1,a.review.diseaseVariant=null):a.disableDiseaseVariant=!0},a.setDiseaseVariant=function(b){d.isFieldEmpty(b)||(a.onTreatmentRecordSelect(b),a.review.diseaseVariant={id:b.diseaseVariantId,value:b.variantName})},a.reviewChanged=function(b,c){a[b].options.disabled=c,c?(j[b]=a[b].value,a[b].value=0):d.isFieldEmpty(j[b])||(a[b].value=j[b])},a.manageReview=function(){g.showSpinner=!0,e.createReview(a.review,a.sliderCare,a.sliderTreatment,a.sliderInformation,a.sliderProcess,a.reviewFor,function(a){g.showSpinner=!1,b.go("orglocreviewslist")})},a.cancel=function(){d.goBackToPrevState()},k()}]),angular.module("paripal.manageReviews").controller("ManageSupportProReviewCtrl",["$scope","$rootScope","manageSupportProReviewService","$stateParams","$state","notify","$translate","supportProReviewListService","baseService","httpService","urlService","$filter","utilService","userStatusService","$mdMedia","$mdDialog","docMgntService","orbeonFormRunner","messaging","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";function u(a,b,c,d){a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.language={},a.orgLocPermission=b.ORGANIZATION_USER_HEALTH_PROFESSIONAL_VIEW,a.organizationLocation={queryUrl:"FIND_ACCESSIBLE_LOCATION_BY_PROFESSIONAL",queryParameter:{id:c.recordUserId,type:c.type},jsonParameter:{}},a.loadForm=function(b){var d="SUPPORT_SERVICE_REVIEW",e={};e.stateName="supportproreviewlist",e.data={id:"1"},r.loadNewFormRunner(c.recordId,d,a.searchCriteria.orgLoc.id,a.searchCriteria.language.id,e),p.hide()},a.hide=function(){p.hide()},a.cancel=function(){p.cancel()}}u.$inject=["$scope","featurePrivilegeConstants","dialogParams","parentScope"],a.review={},a.reviewResponse="",a.disabled=!1,a.review.serviceRating=5;var v="MM/dd/yyyy";a.review.reviewDate=l("timestampToDate")(new Date,v),a.review.reviewUser={},a.review.serviceRatingNegative=!1,a.review.whetherAnonymous=!1,a.manageSupportProSpinner=!1,a.treatmentTypeList=[],a.transactionIdList=[],a.professional={},a.isProfSelected=!1,m.isEmpty(i.getLoggedInUser())||(a.loggedInUserId=i.getLoggedInUser().id),a.setData=function(){a.disabled=!1,"view"===a.pageState&&(a.disabled=!0,a.isHideContent=!0,n.isUserLoggedIn()&&n.isOrgUser()&&(a.isHideContent=!1),a.slider.options.disabled=!0),"add"===a.pageState,"add"!==a.pageState&&"edit"!==a.pageState||(i.getLoggedInUser()&&(a.review.reviewUser.value=i.getLoggedInUser().displayName,a.review.reviewUser.id=i.getLoggedInUser().id),a.isHideContent=!1),a.slider.value=a.review.serviceRating,"edit"===d.type&&(a.isProfSelected=!0,0==a.slider.value&&(a.slider.options.disabled=!0))},a.manageReview=function(d){b.showSpinner=!0,c.updateReview(a.review,a.slider,a.pageState,function(c){b.showSpinner=!1,a.reviewResponse=c;b.loggedInUserDetails.id;if("add"===a.pageState){f("success",g.instant("ADDED_SUCCESS"));var d="SUPPORT_SERVICE_REVIEW";s.triggerMessageEvent(d,c,-1,function(a){e.go("supportproreviewlist",{type:""})},function(a){})}else f("success",g.instant("RECORD_EDITED_SUCESS")),e.go("supportproreviewlist",{type:""})},function(c){b.showSpinner=!1,a.reviewResponse=c})},a.cancel=function(){m.goBackToPrevState()},a.init=function(){a.manageSupportProSpinner=!0,"add"===d.type?(a.pageState="add",a.setData(),a.manageSupportProSpinner=!1):"edit"===d.type?a.pageState="edit":"view"===d.type&&(a.pageState="view"),d.data?(a.professional.data=d.data.professional,w(d.data.professional.id),a.review=d.data,a.setData(),a.manageSupportProSpinner=!1):d.reviewId&&h.getReviewById(d.reviewId,function(b){a.manageSupportProSpinner=!1,a.review=b,a.professional.data=b.professional,a.setData()},function(b){a.manageSupportProSpinner=!1,a.error=b})},a.onProfessionalSelect=function(b){a.isProfSelected=!1,m.isFieldEmpty(b.data)||(a.review.professional=b.data,w(b.data.id),a.isProfSelected=!0)};var w=function(b){a.transactionIdList=[],a.treatmentTypeList=[];var c={};c.professionalId=b,/*Get Transaction ID List*/
j.getData(k.getParameterizedUrl("GET_TRANSACTION_TYPE_BY_PROFESSIONAL",c),null,function(b){a.transactionIdList=angular.fromJson(b.data)}),j.getData(k.getParameterizedUrl("GET_PROFESSIONALSPECIALIZATION_BY_PROFESSIONAL",c),null,function(b){a.treatmentTypeList=angular.fromJson(b.data)})};a.slider={value:0,options:{floor:0,ceil:10,disabled:!1}},a.$watch("review.serviceRatingNegative",function(b){b?(a.slider.value=0,a.slider.options.disabled=!0):a.slider.options.disabled=!1},!0),a.selectOrbeonForm=function(b,c,d,e){var f=(o("sm")||o("xs"))&&a.customFullscreen,f=o("gt-sm");p.show({controller:u,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:t.dialogBox.clickOutsideToClose,fullscreen:f,locals:{dialogParams:{recordId:c,recordUserId:d,type:e},parentScope:a}}).then(function(){},function(){})},a.init()}]),angular.module("paripal.manageReviews").controller("OrgLocUserReviewsListCtrl",["$scope","$rootScope","commonConstants","$state","$stateParams","datatableconfig","serverSidePagination","utilService","OrgLocUserReviewsListService","userStatusService","$mdMedia","$mdDialog","orbeonFormRunner","$translate","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b,c){a.language={},a.callingScreen="ORGANIZATION_REVIEW",a.loadForm=function(c){var d="ORG_REVIEW_FORM",e={};e.stateName="orglocreviewslist",m.loadNewFormRunner(b.record.id,d,b.record.organizationLocation.id,a.searchCriteria.language.id,e,null,0,null),l.hide()},a.hide=function(){l.hide()},a.cancel=function(){l.cancel()}}p.$inject=["$scope","dialogParams","parentScope"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=c,a.filterCriteria={},a.filterCriteria.organization={},a.filterCriteria.organizationLocation={},a.rangeSlider={},a.filterCriteria.diseaseVariant=[],a.filterCriteria.ratingFrom=1,a.filterCriteria.ratingTill=10,j.isUserLoggedIn()&&(a.loggedInUserId=j.userData().userId,a.whetherOrgUser=j.isOrgUser());var q=function(){a.rangeSlider.minValue=0,a.rangeSlider.maxValue=10,i.loadParams(function(b){a.parameters=b},function(a){}),h.isFieldEmpty(e.wallData)||(h.isFieldEmpty(e.wallData.organization)||(a.filterCriteria.organization.data=e.wallData.organization),h.isFieldEmpty(e.wallData.orglocation)||(a.filterCriteria.organizationLocation.data=e.wallData.orglocation)),a.searchReviews();var b=o.getLoggedInUser();1==b.whetherServiceProviderAdmin&&(a.whetherAdmin=!0)};a.getStars=function(a){
// Get the value
var b=parseFloat(a),c=b/5*100;return c+"%"},a.showFeedback=function(a){var b=l.alert().title(n.instant("FEEDBACK")).htmlContent('<div class="padding-t-10  textAlign-J"><b>'+a+"</b></div>").ok(n.instant("OK"));l.show(b).then(function(){},function(){})},a.viewDocumentPdf=function(c,d){b.showSpinner=!1;var e=c.document;d.preventDefault();var f=new Object;f.fileName=e.fileName,f.resourceId=e.id,f.recordId=c.recordId,f.userId=c.documentCreatedForId,a.userId=c.documentCreatedForId,f.orgLocId=e.organizationLocation.id,f.docType=e.documentType.type,f.docSubType=e.documentType.subType,a.fileResource=f,a.viewFileContent=!0,a.isHidingPrintButton=!1},a.searchReviews=function(){a.filterCriteria.pageNumber=a.currentPage,a.filterCriteria.recordsPerPage=a.itemPerPage,b.showSpinner=!0,i.searchReviews(a.filterCriteria,a.rangeSlider,function(c){b.showSpinner=!1,a.reviewList=c.data,a.totalItems=c.totalRecords,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)})},a.clear=function(){d.reload()},a.manageOrgLocReviews=function(a,b){i.manageOrgLocReviews(a,b)},a.inactivateRecord=function(a){i.inactivateRecord(a)},/*******************   Orbeon Form Integration   *****************/
a.selectOrbeonForm=function(b,d,e){var f=(k("sm")||k("xs"))&&a.customFullscreen,f=k("gt-sm");l.show({controller:p,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:c.dialogBox.clickOutsideToClose,fullscreen:f,locals:{dialogParams:{record:d},parentScope:a}}).then(function(){},function(){})},/*******************   Orbeon Form Integration   *****************/
/*********** Server side pagination module **************/
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),a.searchReviews()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchReviews()};/*********************************************************/
/************* Datatable default configuration ***********/
var r=c.gridConfigurations;a.options=f.setOptionProperties(r),/*********************************************************/
q()}]),angular.module("paripal.manageReviews").controller("SupportProReviewListCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","supportProReviewListService","notify","$translate","serverSidePagination","httpService","urlService","featurePrivilegeConstants","baseService","utilService","$mdMedia","$mdDialog","docMgntService","orbeonFormRunner","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(a,b,c,d){a.searchCriteria={},a.orgLoc={},a.orgLoc.data={},a.language={},a.orgLocPermission=b.SUPPORT_PROFESSIONAL_REVIEW_VIEW,a.organizationLocation={queryUrl:"FIND_ACCESSIBLE_LOCATION_BY_PROFESSIONAL",queryParameter:{id:c.recordUserId,type:c.type},jsonParameter:{}},a.loadForm=function(b){var d="SUPPORT_SERVICE_REVIEW",e={};e.stateName="supportproreviewlist",e.data={id:"1"},r.loadNewFormRunner(c.recordId,d,a.searchCriteria.orgLoc.id,a.searchCriteria.language.id,e,null,0,c.recordUserId),p.hide()},a.hide=function(){p.hide()},a.cancel=function(){p.cancel()}}t.$inject=["$scope","featurePrivilegeConstants","dialogParams","parentScope"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.reviewList=[],a.WSReviewSearchCriteria={},a.error={},a.filterCriteria={},
//$scope.filterCriteria.userData = {};
a.filterCriteria.treatmentTypeValues=[],a.filterCriteriadiseaseVariant={},a.filterCriteria.ratingFrom=1,a.filterCriteria.ratingTill=10,a.error={},a.parameters={},a.supportproReviewSpinner=!1,a.supportproReviewPageSpinner=!1,a.professional={};var u={};a.isDisable=!0,a.organizationLocation={},a.showReport=function(a,b){d.go(a,{professional:{id:b.professional.id,value:b.professional.user.value}})},n.isEmpty(m.getLoggedInUser())||(a.loggedInUserId=m.getLoggedInUser().id),a.searchReviews=function(){a.WSReviewSearchCriteria.pageNumber=a.currentPage,a.WSReviewSearchCriteria.recordsPerPage=a.itemPerPage,a.supportproReviewSpinner=!0,f.searchReviews(a.WSReviewSearchCriteria,u,a.rangeSlider,function(b){a.supportproReviewSpinner=!1,a.reviewList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.supportproReviewSpinner=!1,a.error=b,a.reviewList=null})},a.fetchRecords=function(){a.WSReviewSearchCriteria=a.filterCriteria,a.searchReviews()},a.onOrgSelect=function(b){a.filterCriteria.userData="",n.isFieldEmpty(b.data)||(u=b,a.isDisable=!0,b.data.id&&(a.isDisable=!1))},a.clear=function(){a.WSReviewSearchCriteria={},b.$broadcast("clearStatusData"),a.filterCriteria={},a.rangeSlider.minValue=0,a.rangeSlider.maxValue=10,a.organizationLocation.data={},a.isDisable=!0},
//Add new Organisation
a.addReview=function(){d.go("managesupportproreview",{type:"add"})},
//Edit new User
a.getReview=function(b,c){a.supportproReviewPageSpinner=!0,f.getReviewById(b,function(e){a.supportproReviewPageSpinner=!1;var f=e;d.go("managesupportproreview",{type:c,data:f,reviewId:b})},function(b){a.supportproReviewPageSpinner=!1,a.error=b})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.searchReviews()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchReviews()},a.onProfessionalSelect=function(b){a.filterCriteria.userData=b.data,a.WSReviewCriteria.userData=b.data};
//datatble config json
var v={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(v),a.dtColumnDefs=e.setColumnProperties({}),a.selectOrbeonForm=function(b,c,d,e){var f=(o("sm")||o("xs"))&&a.customFullscreen,f=o("gt-sm");p.show({controller:t,templateUrl:"app/modules/reviews/views/org-loc-language-choice.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:s.dialogBox.clickOutsideToClose,fullscreen:f,locals:{dialogParams:{recordId:c,recordUserId:d,type:e},parentScope:a}}).then(function(){},function(){})},a.init=function(){c.professional&&(a.filterCriteria.userData={},a.filterCriteria.userData.id=c.professional.id,a.filterCriteria.userData.value=c.professional.userName,a.fromProfessionalWall=!0),f.loadParams(function(b){a.parameters=b},function(a){}),a.fetchRecords();var b=m.getLoggedInUser();b&&!n.isNullOrEmpty(b.id)&&(a.profId=b.id),b.userAccountStatusDTO&&1==b.userAccountStatusDTO.whetherSupportServiceProfessional&&(a.whetherSupportServiceProfessional=!0),1==b.whetherServiceProviderAdmin&&(a.whetherAdmin=!0)},a.rangeSlider={minValue:0,maxValue:10,options:{floor:0,ceil:10,disabled:!1}},a.$watch("filterCriteria.ratingNegative",function(b){b?(a.rangeSlider.minValue=0,a.rangeSlider.maxValue=10,a.rangeSlider.options.disabled=!0):a.rangeSlider.options.disabled=!1},!0),a.showFeedback=function(a){var b=p.alert().title(h.instant("FEEDBACK")).htmlContent('<div class="padding-t-10 textAlign-J"><b>'+a+"</b></div>").ok(h.instant("OK"));p.show(b).then(function(){},function(){})},a.viewDocumentPdf=function(c,d){b.showSpinner=!1;var e=c.document;d.preventDefault();var f=new Object;f.fileName=e.fileName,f.resourceId=e.id,f.recordId=c.recordId,f.userId=c.documentCreatedForId,a.userId=c.documentCreatedForId,f.orgLocId=e.organizationLocation.id,f.docType=e.documentType.type,f.docSubType=e.documentType.subType,a.fileResource=f,a.viewFileContent=!0,a.isHidingPrintButton=!1},a.getStars=function(a){
// Get the value
var b=parseFloat(a),c=b/5*100;return c+"%"},a.init()}]),angular.module("paripal.manageReviews").service("healthProReviewListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchReviews=function(d,e,f,g,h){var i=JSON.stringify(d),j=JSON.parse(i);if(j.userData&&(j.userId=j.userData.id),delete j.userData,j.parameter)for(var k=0;k<j.parameter.length;k++)"CARE"===j.parameter[k]?j.careRating=!0:"Information"===j.parameter[k]?j.informationRating=!0:"TREATMENT"===j.parameter[k]&&(j.treatmentRating=!0);e&&e.data&&e.data.id?(j.locationId={},j.locationId=e.data.id):j.locationId=null,delete j.parameter,delete j.organizationLocation,j.validTill&&(j.validTill=c.convertToServerDate(j.validTill)),j.validFrom&&(j.validFrom=c.convertToServerDate(j.validFrom)),j.ratingFrom=f.minValue,j.ratingTill=f.maxValue,a.postData(b.getUrl("SEARCH_HEALTH_PRO_REVIEW"),j,function(a){a.data&&a.data.data?g(a.data):h(a)},function(a){h(a)})},this.getReviewById=function(c,e,f){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_HEALTH_PRO_REVIEW_BY_ID",g),null,function(a){a&&a.data?(a.data.reviewDate=d("timestampToDate")(a.data.reviewDate,h),e(a.data)):f(a)},function(a){f(a)})},this.loadParams=function(c,d){var e={};e.type="healthProParams",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.manageReviews").service("manageHealthProReviewService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.updateReview=function(e,f,g,h,i,j,k){/*if (WSReview.professional.id) {
    var id = WSReview.professional.id;
    delete WSReview.professional;
    WSReview.professional = {};
    WSReview.professional.id = id;
}*/
d.isFieldEmpty(e.diseaseVariant)&&(e.diseaseVariant=null),e.reviewDate&&(e.reviewDate=c.convertToServerDate(e.reviewDate)),e.careRating=f.value,e.treatmentRating=g.value,e.informationRating=h.value;var l=null;if(i&&"add"===i)l=b.getUrl("ADD_HEALTH_PRO_REVIEW");else if(i&&"edit"===i){var m={};m.id=e.id,l=b.getParameterizedUrl("UPDATE_HEALTH_PRO_REVIEW",m)}l&&(i&&"add"===i?a.postData(l,e,function(a){a&&a.data?j(a.data):k(a)},function(a){k(a)}):i&&"edit"===i&&a.putData(l,e,function(a){a&&a.data?j(a.data):k(a)},function(a){k(a)}))},this.getTransactionById=function(c,d,e){var f={transactionId:c};a.getData(b.getParameterizedUrl("GET_TRANSACTION_WS_BY_ID",f),null,function(a){d(a.data)},function(a){e(a)})},this.getProfessionalById=function(c,d,e){var f={userId:c};a.getData(b.getParameterizedUrl("GET_PROFESSIONALS_WS_BY_ID",f),null,function(a){d(a.data)},function(a){e(a)})}}]),angular.module("paripal.manageReviews").service("ManageOrgLocUserReviewsService",["httpService","urlService","dateconvertor","utilService","userStatusService","notify",function(a,b,c,d,e,f){"use strict";this.createReview=function(e,g,h,i,j,k,l,m){var n={};angular.copy(e,n),d.isFieldEmpty(n.diseaseVariant)&&(n.diseaseVariant=null),d.isFieldEmpty(n.reviewDate)||(n.reviewDate=c.convertToServerDate(n.reviewDate)),/*if (!utilService.isFieldEmpty(WSReview.treatmentRecordId)) {
                WSReview.treatmentRecordId = review.treatmentRecordId.treatmentRecordId;
            }*/
d.isFieldEmpty(n.treatmentRecordId)||(n.treatmentRecord={id:e.treatmentRecordId.id}),delete n.treatmentRecordId,d.isFieldEmpty(n.organizationLocation)||(n.organizationLocation=n.organizationLocation.data),n.whetherForHealthServices=k.indexOf("whetherForHealthServices")>-1,n.whetherForSupportServices=k.indexOf("whetherForSupportServices")>-1,n.careRating=g.value,n.treatmentRating=h.value,n.informationRating=i.value,n.processRating=j.value,d.isFieldEmpty(n.id)?a.postData(b.getUrl("CREATE_USER_REVIEWS_ON_ORGANIZATION"),n,function(a){f("success",a.data.successMessage),l(a.data)},function(a){}):a.putData(b.getUrl("UPDATE_USER_REVIEWS_ON_ORGANIZATION"),n,function(a){f("success",a.data.successMessage),l(a.data)},function(a){})},this.setReviewObject=function(a,b){var e={};angular.copy(a,e),d.isFieldEmpty(a.organizationLocation)||(e.organizationLocation={},e.organizationLocation.data=a.organizationLocation),d.isFieldEmpty(a.reviewDate)||(e.reviewDate=c.convertToViewDate(a.reviewDate)),b(e)},this.getTreatmentRecord=function(c,d){var f={};f.orgLocId=c.data.id,f.userId=e.userData().userId,a.postData(b.getUrl("GET_USER_TREATMENT_BY_USER_AND_LOC_ID"),f,function(a){d(a.data)},function(){})},this.getDiseaseVariants=function(c,d,f){var g={};g.locId=c.data.id,g.userId=e.userData().userId,a.getData(b.getParameterizedUrl("FIND_DISEASE_VARIANT_BY_USER_AND_LOCATION",g),null,function(a){d(angular.fromJson(a.data))},function(a){f(a)})}}]),angular.module("paripal.manageReviews").service("manageSupportProReviewService",["httpService","urlService","dateconvertor",function(a,b,c){"use strict";this.updateReview=function(d,e,f,g,h){/* if (WSReview.professional.id) {
                 var id = WSReview.professional.id;
                 delete WSReview.professional;
                 WSReview.professional = {};
                 WSReview.professional.id = id;
             }*/
d.serviceRating=e.value,d.reviewDate&&(d.reviewDate=c.convertToServerDate(d.reviewDate));var i=null;if(f&&"add"===f)i=b.getUrl("ADD_SUPPORT_PRO_REVIEW");else if(f&&"edit"===f){var j={};j.id=d.id,i=b.getParameterizedUrl("UPDATE_SUPPORT_PRO_REVIEW",j)}i&&(f&&"add"===f?a.postData(i,d,function(a){a&&a.data?g(a.data):h(a)},function(a){h(a)}):f&&"edit"===f&&a.putData(i,d,function(a){a&&a.data?g(a.data):h(a)},function(a){h(a)}))}}]),angular.module("paripal.manageReviews").service("OrgLocUserReviewsListService",["httpService","urlService","dateconvertor","$filter","utilService","$state","notify",function(a,b,c,d,e,f,g){"use strict";this.searchReviews=function(d,f,g,h){var i={};angular.copy(d,i),e.isFieldEmpty(i.parameter)||(i.parameter.indexOf("CARE")>-1&&(i.careRating=!0),i.parameter.indexOf("Information")>-1&&(i.treatmentRating=!0),i.parameter.indexOf("TREATMENT")>-1&&(i.informationRating=!0)),delete i.parameter,e.isFieldEmpty(i.organizationLocation)||e.isFieldEmpty(i.organizationLocation.data)||(i.locationId=i.organizationLocation.data.id),delete i.organizationLocation,e.isFieldEmpty(i.organization)||e.isFieldEmpty(i.organization.data)||(i.organizationId=i.organization.data.id),delete i.organization,e.isFieldEmpty(i.validTill)||(i.validTill=c.convertToServerDate(i.validTill)),e.isFieldEmpty(i.validFrom)||(i.validFrom=c.convertToServerDate(i.validFrom)),i.ratingFrom=f.minValue,i.ratingTill=f.maxValue,a.postData(b.getUrl("GET_USER_REVIEWED_ORGANIZATIONS_LIST"),i,function(a){g(a.data)},function(a){h(a)})};var h=function(c,d){var e={};e.id=c,a.getData(b.getParameterizedUrl("GET_USER_REVIEWED_ORGANIZATION_BY_ID",e),null,function(a){f.go("manageorglocreviews",{type:d,data:a.data})},function(a){})};this.manageOrgLocReviews=function(a,b){"add"===b?f.go("manageorglocreviews",{type:b}):h(a,b)},this.inactivateRecord=function(c){var d=b.getUrl("INACTIVATE_ORG_REVIEW");d+=c,a.getData(d,null,function(a){g("success",a.data.successMessage)},function(a){errorCallback(a)})},this.loadParams=function(c,d){var e={};e.type="ORG_REVIEW_PARAMS",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){c(a.data)},function(a){d(a)})}}]),angular.module("paripal.manageReviews").service("supportProReviewListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict";this.searchReviews=function(d,e,f,g,h){var i=JSON.stringify(d),j=JSON.parse(i);if(j.userData&&(j.userId=j.userData.id),delete j.userData,j.treatmentType=[],j.treatmentTypeValues&&angular.forEach(j.treatmentTypeValues,function(a,b){j.treatmentType.push(a.id)}),delete j.treatmentTypeValues,j.parameter)for(var k=0;k<j.parameter.length;k++)1===j.parameter[k]?j.careRating=!0:2===j.parameter[k]?j.treatmentRating=!0:3===j.parameter[k]&&(j.informationRating=!0);e&&e.data&&e.data.id&&(j.locationId={},j.locationId=e.data.id),delete j.parameter,j.validTill&&(j.validTill=c.convertToServerDate(j.validTill)),j.validFrom&&(j.validFrom=c.convertToServerDate(j.validFrom)),j.ratingFrom=f.minValue,j.ratingTill=f.maxValue,a.postData(b.getUrl("SEARCH_SUPPORT_PRO_REVIEW"),j,function(a){g(a.data)},function(a){h(a)})},this.getReviewById=function(c,e,f){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_SUPPORT_PRO_REVIEW_BY_ID",g),null,function(a){a&&a.data?(a.data.reviewDate=d("timestampToDate")(a.data.reviewDate,h),e(a.data)):f(a)},function(a){f(a)})},this.loadParams=function(c,d){var e={};e.type="healthProParams",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.searchHospitalModule").controller("SearchHospitalCtrl",["$scope","commonConstants","datatableconfig","NgMap","httpService","urlService","utilService","SearchHospitalService","$state","$stateParams","$translate","$filter","GeoCoder","$mdDialog","GoogleMap",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.commonConstants=b,a.currentLocation="current-location";var p={},q=[];a.filter={},a.filter.radius="5000",a.filter.slider=a.filter.radius/1e3,a.currentLocationObject={},a.hospitalList=new Array,a.whetherPrioriyCalls=!1,a.treatment={queryUrl:"GET_EMERGENCY_TYPES",queryParameter:{},jsonParameter:{}},d.getMap().then(function(b){a.map=b,b.addListener("zoom_changed",function(){12!==b.getZoom()&&a.whetherSetToDefalut&&(a.whetherSetToDefalut=!1,b.setZoom(12))})}),a.marker={greenpointer:"app/images/pointers/green-dot.png"},a.city={queryUrl:"FIND_CITY_BY_NAME",queryParameter:{},jsonParameter:{}};var r=function(){s(),g.isEmpty(j.emergencyType)||(a.filter.treatmentType=j.emergencyType,a.isTreatmentTypeDisable=!0),g.isFieldEmpty(localStorage.WSEmergencyTransaction)||g.isFieldEmpty(angular.fromJson(localStorage.WSEmergencyTransaction).WSEmergencyTransaction.hospitalSelected)||angular.copy(angular.fromJson(localStorage.WSEmergencyTransaction).WSEmergencyTransaction.hospitalSelected,p),a.showCancelBtn="calledFromEmergencyTransaction"===j.type,a.showEmegerncyLocationBtn="changeEmergencyLocation"===j.caller&&"calledFromEmergencyTransaction"===j.type,a.data={modes:[{value:"DRIVING",text:k.instant("DRIVING")},{value:"WALKING",text:k.instant("WALKING")},{value:"TRANSIT",text:k.instant("TRANSIT")}],travelMode:{value:"DRIVING",text:k.instant("DRIVING")}}},s=function(b){e.getJsonData(f.getJsonFileUrl("ORGANIZATION_TYPE_ICON_LIST",null),function(b){b&&b.data&&(a.iconsList={},angular.copy(b.data,a.iconsList),t())},function(a){})},t=function(){a.whetherPrioriyCalls=!1,/*getCurrentPos("18.5204303", "73.85674369999992", false);*/
navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.whetherPrioriyCalls=!0,u(b.coords.latitude,b.coords.longitude,!0),a.mapErrorMessage=null})},function(b){if(2==b.code&&"application does not have sufficient geolocation permissions."==b.message){var c=n.confirm().title(k.instant("CHECK_GPS")).textContent(k.instant("PLEASE_TURN_LOCATION_ON")).ok(k.instant("OK")).cancel(k.instant("CANCEL"));n.show(c).then(function(){n.hide()},function(){n.hide()})}o.getUsersCoordinates(b,function(b){u(b.coords.latitude,b.coords.longitude,!0),g.isFieldEmpty(b.errorMessage)||(a.mapErrorMessage=b.errorMessage)})})},u=function(b,c,d){a.filter.addressLattitudes=b,a.filter.addressLongitudes=c;var e={latLng:new google.maps.LatLng(b,c)};a.changeLocation(e,d)};a.findHospitalByLocation=function(b){angular.copy(q,a.hospitalList),a.hospitalList.push(a.currentLocationObject),a.findNearByHospitals(b)},a.showDetails=function(b,c){g.mobilecheck()||(c.organizationLocationId!==a.selectedId?(a.address=c,a.map.showInfoWindow("foo-iw","id_"+c.organizationLocationAddressId),a.map.hideInfoWindow("bar")):(a.selectHospital(b,c),a.hideDetail()))},a.hideDetail=function(){"calledFromEmergencyTransaction"!==j.type?a.map.hideInfoWindow("foo-iw"):"changeEmergencyLocation"!==j.caller?a.map.hideInfoWindow("foo-iw"):0!==a.address.organizationLocationAddressId&&a.map.hideInfoWindow("foo-iw")},a.selectHospital=function(b,c){a.whetherSetToDefalut=!0,a.destination=g.isFieldEmpty(c.location)?c.addressLattitudes+","+c.addressLongitudes:c.location[0]+","+c.location[1],0!==c.organizationLocationAddressId&&(a.selectedId=c.organizationLocationId,p.organizationLocationId=c.organizationLocationId,a.selectedHospital=c,a.map.showInfoWindow("bar","id_"+c.organizationLocationAddressId)),0!=c.organizationLocationAddressId||"undefined"==typeof cordova&&!g.mobilecheck()||(a.address=c,a.map.showInfoWindow("foo-iw","id_"+c.organizationLocationAddressId)),a.hideDetail()},a.confirmSelection=function(b,c,d){h.storeInLocalStorage(c,d),a.cancel()},a.confirmEmergencyLocation=function(b){h.changeEmergencyLocation(b),a.map.hideInfoWindow("foo-iw"),a.cancel()},a.cancel=function(){var a=null;g.isFieldEmpty(j.callBackURL)||(a=i.current.name),i.go("emergencytransaction",{type:"step2",callbackUrl:i.current.name,callingUrl:a})},a.unconfirm=function(){a.selectedId=null,p.organizationLocationId=null,a.selectedAddress=null,a.map.hideInfoWindow("bar"),a.destination=a.currentLocation,a.whetherSetToDefalut=!0},a.changeRadius=function(){a.filter.radius=1e3*a.filter.slider,a.findHospitalByLocation(!0)},a.changeLocation=function(b,c){a.currentLocation=[b.latLng.lat(),b.latLng.lng()],a.filter.addressLattitudes=b.latLng.lat(),a.filter.addressLongitudes=b.latLng.lng(),a.locationChanged=!0,h.getGeocodeLocation(b,function(c){a.userLocation={userAddress:c,addressLattitudes:b.latLng.lat(),addressLongitudes:b.latLng.lng()}}),a.currentLocationObject={organizationLocationAddressId:0,organizationLocationId:0,addressLattitudes:a.filter.addressLattitudes,addressLongitudes:a.filter.addressLongitudes,isDraggable:!0,organizationTypeIconsEnum:"DEFAULT",isSelected:!1,organizationLocationName:"You dragged here"},a.findHospitalByLocation(c)},a.applyFilter=function(){var b="";g.isFieldEmpty(a.filter.city)||(b+=a.filter.city.value),g.isFieldEmpty(a.filter.postalCode)||(b=g.isFieldEmpty(b)?a.filter.postalCode.toString():b+" "+a.filter.postalCode),g.isFieldEmpty(a.filter.landmark)||(b=g.isFieldEmpty(b)?a.filter.landmark:b+" "+a.filter.landmark),g.isFieldEmpty(b)?a.findHospitalByLocation(!0):(a.hospitalList[0].location=b,d.getMap("map").then(function(){m.geocode({address:b}).then(function(b){
//vm.mapCenter = result[0].geometry.location;
a.currentLocation=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.filter.addressLattitudes=b[0].geometry.location.lat(),a.filter.addressLongitudes=b[0].geometry.location.lng(),a.currentLocationObject.addressLattitudes=b[0].geometry.location.lat(),a.currentLocationObject.addressLongitudes=b[0].geometry.location.lng(),a.hospitalList[0].location=[b[0].geometry.location.lat(),b[0].geometry.location.lng()],a.findHospitalByLocation(!0)})}))},a.findNearByHospitals=function(b){"changeEmergencyLocation"!==j.caller&&(a.searchHospSpinner=!0,h.findNearByHospitals(a.filter,function(c){if(a.searchHospSpinner=!1,0==a.whetherPrioriyCalls||0!=b){var d=c.data;angular.copy(q,a.hospitalList),a.hospitalList=angular.copy(d),a.hospitalList.push(a.currentLocationObject)}},function(){a.searchHospSpinner=!1}))},a.clear=function(){i.reload()},r()}]),angular.module("paripal.searchHospitalModule").service("SearchHospitalService",["httpService","urlService","utilService","notify","$translate",function(a,b,c,d,e){"use strict";this.findNearByHospitals=function(c,d,e){var f=b.getParameterizedUrl("FIND_NEARBY_HOSPITALS",c),g=angular.copy(c);g.radius=g.slider,delete g.slider,a.postData(f,g,function(a){d(a)},function(){e()})},this.findAcceptedHospitals=function(d,e,f){var g={};c.isFieldEmpty(d)||(g.emergencyId=d.emergencyId,g.whetherAccepted=d.whetherAccepted,g.radius=d.slider);var h=b.getParameterizedUrl("EMERGENCY_REQUEST_LIST",g);/*var requestData = angular.copy(requestParams);*/
a.getData(h,null,function(a){e(a)},function(){f()})},/*this.getAllServiceTypes = function (successCallback) {
    httpService.getData(urlService.getUrl('FIND_ALL_SERVICE_TYPE'), null, function (successResponse) {
        successCallback(angular.fromJson(successResponse.data));
    }, function () {});
};*/
this.getGeocodeLocation=function(a,b){var c=new google.maps.Geocoder;c.geocode({latLng:a.latLng},function(a){a&&a.length>0?b(a[0].formatted_address):d("Warning",e.instant("UNDETERMINED_LOCATION"))})},this.getEventObject=function(a,b,c){if(navigator.geolocation){var d=this;navigator.geolocation.getCurrentPosition(function(b){c.$apply(function(){var c={latLng:new google.maps.LatLng(b.coords.latitude,b.coords.longitude)};d.getGeocodeLocation(c,a)})},function(a){b&&c.$apply(function(){b(a)})})}},this.getLatLong=function(a,b){var c=new google.maps.Geocoder;c&&c.geocode({address:a},function(a,c){c==google.maps.GeocoderStatus.OK&&b(a[0])})},this.storeInLocalStorage=function(a,b){var d={};/* = angular.fromJson(localStorage.getItem("WSEmergencyTransaction"));
                if (utilService.isFieldEmpty(localStorageData)) {
                    localStorageData = {
                        WSEmergencyTransaction: {}
                    };
                }*/
d.hospitalSelected={organizationLocationId:a.organizationLocationId,displayName:a.organizationLocationName},d.emergencyLatitude=b.addressLattitudes,d.emergencyLongitude=b.addressLongitudes,d.emergencyLocation=b.userAddress,d.hospitalLocation="",c.isFieldEmpty(a.addressLine1)||(d.hospitalLocation=a.addressLine1),c.isFieldEmpty(a.cityName)||(d.hospitalLocation=d.hospitalLocation+", "+a.cityName),c.isFieldEmpty(a.postalCode)||(d.hospitalLocation=d.hospitalLocation+", "+a.postalCode),localStorage.setItem("WSGoogleMap",angular.toJson(d))},this.changeEmergencyLocation=function(a){var b=angular.fromJson(localStorage.getItem("WSGoogleMap"));if(c.isFieldEmpty(b))b={},b.emergencyLatitude=a.addressLattitudes,b.emergencyLongitude=a.addressLongitudes,b.emergencyLocation=a.userAddress;else{var d={emergencyLatitude:a.addressLattitudes,emergencyLongitude:a.addressLongitudes,emergencyLocation:a.userAddress};angular.forEach(d,function(a,c){b[c]=a})}localStorage.setItem("WSGoogleMap",angular.toJson(b))}}]),angular.module("paripal.settingsModule").controller("SettingsManagementCtrl",["$scope","baseService","utilService","$rootScope",function(a,b,c,d){"use strict";if(a.loggedInUserData=b.getLoggedInUser(),!c.isNullOrEmpty(d.dashboardMenu)){a.parentMenus=d.dashboardMenu.children;for(var e=0;e<=a.parentMenus.length;e++)null!=a.parentMenus[e]&&"SETTING"==a.parentMenus[e].name&&(a.childMenus=a.parentMenus[e].children)}}]),angular.module("paripal.skypeIntegrationModule").controller("agoraCtrl",["$scope","$rootScope","$mdDialog","skypeService","utilService","$interval","notify","$translate","$cookies","$stateParams","$timeout","$state","commonConstants","baseConfig","userStatusService","$window","$location","MakePrescriptionFactory","appointmentsListService","httpService","baseService","fileOperations","urlService","emergencyUploadListService","AgoraMakePrescriptionFactory","docMgntService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";
//appointment file upload/download
function A(){d.goToUploadDownload(a.appointmentupload,function(b){if(b){console.log(b),b.data.appointmentId=a.appointmentupload.id,b.type="edit",localStorage.setItem("uploadFrmSkype",angular.toJson(b.data));var c=q.absUrl().split("#")[0];p.open(c+"#/appointmentsuploadlist")}},function(a){})}
// appointment record diagnostics
function B(){var b=q.absUrl().split("#")[0],c=a.appointmentupload.id;p.open(b+"#/appointmentnotes/"+c)}
// Redirect patient record in new tab 
function C(){var a=wa,b=xa,c=q.absUrl().split("#")[0];p.open(c+"#/patientRecord/"+a+"/"+b+"//"),console.log(c)}
//Setting Options
function D(b){"BUSY"==b&&"ON_GOING"==a.skype.callStatus?a.SkypeStatus=["BUSY","AWAY"]:a.SkypeStatus=["AVAILABLE","BUSY","AWAY","NOT_AVAILABLE"]}
//Status menu
function E(b){"on"==b&&(a.view=!0),"off"==b&&(a.view=!1)}
//browser exit function
// $scope.onExit = function() {
//   if ($state.current.controller == "skypeCtrl") {
//     if (currentUserStatus != "NOT_AVAILABLE") {
//       updateSkypeStatus("NOT_AVAILABLE");
//     }
//     if ($scope.skype.callStatus == "ON_GOING" || $scope.skype.callStatus == "NOT_YET_STARTED") {
//       updateCallStatus("CANCELLED");
//     }
//     $interval.cancel(convById);
//     $interval.cancel(userInfo);
//   }
// };
// $window.onbeforeunload = $scope.onExit;
//flag==true?null:$scope.onExit;
//  $window.onbeforeunload = (flag!=true?null:$scope.onExit);
//For Role Based UI 
function F(){
//Patient
"PATIENT"==Fa?(a.patientControl=!0,a.doctorControl=!1,"EMERGENCY"==a.skype.convType?(a.cancelControl=!0,a.placeControl=!1,a.callDocControl=!0,
// $scope.callPatControl=false;
a.callPatControl=!0):"APPOINTMENT"==a.skype.convType&&(a.patientControl=!0,a.doctorControl=!1,
//$scope.cancelControl=false;
//set to true inorder to show the cancel request before call starts 
a.cancelControl=!0,a.placeControl=!1,a.coordinatorview=!0)):"DOCTOR"==Fa&&(a.patientControl=!1,a.doctorControl=!0,a.cancelControl=!1,a.placeControl=!1,"APPOINTMENT"==a.skype.convType&&(a.callPatControl=!0,a.coordinatorview=!0))}
//timer functions
function G(){a.$broadcast("timer-start")}function H(){a.$broadcast("timer-stop")}
//Getting Conversation details
function I(c){c?d.getConversationByConvId(c,function(c){c&&("CANCELLED"!=a.skype.callStatus&&"COMPLETED"!=a.skype.callStatus||"DOCTOR"==Fa&&(
//getnextConversation();
//changes done to auto close the doctor side for emergency and appointment dated 12/07/2019
V("NOT_AVAILABLE"),H()),"PATIENT"==Fa&&"CANCELLED"==c.status?(a.skype.callStatus="YOU_CANCELLED_THE_REQUEST",
// ramya 
V("NOT_AVAILABLE")):"PATIENT"==Fa&&"COMPLETED"==c.status?(a.skype.callStatus=c.status,H(),b.showSpinner=!0,
//$timeout(function(){
// 	window.close();
// }, 10000);
Y(),b.showSpinner=!0,k(function(){b.showSpinner=!1,e.goBackToPrevState()},3e3)):a.skype.callStatus=c.status,a.skype.clinic=c.organizationLocation.detailedName,a.skype.clinicId=c.organizationLocation.id,Ba=c.organizationLocation.id,a.skype.createdDate=c.createdDate,Ga.organizationId=a.skype.clinicId,Ga.logoFileName=c.organizationLocation.logoFilePath,Ga.logoDocumentId=c.organizationLocation.logoDocumentId,Ga.userType="ORGANIZATION",a.skype.clinicId&&0==Ga.inc&&L(Ga))},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))}):"DOCTOR"==Fa&&(ba(),fa())}
//Getting Conversation Users
function J(f){f&&d.getUsersInfoByConvId(f,function(d){Ea++;for(var e=0;e<3;e++)d[e]&&("PATIENT"==d[e].userType&&(d[e].user?(a.skype.patientId=d[e].user.id,a.skype.patientName=d[e].user.displayName,a.patientConvUserId=d[e].id,wa=a.skype.patientId,xa=a.skype.patientName,Da.userId=wa,Da.logoFileName=d[e].user.logoFileName,Da.logoDocumentId=d[e].user.logoDocumentId,Da.userType="PATIENT","EMERGENCY"==a.skype.convType&&(a.emerUserReady=d[e].isUserReady),1==d[e].isUserReady?a.patientCallButton=!0:a.patientCallButton=!1,a.skype.patientName==j.userName&&(Fa="PATIENT")):d[e].userName&&(a.skype.patientName=d[e].userName,a.skype.patientId=0,wa=0,xa=a.skype.patientName,a.skype.patientName==j.userName&&(Fa="PATIENT")),d[e].skypeId&&(a.skype.patientSkypeUserName=d[e].skypeId.code,a.skype.patientSkypeId=d[e].skypeId.id,console.log("client:"+a.skype.patientSkypeUserName),b.skype.patientSkypeUserName=a.skype.patientSkypeUserName)),"DOCTOR"==d[e].userType&&(a.skype.doctorName=d[e].user.displayName,a.skype.doctorId=d[e].user.id,a.doctorConvUserId=d[e].id,ya=a.skype.doctorId,za=a.skype.doctorName,Ca.userId=ya,Ca.logoFileName=d[e].user.logoFileName,Ca.logoDocumentId=d[e].user.logoDocumentId,Ca.userType="DOCTOR",a.userReady=d[e].isUserReady,1==d[e].isUserReady?a.patientCallButton=!0:a.patientCallButton=!1,a.skype.doctorName==j.userName&&(Fa="DOCTOR"),d[e].skypeId&&(a.skype.doctorSkypeUserName=d[e].skypeId.code,a.skype.doctorSkypeId=d[e].skypeId.id,console.log("Doctor:"+a.skype.doctorSkypeUserName),b.skype.doctorSkypeUserName=a.skype.doctorSkypeId)),"CO_ORDINATOR"==d[e].userType&&(a.skype.CoordinatorName=d[e].user.displayName,a.skype.CoordinatorId=d[e].user.id,Aa=a.skype.CoordinatorId,a.skype.CoordinatorMob=d[e].user.cell1,Ha.userId=Aa,Ha.logoFileName=d[e].user.logoFileName,Ha.logoDocumentId=d[e].user.logoDocumentId,Ha.userType="CO_ORDINATOR",a.skype.CoordinatorName==j.userName&&(Fa="CO_ORDINATOR"),d[e].skypeId&&(a.skype.CoordinatorSkypeUserName=d[e].skypeId.code,a.skype.CoordinatorSkypeId=d[e].skypeId.id)));a.skype.convId=f,"DOCTOR"==Fa?(O(a.skype.doctorId),
//getnextConversation();
ca(),a.emerUserReady&&"EMERGENCY"==a.skype.convType&&(a.callAcceptCount++,1==a.callAcceptCount&&c.show({templateUrl:"app/modules/skype-integration/views/callAccept-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.cancel=function(){c.cancel()},a.joincall=function(){ma(),G(),a.cancel()},a.agoraCall=function(){na()}}]})),(a.skype.patientId||0==a.skype.patientId)&&T(a.skype)):"PATIENT"==Fa&&(N(a.skype),a.userReady&&"APPOINTMENT"==a.skype.convType&&(a.callAcceptCount++,1==a.callAcceptCount&&c.show({templateUrl:"app/modules/skype-integration/views/callAccept-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.cancel=function(){c.cancel()},a.joincall=function(){ma(),G(),a.cancel()},a.agoraCall=function(){na()}}]})),a.skype.doctorId&&T(a.skype)),1==Ea&&(V("AVAILABLE"),F()),a.skype.doctorId&&0==Ca.inc&&L(Ca),a.skype.patientId&&0==Da.inc&&L(Da),a.skype.CoordinatorId&&0==Ha.inc&&L(Ha)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//360 signIn
function K(){a.isCordova="undefined"!=typeof cordova,0==a.isCordova?(ta=f(function(){I(a.skype.convId)},2e3),ua=f(function(){J(a.skype.convId)},2e3)):(ta=f(function(){I(a.skype.convId)},2e3),ua=f(function(){J(a.skype.convId)},2e3))}
//get Image
function L(b){var c=new Object;c.fileName=b.logoFileName,c.resourceId=b.logoDocumentId,"ORGANIZATION"==b.userType?(c.organizationId=b.organizationId,c.docType=m.documentTypes.orgLogo,c.docSubType=m.documentSubTypes.orgLogo):(c.userId=b.userId,c.docType=m.documentTypes.userIdDocument,c.docSubType=m.documentSubTypes.profilePhoto),d.getImageUrl(c,function(c){"PATIENT"==b.userType?(a.patientImage=c,console.log("patientImage{}{}{}{}{}"+a.patientImage),Da.inc++):"DOCTOR"==b.userType?(a.doctorImage=c,console.log("doctorImage{}{}{}{}{}"+a.doctorImage),Ca.inc++):"CO_ORDINATOR"==b.userType?(a.coordinatorImage=c,Ha.inc++):(b.userType="ORGANIZATION")&&(a.hospiitalImage=c,Ga.inc++)})}
// function issueSkypeId(skypeObj){
// 	var reqObj={};
// 	if(skypeObj.userId){
// 		reqObj.userId=skypeObj.userId;
// 	}else{
// 		reqObj.userId=0;
// 	}
// 	if(skypeObj.convId){
// 		reqObj.convId=skypeObj.convId;
// 	}
// 	if(skypeObj.userName){
// 		reqObj.userName=skypeObj.userName;
// 	}
// 	// skypeService.issueSkypeId(reqObj,function(successResponse){
// 	// 	if(successResponse){
// 	// 	localStorage.setItem('skypeIssuedStatus',true);
// 	// 	localStorage.setItem('skypeIssuedId',successResponse.response.id);
// 	// 	$rootScope.skypeName=successResponse.response.skypeId;
// 	// 	$rootScope.skypePassword=successResponse.response.skypePassword;
// 		popup();
// 		$timeout(function(){
// 			$mdDialog.cancel();
// 			officeSignIn();
// 		},5000)
// 	// 	}
// 	// },function(errorResponse){
// 	// 	if(!utilService.isNullOrEmpty(errorResponse.data.message[0])){
// 	// 		notify("alert", $translate.instant(errorResponse.data.message[0]));
// 	// 	}
// 	//   })
// }
//Issuing skypeId
function M(a){localStorage.getItem("msnFlag")||(localStorage.setItem("msnFlag",!0),
// $cookies.put('msnFlag',true);
la(),k(function(){c.cancel(),K()},5e3))}
//Getting  Queue Status
function N(b){var c={};b.createdDate&&(c.createdDate=b.createdDate),c.location=b.clinicId,b.doctorId&&(c.userId=b.doctorId),b.convId&&(c.convId=b.convId),b.callStatus,d.getQueueStatus(c,function(b){a.skype.queue=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Getting  Doctor Queue Status
function O(b){d.getDoctorQueueStatus(b,function(b){a.skype.Doctorqueue=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Place Request
function P(){var b={};b.createdDate=new Date,b.type="EMERGENCY",b.location=a.skype.clinicId,b.status="NOT_YET_STARTED",d.placeRequest(b,function(b){if(a.skype.convId=b.response,b){var c={};c.convId=a.skype.convId,c.userType="PATIENT",c.userName=j.userName,j.userId&&(c.userId=j.userId),Q(c),a.cancelControl=!0,a.placeControl=!1}},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Add Conversation User
function Q(b){var c={};c.convId=b.convId,c.userType=b.userType,c.userId=b.userId,c.userName=b.userName,d.addConvUser(c,function(b){ta=f(function(){I(a.skype.convId)},2e3),ua=f(function(){J(a.skype.convId)},2e3)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//cancel Request
function R(){a.cancelControl=!1,a.placeControl=!0,S("CANCELLED"),ga(),
//$interval.cancel(convById);
f.cancel(ua),Ea=0}
//updateCallStatus 
function S(b){var c={};c.convId=a.skype.convId,c.status=b,d.updateCallStatus(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Get Skype Status
function T(b){var c={};"DOCTOR"==Fa?(c.userId=b.patientId,c.userName=b.patientName):"PATIENT"==Fa&&(c.userId=b.doctorId,c.userName=b.doctorName),c.convId=b.convId,d.getSkypeStatus(c,function(b){"PATIENT"==Fa?"AVAILABLE"==b.response?(a.skype.doctorSkypeStatus="Doctor in and Available",a.isDoctorLoggedIn=1):"BUSY"==b.response?(a.skype.doctorSkypeStatus="Doctor in but in conversation",a.timerstartCount++,1==a.timerstartCount&&
//$timeout(function(){
G()):"NOT_AVAILABLE"==b.response?(a.skype.doctorSkypeStatus="Doctor not yet in",1==a.isDoctorLoggedIn&&Y()):a.skype.doctorSkypeStatus="Away":"DOCTOR"==Fa&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?(a.skype.patientSkypeStatus="In conversation With Doctor",a.timerstartDoctorCount++,1==a.timerstartDoctorCount&&k(function(){G()},2e3)):"NOT_AVAILABLE"==b.response?a.skype.patientSkypeStatus="Not checked in":a.skype.patientSkypeStatus="Away")},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Getting Coordinator Status
function U(b){var c={};c.userId=c.userId,d.getSkypeStatus(c,function(b){a.skype.coordinatorSkypeStatus=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Updating Skype Status
function V(b){a.view=!1;var c={};c.status=b,"DOCTOR"==Fa?(c.userId=ya,c.userName=za):"PATIENT"==Fa&&(c.userId=wa,c.userName=xa),c.convId=a.skype.convId,d.updateSkypeStatus(c,function(b){b&&("DOCTOR"==Fa?"AVAILABLE"==b.response?a.skype.doctorSkypeStatus="Doctor in and Available":"BUSY"==b.response?a.skype.doctorSkypeStatus="Doctor in but in conversation":"NOT_AVAILABLE"==b.response?(a.skype.doctorSkypeStatus="Doctor not yet in",Y(),aa(c.userId)):a.skype.doctorSkypeStatus="Away":"PATIENT"==Fa&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?a.skype.patientSkypeStatus="In conversation With Doctor":"NOT_AVAILABLE"==b.response?(a.skype.patientSkypeStatus="Not checked in",Y()):a.skype.patientSkypeStatus="Away"),va=b.response)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function W(){c.show({templateUrl:"app/modules/skype-integration/views/confirmationDialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.cancel=function(){c.cancel()},a.confirmCancelRequest=function(){X()}}]})}function X(){var b={};b.id=a.skype.convId,b.status="CANCELLED",d.cancelCallRequest(b,function(a){if(a){
//updateSkypeStatus("NOT_AVAILABLE");
fa();var b={};b.id=wa,b.value=xa,ja(b)}},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//360 Logout
function Y(){if(localStorage.removeItem("skypeIssuedStatus"),localStorage.removeItem("isUserReady"),localStorage.removeItem("usageType"),localStorage.removeItem("emergencyData"),localStorage.removeItem("appmentData"),localStorage.removeItem("videoHtmlElement"),"SKYPE"==localStorage.getItem("usageType"))if(ka(),i.remove("skype_access_token"),"undefined"!=typeof cordova){var a="https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+n.skypeRedirectUrl,c=window.cordova.InAppBrowser.open(a,"_self","hidden=no,location=no,clearsessioncache=yes,clearcache=yes,zoom=yes");console.log("In-app Browser Executed")}else location.assign("https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+n.skypeRedirectUrl);
// else if(localStorage.getItem('usageType')=="AGORA"){
// 	$state.go("home.view");
// }
// location.assign('https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri=' + baseConfig.skypeRedirectUrl);
console.log("signOutUrl set"),localStorage.removeItem("usageType"),"PATIENT"==Fa?(
//releaseSkypeId($scope.skype.patientSkypeId);
//updateConversationLog($scope.skype.convId);
b.showSpinner=!0,k(function(){b.showSpinner=!1,e.goBackToPrevState()},8e3)):"DOCTOR"==Fa&&(
//releaseSkypeId($scope.skype.doctorSkypeId);
b.showSpinner=!0,
// $timeout(function(){
// 	$rootScope.showSpinner = false;
// 	utilService.goBackToPrevState();
// },8000);
k(function(){b.showSpinner=!0,window.close()},5e3)),"undefined"!=typeof cordova&&(c.close(),p.history.back(),console.log("In-app Browser Closed")),f.cancel(ta),f.cancel(ua)}
//Releasing SkypeId
function Z(b){var c={};c.skypeId=b,c.status="AVAILABLE",c.convId=a.skype.convId,d.realeaseSkypeId(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Update conversationLog
function _(b){var c={};c.convId=a.skype.convId,c.status="CANCELLED",d.updateConversationLog(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//removing Doctor from conversation user
function aa(a){d.removeDoctor(a,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Get Next Conversation 
function ba(){var b={};b.userId=ya,
//convObj.callType="EMERGENCY";
b.callType=a.skype.convType,b.status="NOT_YET_STARTED",b.skypeIssuedId=localStorage.getItem("skypeIssuedId"),d.getnextConversation(b,function(b){0!==b.data&&(a.skype.convId=b.data),a.patientsQueueList=b.data,a.skype.convId},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))})}
// Patient Queue List 
function ca(){var b={};b.userId=ya,b.callType=a.skype.convType,b.status="NOT_YET_STARTED",b.skypeIssuedId=localStorage.getItem("skypeIssuedId"),d.getPatientQueueList(b,function(b){a.patientsQueueList=b.data},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))})}
//Mute Control
function da(b){1==b?(a.mute=!1,a.unMute=!0):2==b&&(a.mute=!0,a.unMute=!1)}
//Other Actions Test
function ea(){var a=q.absUrl().split("#")[0];p.open(a+"#/usertestlist/"+xa+"/"+wa)}
// 	upload download based on emergency and appointment
// 	function gotoEmergencyOrAppointment(){
// 	if($stateParams.convType =='APPOINTMENT'){
// 		var url = $location.absUrl().split('#')[0];
//         $window.open(url + '#/appointmentsuploadlist/' + patientName+'/'+ patientId+'/'+doctorName);
// 	}else if($stateParams.convType =='EMERGENCY'){
// 		var url = $location.absUrl().split('#')[0];
//         $window.open(url + '#/emergencyuploadlist/' + patientName+'/'+ patientId+'/'+doctorName);
// 	}
// }
//Clear Patient Credentials
function fa(){a.skype.patientId="",a.skype.patientName="",a.skype.patientSkypeStatus="NOT_AVAILABLE",a.patientImage="app/images/user.jpg",Da.inc=0}
//Clear Doctor Credentials
function ga(){a.skype.doctorName="",a.skype.doctorId="",a.skype.doctorSkypeStatus="",a.doctorImage="app/images/user.jpg",Ca.inc=0}
//getting reqId by convId
function ha(){var b={};b.convId=j.convId,d.uploadViewDocument(b,function(b){return b.data?(a.creq=b.data,a.creq.requestId=a.creq.createRequest.id,a.init(),void 0):null})}
//ramya 14.11.2018 this is used for update user is readyness in conversation user post intialization
function ia(){1!=localStorage.getItem("isUserReady")&&(
//updateConvId
localStorage.setItem("isUserReady",!0),a.conusrObj={},a.conusrObj.isUserReady=!0,a.conusrObj.conversationLog={id:a.skype.convId},a.conusrObj.user={id:a.skype.userId},"DOCTOR"==Fa?(a.conusrObj.userType="DOCTOR",a.conusrObj.id=a.doctorConvUserId):(a.conusrObj.userType="PATIENT",a.conusrObj.id=a.patientConvUserId),d.updateConvUserIsReady(a.conusrObj,function(b){b&&(a.convUserFlag=!0)},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))}))}function ja(b){a.view=!1;var c={};c.status="NOT_AVAILABLE",c.userId=b.id,c.userName=b.value,c.convId=a.skype.convId,d.updateSkypeStatus(c,function(b){b&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?a.skype.patientSkypeStatus="Available":"NOT_AVAILABLE"==b.response?a.skype.patientSkypeStatus="Not checked in":a.skype.patientSkypeStatus="Away",va=b.response)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Signout
function ka(){var b=a.skypeWebApp;b.signInManager.signOut().then(function(){console.log("Signed out")},function(a){console.log(a||"Cannot sign out")})}/*popup start*/
function la(){c.show({templateUrl:"app/modules/skype-integration/views/skypeUserNamePopup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.name=localStorage.getItem("skypeId"),a.password=localStorage.getItem("skypePassword"),a.cancel=function(){c.cancel()}}]})}/*popup end*/
function ma(c){"audio"==c?(a.audioViewAg=!0,a.agoraCallType="Audio"):"video"==c&&(a.videoViewAg=!0,a.disableVideoButton=!0,a.agoraCallType="Video"),"APPOINTMENT"==j.convType?a.hideCallButton=!0:"EMERGENCY"==j.convType&&(a.hideCallButton=!0),S("ON_GOING"),V("BUSY"),a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,
//document.getElementById("join").disabled = true;
document.getElementById("video").disabled=!0;var d=null;a.appId={},
//$scope.appId.value = "edefc5ac273443d589bf440627ff7789";
a.appId.value=n.agoraAppId.toString(),a.channel={},a.channel.value="1000",console.log("Init AgoraRTC client with App ID: "+a.appId.value),
//appId.value = edefc5ac273443d589bf440627ff7789;
b.$broadcast("ngWebcam_on"),Ja=AgoraRTC.createClient({mode:"live"}),Ja.init(a.appId.value,function(){console.log("AgoraRTC client initialized"+Ja),Ja.join(d,a.channel.value,null,function(a){ia(),console.log("User "+a+" join channel successfully"),document.getElementById("video").checked&&(La=videoSource.value,console.log(La),Ma=audioSource.value,console.log(Ma),Ka=AgoraRTC.createStream({streamID:a,audio:!0,cameraId:La,microphoneId:Ma,video:document.getElementById("video").checked,screen:!1}),"audio"==c&&(La={},
// video={};
Ka=AgoraRTC.createStream({streamID:a,audio:!0,cameraId:La,microphoneId:Ma,video:!1,screen:!1}),console.log("localStream"+Ka)),
// else{
//                localStream = AgoraRTC.createStream({streamID: uid, audio: true, cameraId: camera, microphoneId: microphone, video: false, screen: false});			    	         
// }
document.getElementById("video").checked&&Ka.setVideoProfile("720p_3"),
// The user has granted access to the camera and mic.
Ka.on("accessAllowed",function(){console.log("accessAllowed")}),
// The user has denied access to the camera and mic.
Ka.on("accessDenied",function(){console.log("accessDenied")}),Ka.init(function(){console.log("getUserMedia successfully"),Ka.play("agora_local"),Ja.publish(Ka,function(a){console.log("Publish local stream error: "+a)}),Ja.on("stream-published",function(a){console.log("Publish local stream successfully")})},function(a){console.log("getUserMedia failed",a)}))},function(a){console.log("Join channel failed",a)})},function(a){console.log("AgoraRTC client init failed",a)});var e="";Ja.on("error",function(a){console.log("Got error msg:",a.reason),"DYNAMIC_KEY_TIMEOUT"===a.reason&&Ja.renewChannelKey(e,function(){console.log("Renew channel key successfully")},function(a){console.log("Renew channel key failed: ",a)})}),Ja.on("stream-added",function(a){var b=a.stream;
// track = stream.getTracks()[0];  // if only one media track
console.log("New stream added: "+b.getId()),console.log("Subscribe ",b),Ja.subscribe(b,function(a){console.log("Subscribe stream failed",a)})}),Ja.on("stream-subscribed",function(a){var b=a.stream;console.log("stream--->"+b),console.log("Subscribe remote stream successfully: "+b.getId()),0===$("div#video #agora_remote"+b.getId()).length&&
//$('div#video').append('<div id="agora_remote'+stream.getId()+'" style="float:left; width:500px;height:500px;display:inline-block;zoom:100%"></div>');
$("div#video").append('<div class="presPageCSS" id="agora_remote'+b.getId()+'"></div>'),b.play("agora_remote"+b.getId())}),
//added for video show in prescription tag 
k(function(){var a=document.getElementsByClassName("getDivElement")[0].innerHTML;console.log(a),localStorage.setItem("videoHtmlElement",a)},8e3),Ja.on("stream-removed",function(a){var b=a.stream;b.stop(),Ka.close(),$("#agora_remote"+b.getId()).remove(),console.log("Remote stream is removed "+b.getId())}),Ja.on("peer-leave",function(a){var b=a.stream;b&&(b.stop(),Ka.close(),$("#agora_remote"+b.getId()).remove(),console.log(a.uid+" leaved from this channel"))})}function na(){var a={},b=JSON.parse(localStorage.getItem("skype"));a.convId=b.convId,
//console.log("convId",localStorage.skype.convId)
a.callEndTime=new Date,a.callStartTime=new Date,
// convObj.agoraCallType=$scope.agoraCallType;
a.agoraCallType="Video",d.agoraCallLog(a,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function oa(a){var b={},c=JSON.parse(localStorage.getItem("skype"));b.convId=c.convId,b.callEndTime=new Date,
//convObj.callStartTime= new Date();
//convObj.agoraCallType=$scope.agoraCallType;
d.updateAgoraCallLog(b,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function pa(){Ka.disableVideo()}function qa(){AgoraRTC.getDevices(function(a){for(var b=0;b!==a.length;++b){var c=a[b],d=document.createElement("option");d.value=c.deviceId,"audioinput"===c.kind?(d.text=c.label||"microphone "+(Na.length+1),Na.appendChild(d)):"videoinput"===c.kind?(d.text=c.label||"camera "+(Oa.length+1),Oa.appendChild(d)):console.log("Some other kind of source/device: ",c)}})}function ra(){
//document.getElementById("leave").disabled = true;
a.disableVideoButton=!1,Ja.leave(function(){console.log("leave function clinet1----->"+Ja),console.log("camera--->"+La),console.log("microphone--->"+Ma),
// videoSource.hidden=true;
//$rootScope.$broadcast('ngWebcam_off');
La={},Ma=!1,
// video= false;
oa(),Ka.close(),
// localStream.getTracks()[0].stop();
//client1.stopLiveStreaming();
a.$on(function(a){var b=a.stream;b.stop(),Ka.close(),$("#agora_remote"+b.getId()).remove(),console.log("Remote stream is removed "+b.getId())}),a.$on(function(a){var b=a.stream;b&&(b.stop(),Ka.close(),$("#agora_remote"+b.getId()).remove(),console.log(a.uid+" leaved from this channel"))}),
//    var constraints = window.constraints = {  
//    	 audio: false,  video: false
//    	};
//    	// getUserMedianavigator
//   navigator.mediaDevices.getUserMedia(constraints)
// .then(function(stream) {
//   var videoTracks = stream.getVideoTracks();
//   console.log('Got stream with constraints:', constraints);
//   console.log('Using video device: ' + videoTracks[0].label);
//   stream.onremovetrack = function() {
//     console.log('Stream ended');
//   };
//   window.stream = stream; // make variable available to browser console
//   video.srcObject = stream;
// })
//use to stop camera
//	$scope.$broadcast('STOP_WEBCAM');
a.videoViewAg=!1,a.showPhoneButton=!1,a.hideCallButton=!0,console.log("Leavel channel successfully")},function(a){console.log("Leave channel failed")})}function sa(a,b,c,d,e,f,g,h,j,m,n){if(void 0==h&&(h=0),void 0==j&&(j=0),void 0==m&&(m=""),f){
//this.loadForm(formInstanceDetails,recordId,referenceEntityType,orgLocationId,languageId,prevStateParam,formInstanceDetails);
if(n)var o=!0;else var o=!1;var p=f.formName;i.put("formName",p,{path:"/"}),i.put("referenceEntityType",b,{path:"/"}),i.put("recordId",a,{path:"/"});var q=f.documentId,r=w.getOrbeonUrl("FORM_RUNNER_BASE_URL")+p+"/new?access_token="+localStorage.getItem("paripal_token")+"&recordId="+a+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&orgLocationId="+c+"&docType="+b;q&&(o=!0,r=w.getOrbeonUrl("FORM_RUNNER_BASE_URL")+p+"/edit/"+q+"?access_token="+localStorage.getItem("paripal_token")+"&recordId="+a+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&orgLocationId="+c+"&docType="+b);var s=r;
//                      $sce.trustAsResourceUrl(url);
k(function(){var b=l.href("newformRunner",{type:"iframe",url:s,savedRecordId:a,readonly:o,prevStateParam:"tabClose"});window.open(b,"_blank")},10)}else z.getFormInstanceDetails(0,a,b,c,d,g,function(d){
//this.loadForm(sucessResponse,recordId,referenceEntityType,orgLocationId,languageId,prevStateParam,formInstanceDetails);
if(n)var f=!0;else var f=!1;var g=d.formName;i.put("formName",g,{path:"/"}),i.put("referenceEntityType",b,{path:"/"}),i.put("recordId",a,{path:"/"});var k=d.documentId,o=w.getOrbeonUrl("FORM_RUNNER_BASE_URL")+g+"/new?access_token="+localStorage.getItem("paripal_token")+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&recordId="+a+"&orgLocationId="+c+"&docType="+b;k&&(f=!0,
//                                iframeURL = $sce.trustAsResourceUrl(urlService.getOrbeonUrl('FORM_RUNNER_BASE_URL') + formName + "/edit/" + documentId + "?access_token=" + localStorage.getItem('paripal_token') + "&createdFor=" + createdFor + "&recordId=" + recordId + "&orgLocationId=" + orgLocationId + "&docType=" + referenceEntityType);
o=w.getOrbeonUrl("FORM_RUNNER_BASE_URL")+g+"/edit/"+k+"?access_token="+localStorage.getItem("paripal_token")+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&recordId="+a+"&orgLocationId="+c+"&docType="+b);var p=l.href("newformRunner",{type:"iframe",url:o,savedRecordId:a,readonly:f,prevStateParam:e});window.open(p,"_blank")})}a.placeRequest=P,a.updateCallStatus=S,a.muteControl=da,a.getUsersInfoByConvId=J,a.userPopup=M,a.getQueueStatus=N,a.getDoctorQueueStatus=O,a.uiControl=F,a.getSkypeStatus=T,a.coordinatorStatus=U,a.updateSkypeStatus=V,a.cancelRequest=R,a.SkypeStatus=["AVAILABLE","BUSY","AWAY","NOT_AVAILABLE"],a.releaseSkypeId=Z,a.updateConversationLog=_,a.signOut=ka,a.getnextConversation=ba,a.setOptions=D,a.statusOpen=E,a.gotoTest=ea,a.getLogo=L,a.clearDoctor=ga,a.clearPatient=fa,a.removecache=Y,a.officeSignIn=K,a.commonConstants=m,a.popup=la,a.creq={},a.convInfo={},a.skype={},b.skype={},a.patientsInQueue={},a.name="",a.callFileUpload=A,a.goToAppointmentNotes=B,a.goToPatientRecord=C,a.getPatientQueueList=ca,a.cancelCallRequest=W,
// $scope.updateNewSkypeStatus = updateNewSkypeStatus;
a.updatePatientStatus=ja,a.isUserReady=ia,a.showPhoneButton=!0,a.hideCallButton=!1,a.patientCallButton=!1,a.disableVideoButton=!1,a.join=ma,a.agoraCallLog=na,a.updateAgoraCallLog=oa,a.leave=ra,a.disableVideo=pa;var ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca={},Da={},Ea=0,Fa="",Da={},Ca={},Ga={},Ha={};Da.inc=0,Ca.inc=0,Ga.inc=0,Ha.inc=0,a.callAcceptCount=0,
//Getting Conversation Params
a.skype.convId=j.convId,a.skype.userId=j.userId,a.skype.convType=j.convType,a.skype.userName=j.userName,a.unMute=!0,localStorage.setItem("skype",JSON.stringify(a.skype)),
//Skype integration variables
a.defaultView=!0,a.registeredListeners=[],a.sendedText=[],a.status="AVAILABLE",a.isDoctorLoggedIn=0;var Ia;b.count=0,a.timerstartCount=0,a.timerstartDoctorCount=0,
//             $scope.conusrObj = {};
// $scope.conusrObj.isUserReady = false;
b.popupCount=0,b.redirect=0;
//$rootScope.officeCount=0;
var Ja,Ka,La,Ma,Na=document.querySelector("select#audioSource"),Oa=document.querySelector("select#videoSource");
//to attach document
if(
// default logo 
a.doctorImage="app/images/user.jpg",a.patientImage="app/images/user.jpg",a.coordinatorImage="app/images/user.jpg",a.hospitalImage="app/images/billing/hospital.png",
//make prescription 
// $scope.makePrescription1 = MakePrescriptionFactory.makePrescription;
//    $scope.makePrescription = function (ev, orgLocId, userId, disease) {
//        var prevStateParam = {};
//        prevStateParam.params = {
//    			convId: $scope.skype.convId,
//    			userId:$scope.skype.userId,
//    			convType: $scope.skype.convType,
//    			userName:$scope.skype.userName
//    			};
//        $scope.makePrescription1(ev, orgLocId, userId, disease, prevStateParam);
//    }
a.makePrescription1=y.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="agora";var c,d=a.skype.doctorId;if("EMERGENCY"==a.skype.convType){c=a.emergencyData.locationId;var h=a.emergencyData.id}else{c=a.appmentData.organizationLocationId;var f=a.appmentData.id}var i=!1,j=(new Date).getFullYear()+"-"+(new Date).getMonth()+"-"+(new Date).getDate(),k=(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds(),l=a.skype.doctorName+"_"+a.skype.patientName+"_"+j+"_"+k;a.makePrescription1(b,c,d,null,g,f,null,i,l,h)},a.viewPrescription=function(b){"APPOINTMENT"==a.skype.convType?a.viewPresForApptment():a.viewPresForEmergency()},a.viewPresForApptment=function(){s.getPrescriptionByAppId(a.appmentData.id,function(b){a.uploadedPrescriptionList=b.data},function(a){})},a.viewPresForEmergency=function(){s.getPrescriptionByTransactionId(a.emergencyData.id,function(b){a.uploadedPrescriptionList=b.data},function(a){})},
//Call Not allowed
a.wrongCall=function(){g("alert","Not Alllowed To call")},
//issueSkypeId($stateParams);
localStorage.skypeIssuedStatus||"true"==localStorage.skypeIssuedStatus,
//userPopup($stateParams);
K(),localStorage.appmentData&&(a.appmentData=angular.fromJson(localStorage.getItem("appmentData"))),localStorage.emergencyData&&(a.emergencyData=angular.fromJson(localStorage.getItem("emergencyData"))),a.redirectToPrescription=function(){var c=a.appointmentupload.id,d=b.loggedInUserDetails.id,e=b.loggedInUserDetails.displayName,f=a.appointmentupload.organizationLocationId,g=a.appointmentupload.locationName,h=q.absUrl().split("#")[0];window.open(h+"#/searchPrescriptionList/"+c+"/"+d+"/"+e+"/"+f+"/"+g)},
// update map disease 
a.updateMapDisease=function(){c.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{recordDetails:a.appointmentupload,isCurrentDate:!0,baseService:u}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},localStorage.loggedInUser){var Pa=localStorage.loggedInUser;a.loggedInUserDetails=JSON.parse(Pa),a.loggedInUserId=a.loggedInUserDetails.id,ha()}a.buttonLogout=function(){V("NOT_AVAILABLE"),b.showSpinner=!0,k(function(){window.close()},5e3)},a.setcurrentConvWith=function(b){a.skype.convId=b.id,a.skype.convId},
//call end while screen change 
a.$on("$destroy",function(){localStorage.removeItem("skypeIssuedStatus"),"NOT_AVAILABLE"!=va&&V("NOT_AVAILABLE"),"ON_GOING"!=a.skype.callStatus&&"NOT_YET_STARTED"!=a.skype.callStatus||S("CANCELLED"),f.cancel(ta),f.cancel(ua)}),a.init=function(){
// $scope.isCordova = (typeof (cordova) !== "undefined") ? true : false;
a.requestObject={},a.requestObject.module="requestId",a.requestObject.moduleNameAndUser="findAttachmentByRequestAndUser",a.requestObject.moduleName="deleteAttachmentsByRequestIdAndDocId",a.requestObject.forId=a.creq.requestId,a.requestObject.userId=o.userData().userId},
//Video Service Start
a.skypeVideoCall=function(b){a.videoView=!0,a.defaultView=!1,a.audioView=!1,a.chatView=!1,a.showPhoneButton=!0,a.hideCallButton=!1,Ia="video";var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.text(b),d.limit(1),d.getMore().then(function(){var a=d.results();if(0==a.length)throw new Error("The contact not found");return a[0].result}).then(function(b){a.VideoUsername=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.videoService=d.videoService,a.videoService.start().then(function(){V("BUSY")})}).then(null,function(a){console.log("audio video service---> "+a),console.log("Something went wrong")})},
//Audio Service Start
a.skypeAudioCall=function(b){a.videoView=!1,a.audioView=!0,a.defaultView=!1,a.chatView=!1,a.showPhoneButton=!0,a.hideCallButton=!1,Ia="audio";var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.text(b),d.limit(10),d.getMore().then(function(){var a=d.results();if(0==a.length)throw new Error("The contact not found");return a[0].result}).then(function(b){a.audioUsername=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.audioService=d.audioService;d.audioService.start().then(function(){V("BUSY")})}).then(null,function(a){console.log("audio call service---> "+a),console.log("Something went wrong")})},
//Chat Service Start    
a.skypeChat=function(b){a.videoView=!1,a.audioView=!1,a.defaultView=!1,a.chatView=!0,a.showPhoneButton=!0,a.hideCallButton=!1,Ia="message",a.username=b;var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.limit(1),d.text(b),d.getMore().then(function(){var a=d.results();if(a.lenupdateCallStatusgth<1)throw new Error("Contact not found");return a[0].result}).then(function(b){a.skypeWebUser=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.chatService=d.chatService,a.sendedText=[],a.conversation.historyService.activityItems.added(function(b){var c={},d=b.sender.id._value.replace("sip:","");a.skype.patientSkypeUserName==d?c.name=a.skype.patientName:a.skype.doctorSkypeUserName==d?c.name=a.skype.doctorName:a.skype.CoOrdinatorSkypeUserName==d&&(c.name=a.skype.CoOrdinatorName),c.text=b.text._value,a.sendedText.push(c),k(function(){a.$apply()},250)}),a.chatService.start().then(function(a){V("BUSY")})}).then(null,function(a){console.error(a),addNotification("Search failed "+a)})},
//Send Message
a.sendmessage=function(){var b=a.enteredText;b&&a.chatService.sendMessage(b)["catch"](function(a){console.log("Cannot send the message")}),a.enteredText=""},
//new implementation for end call button 
a.endConversation=function(){a.showPhoneButton=!1,a.hideCallButton=!0,a.conversation.leave().then(function(){a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,"message"==Ia&&(a.sendedText=[])},function(a){}).then(function(){})},
//Conversation Service Start
a.endCall=function(){b.showSpinner=!0,H(),ra(),a.showPhoneButton=!0,"DOCTOR"==Fa&&V("AVAILABLE"),
//$scope.conversation.leave().then(function () {
"ON_GOING"==a.skype.callStatus&&S("COMPLETED"),a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,
//releaseSkypeId($scope.skype.patientSkypeId);
fa();var c={};c.id=wa,c.value=xa,ja(c),"message"==Ia&&(a.sendedText=[])},
//audioSelect.onchange = getDevices;
//videoSelect.onchange = getDevices;
qa(),AgoraRTC.checkSystemRequirements()||alert("Your browser does not support WebRTC!"),
//file upload related code 
a.fileChange=function(b){a.files=[];var b=angular.element(b);if(null===b){var c=angular.element(document.querySelector("input#fileInput")),d=c[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)}),c.val(null)}else{var d=b[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)})}a.files&&a.files.length>0&&Qa(a.files)},a.fileChangeForPrescription=function(b){a.files=[];var b=angular.element(b);if(null===b){var c=angular.element(document.querySelector("input#fileInput")),d=c[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)}),c.val(null)}else{var d=b[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)})}a.files&&a.files.length>0&&Ra(a.files)};var Qa=function(b){var c={};c.documentType={},"EMERGENCY"==a.skype.convType?(c.documentType.type=m.documentTypes.transaction,c.documentType.subType=m.documentSubTypes.emergencyTransaction):"APPOINTMENT"==a.skype.convType&&(c.documentType.type=m.documentTypes.transaction,c.documentType.subType=m.documentSubTypes.appointment_transaction),c.documentType.id=24,a.fileUploadSpinner=!0,v.saveAllDocuments(c,!1,b,function(a){b&&b.length>0&&a&&Sa(b,c,a)},function(b){a.fileUploadSpinner=!1})},Ra=function(b){var c={};c.documentType={},"EMERGENCY"==a.skype.convType?(c.documentType.type=m.documentTypes.transaction,c.documentType.subType=m.documentSubTypes.emergencyTransaction):"APPOINTMENT"==a.skype.convType&&(c.documentType.type=m.documentTypes.transaction,c.documentType.subType=m.documentSubTypes.appointment_transaction),c.documentType.id=24,a.fileUploadSpinner=!0,v.saveAllDocuments(c,!1,b,function(a){b&&b.length>0&&a&&(Sa(b,c,a),Ta(b,c,a))},function(b){a.fileUploadSpinner=!1})},Sa=function(b,c,d){localStorage.getItem("appmentData")?a.appmentData=angular.fromJson(localStorage.getItem("appmentData")):localStorage.getItem("emergencyData")&&(a.emergencyData=angular.fromJson(localStorage.getItem("emergencyData")));var f={};f.documentIds=[];for(var g=0;g<d.response.length;g++)f.documentIds.push(d.response[g].id);e.isFieldEmpty(a.appmentData)?e.isFieldEmpty(a.emergencyData)||(f.transactionId=a.emergencyData.id):f.appointmentId=a.appmentData.id,x.saveTransactionAttachment(f,function(a){b&&b.length>0&&d&&Ua(b,c,d,f)},function(b){a.fileUploadSpinner=!1,x.deleteAllDocument(f.documentIds,function(a){},function(a){})})},Ta=function(b,c,d){localStorage.getItem("appmentData")?a.appmentData=angular.fromJson(localStorage.getItem("appmentData")):localStorage.getItem("emergencyData")&&(a.emergencyData=angular.fromJson(localStorage.getItem("emergencyData")));for(var e=new Array,f=0;f<d.response.length;f++){var g={},h=(new Date).getFullYear()+"-"+(new Date).getMonth()+"-"+(new Date).getDate(),i=(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds(),j=a.skype.doctorName+"_"+a.skype.patientName+"_"+h+"_"+i;g.prescriptionRef=j;var k={};k.id=a.skype.doctorId,g.user=k;
// var disease = {};
// disease.id = diseaseId;
// prescriptionHistory.disease = disease;
var l;if("EMERGENCY"==a.skype.convType){l=a.emergencyData.locationId;var m=a.emergencyData.id}else{l=a.appmentData.organizationLocationId;var n=a.appmentData.id}var o={};if(o.id=l,g.organizationLocation=o,n){var p={};p.id=n,g.appointment=p}if(m){var q={};q.id=m,g.transaction=q}if(d.response[f]){var r={};r.id=d.response[f].id,g.document=r}e.push(g)}t.postData(w.getUrl("SAVE_ALL_PRESCRIPTION_HISTORY"),e,function(a){a&&a.data&&a.data.response||errorCallback(a)},function(a){errorCallback(a)})},Ua=function(b,c,d,e){var f=new Object;f.docType=c.documentType.type,f.docSubType=c.documentType.subType,a.appmentData?(f.recordId=a.appmentData.id,f.orgLocId=a.appmentData.organizationLocationId):a.emergencyData&&(f.recordId=a.emergencyData.id),
//paramObject.recordId = $scope.appointmentId;
//paramObject.orgLocId = $scope.treatment.creatingOrgLoc.id;
// paramObject.orgLocId =$stateParams.orgLocId;
d.response&&(f.resourceDetails=JSON.stringify(d.response)),v.uploadMultipleFiles(f,b,function(b){a.fileUploadSpinner=!1,g("success",h.instant("RECORD_SAVED_SUCCESS")),"APPOINTMENT"==a.skype.convType?a.getUploadedFilesForApptList():a.getEmergencyUploadedList()},function(b){a.fileUploadSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING")),x.deleteByTransactionIdAndDocIds(e,function(a){x.deleteAllDocument(e.documentIds,function(a){},function(a){})},function(a){})})};a.getUploadedApptList=function(){"EMERGENCY"==a.skype.convType?a.getEmergencyUploadedList():a.getUploadedFilesForApptList()},a.getUploadedFilesForApptList=function(){var b={};b.appointmentId=a.appmentData.id,b.userId=0,b.pageNo=1,s.getUploadDownloadListForAppointment(b,function(b){a.uploadedDocumentsList=b})},a.getEmergencyUploadedList=function(){var b={};
//$scope.mediaPageNo = pageNo;
b.transactionId=a.emergencyData.id,b.pageNo=1,a.fileUploadSpinner=!0,x.getTransactionAttachment(b,function(b){a.fileUploadSpinner=!1,a.uploadedDocumentsList=b},function(b){a.fileUploadSpinner=!1})},a.documentViewPrintFile=function(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.documentId,b.appointmentId?(c.recordId=b.appointmentId,c.docType=m.documentTypes.transaction,c.docSubType=m.documentSubTypes.appointment_transaction):b.transactionId&&(c.recordId=b.transactionId,c.docType=m.documentTypes.transaction,c.docSubType=m.documentSubTypes.emergencyTransaction),a.fileResource=c,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0},
//Prescription related code 
a.viewSinglePresc=function(b){if(null==b.document){var c="PRESCRIPTION_REFERENCE_FORM",d="tabClose";sa(b.id,c,b.organizationLocation.id,1,d,null,0,null,null,null,!0)}else{var e=new Object;e.fileName=b.document.value,e.resourceId=b.document.id,b.appointment?(e.recordId=b.appointment.id,e.docType=m.documentTypes.transaction,e.docSubType=m.documentSubTypes.appointment_transaction):b.transaction&&(e.recordId=b.transaction.id,e.docType=m.documentTypes.transaction,e.docSubType=m.documentSubTypes.emergencyTransaction),a.fileResource=e,a.viewFileContent=!0,a.isHidingPrintButton=!0}}}]),angular.module("paripal.skypeIntegrationModule").controller("directCallAgoraCtrl",["$scope","$rootScope","$mdDialog","skypeService","utilService","$interval","notify","$translate","$cookies","$stateParams","$timeout","$state","commonConstants","baseConfig","userStatusService","$window","$location","MakePrescriptionFactory","AgoraMakePrescriptionFactory","httpService","baseService","urlService","appointmentsListService","docMgntService","fileOperations","emergencyUploadListService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";
//appointment file upload/download
function A(){d.goToUploadDownload(a.appointmentupload,function(b){if(b){console.log(b),b.data.appointmentId=a.appointmentupload.id,b.type="edit",localStorage.setItem("uploadFrmSkype",angular.toJson(b.data));var c=q.absUrl().split("#")[0];p.open(c+"#/appointmentsuploadlist")}},function(a){})}
// appointment record diagnostics
function B(){var b=q.absUrl().split("#")[0],c=a.appointmentupload.id;p.open(b+"#/appointmentnotes/"+c)}
// Redirect patient record in new tab 
function C(){var a=Ca,b=Da,c=q.absUrl().split("#")[0];p.open(c+"#/patientRecord/"+a+"/"+b+"//"),console.log(c)}
//Setting Options
function D(b){"BUSY"==b&&"ON_GOING"==a.skype.callStatus?a.SkypeStatus=["BUSY","AWAY"]:a.SkypeStatus=["AVAILABLE","BUSY","AWAY","NOT_AVAILABLE"]}
//Status menu
function E(b){"on"==b&&(a.view=!0),"off"==b&&(a.view=!1)}
//browser exit function
// $scope.onExit = function() {
//   if ($state.current.controller == "skypeCtrl") {
//     if (currentUserStatus != "NOT_AVAILABLE") {
//       updateSkypeStatus("NOT_AVAILABLE");
//     }
//     if ($scope.skype.callStatus == "ON_GOING" || $scope.skype.callStatus == "NOT_YET_STARTED") {
//       updateCallStatus("CANCELLED");
//     }
//     $interval.cancel(convById);
//     $interval.cancel(userInfo);
//   }
// };
// $window.onbeforeunload = $scope.onExit;
//flag==true?null:$scope.onExit;
//  $window.onbeforeunload = (flag!=true?null:$scope.onExit);
//For Role Based UI 
function F(){
//Patient
"PATIENT"==La?(a.patientControl=!0,a.doctorControl=!1,"EMERGENCY"==a.skype.convType?(a.cancelControl=!0,a.placeControl=!1,a.callDocControl=!0,a.callPatControl=!1):"APPOINTMENT"==a.skype.convType?(a.patientControl=!0,a.doctorControl=!1,a.cancelControl=!1,a.placeControl=!1,a.coordinatorview=!0):"DIRECT_CALL"==a.skype.convType&&(
// $scope.cancelControl=true;
// $scope.placeControl=false;
// $scope.callDocControl=true;
// $scope.callPatControl=false;
a.patientControl=!0,a.doctorControl=!1,a.cancelControl=!0,a.placeControl=!1)):"DOCTOR"==La&&(a.patientControl=!1,a.doctorControl=!0,a.cancelControl=!1,a.placeControl=!1,"APPOINTMENT"==a.skype.convType?(a.callPatControl=!0,a.coordinatorview=!0):"DIRECT_CALL"==a.skype.convType&&(a.callPatControl=!0))}
//Getting Conversation details
function G(c){c?d.getConversationByConvId(c,function(c){c&&(c&&c.appointmentId&&(a.appointmentId=c.appointmentId),a.assignedDoctorLocationId=c.organizationLocation.id,"CANCELLED"!=a.skype.callStatus&&"COMPLETED"!=a.skype.callStatus||"DOCTOR"==La&&X("NOT_AVAILABLE"),"PATIENT"==La&&"CANCELLED"==c.status?(a.skype.callStatus="YOU_CANCELLED_THE_REQUEST",
// ramya 
X("NOT_AVAILABLE"),1!=localStorage.whetherParipalAsSubdomain&&"true"!=localStorage.whetherParipalAsSubdomain||
// need to add redirection state from whetherParipalAsSubdomain api 
//$state.go("home.view")
k(function(){b.showSpinner=!1,l.go("redirectPatientToAgora")},3e3)):"PATIENT"==La&&"COMPLETED"==c.status?(a.skype.callStatus=c.status,
//$rootScope.showSpinner = true;
J(),_(),b.showSpinner=!0,k(function(){b.showSpinner=!1,l.go("redirectPatientToAgora")},3e3)):a.skype.callStatus=c.status,a.skype.clinic=c.organizationLocation.detailedName,a.skype.clinicId=c.organizationLocation.id,Ha=c.organizationLocation.id,a.skype.createdDate=c.createdDate,Ma.organizationId=a.skype.clinicId,Ma.logoFileName=c.organizationLocation.logoFilePath,Ma.logoDocumentId=c.organizationLocation.logoDocumentId,Ma.userType="ORGANIZATION",a.skype.clinicId&&0==Ma.inc&&M(Ma))},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))}):"DOCTOR"==La&&(da(),ha())}
//Getting Conversation Users
function H(f){f&&d.getUsersInfoByConvId(f,function(d){Ka++;for(var e=0;e<3;e++)d[e]&&("PATIENT"==d[e].userType&&(d[e].user?(a.skype.patientId=d[e].user.id,a.skype.patientName=d[e].user.displayName,a.skype.patientCellNumber=d[e].user.cell1,a.patientConvUserId=d[e].id,Ca=a.skype.patientId,Da=a.skype.patientName,Ja.userId=Ca,Ja.logoFileName=d[e].user.logoFileName,Ja.logoDocumentId=d[e].user.logoDocumentId,Ja.userType="PATIENT","EMERGENCY"!=a.skype.convType&&"DIRECT_CALL"!=a.skype.convType||(a.emerUserReady=d[e].isUserReady),1==d[e].isUserReady?a.patientCallButton=!0:a.patientCallButton=!1,a.skype.patientName==j.userName&&(La="PATIENT")):d[e].userName&&(a.skype.patientName=d[e].userName,a.skype.patientId=0,Ca=0,Da=a.skype.patientName,a.skype.patientName==j.userName&&(La="PATIENT")),d[e].skypeId&&(a.skype.patientSkypeUserName=d[e].skypeId.code,a.skype.patientSkypeId=d[e].skypeId.id,console.log("client:"+a.skype.patientSkypeUserName),b.skype.patientSkypeUserName=a.skype.patientSkypeUserName)),"DOCTOR"==d[e].userType&&(a.skype.doctorName=d[e].user.displayName,a.skype.doctorId=d[e].user.id,a.doctorConvUserId=d[e].id,Ea=a.skype.doctorId,Fa=a.skype.doctorName,Ia.userId=Ea,Ia.logoFileName=d[e].user.logoFileName,Ia.logoDocumentId=d[e].user.logoDocumentId,Ia.userType="DOCTOR",a.userReady=d[e].isUserReady,1==d[e].isUserReady?a.patientCallButton=!0:a.patientCallButton=!1,a.skype.doctorName==j.userName&&(La="DOCTOR"),d[e].skypeId&&(a.skype.doctorSkypeUserName=d[e].skypeId.code,a.skype.doctorSkypeId=d[e].skypeId.id,console.log("Doctor:"+a.skype.doctorSkypeUserName),b.skype.doctorSkypeUserName=a.skype.doctorSkypeId)),"CO_ORDINATOR"==d[e].userType&&(a.skype.CoordinatorName=d[e].user.displayName,a.skype.CoordinatorId=d[e].user.id,Ga=a.skype.CoordinatorId,a.skype.CoordinatorMob=d[e].user.cell1,Na.userId=Ga,Na.logoFileName=d[e].user.logoFileName,Na.logoDocumentId=d[e].user.logoDocumentId,Na.userType="CO_ORDINATOR",a.skype.CoordinatorName==j.userName&&(La="CO_ORDINATOR"),d[e].skypeId&&(a.skype.CoordinatorSkypeUserName=d[e].skypeId.code,a.skype.CoordinatorSkypeId=d[e].skypeId.id)));a.skype.convId=f,"DOCTOR"==La?(P(a.skype.doctorId),
//getnextConversation();
ea(),a.emerUserReady&&"EMERGENCY"==a.skype.convType&&(a.callAcceptCount++,1==a.callAcceptCount&&c.show({templateUrl:"app/modules/skype-integration/views/callAccept-popup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.cancel=function(){c.cancel()},a.joincall=function(){oa("video"),a.cancel()},a.agoraCall=function(){pa()}}]})),(a.skype.patientId||0==a.skype.patientId)&&U(a.skype)):"PATIENT"==La&&(O(a.skype),(a.userReady&&"APPOINTMENT"==a.skype.convType||a.userReady&&"DIRECT_CALL"==a.skype.convType)&&(a.callAcceptCount++,1==a.callAcceptCount&&(oa("video"),pa(),I())),a.skype.doctorId&&U(a.skype)),1==Ka&&(X("AVAILABLE"),F()),a.skype.doctorId&&0==Ia.inc&&M(Ia),a.skype.patientId&&0==Ja.inc&&M(Ja),a.skype.CoordinatorId&&0==Na.inc&&M(Na)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function I(){a.$broadcast("timer-start"),a.showTimer=!0}function J(){a.$broadcast("timer-stop")}
//360 signIn
function K(){a.isCordova="undefined"!=typeof cordova,0==a.isCordova?(ya=f(function(){G(a.skype.convId)},2e3),za=f(function(){H(a.skype.convId)},2e3),Aa=f(function(){L(a.skype.userId,a.skype.userName,a.skype.convId)},5e3)):(ya=f(function(){G(a.skype.convId)},2e3),za=f(function(){H(a.skype.convId)},2e3),Aa=f(function(){L(a.skype.userId,a.skype.userName,a.skype.convId)},5e3))}function L(a,b,c){var f={};f.userId=a,f.userName=b,f.convId=c,d.updateLastPingedTime(f,function(a){},function(a){!e.isNullOrEmpty(a.data.message[0])})}
//get Image
function M(b){var c=new Object;c.fileName=b.logoFileName,c.resourceId=b.logoDocumentId,"ORGANIZATION"==b.userType?(c.organizationId=b.organizationId,c.docType=m.documentTypes.orgLogo,c.docSubType=m.documentSubTypes.orgLogo):(c.userId=b.userId,c.docType=m.documentTypes.userIdDocument,c.docSubType=m.documentSubTypes.profilePhoto),d.getImageUrl(c,function(c){"PATIENT"==b.userType?(
//$scope.patientImage = skypeImage;
a.patientImage="app/images/user.jpg",Ja.inc++):"DOCTOR"==b.userType?(a.doctorImage=c,Ia.inc++):"CO_ORDINATOR"==b.userType?(a.coordinatorImage=c,Na.inc++):(b.userType="ORGANIZATION")&&(a.hospiitalImage=c,Ma.inc++)})}
// function issueSkypeId(skypeObj){
// 	var reqObj={};
// 	if(skypeObj.userId){
// 		reqObj.userId=skypeObj.userId;
// 	}else{
// 		reqObj.userId=0;
// 	}
// 	if(skypeObj.convId){
// 		reqObj.convId=skypeObj.convId;
// 	}
// 	if(skypeObj.userName){
// 		reqObj.userName=skypeObj.userName;
// 	}
// 	// skypeService.issueSkypeId(reqObj,function(successResponse){
// 	// 	if(successResponse){
// 	// 	localStorage.setItem('skypeIssuedStatus',true);
// 	// 	localStorage.setItem('skypeIssuedId',successResponse.response.id);
// 	// 	$rootScope.skypeName=successResponse.response.skypeId;
// 	// 	$rootScope.skypePassword=successResponse.response.skypePassword;
// 		popup();
// 		$timeout(function(){
// 			$mdDialog.cancel();
// 			officeSignIn();
// 		},5000)
// 	// 	}
// 	// },function(errorResponse){
// 	// 	if(!utilService.isNullOrEmpty(errorResponse.data.message[0])){
// 	// 		notify("alert", $translate.instant(errorResponse.data.message[0]));
// 	// 	}
// 	//   })
// }
//Issuing skypeId
function N(a){localStorage.getItem("msnFlag")||(localStorage.setItem("msnFlag",!0),
// $cookies.put('msnFlag',true);
na(),k(function(){c.cancel(),K()},5e3))}
//Getting  Queue Status
function O(b){var c={};b.createdDate&&(c.createdDate=b.createdDate),c.location=b.clinicId,b.doctorId&&(c.userId=b.doctorId),b.convId&&(c.convId=b.convId),b.callStatus,d.getQueueStatus(c,function(b){a.skype.queue=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Getting  Doctor Queue Status
function P(b){d.getDoctorQueueStatus(b,function(b){a.skype.Doctorqueue=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Place Request
function Q(){var b={};b.createdDate=new Date,b.type="EMERGENCY",b.location=a.skype.clinicId,b.status="NOT_YET_STARTED",d.placeRequest(b,function(b){if(a.skype.convId=b.response,b){var c={};c.convId=a.skype.convId,c.userType="PATIENT",c.userName=j.userName,j.userId&&(c.userId=j.userId),R(c),a.cancelControl=!0,a.placeControl=!1}},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Add Conversation User
function R(b){var c={};c.convId=b.convId,c.userType=b.userType,c.userId=b.userId,c.userName=b.userName,d.addConvUser(c,function(b){ya=f(function(){G(a.skype.convId)},2e3),za=f(function(){H(a.skype.convId)},2e3)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//cancel Request
function S(){localStorage.setItem("callClosePopup",!0),a.cancelControl=!1,a.placeControl=!0,T("CANCELLED"),ia(),
//$interval.cancel(convById);
f.cancel(za),f.cancel(Aa),l.go("redirectPatientToAgora"),Ka=0}
//updateCallStatus function
function T(b){var c={};c.convId=a.skype.convId,c.status=b,d.updateCallStatus(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Get Skype Status
function U(i){var j={};"DOCTOR"==La?(j.userId=i.patientId,j.userName=i.patientName):"PATIENT"==La&&(j.userId=i.doctorId,j.userName=i.doctorName),j.convId=i.convId,
//skypeService.getNewSkypeStatus(skypeObj,function(successResponse){
d.getNewSkypeStatus(j,function(d){if("PATIENT"==La)"AVAILABLE"==d.response.currentUserStatus?(console.log(d.response.lastPingedTime),a.skype.doctorSkypeStatus="Doctor in and Available",0==a.isDoctorLoggedIn&&(a.isDoctorLoggedIn=1,W(a.skype.doctorId,a.assignedDoctorLocationId))):"BUSY"==d.response.currentUserStatus?a.skype.doctorSkypeStatus="Doctor in but in conversation":"NOT_AVAILABLE"==d.response.currentUserStatus?(a.skype.doctorSkypeStatus="Doctor not yet in",1==a.isDoctorLoggedIn&&_()):a.skype.doctorSkypeStatus="Away";else if("DOCTOR"==La)if("AVAILABLE"==d.response.currentUserStatus){if(
//console.log(successResponse.response.lastPingedTime);
a.skype.patientSkypeStatus="Available",d.response.timeDifference)if(1e3*d.response.timeDifference>m.directCallPingInterval&&"NOT_YET_STARTED"==a.skype.callStatus){if(a.enteredDiaglog++,1==a.enteredDiaglog){a.patientNotActive=!0;var e=c.alert().title(h.instant("ALERT")).textContent(h.instant("Patient is Not Active !! cancelling this request !!")).ok(h.instant("OK"));
//          $interval.cancel(convById);
// $interval.cancel(userInfo);
// $interval.cancel(lastPingTime);
return c.show(e).then(function(){if(Ca&&Da){var a={};a.id=Ca,a.value=Da,la(a)}X("NOT_AVAILABLE"),T("CANCELLED"),f.cancel(ya),f.cancel(za),f.cancel(Aa),b.showSpinner=!0,k(function(){l.go("doctorDirectCallQueueList"),b.showSpinner=!1},5e3)},function(){}),null}}else a.patientNotActive=!1}else if("BUSY"==d.response.currentUserStatus){if(a.skype.patientSkypeStatus="In conversation With Doctor",d.response.timeDifference)if(1e3*d.response.timeDifference>m.onGoingCallPingInterval&&"ON_GOING"==a.skype.callStatus){if(a.enteredOngoingDiaglog++,1==a.enteredOngoingDiaglog){a.patientNotActive=!0;var e=c.confirm().title(h.instant("ALERT")).textContent(h.instant("Patient is Not Active !! cancelling this request !!")).cancel(h.instant("CANCEL")).ok(h.instant("OK"));
//          $interval.cancel(convById);
// $interval.cancel(userInfo);
// $interval.cancel(lastPingTime);
return c.show(e).then(function(){if(Ca&&Da){var a={};a.id=Ca,a.value=Da,la(a)}X("NOT_AVAILABLE"),T("CANCELLED"),f.cancel(ya),f.cancel(za),f.cancel(Aa),b.showSpinner=!0,k(function(){l.go("doctorDirectCallQueueList"),b.showSpinner=!1},5e3)},function(){}),null}}else a.patientNotActive=!1}else"NOT_AVAILABLE"==d.response.currentUserStatus?a.skype.patientSkypeStatus="Not checked in":a.skype.patientSkypeStatus="Away"},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Getting Coordinator Status
function V(b){var c={};c.userId=c.userId,d.getSkypeStatus(c,function(b){a.skype.coordinatorSkypeStatus=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function W(b,c){if(1==a.initialAppIdGet||1==a.isDoctorLoggedIn){a.initialAppIdGet++,a.isDoctorLoggedIn++;var f={};f.userId=b,f.orgLocationId=c,d.getAgoraAppId(f,function(b){b&&b.data&&null!=b.data.successMessage?(a.agoraAppId=b.data.successMessage,console.log("Apppppppp IDDDDDDD ----- "+a.agoraAppId)):a.agoraAppIdMissing=!0},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}}
//Updating Skype Status
function X(b){a.view=!1;var c={};c.status=b,"DOCTOR"==La?(c.userId=Ea,c.userName=Fa):"PATIENT"==La&&(c.userId=Ca,c.userName=Da),c.convId=a.skype.convId,d.updateSkypeStatus(c,function(b){b&&("DOCTOR"==La?"AVAILABLE"==b.response?a.skype.doctorSkypeStatus="Doctor in and Available":"BUSY"==b.response?(a.skype.doctorSkypeStatus="Doctor in but in conversation",k(function(){I()},2e3)):"NOT_AVAILABLE"==b.response?(a.skype.doctorSkypeStatus="Doctor not yet in",_(),ca(c.userId)):a.skype.doctorSkypeStatus="Away":"PATIENT"==La&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?a.skype.patientSkypeStatus="In conversation With Doctor":"NOT_AVAILABLE"==b.response?(a.skype.patientSkypeStatus="Not checked in",_()):a.skype.patientSkypeStatus="Away"),Ba=b.response)},function(a){!e.isNullOrEmpty(a.data.message[0])})}function Y(){c.show({templateUrl:"app/modules/skype-integration/views/confirmationDialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.cancel=function(){c.cancel()},a.confirmCancelRequest=function(){Z()}}]})}function Z(){var b={};b.id=a.skype.convId,b.status="CANCELLED",d.cancelCallRequest(b,function(a){if(a){
//updateSkypeStatus("NOT_AVAILABLE");
ha();var b={};b.id=Ca,b.value=Da,la(b)}},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//360 Logout
function _(){if(
//localStorage.removeItem("agoraTimerHours");
//localStorage.removeItem("agoraTimerMinutes");
//localStorage.removeItem("agoraTimerSeconds");
localStorage.removeItem("skypeIssuedStatus"),localStorage.removeItem("isUserReady"),localStorage.removeItem("usageType"),localStorage.removeItem("videoHtmlElement"),"SKYPE"==localStorage.getItem("usageType"))if(ma(),i.remove("skype_access_token"),"undefined"!=typeof cordova){var d="https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+n.skypeRedirectUrl,e=window.cordova.InAppBrowser.open(d,"_self","hidden=no,location=no,clearsessioncache=yes,clearcache=yes,zoom=yes");console.log("In-app Browser Executed")}else location.assign("https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+n.skypeRedirectUrl);if(
// else if(localStorage.getItem('usageType')=="AGORA"){
// 	$state.go("home.view");
// }
k.cancel(a.stopCheckcontinuevideocall),
// location.assign('https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri=' + baseConfig.skypeRedirectUrl);
console.log("signOutUrl set"),localStorage.removeItem("usageType"),"PATIENT"==La){if("true"==localStorage.callClosePopup);else{var g=c.alert().title(h.instant("ALERT")).textContent(h.instant("Doctor ended the call !!!")).ok(h.instant("OK"));c.show(g).then(function(){},function(){}),k(function(){c.cancel()},3e3)}k(function(){b.showSpinner=!1,l.go("redirectPatientToAgora")},3e3)}else if("DOCTOR"==La){
//$rootScope.showSpinner = true;
//if(!$scope.endcallAlertShow){
if("true"==localStorage.callClosePopup);else{var g=c.alert().title(h.instant("ALERT")).textContent(h.instant("Patient ended the call !!!")).ok(h.instant("OK"));c.show(g).then(function(){},function(){}),k(function(){c.cancel()},3e3)}k(function(){b.showSpinner=!1,l.go("doctorDirectCallQueueList")},3e3)}localStorage.removeItem("callClosePopup"),"undefined"!=typeof cordova&&(e.close(),p.history.back(),console.log("In-app Browser Closed")),f.cancel(ya),f.cancel(za),f.cancel(Aa)}
//Releasing SkypeId
function aa(b){var c={};c.skypeId=b,c.status="AVAILABLE",c.convId=a.skype.convId,d.realeaseSkypeId(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Update conversationLog
function ba(b){var c={};c.convId=a.skype.convId,c.status="CANCELLED",d.updateConversationLog(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//removing Doctor from conversation user
function ca(a){d.removeDoctor(a,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Get Next Conversation 
function da(){var b={};b.userId=Ea,
//convObj.callType="EMERGENCY";
b.callType=a.skype.convType,b.status="NOT_YET_STARTED",b.skypeIssuedId=localStorage.getItem("skypeIssuedId"),d.getnextConversation(b,function(b){0!==b.data&&(a.skype.convId=b.data),a.patientsQueueList=b.data,a.skype.convId},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))})}
// Patient Queue List 
function ea(){var b={};b.userId=Ea,b.callType=a.skype.convType,b.status="NOT_YET_STARTED",b.skypeIssuedId=localStorage.getItem("skypeIssuedId"),d.getPatientQueueList(b,function(b){a.patientsQueueList=b.data},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))})}
//Mute Control
function fa(b){1==b?(a.mute=!1,a.unMute=!0):2==b&&(a.mute=!0,a.unMute=!1)}
//Other Actions Test
function ga(){var a=q.absUrl().split("#")[0];p.open(a+"#/usertestlist/"+Da+"/"+Ca)}
// 	upload download based on emergency and appointment
// 	function gotoEmergencyOrAppointment(){
// 	if($stateParams.convType =='APPOINTMENT'){
// 		var url = $location.absUrl().split('#')[0];
//         $window.open(url + '#/appointmentsuploadlist/' + patientName+'/'+ patientId+'/'+doctorName);
// 	}else if($stateParams.convType =='EMERGENCY'){
// 		var url = $location.absUrl().split('#')[0];
//         $window.open(url + '#/emergencyuploadlist/' + patientName+'/'+ patientId+'/'+doctorName);
// 	}
// }
//Clear Patient Credentials
function ha(){a.skype.patientId="",a.skype.patientName="",a.skype.patientSkypeStatus="NOT_AVAILABLE",a.patientImage="app/images/user.jpg",Ja.inc=0}
//Clear Doctor Credentials
function ia(){a.skype.doctorName="",a.skype.doctorId="",a.skype.doctorSkypeStatus="",a.doctorImage="app/images/user.jpg",Ia.inc=0}
//getting reqId by convId
function ja(){var b={};b.convId=j.convId,d.uploadViewDocument(b,function(b){return b.data?(a.creq=b.data,a.creq.requestId=a.creq.createRequest.id,a.init(),void 0):null})}
//ramya 14.11.2018 this is used for update user is readyness in conversation user post intialization
function ka(){1!=localStorage.getItem("isUserReady")&&(
//updateConvId
localStorage.setItem("isUserReady",!0),a.conusrObj={},a.conusrObj.isUserReady=!0,a.conusrObj.conversationLog={id:a.skype.convId},a.conusrObj.user={id:a.skype.userId},"DOCTOR"==La?(a.conusrObj.userType="DOCTOR",a.conusrObj.id=a.doctorConvUserId):(a.conusrObj.userType="PATIENT",a.conusrObj.id=a.patientConvUserId),d.updateConvUserIsReady(a.conusrObj,function(b){b&&(a.convUserFlag=!0)},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))}))}function la(b){a.view=!1;var c={};c.status="NOT_AVAILABLE",c.userId=b.id,c.userName=b.value,c.convId=a.skype.convId,d.updateSkypeStatus(c,function(b){b&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?a.skype.patientSkypeStatus="Available":"NOT_AVAILABLE"==b.response?a.skype.patientSkypeStatus="Not checked in":a.skype.patientSkypeStatus="Away",Ba=b.response)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Signout
function ma(){var b=a.skypeWebApp;b.signInManager.signOut().then(function(){console.log("Signed out")},function(a){console.log(a||"Cannot sign out")})}/*popup start*/
function na(){c.show({templateUrl:"app/modules/skype-integration/views/skypeUserNamePopup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.name=localStorage.getItem("skypeId"),a.password=localStorage.getItem("skypePassword"),a.cancel=function(){c.cancel()}}]})}/*popup end*/
function oa(d){if(a.agoraAppIdMissing){var e=c.alert().title(h.instant("ALERT")).textContent("Something went wrong !!! Please contact administrator !!!").ok(h.instant("OK"));return void c.show(e).then(function(){if(X("NOT_AVAILABLE"),
//updateCallStatus('CANCELLED');
f.cancel(ya),f.cancel(za),f.cancel(Aa),"PATIENT"==La){if(Ca&&Da){var a={};a.id=Ca,a.value=Da,la(a)}b.showSpinner=!0,k(function(){l.go("redirectPatientToAgora"),b.showSpinner=!1},5e3)}else b.showSpinner=!0,k(function(){l.go("doctorDirectCallQueueList"),b.showSpinner=!1},5e3)},function(){})}if(b.showSpinner=!0,a.patientNotActive){var e=c.alert().title(h.instant("ALERT")).textContent(h.instant("Patient is Not Active !! cancelling this request !!")).ok(h.instant("OK"));return c.show(e).then(function(){if(X("NOT_AVAILABLE"),T("CANCELLED"),Ca&&Da){var a={};a.id=Ca,a.value=Da,la(a)}b.showSpinner=!0,k(function(){l.go("doctorDirectCallQueueList"),b.showSpinner=!1},5e3)},function(){}),null}
//callRingNotifyTone.play();
"audio"==d?(a.audioViewAg=!0,a.agoraCallType="Audio"):"video"==d&&(a.videoViewAg=!0,a.disableVideoButton=!0,a.videoCallDisable=!0,a.agoraCallType="Video"),"APPOINTMENT"==j.convType?a.hideCallButton=!0:"EMERGENCY"!=j.convType&&"DIRECT_CALL"!=j.convType||(a.hideCallButton=!0),T("ON_GOING"),X("BUSY"),a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,
//document.getElementById("join").disabled = true;
document.getElementById("video").disabled=!0;var g=null;a.appId={},
//$scope.appId.value = "edefc5ac273443d589bf440627ff7789";
//$scope.appId.value = baseConfig.agoraAppId.toString();
a.appId.value=a.agoraAppId,a.channel={},a.channel.value="1000",console.log("Init AgoraRTC client with App ID: "+a.appId.value),
//appId.value = edefc5ac273443d589bf440627ff7789;
b.$broadcast("ngWebcam_on"),Pa=AgoraRTC.createClient({mode:"live"}),Pa.init(a.appId.value,function(){"PATIENT"==La&&Va.play(),console.log("AgoraRTC client initialized"+Pa),Pa.join(g,a.channel.value,null,function(a){ka(),console.log("User "+a+" join channel successfully"),document.getElementById("video").checked&&(Ra=videoSource.value,console.log(Ra),Sa=audioSource.value,console.log(Sa),Qa=AgoraRTC.createStream({streamID:a,audio:!0,cameraId:Ra,microphoneId:Sa,video:document.getElementById("video").checked,screen:!1}),"audio"==d&&(Ra={},
// video={};
Qa=AgoraRTC.createStream({streamID:a,audio:!0,cameraId:Ra,microphoneId:Sa,video:!1,screen:!1}),console.log("localStream"+Qa)),
// else{
//                localStream = AgoraRTC.createStream({streamID: uid, audio: true, cameraId: camera, microphoneId: microphone, video: false, screen: false});			    	         
// }
document.getElementById("video").checked&&Qa.setVideoProfile("720p_3"),
// The user has granted access to the camera and mic.
Qa.on("accessAllowed",function(){console.log("accessAllowed")}),
// The user has denied access to the camera and mic.
Qa.on("accessDenied",function(){console.log("accessDenied")}),Qa.init(function(){console.log("getUserMedia successfully"),Qa.play("agora_local"),Pa.publish(Qa,function(a){console.log("Publish local stream error: "+a)}),Pa.on("stream-published",function(a){console.log("Publish local stream successfully")})},function(a){console.log("getUserMedia failed",a)}))},function(a){console.log("Join channel failed",a)})},function(a){console.log("AgoraRTC client init failed",a)});var i="";Pa.on("error",function(a){console.log("Got error msg:",a.reason),"DYNAMIC_KEY_TIMEOUT"===a.reason&&Pa.renewChannelKey(i,function(){console.log("Renew channel key successfully")},function(a){console.log("Renew channel key failed: ",a)})}),Pa.on("stream-added",function(a){var b=a.stream;
// track = stream.getTracks()[0];  // if only one media track
console.log("New stream added: "+b.getId()),console.log("Subscribe ",b),Pa.subscribe(b,function(a){console.log("Subscribe stream failed",a)})}),Pa.on("stream-subscribed",function(a){var c=a.stream;console.log("stream--->"+c),console.log("Subscribe remote stream successfully: "+c.getId()),Va.pause(),b.showSpinner=!1,localStorage.setItem("videoCallProgress",!0),
//localStorage.setItem("localStream",localStream);
0===$("div#video #agora_remote"+c.getId()).length&&$("div#video").append('<div class="presPageCSS" id="agora_remote'+c.getId()+'"></div>'),c.play("agora_remote"+c.getId())}),
//added for video show in prescription tag 
k(function(){var a=document.getElementsByClassName("getDivElement")[0].innerHTML;console.log(a),localStorage.setItem("videoHtmlElement",a)},8e3),Pa.on("stream-removed",function(a){var b=a.stream;b.stop(),Qa.close(),$("#agora_remote"+b.getId()).remove(),console.log("Remote stream is removed "+b.getId())}),Pa.on("peer-leave",function(a){var b=a.stream;b&&(b.stop(),Qa.close(),$("#agora_remote"+b.getId()).remove(),console.log(a.uid+" leaved from this channel"))})}function pa(){var a={},b=JSON.parse(localStorage.getItem("skype"));a.convId=b.convId,a.callEndTime=new Date,a.callStartTime=new Date,a.agoraCallType="Video",d.agoraCallLog(a,function(a){a&&a.response&&(console.log("call Start time--->"+new Date),
//$timeout(function(){
qa("ongoing"))},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
// generateRandomNumber();
// if($scope.continueValue.continue){
// 	console.log("contiue video call");
// 	console.log("contiue video call time interval--->" + $scope.continueValue.for_next_minutes);
// 	continueVideoCall($scope.continueValue.for_next_minutes);
// }else{
// 	$scope.endCall();
// }
function qa(f){var g={};g.phoneNumber=b.loggedInUserDetails.cell1,g.callStatus=f,g.convId=a.skype.convId,"undefined"!=typeof n.callChargingUrl?g.url=n.callChargingUrl:g.url=null,console.log("Entered into first timer check---url-->"+g.url),d.patientContinueStatus(g,function(b){if(!e.isNullOrEmpty(b)&&b.data)if(a.callChargeApiFailed=0,b.data["continue"])console.log("check after "+1e3*b.data.allowed_seconds+"milliseconds---"+new Date),sa(1e3*b.data.allowed_seconds);else{k(function(){a.endCall()},2e3);var d=c.alert().title(h.instant("ALERT")).textContent(h.instant(b.data.message)).ok(h.instant("OK"));c.show(d).then(function(){},function(){}),k(function(){c.cancel()},4e3)}},function(d){if(a.callChargeApiFailed++,console.log("error failed check time"+a.callChargeApiFailed),a.callChargeApiFailed<=3)qa("ongoing");else{var e=c.alert().title(h.instant("ALERT")).textContent("Unable to charge. Please try again later.").ok(h.instant("OK"));c.show(e).then(function(){},function(){}),b.showSpinner=!0,k(function(){c.cancel(),b.showSpinner=!1,a.endCall()},2e3)}})}function ra(b,c){console.log("entered into closecallcontinuouscheck function ");var e={};e.phoneNumber=c,e.callStatus=b,e.convId=a.skype.convId,"undefined"!=typeof n.callChargingUrl?e.url=n.callChargingUrl:e.url=null,console.log("Entered into close call check---url-->"+e.url),d.patientContinueStatus(e,function(a){},function(a){})}
// function generateRandomNumber() {
// 	console.log("generate random number function", new Date())
//     var min = 0,
//         max = 2;
//         $scope.highlightedNumber = Math.random() * (max - min) + min;
//         if($scope.highlightedNumber>=0.5){
//         	return $scope.continueValue = {
//         		continue:true,
//         		for_next_minutes:Math.floor(Math.random() * (30000 - 15000 + 1) + 15000)
//         	};
//         }else{
//         	$scope.endCall();
//         	var confirm = $mdDialog.alert()
//                 .title($translate.instant('ALERT'))
//                 .textContent($translate.instant('Charging failed. Please try again later'))
//                 .ok($translate.instant('OK'));
//                 $mdDialog.show(confirm).then(function () {
//             }, function () {
//             });
//         	return $scope.continueValue ={
//         		continue:false,
//         		message : "Charging failed. Please try again later."
//         	};
//         }
// };
function sa(b){console.log("entered into continue video call after "+b+" milliseconds"),a.stopCheckcontinuevideocall=k(function(){qa("ongoing")},b)}function ta(a){var b={},c=JSON.parse(localStorage.getItem("skype"));b.convId=c.convId,b.callEndTime=new Date,
//convObj.callStartTime= new Date();
//convObj.agoraCallType=$scope.agoraCallType;
d.updateAgoraCallLog(b,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function ua(){Qa.disableVideo()}function va(){AgoraRTC.getDevices(function(a){for(var b=0;b!==a.length;++b){var c=a[b],d=document.createElement("option");d.value=c.deviceId,"audioinput"===c.kind?(d.text=c.label||"microphone "+(Ta.length+1),Ta.appendChild(d)):"videoinput"===c.kind?(d.text=c.label||"camera "+(Ua.length+1),Ua.appendChild(d)):console.log("Some other kind of source/device: ",c)}})}function wa(){a.videoCallDisable=!1,
//document.getElementById("leave").disabled = true;
a.disableVideoButton=!1,"undefined"!=typeof Pa&&Pa.leave(function(){console.log("leave function clinet1----->"+Pa),console.log("camera--->"+Ra),console.log("microphone--->"+Sa),
// videoSource.hidden=true;
//$rootScope.$broadcast('ngWebcam_off');
Ra={},Sa=!1,
// video= false;
ta(),Qa.close(),
// localStream.getTracks()[0].stop();
//client1.stopLiveStreaming();
a.$on(function(a){var b=a.stream;b.stop(),Qa.close(),$("#agora_remote"+b.getId()).remove(),console.log("Remote stream is removed "+b.getId())}),a.$on(function(a){var b=a.stream;b&&(b.stop(),Qa.close(),$("#agora_remote"+b.getId()).remove(),console.log(a.uid+" leaved from this channel"))}),
//    var constraints = window.constraints = {  
//    	 audio: false,  video: false
//    	};
//    	// getUserMedianavigator
//   navigator.mediaDevices.getUserMedia(constraints)
// .then(function(stream) {
//   var videoTracks = stream.getVideoTracks();
//   console.log('Got stream with constraints:', constraints);
//   console.log('Using video device: ' + videoTracks[0].label);
//   stream.onremovetrack = function() {
//     console.log('Stream ended');
//   };
//   window.stream = stream; // make variable available to browser console
//   video.srcObject = stream;
// })
//use to stop camera
//	$scope.$broadcast('STOP_WEBCAM');
a.videoViewAg=!1,a.showPhoneButton=!1,a.hideCallButton=!0,
//$rootScope.showSpinner = false;
console.log("Leave channel successfully")},function(a){console.log("Leave channel failed")})}function xa(a,b,c,d,e,f,g,h,j,m,n){if(void 0==h&&(h=0),void 0==j&&(j=0),void 0==m&&(m=""),f){
//this.loadForm(formInstanceDetails,recordId,referenceEntityType,orgLocationId,languageId,prevStateParam,formInstanceDetails);
if(n)var o=!0;else var o=!1;var p=f.formName;i.put("formName",p,{path:"/"}),i.put("referenceEntityType",b,{path:"/"}),i.put("recordId",a,{path:"/"});var q=f.documentId,r=v.getOrbeonUrl("FORM_RUNNER_BASE_URL")+p+"/new?access_token="+localStorage.getItem("paripal_token")+"&recordId="+a+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&orgLocationId="+c+"&docType="+b;q&&(o=!0,r=v.getOrbeonUrl("FORM_RUNNER_BASE_URL")+p+"/edit/"+q+"?access_token="+localStorage.getItem("paripal_token")+"&recordId="+a+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&orgLocationId="+c+"&docType="+b);var s=r;
//                      $sce.trustAsResourceUrl(url);
k(function(){var b=l.href("newformRunner",{type:"iframe",url:s,savedRecordId:a,readonly:o,prevStateParam:"tabClose"});window.open(b,"_blank")},10)}else x.getFormInstanceDetails(0,a,b,c,d,g,function(d){
//this.loadForm(sucessResponse,recordId,referenceEntityType,orgLocationId,languageId,prevStateParam,formInstanceDetails);
if(n)var f=!0;else var f=!1;var g=d.formName;i.put("formName",g,{path:"/"}),i.put("referenceEntityType",b,{path:"/"}),i.put("recordId",a,{path:"/"});var k=d.documentId,o=v.getOrbeonUrl("FORM_RUNNER_BASE_URL")+g+"/new?access_token="+localStorage.getItem("paripal_token")+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&recordId="+a+"&orgLocationId="+c+"&docType="+b;k&&(f=!0,
//                                iframeURL = $sce.trustAsResourceUrl(urlService.getOrbeonUrl('FORM_RUNNER_BASE_URL') + formName + "/edit/" + documentId + "?access_token=" + localStorage.getItem('paripal_token') + "&createdFor=" + createdFor + "&recordId=" + recordId + "&orgLocationId=" + orgLocationId + "&docType=" + referenceEntityType);
o=v.getOrbeonUrl("FORM_RUNNER_BASE_URL")+g+"/edit/"+k+"?access_token="+localStorage.getItem("paripal_token")+"&createdFor="+h+"&createdBy="+j+"&createdByName="+m+"&recordId="+a+"&orgLocationId="+c+"&docType="+b);var p=l.href("newformRunner",{type:"iframe",url:o,savedRecordId:a,readonly:f,prevStateParam:e});window.open(p,"_blank")})}a.placeRequest=Q,a.updateCallStatus=T,a.muteControl=fa,a.getUsersInfoByConvId=H,a.userPopup=N,a.getQueueStatus=O,a.getDoctorQueueStatus=P,a.uiControl=F,a.getSkypeStatus=U,a.coordinatorStatus=V,a.updateSkypeStatus=X,a.cancelRequest=S,a.SkypeStatus=["AVAILABLE","BUSY","AWAY","NOT_AVAILABLE"],a.releaseSkypeId=aa,a.updateConversationLog=ba,a.signOut=ma,a.getnextConversation=da,a.setOptions=D,a.statusOpen=E,a.gotoTest=ga,a.getLogo=M,a.clearDoctor=ia,a.clearPatient=ha,a.removecache=_,a.officeSignIn=K,a.commonConstants=m,a.popup=na,a.creq={},a.convInfo={},a.skype={},b.skype={},a.patientsInQueue={},a.name="",a.callFileUpload=A,a.goToAppointmentNotes=B,a.goToPatientRecord=C,a.getPatientQueueList=ea,a.cancelCallRequest=Y,
// $scope.updateNewSkypeStatus = updateNewSkypeStatus;
a.updatePatientStatus=la,a.isUserReady=ka,a.showPhoneButton=!0,a.hideCallButton=!1,a.patientCallButton=!1,a.disableVideoButton=!1,a.join=oa,a.agoraCallLog=pa,a.updateAgoraCallLog=ta,a.updateLastPingTime=L,a.leave=wa,a.disableVideo=ua,a.callForAgoraAppId=W,a.videoCallDisable=!0;var ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia={},Ja={},Ka=0,La="",Ja={},Ia={},Ma={},Na={};Ja.inc=0,Ia.inc=0,Ma.inc=0,Na.inc=0,a.callAcceptCount=0,a.enterDestroy=0,
//Getting Conversation Params
a.skype.convId=j.convId,a.skype.userId=j.userId,a.skype.convType=j.convType,a.skype.userName=j.userName,a.unMute=!0,localStorage.setItem("skype",JSON.stringify(a.skype)),
//Skype integration variables
a.defaultView=!0,a.registeredListeners=[],a.sendedText=[],a.status="AVAILABLE",a.isDoctorLoggedIn=0,a.initialAppIdGet=0,a.avoidcallingMultiple=0;var Oa;b.count=0,a.enteredDiaglog=0,a.enteredOngoingDiaglog=0,a.callChargeApiFailed=0,
//             $scope.conusrObj = {};
// $scope.conusrObj.isUserReady = false;
b.popupCount=0,b.redirect=0;
//$rootScope.officeCount=0;
var Pa,Qa,Ra,Sa,Ta=document.querySelector("select#audioSource"),Ua=document.querySelector("select#videoSource"),Va=new Audio;Va.src="app/images/alert_on_call.mp3",
// default logo 
a.doctorImage="app/images/user.jpg",a.patientImage="app/images/user.jpg",a.coordinatorImage="app/images/user.jpg",a.hospitalImage="app/images/billing/hospital.png",
// Close the dropdown if the user clicks outside of it
window.onclick=function(a){if(!a.target.matches(".dropbtn")){var b,c=document.getElementsByClassName("dropdown-content");for(b=0;b<c.length;b++){var d=c[b];d.classList.contains("show")&&d.classList.remove("show")}}},a.goToPrescription=function(){b.loggedInUserDetails.isOrganizationUserMode?a.makePrescription():a.viewPrescription()},a.makePrescription1=s.makePrescription,a.makePrescription=function(b,c,d,e,f){var g={};g.stateName="directCallAgora";var d=j.userId.doctorId,c=j.orgLocId,f=a.appointmentId,h=!1,i=(new Date).getFullYear()+"-"+(new Date).getMonth()+"-"+(new Date).getDate(),k=(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds(),l=a.skype.doctorName+"_"+a.skype.patientName+"_"+i+"_"+k;a.makePrescription1(b,c,d,null,g,f,null,h,l)},a.viewPrescription=function(b){w.getPrescriptionByAppId(a.appointmentId,function(b){a.uploadedPrescriptionList=b.data},function(a){})},a.getUploadedApptList=function(){var b={};b.appointmentId=a.appointmentId,
//$scope.recordId = record.id;
b.userId=0,b.pageNo=1,w.getUploadDownloadListForAppointment(b,function(b){a.uploadedDocumentsList=b})},a.documentViewPrintFile=function(b){var c=new Object;c.fileName=b.fileName,c.resourceId=b.documentId,c.recordId=b.appointmentId,c.docType=m.documentTypes.transaction,c.docSubType=m.documentSubTypes.appointment_transaction,a.fileResource=c,a.viewFileContent=!0,"Document"==b.documentResourceType?a.isHidingPrintButton=!1:a.isHidingPrintButton=!0},a.viewSinglePresc=function(a){var b="PRESCRIPTION_REFERENCE_FORM",c="tabClose";xa(a.id,b,a.organizationLocation.id,1,c,null,0,null,null,null,!0)},a.fileChange=function(b){a.files=[];var b=angular.element(b);if(null===b){var c=angular.element(document.querySelector("input#fileInput")),d=c[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)}),c.val(null)}else{var d=b[0].files;angular.forEach(d,function(b,c){var d=new Object;d.selectedFileObject=b,d.fileName=b.name,a.files.push(d)})}a.files&&a.files.length>0&&Wa(a.files)};var Wa=function(b){var c={};c.documentType={},c.documentType.type="TRANSACTION",c.documentType.subType="APPOINTMENT_TRANSACTION",c.documentType.id=24,a.fileUploadSpinner=!0,y.saveAllDocuments(c,!1,b,function(a){b&&b.length>0&&a&&Xa(b,c,a)},function(b){a.fileUploadSpinner=!1})},Xa=function(b,c,d){var f={};f.documentIds=[];for(var g=0;g<d.response.length;g++)f.documentIds.push(d.response[g].id);e.isFieldEmpty(a.appointmentId)||(f.appointmentId=a.appointmentId),z.saveTransactionAttachment(f,function(a){b&&b.length>0&&d&&Ya(b,c,d,f)},function(b){a.fileUploadSpinner=!1,z.deleteAllDocument(f.documentIds,function(a){},function(a){})})},Ya=function(b,c,d,e){var f=new Object;f.docType=c.documentType.type,f.docSubType=c.documentType.subType,f.recordId=a.appointmentId,
//paramObject.orgLocId = $scope.treatment.creatingOrgLoc.id;
f.orgLocId=j.orgLocId,d.response&&(f.resourceDetails=JSON.stringify(d.response)),y.uploadMultipleFiles(f,b,function(b){a.fileUploadSpinner=!1,g("success",h.instant("RECORD_SAVED_SUCCESS")),a.getUploadedApptList()},function(b){a.fileUploadSpinner=!1,g("Error",h.instant("ERROR_WHILE_UPLOADING")),z.deleteByTransactionIdAndDocIds(e,function(a){z.deleteAllDocument(e.documentIds,function(a){},function(a){})},function(a){})})};
//to attach document
if(
//Call Not allowed
a.wrongCall=function(){g("alert","Not Alllowed To call")},
//Call Not allowed
a.leaveCallAlert=function(){g("alert","Action Not Alllowed")},
//issueSkypeId($stateParams);
localStorage.skypeIssuedStatus||"true"==localStorage.skypeIssuedStatus,
//userPopup($stateParams);
K(),b.loggedInUserDetails.isOrganizationUserMode&&j&&j.userId&&j.orgLocId&&(a.initialAppIdGet=1,W(j.userId,j.orgLocId)),localStorage.appmentData&&(a.appointmentupload=angular.fromJson(localStorage.getItem("appmentData"))),a.redirectToPrescription=function(){var c=a.appointmentupload.id,d=b.loggedInUserDetails.id,e=b.loggedInUserDetails.displayName,f=a.appointmentupload.organizationLocationId,g=a.appointmentupload.locationName,h=q.absUrl().split("#")[0];window.open(h+"#/searchPrescriptionList/"+c+"/"+d+"/"+e+"/"+f+"/"+g)},a.goToUploadDownload=function(b){if(a.appointmentId){var c={};c.appointmentId=a.appointmentId,t.getData(v.getParameterizedUrl("GET_USER_DETAILS_BY_APPT_ID",c),null,function(b){b.data.appointmentId=a.appointmentId,b.data.organizationLocationId=1,b.type="edit",localStorage.setItem("uploadFrmSkype",angular.toJson(b.data));var c=q.absUrl().split("#")[0];p.open(c+"#/appointmentsuploadlist")})}},
// update map disease 
a.updateMapDisease=function(){c.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{recordDetails:a.appointmentupload,isCurrentDate:!0,baseService:u}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},localStorage.loggedInUser){var Za=localStorage.loggedInUser;a.loggedInUserDetails=JSON.parse(Za),a.loggedInUserId=a.loggedInUserDetails.id,ja()}a.buttonLogout=function(){
//localStorage.removeItem("agoraTimerHours");
//localStorage.removeItem("agoraTimerMinutes");
//localStorage.removeItem("agoraTimerSeconds");
X("NOT_AVAILABLE"),b.showSpinner=!0,k(function(){window.close()},5e3)},a.setcurrentConvWith=function(b){a.skype.convId=b.id,a.skype.convId},
//call end while screen change 
a.$on("$destroy",function(){a.enterDestroy++,1==a.enterDestroy&&(a.endCall(),k(function(){b.showSpinner=!1},5e3)),"NOT_AVAILABLE"!=Ba&&X("NOT_AVAILABLE"),"NOT_YET_STARTED"==a.skype.callStatus?T("CANCELLED"):"ON_GOING"==a.skype.callStatus&&(ra("end",a.skype.patientCellNumber),T("COMPLETED")),f.cancel(ya),f.cancel(za),f.cancel(Aa)}),a.init=function(){
// $scope.isCordova = (typeof (cordova) !== "undefined") ? true : false;
a.requestObject={},a.requestObject.module="requestId",a.requestObject.moduleNameAndUser="findAttachmentByRequestAndUser",a.requestObject.moduleName="deleteAttachmentsByRequestIdAndDocId",a.requestObject.forId=a.creq.requestId,a.requestObject.userId=o.userData().userId},
//Video Service Start
a.skypeVideoCall=function(b){a.videoView=!0,a.defaultView=!1,a.audioView=!1,a.chatView=!1,a.showPhoneButton=!0,a.hideCallButton=!1,Oa="video";var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.text(b),d.limit(1),d.getMore().then(function(){var a=d.results();if(0==a.length)throw new Error("The contact not found");return a[0].result}).then(function(b){a.VideoUsername=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.videoService=d.videoService,a.videoService.start().then(function(){X("BUSY")})}).then(null,function(a){console.log("audio video service---> "+a),console.log("Something went wrong")})},
//Audio Service Start
a.skypeAudioCall=function(b){a.videoView=!1,a.audioView=!0,a.defaultView=!1,a.chatView=!1,a.showPhoneButton=!0,a.hideCallButton=!1,Oa="audio";var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.text(b),d.limit(10),d.getMore().then(function(){var a=d.results();if(0==a.length)throw new Error("The contact not found");return a[0].result}).then(function(b){a.audioUsername=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.audioService=d.audioService;d.audioService.start().then(function(){X("BUSY")})}).then(null,function(a){console.log("audio call service---> "+a),console.log("Something went wrong")})},
//Chat Service Start    
a.skypeChat=function(b){a.videoView=!1,a.audioView=!1,a.defaultView=!1,a.chatView=!0,a.showPhoneButton=!0,a.hideCallButton=!1,Oa="message",a.username=b;var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.limit(1),d.text(b),d.getMore().then(function(){var a=d.results();if(a.lenupdateCallStatusgth<1)throw new Error("Contact not found");return a[0].result}).then(function(b){a.skypeWebUser=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.chatService=d.chatService,a.sendedText=[],a.conversation.historyService.activityItems.added(function(b){var c={},d=b.sender.id._value.replace("sip:","");a.skype.patientSkypeUserName==d?c.name=a.skype.patientName:a.skype.doctorSkypeUserName==d?c.name=a.skype.doctorName:a.skype.CoOrdinatorSkypeUserName==d&&(c.name=a.skype.CoOrdinatorName),c.text=b.text._value,a.sendedText.push(c),k(function(){a.$apply()},250)}),a.chatService.start().then(function(a){X("BUSY")})}).then(null,function(a){console.error(a),addNotification("Search failed "+a)})},
//Send Message
a.sendmessage=function(){var b=a.enteredText;b&&a.chatService.sendMessage(b)["catch"](function(a){console.log("Cannot send the message")}),a.enteredText=""},
//new implementation for end call button 
a.endConversation=function(){a.showPhoneButton=!1,a.hideCallButton=!0,a.conversation.leave().then(function(){a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,"message"==Oa&&(a.sendedText=[])},function(a){}).then(function(){})},a.leaveButtonCall=function(){wa(),a.endCall()},
//Conversation Service Start
a.endCall=function(){b.showSpinner=!0,localStorage.setItem("callClosePopup",!0),J(),wa(),"NOT_YET_STARTED"!=a.skype.callStatus&&ra("end",a.skype.patientCellNumber),k.cancel(a.stopCheckcontinuevideocall),
//localStorage.removeItem("agoraTimerHours");
//localStorage.removeItem("agoraTimerMinutes");
//localStorage.removeItem("agoraTimerSeconds");
a.showPhoneButton=!0,
//  	if(userType=="DOCTOR"){
// updateSkypeStatus("AVAILABLE");
//  	}
//$scope.conversation.leave().then(function () {
"ON_GOING"==a.skype.callStatus&&T("COMPLETED"),a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,
//releaseSkypeId($scope.skype.patientSkypeId);
ha();var c={};c.id=Ca,c.value=Da,la(c),"message"==Oa&&(a.sendedText=[])},
//audioSelect.onchange = getDevices;
//videoSelect.onchange = getDevices;
va(),AgoraRTC.checkSystemRequirements()||alert("Your browser does not support WebRTC!"),
//added for external message link redirection
"undefined"==typeof n.sendMessageB&&b.isOrganizationUserMode?a.hideSendSMS=!0:a.hideSendSMS=!1,a.redirectToMessage=function(){var b=n.sendMessageB;
//var validateNo = /^\d{13}$/;
//console.log(url+ $scope.skype.patientCellNumber);
13==a.skype.patientCellNumber.length&&(a.skype.patientCellNumber[0]&&"8"==a.skype.patientCellNumber[1]&&"0"==a.skype.patientCellNumber[2]?p.open(b+a.skype.patientCellNumber):g("alert","Patient number is not valid"))}}]),angular.module("paripal.skypeIntegrationModule").controller("doctorDirectCallQueueListCtrl",["$scope","$rootScope","$mdDialog","$state","datatableconfig","serverSidePagination","utilService","commonConstants","$translate","$stateParams","EmergencyCallManagementService","dateconvertor","httpService","urlService","notify","baseConfig","$timeout","$window","$interval","manageCheckInOutAllotService","manageRequestService","$filter","vprService","appointmentsListService","manageCalendarEventService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";a.currentPage=h.defaultPageNo,a.itemPerPage=h.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=h,a.filterObject={},a.filterObject.dateFrom=l.convertToViewDate(new Date),a.filterObject.dateTill=l.convertToViewDate(new Date),a.filterObject.callRequestMade=!1,a.isCordova="undefined"!=typeof cordova,a.WSAppointment={},b.directCallListCount=0;var z=new Audio;z.src="app/images/alert_on_call.mp3",/***********************************************************************************/
/*****  Url and params for 'FINDING DOCTORS'  *****/
// $scope.updatePatientDetails = function (detailsObj) {
//     $mdDialog.show({
//             controller: 'UpdatePatientDetailsCtrl',
//             templateUrl: 'app/modules/emergency-transaction-management/views/update-patient-details.html',
//             parent: angular.element(document.body),
//             clickOutsideToClose: true,
//             locals: {
//                 detailsObj: detailsObj
//             },
//         })
//         .then(function () {
//         }, function (response) {
//             if (response) {
//                 $state.reload();
//             }
//         });
// }
a.getCallStatus=function(){b.showSpinner=!0,m.getData(n.getUrl("GET_CALL_STATUSES"),null,function(c){b.showSpinner=!1,a.callStatusList=c.data},function(a){b.showSpinner=!1})},a.getCallStatus(),a.setDataToAppointmentFormForm=function(c){a.requestObj={},a.requestObj.actionTaken="RECORDWALKIN",a.requestObj.addressInfo={cityId:a.WSAppointment.patientAddress.city.id,stateId:a.WSAppointment.patientAddress.state.id,
//cityDistrict: "Pune-Pune", 
districtId:a.WSAppointment.patientAddress.district.id,countryId:a.WSAppointment.patientAddress.country.id},a.requestObj.apptDate=a.WSAppointment.apptDate,a.requestObj.apptStartTime=a.WSAppointment.apptStartTime,a.requestObj.checkInTime=new Date,a.requestObj.entityName={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName},a.requestObj.entityType={code:c.entityType},a.requestObj.eventName={id:c.id,value:c.eventName},a.requestObj.eventType=a.WSAppointment.eventType,a.requestObj.existingUserId=a.WSAppointment.patient.id,a.requestObj.guardianId=a.WSAppointment.patient.id,a.requestObj.guardianName=a.WSAppointment.patient.value,a.requestObj.hasGuardian=!1,a.requestObj.isBillable=!0,a.requestObj.isForwarded=!1,a.requestObj.isWalkIn=!0,a.requestObj.orgLocId=c.organizationLocationId,a.requestObj.patient=a.WSAppointment.patient,a.requestObj.patientAddress=a.WSAppointment.patientAddress.addressLine1+","+a.WSAppointment.patientAddress.postalCode,a.requestObj.patientPhoneNumber=a.WSAppointment.patientPhoneNumber,a.requestObj.paymentToBeTaken=c.paymentToBeTaken,
// $scope.requestObj.uhidNumber = 
a.requestObj.userName={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName},a.requestObj.wetherUserExist=!0,a.requestObj.whetherExistingUser=!0,t.saveCheckInOutAllotment(a.requestObj,null,"RECORDWALKIN",function(b){b&&b.response&&(a.recordApptId=b.response.appointmentId,a.assignCallToMyself(a.callToMyselfObj,a.recordApptId)),console.log(b)})},a.assignToMyself=function(c){b.showSpinner=!0;var e={};e.userId=b.loggedInUserDetails.id,e.convId=c.convId,e.directCallPingInterval=a.commonConstants.directCallPingInterval,
// var user = {
//     id: $rootScope.loggedInUserDetails.id
// };
//var convId = record.convId;
k.directCallAssignToDoctor(e,function(a){if(null==a.response&&"Already assigned to Someother Doctor"==a.successMessage)return void(b.showSpinner=!1);if(null==a.response&&"Patient Not Available"==a.successMessage)return void(b.showSpinner=!1);if(null==a.response&&"Patient cancelled the request"==a.successMessage)return void(b.showSpinner=!1);var c={};c.userId=a.response.issuedToUserID.id,c.convId=a.response.convId.id,c.convType="DIRECT_CALL",c.userName=a.response.issuedToUserID.value,c.orgLocId=a.response.orgLocId,localStorage.setItem("isUserReady",!1),b.showSpinner=!1,d.go("directCallAgora",c)})},a.assignToMyself1=function(c){console.log(c),a.callToMyselfObj=c;var d={};d.pickListCode="calendarEntityType",d.pickListItemCode="CAL_ORGANIZATION_USER",u.getPicklistWSByCode(d,function(d){console.log(d);var e={};e.appDate=new Date,e.appointmentType="RECORDWALKIN",
//params.urlState = "manageAppointmentWalkIn";
e.entityType=d.data,e.entityName={id:b.loggedInUserDetails.id,value:b.loggedInUserDetails.displayName},e.clientId=c.patientDetails.id,
//params.requestId = requestManagement.id;
a.manageAppointmentForm(null,"manageAppointmentWalkIn","RECORDWALKIN",null,e)},function(a){})},a.manageAppointmentForm=function(b,c,d,e,f){
// $scope.WSAppointment = {};
var g={appointmentType:d};
//params.requestId = reqstData.requestId;
//$state.go(state, params);
///////////////////////////////////////////////////////////////////////
if(b&&b.id&&(g.appointmentId=b.id),
//params.urlState = state;
f.entityType?g.entityType=f.entityType:b.entityType&&b.entityTypeId&&(g.entityType={id:b.entityTypeId,code:b.entityType}),f.entityName?g.entityName=f.entityName:b.entityId&&b.entityName&&(g.entityName={id:b.entityId,value:b.entityName}),f.eventType?g.eventType=f.eventType:b&&b.eventType&&(g.eventType=b.eventType),f.eventName&&f.eventName.id?g.eventName=f.eventName:b&&b.event&&(g.eventName=b.event),g.appDate=new Date,g.clientId=f.clientId,"RECORDWALKIN"==d){g.clientId&&a.getClientDetails(g.clientId);
//added for other request requestId
// if ($stateParams.requestId) {
//     $scope.WSAppointment.requestId = $stateParams.requestId;
// }
var h=new Date;if(a.WSAppointment.apptDate=v("timestampToDate")(h,"MM/dd/yyyy"),a.WSAppointment.apptStartTime=h.getHours()+":"+h.getMinutes()+":00",g.eventName&&g.eventName.id)a.getCalendarEventDetails(g.eventName.id);else if((!f.eventName||!f.eventType)&&f.entityName&&f.entityType&&"RECORDWALKIN"==d){var i={};i.entityId=f.entityName.id,i.entityType=f.entityType.code,x.getCurrentEvent(i,function(b){b.eventType&&(a.WSAppointment.eventType=b.eventType),b.id&&b.eventName&&(a.WSAppointment.eventName={id:b.id,value:b.eventName}),a.WSAppointment.eventType&&a.WSAppointment.eventName&&a.getCalendarEventDetails(a.WSAppointment.eventName.id)},function(a){})}}},a.getClientDetails=function(b,c){if(!g.isNullOrEmpty(b)){var d={userId:b};w.userDetails(d,function(b){a.WSAppointment.patient={id:angular.fromJson(b.data).id,value:angular.fromJson(b.data).displayName},a.WSAppointment.patientPhoneNumber=angular.fromJson(b.data).cell1,a.WSAppointment.patientAddress=angular.fromJson(b.data).userAddress})}},a.getCalendarEventDetails=function(c){g.isNullOrEmpty(c)||(b.showSpinner=!0,y.getCalendarEventDetails(c,function(c){b.showSpinner=!1,
// if ($stateParams.appointmentType == 'RECORDWALKIN') {
//     if (successResponse.paymentToBeTaken == 'AT_BOOKING' || successResponse.paymentToBeTaken == 'AT_CHECKIN') {
//         $scope.isServiceRequired = true;
//     }
// }
a.setDataToAppointmentFormForm(c)}))},a.assignCallToMyself=function(c,e){var f={};f.userId=b.loggedInUserDetails.id,f.convId=c.convId,f.appointmentId=e,f.directCallPingInterval=a.commonConstants.directCallPingInterval,
// var user = {
//     id: $rootScope.loggedInUserDetails.id
// };
//var convId = record.convId;
k.directCallAssignToDoctor(f,function(a){if(!(null==a.response&&"Already assigned to Someother Doctor"==a.successMessage||null==a.response&&"Patient Not Available"==a.successMessage)){var b={};b.userId=a.response.issuedToUserID.id,b.convId=a.response.convId.id,b.convType="DIRECT_CALL",b.userName=a.response.issuedToUserID.value,b.orgLocId=a.response.orgLocId,localStorage.setItem("isUserReady",!1),d.go("directCallAgora",b)}})},a.searchData=function(){a.filterObject.pageNumber=a.currentPage,a.filterObject.recordsPerPage=a.itemPerPage,
//$rootScope.showSpinner = true;
"CALL_REQUEST_STATUS_NEW"==a.filterObject.callRequestStatusEnum&&(a.filterObject.directCallPingInterval=h.directCallPingInterval),k.searchDirectCallQueueList(a.filterObject,function(c){
//$rootScope.showSpinner = false;
a.emergencyCallList=c.data,a.emergencyCallList.length>b.directCallListCount?(z.play(),b.directCallListCount=a.emergencyCallList.length):(a.emergencyCallList.length<b.directCallListCount||0==a.emergencyCallList.length)&&(b.directCallListCount=a.emergencyCallList.length),console.log(a.emergencyCallList),a.totalItems=c.totalRecords,a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems)})},
// $scope.searchData();
a.rejoinCall=function(a){var b=p.baseUrl+"#/directCallAgora/"+a,c=window.open(b,"_blank");null==c||"undefined"==typeof c?alert('Please disable your pop-up blocker and click the "Open" link again.'):c.focus()},a.init=function(){a.filterObject.callRequestMade=!0,a.defaultStatus="New",a.filterObject.callRequestStatusEnum="CALL_REQUEST_STATUS_NEW",
//Added this for menu issue for whetherParipalAsSubdomain by krishna dated 4-5-2019
"true"==localStorage.whetherParipalAsSubdomain&&("true"==localStorage.whetherReload||q(function(){localStorage.setItem("whetherReload",!0),console.log("reloaded successfuly"),r.location.reload()},200)),a.callListRefresh=s(function(){a.searchData(),console.log("calling 15 sec duration")},a.commonConstants.listIntervalDirectCallAgora),a.searchData()},a.$on("$destroy",function(){s.cancel(a.callListRefresh)}),/**
     *Server side pagination module
     */
a.pageChanged=function(){a.pagingInfo=f(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.clear=function(){d.reload()},a.callRequestMadeChanged=function(){a.filterObject.callRequestStatusEnum=null},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};/**
     *datatble config json
     */
var A=h.gridConfigurations;a.options=e.setOptionProperties(A),a.init()}]),angular.module("paripal.skypeIntegrationModule").controller("redirectPatientToAgoraCtrl",["$scope","$rootScope","$mdDialog","utilService","$interval","notify","$translate","$cookies","$stateParams","$timeout","$state","commonConstants","baseConfig","$window","$location","httpService","baseService","urlService","EmergencyTransactionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.loginDetails=b.loggedInUserDetails,"true"==localStorage.whetherParipalAsSubdomain&&("true"==localStorage.whetherReload||j(function(){localStorage.setItem("whetherReload",!0),console.log("reloaded successfuly"),n.location.reload()},200)),AgoraRTC.checkSystemRequirements()?a.browserCompatible=!0:a.browserCompatible=!1,a.goToAgora=function(c){b.showSpinner=!0;var d={};d.user={id:a.loginDetails.id,value:a.loginDetails.displayName},d.organizationLocation={id:a.loginDetails.organizationId},s.directCallConsultDoctor(d,function(c){var d={};d.userId=a.loginDetails.id,d.convId=c.response,d.convType="DIRECT_CALL",d.userName=a.loginDetails.displayName,localStorage.setItem("isUserReady",!1),b.showSpinner=!1,k.go("directCallAgora",d)})}}]),angular.module("paripal.skypeIntegrationModule").controller("skypeCtrl",["$scope","$rootScope","$mdDialog","skypeService","utilService","$interval","notify","$translate","$cookies","$stateParams","$timeout","$state","commonConstants","baseConfig","userStatusService","$window","$location","MakePrescriptionFactory","httpService","baseService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";
//appointment file upload/download
function w(){d.goToUploadDownload(a.appointmentupload,function(b){if(b){console.log(b),b.data.appointmentId=a.appointmentupload.id,b.type="edit",localStorage.setItem("uploadFrmSkype",angular.toJson(b.data));var c=q.absUrl().split("#")[0];p.open(c+"#/appointmentsuploadlist")}},function(a){})}
// appointment record diagnostics
function x(){var b=q.absUrl().split("#")[0],c=a.appointmentupload.id;p.open(b+"#/appointmentnotes/"+c)}
// Redirect patient record in new tab 
function y(){var a=la,b=ma,c=q.absUrl().split("#")[0];p.open(c+"#/patientRecord/"+a+"/"+b+"//"),console.log(c)}
//Setting Options
function z(b){"BUSY"==b&&"ON_GOING"==a.skype.callStatus?a.SkypeStatus=["BUSY","AWAY"]:a.SkypeStatus=["AVAILABLE","BUSY","AWAY","NOT_AVAILABLE"]}
//Status menu
function A(b){"on"==b&&(a.view=!0),"off"==b&&(a.view=!1)}
//browser exit function
// $scope.onExit = function() {
//   if ($state.current.controller == "skypeCtrl") {
//     if (currentUserStatus != "NOT_AVAILABLE") {
//       updateSkypeStatus("NOT_AVAILABLE");
//     }
//     if ($scope.skype.callStatus == "ON_GOING" || $scope.skype.callStatus == "NOT_YET_STARTED") {
//       updateCallStatus("CANCELLED");
//     }
//     $interval.cancel(convById);
//     $interval.cancel(userInfo);
//   }
// };
// $window.onbeforeunload = $scope.onExit;
//flag==true?null:$scope.onExit;
//  $window.onbeforeunload = (flag!=true?null:$scope.onExit);
//For Role Based UI 
function B(){
//Patient
"PATIENT"==va?(a.patientControl=!0,a.doctorControl=!1,"EMERGENCY"==a.skype.convType?(a.cancelControl=!0,a.placeControl=!1,a.callDocControl=!0,a.callPatControl=!1):"APPOINTMENT"==a.skype.convType&&(a.patientControl=!0,a.doctorControl=!1,a.cancelControl=!1,a.placeControl=!1,a.coordinatorview=!0)):"DOCTOR"==va&&(a.patientControl=!1,a.doctorControl=!0,a.cancelControl=!1,a.placeControl=!1,"APPOINTMENT"==a.skype.convType&&(a.callPatControl=!0,a.coordinatorview=!0))}
//Getting Conversation details
function C(b){b?d.getConversationByConvId(b,function(b){b&&("CANCELLED"!=a.skype.callStatus&&"COMPLETED"!=a.skype.callStatus||"DOCTOR"==va&&W(),"PATIENT"==va&&"CANCELLED"==b.status?(a.skype.callStatus="YOU_CANCELLED_THE_REQUEST",
// ramya 
P("NOT_AVAILABLE")):"PATIENT"==va&&"COMPLETED"==b.status?S():a.skype.callStatus=b.status,a.skype.clinic=b.organizationLocation.detailedName,a.skype.clinicId=b.organizationLocation.id,qa=b.organizationLocation.id,a.skype.createdDate=b.createdDate,wa.organizationId=a.skype.clinicId,wa.logoFileName=b.organizationLocation.logoFilePath,wa.logoDocumentId=b.organizationLocation.logoDocumentId,wa.userType="ORGANIZATION",a.skype.clinicId&&0==wa.inc&&F(wa))},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))}):"DOCTOR"==va&&(W(),_())}
//Getting Conversation Users
function D(c){c&&d.getUsersInfoByConvId(c,function(d){ua++;for(var e=0;e<3;e++)d[e]&&("PATIENT"==d[e].userType&&(d[e].user?(a.skype.patientId=d[e].user.id,a.skype.patientName=d[e].user.displayName,a.patientConvUserId=d[e].id,la=a.skype.patientId,ma=a.skype.patientName,ta.userId=la,ta.logoFileName=d[e].user.logoFileName,ta.logoDocumentId=d[e].user.logoDocumentId,ta.userType="PATIENT",1==d[e].isUserReady?a.patientCallButton=!0:a.patientCallButton=!1,a.skype.patientName==j.userName&&(va="PATIENT")):d[e].userName&&(a.skype.patientName=d[e].userName,a.skype.patientId=0,la=0,ma=a.skype.patientName,a.skype.patientName==j.userName&&(va="PATIENT")),d[e].skypeId&&(a.skype.patientSkypeUserName=d[e].skypeId.code,a.skype.patientSkypeId=d[e].skypeId.id,console.log("client:"+a.skype.patientSkypeUserName),b.skype.patientSkypeUserName=a.skype.patientSkypeUserName)),"DOCTOR"==d[e].userType&&(a.skype.doctorName=d[e].user.displayName,a.skype.doctorId=d[e].user.id,a.doctorConvUserId=d[e].id,na=a.skype.doctorId,oa=a.skype.doctorName,sa.userId=na,sa.logoFileName=d[e].user.logoFileName,sa.logoDocumentId=d[e].user.logoDocumentId,sa.userType="DOCTOR",1==d[e].isUserReady?a.patientCallButton=!0:a.patientCallButton=!1,a.skype.doctorName==j.userName&&(va="DOCTOR"),d[e].skypeId&&(a.skype.doctorSkypeUserName=d[e].skypeId.code,a.skype.doctorSkypeId=d[e].skypeId.id,console.log("Doctor:"+a.skype.doctorSkypeUserName),b.skype.doctorSkypeUserName=a.skype.doctorSkypeId)),"CO_ORDINATOR"==d[e].userType&&(a.skype.CoordinatorName=d[e].user.displayName,a.skype.CoordinatorId=d[e].user.id,pa=a.skype.CoordinatorId,a.skype.CoordinatorMob=d[e].user.cell1,xa.userId=pa,xa.logoFileName=d[e].user.logoFileName,xa.logoDocumentId=d[e].user.logoDocumentId,xa.userType="CO_ORDINATOR",a.skype.CoordinatorName==j.userName&&(va="CO_ORDINATOR"),d[e].skypeId&&(a.skype.CoordinatorSkypeUserName=d[e].skypeId.code,a.skype.CoordinatorSkypeId=d[e].skypeId.id)));a.skype.convId=c,"DOCTOR"==va?(I(a.skype.doctorId),
//getnextConversation();
X(),(a.skype.patientId||0==a.skype.patientId)&&N(a.skype)):(H(a.skype),a.skype.doctorId&&N(a.skype)),1==ua&&(P("AVAILABLE"),B()),a.skype.doctorId&&0==sa.inc&&F(sa),a.skype.patientId&&0==ta.inc&&F(ta),a.skype.CoordinatorId&&0==xa.inc&&F(xa)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//360 signIn
function E(){if(a.isCordova="undefined"!=typeof cordova,0==a.isCordova){var b=localStorage.getItem("loggedInUser"),c=localStorage.getItem("paripal_token");localStorage.setItem("loggedUser",b),localStorage.setItem("pToken",c),ra=!0,i.get("skype_access_token")&&void 0!=i.get("skype_access_token")?(
//       if(!localStorage.getItem('initializationFlag')){
ca({client_id:"a49181fe-2796-478f-b0c1-e98de9d480ae",origins:["https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root"],cors:!0,version:"SkypeOnlinePreviewAppParipal/1.0.0",redirect_uri:n.skypeRedirectUrl+"token.html"}),
//   }
//          else{
//          	signin({
// 	"client_id": "a49181fe-2796-478f-b0c1-e98de9d480ae",
// 	"origins": ["https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root"],
// 	"cors": true,
// 	"version": 'SkypeOnlinePreviewAppParipal/1.0.0',
// 	"redirect_uri": baseConfig.skypeRedirectUrl + 'token.html'
// });
//          }
ia=f(function(){C(a.skype.convId)},2e3),ja=f(function(){D(a.skype.convId)},2e3)):location.assign("https://login.microsoftonline.com/common/oauth2/authorize?response_type=token&client_id=a49181fe-2796-478f-b0c1-e98de9d480ae&redirect_uri="+n.skypeRedirectUrl+"&resource=https://webdir.online.lync.com")}else{ra=!0;var d="https://login.microsoftonline.com/common/oauth2/authorize?response_type=token&client_id=a49181fe-2796-478f-b0c1-e98de9d480ae&redirect_uri="+n.skypeRedirectUrl+"&resource=https://webdir.online.lync.com";if(console.log(d),"undefined"!=typeof cordova)var e=window.cordova.InAppBrowser.open(d,"_self","hidden=no,location=no,clearsessioncache=yes,clearcache=yes,zoom=yes");var g;e.addEventListener("loadstop",function(a){/*browserRef.executeScript({
			                        code: "localStorage.setItem('isInApp', true),var userLanguage=JSON.parse(localStorage.getItem('userLanguage')), localStorage.setItem('userLanguage', userLanguage)"
			                    });*/
var b;b=setInterval(function(){if(
//console.log(event.url);
localStorage.getItem("accessToken_url")&&clearInterval(b),a.url.indexOf("#/access_token")>-1){g=a.url;var c=a.url.split("#/access_token=");console.log("token:"+g),console.log(c[1]),i.put("skype_access_token",c[1]),localStorage.setItem("accessToken_url",c[1]),e.close(),clearInterval(b)}},250)}),console.log(localStorage.getItem("accessToken_url")),e.addEventListener("exit",function(a){var b=g.split("/");console.log(b),skype=JSON.parse(localStorage.skype),console.log(skype),l.go("skypeHome",{userId:skype.userId,convId:skype.convId,convType:skype.convType,userName:skype.userName}),ca({client_id:"a49181fe-2796-478f-b0c1-e98de9d480ae",origins:["https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root"],cors:!0,version:"SkypeOnlinePreviewAppParipal/1.0.0",redirect_uri:n.skypeRedirectUrl+"token.html"}),console.log("SUCCESS_STATE")}),ia=f(function(){C(a.skype.convId)},2e3),ja=f(function(){D(a.skype.convId)},2e3)}}
//get Image
function F(b){var c=new Object;c.fileName=b.logoFileName,c.resourceId=b.logoDocumentId,"ORGANIZATION"==b.userType?(c.organizationId=b.organizationId,c.docType=m.documentTypes.orgLogo,c.docSubType=m.documentSubTypes.orgLogo):(c.userId=b.userId,c.docType=m.documentTypes.userIdDocument,c.docSubType=m.documentSubTypes.profilePhoto),d.getImageUrl(c,function(c){"PATIENT"==b.userType?(a.patientImage=c,ta.inc++):"DOCTOR"==b.userType?(a.doctorImage=c,sa.inc++):"CO_ORDINATOR"==b.userType?(a.coordinatorImage=c,xa.inc++):(b.userType="ORGANIZATION")&&(a.hospiitalImage=c,wa.inc++)})}
// function issueSkypeId(skypeObj){
// 	var reqObj={};
// 	if(skypeObj.userId){
// 		reqObj.userId=skypeObj.userId;
// 	}else{
// 		reqObj.userId=0;
// 	}
// 	if(skypeObj.convId){
// 		reqObj.convId=skypeObj.convId;
// 	}
// 	if(skypeObj.userName){
// 		reqObj.userName=skypeObj.userName;
// 	}
// 	// skypeService.issueSkypeId(reqObj,function(successResponse){
// 	// 	if(successResponse){
// 	// 	localStorage.setItem('skypeIssuedStatus',true);
// 	// 	localStorage.setItem('skypeIssuedId',successResponse.response.id);
// 	// 	$rootScope.skypeName=successResponse.response.skypeId;
// 	// 	$rootScope.skypePassword=successResponse.response.skypePassword;
// 		popup();
// 		$timeout(function(){
// 			$mdDialog.cancel();
// 			officeSignIn();
// 		},5000)
// 	// 	}
// 	// },function(errorResponse){
// 	// 	if(!utilService.isNullOrEmpty(errorResponse.data.message[0])){
// 	// 		notify("alert", $translate.instant(errorResponse.data.message[0]));
// 	// 	}
// 	//   })
// }
//Issuing skypeId
function G(a){localStorage.getItem("msnFlag")||(localStorage.setItem("msnFlag",!0),
// $cookies.put('msnFlag',true);
ha(),k(function(){c.cancel(),E()},5e3))}
//Getting  Queue Status
function H(b){var c={};b.createdDate&&(c.createdDate=b.createdDate),c.location=b.clinicId,b.doctorId&&(c.userId=b.doctorId),b.convId&&(c.convId=b.convId),b.callStatus,d.getQueueStatus(c,function(b){a.skype.queue=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Getting  Doctor Queue Status
function I(b){d.getDoctorQueueStatus(b,function(b){a.skype.Doctorqueue=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Place Request
function J(){var b={};b.createdDate=new Date,b.type="EMERGENCY",b.location=a.skype.clinicId,b.status="NOT_YET_STARTED",d.placeRequest(b,function(b){if(a.skype.convId=b.response,b){var c={};c.convId=a.skype.convId,c.userType="PATIENT",c.userName=j.userName,j.userId&&(c.userId=j.userId),K(c),a.cancelControl=!0,a.placeControl=!1}},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Add Conversation User
function K(b){var c={};c.convId=b.convId,c.userType=b.userType,c.userId=b.userId,c.userName=b.userName,d.addConvUser(c,function(b){ia=f(function(){C(a.skype.convId)},2e3),ja=f(function(){D(a.skype.convId)},2e3)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//cancel Request
function L(){a.cancelControl=!1,a.placeControl=!0,M("CANCELLED"),aa(),
//$interval.cancel(convById);
f.cancel(ja),ua=0}
//updateCallStatus 
function M(b){var c={};c.convId=a.skype.convId,c.status=b,d.updateCallStatus(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Get Skype Status
function N(b){var c={};"DOCTOR"==va?(c.userId=b.patientId,c.userName=b.patientName):"PATIENT"==va&&(c.userId=b.doctorId,c.userName=b.doctorName),c.convId=b.convId,d.getSkypeStatus(c,function(b){"PATIENT"==va?"AVAILABLE"==b.response?(a.skype.doctorSkypeStatus="Doctor in and Available",a.isDoctorLoggedIn=1):"BUSY"==b.response?a.skype.doctorSkypeStatus="Doctor in but in conversation":"NOT_AVAILABLE"==b.response?(a.skype.doctorSkypeStatus="Doctor not yet in",1==a.isDoctorLoggedIn&&S()):a.skype.doctorSkypeStatus="Away":"DOCTOR"==va&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?a.skype.patientSkypeStatus="In conversation With Doctor":"NOT_AVAILABLE"==b.response?a.skype.patientSkypeStatus="Not checked in":a.skype.patientSkypeStatus="Away")},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Getting Coordinator Status
function O(b){var c={};c.userId=c.userId,d.getSkypeStatus(c,function(b){a.skype.coordinatorSkypeStatus=b.response},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Updating Skype Status
function P(b){a.view=!1;var c={};c.status=b,"DOCTOR"==va?(c.userId=na,c.userName=oa):"PATIENT"==va&&(c.userId=la,c.userName=ma),c.convId=a.skype.convId,d.updateSkypeStatus(c,function(b){b&&("DOCTOR"==va?"AVAILABLE"==b.response?a.skype.doctorSkypeStatus="Doctor in and Available":"BUSY"==b.response?a.skype.doctorSkypeStatus="Doctor in but in conversation":"NOT_AVAILABLE"==b.response?(a.skype.doctorSkypeStatus="Doctor not yet in",S(),V(c.userId)):a.skype.doctorSkypeStatus="Away":"PATIENT"==va&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?a.skype.patientSkypeStatus="In conversation With Doctor":"NOT_AVAILABLE"==b.response?(a.skype.patientSkypeStatus="Not checked in",S()):a.skype.patientSkypeStatus="Away"),ka=b.response)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}function Q(){c.show({templateUrl:"app/modules/skype-integration/views/confirmationDialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.cancel=function(){c.cancel()},a.confirmCancelRequest=function(){R()}}]})}function R(){var b={};b.id=a.skype.convId,b.status="CANCELLED",d.cancelCallRequest(b,function(a){if(a){
//updateSkypeStatus("NOT_AVAILABLE");
_();var b={};b.id=la,b.value=ma,fa(b)}},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//360 Logout
function S(){if(localStorage.removeItem("appmentData"),localStorage.removeItem("uploadFrmSkype"),localStorage.removeItem("SkypePatientDet"),localStorage.removeItem("skypeIssuedStatus"),localStorage.removeItem("accessToken_url"),localStorage.removeItem("skypeIssuedId"),localStorage.setItem("skypeLoggedOut",!0),
//$cookies.remove("loggedUser");
ga(),i.remove("skype_access_token"),
// location.assign('https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri=' + baseConfig.skypeRedirectUrl);
console.log("signOutUrl set"),"undefined"!=typeof cordova){var b="https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+n.skypeRedirectUrl,c=window.cordova.InAppBrowser.open(b,"_self","hidden=no,location=no,clearsessioncache=yes,clearcache=yes,zoom=yes");console.log("In-app Browser Executed")}else location.assign("https://login.windows.net/common/oauth2/logout?post_logout_redirect_uri="+n.skypeRedirectUrl);"PATIENT"==va?(T(a.skype.patientSkypeId),U(a.skype.convId)):"DOCTOR"==va&&T(a.skype.doctorSkypeId),"undefined"!=typeof cordova&&(c.close(),p.history.back(),console.log("In-app Browser Closed")),f.cancel(ia),f.cancel(ja)}
//Releasing SkypeId
function T(b){var c={};c.skypeId=b,c.status="AVAILABLE",c.convId=a.skype.convId,d.realeaseSkypeId(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Update conversationLog
function U(b){var c={};c.convId=a.skype.convId,c.status="CANCELLED",d.updateConversationLog(c,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//removing Doctor from conversation user
function V(a){d.removeDoctor(a,function(a){},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Get Next Conversation 
function W(){var b={};b.userId=na,
//convObj.callType="EMERGENCY";
b.callType=a.skype.convType,b.status="NOT_YET_STARTED",b.skypeIssuedId=localStorage.getItem("skypeIssuedId"),d.getnextConversation(b,function(b){0!==b.data&&(a.skype.convId=b.data),a.patientsQueueList=b.data,a.skype.convId},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))})}
// Patient Queue List 
function X(){var b={};b.userId=na,b.callType=a.skype.convType,b.status="NOT_YET_STARTED",b.skypeIssuedId=localStorage.getItem("skypeIssuedId"),d.getPatientQueueList(b,function(b){a.patientsQueueList=b.data},function(a){e.isNullOrEmpty(errorResponse.data.message[0])||g("alert",h.instant(errorResponse.data.message[0]))})}
//Mute Control
function Y(b){1==b?(a.mute=!1,a.unMute=!0):2==b&&(a.mute=!0,a.unMute=!1)}
//Other Actions Test
function Z(){var a=q.absUrl().split("#")[0];p.open(a+"#/usertestlist/"+ma+"/"+la)}
// 	upload download based on emergency and appointment
// 	function gotoEmergencyOrAppointment(){
// 	if($stateParams.convType =='APPOINTMENT'){
// 		var url = $location.absUrl().split('#')[0];
//         $window.open(url + '#/appointmentsuploadlist/' + patientName+'/'+ patientId+'/'+doctorName);
// 	}else if($stateParams.convType =='EMERGENCY'){
// 		var url = $location.absUrl().split('#')[0];
//         $window.open(url + '#/emergencyuploadlist/' + patientName+'/'+ patientId+'/'+doctorName);
// 	}
// }
//Clear Patient Credentials
function _(){a.skype.patientId="",a.skype.patientName="",a.skype.patientSkypeStatus="NOT_AVAILABLE",a.patientImage="app/images/user.jpg",ta.inc=0}
//Clear Doctor Credentials
function aa(){a.skype.doctorName="",a.skype.doctorId="",a.skype.doctorSkypeStatus="",a.doctorImage="app/images/user.jpg",sa.inc=0}
//getting reqId by convId
function ba(){var b={};b.convId=j.convId,d.uploadViewDocument(b,function(b){return b.data?(a.creq=b.data,a.creq.requestId=a.creq.createRequest.id,a.init(),void 0):null})}
//skype Azure Sign In and Skype sign Start
function ca(d){localStorage.setItem("initializeCount",localStorage.getItem("initializeCount")+1),console.log("count",localStorage.getItem("initializeCount")),
// if(!localStorage.getItem('initializationFlag') && localStorage.getItem('initializeCount')=='111111'){
localStorage.setItem("initializationFlag",!0),console.log("Initializing started"),Skype.initialize({apiKey:"9c967f6b-a846-4df2-b43d-5167e47d81e1"},function(e){
// //$rootScope.count++;
// //console.log($rootScope.count);
// if(($scope.conusrObj && !$scope.conusrObj.isUserReady) && localStorage.getItem('initializeCount')=='111111'){
// 	//updateConvId
// 	debugger;
// 	//$scope.conusrObj = {};
// 	$scope.conusrObj.isUserReady = true;
// 	$scope.conusrObj.conversationLog = {
// 		id:$scope.skype.convId
// 	};
// 	$scope.conusrObj.user = {
// 		id:$scope.skype.userId
// 	}
// 	if(userType=="DOCTOR"){
// 		$scope.conusrObj.userType = "DOCTOR";
// 		$scope.conusrObj.id = $scope.doctorConvUserId;
// 	}else{
// 		$scope.conusrObj.userType = "PATIENT";
// 		$scope.conusrObj.id = $scope.patientConvUserId;
// 	}
// 	skypeService.updateConvUserIsReady($scope.conusrObj,function(successResponse){
// 	if(successResponse){
// 		$scope.convUserFlag=true;
// 	}
// 	},function(error){
// 		if(!utilService.isNullOrEmpty(errorResponse.data.message[0])){
// 			notify("alert", $translate.instant(errorResponse.data.message[0]));
// 		}
// 	});
// }
c.show({templateUrl:"app/modules/skype-integration/views/initializationAlert.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope","$timeout","$mdDialog",function(a,c,d){b.popupCount++,c(function(){d.cancel()},6e4),a.cancel=function(){d.cancel()}}]}),console.log("Initialization successfull"),a.skypeWebApp=e.UIApplicationInstance,console.log("Skype instance are set"),console.log("skypeweb check + :$scope.skypeWebApp"),a.skypeApi=e,console.log("skypeAPI + :$scope.skypeApi"),a.skypeWebAppCtor=e.application,console.log("skypeWebAppCtor +:$scope.skypeWebAppCtor"),
//$rootScope.showSpinner = true;
//$rootScope.count++;
da(d),ea()},function(a){console.log(a),console.log("Inside error blo")})}
//ramya 14.11.2018 this is used for update user is readyness in conversation user post intialization
// function isUserReady(){
//                   if(!localStorage.getItem('isUserReady')){
// 			//updateConvId
// 			localStorage.setItem('isUserReady',true);
// 			//$scope.conusrObj = {};
// 			$scope.conusrObj.isUserReady = true;
// 			$scope.conusrObj.conversationLog = {
// 				id:$scope.skype.convId
// 			};
// 			$scope.conusrObj.user = {
// 				id:$scope.skype.userId
// 			}
// 			if(userType=="DOCTOR"){
// 				$scope.conusrObj.userType = "DOCTOR";
// 				$scope.conusrObj.id = $scope.doctorConvUserId;
// 			}else{
// 				$scope.conusrObj.userType = "PATIENT";
// 				$scope.conusrObj.id = $scope.patientConvUserId;
// 			}
// 			skypeService.updateConvUserIsReady($scope.conusrObj,function(successResponse){
// 			if(successResponse){
// 				$scope.convUserFlag=true;
// 			}
// 			},function(error){
// 				if(!utilService.isNullOrEmpty(errorResponse.data.message[0])){
// 					notify("alert", $translate.instant(errorResponse.data.message[0]));
// 				}
// 			});
// 		}
// }
//ramya 14.11.2018 this is used for update user is readyness in conversation user post intialization
//Sign in
function da(c){b.redirect++,2==b.redirect&&b.loggedInUserDetails.isOrganizationUserMode&&(b.showSpinner=!1),0!=b.redirect&&1!=b.redirect||a.skypeWebApp.signInManager.signIn(c).then(function(){console.log("Signed in as "+a.skypeWebApp.personsAndGroupsManager.mePerson.displayName()),a.skypeWebApp.personsAndGroupsManager.mePerson.id()||console.log("got mePerson Object")},function(a){})}
//Skype Action Listener for all Services start
function ea(){console.log("<------entered into video listener----->");var b=a.skypeWebApp.conversationsManager.conversations.added(function(b){function c(){console.log("entered into ---> onAudioVideoNotified ---- called video");var c=b.participants(0).person.displayName();"Notified"==h.video.state()?confirm("Accept a video call from "+c+"?")?(g=f.accept(),M("ON_GOING"),P("BUSY"),a.videoView=!0,a.defaultView=!1,a.audioView=!1,a.chatView=!1,"APPOINTMENT"==j.convType&&(a.hideCallButton=!0)):(console.log("declining the incoming video request"),f.reject(),a.defaultView=!0):"Notified"==h.audio.state()&&(console.log("entered into ---> onAudioVideoNotified ---- called audio"),confirm("Accept an audio call from "+c+"?")?(e=d.accept(),M("ON_GOING"),P("BUSY"),a.videoView=!1,a.defaultView=!1,a.audioView=!0,a.chatView=!1,"APPOINTMENT"==j.convType&&(a.hideCallButton=!0),k(function(){a.$apply()},250)):(console.log("declining the incoming audio request"),d.reject())),i=null}var d,e,f,g,h,i;h=b.selfParticipant,a.connectedUri=b.selfParticipant.uri(),a.chatService=b.chatService,console.log(a.chatService),d=b.audioService,f=b.videoService,a.conversation=b,
//Chat Listener Start         
a.chatService.accept.enabled.when(!0,function(){var c=confirm("Accept this IM invitation?");c?(a.sendedText=[],a.chatService.accept(),a.chatView=!0,a.audioView=!1,a.videoView=!1,a.defaultView=!1,M("ON_GOING"),P("BUSY")):(a.chatService.reject(),console.log("Invitation Rejected")),b.historyService.activityItems.added(function(b){var c={},d=b.sender.id._value.replace("sip:","");a.skype.patientSkypeUserName==d?c.name=a.skype.patientName:a.skype.doctorSkypeUserName==d?c.name=a.skype.doctorName:a.skype.CoOrdinatorSkypeUserName==d&&(c.name=a.skype.CoOrdinatorName),c.text=b.text._value,a.sendedText.push(c),k(function(){a.$apply()},250)})}),
//Audio & Video Listener End
b.participants.added(function(c){1==b.participants.size()&&(a.connectedUri=c.person.id(),$(".c-name").text(c.person.displayName()),c.person.location.changed(function(a){$(".location").text(a)}),c.person.location.subscribe()),c.video.state.changed(function(a,d,e){if("Connected"==a)if(1==b.participants.size())c.video.channels(0).stream.source.sink.container(document.getElementById("render-p-window"));else{var f=b.participants(0);f.video.channels(0).stream.source.sink.container(document.getElementById("render-p-window")),f.video.channels(0).isStarted.set(!0),c.vidhistoryServiceeo.channels(0).stream.source.sink.container($(".add-video-container")[0]),c.video.channels(0).isStarted.set(!0)}})}),h.audio.state.changed(function(b,d,e){"Notified"!=b||i?"Connected"==b||("Disconnected"==b?("DOCTOR"==va?(
//updateSkypeStatus("AVAILABLE");
a.defaultView=!0,a.videoView=!1,a.audioView=!1,a.chatView=!1,"EMERGENCY"==a.skype.convType&&(a.hideCallButton=!0),P("AVAILABLE"),"message"==ya&&"NOT_YET_STARTED"==a.skype.callStatus?a.defaultView=!1:"message"==ya&&"NOT_YET_STARTED"!=a.skype.callStatus&&(a.chatView=!1)):"ON_GOING"!=a.skype.callStatus&&"COMPLETED"!=a.skype.callStatus||(
//updateSkypeStatus("NOT_AVAILABLE");
a.defaultView=!0,a.videoView=!1,a.audioView=!1,a.chatView=!1,a.hideCallButton=!0),k(function(){a.$apply()},250)):"Connecting"==b&&("audio"==ya?(a.audioView=!0,a.defaultView=!1):"video"==ya?(a.defaultView=!1,a.videoView=!0):"message"==ya&&(a.defaultView=!1,a.videoView=!0))):i=setTimeout(c,0)}),h.chat.state.changed(function(b,c,d){"Disconnected"==b&&("DOCTOR"==va?(
//updateSkypeStatus("AVAILABLE");
a.defaultView=!0,a.videoView=!1,a.audioView=!1,a.chatView=!1,"EMERGENCY"==a.skype.convType&&(a.hideCallButton=!0),P("AVAILABLE"),"message"==ya&&"NOT_YET_STARTED"==a.skype.callStatus?a.defaultView=!1:"message"==ya&&"NOT_YET_STARTED"!=a.skype.callStatus&&(a.chatView=!1)):"ON_GOING"!=a.skype.callStatus&&"COMPLETED"!=a.skype.callStatus||(
//updateSkypeStatus("NOT_AVAILABLE");
a.defaultView=!0,a.videoView=!1,a.audioView=!1,a.chatView=!1,a.hideCallButton=!0),k(function(){a.$apply()},250)),a.sendedText=[],k(function(){a.$apply()},250)}),h.video.state.changed(function(a,d,e){var f;"Notified"!=a||i?"Connected"==a&&(f=b.selfParticipant.video.channels(0),f.stream.source.sink.container.set(document.getElementById("render-self-window"))):i=setTimeout(c,0)})});a.registeredListeners.push(b)}function fa(b){a.view=!1;var c={};c.status="NOT_AVAILABLE",c.userId=b.id,c.userName=b.value,c.convId=a.skype.convId,d.updateSkypeStatus(c,function(b){b&&("AVAILABLE"==b.response?a.skype.patientSkypeStatus="Available":"BUSY"==b.response?a.skype.patientSkypeStatus="Available":"NOT_AVAILABLE"==b.response?a.skype.patientSkypeStatus="Not checked in":a.skype.patientSkypeStatus="Away",ka=b.response)},function(a){e.isNullOrEmpty(a.data.message[0])||g("alert",h.instant(a.data.message[0]))})}
//Signout
function ga(){var b=a.skypeWebApp;b.signInManager.signOut().then(function(){console.log("Signed out")},function(a){console.log(a||"Cannot sign out")})}/*popup start*/
function ha(){c.show({templateUrl:"app/modules/skype-integration/views/skypeUserNamePopup.html",parent:angular.element(document.body),clickOutsideToClose:!0,controller:["$scope",function(a){a.name=localStorage.getItem("skypeId"),a.password=localStorage.getItem("skypePassword"),a.cancel=function(){c.cancel()}}]})}
//fileOperations
// $rootScope.$on('$stateChangeStart', 
// function(event, toState, toParams, fromState, fromParams){ 
//     // do something
//     $scope.preState = fromState;
// })
// $rootScope.$on('$stateChangeSuccess', 
// function(event, toState, toParams, fromState, fromParams){ 
//     // do something
//     $scope.preState = fromState;
// })
a.placeRequest=J,a.updateCallStatus=M,a.muteControl=Y,a.getUsersInfoByConvId=D,a.userPopup=G,a.getQueueStatus=H,a.getDoctorQueueStatus=I,a.uiControl=B,a.getSkypeStatus=N,a.coordinatorStatus=O,a.updateSkypeStatus=P,a.cancelRequest=L,a.SkypeStatus=["AVAILABLE","BUSY","AWAY","NOT_AVAILABLE"],a.releaseSkypeId=T,a.updateConversationLog=U,a.signOut=ga,a.getnextConversation=W,a.setOptions=z,a.statusOpen=A,a.gotoTest=Z,a.getLogo=F,a.clearDoctor=aa,a.clearPatient=_,a.removecache=S,a.officeSignIn=E,a.commonConstants=m,a.popup=ha,a.creq={},a.convInfo={},a.skype={},b.skype={},a.patientsInQueue={},a.name="",a.callFileUpload=w,a.goToAppointmentNotes=x,a.goToPatientRecord=y,a.getPatientQueueList=X,a.cancelCallRequest=Q,
// $scope.updateNewSkypeStatus = updateNewSkypeStatus;
a.updatePatientStatus=fa,
//$scope.isUserReady=isUserReady;
a.showPhoneButton=!0,a.hideCallButton=!1,a.patientCallButton=!1;var ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa={},ta={},ua=0,va="",ta={},sa={},wa={},xa={};ta.inc=0,sa.inc=0,wa.inc=0,xa.inc=0,
//Getting Conversation Params
a.skype.convId=j.convId,a.skype.userId=j.userId,a.skype.convType=j.convType,a.skype.userName=j.userName,a.unMute=!0,localStorage.setItem("skype",JSON.stringify(a.skype)),
//Skype integration variables
a.defaultView=!0,a.registeredListeners=[],a.sendedText=[],a.status="AVAILABLE",a.isDoctorLoggedIn=0;var ya;
//to attach document
if(b.count=0,
//             $scope.conusrObj = {};
// $scope.conusrObj.isUserReady = false;
b.popupCount=0,b.redirect=0,
//$rootScope.officeCount=0;
// default logo 
a.doctorImage="app/images/user.jpg",a.patientImage="app/images/user.jpg",a.coordinatorImage="app/images/user.jpg",a.hospitalImage="app/images/billing/hospital.png",
//make prescription 
a.makePrescription1=r.makePrescription,a.makePrescription=function(b,c,d,e){var f={};f.params={convId:a.skype.convId,userId:a.skype.userId,convType:a.skype.convType,userName:a.skype.userName},a.makePrescription1(b,c,d,e,f)},
//Call Not allowed
a.wrongCall=function(){g("alert","Not Alllowed To call")},
//issueSkypeId($stateParams);
localStorage.skypeIssuedStatus&&!localStorage.getItem("msnFlag")?G(j):(console.log("entered into office function call"),b.loggedInUserDetails.isOrganizationUserMode&&(b.showSpinner=!0),E()),localStorage.appmentData&&(a.appointmentupload=angular.fromJson(localStorage.getItem("appmentData"))),a.redirectToPrescription=function(){var c=a.appointmentupload.id,d=b.loggedInUserDetails.id,e=b.loggedInUserDetails.displayName,f=a.appointmentupload.organizationLocationId,g=a.appointmentupload.locationName,h=q.absUrl().split("#")[0];window.open(h+"#/searchPrescriptionList/"+c+"/"+d+"/"+e+"/"+f+"/"+g)},
// update map disease 
a.updateMapDisease=function(){c.show({controller:"TreatmentRecordDetailsPopCtrl",templateUrl:"app/modules/appointment/views/treatment-record-details-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{recordDetails:a.appointmentupload,isCurrentDate:!0,baseService:u}}).then(function(b){a.WSHealthProfessionalsValues={}},function(){a.WSHealthProfessionalsValues={}})},localStorage.loggedInUser){var za=localStorage.loggedInUser;a.loggedInUserDetails=JSON.parse(za),a.loggedInUserId=a.loggedInUserDetails.id,ba()}a.buttonLogout=function(){P("NOT_AVAILABLE")},a.setcurrentConvWith=function(b){a.skype.convId=b.id,a.skype.convId},
//call end while screen change 
a.$on("$destroy",function(){"NOT_AVAILABLE"!=ka&&P("NOT_AVAILABLE"),"ON_GOING"!=a.skype.callStatus&&"NOT_YET_STARTED"!=a.skype.callStatus||M("CANCELLED"),f.cancel(ia),f.cancel(ja)}),a.init=function(){
// $scope.isCordova = (typeof (cordova) !== "undefined") ? true : false;
a.requestObject={},a.requestObject.module="requestId",a.requestObject.moduleNameAndUser="findAttachmentByRequestAndUser",a.requestObject.moduleName="deleteAttachmentsByRequestIdAndDocId",a.requestObject.forId=a.creq.requestId,a.requestObject.userId=o.userData().userId},
//Video Service Start
a.skypeVideoCall=function(b){a.videoView=!0,a.defaultView=!1,a.audioView=!1,a.chatView=!1,a.showPhoneButton=!0,a.hideCallButton=!1,ya="video";var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.text(b),d.limit(1),d.getMore().then(function(){var a=d.results();if(0==a.length)throw new Error("The contact not found");return a[0].result}).then(function(b){a.VideoUsername=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.videoService=d.videoService,a.videoService.start().then(function(){P("BUSY")})}).then(null,function(a){console.log("audio video service---> "+a),console.log("Something went wrong")})},
//Audio Service Start
a.skypeAudioCall=function(b){a.videoView=!1,a.audioView=!0,a.defaultView=!1,a.chatView=!1,a.showPhoneButton=!0,a.hideCallButton=!1,ya="audio";var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.text(b),d.limit(10),d.getMore().then(function(){var a=d.results();if(0==a.length)throw new Error("The contact not found");return a[0].result}).then(function(b){a.audioUsername=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.audioService=d.audioService;d.audioService.start().then(function(){P("BUSY")})}).then(null,function(a){console.log("audio call service---> "+a),console.log("Something went wrong")})},
//Chat Service Start    
a.skypeChat=function(b){a.videoView=!1,a.audioView=!1,a.defaultView=!1,a.chatView=!0,a.showPhoneButton=!0,a.hideCallButton=!1,ya="message",a.username=b;var c=a.skypeWebApp,d=c.personsAndGroupsManager.createPersonSearchQuery();d.limit(1),d.text(b),d.getMore().then(function(){var a=d.results();if(a.lenupdateCallStatusgth<1)throw new Error("Contact not found");return a[0].result}).then(function(b){a.skypeWebUser=b.displayName();var d=c.conversationsManager.getConversation(b);a.conversation=d,a.chatService=d.chatService,a.sendedText=[],a.conversation.historyService.activityItems.added(function(b){var c={},d=b.sender.id._value.replace("sip:","");a.skype.patientSkypeUserName==d?c.name=a.skype.patientName:a.skype.doctorSkypeUserName==d?c.name=a.skype.doctorName:a.skype.CoOrdinatorSkypeUserName==d&&(c.name=a.skype.CoOrdinatorName),c.text=b.text._value,a.sendedText.push(c),k(function(){a.$apply()},250)}),a.chatService.start().then(function(a){P("BUSY")})}).then(null,function(a){console.error(a),addNotification("Search failed "+a)})},
//Send Message
a.sendmessage=function(){var b=a.enteredText;b&&a.chatService.sendMessage(b)["catch"](function(a){console.log("Cannot send the message")}),a.enteredText=""},
//new implementation for end call button 
a.endConversation=function(){a.showPhoneButton=!1,a.hideCallButton=!0,a.conversation.leave().then(function(){a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,"message"==ya&&(a.sendedText=[])},function(a){}).then(function(){})},
//Conversation Service Start
a.endCall=function(){a.showPhoneButton=!0,"DOCTOR"==va&&P("AVAILABLE"),
//$scope.conversation.leave().then(function () {
M("COMPLETED"),a.videoView=!1,a.defaultView=!0,a.audioView=!1,a.chatView=!1,T(a.skype.patientSkypeId),_();var b={};b.id=la,b.value=ma,fa(b),"message"==ya&&(a.sendedText=[])}}]),angular.module("paripal.skypeIntegrationModule").service("skypeService",["httpService","urlService","dateconvertor","$window","$location",function(a,b,c,d,e){this.getUsersInfoByConvId=function(c,d,e){var f={};f.convId=c,f.convId&&a.getData(b.getParameterizedUrl("FIND_USERS_INFO_BY_CONV_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.issueSkypeId=function(c,d,e){a.getData(b.getParameterizedUrl("ISSUE_SKYPE_ID_BY_CON_ID_USER_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getQueueStatus=function(c,d,e){
// if(statusObj.createdDate )
// {
// 	statusObj.createdDate = dateconvertor.convertToServerDate(statusObj.createdDate);
// }
a.postData(b.getUrl("FIND_QUEUE_STATUS"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDoctorQueueStatus=function(c,d,e){var f={};f.userId=c,a.getData(b.getParameterizedUrl("FIND_DOCTOR_QUEUE_STATUS",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getConversationByConvId=function(c,d,e){var f={};f.id=c,f.id&&a.getData(b.getParameterizedUrl("FIND_BY_CONV_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.placeRequest=function(c,d,e){var f={};f.organizationLocation={},
// if(convObj.createdDate )
// {
// 	convObj.createdDate = dateconvertor.convertToServerDate(obj.createdDate);
// }
f.type=c.type,f.status=c.status,f.organizationLocation.id=c.location,a.postData(b.getUrl("SAVE_CONVERSATION_LOG"),f,function(a){d(a.data)},function(a){e(a)})},this.updateCallStatus=function(c,d,e){var f={};f.id=c.convId,f.status=c.status,a.getData(b.getParameterizedUrl("UPDATE_CONVERSATION_STATUS",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.addConvUser=function(c,d,e){var f={};f.user={},f.conversationLog={},f.user.id=c.userId,f.conversationLog.id=c.convId,f.userType=c.userType,f.userName=c.userName,a.postData(b.getUrl("ADD_CONVERSATION_USER"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.agoraCallLog=function(c,d,e){var f={};f.agoraCallType=c.agoraCallType,f.conversationLogId=c.convId,f.callEndTime=c.callEndTime,f.callStartTime=c.callStartTime,a.postData(b.getUrl("SAVE_CONVERSATION_CALL_LOG"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},
//final api to the bangladesh call 
this.patientContinueStatus=function(c,d,e){null!=c.url?a.getData(b.getParameterizedUrl("GET_PATIENT_CONTINUE_STATUS",c),null,function(a){a&&a.data&&a.data.data?d(a.data):e(a)},function(a){e(a)}):a.getData(b.getParameterizedUrl("GET_RANDOM_CONTINUE_STATUS",c),null,function(a){a&&a.data?(a.data["continue"]=a.data.continu,delete a.data.continu,d(a)):e(a)},function(a){e(a)})},/*//sample api to test random value 
	this.patientContinueStatus=function(obj,successCallBack,errorCallBack){
		httpService.getData(urlService.getParameterizedUrl('GET_RANDOM_CONTINUE_STATUS',obj),null, 
		function(response){
			 if (response && response.data){
                 successCallBack(response);
             }
             else{
                 errorCallBack(response);
             }
			},function(error){
				errorCallBack(error);
			  });
	}*/
this.updateAgoraCallLog=function(c,d,e){var f={};
//userObj.agoraCallType= obj.agoraCallType;
f.conversationLogId=c.convId,f.callEndTime=c.callEndTime,
//	userObj.callStartTime= obj.callStartTime;
a.postData(b.getUrl("UPDATE_CONVERSATION_CALL_LOG"),f,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getSkypeStatus=function(c,d,e){a.getData(b.getParameterizedUrl("GET_USER_SKYPE_STATUS_BY_USER_ID",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getNewSkypeStatus=function(c,d,e){a.getData(b.getParameterizedUrl("GET_NEW_SKYPE_STATUS",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.updateLastPingedTime=function(c,d,e){a.getData(b.getParameterizedUrl("UPDATE_LAST_PINGED_TIME",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getskypeOrganizationAccess=function(c,d,e){a.getData(b.getParameterizedUrl("CHECK_SKYPE_ORGANIZATION_ACCESS",c),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.updateSkypeStatus=function(c,d,e){a.getData(b.getParameterizedUrl("UPDATE_SKYPE_STATUS",c),null,function(a){d(a.data)},function(a){e(a)})},this.realeaseSkypeId=function(c,d,e){var f={};f.skypeId=c.skypeId,f.status=c.status,f.convId=c.convId,a.getData(b.getParameterizedUrl("RELEASE_SKYPE_ID",f),null,function(a){d(a)},function(a){e(a)})},this.updateConversationLog=function(c,d,e){var f={};f.status=c.status,f.convId=c.convId,a.getData(b.getParameterizedUrl("UPDATE_CONVERSATION_LOG",f),null,function(a){d(a)},function(a){e(a)})},this.removeDoctor=function(c,d,e){var f={};f.userId=c,a.deleteData(b.getParameterizedUrl("REMOVE_DOCTOR",f),null,function(a){d(a)},function(a){e(a)})},this.getnextConversation=function(c,d,e){a.postData(b.getUrl("GET_NEXT_CONVERSATION"),c,function(a){d(a)},function(){e(error)})},this.getPatientQueueList=function(c,d,e){a.postData(b.getUrl("GET_PATIENT_LIST_QUEUE"),c,function(a){d(a)},function(){e(error)})},this.updateConversationUser=function(c,d,e){a.postData(b.getUrl("UPDATE_CONVERSATION_USER"),c,function(a){d(a)},function(){e(error)})},this.updateConvUserIsReady=function(c,d,e){a.postData(b.getUrl("UPDATE_CONV_USER_ISREADY"),c,function(a){d(a)},function(){e(error)})},this.cancelCallRequest=function(c,d,e){a.getData(b.getParameterizedUrl("UPDATE_SKYPE_CANCELLED_STATUS",c),null,function(a){d(a)},function(){e(error)})},this.getAgoraAppId=function(c,d,e){a.getData(b.getParameterizedUrl("GET_AGORA_APPID_FOR_DOCTOR",c),null,function(a){d(a)},function(){e(error)})},this.getImageUrl=function(c,d,e){var f=b.getUrl("DOWNLOAD_FILE"),g="";a.downloadFileData(f,c,function(a){if(a&&a.data){var b=new Uint8Array(a.data),c=new Blob([b],{type:""});window.URL.createObjectURL(c)&&(g=window.URL.createObjectURL(c)),d(g)}else d(g)},function(a){d(g)})},this.uploadViewDocument=function(c,d,e){var f={};f.convId=c.convId,a.getData(b.getParameterizedUrl("GET_REQUEST_FULFILLMENT_CONV_ID",f),null,function(a){a?d(a):errorCallBack(error)}),function(a){utilService.isNullOrEmpty(errorResponse.data.message[0])||notify("alert",$translate.instant(errorResponse.data.message[0]))}},this.goToUploadDownload=function(c,d,e){var f={};f.appointmentId=c.id,a.getData(b.getParameterizedUrl("GET_USER_DETAILS_BY_APPT_ID",f),null,function(a){
//successResponse.data.appointmentId = record.id;
//successResponse.type = "edit";
a&&d(a)},function(a){errorCallBack(a)})}}]),function(){"use strict";angular.module("paripal.manageStandardMaster").controller("ManageStandardMasterCtrl",["$scope","$location","$filter","httpService","service","$stateParams","$state","dateconvertor","urlService","notify","utilService",function(a,b,c,d,e,f,g,h,i,j,k){a.newStandardMasterObj={},a.requestData={},a.list=[],a.pageState="",a.getStandardMasterListData=function(b){a.standardMasterListData={};for(var c=0;c<b.length;c++)if("Enum"===b[c].type){var e={};e.enumType=b[c].enumType,d.getData(i.getParameterizedUrl("GET_STANDARD_MASTER_ENUMS",e),null,function(b){var c=b.data.code;a.standardMasterListData[c]=angular.fromJson(b.data.data)},function(){})}},a.getDropdownList=function(a,b){var c={};return c.parentTableId=b.fkTable,c.fkColumnName=b.fkDisplayField,c.fkIdName=b.fkFieldName,c.code=b.fieldLabel.code,c.searchString=a||"",d.getData(i.getParameterizedUrl("GET_STANDARDMASTERDATALIST",c),null,function(a){return angular.fromJson(a.data.data)},function(){})},"add"===f.type&&(a.pageState="add",a.data=f.data.metaData,a.creatingOrgLocId_=f.data.creatingOrgLocId_,a.getStandardMasterListData(a.data)),"edit"===f.type&&(a.pageState="edit",a.newStandardMasterObj=f.data.gridData,a.data=f.data.metaData,a.getStandardMasterListData(a.data)),k.isNullOrEmpty(f.type)&&g.go("standardmasterlist"),a.createMasterData=function(b){if(a.progress=!0,b.$valid){var e={headers:{"Content-Type":"application/x-www-form-urlencoded"}};delete a.newStandardMasterObj.creatingOrgLocId_;var f=new Object;angular.copy(a.newStandardMasterObj,f),k.checkNullProp(f),angular.forEach(a.data,function(a){"Date"===a.type&&(f[a.entityFieldName]=c("date")(new Date(f[a.entityFieldName]),"dd-MM-yyyy"))});var g="formData="+angular.toJson(f)+"&parentTableId="+a.data[0].standardMasterId+"&organizationLocationId="+a.creatingOrgLocId_;k.isFieldEmpty(a.newStandardMasterObj.id)?d.postDataWithHeader(i.getUrl("CREATE_STANDARDMASTERRECORD"),g,e,function(b){b.data.successMessage&&(j("success",b.data.successMessage),a.back())},function(b){a.progress=!1}):d.postDataWithHeader(i.getUrl("UPDATE_STANDARDMASTERRECORD"),g,e,function(b){b.data.successMessage&&(j("success",b.data.successMessage),a.back())},function(b){a.progress=!1})}else a.progress=!1},a.checkBooleanValue=function(b){return"add"!==a.pageState&&b},a.back=function(){g.go("standardmasterlist",{type:"cancelled"})}}])}(),function(){"use strict";angular.module("paripal.manageStandardMaster").controller("StandardMasterLanguageTranslationCtrl",["$scope","$location","$filter","httpService","service","$stateParams","$state","dateconvertor","urlService","notify",function(a,b,c,d,e,f,g,h,i,j){a.translatedObj={};var k={};a.init=function(){"translate"!==f.type?g.go("standardmasterlist"):d.getData(i.getUrl("GET_LANGUAGES"),null,function(b){a.languages=angular.fromJson(b.data)},function(){})},"translate"===f.type&&(a.fieldDetails=f.data.metaData,a.recordData=f.data.gridData,a.translationTableType=f.data.translationTableType),a.translateLanguage=function(b){if(a.progress=!0,b.$valid){var c=[],e=angular.fromJson(a.language).id;for(var f in a.translatedObj)if(a.translatedObj.hasOwnProperty(f)){var g={};g.itemCode=k[f],g.translatedValue=a.translatedObj[f].value,g.systemLanguageId=e,g.itemId=a.recordData.id,g.translationTableType=a.translationTableType,c.push(g)}d.postData(i.getUrl("UPDATE_TRANSLATEDDATA"),c,function(b){b.data.successMessage&&(j("success",b.data.successMessage),a.back())},function(b){a.progress=!1,j("error","Some Error")})}},a.findTranslatedValue=function(){var b={};b={parentTableId:a.fieldDetails[0].standardMasterId,recordId:a.recordData.id,languageId:angular.fromJson(a.language).id,translationTableType:a.translationTableType},d.getData(i.getParameterizedUrl("FIND_TRANSLATEDSTANDARDMASTERDATA",b),null,function(b){for(var c=angular.fromJson(b.data),d=0;d<a.fieldDetails.length;d++)a.fieldDetails[d].whetherTranslatedValue&&"Varchar"===a.fieldDetails[d].type&&(k[a.fieldDetails[d].entityFieldName]=c[a.fieldDetails[d].entityFieldName].code,a.translatedObj[a.fieldDetails[d].entityFieldName]=c[a.fieldDetails[d].entityFieldName])},function(){})},a.back=function(){g.go("standardmasterlist",{type:"cancelled"})},a.init()}])}(),function(){"use strict";angular.module("paripal.manageStandardMaster").controller("StandardMasterListCtrl",["$scope","$rootScope","httpService","$stateParams","$state","dateconvertor","urlService","serverSidePagination","notify","$uibModal","$mdDialog","utilService","$translate","storageService","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){/*
                     * For Pagination defaults value
                     * Default records per page organizationLocations: [1],
                     */
//TODO:[RAL]
var p,q={organizationCategory:angular.fromJson(localStorage.loggedInUser).userOrganizationCategoryType};a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.standardMaster={},a.standardMaster.organization={},a.standardMaster.organizationLocation={},a.categoryList=[],a.entityList=[],a.$watch("standardMaster.organization",function(b){l.isEmpty(b)||l.isEmpty(b.data)?a.standardMaster.organizationId=null:a.standardMaster.organizationId=b.data.id},!0),a.$watch("standardMaster.organizationLocation",function(b){l.isEmpty(b)||l.isEmpty(b.data)?a.standardMaster.creatingOrgLocId_=null:(a.standardMaster.creatingOrgLocId_=b.data.id,a.loadCategories(a.standardMaster.creatingOrgLocId_))},!0),/*Called on initialization*/
a.init=function(){var b=o.getDefaultOrgLocation();l.isFieldEmpty(b)||(a.standardMaster.organization={data:b.org},a.standardMaster.organizationLocation={data:b.orgLoc})},l.isNullOrEmpty(d.type)&&localStorage.removeItem("selectedCriteria"),a.loadCategories=function(b,e){e!==!1&&(a.standardMaster.entityId=null,a.entityList=[]);var f={};f.organizationLocationId=b,c.getData(g.getParameterizedUrl("GET_CATEGORIES",f),null,function(b){a.categoryList=angular.fromJson(b.data);
//                            if (!utilService.isNullOrEmpty(selectedCriteria)) {
var c=d.searchType;"Lab_CRM"==c&&(a.standardMaster.catergoryCode="Lab_CRM",a.entityCode="treatment_type",a.loadEntities("Lab_CRM",a.standardMaster.creatingOrgLocId_))},function(a){})},/*
                     * This method is used to fetch entities
                     */
a.loadEntities=function(b,d){var e={};a.entityList=[],e.moduleName=b,e.organizationLocationId=d,c.getData(g.getParameterizedUrl("GET_ENTITYBYCATEGORYCODE",e),null,function(b){a.entityList=angular.fromJson(b.data),l.isFieldEmpty(b.data)||(a.entityList.length>0&&(a.standardMaster.entityId=a.entityList[0].id),l.isFieldEmpty(p)||p.catergoryCode!==a.standardMaster.catergoryCode||(a.standardMaster.entityId=p.entityId),angular.forEach(a.entityList,function(b,c){b.code==a.entityCode&&(a.standardMaster.entityId=b.id)}),a.getGridHeading(a.standardMaster.entityId))},function(a){})},/*
                     * This method is used to fetch grid data
                     */
a.getGridHeading=function(b){var d,e,f={},i=!1,j=!1;f.standardMasterId=b,f.pageNumber=a.currentPage,f.recordsPerPage=a.itemPerPage,f.sort=null,a.totalItems=null,c.getData(g.getParameterizedUrl("GET_GRIDHEADINGBYENTITYID",f),null,function(b){d=angular.fromJson(b.data.standardMasterItems),i=!0,a.metaDataLength=d.length+1,a.translationTableType=b.data.translationTableType,a.organizationCategory=b.data.organizationCategory,a.whetherOrgCategory=a.checkOrganizationCategory(a.organizationCategory,q.organizationCategory),a.loadTable(i,j,d,e)},function(a){}),c.getData(g.getParameterizedUrl("GET_GRIDDATABYENTITYID",f),null,function(b){a.metaData=a.columnsHeadingsData,j=!0;var c=angular.fromJson(b.data);e=c.data,a.totalItems=b.data.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.loadTable(i,j,d,e)},function(a){})},a.loadTable=function(b,c,d,e){a.gridDataNull=!1,b&&c&&(a.metaData=angular.copy(d),l.isEmpty(e)?(a.gridDataNull=!0,a.gridData=[]):a.gridData=angular.copy(e))},a.calculateIndex=function(a,b,c){return(b-1)*c+1+a},a.checkOrgLocationIdOfLoggedInUser=function(b){if("PRODUCT"===q.organizationCategory)return!0;if(null===b||void 0===b)return!0;if(b===parseInt(a.standardMaster.creatingOrgLocId_))return!0;var c=n.getLocationFeaturePrivileges();if(!l.isEmpty(c)&&c.hasOwnProperty(a.featurePrivilege)){var d=c[scope.featurePrivilege];l.isEmpty(d)||d.indexOf(parseInt(b))>-1&&(whetherDisable=!1)}/*
                                                var orgLocationsOfLoggedInUser = loggedInUser.organizationLocations;
                                                var flag = false;
                                                for (var i = 0; i < orgLocationsOfLoggedInUser.length; i++) {
                                                    if (organizationLocationId === orgLocationsOfLoggedInUser[i]) {
                                                        flag = true;
                                                        break;
                                                    };
                                                }*/
return!1},a.checkOrganizationCategory=function(a,b){var c;return c="PRODUCT"===b||"NULL"===a||("SYSTEM"===b&&("ANY"===a||"SYSTEM"===a)||"ANY"===b&&"ANY"===a)};var r=function(){p={organizationId:a.standardMaster.organizationId,creatingOrgLocId_:a.standardMaster.creatingOrgLocId_,catergoryCode:a.standardMaster.catergoryCode,entityId:parseInt(a.standardMaster.entityId),organization:a.standardMaster.organization,organizationLocation:a.standardMaster.organizationLocation},localStorage.setItem("selectedCriteria",angular.toJson(p))};/*Add data to the selected table and entity*/
a.addNewGridData=function(){r(),e.go("managestandardmaster",{type:"add",data:{metaData:a.metaData,creatingOrgLocId_:a.standardMaster.creatingOrgLocId_}})},a.flushCache=function(){var a=k.confirm().title(m.instant("FLUSH_CACHE")).textContent(m.instant("FLUSH_CACHE_CONFIRM_MESSAGE")).ok(m.instant("OK")).cancel(m.instant("CANCEL"));k.show(a).then(function(){var a=g.getUrl("SM_REMOVE_CACHE");c.putData(a,null,function(){},function(){i("error",m.instant("ERROR_IN_CLEAR_CACHE"))})},function(){})},/*Edit data of the selected grid entity*/
a.editGridData=function(b){r(),e.go("managestandardmaster",{type:"edit",data:{metaData:a.metaData,gridData:b}})},/*Add Translation to the selected record*/
a.addTranslation=function(b){r(),e.go("standardmasterlanguagetranslation",{type:"translate",data:{metaData:a.metaData,gridData:b,translationTableType:a.translationTableType}})},/*Opens a confirmation dialogue for removing a record*/
a.showConfirm=function(b,c){a.data=c,a.modalInstance=j.open({scope:a,animation:!0,templateUrl:"app/modules/standard-master/views/remove-standard-master-object.html",size:"sm",keyboard:!0,backdrop:!1})},/*Called to close the modal popup of Remove*/
a.cancelPopup=function(){a.modalInstance.close()},/*Delete a record from the Grid*/
a.deleteGridData=function(b){var d=a.metaData[0].standardMasterId,e=b.id,f=g.getUrl("REMOVE_STANDARDMASTERRECORD");f=f+"?parentTableId="+d+"&recordId="+e,c.deleteData(f,null,function(){a.cancelPopup(),a.getGridHeading(a.standardMaster.entityId),i("success","Grid Data Removed Successfully!!")},function(){i("error","Some Error")})},/*Server side pagination module*/
a.pageChanged=function(b){a.currentPage=b,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.getGridHeading(a.standardMaster.entityId)},/*Called when records per page are changed*/
a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.getGridHeading(a.standardMaster.entityId)},/*Datatable configurations*/
/*config = {
                        "searching": false,
                        "info": false,
                        "responsive": true,
                        "lengthChange": false
                    };
                    $scope.options = datatableconfig.setOptionProperties(config);
                    $scope.dtColumnDefs = datatableconfig.setColumnProperties({
                        notSoratbleCol: [1]
                    });*/
a.init(),"cancelled"===d.type&&(p=angular.fromJson(localStorage.getItem("selectedCriteria")),angular.copy(p,a.standardMaster),/*$scope.loadLocations(selectedCriteria.organizationId, false);*/
a.loadCategories(p.creatingOrgLocId_,!1),a.loadEntities(p.catergoryCode,p.creatingOrgLocId_),localStorage.removeItem("selectedCriteria"))}])}(),angular.module("paripal.orgSupportServiceProfessionalServiceCategories").controller("supportServiceProfessionalCategoriesCtrl",["$scope","$rootScope","$stateParams","$state","datatableconfig","notify","$translate","serverSidePagination","utilService","$mdDialog","$mdMedia","orgSupportProfessionalCategoriesService","httpService","urlService","featurePrivilegeConstants","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";
//popup controller starts
function q(a,c,d,e,h){a.professional={},a.orgLocPermission=h.SUPPORT_PROF_CATEGORIES_ADD,a.WSSupportServiceProfSpecData=d,a.WSSupportServiceProfSpecData.treatmentType=d.specialization,a.professional.data=d.professional,a.WSSupportServiceProfSpec=d,a.editMode=!1,a.treatment={queryUrl:"GET_SUPPORT_PROFESSIONAL_TYPES_FOR_SUPPORT_SPECIALIZATION",queryParameter:{},jsonParameter:{}},i.isEmpty(a.WSSupportServiceProfSpec)?(a.WSSupportServiceProfSpec.whetherActive=!0,a.WSSupportServiceProfSpec.whetherNotifificationEnabled=!1):(a.WSSupportServiceProfSpec.whetherActive=a.WSSupportServiceProfSpec.whetherActive,a.WSSupportServiceProfSpec.whetherNotifificationEnabled=a.WSSupportServiceProfSpec.whetherNotifificationEnabled,i.isEmpty(a.WSSupportServiceProfSpec.specialization)||(a.editMode=!0)),a.hide=function(){c.hide()},a.cancel=function(){c.cancel()},a.saveSupportServiceProfessional=function(){a.WSSupportServiceProfSpec.id?a.type="edit":(b.showSpinner=!0,a.type="add"),l.saveSupportServiceProfessional(a.WSSupportServiceProfSpec,a.type,function(d){b.showSpinner=!1,"add"==a.type?f("success",g.instant("ADDED_SUCCESS")):f("success",g.instant("RECORD_EDITED_SUCESS")),c.hide(a.WSSupportServiceProfSpec),e.searchSupportServiceProfessionals(a.WSSupportServiceProfSpec.professional)},function(a){b.showSpinner=!1})},a.getSupportServiceType=function(b){/* supportServiceTypeObj.searchString = value;*/
return m.getData(n.getParameterizedUrl("GET_SUPPORT_SERVICE_TREATMENT_TYPE"),null,function(b){return a.supportServiceTypeData=angular.fromJson(b.data),a.supportServiceTypeData},function(a){})},/*  $scope.getprofessionals = function (value) {
                    var professionalsObj = {};
                    professionalsObj.searchString = value;
                    return httpService.getData(urlService.getParameterizedUrl('GET_SUPPORT_PROFESSIONAL_USER', professionalsObj), null, function (response) {
                        $scope.professionalsData = angular.fromJson(response.data);
                        return $scope.professionalsData;
                    }, function (error) {}, {
                        'orgLocPermission': 'support_prof_categories_view'
                    });

            };*/
a.onProfessionalSelect=function(b){a.WSSupportServiceProfSpec.professional=b.data},a.onSupportServiceTypeSelect=function(b){a.WSSupportServiceProfSpec.treatmentType=b},a.validateValue=function(b,c){i.isNullOrEmpty(b)&&"PROFESSIONALS"===c?(a.WSSupportServiceProfSpec.professional="",a.WSSupportServiceProfSpecData.professional=""):i.isNullOrEmpty(b)&&"SPECIALIZATION"===c&&(a.WSSupportServiceProfSpec.treatmentType="",a.WSSupportServiceProfSpecData.treatmentType="")}}q.$inject=["$scope","$mdDialog","WSSupportServiceProSpecValues","parentScope","featurePrivilegeConstants"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.customFullscreen=k("xs")||k("sm"),a.WSSupportServiceProSpecValues={},a.WSSupportServiceProfSpecSearchCriteria={},a.WSSupportServiceProSpecData={},a.supportServiceProfservCatSpinner=!1,a.professional={},a.searchSupportServiceProfessionals=function(b){return a.supportServiceProfservCatSpinner=!0,a.WSSupportServiceProfSpecSearchCriteria.pageNumber=a.currentPage,a.WSSupportServiceProfSpecSearchCriteria.recordsPerPage=a.itemPerPage,a.WSSupportServiceProfSpecSearchCriteria.user={},b?(a.WSSupportServiceProfSpecSearchCriteria.user.id=b.id,void l.searchSupportServiceProfessionals(a.WSSupportServiceProfSpecSearchCriteria,function(b){a.supportServiceProfservCatSpinner=!1,a.WSSupportServiceProfsList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.supportServiceProfservCatSpinner=!1,a.error=b})):void(a.supportServiceProfservCatSpinner=!1)},a.addSupportServiceProfessional=function(b){(k("sm")||k("xs"))&&a.customFullscreen;j.show({controller:q,templateUrl:"app/modules/support-service-professional-service-categories/views/add-support-service-professional-service-categories.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:p.dialogBox.clickOutsideToClose,
// fullscreen: useFullScreen,
locals:{WSSupportServiceProSpecValues:a.WSSupportServiceProSpecValues,parentScope:a}}).then(function(b){a.WSSupportServiceProSpecValues={},i.isFieldEmpty(a.WSSupportServiceProSpecData.professional)||(a.WSSupportServiceProSpecValues.professional=a.WSSupportServiceProSpecData.professional)},function(){a.WSSupportServiceProSpecValues={},i.isFieldEmpty(a.WSSupportServiceProSpecData.professional)||(a.WSSupportServiceProSpecValues.professional=a.WSSupportServiceProSpecData.professional)})},/* $scope.getprofessionals = function (value) {
                 var professionalsObj = {};
                 professionalsObj.searchString = value;
                 return httpService.getData(urlService.getParameterizedUrl('GET_SUPPORT_PROFESSIONAL_USER', professionalsObj), null, function (response) {
                     $scope.professionalsData = angular.fromJson(response.data);
                     return $scope.professionalsData;
                 }, function (error) {}, {
                     'orgLocPermission': 'support_prof_categories_view'
                 });

             };*/
a.onProfessionalSelect=function(b){a.WSSupportServiceProSpecData.professional=b.data,a.WSSupportServiceProSpecValues.professional=b.data,a.searchSupportServiceProfessionals(b.data)},a.editSupportServiceProfessionals=function(b,c){a.WSSupportServiceProSpecValues=b,a.addSupportServiceProfessional(c)},
//popup controller ends
a.$watch(function(){return k("xs")||k("sm")},function(b){a.customFullscreen=b===!0}),
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchSupportServiceProfessionals(a.WSSupportServiceProSpecData.professional),a.supportServiceProfservCatSpinner=!1},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchSupportServiceProfessionals(a.WSSupportServiceProSpecData.professional),a.supportServiceProfservCatSpinner=!1};
//datatble config json
var r={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=e.setOptionProperties(r),a.dtColumnDefs=e.setColumnProperties({}),a.init=function(){i.isEmpty(c.professional)||(a.WSSupportServiceProSpecData.professional={id:c.professional.id,value:c.professional.userName},a.professional.data={id:c.professional.id,value:c.professional.userName},a.WSSupportServiceProSpecValues.professional=a.WSSupportServiceProSpecData.professional,a.searchSupportServiceProfessionals(a.WSSupportServiceProSpecData.professional)),"professionalwall"===c.type&&(a.fromProfessionalWall=!0),a.WSSupportServiceProfSpec={},a.WSSupportServiceProfSpec.whetherActive=!0},a.init()}]),angular.module("paripal.orgSupportServiceProfessionalServiceCategories").service("orgSupportProfessionalCategoriesService",["httpService","urlService","dateconvertor","utilService","$filter",function(a,b,c,d,e){"use strict";this.saveSupportServiceProfessional=function(c,e,f,g){var h=angular.copy(c);d.isFieldEmpty(h.professional)||(delete h.professional.organizationLocationId,delete h.professional.value,delete h.professional.code),d.isFieldEmpty(h.whetherActive)&&(h.whetherActive=!1),d.isFieldEmpty(h.whetherNotifificationEnabled)&&(h.whetherNotifificationEnabled=!1),h.specialization=h.treatmentType,d.isFieldEmpty(h.treatmentType)||delete h.treatmentType;var i=null;"edit"===e?(i=b.getParameterizedUrl("UPDATE_SUPPORT_PROFESSIONAL_SERVICE_CATEGORIES"),a.putData(i,h,function(a){a&&a.data&&f(a.data)},function(a){g(a)})):(i=b.getUrl("ADD_SUPPORT_PROFESSIONAL_SERVICE_CATEGORIES"),a.postData(i,h,function(a){a&&a.data&&f(a.data)},function(a){g(a)}))},this.searchSupportServiceProfessionals=function(c,d,e){a.postData(b.getUrl("SEARCH_SUPPORT_PROFESSIONAL_SERVICE_CATEGORIES"),c,function(a){a.data&&a.data.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.transactionModule").controller("SubscriberTransactionListCtrl",["$scope","utilService","httpService","urlService","notify","datatableconfig","serverSidePagination","$state","$stateParams","commonConstants","EmergencyTransactionService","commonBillingService","$mdDialog","$translate","featurePrivilegeConstants","$timeout","filterFilter","dateconvertor","userStatusService","$rootScope","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a,f,g,i,k){a.commonConstants=j,a.transactionList=[],a.transactionList=g,a.transactionIds=[];for(var l=0;l<=a.transactionList.length;l++)null!=a.transactionList[l]&&a.transactionIds.push(a.transactionList[l].id);a.isPartyTypeDisabled=!0,a.isRaisedOnDisabled=!0,a.filterCriteria={},a.cancel=function(){f.hide()},a.loc={},a.loc.id=a.transactionList[0].locationId,a.loc.value=a.transactionList[0].locatinName,a.filterCriteria.orgLocation=i,a.inFavorOfTypeSelected=function(){a.isRaisedOnDisabled=!1},a.partyType=k,a.getPartyNameData=function(b){var e={};return e.searchKeyword=b,e.billPartyType=a.filterCriteria.partyType,e.noOfSuggestions=j.smartSearchRecordLimit,a.userNameAutoCmpLoading=!0,c.postData(d.getParameterizedUrl("FIND_BILL_IN_FAVOR_OF"),e,function(b){return a.userNameAutoCmpLoading=!1,angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1},{orgLocPermission:o.BILL_VIEW})},a.saveBill=function(){var e={};/*angular.copy($scope.filterCriteria, requestData);*/
b.isFieldEmpty(a.loc)||(e.ownerLocation={},e.ownerLocation=a.loc),b.isFieldEmpty(a.partyNameId.id)||(e.raisedOnUser=a.partyNameId.id),b.isFieldEmpty(a.filterCriteria.partyType)||(e.raisedOn=a.filterCriteria.partyType),b.isFieldEmpty(a.transactionIds)||(e.transactionIds=a.transactionIds),c.postData(d.getUrl("GENERATE_CONSOL_BILL"),e,function(b){a.diagnosticListSpinner=!1,f.hide();var c={};c=angular.fromJson(b.data);/*$scope.transactionList = transactionListData.data;*/
/*console.log(billObject.response);*/
c.response;h.go("consolidatedbill",{billId:c.response})},function(b){a.diagnosticListSpinner=!1;var c=f.alert().title(n.instant("CONSOLIDATED_BILL")).textContent(n.instant("EVENT_FEE_TYPE_NOT_FOUND")).ok(n.instant("OK"));f.show(c).then(function(){},function(){})},{handleError:!1})},a.selectedRecord=!1,a.deleteRecord=function(b){if(a.transactionList.length-a.rowRemove.length<2)e("INFO",n.instant("TRANS_CANNOT_BE_LESS"));else{var c=[];angular.forEach(a.transactionList,function(b,d){angular.forEach(a.rowRemove,function(c,d){if(c.id==b.id){
//var transactionListIndex = $scope.transactionList.indexOf(transactionValue);
//$scope.transactionList.splice(transactionListIndex, 1);
var e=a.rowRemove.indexOf(c);a.rowRemove.splice(e,1);var f=m.indexOf(e.id);m.splice(f,1);var g=a.transactionIds.indexOf(b.id);a.transactionIds.splice(g,1)}}),$.inArray(b.id,a.transactionIds)!=-1&&c.push(b)}),a.transactionList=c}},a.rowRemove=[],a.checkedArray=[];var m=[];a.selectedRecord=[],a.recordSelected=function(b,c,d){if(0==a.rowRemove.length)a.rowRemove.push(b),m.push(b.id),a.checkedArray[b.id]=!0,a.selectedRecord[b.id]=!0;else if($.inArray(b.id,m)==-1)a.rowRemove.push(b),m.push(b.id),a.checkedArray[b.id]=!0,a.selectedRecord[b.id]=!0;else{a.checkedArray[b.id]=!1,a.selectedRecord[b.id]=!1;var e=m.indexOf(b.id);m.splice(e,1)}if(m.length!=a.rowRemove.length){var f=[];angular.forEach(a.rowRemove,function(a,b){$.inArray(a.id,m)!=-1&&f.push(a)}),a.rowRemove=f}}}v.$inject=["$scope","$mdDialog","gridData","locationSelected","partyTypeList"],a.filterObject={},a.currentPage=j.defaultPageNo,a.itemPerPage=j.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=j,a.isOrgShown=!1,a.getOrgLocList=[];var w=[];a.selectedRecord=[],a.checkedArray=[];var x,y;a.isChecked=!0,
//$scope.filterObject.locationId = null;
a.whetherProfessionalDropDownEnabled=!1,/*$scope.showCol = true;*/
a.countHide=!0,a.hideLink=!0,a.hideBillMessage=!1,a.ifPopUpDataExists={};var z,A,B;a.transactionSearchObject={},a.init=function(){if(!b.isFieldEmpty(i.wallData)&&!b.isFieldEmpty(i.wallData.orglocation)){var c={};c.data=i.wallData.orglocation,a.filterObject.orgLocation=c}a.loggedInUser=u.getLoggedInUser(),b.isFieldEmpty(i.professional)||(a.filterObject.professional=i.professional),"professionalwall"===i.type&&(a.fromProfessionalWall=!0,s.isUserLoggedIn()&&0==a.loggedInUser.isOrganizationUserMode&&(a.filterObject.user=s.userStatus().userData)),a.searchData(),a.getListOfLocations(),a.getListOfPartyTypes(),a.getTransactionTypes()},a.cancel=function(){m.hide()},a.cancelRefundProcess=function(){m.hide(),a.searchData()},a.getTransactionForLoc=function(b){m.hide(),b&&(a.locaID=b.locationId);var e={};e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,w.length>0&&(e.locatoinId=a.locaID,e.transactionStatus="NEW",e.whetherOnbehalfOfOnly="true"),c.postData(d.getUrl("SEARCH_TRANSACTIONS"),e,function(b){a.diagnosticListSpinner=!1;var c={};c=angular.fromJson(b.data),a.totalItems=c.totalRecords,a.transactionList=c.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.diagnosticListSpinner=!1})},a.getListOfLocations=function(){return c.getData(d.getUrl("FIND_BILL_MADE_TO_DROPDOWN"),null,function(a){z=angular.fromJson(a.data)},function(a){},{orgLocPermission:o.BILL_VIEW})},a.getTransactionTypes=function(){return c.getData(d.getUrl("FIND_TRANSACTION_TYPE"),null,function(b){a.transactionSearchObject.transactionTypeList=angular.fromJson(b.data)},function(a){})},a.getListOfPartyTypes=function(){return c.getData(d.getUrl("FIND_ALL_BILL_PARTY_TYPE"),null,function(a){B=angular.fromJson(a.data)},function(a){})};var C=[];a.recordSelected=function(b,c,d){if(A=b.locatinName,0!=w.length||1==b.whetherBilled||null==b.onBehalfofUserId&&null==b.onBehalfofLocationId){/*if (row.whetherBilled) {*/
if(0==w.length||1==b.whetherBilled||null==b.onBehalfofUserId&&null==b.onBehalfofLocationId||"NEW"!=b.transactionStatus||1==a.fromProfessionalWall)return a.checkedArray[b.id]=!1,void(a.selectedRecord[b.id]=!1);/*}*/
if($.inArray(b.id,C)==-1)x==b.locationId?y==b.currency.id?(
//recordLocation.push(row);
w.push(b),a.checkedArray[b.id]=!0,a.selectedRecord[b.id]=!0,C.push(b.id),a.countHide=!1):(e("ERROR",n.instant("PLEASE_SELECT_TRANS_WITH_SAME_CURR")),a.checkedArray[b.id]=!1,a.selectedRecord[b.id]=!1):(e("ERROR",n.instant("PLEASE_SELECT_TRANS_WITH_SAME_LOC")),a.checkedArray[b.id]=!1,a.selectedRecord[b.id]=!1);else{a.checkedArray[b.id]=!1,a.selectedRecord[b.id]=!1;var f=C.indexOf(b.id);C.splice(f,1)}if(C.length!=w.length){var g=[];angular.forEach(w,function(a,b){$.inArray(a.id,C)!=-1&&g.push(a)}),w=g}}else a.hideBillMessage=!0,a.hideLink=!1,a.countHide=!1,w.push(b),C.push(b.id),a.countHide=!1,x=b.locationId,y=b.currency.id,a.checkedArray[b.id]=!0,a.selectedRecord[b.id]=!0,a.rowDataObj=b,m.show({scope:a,preserveScope:!0,templateUrl:"app/modules/billing/views/consolidated-bill-dialog.html",
//controller: 'SubscriberTransactionListCtrl',
parent:angular.element(document.body),
//targetEvent: ev,
clickOutsideToClose:j.dialogBox.clickOutsideToClose});a.count=w.length},a.proceedToBill=function(){w.length<2?e("info",n.instant("PLEASE_SELECT_MORE_THAN_ONE")):m.show({
// scope: $scope,
//preserveScope: true,
templateUrl:"app/modules/transaction/views/generate-consolidated-bill.html",controller:v,parent:angular.element(document.body),
//targetEvent: ev,
clickOutsideToClose:j.dialogBox.clickOutsideToClose,locals:{gridData:w,locationSelected:A,partyTypeList:B}}).then(function(){w=[],a.selectedRecord=[],a.checkedArray=[],a.count=null,C=[]})},a.transactionStatus=["NEW","BILL_RAISED","PAID","CANCELLED","REFUNDED"],a.transaction={queryUrl:"FIND_TRANSACTION_TYPE"},a.user={queryUrl:"GET_PATIENTS_USER_BY_SEACRH_KEY"},a.onOrgSelect=function(){b.isNullOrEmpty(a.filterObject.orgLocation)||b.isNullOrEmpty(a.filterObject.orgLocation.data)?(a.orgLocId=null,a.filterObject.locationId=null,a.whetherProfessionalDropDownEnabled=!1):(a.orgLocId=a.filterObject.orgLocation.data.id,a.filterObject.locationId=a.filterObject.orgLocation.data.id,D(a.orgLocId))};var D=function(b){a.whetherProfessionalDropDownEnabled=!0};a.getProfessionals=function(e){if(b.isNullOrEmpty(a.professionals)){var f={searchString:e,orgLocationId:a.filterObject.orgLocation.data.id};return c.getData(d.getParameterizedUrl("FIND_PROFESSIONALS",f),null,function(a){return a.data},function(a){})}return a.professionals},a.setProfessionalId=function(b){a.filterObject.professional=b},/**
         *search Data functionality
         */
a.searchData=function(){t.showSpinner=!0;var e={};angular.copy(a.filterObject,e),e.pageNumber=a.currentPage,e.recordsPerPage=a.itemPerPage,b.isFieldEmpty(e.fromDate)||(e.fromDate=r.convertToServerDate(e.fromDate)),b.isFieldEmpty(e.toDate)||(e.toDate=r.convertToServerDate(e.toDate)),b.isFieldEmpty(e.serviceTypeId)&&delete e.serviceTypeId,b.isFieldEmpty(e.serviceTypeGroup)&&delete e.serviceTypeGroup,b.isFieldEmpty(e.amount)&&delete e.amount,b.isFieldEmpty(e.mobileNo)&&delete e.mobileNo,b.isFieldEmpty(e.receiptId)&&delete e.receiptId,b.isFieldEmpty(e.transactionType)||(e.transactionTypeId=e.transactionType.id),delete e.transactionType,b.isFieldEmpty(e.orgLocation)||b.isFieldEmpty(e.orgLocation.data)||(e.locatoinId=e.orgLocation.data.id),delete e.locationId,delete e.orgLocation,b.isFieldEmpty(e.professional)||(e.professionalId=e.professional.id),delete e.professional,b.isFieldEmpty(e.user)||(e.userId=e.user.id),b.isFieldEmpty(e.serviceTypeGroup)||(e.serviceTypeGroup=e.serviceTypeGroup.id),b.isFieldEmpty(e.serviceTypeId)||(e.serviceTypeId=e.serviceTypeId.id),delete e.user,delete e.orgLocatoin,c.postData(d.getUrl("SEARCH_TRANSACTIONS"),e,function(b){t.showSpinner=!1;var c={};c=angular.fromJson(b.data),a.totalItems=c.totalRecords,a.transactionList=c.data,a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems)},function(a){t.showSpinner=!1})},a.generateBill=function(a){var b=[a.id];l.generateBill(b,function(a){e("success",a.successMessage),a.response&&h.go("managebill",{type:"view",billId:a.response})},function(a){})},a.cancelTransaction=function(b,f,g){var h=m.confirm().title(n.instant("CANCEL")).textContent(n.instant("CANCEL_PROCESS_MSG")).ok(n.instant("OK")).cancel(n.instant("CANCEL"));m.show(h).then(function(){if(b){var h={};h.transactionId=b,c.putData(d.getParameterizedUrl("TRANSACTION_INACTIVATE",h),null,function(c){e("success",c.data.successMessage),p(function(){c.data.response&&"REFUND_UNDER_PROCESS"!=g&&(1==f&&"NOT_REFUNDED"==g?a.checkForBillRefund(b,c.data.response):a.generateRefundBillOffline(b))},1e3),a.searchData()},function(a){}),a.searchData()}})},a.getBill=function(a,e){if(a){var f={};return f.transactionId=a,c.getData(d.getParameterizedUrl("FIND_BILL_BY_TRANSACTION_ID",f),null,function(a){b.isFieldEmpty(a.data)||(e===!1?h.go("managebill",{type:"view",data:a.data}):h.go("consolidatedbill",{type:"view",billId:a.data.id}))},function(a){})}},a.processBillRefund1=function(a,f){var g=m.confirm().title(n.instant("REFUND")).textContent(n.instant("REFUND_PROCESS_MSG")).ok(n.instant("OK")).cancel(n.instant("CANCEL"));m.show(g).then(function(){if(a){var f={};return f.transactionId=a,c.getData(d.getParameterizedUrl("VALIDATE_REFUND_BILL",f),null,function(a){b.isFieldEmpty(a.data)?e("error",n.instant("REFUND_TRANSACTION_ALREADY_DONE")):h.go("createbill",{type:"REFUND",data:a.data,feeHeadAmnt:"YES"})},function(a){})}})},a.processBillRefund=function(b,c,d){"REFUND_UNDER_PROCESS"==d?/*whetherRefundUnderProcess == true*/
e("info",n.instant("REFUND_ALREADY_IN_PROCESS")):1==c&&"NOT_REFUNDED"==d?/*(whetherRefundedEver == null || whetherRefundedEver == false)*/
a.checkForBillRefund(b):a.generateRefundBillOffline(b)},a.checkForBillRefund=function(b,c){m.show({scope:a,preserveScope:!0,templateUrl:"app/modules/billing/views/generate-refund-bill-online-dialog.html",
//controller: 'SubscriberTransactionListCtrl',
parent:angular.element(document.body),
//targetEvent: ev,
clickOutsideToClose:j.dialogBox.clickOutsideToClose}).then(function(){a.searchData()}),a.processRefundBillOption=function(){"online"==a.refund.value?(m.hide(),a.generateRefundBillOnline(b)):"offline"==a.refund.value&&(m.hide(),a.generateRefundBillOffline(b))}},a.generateRefundBillOnline=function(f){if(f){var g={};/*                    $state.go("managebill", {
                                        type: "view",
                                        billId: 522
                                    });*/
return g.transactionId=f,c.putData(d.getParameterizedUrl("GENERATE_ONLINE_REFUND_BILL",g),null,function(c){b.isFieldEmpty(c.data.response)?(e("info",n.instant("REFUND_INITIATED_WILL_BE_PROCESSED_SOON")),a.searchData()):h.go("managebill",{type:"view",billId:c.data.response})},function(a){})}},a.generateRefundBillOffline=function(a){if(a){var f={};return f.transactionId=a,c.getData(d.getParameterizedUrl("VALIDATE_REFUND_BILL",f),null,function(a){b.isFieldEmpty(a.data)?e("error",n.instant("REFUND_TRANSACTION_ALREADY_DONE")):h.go("createbill",{type:"REFUND",data:a.data,feeHeadAmnt:"YES"})},function(a){})}},/**
         *Edit indicator functionality
         */
a.viewTransaction=function(a,b){h.go("viewtransaction",{type:b,id:a.id,data:a.id})},a.viewTransactionDocuments=function(a){h.go("emergencyuploadlist",{transactionId:a.id})},/*
         *Clear function
         */
a.clear=function(){a.filterObject={},h.reload()},/**
         *Add new function
         */
a.redirectToSeachHospital=function(){h.go("emergencytransaction")},a.init(),/**
         *Server side pagination module
         */
a.pageChanged=function(){a.pagingInfo=g(a.currentPage,a.itemPerPage,a.totalItems),/*$scope.searchData();*/
a.locaID?a.getTransactionForLoc():a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};/**
         *datatble config json
         */
var E=j.gridConfigurations;a.options=f.setOptionProperties(E)}]),angular.module("paripal.transactionModule").controller("ViewTransactionCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","manageOrgLocService","orgLocListService","notify","$translate","$mdDialog","commonConstants","urlService","otherDocumentService","fileOperations","utilService","httpService","commonBillingService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";a.transactionData={};a.init=function(){var b={};o.isFieldEmpty(c.id)||(b.transactionId=c.id,console.log(b),p.getData(l.getParameterizedUrl("FIND_TRANSACTIONBYID",b),null,function(b){var c={},d=[],e=[];c=angular.fromJson(b.data.wsTransactionViewModel),d=angular.fromJson(b.data.wsBillAdjustmentLists),e=angular.fromJson(b.data.wsBillForTransactionViewList),a.transactionData=c,a.billsAdjDetails=d,a.billsDetails=e,a.transactionData.whetherActive?a.textColorClass1="greenText":a.textColorClass1="redText",a.transactionData.whetherBillable?a.transactionData.whetherBilled?a.textColorClass="greenText":a.textColorClass="redText":a.textColorClass="greenText"},function(a){}))},a.generateBill=function(){if(a.transactionData&&a.transactionData.id){var b=[a.transactionData.id];q.generateBill(b,function(a){h("success",a.successMessage),a.response&&d.go("managebill",{type:"view",billId:a.response})},function(a){})}},a.viewTransactionDocuments=function(){a.transactionData&&a.transactionData.id&&d.go("emergencyuploadlist",{transactionId:a.transactionData.id})},a.cancelTransaction=function(){if(a.transactionData&&a.transactionData.id){var b={};b.transactionId=a.transactionData.id,/*Get Transaction ID List*/
p.putData(l.getParameterizedUrl("TRANSACTION_INACTIVATE",b),null,function(b){if(h("success",b.data.successMessage),b.data){var c=j.confirm().title(i.instant("REFUND")).textContent(i.instant("REFUND_PROCESS_MSG")).ok(i.instant("OK")).cancel(i.instant("CANCEL"));j.show(c).then(function(){a.processBillRefund(a.transactionData.id,b.data.response)})}},function(a){})}},a.processBillRefund=function(a,b){},a.init()}]),angular.module("paripal.transactionBloodDonation").controller("manageblooddonationsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$q","$timeout","manageBloodDonationServices","searchBloodDonationServices","httpService","urlService","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,l.getData(m.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&q()},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function q(){a.pageState="view",a.disabled=!0,k.getBloodDonationById(c.id,function(b){a.manageOrgLocSpinner=!1,a.bloodDonation=b,a.bloodDonation.orgLocationCode&&(a.bloodDonation.orgLocationCode=a.bloodDonation.orgLocationCode),null!=a.bloodDonation.bloodDonationRequest&&(a.request=a.bloodDonation.bloodDonationRequest.value)},function(b){a.manageOrgLocSpinner=!1,a.error=b,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}a.step1=!0,a.step2=!1,a.step3=!1,a.location=[],a.loginDetails=b.loggedInUserDetails,a.bloodDonation={},a.maxDate=new Date,a.loginDetails&&(a.minDate=a.loginDetails.birthDate,a.bloodDonation.user={value:b.loggedInUserDetails.displayName,id:b.loggedInUserDetails.id}),a.minDateValidTill=new Date,a.CreatedBys=[{name:"user",bloodDonationRequest:1},{name:"guest",bloodDonationRequest:2}],a.minDateValidFrom=new Date,a.orgLocPermission=o.BLOOD_DONATION_ADD,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=p,a.allowAccessOTP=q,a.cancel=function(){n.goBackToPrevState()},a.getDate=function(b){a.minDateValidTill=b},a.init=function(){a.manageOrgLocSpinner=!0,"view"===c.type&&b.loggedInUserDetails&&(a.pageState="view",a.disabled=!0),"add"===c.type&&(a.orgLocPermission=o.BLOOD_DONATION_ADD,a.addmode=!0),"edit"===c.type&&b.loggedInUserDetails&&(a.orgLocPermission=o.BLOOD_DONATION_EDIT),c.data?(a.user={},a.bloodDonation=c.data,a.manageOrgLocSpinner=!1,a.type=c.type,a.user=a.bloodDonation.user.value,a.bloodDonation.orgLocationCode&&(a.bloodDonation.orgLocationCode=a.bloodDonation.orgLocationCode),null!=a.bloodDonation.bloodDonationRequest&&(a.request=a.bloodDonation.bloodDonationRequest.value)):c.id&&k.getBloodDonationById(c.id,function(b){a.manageOrgLocSpinner=!1,a.bloodDonation=b,a.bloodDonation.orgLocationCode&&(a.bloodDonation.orgLocationCode=a.bloodDonation.orgLocationCode),null!=a.bloodDonation.bloodDonationRequest&&(a.request=a.bloodDonation.bloodDonationRequest.value)},function(b){a.manageOrgLocSpinner=!1,a.error=b,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))}),"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||p()},a.init(),a.getUserNamesForRoleHistory=function(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data,a.users},function(b){a.userNameAutoCmpLoading=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("Alert",g.instant(b.data.messages[0]))})},a.saveBloodDonations=function(){angular.isString(a.bloodDonation.orgLocationCode)?a.bloodDonation.orgLocationCode=a.bloodDonation.orgLocationCode:a.bloodDonation.orgLocationCode=a.bloodDonation.orgLocationCode.value,""==a.bloodDonation.bloodDonationRequest&&delete a.bloodDonation.bloodDonationRequest,j.saveBloodDonation(a.bloodDonation,function(a){n.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),d.go("blooddonations"))},function(a){n.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})},a.getReqName=function(b){a.queryObj={},a.queryObj.value=b;var c=m.getParameterizedUrl("GET_BLOOD_REQ_LIST_BY_KEYWORD",a.queryObj);if(c)return l.getData(c,null,function(b){if(b&&b.data)return a.reqNameList=b.data,a.reqNameList},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getCreatedBy=function(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
//return httpService.getData(urlService.getParameterizedUrl('GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD', userObj), null, function (response) {
return c.keyword=b,l.getData(m.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}}]),angular.module("paripal.transactionBloodDonation").controller("requestanalysisCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","requestAnalysisServices","searchBloodRequestServices",function(a,b,c,d,e,f,g,h,i){function j(a){var b=[];return a.forEach(function(a){var c={};c.attribute=a.age,c.count=a.count,b.push(c)}),b}function k(a){var b=[];return a.forEach(function(a){var c={};c.attribute=a.name,c.count=a.avg,b.push(c)}),b}function l(a){var b=[];return a.forEach(function(a){if(0==b.length){var c={};c.attribute=a.onBehalfOfType,c.count=1,b.push(c)}else{var d=!1;if(b.forEach(function(b){b.attribute==a.onBehalfOfType&&(b.count=b.count+1,d=!0)}),!d){var e={};e.attribute=a.onBehalfOfType,e.count=1,b.push(e)}}}),b}function m(a){var b=[];return a.forEach(function(a){if(0==b.length){var c={};c.attribute=a.requesterType,c.count=1,b.push(c)}else{var d=!1;if(b.forEach(function(b){b.attribute==a.requesterType&&(b.count=b.count+1,d=!0)}),!d){var e={};e.attribute=a.requesterType,e.count=1,b.push(e)}}}),b}function n(a){var b=[];return a.forEach(function(a){if(0==b.length){var c={};c.attribute=a.bloodGroup,c.count=1,b.push(c)}else{var d=!1;if(b.forEach(function(b){b.attribute==a.bloodGroup&&(b.count=b.count+1,d=!0)}),!d){var c={};c.attribute=a.bloodGroup,c.count=1,b.push(c)}}}),b}a.analysisFilter={},a.addressFilter={},a.addressData={},a.chartType={},a.addressData={},a.incident="",a.analysisType="",a.analys=["Requests","Donations"],a.bloodgroup=["A+","A-","O+","O-","B+","B-","AB+","AB-"],a.stat=["Pending","Closed"],a.requestertype=["User","Guest"],a.onbhalftype=["Self","Others"],a.filter=!0,a.maxDate=new Date,a.minDate=new Date,a.fromMaxDate=new Date,a.changeChartByRequest=function(b){"Requests"==b&&(a.chartTypes=[{Name:"Total Request By Requester Type(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"},{Name:"Total Request By OnbehalfOf Type(Bar-Chart)",key:"Chart-2",value:"Bar-Chart"},{Name:"Total Request By Blood Group(Bar-Chart)",key:"Chart-3",value:"Bar-Chart"},{Name:"Break Down By Blood Group(Pie-Chart)",key:"Chart-4",value:"Pie-Chart"}]),"Donations"==b&&(a.chartTypes=[{Name:"Total Donation By Blood Group(Bar-Chart)",key:"Chart-1",value:"Bar-Chart"},{Name:"Average Amount of Donation(Bar-Chart)",key:"Chart-2",value:"Bar-Chart"},{Name:"Break Down By Blood Group(Pie-Chart)",key:"Chart-3",value:"Pie-Chart"},{Name:"Age Of Donation(Pie-Chart)",key:"Chart-4",value:"Pie-Chart"}])},a.getTillDate=function(b){a.minDate=b},a.setDirectiveFn=function(b){console.log("in setDirectiveFn"),a.barChartCreateFunction=b},a.setDirectiveFnForPie=function(b){a.pieChartCreateFunction=b},a.getRequestAnalysis=function(){if(a.analysisFilter&&!a.analysisFilter.analysisType)return void f("error",g.instant("ANALYSIS_TYPE_VALIDATION"));a.analysisFilter&&a.addressFilter.addressData&&(a.addressFilter.addressData.city&&(a.analysisFilter.cityId=a.addressFilter.addressData.city.id),a.addressFilter.addressData.country&&(a.analysisFilter.country=a.addressFilter.addressData.country.id),a.addressFilter.addressData.state&&(a.analysisFilter.state=a.addressFilter.addressData.state.id),a.addressFilter.addressData.district&&(a.analysisFilter.districtId=a.addressFilter.addressData.district.id));var b=a.analysisFilter.analysisType;a.analysisFilter&&a.analysisFilter.chartType&&(a.chartType=a.analysisFilter.chartType,delete a.analysisFilter.chartType),h.getRequestAnalysis(a.analysisFilter,a.chartType,function(c){c&&(0==c.data.length?(a.norecordfound=!0,a.chart=!1):"Bar-Chart"==a.chartType.value?(a.getBarChart(a.analysisFilter,c,b,a.chartType),a.norecordfound=!1):(a.getPieChart(a.analysisFilter,c,b,a.chartType),a.norecordfound=!1),a.chart=!0),a.analysisFilter.chartType=a.chartType,a.analysisFilter.analysisType=b},function(c){f("error",c),a.analysisFilter.chartType=a.chartType,a.analysisFilter.analysisType=b})},a.fetchRecords=function(b){i.fetchRecords(b,function(b){b&&(a.bloodRequestList=b.data)},function(a){f("error",a)})},a.resetData=function(){a.analysisFilter&&delete a.analysisFilter.status},a.clear=function(){a.analysisFilter={},a.chartType="",a.analysisType="",a.chartData={},a.chart=!1},a.getBarChart=function(b,c,d,e){var g=angular.copy(b),h=angular.copy(c),i=angular.copy(d);"Requests"==i&&("Chart-1"==e.key&&"Bar-Chart"==e.value&&(a.chartData=m(h.data),a.barChartCreateFunction()),"Chart-2"==e.key&&"Bar-Chart"==e.value&&(a.chartData=l(h.data),a.barChartCreateFunction()),"Chart-3"==e.key&&"Bar-Chart"==e.value&&(g.bloodGroups&&g.bloodGroups.length>0?(a.chartData=n(h.data),a.barChartCreateFunction()):f("error","Select alteast one blood group"))),"Donations"==i&&("Chart-1"==e.key&&"Bar-Chart"==e.value&&(g.bloodGroups&&g.bloodGroups.length>0?(a.chartData=n(h.data),a.barChartCreateFunction()):f("error","Select alteast one blood group")),"Chart-2"==e.key&&"Bar-Chart"==e.value&&(g.bloodGroups&&g.bloodGroups.length>0?(a.chartData=k(h),a.barChartCreateFunction()):f("error","Select alteast one blood group")))};a.getPieChart=function(b,c,d,e){"Requests"==d&&"Chart-4"==e.key&&"Pie-Chart"==e.value&&b.bloodGroups.length>0&&(a.chartData=n(c.data),a.pieChartCreateFunction()),"Donations"==d&&("Chart-3"==e.key&&"Pie-Chart"==e.value&&b.bloodGroups.length>0&&(a.chartData=n(c.data),a.pieChartCreateFunction()),"Chart-4"==e.key&&"Pie-Chart"==e.value&&(a.chartData=j(c),a.pieChartCreateFunction()))},a.getDate=function(b){a.minDateValidTill=b}}]),angular.module("paripal.transactionBloodDonation").controller("blooddonationsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","urlService","utilService","commonConstants","serverSidePagination","searchBloodDonationServices",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.bloodDonation={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.user1,a.valid=!1,a.loginDetails=b.loggedInUserDetails,a.filterObj={},a.userReadOnly=!1,
//$scope.getBloodDonationList();
a.loginDetails&&!a.loginDetails.isOrganizationUser&&(a.userReadOnly=!0,a.filterObj.user=a.loginDetails.displayName),a.addNewBloodDonation=function(){d.go("manageblooddonation",{type:""})},d.params.orgLoc&&(a.bloodDonation.orgLocationName=d.params.orgLoc),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,c.user&&(a.loginDetails&&a.loginDetails.isOrganizationUser?
// $scope.filterObj.user.id = $stateParams.user.userId;
a.filterObj.user=c.user.value:a.loginDetails&&!a.loginDetails.isOrganizationUser&&(a.filterObj.user=c.user)),a.clear=function(){a.filterObj={},a.getBloodDonationList()},a.isOrganizationUserMode=!1,b.loggedInUserDetails&&("PRODUCT"==b.loggedInUserDetails.userOrganizationCategoryType?a.isOrganizationUserMode=!0:"SYSTEM"==b.loggedInUserDetails.userOrganizationCategoryType&&(a.isOrganizationUserMode=!0)),a.getUserNamesForRoleHistory=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_LIST_BY_SEACRH_KEY";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),i.getData(j.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1,f("error",g.instant(b.data.messages[0]))})},a.getBloodDonationList=function(){a.bloodDonation.pageNumber=a.currentPage,a.bloodDonation.recordsPerPage=a.itemPerPage,!a.loggedInUserDetails||a.loggedInUserDetails.isOrganizationUserMode||c.user?a.filterObj.user&&a.filterObj.user.id?a.bloodDonation.userId=a.filterObj.user.id:(a.bloodDonation.userId="",a.userReadOnly=!1):a.bloodDonation.userId=a.loggedInUserDetails.id,n.getBloodDonationList(a.bloodDonation,function(b){b&&(a.bloodDonationsList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems))},function(a){k.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})},a.getBloodDonationList(),a.manageBloodDonation=function(a,b){n.getBloodDonationById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageblooddonation",{id:a,type:e,data:f})},function(a){})},
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems),a.getBloodDonationList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getBloodDonationList()};
//data table config
var o=l.gridConfigurations;a.options=h.setOptionProperties(o),a.dtColumnDefs=h.setColumnProperties({}),a.otherBloodDonationAction=function(a,c,e){"analysis"==c?d.go("bloodrequestanalysis"):"send-message"==c&&(1==b.loggedInUserDetails.isOrganizationUserMode?d.go("manageAdhocMessage"):n.sendMessage(a,function(a){k.isNullOrEmpty(a.data.successMessage)||f("success",g.instant(a.data.successMessage))}))}}]),angular.module("paripal.transactionBloodDonation").service("manageBloodDonationServices",["httpService","urlService","$timeout","dateconvertor",function(a,b,c,d){"use strict";this.saveBloodDonation=function(c,e,f){c.dateOfDonation=d.convertToServerDate(c.dateOfDonation);var g="";g=null!=c.id?"UPDATE_BLOOD_DONATION":"SAVE_BLOOD_DONATION",a.postData(b.getUrl(g),c,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})}}]),angular.module("paripal.transactionBloodDonation").service("requestAnalysisServices",["httpService","urlService","$timeout","$filter","dateconvertor",function(a,b,c,d,e){"use strict";this.getRequestAnalysis=function(c,d,e,g){
// if (requestAnalysisData.dateFrom !== undefined) {
//     requestAnalysisData.dateFrom = dateconvertor.convertToServerDate(requestAnalysisData.dateFrom);
// }
// if (requestAnalysisData.till !== undefined) {
//     requestAnalysisData.till = dateconvertor.convertToServerDate(requestAnalysisData.till);
// }
var h="GET_BLOOD_REQUEST_LIST";"Donations"==c.analysisType&&(h="GET_BLOOD_DONATION_LIST","Chart-4"==d.key&&"Donations"==c.analysisType&&(h="GET_BLOOD_DONATION_LIST_FOR_CHART"),"Chart-2"==d.key&&"Donations"==c.analysisType&&(h="GET_BLOOD_DONATION_BY_AVG_NO_OF_DONATION")),c.analysisType&&delete c.analysisType,a.postData(b.getUrl(h),c,function(a){a&&a.data?(f(a.data.data),e(a.data)):g(a)},function(a){g(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateRequestCreated=d("timestampToDate")(a.dateRequestCreated,b),a.whenNeeded=d("timestampToDate")(a.whenNeeded,b)})}}]),angular.module("paripal.transactionBloodDonation").service("searchBloodDonationServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){"use strict";this.getBloodDonationList=function(c,d,e){a.postData(b.getUrl("GET_BLOOD_DONATION_LIST"),c,function(a){a&&a.data?(f(a.data.data),d(a.data)):e(a)},function(a){e(a)})},
// this.fetchRecords = function (user,successCallback, errorCallback) {
// 	var user = {'userId':user.id};
//     httpService.postData(urlService.getUrl('GET_BLOOD_DONATION_LIST'),user, function (response) {
//          if (response && response.data)
//           {
//         	 convertListOfDate(response.data.data);
//              successCallback(response.data);
//           }
//          else
//              errorCallback(response);
//      }, function (error) {
//          errorCallback(error);
//      });
//  };
this.getBloodDonationById=function(c,d,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_BLOOD_DONATION_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.dateOfDonation=e("timestampToDate")(a.data.dateOfDonation,b),d(a.data)):f(a)},function(a){f(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateOfDonation=e("timestampToDate")(a.dateOfDonation,b)})};this.sendMessage=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("SEND_BLOOD_DONATION_MESSAGE_BY_ID",f),null,function(a){a&&a.data?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.transactionBloodRequests").controller("managebloodreqCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","$log","$timeout","manageBloodRequestServices","searchBloodRequestServices","utilService","urlService","httpService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,o.getData(n.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&r()},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function r(){a.viewMode=!0,a.pageState="view",l.getBloodRequestById(c.id,function(b){a.manageOrgLocSpinner=!1,a.bloodRequest=b,a.addressFilter.addressData=a.bloodRequest.bloodRequestAddress},function(b){a.manageOrgLocSpinner=!1,a.error=b})}a.bloodRequest={},a.step1=!0,a.step2=!1,a.step3=!1,a.iconStep1=!0,a.iconStep2=!0,a.iconStep3=!1,a.minDate=new Date,a.currentDate=new Date,a.behalfoftypes=["Self","Others"],a.bloodgroups=["O+","O-","A+","A-","B+","B-","AB+","AB-"],a.requestertype=["user","guest"],a.givenAt=["chennai","trichy"],a.addressFilter={},a.bloodRequest.bloodRequestAddress={},a.loginDetails=b.loggedInUserDetails;var s="MM/dd/yyyy";a.orgLocPermission=p.BLOOD_REQUEST_ADD,a.bloodRequest.dateRequestCreated=h("timestampToDate")(a.currentDate,s),a.type=c.type,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=q,a.allowAccessOTP=r,a.cancel=function(){/*$state.go("bloodreqlist", {
					type: ''
				});*/
m.goBackToPrevState()},b.loggedInUserDetails?(a.bloodRequest.requestBy=b.loggedInUserDetails.displayName,a.bloodRequest.email=b.loggedInUserDetails.email1,a.bloodRequest.phone=b.loggedInUserDetails.cell1,a.bloodRequest.requesterType="User",b.loggedInUserDetails.id&&(a.isUser=!0),b.loggedInUserDetails.isOrganizationUserMode?b.loggedInUserDetails.isOrganizationUserMode&&(a.bloodRequest.onBehalfOf=a.loginDetails.displayName):a.bloodRequest.onBehalfOf=a.loginDetails.displayName):a.bloodRequest.requesterType="Guest",a.loginDetails&&(a.bloodRequest.onBehalfOf===a.loginDetails.displayName?a.bloodRequest.onBehalfOfType="Self":a.bloodRequest.onBehalfOfType="Others");var t=angular.element(document.querySelector("#wizard1")),u=angular.element(document.querySelector("#wizard2")),v=angular.element(document.querySelector("#wizard3"));"edit"!==c.type&&"view"!==c.type||(a.iconStep3=!0),a.checkMandatory=function(){
// if(document.forms["addBloodReq"]["dateRequestCreated"].validity.valueMissing){
// 	document.forms["addBloodReq"]["dateRequestCreated"].focus();
// 	return true;
// }
// if(document.forms["addBloodReq"]["whenNeeded"].validity.valueMissing){
// 	document.forms["addBloodReq"]["whenNeeded"].focus();
// 	return true;
// }
return document.forms.addBloodReq.requestby.validity.valueMissing?(document.forms.addBloodReq.requestby.focus(),!0):document.forms.addBloodReq.requestId.validity.valueMissing?(document.forms.addBloodReq.requestId.focus(),!0):document.forms.addBloodReq.onBehalfOf.validity.valueMissing?(document.forms.addBloodReq.onBehalfOf.focus(),!0):a.bloodRequest.bloodGroup?document.forms.addBloodReq.qty.validity.valueMissing?(document.forms.addBloodReq.qty.focus(),!0):a.bloodRequest.onBehalfOfType?document.forms.addBloodReq.requestertype.validity.valueMissing?(document.forms.addBloodReq.requestertype.focus(),!0):!!document.forms.addBloodReq.email.validity.valueMissing&&(document.forms.addBloodReq.email.focus(),!0):(document.forms.addBloodReq.onbehalfoftype.focus(),!0):(document.forms.addBloodReq.bloodGroup.focus(),!0)},a.goToNextStep=function(){if("view"!==c.type){if(!a.bloodRequest.bloodGroup)return void f("alert",g.instant("ENTER_BLOOD_GROUP"));if(!a.bloodRequest.qty)return void f("alert",g.instant("ENTER_QUANTITY"));if(!a.bloodRequest.whenNeeded)return void f("alert",g.instant("ENTER_DATE"));a.step1=!1,a.step2=!0,a.step3=!1,v.addClass("btn-default").removeClass("btn-primary"),t.addClass("btn-default").removeClass("btn-primary"),u.addClass("btn-primary").removeClass("btn-default")}else"view"===c.type&&(a.step1=!1,a.step2=!0,a.step3=!1,v.addClass("btn-default").removeClass("btn-primary"),t.addClass("btn-default").removeClass("btn-primary"),u.addClass("btn-primary").removeClass("btn-default"))},a.goToFirstStep=function(){a.step1=!0,a.step2=!1,a.step3=!1,v.addClass("btn-default").removeClass("btn-primary"),u.addClass("btn-default").removeClass("btn-primary"),t.addClass("btn-primary").removeClass("btn-default")},a.goToPreStep=function(){a.step2=!0,a.step3=!1,v.addClass("btn-default").removeClass("btn-primary"),u.addClass("btn-primary").removeClass("btn-default")},a.goToLastStep=function(){a.step1=!1,a.step2=!1,a.step3=!0,t.addClass("btn-default").removeClass("btn-primary"),u.addClass("btn-default").removeClass("btn-primary"),v.addClass("btn-primary").removeClass("btn-default")},a.getAddressByOrgId=function(b){a.queryObj={},a.queryObj.organizationLocationId=a.addressId;var d=n.getParameterizedUrl("GET_ORG_LOC_ADDRESS_BY_ORG_ID",a.queryObj);d&&o.getData(d,null,function(b){if(b&&b.data){if("edit"==c.type||"view"==c.type){var d=a.addressFilter.addressData.version,e=a.addressFilter.addressData.id;b.data.version=d,b.data.id=e}a.addressFilter.addressData=b.data,a.bloodRequest.bloodRequestAddress.address=b.data.addressLine1}},function(a){})},a.init=function(){if(a.manageOrgLocSpinner=!0,"add"===c.type){/*$scope.field = true;
					manageBloodRequestServices.getRequestId(function (successResponse) {
						if (!utilService.isNullOrEmpty(successResponse)) {
							$scope.bloodRequest.requestId = successResponse;
						}
					},
					function (errorResponse) {});*/
if(a.pageState="add",a.addMode=!0,b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUser&&a.loginDetails.isOrganizationUserMode&&(a.givenAtField=!0),a.orgLocPermission=p.BLOOD_REQUEST_ADD,b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUser&&a.loginDetails.isOrganizationUserMode){var d=b.loggedInUserDetails.organizationId;a.queryObj={},a.queryObj.orgId=d;var e=n.getParameterizedUrl("FIND_ORGLOCBYID",a.queryObj);e&&o.getData(e,null,function(b){b&&b.data&&(a.bloodRequest.toBeGivenAt=b.data[0].orgLocationName,a.loginDetails&&a.loginDetails.isOrganizationUser&&a.loginDetails.isOrganizationUserMode&&(a.bloodRequest.onBehalfOf=b.data[0].orgLocationName,a.addressId=b.data[0].orgLocationId,a.bloodRequest.onBehalfOf===a.loginDetails.displayName?a.bloodRequest.onBehalfOfType="Self":a.bloodRequest.onBehalfOfType="Others"),a.getAddressByOrgId(a.bloodRequest.addressId))},function(a){})}b.loggedInUserDetails&&(a.loginDetails.isOrganizationUserMode?a.getAddressByOrgId(b.loggedInUserDetails.organizationId):(a.queryObj={},a.queryObj.userId=a.loginDetails.id,k.getAddressByUserId(a.queryObj,function(b){b&&(a.addressFilter.addressData=b,a.bloodRequest.bloodRequestAddress.address=b.addressLine1)},function(a){})))}"view"===c.type&&b.loggedInUserDetails&&(a.viewMode=!0,a.pageState="view",b.loggedInUserDetails.isOrganizationUser&&(a.givenAtField=!1)),"edit"===c.type&&b.loggedInUserDetails&&(a.orgLocPermission=p.BLOOD_REQUEST_EDIT,a.loginDetails.OrganizationUser||(a.editMode=!0,a.pageState="edit",b.loggedInUserDetails.isOrganizationUser&&(a.givenAtField=!1))),c.data?(a.bloodRequest=c.data,a.addressFilter.addressData=a.bloodRequest.bloodRequestAddress,a.manageOrgLocSpinner=!1,a.type=c.type):c.id&&l.getBloodRequestById(c.id,function(b){a.manageOrgLocSpinner=!1,a.bloodRequest=b,a.addressFilter.addressData=a.bloodRequest.bloodRequestAddress},function(b){a.manageOrgLocSpinner=!1,a.error=b}),"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||q()},a.init(),a.getOnBehalfOf=function(b){a.queryObj={},a.queryObj.keyword=b;var c=n.getParameterizedUrl("GET_ACCESSIBLE_ORG_LIST_KEYWORD",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},a.saveBloodRequest=function(){var b=a.bloodRequest.bloodRequestAddress.address;return a.bloodRequest.bloodRequestAddress&&delete a.bloodRequest.bloodRequestAddress,a.bloodRequest.bloodRequestAddress={},a.bloodRequest.bloodRequestAddress.address=b,a.bloodRequest.phone=parseInt(a.bloodRequest.phone),a.addressFilter.addressData&&(a.bloodRequest.bloodRequestAddress.id=a.addressFilter.addressData.id,a.bloodRequest.bloodRequestAddress.version=a.addressFilter.addressData.version),a.addressFilter.addressData&&a.addressFilter.addressData.country?(a.bloodRequest.bloodRequestAddress.country=a.addressFilter.addressData.country,a.addressFilter.addressData&&a.addressFilter.addressData.state?(a.bloodRequest.bloodRequestAddress.state=a.addressFilter.addressData.state,a.addressFilter.addressData&&a.addressFilter.addressData.district?(a.bloodRequest.bloodRequestAddress.district=a.addressFilter.addressData.district,a.addressFilter.addressData&&a.addressFilter.addressData.city?(a.bloodRequest.bloodRequestAddress.city=a.addressFilter.addressData.city,a.bloodRequest.onBehalfOf&&a.bloodRequest.onBehalfOf.id&&(a.bloodRequest.onBehalfOf=a.bloodRequest.onBehalfOf.value),a.bloodRequest.toBeGivenAt&&a.bloodRequest.toBeGivenAt.id&&(a.bloodRequest.toBeGivenAt=a.bloodRequest.toBeGivenAt.value),void k.saveBloodRequest(a.bloodRequest,function(a){m.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),d.go("bloodreqlist"))},function(a){c.type="add",m.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})):void f("alert",g.instant("ENTER_VALID_CITY"))):void f("alert",g.instant("ENTER_VALID_DISTRICT"))):void f("alert",g.instant("ENTER_VALID_STATE"))):void f("alert",g.instant("ENTER_VALID_COUNTRY"))},a.callLoginPage=function(){k.callLoginPage()}}]),angular.module("paripal.transactionBloodRequests").controller("bloodreqlistCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","searchBloodRequestServices","commonConstants","utilService","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){
//getting accessabel locations users
function o(){a.isOrganizationUserMode?m.getData(n.getParameterizedUrl("FIND_USER_BY_LOGGED_IN_ORG_USER"),null,function(b){a.allAccessibleOrgUsers=b.data},function(a){f("error",h.instant(a.data.messages[0]))}):a.allAccessibleOrgUsers={}}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.requestviews=[{display:"My request",value:"User"},{display:"Other request",value:"Guest"}],a.statuses=["Pending","Closed"],a.requestertype=["User","Guest"],a.onbehalfoftype=["Self","Others"],a.districts=[1,2,3],a.maxDate=new Date,a.WSOrganizationLocation={},a.allAccessibleOrgUsers={},
// $scope.getAllAccessibleOrgUsers=getAllAccessibleOrgUsers;
a.isOrganizationUserMode=!1,a.addNewBloodReq=function(){d.go("managebloodreq",{type:""})},c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,a.bloodRequest={},a.addressData={},b.loggedInUserDetails&&1==b.loggedInUserDetails.isOrganizationUserMode&&(//individual user mode case
a.isOrganizationUserMode=!0),a.getBloodRequestList=function(){a.bloodRequest.pageNumber=a.currentPage,a.bloodRequest.recordsPerPage=a.itemPerPage,a.addressData&&a.addressData.country&&(a.bloodRequest.country=a.addressData.country.id),a.addressData&&a.addressData.state&&(a.bloodRequest.state=a.addressData.state.id),a.addressData&&a.addressData.city&&(a.bloodRequest.cityId=a.addressData.city.id),a.addressData&&a.addressData.district&&(a.bloodRequest.districtId=a.addressData.district.id),j.getBloodRequestList(a.bloodRequest,null,function(b){b&&(a.bloodRequestList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){l.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},a.manageBloodRequest=function(a,b){j.getBloodRequestById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("managebloodreq",{id:a,type:e,data:f})},function(a){})},a.getBloodRequestList(),
//Server side pagination module
a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getBloodRequestList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getBloodRequestList()},o(),
//check weather the record created by this users organization
a.checkUserAccess=function(c){var d=!1;if(a.isOrganizationUserMode)a.allAccessibleOrgUsers&&!l.isEmpty(a.allAccessibleOrgUsers)&&a.allAccessibleOrgUsers.forEach(function(a){if(a&&c&&c.id&&a.id==c.id)return d=!0});else if(b.loggedInUserDetails&&b.loggedInUserDetails.id&&c&&c.id&&c.id==b.loggedInUserDetails.id)return d=!0;return d},a.otherBloodRequestAction=function(b,c,e){"analysis"==c?d.go("bloodrequestanalysis"):"close-request"==c?j.closeRequest(b,function(b){l.isNullOrEmpty(b.data.successMessage)||(f("success",h.instant(b.data.successMessage)),a.bloodRequestList[e].status="Closed")}):"send-message"==c&&(a.isOrganizationUserMode?d.go("manageAdhocMessage",{type:"add"}):j.sendMessage(b,function(a){}))};
//data table config
var p=k.gridConfigurations;a.options=g.setOptionProperties(p),a.dtColumnDefs=g.setColumnProperties({}),a.clear=function(){
//$scope.WSOrganizationSearchCriteria = {};
a.bloodRequest={},a.addressData={},a.getBloodRequestList()}}]),$(document).ready(function(){/**
             */
var a=$("div.setup-panel div a"),b=$(".setup-content"),c=$(".nextBtn"),d=$(".prevBtn");b.hide();var e=function(a,b,c,d){var e=!0;if(c&&d&&c<=d)return e;for(var f=a.find("input,textarea,md-select"),g=0;g<f.length;g++)if(f[g].classList.contains("ng-invalid")){if($(f[g])[0].attributes.disabled&&"disabled"===$(f[g])[0].attributes.disabled.value)return e;e=!1,$(f[g]).trigger("blur").trigger("blur")}return e};a.click(function(c){c.preventDefault();var d=$(".btn-primary").attr("href").slice(1),f=$("#"+d),g=$($(this).attr("href")),h=$(this),i=g.selector.substr(6),j=d.substr(5),k=e(f,d,i,j);!h.hasClass("disabled")&&k&&(a.removeClass("btn-primary").addClass("btn-default"),h.addClass("btn-primary"),b.hide(),g.show())}),c.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().next().children("a");
//if (isValid)
c.removeAttr("disabled").trigger("click")}),d.click(function(){var a=$(this).closest(".setup-content"),b=a.attr("id"),c=$('div.setup-panel div a[href="#'+b+'"]').parent().prev().children("a");$(".form-group").removeClass("has-error"),c.removeAttr("disabled").trigger("click")}),$("div.setup-panel div a.btn-primary").trigger("click")}),angular.module("paripal.transactionBloodRequests").service("manageBloodRequestServices",["httpService","urlService","$timeout","dateconvertor","utilService","$state",function(a,b,c,d,e,f){"use strict";this.callLoginPage=function(){f.go("login",{callbackState:"managebloodreq"})},this.saveBloodRequest=function(c,e,f){c.dateRequestCreated=d.convertToServerDate(c.dateRequestCreated),c.whenNeeded=d.convertToServerDate(c.whenNeeded);var g="";null!=c.id?g="UPDATE_BLOOD_REQUEST":(c.status="Pending",g="SAVE_BLOOD_REQUEST"),a.postData(b.getUrl(g),c,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},/*this.getRequestId = function (successCallback, errorCallback) {
        	
            httpService.getData(urlService.getUrl('GET_BLOOD_REQ_ID'),null, function (response) {
         	   
         	   if (response && response.data)
         	   {
         		   successCallback(response.data);
         	   }
                 else
                     errorCallback(response);

             }, function (error) {
                 errorCallback(error);
             });

         };*/
this.getAddressByUserId=function(c,d,e){a.getData(b.getParameterizedUrl("USER_ADDRESS_BY_USER_ID",null),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.transactionBloodRequests").service("searchBloodRequestServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){this.getBloodRequestList=function(c,d,e,g){
// if(bloodRequestData.dateFrom && bloodRequestData.till || bloodRequestData.dateFrom){
// 	bloodRequestData.dateFrom = dateconvertor.convertToServerDate(bloodRequestData.dateFrom);
// 	bloodRequestData.till = dateconvertor.convertToServerDate(bloodRequestData.till);
// }
d&&d.country&&(c.country=d.country.id),d&&d.state&&(c.state=d.state.id),d&&d.city&&(cityId=d.city.id),d&&d.district&&(districtId=d.district.id),a.postData(b.getUrl("GET_BLOOD_REQUEST_LIST"),c,function(a){a&&a.data?(f(a.data.data),e(a.data)):g(a)},function(a){g(a)})},this.getBloodRequestById=function(c,d,f){var g={};g.id=c,a.getData(b.getParameterizedUrl("GET_BLOOD_REQUEST_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.dateRequestCreated=e("timestampToDate")(a.data.dateRequestCreated,b),a.data.whenNeeded=e("timestampToDate")(a.data.whenNeeded,b),d(a.data)):f(a)},function(a){f(a)})};var f=function(a){var b="MM/dd/yyyy";angular.forEach(a,function(a,c){a.dateRequestCreated=e("timestampToDate")(a.dateRequestCreated,b),a.whenNeeded=e("timestampToDate")(a.whenNeeded,b)})};this.closeRequest=function(c,d,e){var f={};f.id=c,f.status="Closed",a.postData(b.getParameterizedUrl("UPDATE_BLOOD_REQUEST_STATUS",f),null,function(a){a&&a.data?d(a):e(a)},function(a){e(a)})},this.sendMessage=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("SEND_BLOOD_REQUEST_MESSAGE_BY_ID",f),null,function(a){a&&a.data?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseTreatmentIssueModule").controller("manageTreatmentIssueCtrl",["$scope","$rootScope","$stateParams","$window","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageTreatmentIssueService","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(b){return a.name={},a.name.name=b,a.sideEffectLoad=!0,l.getData(m.getParameterizedUrl("TREATMENT_TYPE",a.name),null,function(b){return a.sideEffectLoad=!1,a.treatmentType=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,g("error",i.instant(b.data.messages[0]))})}function o(){/*if($scope.issue.issue && $scope.issue.issue.id){
            		
            	}else{
            		delete $scope.issue.issue;
            	}
            	if($scope.issue.treatmentType && $scope.issue.treatmentType.id){
            		
            	}*/
k.saveTreatmentIssue(a.issue,function(b){b&&(e.go("searchTreatmentIssue"),a.issue&&a.issue.id?g("success",i.instant("RECORD_UPDATED_SUCCESS")):g("success",i.instant("RECORD_SAVED_SUCCESS")))},function(b){return a.issue&&a.issue.treatmentType&&!a.issue.treatmentType.id?void g("error",i.instant("INVALID_TREATMENT")):a.issue&&a.issue.issue&&!a.issue.issue.id?void g("error",i.instant("INVALID_ISSUE")):a.issue&&a.issue.description&&!a.issue.description?void g("error",i.instant("INVALID_DESCRIPTION")):a.issue&&a.issue.creatingOrgLocId&&!a.issue.creatingOrgLocId.id?void g("error",i.instant("INVALID_LOCATION")):void(utilService.isEmpty(error.data)||utilService.isEmpty(error.data.messages[0])||g("error",i.instant(error.data.messages[0])))})}function p(b){return a.name={},a.name.searchKeyWord=b,a.sideEffectLoad=!0,l.getData(m.getParameterizedUrl("TREATMENT_ISSUE_SERACHKEYWORD",a.name),null,function(b){return a.sideEffectLoad=!1,a.treatmentType=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,g("error",i.instant(b.data.messages[0]))})}a.getTreatmenttype=n,a.saveTreatmentIssue=o,a.getTreatmentIssuetype=p,a.issue={},a.IsVisible=!1,a.editmode=!1,a.cancel=function(){
//$state.go('searchTreatmentIssue');
//utilService.goBackToPrevState();
d.goBackToPrevState()},a.init=function(){"add"===c.type&&(a.IsVisible=!1),a.manageOrgLocSpinner=!0,"edit"===c.type&&(a.issue=c.data,a.IsVisible=!0,a.editmode=!0),"view"===c.type&&(a.issue=c.data,a.viewmode=!0,a.IsVisible=!0,a.pageState="view"),c.data?(a.sideeffect=c.data,a.manageOrgLocSpinner=!1):c.id&&k.getTreatmentById(c.id,function(a){},function(b){a.manageOrgLocSpinner=!1,a.error=b,utilService.isEmpty(error.data)||utilService.isEmpty(error.data.messages[0])||g("error",i.instant(error.data.messages[0]))})},a.init(),a.getCreatedBy=function(c){var d={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_ACCESSIBLE_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return d.keyword=c,d.orgId=b.loggedInUserDetails.organizationId,l.getData(m.getParameterizedUrl("GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD",d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){utilService.isEmpty(a.data)||utilService.isEmpty(a.data.messages[0])||g("error",i.instant(a.data.messages[0]))})}}]),angular.module("paripal.diseaseTreatmentIssueModule").controller("manageUserTreatmentIssueCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserTreatmentIssueService","httpService","urlService","utilService","viewUserTreatmentIssueService","dateconvertor","$filter","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(b){a.queryObj={},a.queryObj.recordId=b;var c=l.getParameterizedUrl("GET_RECORD_ID",a.queryObj);if(c)return k.getData(c,null,function(b){b&&b.data&&(a.treatmentRecd=b.data,
//var dateFormat = 'MM/dd/yyyy';
//$scope.treatmentRecd.dateStart = $filter('timestampToDate')( $scope.treatmentRecd.dateStart, dateFormat);
//$scope.treatmentRecd.dateEnd = $filter('timestampToDate')( $scope.treatmentRecd.dateEnd, dateFormat);
a.treatmentIssue.dateStart=a.treatmentRecd.dateStart,a.treatmentIssue.dateEnd=a.treatmentRecd.dateEnd,a.treatmentIssue.treatmentType=a.treatmentRecd.treatmentType,a.treatmentIssue.noticedOn=a.treatmentRecd.noticedOn,a.treatmentIssue.relatedTreatmentId=a.treatmentRecd.treatmentId)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function s(b,c,d,e){var g={};g.userId=b,g.diseaseId=c,g.varId=d,g.locationId=e;var i=l.getParameterizedUrl("GET_REC_ID_FOR_IMAGE",g);if(i)return k.getData(i,null,function(b){if(b&&b.data)return a.treatmentRecordId=b.data,0==a.treatmentRecordId.length&&f("Alert",h.instant("FOR_THIS_USER_DISEASE_LOCATION_NO_RECORD")),a.treatmentRecordId},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function t(b,c,d){var e={};e.userId=b,e.diseaseId=c,e.locationId=d;var g=l.getParameterizedUrl("GET_LIST_OF_SYM_REC_ID",e);if(g)return k.getData(g,null,function(b){if(b&&b.data)return a.symptomRecordId=b.data,a.symptomRecordId},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function u(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.issueLoad=!0,k.getData(l.getParameterizedUrl("ISSUE_RESOLUTION_STATUS",a.searchKeyWord),null,function(b){return a.issueLoad=!1,a.issueResolutionStatus=angular.fromJson(b.data)},function(b){a.issueLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function v(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function w(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.treatmentIssue&&a.treatmentIssue.disease?(a.searchKeyWord.diseaseId=a.treatmentIssue.disease.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function x(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,k.getData(l.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function y(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.treatmentIssueLoad=!0,k.getData(l.getParameterizedUrl("TREATMENT_ISSUE_SERACHKEYWORD",a.searchKeyWord),null,function(b){return a.treatmentIssueLoad=!1,a.treatmentIssueLoad=angular.fromJson(b.data)},function(b){a.treatmentIssueLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function z(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,k.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function A(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function B(){/*if($stateParams.treatmentRecId){
        		   $state.go('viewUserTreatmentIssue',{'treatmentRecId':$stateParams.treatmentRecId});
        	   }else{
      		   $state.go('viewUserTreatmentIssue');
       	       }*/
m.goBackToPrevState()}function C(){var b={};b=angular.copy(a.treatmentIssue),b.user=a.treatmentIssue.user,b.creatingOrganization=a.treatmentIssue.creatingOrganization,b.disease=a.treatmentIssue.disease,b.diseaseVariant=a.treatmentIssue.diseaseVariant,b.treatmentType=a.treatmentIssue.treatmentType,b.treatmentRecordId=a.treatmentIssue.treatmentRecordId,/*if($scope.treatmentIssue && $scope.treatmentIssue.dateStart){
        	   issue.dateStart=dateconvertor.convertToServerDate($scope.treatmentIssue.dateStart);
        	   } if($scope.treatmentIssue && $scope.treatmentIssue.dateEnd){
        	    issue.dateEnd=dateconvertor.convertToServerDate($scope.treatmentIssue.dateEnd);
        	    }*/
j.save(b,function(b){b&&(/*if($stateParams.treatmentRecId){
                		   $state.go('viewUserTreatmentIssue',{'treatmentRecId':$stateParams.treatmentRecId});
                	   }else{*/
d.go("viewUserTreatmentIssue"),
//}
null!=a.treatmentIssue.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){return a.treatmentIssue&&a.treatmentIssue.user&&!a.treatmentIssue.user.id?void f("error",h.instant("INVALID_USER")):a.treatmentIssue&&a.treatmentIssue.creatingOrganization&&!a.treatmentIssue.creatingOrganization.id?void f("error",h.instant("INVALID_ORGANIZATION")):a.treatmentIssue&&a.treatmentIssue.disease&&!a.treatmentIssue.disease.id?void f("error",h.instant("INVALID_DISEASE")):a.treatmentIssue&&a.treatmentIssue.diseaseVariant&&!a.treatmentIssue.diseaseVariant.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):a.treatmentIssue&&a.treatmentIssue.treatmentIssue&&!a.treatmentIssue.treatmentIssue.id?void f("error",h.instant("INVALID_ISSUE")):a.treatmentIssue&&a.treatmentIssue.issueResolutionStatus&&!a.treatmentIssue.issueResolutionStatus.id?void f("error",h.instant("INVALID_STATUS")):a.treatmentIssue&&a.treatmentIssue.treatmentType&&!a.treatmentIssue.treatmentType.id?void f("error",h.instant("INVALID_TREATMENT")):void(m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(b.data.messages[0])))})}a.treatmentIssue={},a.orgLocPermission=q.USER_TREATMENT_ISSUE_ADD,a.minDate=new Date,a.getTreatmentIssue=y,a.getDisease=v,a.getDiseaseVariant=w,a.getTreatmentTypeId=x,a.getCreatingOrgLoc=z,a.getUserNamesForRoleHistory=A,a.save=C,a.cancel=B,a.getIssueResolutionStatus=u,a.getRecId=s,a.getDetails=r,a.getSymRecId=t,a.initUserTreatmentIssuessById=function(){a.manageOrgLocSpinner=!0,"add"===c.type?(a.orgLocPermission=q.USER_TREATMENT_ISSUE_ADD,a.treatmentIssue&&""==a.treatmentIssue.treatmentRecordId&&a.getDetails(),a.disabled=!1):"view"===c.type?(a.treatmentIssue=c.data,a.pageState="view",a.viewmode=!0,a.disabled=!0,a.expressionDisabled=!0):"edit"===c.type&&c.treatmentRecId&&(a.editmode=!0,a.orgLocPermission=q.USER_TREATMENT_ISSUE_ADD,a.treatmentIssue=c.data,a.pageState="edit",a.disabled=!0),c&&c.id&&("view"===c.type||"edit"===c.type)&&n.getUserTreatmentIssuesById(c.id,function(b){a.treatmentIssue=b,a.disabled=!0,a.getRecId(a.treatmentIssue.user.id,a.treatmentIssue.disease.id,a.treatmentIssue.diseaseVariant.id,a.treatmentIssue.creatingOrganization.id),a.getSymRecId(a.treatmentIssue.user.id,a.treatmentIssue.disease.id,a.treatmentIssue.creatingOrganization.id)},function(b){a.manageOrgLocSpinner=!1,a.error=b,m.isEmpty(b.data)||m.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})},a.initUserTreatmentIssuessById()}]),angular.module("paripal.diseaseTreatmentIssueModule").controller("searchTreatmentIssueCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","commonConstants","searchTreatmentIssueService","httpService","urlService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(a,b){k.getTreatmentById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageTreatmentIssue",{id:a,type:e,data:f})},function(a){f("error",h.instant(a.data.messages[0]))})}function p(b){return a.name={},a.name.name=b,a.sideEffectLoad=!0,l.getData(m.getParameterizedUrl("TREATMENT_TYPE",a.name),null,function(b){return a.sideEffectLoad=!1,a.treatmentType=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,f("error",h.instant(b.data.messages[0]))})}function q(b){return a.name={},a.name.searchKeyWord=b,a.sideEffectLoad=!0,l.getData(m.getParameterizedUrl("TREATMENT_ISSUE_SERACHKEYWORD",a.name),null,function(b){return a.sideEffectLoad=!1,a.treatmentType=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,f("error",h.instant(b.data.messages[0]))})}
//getting accessabel system locations
function r(){l.getData(m.getParameterizedUrl("FIND_ACCESSIBLE_SYSTEM_LOCATION"),null,function(b){
//httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION'), null, function (response) {
a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!n.isEmpty(a.accessabelSystemLocation)&&(a.whetherSystemUser=!0)},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function s(b,c){var d={};d.id=b,k.toggleChangeStatus(d,function(b){b&&(a.treatMentIssueList[c].whetherActive=!a.treatMentIssueList[c].whetherActive,f("success",h.instant("RECORD_UPDATED_SUCCESS")))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.treatMentIssueList={},a.searchIssue={},a.crudTreatmentIssue=o,a.getTreatmenttype=p,a.getTreatmentIssuetype=q,a.getAccessabelSystemLocation=r,a.toggleChangeStatus=s,a.whetherSystemUser=!1,a.getTreatMentIssueList=function(){var b=(a.searchIssue,{});a.searchIssue.treatmentType&&a.searchIssue.treatmentType&&(b.treatmentType=a.searchIssue.treatmentType.id),/*if($scope.searchIssue.issue!=null){
 					treatMentIssueList.issue=$scope.searchIssue.issue;
 				}*/
null!=a.searchIssue.location&&(b.location=a.searchIssue.location.id),a.searchIssue.issue&&a.searchIssue.issue&&(b.issue=a.searchIssue.issue.id),c.treatmentTypeId&&(b.treatmentType=c.treatmentTypeId,a.searchIssue.treatmentType=c.treatmentType),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,k.getTreatMentIssueList(b,function(b){b&&(a.treatMentIssueList=b.data,0==a.treatMentIssueList.length&&(a.girdView=!0),a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getTreatMentIssueList(),a.addNewTreatmentIssue=function(){d.go("manageTreatmentIssue",{type:""})};
//data table config
var t=j.gridConfigurations;a.options=g.setOptionProperties(t),a.dtColumnDefs=g.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getTreatMentIssueList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getTreatMentIssueList()},a.clear=function(){a.searchIssue={},a.getTreatMentIssueList(),a.girdView=!1},a.getCreatedBy=function(c){var d={};
//userObj.searchKeyWord = value;
return d.keyword=c,d.orgId=b.loggedInUserDetails.organizationId,l.getData(m.getParameterizedUrl("GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD",d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},r(),a.checkOrganizationLocationAccess=function(b){var c=!1;return a.accessabelSystemLocation&&!n.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){a&&b&&a.id==b&&(c=!0)}),c}}]),angular.module("paripal.diseaseTreatmentIssueModule").controller("viewUserTreatmentIssueCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","viewUserTreatmentIssueService","httpService","urlService","utilService","commonConstants","viewUserTreatmentService","viewUserSymptomsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(a){a&&a.treatmentRecordId&&a.treatmentRecordId.id?d.go("manageUserTreatment",{treatmentRecId:a.treatmentRecordId.id,type:"view"}):f("error",h.instant("RECORD_NOT_FOUND"))}function r(a){a&&a.symptomRecordId&&a.symptomRecordId.id?d.go("manageUserSymptoms",{symptomId:a.symptomRecordId.id,type:"view"}):f("error",h.instant("SYMPTOM_NOT_ASSOCIATED"))}function s(){d.go("manageUserTreatmentIssue",{treatmentRecId:c.treatmentRecId,type:"add"})}
//check access for managing data	
function t(b){var c=!1;return a.accessibleSubscriberLocation&&!m.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}function u(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.diseaseId=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function v(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.diseaseId?(a.searchKeyWord.diseaseId=a.filter.diseaseId.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function w(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function x(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.filter.userId&&a.filter.userId.id&&a.fetchRecords()}function y(b){a.pageNumber=1,a.itemPerPage=b,a.filter.userId&&a.filter.userId.id&&a.fetchRecords()}function z(b,e){j.getUserTreatmentIssuesById(b,function(f){a.userTreatment=f;var g;g=e?"edit":"view",d.go("manageUserTreatmentIssue",{id:b,treatmentRecId:c.treatmentRecId,type:g,data:a.userTreatment})},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.disable=!0,a.fromMenu=!0,a.filter={},a.checkOrganizationLocationAccess=t,a.addNew=s,a.getDiseaseVariant=v,a.getUserNamesForRoleHistory=w,a.getDisease=u,a.crud=z,a.pageChanged=x,a.setMaxRecords=y,a.treatment=q,a.userSymptoms=r,a.loginDetails=b.loggedInUserDetails,
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),a.clear=function(){d.go("viewUserTreatmentIssue"),a.filter={},a.disable=!1,a.treatmentissues=[]},b.loggedInUserDetails.isOrganizationUserMode||(a.filter.userId={},a.filter.userId.id=b.loggedInUserDetails.id,a.filter.userId.value=b.loggedInUserDetails.displayName),a.fetchRecords=function(){if(a.filter&&a.filter.userId&&!a.filter.userId.id)return void f("error",h.instant("INVALID_USER"));if(a.filter&&a.filter.diseaseId&&!a.filter.diseaseId.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.filter&&a.filter.diseaseVariantId&&!a.filter.diseaseVariantId.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));var b=(a.filter,{});a.filter.diseaseVariantId&&a.filter.diseaseVariantId.id&&(b.diseaseVariantId=a.filter.diseaseVariantId.id),a.filter.diseaseId&&a.filter.diseaseId.id&&(b.diseaseId=a.filter.diseaseId.id),a.filter.userId&&a.filter.userId.id&&(b.userId=a.filter.userId.id),c.treatmentRecId&&(b.treatmentRecordId=c.treatmentRecId,a.notFromMenu=!0,a.fromMenu=!1),/*if(!$rootScope.loggedInUserDetails.isOrganizationUserMode){
         			varFilter.userId = $rootScope.loggedInUserDetails.id;
         			$scope.filter.userId=$rootScope.loggedInUserDetails.displayName;
         		}*/
b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,j.fetchRecords(b,function(b){b&&(a.treatmentissues=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))})},b.loggedInUserDetails.isOrganizationUserMode||a.fetchRecords(),c.treatmentRecId&&a.fetchRecords();
//data table config
var A=n.gridConfigurations;a.options=g.setOptionProperties(A),a.dtColumnDefs=g.setColumnProperties({}),
//get subscribed accessible location   
a.getAccessibleSubscriberLocation=function(b){return k.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.inActivate=function(b,c){j.inActivate(b,function(b){b&&(a.treatmentissues.splice(c,1),d.go("viewUserTreatmentIssue"),f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")),a.fetchRecords())},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_DELETED_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})},a.filter.userId&&a.filter.userId.id&&a.fetchRecords()}]),angular.module("paripal.diseaseTreatmentIssueModule").service("manageTreatmentIssueService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.saveTreatmentIssue=function(c,d,e){var f="";f=null!=c.id?"UPDATE_TREATMENT_ISSUE":"SAVE_TREATMENT_ISSUE",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getTreatmentById=function(c,d,e){/*var sideEffect ={};
     		sideEffect.sideEffectId = id;
     		var dateFormat = 'MM/dd/yyyy';*/
a.getData(b.getParameterizedUrl("TREATMENT_ISSUE_GET_BY_ID",c),null,function(a){a&&a.data?/*response.data.date = $filter('timestampToDate')(response.data.date, dateFormat);*/
d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseTreatmentIssueModule").service("manageUserTreatmentIssueService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.save=function(c,d,e){/*if(treatmentIssue.dateStart && treatmentIssue.dateStart!=""){
        	treatmentIssue.dateStart = dateconvertor.convertToServerDate(treatmentIssue.dateStart);
        	} if(treatmentIssue.dateEnd && treatmentIssue.dateEnd!=""){
        	treatmentIssue.dateEnd = dateconvertor.convertToServerDate(treatmentIssue.dateEnd);
        	} if(treatmentIssue.noticedOn && treatmentIssue.noticedOn!=""){
        		treatmentIssue.noticedOn = dateconvertor.convertToServerDate(treatmentIssue.noticedOn);
        	} if(treatmentIssue.updatedToProfessionalOn && treatmentIssue.updatedToProfessionalOn!="" ){
        	treatmentIssue.updatedToProfessionalOn = dateconvertor.convertToServerDate(treatmentIssue.updatedToProfessionalOn);
        	}*/
var f="SAVE_USER_TREATMENT_ISSUES";null!=c.id&&(f="UPDATE_USER_TREATMENT_ISSUES"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseTreatmentIssueModule").service("searchTreatmentIssueService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getTreatMentIssueList=function(b,d,e){a.postData(c.getUrl("SEARCH_TREATMENT_ISSUE_FINDBY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getTreatmentById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("TREATMENT_ISSUE_GET_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.toggleChangeStatus=function(b,d,e){a.getData(c.getParameterizedUrl("TREATMENT_ISSUE_CHANGE_STATUS",b),null,function(a){a?d(a):e(a)},function(a){e(a)})}}]),angular.module("paripal.diseaseTreatmentIssueModule").service("viewUserTreatmentIssueService",["httpService","$filter","urlService","dateconvertor","utilService","$timeout",function(a,b,c,d,e,f){"use strict";this.fetchRecords=function(b,d,e){/*if(filter.dateStart){
        		filter.dateStart = dateconvertor.convertToServerDate(filter.dateStart);
    		}*/
a.postData(c.getUrl("GET_USER_TREATMENT_ISSUES_BY_CRITERIA"),b,function(a){a&&a.data?(g(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.getUserTreatmentIssuesById=function(d,e,f){var g={};g.id=d,a.getData(c.getParameterizedUrl("GET_USER_TREATMENT_ISSUES_BY_ID",g),null,function(a){var c="MM/dd/yyyy";a&&a.data?(a.data.dateStart&&""!=a.data.dateStart&&(a.data.dateStart=b("timestampToDate")(a.data.dateStart,c)),a.data.dateEnd&&""!=a.data.dateEnd&&(a.data.dateEnd=b("timestampToDate")(a.data.dateEnd,c)),a.data.noticedOn&&""!=a.data.noticedOn&&(a.data.noticedOn=b("timestampToDate")(a.data.noticedOn,c)),a.data.updatedToProfessionalOn&&""!=a.data.updatedToProfessionalOn&&(a.data.updatedToProfessionalOn=b("timestampToDate")(a.data.updatedToProfessionalOn,c)),e(a.data)):f(a)},function(a){f(a)})};var g=function(a){var c="MM/dd/yyyy";angular.forEach(a,function(a,d){a.dateStart=b("timestampToDate")(a.dateStart,c),a.dateEnd=b("timestampToDate")(a.dateEnd,c)})};this.inActivate=function(b,d,e){var f={};f.id=b,a.deleteData(c.getParameterizedUrl("DELETE_USER_TREATMENT_ISSUES",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userTreatmentImageModule").controller("manageUserTreatmentImagesCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserTreatmentImagesService","httpService","urlService","utilService","fileOperations","commonConstants","viewUserTreatmentImagesService","dateconvertor","$filter","featurePrivilegeConstants","manageAttachmentService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(b){a.queryObj={},a.queryObj.recordId=b;var c=l.getParameterizedUrl("GET_RECORD_ID",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data){a.treatmentRecd=b.data;
//$scope.treatmentRecd.dateStart = $filter('timestampToDate')( $scope.treatmentRecd.dateStart, dateFormat);
//$scope.treatmentRecd.dateEnd = $filter('timestampToDate')( $scope.treatmentRecd.dateEnd, dateFormat);
a.treatmentImage.dateStart=a.treatmentRecd.dateStart,a.treatmentImage.dateEnd=a.treatmentRecd.dateEnd,a.treatmentImage.treatmentType=a.treatmentRecd.treatmentType}},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function v(b,c,d,e){var g={};g.userId=b,g.diseaseId=c,g.varId=d,g.locationId=e;var i=l.getParameterizedUrl("GET_REC_ID_FOR_IMAGE",g);if(i)return k.getData(i,null,function(b){if(b&&b.data)return a.treatmentRecordId=b.data,0==a.treatmentRecordId.length&&f("Alert",h.instant("FOR_THIS_USER_DISEASE_LOCATION_NO_RECORD")),a.treatmentRecordId},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}
//get subscribed accessible location by keyword 
function w(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,k.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function x(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.imageLoad=!0,k.getData(l.getParameterizedUrl("IMAGE_TYPE",a.searchKeyWord),null,function(b){return a.imageLoad=!1,a.imageType=angular.fromJson(b.data)},function(b){a.imageLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function y(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,k.getData(l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function z(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.treatmentImage&&a.treatmentImage.disease?(a.searchKeyWord.diseaseId=a.treatmentImage.disease.id,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function A(b){return a.searchKeyWord={},a.searchKeyWord.name=b,a.treatmentTypeLoad=!0,k.getData(l.getParameterizedUrl("TREATMENT_TYPE",a.searchKeyWord),null,function(b){return a.treatmentTypeLoad=!1,a.treatmentTypeLoad=angular.fromJson(b.data)},function(b){a.treatmentTypeLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SERACH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function B(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function C(){var b={};b.code="BEFORE_AFTER_TREATMENT",k.getData(l.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.beforeAfterTreatment=b.data)},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function D(){/*if($stateParams.treatmentRecId){
        		  $state.go('viewUserTreatmentImages',{'treatmentRecId':$stateParams.treatmentRecId});
        	   } else{
        		   $state.go('viewUserTreatmentImages');
        	   }*/
m.goBackToPrevState()}function E(b,c,e){var g=new Object;g.file=c.fileToBeUpload,g.orgLocId=a.treatmentImage.creatingOrganization.id,g.docType=o.documentTypes.treatment,g.docSubType=o.documentSubTypes.treatmentImage,g.isThumbnailRequired=!1,m.isNullOrEmpty(e.response)||(g.resourceId=e.response),n.uploadFile(g,function(b){m.isNullOrEmpty(b)||(a.treatmentImage.documentId=e.response,j.save(a.treatmentImage,function(a){a&&(f("success",a.successMessage),d.go("viewUserTreatmentImages"))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},function(a){m.isNullOrEmpty(e.response)||p.inActivate(e.response,function(a){},function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))})})}function F(b,c){if(!m.isEmpty(c)){var d=new Object;d.fileName=c.imageFile,d.orgLocId=c.creatingOrganization.id,d.resourceId=c.documentId,d.docType=o.documentTypes.treatment,d.docSubType=o.documentSubTypes.treatmentImage,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable,n.viewFileContent(d,function(a){},function(a){})}}function G(){var b={};b=angular.copy(a.treatmentImage),b.user=a.treatmentImage.user,b.creatingOrganization=a.treatmentImage.creatingOrganization,b.disease=a.treatmentImage.disease,b.diseaseVariant=a.treatmentImage.diseaseVariant,b.treatmentType=a.treatmentImage.treatmentType,b.treatmentRecordId=a.treatmentImage.treatmentRecordId,/*if($scope.treatmentImage && $scope.treatmentImage.dateStart){
            		image.dateStart=dateconvertor.convertToServerDate($scope.treatmentImage.dateStart);
                	} if($scope.treatmentImage && $scope.treatmentImage.dateEnd){
                	 image.dateEnd=dateconvertor.convertToServerDate($scope.treatmentImage.dateEnd);
                	}*/
!m.isEmpty(a.treatmentImage)&&a.treatmentImageFile&&a.treatmentImageFile.fileToBeUpload&&(a.treatmentImage.imageFile=a.treatmentImageFile.fileToBeUpload.name),a.treatmentImageFile&&a.treatmentImageFile.fileToBeUpload?(a.documentUpload.document.fileName=a.treatmentImageFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.treatmentImageFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.treatmentImage.creatingOrganization.id,a.documentUpload.document.documentType={subType:o.documentSubTypes.treatmentImage},"add"!=c.type&&(a.documentUpload.document.id=a.treatmentImage.documentId),t.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.treatmentImageFile.fileToBeUpload&&(a.treatmentImageFile&&a.treatmentImageFile.fileToBeUpload&&a.treatmentImageFile.fileToBeUpload.name&&a.uploadFile(a.treatmentImage,a.treatmentImageFile,b),a.treatmentImage&&a.treatmentImage.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):j.save(b,function(b){b&&(null!=a.treatmentImage.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")),d.go("viewUserTreatmentImages"))},function(b){return a.treatmentImage&&a.treatmentImage.user&&!a.treatmentImage.user.id?void f("error",h.instant("INVALID_USER")):a.treatmentImage&&a.treatmentImage.creatingOrganization&&!a.treatmentImage.creatingOrganization.id?void f("error",h.instant("INVALID_ORGANIZATION")):a.treatmentImage&&a.treatmentImage.disease&&!a.treatmentImage.disease.id?void f("error",h.instant("INVALID_DISEASE")):a.treatmentImage&&a.treatmentImage.diseaseVariant&&!a.treatmentImage.diseaseVariant.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):a.treatmentImage&&a.treatmentImage.imageType&&!a.treatmentImage.imageType.id?void f("error",h.instant("INVALID_IMAGE_TYPE")):a.treatmentImage&&a.treatmentImage.treatmentType&&!a.treatmentImage.treatmentType.id?void f("error",h.instant("INVALID_TREATMENT")):a.treatmentImage&&!a.treatmentImage.imageFile?void f("error",h.instant("INVALID_FILE")):void(m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(b.data.messages[0])))})}a.treatmentImage={},a.orgLocPermission=s.USER_TREATMENT_IMAGE_ADD,a.minDate=new Date,a.documentUpload={},a.documentUpload.document={},a.getDisease=y,a.getDiseaseVariant=z,a.getTreatmentTypeId=A,a.getCreatingOrgLoc=w,a.getUserNamesForRoleHistory=B,a.save=G,a.cancel=D,a.getBeforeAfter=C,a.viewPrintFile=F,a.uploadFile=E,a.getImageTypeId=x,a.getRecId=v,a.getDetails=u,a.IsVisible=!1,a.initUserTreatmentImageById=function(){"add"===c.type?(a.orgLocPermission=s.USER_TREATMENT_IMAGE_ADD,a.treatmentImage&&""==a.treatmentImage.treatmentRecordId&&a.getDetails()):"view"===c.type?(a.treatmentImage=c.data,a.treatmentImage.user=c.data.user.value,a.pageState="view",a.viewmode=!0,a.IsVisible=!0,a.disabled=!0,a.expressionDisabled=!0):"edit"===c.type&&(a.orgLocPermission=s.USER_TREATMENT_IMAGE_ADD,a.treatmentImage=c.data,a.pageState="edit",a.editmode=!0,a.IsVisible=!0,a.disabled=!0),c&&c.id&&("view"===c.type||"edit"===c.type)&&p.getUserTreatmentImagesById(c.id,function(b){a.treatmentImage=b;var c={};a.disabled=!0,c.userId=a.treatmentImage.user.id,c.diseaseId=a.treatmentImage.disease.id,c.locationId=a.treatmentImage.creatingOrganization.id,a.getRecId(a.treatmentImage.user.id,a.treatmentImage.disease.id,a.treatmentImage.diseaseVariant.id,a.treatmentImage.creatingOrganization.id),a.treatmentRecd=angular.copy(a.treatmentImage)},function(b){a.manageOrgLocSpinner=!1,a.error=b,m.isEmpty(b.data)||m.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})},a.initUserTreatmentImageById(),a.getBeforeAfter()}]),angular.module("paripal.userTreatmentImageModule").controller("viewUserTreatmentImagesCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","commonConstants","viewUserTreatmentImagesService","httpService","urlService","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){d.go("manageUserTreatmentImages",{treatmentRecId:c.treatmentRecId,type:"add"})}function p(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,l.getData(m.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.diseaseId=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}
//check access for managing data	
function q(b){var c=!1;return a.accessibleSubscriberLocation&&!n.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}function r(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.filter&&a.filter.diseaseId?(a.searchKeyWord.diseaseId=a.filter.diseaseId.id,a.diseaseVariantLoad=!0,l.getData(m.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function s(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function t(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.filter.userId&&a.filter.userId.id&&a.fetchRecords()}function u(b){a.pageNumber=1,a.itemPerPage=b,a.filter.userId&&a.filter.userId.id&&a.fetchRecords()}function v(b,e){k.getUserTreatmentImagesById(b,function(f){a.treatmentImage=f;var g;g=e?"edit":"view",d.go("manageUserTreatmentImages",{id:b,treatmentRecId:c.treatmentRecId,type:g,data:a.treatmentImage})},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.disable=!0,a.fromMenu=!0,a.filter={},a.addNew=o,a.getDiseaseVariant=r,a.getUserNamesForRoleHistory=s,a.getDisease=p,a.crud=v,a.pageChanged=t,a.setMaxRecords=u,a.hasAccessibleSubscriberLocation=!1,a.accessibleSubscriberLocation={},a.checkOrganizationLocationAccess=q,a.loginDetails=b.loggedInUserDetails,
//for individual sub
(a.loginDetails.whetherSubscriber=!0)&&(a.indsub=!0),a.clear=function(){d.go("viewUserTreatmentImages"),a.filter={},a.disable=!1,a.images=[]},b.loggedInUserDetails.isOrganizationUserMode||(a.filter.userId={},a.filter.userId.id=b.loggedInUserDetails.id,a.filter.userId.value=b.loggedInUserDetails.displayName),a.fetchRecords=function(){if(a.filter&&a.filter.userId&&!a.filter.userId.id)return void f("error",h.instant("INVALID_USER"));if(a.filter&&a.filter.diseaseId&&!a.filter.diseaseId.id)return void f("error",h.instant("INVALID_DISEASE"));if(a.filter&&a.filter.diseaseVariantId&&!a.filter.diseaseVariantId.id)return void f("error",h.instant("INVALID_DISEASE_VARIANT"));var b=(a.filter,{});a.filter.diseaseVariantId&&a.filter.diseaseVariantId.id&&(b.diseaseVariantId=a.filter.diseaseVariantId.id),a.filter.diseaseId&&a.filter.diseaseId.id&&(b.diseaseId=a.filter.diseaseId.id),a.filter.userId&&a.filter.userId.id&&(b.userId=a.filter.userId.id),c.treatmentRecId&&(b.treatmentRecordId=c.treatmentRecId,a.notFromMenu=!0,a.fromMenu=!1),/*if(!$rootScope.loggedInUserDetails.isOrganizationUserMode){
         			varFilter.userId = $rootScope.loggedInUserDetails.id;
         			$scope.filter.userId=$rootScope.loggedInUserDetails.displayName;
         		}*/
b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,k.fetchRecords(b,function(b){b&&(a.images=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))})},b.loggedInUserDetails.isOrganizationUserMode||a.fetchRecords(),c.treatmentRecId&&a.fetchRecords();
//data table config
var w=j.gridConfigurations;a.options=g.setOptionProperties(w),a.dtColumnDefs=g.setColumnProperties({}),
//get subscribed accessible location   
a.getAccessibleSubscriberLocation=function(b){return l.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.inActivate=function(b,c){k.inActivate(b,function(b){b&&(a.images.splice(c,1),d.go("viewUserTreatmentImages"),f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")),a.fetchRecords())},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_DELETED_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})},a.filter.userId&&a.filter.userId.id&&a.fetchRecords()}]),angular.module("paripal.userTreatmentImageModule").service("manageUserTreatmentImagesService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.save=function(c,d,e){/*if(treatmentImage.dateStart && treatmentImage.dateStart!=""){
        		treatmentImage.dateStart = dateconvertor.convertToServerDate(treatmentImage.dateStart);
        	} if(treatmentImage.dateEnd && treatmentImage.dateEnd!=""){
        		treatmentImage.dateEnd = dateconvertor.convertToServerDate(treatmentImage.dateEnd);
        	} if(treatmentImage.date && treatmentImage.date!=""){
        		treatmentImage.date = dateconvertor.convertToServerDate(treatmentImage.date);
        	}*/
var f="SAVE_USER_TREATMENT_IMAGE";null!=c.id&&(f="UPDATE_USER_TREATMENT_IMAGE"),a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userTreatmentImageModule").service("viewUserTreatmentImagesService",["httpService","$filter","urlService","dateconvertor","utilService","$timeout",function(a,b,c,d,e,f){"use strict";this.fetchRecords=function(b,d,e){/*if(filter.date){
        		filter.date = dateconvertor.convertToServerDate(filter.date);
    		}*/
a.postData(c.getUrl("GET_USER_TREATMENT_IMAGE_BY_CRITERIA"),b,function(a){a&&a.data?(g(a.data.data),d(a.data)):e(a)},function(a){e(a)})},this.getUserTreatmentImagesById=function(d,e,f){var g={};g.id=d,a.getData(c.getParameterizedUrl("GET_USER_TREATMENT_IMAGE_BY_ID",g),null,function(a){var c="MM/dd/yyyy";a&&a.data?(a.data.dateStart&&""!=a.data.dateStart&&(a.data.dateStart=b("timestampToDate")(a.data.dateStart,c)),a.data.dateEnd&&""!=a.data.dateEnd&&(a.data.dateEnd=b("timestampToDate")(a.data.dateEnd,c)),a.data.date&&""!=a.data.date&&(a.data.date=b("timestampToDate")(a.data.date,c)),e(a.data)):f(a)},function(a){f(a)})};var g=function(a){var c="MM/dd/yyyy";angular.forEach(a,function(a,d){a.dateStart=b("timestampToDate")(a.dateStart,c),a.dateEnd=b("timestampToDate")(a.dateEnd,c),a.date=b("timestampToDate")(a.date,c)})};this.inActivate=function(b,d,e){var f={};f.id=b,a.deleteData(c.getParameterizedUrl("DELETE_USER_TREATMENT_IMAGE",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.treatmentRecordModule").controller("TreatmentRecordCtrl",["$rootScope","$scope","utilService",function(a,b,c){"use strict";if(!c.isNullOrEmpty(a.dashboardMenu)){b.parentMenus=a.dashboardMenu.children;for(var d=0;d<=b.parentMenus.length;d++)null!=b.parentMenus[d]&&("TREATMENT_RECORD"!=b.parentMenus[d].name&&"TREATMENT_HISTORY"!=b.parentMenus[d].name||(b.childMenus=b.parentMenus[d].children))}}]),angular.module("paripal.familyHistoryModule").controller("manageUserFamilyHistoryCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserFamilyHistoryService","featurePrivilegeConstants","utilService","httpService","urlService","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(){a.history.userId&&a.history.userId.id&&(a.history.userId.id=a.history.userId.id,a.history.userId.value=a.history.userId.displayName,delete a.history.userId.displayName),j.saveUserFamilyHistory(a.history,function(b){b&&(d.go("searchUserFamilyHistory"),a.history&&a.history.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){return a.history&&a.history.userId&&!a.history.userId.id?void f("error",h.instant("INVALID_USER")):a.history&&a.history.diseaseId&&!a.history.diseaseId.id?void f("error",h.instant("INVALID_DISEASE")):a.history&&a.history.diseaseVariantId&&!a.history.diseaseVariantId.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):a.history&&a.history.diseaseVariantId&&!a.history.diseaseVariantId.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):a.history&&a.history.relationshipId&&!a.history.relationshipId.id?void f("error",h.instant("INVALID_RELATION")):a.history&&a.history.throughId&&!a.history.throughId.id?void f("error",h.instant("INVALID_THROUGH")):a.history&&a.history.creatingOrgnId&&!a.history.creatingOrgnId.id?void f("error",h.instant("INVALID_LOCATION")):void(l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0])))})}function q(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,m.getData(n.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&r()},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function r(){a.history=c.data,a.history.userId=c.data.userId.value,a.pageState="view",a.viewmode=!0,j.getUserFamilyById(c.id,function(a){},function(b){a.manageOrgLocSpinner=!1,a.error=b,l.isEmpty(b.data)||l.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}
//    function getUserNamesForRoleHistory(viewValue) {
//        var userData = {};
//        userData.searchString = viewValue;
//        $scope.userNameAutoCmpLoading = true;
//        //return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_BY_SEACRH_KEY', userData),
//        return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_LIST_BY_SEACRH_KEY', userData),
//                null, function (response) {
//            $scope.userNameAutoCmpLoading = false;
//            return $scope.userId = response.data;
//        }, function (error) {
//            $scope.userNameAutoCmpLoading = false;
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//         notify("Alert", $translate.instant(error.data.messages[0]));
// }
//        });
//    }
function s(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function t(b){a.diseaseId=b}function u(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.diseaseId,a.diseaseVariantLoad=!0,m.getData(n.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}a.saveUserFamilyHistory=p,a.getDiseaseVariant=u,a.getDiseaseId=t,a.history={},a.diseaseId={},a.orgLocPermission=k.USER_FAMILY_HISTORY_ADD,a.getUserNamesForRoleHistory=s,a.field=!1,a.loginDetails=b.loggedInUserDetails,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=q,a.allowAccessOTP=r,
//for individual user subscription
//       $scope.checkWhetherSubscriber = function(){
//                  if($scope.loginDetails && $scope.loginDetails.whetherSubscriber == true ){
//                      getSystemOrg();
//                  }else{
//                      $scope.getCreatedBy();
//                  }
//              }
a.getSystemOrg=function(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,m.getData(n.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.history.creatingOrgnId=b.data[0],a.history.creatingOrgnId},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.whethersub=!0,a.history.userId={},a.history.userId.value=a.loginDetails.displayName,a.history.userId.id=a.loginDetails.id,a.getSystemOrg()),a.init=function(){if(a.manageOrgLocSpinner=!0,"edit"===c.type&&b.loggedInUserDetails)a.orgLocPermission=k.USER_FAMILY_HISTORY_EDIT,a.history=c.data,a.history.userId=c.data.userId.value,a.editmode=!0;else if("view"===c.type&&b.loggedInUserDetails)a.history=c.data,a.history.userId=c.data.userId.value,a.pageState="view",a.viewmode=!0;else if("add"===c.type){a.orgLocPermission=k.USER_FAMILY_HISTORY_ADD;var d=o.getDefaultOrgLocation();l.isFieldEmpty(d)||(a.history.creatingOrgnId=d.orgLoc)}else c.id&&j.getUserFamilyById(c.id,function(a){},function(b){a.manageOrgLocSpinner=!1,a.error=b,l.isEmpty(b.data)||l.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))});"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||q()},a.init(),a.cancel=function(){
// $state.go("searchUserFamilyHistory");
l.goBackToPrevState()},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=n.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},
// $scope.getRelationship = function (diseaseValue) {
//     $scope.queryObj = {};
//     $scope.queryObj.searchKeyWord = diseaseValue;
//     var url = urlService.getParameterizedUrl('GET_RELATIONSHIP_BY_KEYWORD', $scope.queryObj);
//     if (url) {
//         return httpService.getData(url, null, function (response) {
//             if (response && response.data) {
//                 $scope.diseaseList = response.data;
//                 return $scope.diseaseList;
//             }
//         }, function (error) {
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                 notify("error", $translate.instant(error.data.messages[0]));
//             }
//         });
//     }
// };
a.getRelationship=function(){var b=n.getUrl("GET_RELATIONSHIP_BY_LIST");b&&m.getData(b,null,function(b){b&&b.data&&(a.relationshipList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getRelationship(),a.getThrough=function(){var b=n.getUrl("GET_TROUGH_BY_LIST");b&&m.getData(b,null,function(b){b&&b.data&&(a.throughList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getThrough(),
// $scope.getThrough = function (diseaseValue) {
//     $scope.queryObj = {};
//     $scope.queryObj.searchKeyWord = diseaseValue;
//     var url = urlService.getParameterizedUrl('GET_TROUGH_BY_KEYWORD', $scope.queryObj);
//     if (url) {
//         return httpService.getData(url, null, function (response) {
//             if (response && response.data) {
//                 $scope.diseaseList = response.data;
//                 return $scope.diseaseList;
//             }
//         }, function (error) {
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                 notify("error", $translate.instant(error.data.messages[0]));
//             }
//         });
//     }
// };
a.getCreatedBy=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var c={};return c.keyword=b,m.getData(n.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}var c={};return c.keyword=b,m.getData(n.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}}]),angular.module("paripal.familyHistoryModule").controller("manageUserFamilyHistoryPopupCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserFamilyHistoryService","featurePrivilegeConstants","utilService","httpService","urlService","baseService","$mdDialog","familyHistory","mode","appointmentRef",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){a.history.userId&&a.history.userId.id&&(a.history.userId.id=a.history.userId.id,a.history.userId.value=a.history.userId.displayName,delete a.history.userId.displayName),j.saveUserFamilyHistory(a.history,function(a){a&&p.cancel(a)},function(a){})}function u(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,m.getData(n.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&v()},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function v(){a.history=c.data,a.history.userId=c.data.userId.value,a.pageState="view",a.viewmode=!0,j.getUserFamilyById(c.id,function(a){},function(b){a.manageOrgLocSpinner=!1,a.error=b,l.isEmpty(b.data)||l.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}function w(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function x(b){a.diseaseId=b}function y(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.diseaseId,a.diseaseVariantLoad=!0,m.getData(n.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}a.saveUserFamilyHistory=t,a.getDiseaseVariant=y,a.getDiseaseId=x,a.history={},a.diseaseId={},a.orgLocPermission=k.USER_FAMILY_HISTORY_ADD,a.getUserNamesForRoleHistory=w,a.field=!1,a.loginDetails=b.loggedInUserDetails,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=u,a.allowAccessOTP=v,a.getRelationship=function(){var b=n.getUrl("GET_RELATIONSHIP_BY_LIST");b&&m.getData(b,null,function(b){b&&b.data&&(a.relationshipList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getRelationship(),a.getThrough=function(){var b=n.getUrl("GET_TROUGH_BY_LIST");b&&m.getData(b,null,function(b){b&&b.data&&(a.throughList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getThrough(),a.getSystemOrg=function(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,m.getData(n.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.history.creatingOrgnId=b.data[0],a.history.creatingOrgnId},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.whethersub=!0,a.history.userId={},a.history.userId.value=a.loginDetails.displayName,a.history.userId.id=a.loginDetails.id,a.getSystemOrg()),a.init=function(){a.manageOrgLocSpinner=!0,q&&(a.history=q),r&&"view"==r.mode&&(a.viewmode=!0),r&&"edit"==r.mode&&(a.editmode=!0),s&&(a.appointmentRef=s,a.isFromAppointment=!0,a.history?a.history.userId={id:a.appointmentRef.patientId,value:a.appointmentRef.patientName}:(a.history={},a.history.userId={id:a.appointmentRef.patientId,value:a.appointmentRef.patientName}),a.history.creatingOrgnId={id:a.appointmentRef.organizationLocationId,value:a.appointmentRef.locationName})},a.init(),a.cancel=function(){p.cancel()},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=n.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getRelationship=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=n.getParameterizedUrl("GET_RELATIONSHIP_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getThrough=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=n.getParameterizedUrl("GET_TROUGH_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getCreatedBy=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var c={};return c.keyword=b,m.getData(n.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}var c={};return c.keyword=b,m.getData(n.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}}]),angular.module("paripal.familyHistoryModule").controller("searchUserFamilyHistoryCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","searchUserFamilyHistoryService","utilService","httpService","urlService","commonConstants","featurePrivilegeConstants","baseService","$mdDialog","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";
//getting accessabel system locations
function s(){l.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!k.isEmpty(a.accessabelSystemLocation)&&(a.whetherAccessbleUser=!0)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function t(b){var c=!1;return a.accessabelSystemLocation&&!k.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){a&&b&&a.id==b&&(c=!0)}),c}function u(b){var c={};
//return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_BY_SEACRH_KEY', userData),
return c.searchString=b,a.userNameAutoCmpLoading=!0,l.getData(m.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.user=b.data},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function v(a,b){j.getUserFamilyById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageUserFamilyHistory",{id:a,type:e,data:f})},function(a){f("error",h.instant(a.data.messages[0]))})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.checkOrganizationLocationAccess=t,a.getAccessabelSystemLocation=s,a.searchHistory={},a.loginDetails=b.loggedInUserDetails,a.getUserNamesForRoleHistory=u,a.crudUserFamily=v,a.orgLocPermission=o.USER_FAMILY_HISTORY_ADD,a.whetherAccessbleUser=!1,a.disable=!0,
//            $scope.loginDetails = $rootScope.loggedInUserDetails;
a.addNewFamily=function(){d.go("manageUserFamilyHistory")},p.validateListing("FAMILY_HISTORY_RECORD_SUB"),a.listView=!0,a.cardView=!1,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1):(a.cardView=!1,a.listView=!0),"Card view"===c?"List View":"Card view"})}),
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),
//vpr list
d.params.orgLoc&&(a.searchHistory.creatingOrgnId={},a.searchHistory.creatingOrgnId.id=d.params.orgLoc.id,a.searchHistory.creatingOrgnId.value=d.params.orgLoc.value),d.params.userName&&d.params.userId&&(a.searchHistory.userId={id:d.params.userId,value:d.params.userName}),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.redirectAdd=!0:a.redirectAdd=!1,s(),
// if ($stateParams.userId) {
//     if (!$scope.searchHistory) {
//         $scope.searchHistory = {};
//     }
//     if (!$scope.searchHistory.userId) {
//         $scope.searchHistory.userId = {};
//     }
//     $scope.searchHistory.userId= $stateParams.userId;
//     //$scope.searchHistory.userId.id = $stateParams.userId;
// }
a.getUserFamilyHistoryList=function(){var b=(a.searchHistory,{});
// if ($stateParams.userId) {
//     $scope.searchHistory.userId = $stateParams.userName;
// }
// if ($stateParams.userId) {
//     userHistoryList.userId = $stateParams.userId;
//     $scope.searchHistory.userId = $stateParams.userName;
// }
// if ($rootScope.loggedInUserDetails && !$rootScope.loggedInUserDetails.isOrganizationUserMode) {
//     userHistoryList.userId = $rootScope.loggedInUserDetails.id;
//     $scope.searchHistory.userId = $rootScope.loggedInUserDetails.displayName;
// }
return a.searchHistory&&a.searchHistory.userId&&!a.searchHistory.userId.id?void f("error",h.instant("INVALID_USER")):a.searchHistory&&a.searchHistory.creatingOrgnId&&!a.searchHistory.creatingOrgnId.id?void f("error",h.instant("INVALID_LOCATION")):a.searchHistory&&a.searchHistory.relationshipId&&!a.searchHistory.relationshipId.id?void f("error",h.instant("INVALID_RELATION")):a.searchHistory&&a.searchHistory.throughId&&!a.searchHistory.throughId.id?void f("error",h.instant("INVALID_THROUGH")):(a.searchHistory.creatingOrgnId&&a.searchHistory.creatingOrgnId&&(b.creatingOrgnId=a.searchHistory.creatingOrgnId.id),a.searchHistory.relationshipId&&a.searchHistory.relationshipId&&(b.relationshipId=a.searchHistory.relationshipId.id),a.searchHistory.throughId&&a.searchHistory.throughId&&(b.throughId=a.searchHistory.throughId.id),a.searchHistory.userId&&a.searchHistory.userId&&(b.userId=a.searchHistory.userId.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,void j.getuserHistoryList(b,function(b){b&&(a.userHistoryList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},(b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode||a.searchHistory.userId&&a.searchHistory.userId.id)&&a.getUserFamilyHistoryList(),a.getRelationship=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_RELATIONSHIP_BY_KEYWORD",a.queryObj);if(c)return l.getData(c,null,function(b){if(b&&b.data)return a.relationship=b.data,a.relationship},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getThrough=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=m.getParameterizedUrl("GET_TROUGH_BY_KEYWORD",a.queryObj);if(c)return l.getData(c,null,function(b){if(b&&b.data)return a.through=b.data,a.through},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getCreatedBy=function(b){var c={};
//userObj.searchKeyWord = value;
//userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,l.getData(m.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.clear=function(){a.searchHistory={},a.userHistoryList={},a.disable=!1,c.userId=null,c.userName=null,d.go("searchUserFamilyHistory",{notify:!1},{notify:!1})};
//data table config
var w=n.gridConfigurations;a.options=g.setOptionProperties(w),a.dtColumnDefs=g.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getUserFamilyHistoryList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getUserFamilyHistoryList()},a.inActivate=function(b,c){j.deleteFamilyRecordById(b,function(b){b&&(a.userHistoryList.splice(c,1),f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_DELETED_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}}]),angular.module("paripal.familyHistoryModule").service("manageUserFamilyHistoryService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.saveUserFamilyHistory=function(c,d,e){var f="";f=null!=c.id?"UPDATE_USER_FAMILY_HISTORY":"SAVE_USER_FAMILY_HISTORY",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getUserFamilyById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("FAMILY_HISTORY_GET_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getFamilyRecordId=function(c,d){a.getData(b.getUrl("GET_FAMILY_RECORD_AUTO_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.familyHistoryModule").service("searchUserFamilyHistoryService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getuserHistoryList=function(c,d,e){a.postData(b.getUrl("FAMILY_HISTORY_FINDBY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getUserFamilyById=function(c,d,e){var f={};f.id=c,
//var dateFormat = 'MM/dd/yyyy';
a.getData(b.getParameterizedUrl("FAMILY_HISTORY_GET_BY_ID",f),null,function(a){a&&a.data?/*response.data.dateFirstDiagnosed = $filter('timestampToDate')(response.data.dateFirstDiagnosed, dateFormat);
    				response.data.dateLastTreated = $filter('timestampToDate')(response.data.dateLastTreated, dateFormat);
    				response.data.nextAppointmentScheduledOn = $filter('timestampToDate')(response.data.nextAppointmentScheduledOn, dateFormat);*/
d(a.data):e(a)},function(a){e(a)})},this.deleteFamilyRecordById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_FAMILY_RECORD_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userIncidentModule").controller("manageUserIncidentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","manageUserIncidentService","viewUserIncidentService","utilService","urlService","httpService","dateconvertor","fileOperations","commonConstants","featurePrivilegeConstants","baseService","addOrgLocClientService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,m.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&u()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function u(){a.userIncident=c.data,a.viewmode=!0,a.expressionDisabled=!0,j.getUserIncidentById(c.id,function(b){a.manageOrgLocSpinner=!1,a.userIncident=b,a.setData(a.userIncident),a.setData()},function(b){a.manageOrgLocSpinner=!1,a.error=b,f("error",g.instant("ORG_LOC_FETCH_FAILURE"))})}function v(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.incidentTypeLoad=!0,m.getData(l.getParameterizedUrl("GET_INCIDENT_TYPE",a.searchKeyWord),null,function(b){return a.incidentTypeLoad=!1,a.incidentTypeLoad=angular.fromJson(b.data)},function(b){a.incidentTypeLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SERACH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})}function w(b){a.queryObj={},a.queryObj.userId=b;var c=l.getParameterizedUrl("FIND_DISEASE_BY_USER",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.linkedToDisease=b.data,a.linkedToDisease},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function x(b,c){var d={};d.userId=b,d.diseaseId=c;var e=l.getParameterizedUrl("FIND_DISEASE_BY_USER_AND_DISEASE",d);if(e)return m.getData(e,null,function(b){if(b&&b.data)return a.linkedToDiseaseVarriant=b.data,a.linkedToDiseaseVarriant},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}a.userIncident={},a.minDate=new Date,a.currentDate=new Date,a.loginDetails=b.loggedInUserDetails;a.userReadOnly=!1,a.field=!1,a.getIncidentType=v,a.type=c.type,a.maxDate=new Date,a.minDateValidTill=new Date,a.linkedToDisease={},a.orgLocPermission=q.USER_INCIDENT_ADD,a.diseaseVarriants={},a.diseases={},a.getDisease=w,a.getDiseaseVariant=x,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=t,a.allowAccessOTP=u,
//for individual user subscription
// $scope.checkWhetherSubscriber = function(){
//          if($scope.loginDetails && $scope.loginDetails.whetherSubscriber == true ){
//             $scope.getSystemOrg();
//          }else{
//              $scope.getCreatedBy();
//          }
//        }
a.getSystemOrg=function(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,m.getData(l.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.userIncident.location=b.data[0],a.userIncident.location},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getDate=function(b){a.minDateValidTill=b},a.cancel=function(){/*  $state.go("userincident", {
                  type: ''
              });*/
k.goBackToPrevState()},
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.userIncident.user={},a.userIncident.user.value=a.loginDetails.displayName,a.userIncident.user.id=a.loginDetails.id,w(a.userIncident.user.id),a.getSystemOrg()),a.checkLocationCategory=function(){var b=r.getDefaultOrgLocation();s.getOrgLocationByOrgLocId(b.orgLoc.id,function(b){b&&(b.orgLctnCategoryId2&&"EDUCATIONAL_INSTITUTION"==b.orgLctnCategoryId2.code?a.mandatoryYes=!1:a.mandatoryYes=!0)},function(a){}),console.log(b)},a.init=function(){if(a.loginDetails&&a.loginDetails.isOrganizationUserMode&&a.checkLocationCategory(),a.manageOrgLocSpinner=!0,"add"===c.type){a.field=!0,a.orgLocPermission=q.USER_INCIDENT_ADD;var d=r.getDefaultOrgLocation();k.isFieldEmpty(d)||(a.userIncident.location=d.orgLoc)}else"edit"===c.type&&b.loggedInUserDetails?(a.editmode=!0,a.orgLocPermission=q.USER_INCIDENT_EDIT,a.userIncident=c.data):"view"===c.type&&b.loggedInUserDetails&&(a.userIncident=c.data,a.viewmode=!0,a.expressionDisabled=!0);c.data&&(a.user={},a.userIncident=c.data,a.userIncident.linkedToDisease=c.data.linkedToDisease,a.userIncident.linkedToDiseaseVarriant=c.data.linkedToDiseaseVarriant,a.manageOrgLocSpinner=!1,a.orgLoc=a.userIncident.location),c.id&&("view"===c.type||"edit"===c.type)&&b.loggedInUserDetails&&j.getUserIncidentById(c.id,function(b){a.manageOrgLocSpinner=!1,a.userIncident=b,a.setData(a.userIncident)},function(b){a.manageOrgLocSpinner=!1,a.error=b,f("error",g.instant("ORG_LOC_FETCH_FAILURE"))}),"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||t()},a.init(),a.setData=function(b){a.diseaseId=b.linkedToDisease.id,a.getDisease(b.user.id),a.diseaseVariantId=b.linkedToDiseaseVarriant.id},a.getCreatedBy=function(b){a.queryObj={},a.queryObj.keyword=b;var c=l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},
//     $scope.getUserNamesForRoleHistory = function (viewValue) {
//     $scope.userData = {};
//     $scope.userData.userName = viewValue;
//     $scope.userNameAutoCmpLoading = true;
//     return httpService.getData(urlService.getParameterizedUrl('FIND_USER_NAME', $scope.userData), null, function (response) {
//         $scope.userNameAutoCmpLoading = false;
//         $scope.valid = false;
//         return $scope.users = angular.fromJson(response.data);
//     }, function (error) {
//         $scope.userNameAutoCmpLoading = false;
//     });
// }
a.getUserNamesForRoleHistory=function(b){if(a.loginDetails.userAccountStatusDTO.whetherSubscriber=!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",g.instant(b.data.messages[0]))})},a.saveUserIncident=function(){var b=angular.copy(a.userIncident);
//saveData.incidentDate = dateconvertor.convertToServerDate($scope.userIncident.incidentDate);
//$scope.userIncident.linkedToDisease = parseInt($scope.userIncident.linkedToDisease);
b.user={},b.user.id=a.userIncident.user.id,a.saveData&&a.saveData.linkedToDisease&&(b.linkedToDisease={},b.linkedToDisease.id=a.userIncident.linkedToDisease.id),i.saveUserIncident(b,function(a){k.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),d.go("userincident"))},function(b){return a.userIncident&&a.userIncident.user&&!a.userIncident.user.id?void f("error",g.instant("INVALID_USER")):a.userIncident&&a.userIncident.location&&!a.userIncident.location.id?void f("error",g.instant("INVALID_LOCATION")):a.userIncident&&a.userIncident.linkedToDisease&&!a.userIncident.linkedToDisease.id?void f("error",g.instant("INVALID_DISEASE")):a.userIncident&&a.userIncident.linkedToDiseaseVarriant&&!a.userIncident.linkedToDiseaseVarriant.id?void f("error",g.instant("INVALID_DISEASE_VARIANT")):a.userIncident&&a.userIncident.incidentType&&!a.userIncident.incidentType.id?void f("error",g.instant("INVALID_INCIDENT_TYPE")):void(k.isNullOrEmpty(b.data.message[0])||f("error",g.instant(b.data.message[0])))})}}]),angular.module("paripal.userIncidentModule").controller("manageUserIncidentPopupCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","manageUserIncidentService","viewUserIncidentService","utilService","urlService","httpService","dateconvertor","fileOperations","commonConstants","featurePrivilegeConstants","baseService","addOrgLocClientService","$mdDialog","userIncident","mode","appointmentRef",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,m.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&y()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function y(){a.userIncident=c.data,a.viewmode=!0,a.expressionDisabled=!0,j.getUserIncidentById(c.id,function(b){a.manageOrgLocSpinner=!1,a.userIncident=b,z(a.userIncident)},function(b){a.manageOrgLocSpinner=!1,a.error=b,f("error",g.instant("ORG_LOC_FETCH_FAILURE"))})}function z(b){a.diseaseId=b.linkedToDisease.id,a.getDisease(b.user.id),a.diseaseVariantId=b.linkedToDiseaseVarriant.id}function A(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.incidentTypeLoad=!0,m.getData(l.getParameterizedUrl("GET_INCIDENT_TYPE",a.searchKeyWord),null,function(b){return a.incidentTypeLoad=!1,a.incidentTypeLoad=angular.fromJson(b.data)},function(b){a.incidentTypeLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",g.instant("RECORD_SERACH_FAILURE")):f("Alert",g.instant(b.data.messages[0]))})}function B(b){a.queryObj={},a.queryObj.userId=b;var c=l.getParameterizedUrl("FIND_DISEASE_BY_USER",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.linkedToDisease=b.data,a.linkedToDisease},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function C(b,c){var d={};d.userId=b,d.diseaseId=c;var e=l.getParameterizedUrl("FIND_DISEASE_BY_USER_AND_DISEASE",d);if(e)return m.getData(e,null,function(b){if(b&&b.data)return a.linkedToDiseaseVarriant=b.data,a.linkedToDiseaseVarriant},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}a.userIncident={},a.minDate=new Date,a.currentDate=new Date,a.loginDetails=b.loggedInUserDetails;a.userReadOnly=!1,a.field=!1,a.getIncidentType=A,a.type=c.type,a.maxDate=new Date,a.minDateValidTill=new Date,a.linkedToDisease={},a.orgLocPermission=q.USER_INCIDENT_ADD,a.diseaseVarriants={},a.diseases={},a.getDisease=B,a.getDiseaseVariant=C,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=x,a.allowAccessOTP=y,a.setData=z,a.getSystemOrg=function(){var b={};return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,m.getData(l.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.userIncident.location=b.data[0],a.userIncident.location},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getDate=function(b){a.minDateValidTill=b},a.cancel=function(){t.cancel()},
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.userIncident.user={},a.userIncident.user.value=a.loginDetails.displayName,a.userIncident.user.id=a.loginDetails.id,B(a.userIncident.user.id),a.getSystemOrg()),a.checkLocationCategory=function(){var b=r.getDefaultOrgLocation();s.getOrgLocationByOrgLocId(b.orgLoc.id,function(b){b&&(b.orgLctnCategoryId2&&"EDUCATIONAL_INSTITUTION"==b.orgLctnCategoryId2.code?a.mandatoryYes=!1:a.mandatoryYes=!0)},function(a){}),console.log(b)},a.init=function(){if(a.loginDetails&&a.loginDetails.isOrganizationUserMode&&a.checkLocationCategory(),w&&(a.appointmentRef=w),a.appointmentRef&&(a.isFromAppointment=!0,a.userIncident||(a.userIncident={}),a.userIncident.user={id:a.appointmentRef.patientId,value:a.appointmentRef.patientName}),a.manageOrgLocSpinner=!0,v&&"add"===v.mode){a.field=!0,a.orgLocPermission=q.USER_INCIDENT_ADD;var b=r.getDefaultOrgLocation();k.isFieldEmpty(b)||(a.userIncident.location=b.orgLoc),a.getDisease(a.userIncident.user.id)}else v&&"view"===v.mode&&u?(a.userIncident=u,a.viewmode=!0,a.expressionDisabled=!0,z(a.userIncident)):v&&"edit"===v.mode&&u&&(a.userIncident=u,a.editmode=!0,z(a.userIncident))},a.init(),a.getCreatedBy=function(b){a.queryObj={},a.queryObj.keyword=b;var c=l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){},{orgLocPermission:a.orgLocPermission})},a.getUserNamesForRoleHistory=function(b){if(a.loginDetails.userAccountStatusDTO.whetherSubscriber=!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",g.instant(b.data.messages[0]))})},a.saveUserIncident=function(){var b=angular.copy(a.userIncident);b.user={},b.user.id=a.userIncident.user.id,a.saveData&&a.saveData.linkedToDisease&&(b.linkedToDisease={},b.linkedToDisease.id=a.userIncident.linkedToDisease.id),i.saveUserIncident(b,function(a){k.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),t.cancel("success"))},function(a){})}}]),angular.module("paripal.userIncidentModule").controller("viewUserIncidentCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","commonConstants","urlService","viewUserIncidentService","serverSidePagination","utilService","resourceListService","baseService","$mdDialog","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(a){d.go("searchDiseaseIncidents",{diseaseId:a.linkedToDisease.id,diseaseName:a.linkedToDisease.value,diseaseVariantId:a.linkedToDiseaseVarriant.id,diseaseVariantName:a.linkedToDiseaseVarriant.value,from:"userIncident"})}function t(a){d.go("viewIncidentStatistics",{diseaseId:a.linkedToDisease.id,diseaseName:a.linkedToDisease.value,diseaseVariantId:a.linkedToDiseaseVarriant.id,diseaseVariantName:a.linkedToDiseaseVarriant.value,incidentTypeId:a.incidentType.id,incidentTypeName:a.incidentType.value,from:"userIncident"})}function u(b,c){var d={};d.userId=b,d.diseaseId=c;var e=k.getParameterizedUrl("FIND_DISEASE_BY_USER_AND_DISEASE",d);if(e)return i.getData(e,null,function(b){if(b&&b.data)return a.linkedToDiseaseVarriant=b.data,a.linkedToDiseaseVarriant},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}/*$scope.otherUserMedicationAction = function(id, section, index){
    if(section == 'analysis'){
      $state.go('bloodrequestanalysis');
    }else if(section == 'close-request'){
      searchBloodRequestServices.closeRequest(id, function(successResponse){
        if(!utilService.isNullOrEmpty(successResponse.data.successMessage)){
          notify("success", $translate.instant(successResponse.data.successMessage));
          $scope.bloodRequestList[index].status = "Closed";
        }
      })
    }else if(section == 'send-message'){
      searchBloodRequestServices.sendMessage(id, function(successResponse){
        if(!utilService.isNullOrEmpty(successResponse.data.successMessage)){
          notify("success", $translate.instant(successResponse.data.successMessage));
          $scope.bloodRequestList[index].status = "Closed";
        }
      })
    }
  }*/
function v(b,c){l.deleteUserIncidentById(b,function(b){b&&(a.userIncidentList.splice(c,1),
//$state.go('userincident');
f("success",g.instant("RECORD_DELETED_SUCCESSFULLY")),a.fetchRecords())},function(a){f("error",g.instant(a.data.messages[0]))})}
//check access for managing data
function w(b){var c=!1;return a.accessibleSubscriberLocation&&!n.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}a.userIncident={},
//$scope.disase = {};
a.minDate=new Date,a.removeUserIncident=v,a.fromMaxDate=new Date,a.user="",a.userIncidentList={},a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.disable=!0,a.hasAccessibleSubscriberLocation=!1,a.accessibleSubscriberLocation={},a.checkOrganizationLocationAccess=w,a.diseaseIncident=s,a.diseaseIncidentStatistics=t,a.getDiseaseVariant=u,a.loginDetails=b.loggedInUserDetails,p.validateListing("INCIDENTS_RECORD_SUB"),a.listView=!0,a.cardView=!1,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1):(a.cardView=!1,a.listView=!0),"Card view"===c?"List View":"Card view"})}),d.params.orgLocId&&(a.userIncident={},a.userIncident.orgLocation=d.params.orgLocId),b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.userIncident.user={},a.userIncident.user.value=b.loggedInUserDetails.displayName,a.userIncident.user.id=b.loggedInUserDetails.id),d.params.user&&(b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode?(a.userIncident.user={},a.userIncident.user.value=d.params.user.value,a.userIncident.user.id=d.params.user.userId):b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,a.userIncident.user={},a.userIncident.user.value=d.params.user.value,a.userIncident.user.id=d.params.user.userId)),
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),/*$scope.loginDetails = $rootScope.loggedInUserDetails;
            $scope.userReadOnly = false;
            if(!$scope.loginDetails.isOrganizationUser){
                $scope.userReadOnly = true;
               $scope.userMedication.user = $scope.loginDetails.displayName;
            }*/
a.addNewUserIncident=function(){d.go("manageuserincident",{type:""})},a.redirectToChecklist=function(a){
// $state.go('resourcelist', { 'resourceNameContains': 'Incident,' + userIncident.incidentType.value });
o.getCheckListTypeByCode("INCIDENT",function(b){b&&d.go("resourcelist",{checklistTypeId:b.id,resourceNameContains:a.incidentType.value})},function(a){})},a.getUserNamesForRoleHistory=function(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,i.getData(k.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("Alert",g.instant(b.data.messages[0]))})},a.getDisease=function(b){a.queryObj={},a.queryObj.userId=b;var c=k.getParameterizedUrl("FIND_DISEASE_BY_USER",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.disease=b.data,a.disease},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.fetchRecords=function(b,c){if(a.userIncident&&a.userIncident.user&&!a.userIncident.user.id)return void f("error",g.instant("INVALID_USER"));if(a.userIncident&&a.userIncident.disease&&!a.userIncident.disease.id)return void f("error",g.instant("INVALID_DISEASE"));if(a.userIncident&&a.userIncident.linkedToDiseaseVarriant&&!a.userIncident.linkedToDiseaseVarriant.id)return void f("error",g.instant("INVALID_DISEASE_VARIANT"));var d=angular.copy(b);d||(d={}),a.userIncident&&a.userIncident.user&&(d.userId=a.userIncident.user.id,delete d.user),a.userIncident&&a.userIncident.disease&&(d.linkedToDisease=a.userIncident.disease.id,delete d.disease),a.userIncident&&a.userIncident.linkedToDiseaseVarriant&&(d.linkedToDiseaseVarriant=a.userIncident.linkedToDiseaseVarriant.id,delete d.linkedToDiseaseVarriant),a.userIncident.orgLocation&&(d.orgLocation=a.userIncident.orgLocation),d.pageNumber=a.currentPage,d.recordsPerPage=a.itemPerPage,l.fetchRecords(d,function(b){b&&(a.userIncidentList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("Alert",g.instant(a.data.messages[0]))})},/* if($scope.userIncident && $scope.userIncident.user){
                 $scope.fetchRecords();
                 }*/
(b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode||a.userIncident.user&&a.userIncident.user.id)&&a.fetchRecords(),
// if($state.params.user){
//     if ($rootScope.loggedInUserDetails && $rootScope.loggedInUserDetails.isOrganizationUserMode) {
//         $scope.fetchRecords();
//     }
// }
// if(!$rootScope.loggedInUserDetails){
//   $scope.fetchRecords();
// }
a.manageUserIncident=function(a,b){l.getUserIncidentById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageuserincident",{id:a,type:e,data:f})},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("Alert",g.instant(a.data.messages[0]))})},a.clear=function(){a.userIncident={},a.disable=!1,a.userIncidentList=[]},a.pageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems),a.userIncident&&a.userIncident.user&&a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.userIncident&&a.userIncident.user&&a.fetchRecords()};
//data table config
var x=j.gridConfigurations;a.options=h.setOptionProperties(x),a.dtColumnDefs=h.setColumnProperties({}),
//get subscribed accessible location
a.getAccessibleSubscriberLocation=function(b){return i.getData(k.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),n.isNullOrEmpty(c)||n.isNullOrEmpty(c.user)||(a.userIncident.user=c.user,a.getDisease(c.user.id))}]),angular.module("paripal.userIncidentModule").service("manageUserIncidentService",["httpService","urlService","dateconvertor","$timeout","$filter","utilService",function(a,b,c,d,e){"use strict";this.saveUserIncident=function(d,e,f){d.incidentDate=c.convertToServerDate(d.incidentDate);var g="";g=null!=d.id?"UPDATE_USER_INCIDENT":"SAVE_USER_INCIDENT",a.postData(b.getUrl(g),d,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.getUserIncidentId=function(c,d){a.getData(b.getUrl("GET_INCIDENT_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.userIncidentModule").service("viewUserIncidentService",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){"use strict";this.fetchRecords=function(c,d,f){var g="MM/dd/yyyy";a.postData(b.getUrl("GET_USER_INCIDENT_BY_CRITERIA"),c,function(a){a&&a.data?(a.data.incidentDate=e("timestampToDate")(a.data.incidentDate,g),d(a.data)):f(a)},function(a){f(a)})},this.deleteUserIncidentById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_USER_INCIDENT_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getUserIncidentById=function(c,d,f){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_USER_INCIDENT_ID",g),null,function(a){a&&a.data?(a.data.incidentDate=e("timestampToDate")(a.data.incidentDate,h),d(a.data)):f(a)},function(a){f(a)})}}]),angular.module("paripal.userIssueModule").controller("manageLastFeedbackCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageLastFeedbackService","utilService","dateconvertor","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){a.feedbackRec={},a.feedbackRec.userIssue={},a.feedbackRec.userIssue.id=a.issue.id,
//$scope.feedbackRec.date=dateconvertor.convertToServerDate($scope.issue.date);
a.feedbackRec.feedback=a.issue.feedback,j.save(a.feedbackRec,function(a){a&&(d.go("searchUserIssue"),f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}a.diseaseId={},a.issue={},a.save=o,a.cancel=function(){
//$state.go("searchUserIssue");
k.goBackToPrevState()},a.init=function(){if(a.manageOrgLocSpinner=!0,"edit"===c.type?(a.issue=c.data,a.editmode=!0,a.disabled=!0):"view"===c.type?(a.issue=c.data,a.viewmode=!0):"feedBack"===c.type&&(a.disabled=!0),c.id){var b=parseInt(c.id);
//manageLastFeedbackService.getFeedbackById($stateParams.id, function (sucessResponse) {
j.getUserIssueById(b,function(b){a.issue=b},function(b){a.manageOrgLocSpinner=!1,a.error=b,k.isEmpty(b.data)||k.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}},a.init()}]),angular.module("paripal.userIssueModule").controller("manageUserIssueCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserIssueService","utilService","dateconvertor","httpService","urlService","featurePrivilegeConstants","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,m.getData(n.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.issue.creatingLocId=b.data[0],a.issue.creatingLocId},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function r(b){var c={};return c.organizationLocationId=b,m.getData(n.getParameterizedUrl("GET_ORG_LOC_BY_ID",c),null,function(b){b&&b.data&&1==b.data.whetherSubscriber?a.isSubscribedLoc=!0:a.isSubscribedLoc=!1},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function s(){if(a.issue.userId.value&&a.issue.userId.value.id?(a.issue.userId.id=a.issue.userId.value.id,a.issue.userId.value=a.issue.userId.value.value,delete a.issue.userId.value.value):(delete a.issue.userId.code,delete a.issue.userId.organizationLocationId),a.issue.serviceType.id&&a.issue.serviceType.value&&(a.issue.serviceType.id=a.issue.serviceType.id,a.issue.serviceType.value=a.issue.serviceType.value,delete a.issue.serviceType.code,delete a.issue.serviceType.organizationLocationId),a.issue&&a.issue.firstDiagnosedIn&&a.issue.firstDiagnosedIn.id?a.issue.firstDiagnosedIn=a.issue.firstDiagnosedIn:a.issue&&a.issue.firstDiagnosedIn&&!a.issue.firstDiagnosedIn.id&&(a.issue.firstDiagnosedValue=a.issue.firstDiagnosedIn),a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&(a.issue.lastTreatedIn=a.issue.lastTreatedIn),(a.issue&&a.issue.lastTreatedIn&&!a.issue.lastTreatedIn.id||a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&0==a.isSubscribedLoc)&&(
//$scope.issue.lastTreatedValue=$scope.issue.lastTreatedIn;
a.issue.treatmentType={},a.issue.treatmentType.id=a.issue.serviceType.id,a.issue.treatmentType.value=a.issue.serviceType.value,delete a.issue.serviceType),a.issue&&a.issue.lastTreatedIn&&!a.issue.lastTreatedIn.id&&(a.issue.lastTreatedValue=a.issue.lastTreatedIn,delete a.issue.lastTreatedIn),a.issue&&a.issue.lastTreatedBy&&a.issue.lastTreatedBy.id)a.issue.lastTreatedBy=a.issue.lastTreatedBy,delete a.issue.lastTreatedBy.version,delete a.issue.lastTreatedBy.displayName,delete a.issue.lastTreatedBy.professionalId;else if(a.issue&&a.issue.lastTreatedBy&&!a.issue.lastTreatedBy.id){var b=a.issue.lastTreatedBy;a.issue.lastTreatedBy={},a.issue.lastTreatedByValue=b,delete a.issue.lastTreatedBy}a.issue&&a.issue.creatingLocId&&a.issue.creatingLocId.id&&(a.issue.creatingLocId=a.issue.creatingLocId.id),a.issue.diseaseVariant&&a.issue.diseaseVariant.id&&delete a.issue.diseaseVariant.icdId,
//$scope.issue.dateFirstDiagnosed = dateconvertor.convertToServerDate($scope.issue.dateFirstDiagnosed);
//$scope.issue.dateLastTreated = dateconvertor.convertToServerDate($scope.issue.dateLastTreated);
//$scope.issue.nextAppointmentScheduledOn = dateconvertor.convertToServerDate($scope.issue.nextAppointmentScheduledOn);
j.saveUserIssue(a.issue,function(b){b&&(p.cancel(),d.go("searchUserIssue"),a.issue&&a.issue.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){
// if($scope.issue && $scope.issue.lastTreatedIn && !$scope.issue.lastTreatedIn.id){
// 	notify("error", $translate.instant("INVALID_LOCATION"));
// 	return;
// }
// if($scope.issue && $scope.issue.firstDiagnosedIn && !$scope.issue.firstDiagnosedIn.id){
// 	notify("error", $translate.instant("INVALID_LOCATION"));
// 	return;
// }
// if($scope.issue && $scope.issue.lastTreatedBy && !$scope.issue.lastTreatedBy.id){
// 	notify("error", $translate.instant("INVALID_USER"));
// 	return;
// }
return a.issue&&a.issue.userId&&!a.issue.userId.id?void f("error",h.instant("INVALID_USER")):a.issue&&a.issue.disease&&!a.issue.disease.id?void f("error",h.instant("INVALID_DISEASE")):a.issue&&a.issue.diseaseVariant&&!a.issue.diseaseVariant.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):a.issue&&a.issue.serviceType&&!a.issue.serviceType.id?void f("error",h.instant("INVALID_SERVICE")):void(!k.isEmpty(b.data)&&!k.isEmpty(b.data.messages)&&b.data.messages.length>0&&f("error",h.instant(b.data.messages[0])))})}
//    function getUserNamesForRoleHistory(viewValue) {
//    	var userData = {};
//        userData.searchString = viewValue;
//        $scope.userNameAutoCmpLoading = true;
//       // return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_BY_SEACRH_KEY', userData), 
//        return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_LIST_BY_SEACRH_KEY', userData),	               
//        null, function (response) {
//            $scope.userNameAutoCmpLoading = false;
//            return $scope.queryUserId = response.data;
//        }, function (error) {
//            $scope.userNameAutoCmpLoading = false;
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
// 		notify("Alert", $translate.instant(error.data.messages[0]));
// } 
//        });
//    }      
function t(b){if(1!=a.loginDetails.userAccountStatusDTO.whetherSubscriber||a.loginDetails.isOrganizationUserMode){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.queryUserId=b.data},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.queryUserId=b.data},function(b){a.userNameAutoCmpLoading=!1})}function u(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.diseaseLoad=!0,m.getData(n.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.searchKeyWord),null,function(b){return a.diseaseLoad=!1,a.disease=angular.fromJson(b.data)},function(b){a.diseaseLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}function v(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.issue&&a.issue.disease?(a.searchKeyWord.diseaseId=a.issue.disease.id,a.diseaseVariantLoad=!0,m.getData(n.getParameterizedUrl("GET_VARIANT_LIST_WITH_ICD10_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}function w(b){j.getIcd10DetailsById(b,function(b){b&&(
//$scope.issue.icd10CodeDescription =sucessResponse.icd10CodeId + "-" + sucessResponse.icd10CodeDescription;
a.issue.icd10CodeDescription=b.icd10CodeDescription)},function(b){a.manageOrgLocSpinner=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}function x(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,m.getData(n.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&y()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function y(){if(a.pageState="view",a.viewmode=!0,a.IsVisible=!0,c.id){var b=parseInt(c.id);j.getUserIssueById(b,function(b){a.issue=b,b.firstDiagnosedValue&&(a.issue.firstDiagnosedIn=b.firstDiagnosedValue),b.lastTreatedValue&&(a.issue.lastTreatedIn=b.lastTreatedValue,a.issue.serviceType=b.treatmentType),b.lastTreatedByValue&&(a.issue.lastTreatedBy=b.lastTreatedByValue),a.setData(a.issue),a.issue.userId=b.userId,
//$scope.issue.userId=sucessResponse.userId.value;
a.issue.followUpStatus=b.followUpStatus.value,a.issue.lastTreatedBy=b.lastTreatedBy},function(b){a.manageOrgLocSpinner=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}}function z(b,c){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var d={};d.searchKeyword=b;var e="GET_ORG_LOC_BY_ALL"}else{var d={};d.searchKeyword=b;
//userObj.userId = userId.value.id;   
var e="FIND_SUBSCRIBED_LOCATION"}var d={};return d.searchKeyword=b,m.getData(n.getParameterizedUrl(e,d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}
//  function getCreatingLocation(value, userId) {
//  	var userObj = {};
// userObj.keyword = value;
// if($stateParams.type=='add'){
//                          userObj.userId=userId.value.id;
//  		}else if($stateParams.type=='edit'){
//                          userObj.userId=userId.id;
// 		}
// // userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
// return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
// 	if (response && response.data) {
//                    $scope.issue.creatingOrgId = response.data[0];
// 					return $scope.issue.creatingOrgId;
// 	}
// }, function (error) {
// 	if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
// 		notify("error", $translate.instant(error.data.messages[0]));
// 	}
// },{'orgLocPermission':$scope.orgLocPermission});
//  }
function A(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,m.getData(n.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}a.saveUserIssue=s,a.getDiseaseVariant=v,a.getDisease=u,a.diseaseId={},a.issue={},a.orgLocationId={},a.minDate=new Date,a.currentDate=new Date,a.maxDate=new Date,a.minDateValidTill=new Date,a.orgLocPermission=o.USER_ISSUE_ADD,a.getServiceProvider=z,a.isVisible=!1,a.field=!1,a.getUserNamesForRoleHistory=t,a.loginDetails=b.loggedInUserDetails,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=x,a.allowAccessOTP=y,a.getCreatingLocation=A,a.checkWhetherSubscribedLocation=r,a.getIcd10Details=w,a.cancel=function(){k.goBackToPrevState()},
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.issue.userId={},a.issue.userId.value=a.loginDetails.displayName,a.issue.userId.id=a.loginDetails.id,q()),a.setAptDate=function(b){var c=parseInt(b),d=new Date;d.setDate(d.getDate()+c),a.issue.nextAppointmentScheduledOn=d},new Def.Autocompleter.Search("icd10","https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code,name",{tableFormat:!1,valueCols:[0][1],colHeaders:["Code","Name"]}),a.getServiceType=function(b){if(a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&1==a.isSubscribedLoc){a.queryObj={},a.queryObj.locationId=a.issue.lastTreatedIn.id,a.queryObj.searchString=b;var c=n.getParameterizedUrl("FIND_SERVICE_TYPE_BY_LOCID",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}else{a.queryObj={},a.queryObj.name=b;var c=n.getParameterizedUrl("TREATMENT_TYPE",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}},a.init=function(){if("add"===c.type&&c.data)a.issue=c.data,a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&r(a.issue.lastTreatedIn.id);else if("add"===c.type&&!c.data){a.orgLocPermission=o.USER_ISSUE_ADD;var d=angular.fromJson(localStorage.getItem("defaultOrgLoc"));null!=d&&(a.issue.lastTreatedIn={id:d.id,value:d.value},a.issue.creatingLocId={id:d.id,value:d.value})}if(
//for individual sub
// if($scope.loginDetails.whetherSubscriber = true){
//     $scope.issue.user=$scope.loginDetails.displayName;
//     $scope.getSystemOrg();
// }
a.manageOrgLocSpinner=!0,"edit"===c.type&&b.loggedInUserDetails&&(a.IsVisible=!0,a.editMode=!0,a.orgLocPermission=o.USER_ISSUE_ADD,c.id)){var e=parseInt(c.id);j.getUserIssueById(e,function(b){a.issue=b,b.firstDiagnosedValue&&(a.issue.firstDiagnosedIn=b.firstDiagnosedValue),b.lastTreatedValue&&(a.issue.lastTreatedIn=b.lastTreatedValue,delete b.lastTreatedValue),b.treatmentType&&(a.issue.serviceType=b.treatmentType,delete b.treatmentType),b.lastTreatedByValue&&(a.issue.lastTreatedBy=b.lastTreatedByValue),a.setData(a.issue),a.issue.userId=b.userId,a.issue.followUpStatus=b.followUpStatus.value,a.issue.lastTreatedBy=b.lastTreatedBy},function(b){a.manageOrgLocSpinner=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}if("view"===c.type&&b.loggedInUserDetails&&(a.pageState="view",a.viewmode=!0,a.IsVisible=!0,c.id)){var e=parseInt(c.id);j.getUserIssueById(e,function(b){a.issue=b,b.firstDiagnosedValue&&(a.issue.firstDiagnosedIn=b.firstDiagnosedValue),b.lastTreatedValue&&(a.issue.lastTreatedIn=b.lastTreatedValue),b.treatmentType&&(a.issue.serviceType=b.treatmentType),
// if(sucessResponse.lastTreatedIn){
//     //$scope.issue.lastTreatedIn =sucessResponse.lastTreatedValue;
//     $scope.issue.serviceType = sucessResponse.treatmentType;
// }
b.lastTreatedByValue&&(a.issue.lastTreatedBy=b.lastTreatedByValue),a.setData(a.issue),a.issue.userId=b.userId,
//$scope.issue.userId=sucessResponse.userId.value;
a.issue.followUpStatus=b.followUpStatus.value,a.issue.lastTreatedBy=b.lastTreatedBy},function(b){a.manageOrgLocSpinner=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||x()},a.init(),a.loginDetails&&a.loginDetails.isOrganizationUserMode&&A(),
// function getServiceProvider(value, userId) {
// 	if ($stateParams.type=='add' && (!userId || !userId.value )) {
// 		return;
// 	}else if($stateParams.type=='edit' && (!userId || !userId.id)){
// 		return;
// 	}
// 		var userObj = {};
// 		userObj.keyword = value;
// 		if($stateParams.type=='add'){
//                         userObj.userId=userId.value.id;
// 		}else if($stateParams.type=='edit'){
//                         userObj.userId=userId.id;
// 		}
// 		if($scope.loginDetails.userAccountStatusDTO.whetherSubscriber == true && !$scope.loginDetails.isOrganizationUserMode){
// 			var userObj = {};
// 			userObj.searchKeyWord = value;
// 			return httpService.getData(urlService.getParameterizedUrl('FIND_ORGANIZATION_LOCATION_ALL', userObj), null, function (response) {
// 			//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD', userObj), null, function (response) {
// 			if (response && response.data) {
// 				$scope.lastTreatedIn = response.data;
//                       return $scope.lastTreatedIn;
// 			}
// 		}, function (error) {
// 			if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
// 				notify("error", $translate.instant(error.data.messages[0]));
// 			}
// 		},{'orgLocPermission':$scope.orgLocPermission});
// 		}else{
// 			var userObj = {};
// 		userObj.keyword = value;
// 		if($stateParams.type=='add'){
//                         userObj.userId=userId.value.id;
// 		}else if($stateParams.type=='edit'){
//                         userObj.userId=userId.id;
// 		}
// 			return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD', userObj), null, function (response) {
// 			//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD', userObj), null, function (response) {
// 			if (response && response.data) {
// 				$scope.lastTreatedIn = response.data;
//                       return $scope.lastTreatedIn;
// 			}
// 		}, function (error) {
// 			if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
// 				notify("error", $translate.instant(error.data.messages[0]));
// 			}
// 		},{'orgLocPermission':$scope.orgLocPermission});
// 		}
// 		// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
// 		return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
// 			//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD', userObj), null, function (response) {
// 			if (response && response.data) {
// 				$scope.lastTreatedIn = response.data;
//                       return $scope.lastTreatedIn;
// 			}
// 		}, function (error) {
// 			if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
// 				notify("error", $translate.instant(error.data.messages[0]));
// 			}
// 		},{'orgLocPermission':$scope.orgLocPermission});
// 	};
a.getFollowUpStatus=function(){var b={};b.code="FOLLOW_UP_STATUS",m.getData(n.getParameterizedUrl("GET_PICKLIST_BY_CODE",b),null,function(b){b&&b.data&&(a.followUpStatusList=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getFollowUpStatus(),
//FIND_ORG_SUPPORT_SERVICE_PROFESSIONAL
a.supportServiceProfessionals=function(b){a.queryObj={},a.queryObj.searchString=b;var c=n.getParameterizedUrl("GET_ADVISED_BY_SEACRH_KEY",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},
//       $scope.supportServiceProfessionals = function (searchType) {
//       	if($scope.issue && $scope.issue.lastTreatedIn && $scope.issue.lastTreatedIn.id && $scope.loginDetails.isOrganizationUserMode) {
//             $scope.queryObj = {};
//             $scope.queryObj.searchKeyword = searchType;
//             if ($scope.issue && $scope.issue.lastTreatedIn) {
//                 $scope.queryObj.orgLocationId = $scope.issue.lastTreatedIn.id;
//             } else {
//                 notify("error", $translate.instant("Select Last Treated In"));
//                 return;
//             }
//             var url = urlService.getParameterizedUrl('FIND_HEALTHPROFESSION_BY_ORGLOCATION', $scope.queryObj);
//             //var url = urlService.getParameterizedUrl('GET_ADVISED_BY', $scope.queryObj);
//             if (url) {
//                 return httpService.getData(url, null, function (response) {
//                     if (response && response.data) {
//                         $scope.serviceType = response.data;
//                         return $scope.serviceType;
//                     }
//                 }, function (error) {
//                     if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                         notify("error", $translate.instant(error.data.messages[0]));
//                     }
//                 });
//             }
//         }else{
//         	$scope.queryObj = {};
//             $scope.queryObj.name = searchType;
//             var url = urlService.getParameterizedUrl('GET_ADVISED_BY', $scope.queryObj);
//             if (url) {
//                 return httpService.getData(url, null, function (response) {
//                     if (response && response.data) {
//                         $scope.serviceType = response.data;
//                         return $scope.serviceType;
//                     }
//                 }, function (error) {
//                     if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                         notify("error", $translate.instant(error.data.messages[0]));
//                     }
//                 });
//             }
//         }
// };
a.setData=function(b){a.followUpStatus=b.followUpStatus.id,b.followUpStatus.id&&a.getFollowUpStatus()}}]),angular.module("paripal.userIssueModule").controller("searchPrescriptionListCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","searchPrescriptionListService","utilService","urlService","httpService","commonConstants","featurePrivilegeConstants","baseService","$mdDialog","$timeout","$location","MakePrescriptionFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";function u(b){var c=new Object;c.fileName=b.prescriptionRef,c.resourceId=b.id,c.recordId=b.id,c.docType=n.documentTypes.transaction,c.docSubType=n.documentSubTypes.emergencyTransaction,a.fileResource=c,a.viewFileContent=!0}if(a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.prescription={},a.prescriptionList={},a.apptViewPrintFile=u,a.loginDetails=b.loggedInUserDetails,b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode){a.prescriptionList.user={},a.prescriptionList.user.value=b.loggedInUserDetails.displayName,a.prescriptionList.user.id=b.loggedInUserDetails.id;var v=angular.fromJson(localStorage.getItem("defaultOrgLoc"));a.prescriptionList.organizationLocation={},a.prescriptionList.organizationLocation.value=v.value,a.prescriptionList.organizationLocation.id=v.id}c&&c.userId&&c.userName&&(a.prescriptionList.user={},a.prescriptionList.user.id=parseInt(c.userId),a.prescriptionList.user.value=c.userName),c&&c.organizationLocationId&&c.organizationLocationName&&(a.prescriptionList.organizationLocation={},a.prescriptionList.organizationLocation.id=parseInt(c.organizationLocationId),a.prescriptionList.organizationLocation.value=c.organizationLocationName),a.getPrescriptionList=function(){var b=(a.prescriptionList,{});
//var defaultOrgLoc = angular.fromJson(localStorage.getItem("defaultOrgLoc"));
//userPrescriptionList.organizationLocation = defaultOrgLoc.id;
return a.prescriptionList&&a.prescriptionList.user&&!a.prescriptionList.user.id?void f("error",h.instant("INVALID_USER")):a.prescriptionList&&a.prescriptionList.organizationLocation&&!a.prescriptionList.organizationLocation.id?void f("error",h.instant("INVALID_LOCATION")):(a.prescriptionList.user&&a.prescriptionList.user.id&&(b.user=a.prescriptionList.user.id),c.appointmentId&&(b.appointment=parseInt(c.appointmentId)),a.prescriptionList.organizationLocation&&a.prescriptionList.organizationLocation.id&&(b.organizationLocation=a.prescriptionList.organizationLocation.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,void j.getUserPrescriptionList(b,function(b){b&&(a.gridDataNull=!0,a.userPrescriptionList=b.data,console.log(a.userPrescriptionList),a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},a.getPrescriptionList(),a.makePrescription1=t.makePrescription,a.makePrescription=function(b,c,d,e){var f=angular.fromJson(localStorage.getItem("appmentData")),g={};g.stateName="searchPrescriptionList";var e=null,h=f.id,i=null;a.makePrescription1(b,c,d,e,g,h,i)},a.getUserNamesForRoleHistory=function(b){var c={};
//return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_BY_SEACRH_KEY', userData), null, function (response) {
return c.searchString=b,a.userNameAutoCmpLoading=!0,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})};
//data table config
var w=n.gridConfigurations;a.options=g.setOptionProperties(w),a.dtColumnDefs=g.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getUserIssueList()},a.clear=function(){a.prescription={},a.PrescriptionList={}},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getUserIssueList()}}]),angular.module("paripal.userIssueModule").controller("searchUserIssueCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","searchUserIssueService","utilService","urlService","httpService","commonConstants","featurePrivilegeConstants","baseService","$mdDialog","$timeout","EmergencyTransactionService","EmergencyCallManagementService","baseConfig","skypeService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";
//           if($scope.searchIssue.user && $scope.searchIssue.user.id){
//     $scope.getUserIssueList();
// }
/*$scope.getCreatedBy = function (value) {

            var userObj = {};
            userObj.keyword = value;
            userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
            return httpService.getData(urlService.getParameterizedUrl('GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD', userObj), null, function (response) {
                if (response && response.data) {
                    $scope.createdBy = response.data;
                    return $scope.createdBy;
                }
            }, function (error) {
                if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
                    notify("error", $translate.instant(error.data.messages[0]));
                }
            });
        };
        */
function w(c,d){var e={};return e.keyword=c,b.loggedInUserDetails.isOrganizationUserMode?m.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",e),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission}):d&&d.id?(e.userId=d.id,m.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD",e),null,function(a){if(a&&a.data)return a.data},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})):void 0}function x(b){a.diseaseId=b}function y(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.diseaseId,a.diseaseVariantLoad=!0,m.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}function z(a,b){j.getUserIssueById(a,function(c){var e,f=c;"edit"==b?(e="edit",d.go("manageUserIssue",{id:a,type:e,data:f})):"view"==b?(e="view",d.go("manageUserIssue",{id:a,type:e,data:f})):"feedBack"==b&&(e="feedBack",d.go("manageLastFeedback",{id:a,type:e}))},function(a){f("error",h.instant(a.data.messages[0]))})}function A(){d.go("viewDiseaseStatistics")}function B(b,c){var d={};d.id=b,j.toggleChangeStatus(d,function(b){b&&(a.userIssueList[c].active=!a.userIssueList[c].active,f("success",h.instant("RECORD_UPDATED_SUCCESS")))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}
//check access for managing data
function C(b){var c=!1;return a.accessibleSubscriberLocation&&!k.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}function D(a,b){var c;"remark"==b&&(c="remark",d.go("viewUserIssueRemarks",{id:a,type:c}))}if(a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.crudUserIssue=z,a.getDiseaseVariant=y,a.getDiseaseId=x,a.orgLocPermission=o.USER_ISSUE_ADD,a.getCreatingOrgLoc=w,a.diseaseId={},a.searchIssue={},/*$scope.getAccessabelSystemLocation = getAccessabelSystemLocation;*/
a.hasAccessibleSubscriberLocation=!1,a.accessibleSubscriberLocation={},a.checkOrganizationLocationAccess=C,a.redirectToDiseaseStatistics=A,a.toggleChangeStatus=B,a.viewRemarks=D,a.disable=!0,a.gridDataNull=!1,a.loginDetails=b.loggedInUserDetails,p.validateListing("ISSUE_RECORD_SUB"),a.listView=!0,a.cardView=!1,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1):(a.cardView=!1,a.listView=!0),"Card view"===c?"List View":"Card view"})}),c.orgLocId&&(a.searchIssue.creatingLocId={},a.searchIssue.creatingLocId.id=d.params.orgLocId.orgLocId,a.searchIssue.creatingLocId.value=d.params.orgLocId.value),b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.searchIssue.user={},a.searchIssue.user.value=b.loggedInUserDetails.displayName,a.searchIssue.user.id=b.loggedInUserDetails.id),c.user)if(b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode){var E=c.user;a.searchIssue.user={},a.searchIssue.user.id=E.userId,a.searchIssue.user.value=E.value}else if(b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode){c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1;var E=c.user;a.searchIssue.user={},a.searchIssue.user.id=E.userId,a.searchIssue.user.value=E.value}
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),a.openCamera=function(){
//$state.go('cameraAccess');
getCssDetails("paripal_sigtuple")},a.patientCheckIn=function(){
//$state.go('redirectPatientToAgora'); 
s.directCallConsultDoctor(a.transactionId,function(b){var c={};c.userId=a.loginDetails.id,c.convId=b.response,c.convType="DIRECT_CALL",c.userName=a.loginDetails.displayName;var e=d.href("directCallAgora",c),f=window.open(e,"_blank");null==f||"undefined"==typeof f?alert('Please disable your pop-up blocker and click the "Open" link again.'):f.focus()})},a.doctorCheckIn=function(){v.patientContinueStatus(null,function(a){!k.isNullOrEmpty(a)&&a.data&&(a.data["continue"]?continueVideoCall():terminateVideoCall())},function(a){k.isNullOrEmpty(a.data.message[0])||f("alert",h.instant(a.data.message[0]))})},
// function getCssDetails(paripalClientId){
//     if(paripalClientId){
//        var trustedObj = {};
//        trustedObj.paripalClientId = paripalClientId;
//        httpService.getData(urlService.getParameterizedUrl('GET_TRUSTED_USER_CSS', trustedObj), null, function (response) {
//         if (response && response.data) {
//             localStorage.setItem("trustedCSS", response.data.customCSSFileName);
//         }
//     }, function (error) {
//     });
//     }
// }
a.getUserIssueList=function(){var b=(a.searchIssue,{});/*if($rootScope.loggedInUserDetails.id){
                userIssueList.user=$rootScope.loggedInUserDetails.id;
            }*/
/*if($rootScope.loggedInUserDetails.id){
                userIssueList.user=$rootScope.loggedInUserDetails.id;
            }*/
/*if(!$rootScope.loggedInUserDetails.isOrganizationUserMode){
                userIssueList.user = $rootScope.loggedInUserDetails.id;
                $scope.searchIssue.user=$rootScope.loggedInUserDetails.displayName;
            }*/
return a.searchIssue&&a.searchIssue.user&&!a.searchIssue.user.id?void f("error",h.instant("INVALID_USER")):a.searchIssue&&a.searchIssue.creatingLocId&&!a.searchIssue.creatingLocId.id?void f("error",h.instant("INVALID_LOCATION")):a.searchIssue&&a.searchIssue.disease&&!a.searchIssue.disease.id?void f("error",h.instant("INVALID_DISEASE")):a.searchIssue&&a.searchIssue.diseaseVariant&&!a.searchIssue.diseaseVariant.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):(a.searchIssue.user&&a.searchIssue.user.id&&(b.user=a.searchIssue.user.id),a.searchIssue.creatingLocId&&a.searchIssue.creatingLocId&&(b.creatingLocId=a.searchIssue.creatingLocId.id),a.searchIssue.disease&&a.searchIssue.disease&&(b.disease=a.searchIssue.disease.id),a.searchIssue.diseaseVariant&&a.searchIssue.diseaseVariant&&(b.diseaseVariant=a.searchIssue.diseaseVariant.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,void j.getUserIssueList(b,function(b){b&&(a.gridDataNull=!0,a.userIssueList=b.data,0==a.userIssueList.length&&(a.girdView=!0),a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},
//$scope.getUserIssueList();
a.addNewIssue=function(a){q.show({templateUrl:"app/modules/user-issue/views/user-issue-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{type:"add",userId:a.user},controller:["$scope","$mdDialog","locals","manageUserIssueService",function(a,e,g,i){function j(){if(c.transactionType)return a.shareLocation=!0,a.shareLocation}function n(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,m.getData(l.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.issue.creatingLocId=b.data[0],a.issue.creatingLocId},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function o(b){if(1!=a.loginDetails.userAccountStatusDTO.whetherSubscriber||a.loginDetails.isOrganizationUserMode){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.queryUserId=b.data},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.queryUserId=b.data},function(b){a.userNameAutoCmpLoading=!1})}function p(b){a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=b;var c=l.getParameterizedUrl("FIND_DISEASE_BY_VARIANT_ID",a.searchKeyWord);if(c)return m.getData(c,null,function(b){b&&b.data&&(a.issue.disease=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}
//        function getDisease(viewValue){
//     $scope.searchKeyWord = {};
//     $scope.searchKeyWord.searchKeyWord = viewValue;
//     $scope.diseaseLoad = true;
//     return httpService.getData(urlService.getParameterizedUrl('GET_DISEASE_BY_KEYWORD', 
//     $scope.searchKeyWord), null, function (response) {
//     $scope.diseaseLoad = false;
//     return $scope.disease = angular.fromJson(response.data);
//     }, function (errorResponse) {
//     $scope.diseaseLoad = false;
//     if (!utilService.isEmpty(errorResponse.data) && 
//     !utilService.isEmpty(errorResponse.data.messages[0])) {
//         notify("Alert", $translate.instant(errorResponse.data.messages[0]));
//     } else {
//      notify("error", $translate.instant("RECORD_SEARCH_FAILURE"));
//     }
//     });
// }
// function getDiseaseVariant(viewValue){
//     $scope.searchKeyWord = {};
//     $scope.searchKeyWord.searchKeyWord = viewValue;
//     if($scope.issue && $scope.issue.disease){
//     $scope.searchKeyWord.diseaseId = $scope.issue.disease.id;
//     }else{
//         notify("error", $translate.instant("Select Disease"));
//         return;
//     }
//     $scope.diseaseVariantLoad = true;
//                 return httpService.getData(urlService.getParameterizedUrl('GET_VARIANT_LIST_BY_ID', 
//                         $scope.searchKeyWord), null, function (response) {
//                     $scope.diseaseVariantLoad = false;
//                     return $scope.diseaseVariantLoad = angular.fromJson(response.data);
//                 }, function (errorResponse) {
//                     $scope.diseaseVariantLoad = false;
//                     if (!utilService.isEmpty(errorResponse.data) && 
//                             !utilService.isEmpty(errorResponse.data.messages[0])) {
//                         notify("Alert", $translate.instant(errorResponse.data.messages[0]));
//                     } else {
//                         notify("error", $translate.instant("RECORD_SEARCH_FAILURE"));
//                     }
//                 });
//             }
function q(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=l.getParameterizedUrl("GET_DISEASE_VARIANTS_BY_SEARCHWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function r(b,c){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var d={};d.searchKeyword=b;var e="GET_ORG_LOC_BY_ALL"}else{var d={};d.searchKeyword=b;
//userObj.userId = userId.value.id;   
var e="FIND_SUBSCRIBED_LOCATION"}var d={};return d.searchKeyword=b,m.getData(l.getParameterizedUrl(e,d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function s(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,m.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function t(b){var c={};return c.organizationLocationId=b,m.getData(l.getParameterizedUrl("GET_ORG_LOC_BY_ID",c),null,function(b){b&&b.data&&1==b.data.whetherSubscriber?a.isSubscribedLoc=!0:a.isSubscribedLoc=!1},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function u(){if(a.issue.userId.value&&a.issue.userId.value.id?(a.issue.userId.id=a.issue.userId.value.id,a.issue.userId.value=a.issue.userId.value.value,delete a.issue.userId.value.value):(delete a.issue.userId.code,delete a.issue.userId.organizationLocationId),a.issue.serviceType.id&&a.issue.serviceType.value&&(a.issue.serviceType.id=a.issue.serviceType.id,a.issue.serviceType.value=a.issue.serviceType.value,delete a.issue.serviceType.code,delete a.issue.serviceType.organizationLocationId),a.issue&&a.issue.firstDiagnosedIn&&a.issue.firstDiagnosedIn.id?a.issue.firstDiagnosedIn=a.issue.firstDiagnosedIn:a.issue&&a.issue.firstDiagnosedIn&&!a.issue.firstDiagnosedIn.id&&(a.issue.firstDiagnosedValue=a.issue.firstDiagnosedIn),a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&(a.issue.lastTreatedIn=a.issue.lastTreatedIn),(a.issue&&a.issue.lastTreatedIn&&!a.issue.lastTreatedIn.id||a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&0==a.isSubscribedLoc)&&(
//$scope.issue.lastTreatedValue=$scope.issue.lastTreatedIn;
a.issue.treatmentType={},a.issue.treatmentType.id=a.issue.serviceType.id,a.issue.treatmentType.value=a.issue.serviceType.value,delete a.issue.serviceType),a.issue&&a.issue.lastTreatedIn&&!a.issue.lastTreatedIn.id&&(a.issue.lastTreatedValue=a.issue.lastTreatedIn,delete a.issue.lastTreatedIn),a.issue&&a.issue.lastTreatedBy&&a.issue.lastTreatedBy.id)a.issue.lastTreatedBy=a.issue.lastTreatedBy,delete a.issue.lastTreatedBy.version,delete a.issue.lastTreatedBy.displayName,delete a.issue.lastTreatedBy.professionalId;else if(a.issue&&a.issue.lastTreatedBy&&!a.issue.lastTreatedBy.id){var b=a.issue.lastTreatedBy;a.issue.lastTreatedBy={},a.issue.lastTreatedByValue=b,delete a.issue.lastTreatedBy}a.issue&&a.issue.creatingLocId&&a.issue.creatingLocId.id&&(a.issue.creatingLocId=a.issue.creatingLocId.id),
//$scope.issue.dateFirstDiagnosed = dateconvertor.convertToServerDate($scope.issue.dateFirstDiagnosed);
//$scope.issue.dateLastTreated = dateconvertor.convertToServerDate($scope.issue.dateLastTreated);
//$scope.issue.nextAppointmentScheduledOn = dateconvertor.convertToServerDate($scope.issue.nextAppointmentScheduledOn);
i.saveUserIssue(a.issue,function(b){b&&(e.cancel(),d.go("searchUserIssue"),a.issue&&a.issue.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(b){return a.issue&&a.issue.userId&&!a.issue.userId.id?void f("error",h.instant("INVALID_USER")):a.issue&&a.issue.disease&&!a.issue.disease.id?void f("error",h.instant("INVALID_DISEASE")):a.issue&&a.issue.diseaseVariant&&!a.issue.diseaseVariant.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):a.issue&&a.issue.serviceType&&!a.issue.serviceType.id?void f("error",h.instant("INVALID_SERVICE")):void(!k.isEmpty(b.data)&&!k.isEmpty(b.data.messages)&&b.data.messages.length>0&&f("error",h.instant(b.data.messages[0])))})}a.issue={},a.getUserNamesForRoleHistory=o,a.getDisease=p,a.getDiseaseVariant=q,a.getServiceProvider=r,a.getCreatingLocation=s,a.loginDetails=b.loggedInUserDetails,a.checkWhetherSubscribedLocation=t,a.getSystemOrg=n,a.saveUserIssue=u,a.issueShareLocation=j,a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.issue.userId={},a.issue.userId.value=a.loginDetails.displayName,a.issue.userId.id=a.loginDetails.id,n());var v=angular.fromJson(localStorage.getItem("defaultOrgLoc"));null!=v&&(a.issue.lastTreatedIn={id:v.id,value:v.value},a.issue.creatingLocId={id:v.id,value:v.value},t(a.issue.lastTreatedIn.id)),g.userId&&(a.issue.userId=g.userId),a.cancel1=function(){e.cancel()},a.callManageIssue=function(b){a.newIssue=b,e.cancel(),d.go("manageUserIssue",{type:"add",data:a.newIssue})},a.getServiceType=function(b){if(a.issue&&a.issue.lastTreatedIn&&a.issue.lastTreatedIn.id&&1==a.isSubscribedLoc){a.queryObj={},a.queryObj.locationId=a.issue.lastTreatedIn.id,a.queryObj.searchString=b;var c=l.getParameterizedUrl("FIND_SERVICE_TYPE_BY_LOCID",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}else{a.queryObj={},a.queryObj.name=b;var c=l.getParameterizedUrl("TREATMENT_TYPE",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.serviceType=b.data,a.serviceType},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}}}]})},a.getUserNamesForRoleHistory=function(b){var c={};
//return httpService.getData(urlService.getParameterizedUrl('GET_PATIENTS_BY_SEACRH_KEY', userData), null, function (response) {
return c.searchString=b,a.userNameAutoCmpLoading=!0,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1})},(b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode||a.searchIssue.user&&a.searchIssue.user.id)&&a.getUserIssueList(),a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})};
//data table config
var F=n.gridConfigurations;a.options=g.setOptionProperties(F),a.dtColumnDefs=g.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getUserIssueList()},a.clear=function(){a.searchIssue={},
//$scope.getUserIssueList();
a.disable=!1,a.userIssueList=[]},
//get subscribed accessible location
a.getAccessibleSubscriberLocation=function(b){return m.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){
//httpService.getData(urlService.getParameterizedUrl('FIND_ACCESSIBLE_SYSTEM_LOCATION'), null, function (response) {
b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.redirectToDiseaseSatistics=function(a){d.go("viewDiseaseStatistics",{diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,from:"diseaseVariant"})},a.redirectToDiseaseMedication=function(a){d.go("searchDiseaseMedication",{diseaseVariantId:a.diseaseVariant.id,diseaseVariant:a.diseaseVariant.value,disease:a.disease.value})},a.redirectToDiseaseSymptom=function(a){d.go("searchDiseaseSymptoms",{diseaseVariantId:a.diseaseVariant.id,diseaseVariant:a.diseaseVariant.value,disease:a.disease.value})},a.redirectToDiseaseIncident=function(a){d.go("searchDiseaseIncidents",{diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,diseaseName:a.disease.value})},a.redirectToUserFamily=function(a){d.go("searchUserFamilyHistory",{userId:a.userId.id,userName:a.userId.value})},a.redirectToUserTreatment=function(a){d.go("viewUserTreatment",{userId:a.userId.id,userName:a.userId.value,diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,diseaseId:a.disease.id,diseaseName:a.disease.value,locationId:a.creatingLocId.id,locationName:a.creatingLocId.value})},a.redirectToUserSymptom=function(a){d.go("viewUserSymptoms",{userId:a.userId.id,userName:a.userId.value,diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,diseaseId:a.disease.id,diseaseName:a.disease.value,locationId:a.creatingLocId.id,locationName:a.creatingLocId.value})},a.redirectToUserIncidentView=function(b){a.searchKeyword={},a.searchKeyword.diseaseId=b.disease.id,a.searchKeyword.diseaseVariantId=b.diseaseVariant.id,a.searchKeyword.userId=b.userId.id,j.getIncidentByDiseaseIdDiseaseVariantId(a.searchKeyword,function(a){a&&a.length>0?d.go("manageuserincident",{id:a[0].id,type:"view"}):f("error",h.instant("USER_ISSUE_REDIRECT_MESSAGE"))},function(b){a.manageOrgLocSpinner=!1,a.error=b,k.isEmpty(b.data)||k.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getUserIssueList()}}]),angular.module("paripal.userIssueModule").controller("viewUserIssueRemarksCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","viewUserIssueRemarksService","utilService",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";a.init=function(){if("remark"===c.type&&(a.disabled=!0,c.id)){var b=parseInt(c.id);j.getRemarksByIssueId(b,function(b){if(b){for(var c=b.feedback,d=c.split(","),e=0;e<d.length;e++)d[e]=d[e].replace(/^\s*/,"").replace(/\s*$/,""),a.feedBackList=d;return a.issueRemark=b,a.issueRemark.user=b.userName,a.issueRemark.feedback=b.feedback,a.issueRemark}b||f("error",h.instant("RECORD_SEARCH_FAILURE"))},function(b){a.manageOrgLocSpinner=!1,a.error=b,k.isEmpty(b.data)||k.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}},a.init(),a.cancel=function(){history.back()},angular.module("MainCtrl",["$scope","$anchorScroll",function(a,b){return a.feedBackList=feedback_array}])}]),angular.module("paripal.userIssueModule").service("manageLastFeedbackService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";this.save=function(c,d,e){var f="";f=c&&!c.id?"LAST_FEEDBACK_RECEIVED_SAVE":"LAST_FEEDBACK_RECEIVED_UPDATE",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},/* this.getFeedbackById = function (id) {     		
      		httpService.getData(urlService.getParameterizedUrl('LAST_FEEDBACK_RECEIVED_BY_ID',id),
      				null, function (response) {
      			if (response && response.data){     				
      				successCallback(response.data);
      			}else
      				errorCallback(response);
      		}, function (error) {
      			errorCallback(error);
      		});
      	};*/
this.getUserIssueById=function(c,d,e){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("USER_ISSUE_GET_BY_ID",g),null,function(a){a&&a.data?(a.data.dateFirstDiagnosed=f("timestampToDate")(a.data.dateFirstDiagnosed,h),a.data.dateLastTreated=f("timestampToDate")(a.data.dateLastTreated,h),a.data.nextAppointmentScheduledOn=f("timestampToDate")(a.data.nextAppointmentScheduledOn,h),d(a.data)):e(a)},function(a){e(a)})}}]),angular.module("paripal.userIssueModule").service("manageUserIssueService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";this.saveUserIssue=function(c,d,e){var f="";f=null!=c.id?"UPDATE_USER_ISSUE":"SAVE_USER_ISSUE",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getUserIssueById=function(c,d,e){var f={};f.id=c,
//var dateFormat = 'MM/dd/yyyy';
a.getData(b.getParameterizedUrl("USER_ISSUE_GET_BY_ID",f),null,function(a){a&&a.data?
//response.data.dateFirstDiagnosed = $filter('timestampToDate')(response.data.dateFirstDiagnosed, dateFormat);
//response.data.dateLastTreated = $filter('timestampToDate')(response.data.dateLastTreated, dateFormat);
//response.data.nextAppointmentScheduledOn = $filter('timestampToDate')(response.data.nextAppointmentScheduledOn, dateFormat);
d(a.data):e(a)},function(a){e(a)})},this.getIssueRecordId=function(c,d){a.getData(b.getUrl("GET_USER_ISSUE_RECORD_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.getIcd10DetailsById=function(c,d,e){var f={};f.id=c,a.getData(b.getParameterizedUrl("ICD_10_GET_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userIssueModule").service("searchPrescriptionListService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getUserPrescriptionList=function(b,d,e){a.postData(c.getUrl("GET_PRESCRIPTION_LIST"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userIssueModule").service("searchUserIssueService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getUserIssueList=function(b,d,e){a.postData(c.getUrl("SEARCH_USER_ISSUE_FINDBY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getUserIssueById=function(d,e,f){var g={};g.id=d;var h="MM/dd/yyyy";a.getData(c.getParameterizedUrl("USER_ISSUE_GET_BY_ID",g),null,function(a){a&&a.data?(a.data.dateFirstDiagnosed=b("timestampToDate")(a.data.dateFirstDiagnosed,h),a.data.dateLastTreated=b("timestampToDate")(a.data.dateLastTreated,h),a.data.nextAppointmentScheduledOn=b("timestampToDate")(a.data.nextAppointmentScheduledOn,h),e(a.data)):f(a)},function(a){f(a)})},this.toggleChangeStatus=function(b,d,e){a.getData(c.getParameterizedUrl("USER_ISSUE_CHANGE_STATUS",b),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.getIncidentByDiseaseIdDiseaseVariantId=function(b,d,e){var f={};f=b,a.getData(c.getParameterizedUrl("GET_USER_INCIDENT_UNIQUE_RECORD_BY_DISEASE_DISEAVARIANT",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userIssueModule").service("viewUserIssueRemarksService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getRemarksByIssueId=function(d,e,f){var g={};g.userissueId=d;var h="MM/dd/yyyy";a.getData(c.getParameterizedUrl("LAST_FEEDBACK_BY_ISSUE_RECORD_ID",g),null,function(a){a&&a.data?(a.data.date=b("timestampToDate")(a.data.date,h),e(a.data)):f(a)},function(a){f(a)})}}]),angular.module("paripal.userMedicationModule").controller("MedicationManagementCtrl",["$rootScope","$scope","$state","utilService",function(a,b,c,d){"use strict";if(b.goToUserMedication=function(){c.go("usermedication",{isCurrent:"true"})},b.goToUserMedicationHistory=function(){c.go("usermedication",{isCurrent:"false"})},b.requestManagementScreen=function(a,b){a.preventDefault(),c.go("requestmgntlist",{requestType:b})},!d.isNullOrEmpty(a.dashboardMenu)){b.parentMenus=a.dashboardMenu.children;for(var e=0;e<=b.parentMenus.length;e++)null!=b.parentMenus[e]&&("USER_MEDICATION"!=b.parentMenus[e].name&&"MY_MEDICATIONS"!=b.parentMenus[e].name||(b.childMenus=b.parentMenus[e].children))}b.redirectTo=function(a,b){a.preventDefault(),"ON_GOING_MEDICATION"==b.name?c.go(b.state,{isCurrent:"true"}):"MEDICATION_HISTORY"==b.name?c.go(b.state,{isCurrent:"false"}):c.go(b.state)}}]),angular.module("paripal.userMedicationModule").controller("manageUserMedicationCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$filter","viewUserMedicationService","manageUserMedicationService","utilService","urlService","httpService","dateconvertor","fileOperations","featurePrivilegeConstants","commonConstants","manageAttachmentService","$mdMedia","docMgntService","orbeonFormRunner","$sce","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,m.getData(l.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)
//$scope.userMedication.creatingOrganizationId.value = response.data[0].value;
//$scope.system = response.data[0].id;
return a.userMedication.creatingOrganizationId=b.data[0],a.userMedication.creatingOrganizationId},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function y(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,m.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&z()},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function z(){a.userMedication=c.data,a.viewmode=!0,a.isVisible=!1,a.hide=!1,i.getUserMedicationById(c.id,function(b){if(a.manageOrgLocSpinner=!1,a.userMedication=b,a.setData(a.userMedication),a.userMedication.creatingOrganizationId&&a.userMedication.creatingOrganizationId.id||!a.userMedication.locationRecordValue||(a.userMedication.creatingOrganizationId=a.userMedication.locationRecordValue),
// $scope.setData();
a.rmMode=[],a.userMedication.reminderMode){for(var c=0;a.userMedication.reminderMode.length>c;c++)a.rmMode.push(a.userMedication.reminderMode[c].contactMode.id);a.userMedication.reminderMode=a.rmMode}},function(b){a.manageOrgLocSpinner=!1,a.error=b,f("error",g.instant("ORG_LOC_FETCH_FAILURE"))})}function A(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var c={};return c.keyword=b,m.getData(l.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}var c={};
//userObj.searchKeyWord = value;
return c.keyword=b,m.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){
//return httpService.getData(urlService.getParameterizedUrl('GET_ORG_LOC_LIST_BY_KEYWORD', userObj), null, function (response) {
if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function B(b){return a.medication={},a.medication.medication=b,a.medicationLoad=!0,m.getData(l.getParameterizedUrl("SEARCH_MEDICATION",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}function C(b){return a.medication={},""==b?a.medication.searchKeyWord=void 0:a.medication.searchKeyWord=b,a.medication.medicationId=a.userMedication.medication.id,a.medicationLoad=!0,m.getData(l.getParameterizedUrl("GET_MEDICATIONVARIANT_BY_MEDICATIONID",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}function D(b){a.reminderMode={},a.reminderMode.searchKeyWord=b;var c=l.getParameterizedUrl("GET_REMINDER_MODE_BY_KEYWORD",a.reminderMode);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.reminderMode=b.data,a.reminderMode},function(a){})}
// function getFood(reasonValue) {
//     $scope.Food = {};
//     $scope.Food.searchKeyWord = reasonValue;
//     var url = urlService.getParameterizedUrl(
//         'GET_LINKED_TO_FOOD_LIST_BY_KEYWORD',
//         $scope.Food);
//     if (url) {
//         return httpService.getData(url, null, function (
//             response) {
//             if (response && response.data) {
//                 $scope.Food = response.data;
//                 return $scope.Food;
//             }
//         }, function (error) {});
//     }
// };
function E(b,c,e){var h=new Object;h.file=b.fileToBeUpload,h.orgLocId=c.creatingOrganizationId.id,h.docType=q.documentTypes.medication,h.docSubType=q.documentSubTypes.userMedication,h.isThumbnailRequired=!1,k.isNullOrEmpty(e.response)||(h.resourceId=e.response),o.uploadFile(h,function(b){k.isNullOrEmpty(e)||(a.userMedication.document={id:e.response},j.saveUserMedication(a.userMedication,function(a){a&&(f("success",a.successMessage),d.go("usermedication"))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))}),f("success",e.successMessage))},function(a){k.isNullOrEmpty(e.response)||i.removeUserMedication(e.response.id,function(a){f("Error",g.instant("ERROR_WHILE_UPLOADING"))},function(a){f("Error",g.instant("ERROR_WHILE_UPLOADING"))})})}function F(b,c){if(!k.isEmpty(c)){var d={};d.fileName=c.uploadPrescription,d.orgLocId=c.creatingOrganizationId.id,d.resourceId=c.document.id,d.docType=q.documentTypes.medication,d.docSubType=q.documentSubTypes.userMedication,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable,o.viewFileContent(d,function(a){},function(a){})}}function G(b){a.diseaseId=b}function H(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.diseaseId,a.diseaseVariantLoad=!0,m.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}a.userMedication={},a.userMedication.beingUsed=!0,a.step1=!0,a.step2=!1,a.step3=!1,a.iconStep1=!0,a.iconStep2=!0,a.iconStep3=!0,a.minDate=new Date,a.documentUpload={},a.documentUpload.document={},a.userMedication.document=null,a.currentDate=new Date,a.addressFilter={},a.loginDetails=b.loggedInUserDetails;a.userReadOnly=!1,a.getMedications=B,
//$scope.getStoppageReason = getStoppageReason;
//$scope.getFood = getFood;
a.getReminderMode=D,a.getVariant=C,a.type=c.type,a.maxDate=new Date,a.minDateValidTill=new Date,a.viewPrintFile=F,a.uploadFile=E,a.getDiseaseVariant=H,a.getDiseaseId=G,a.diseaseId={},a.orgLocPermission=p.USER_MEDICATION_ADD,a.getCreatedBy=A,a.getSystemOrg=x,a.isVisible=!0,a.userMedication.reminderMode=new Array,a.userMedication.prescribedOriginallyBy={},a.userMedication.currentPrescriptionFrom={},a.doctor={},a.addmode=!0,a.hide=!0,a.userMedicationFile={},a.userMedicationFile.fileToBeUpload=null,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=y,a.allowAccessOTP=z,a.timePattern=[],a.userMedication.followUpDates=[],a.userMedication.userMedicationDates=[],a.readonlyDates=!1,a.multipleDates,a.minVariantLength=q.typeaheadMinLength0,
//$scope.userMedication.frequencyPattern = 'daily';
a.getDate=function(b){a.minDateValidTill=b},a.loadFormBuilder=function(b,c,e,f){
// http://localhost:8080/paripal-web/rest/user/findUserById/{xxf:get-request-parameter('recordId')}?access_token={xxf:get-request-parameter('access_token')}$cookies.get('token1')
a.iframeURL=v.trustAsResourceUrl(l.getOrbeonUrl("FORM_BUILDER_NEW_TEMPLATE_URL")+c+"?access_token="+localStorage.getItem("paripal_token")+"&recordId="+b+"&docType="+e),d.go("formBuilder",{type:"iframe",url:a.iframeURL,savedRecordId:b,readonly:f})},a.pushTimeObj=function(b){var c=a.time.twentyfour,d=c.getHours()+":"+c.getMinutes();console.log(d),a.timePattern.includes(d)||a.timePattern.push(d)},b.$on("medicationTime",function(b,c){var d=c,e=d.getHours()+":"+d.getMinutes();console.log(e),a.timePattern.includes(e)||a.timePattern.push(e)}),a.time={twentyfour:new Date},a.time.twentyfour.setMinutes(30),/*$scope.viewDocumentTemplateContent=function(prescriptionId,orgLocId){
                var orgLoc = {};
                orgLoc.id = orgLocId;
                var useFullScreen = ($mdMedia('sm') || $mdMedia('xs')) && $scope.customFullscreen;
                var useFullScreen = $mdMedia('gt-sm');

                var referenceEntityType = "PRESCRIPTION_REFERENCE_FORM";
                var paramObj = {};
                paramObj.nameCode="Prescription";
                httpService.getData(urlService.getParameterizedUrl('GET_PRICE_LIST_SERVICE_TYPES', paramObj),null,
                    function (sucessResponse) {
                        if (sucessResponse) {
                            var serviceTypeId = sucessResponse.data[0].id;
                            var presRef = {};
                            presRef.presRef = prescriptionId
                            httpService.getData(urlService.getParameterizedUrl('GET_PRESCRIPTION_HISTORY_BY_PRESCRIPTION_REF', presRef),null,
                                function (sucessResponse) {
                               if(sucessResponse){
                                   var recordId=sucessResponse.data[0].id;
                                   docMgntService.getFormInstanceDetails(0,recordId, referenceEntityType, orgLoc.id, $rootScope.userSelectedLanguage.id,serviceTypeId,
                                       function (sucessResponse) {
                                           if (sucessResponse) {

                                               if (!utilService.isFieldEmpty($rootScope.userSelectedLanguage.id)) {
                                                   // orbeonFormRunner.loadNewFormRunner(recordId, referenceEntityType, orgLoc.id, $rootScope.userSelectedLanguage.id, prevStateParam, sucessResponse,0);
                                                   $scope.loadFormBuilder(37,sucessResponse.documentId,referenceEntityType,"true");
                                                   //orbeonFormRunner.loadNewFormRunner(recordId, referenceEntityType, orgLoc.id, $rootScope.userSelectedLanguage.id, prevStateParam, sucessResponse,0);
                                                   //$scope.cancel();
                                               }

                                           } else {

                                               // triggerMsgevent only

                                               messaging.triggerMessageEvent(referenceEntityType, recordId, orgLoc.id,
                                                   function (sucessResponse) {
                                                       $state.go('usermedication', {
                                                           type: $state.current.name
                                                       });
                                                   },
                                                   function (error) {

                                                   });
                                           }
                                       },
                                       function (errorResponse) {
                                           console.log(errorResponse);

                                           messaging.triggerMessageEvent(referenceEntityType, recordId, orgLoc.id,
                                               function (sucessResponse) {
                                                   $state.go('emergencymanagement', {
                                                       type: $state.current.name
                                                   });
                                               },
                                               function (error) {

                                               });
                                       });
                               }
                            },
                            function (errorResponse) {
                                console.log(errorResponse);

                            });

                        }
                    },
                    function (errorResponse) {
                        console.log(errorResponse);

                        messaging.triggerMessageEvent(referenceEntityType, recordId, orgLoc.id,
                            function (sucessResponse) {
                                $state.go('emergencymanagement', {
                                    type: $state.current.name
                                });
                            },
                            function (error) {

                            });
                    });








            };*/
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.userMedication.user={},a.userMedication.user.value=a.loginDetails.displayName,a.userMedication.user.id=a.loginDetails.id,a.getSystemOrg()),a.cancel=function(){1==localStorage.whetherParipalAsSubdomain||"true"==localStorage.whetherParipalAsSubdomain?d.go("usermedication"):k.goBackToPrevState()},a.$$phase||a.$apply(),a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherDoctor?(
//$scope.userMedication.prescribedOriginallyBy = $scope.loginDetails.displayName;
a.userMedication.prescribedOriginallyBy.id=a.loginDetails.id,a.userMedication.prescribedOriginallyBy.value=a.loginDetails.displayName,a.userMedication.prescribedOriginallyBy.code=a.loginDetails.userCode,a.userMedication.currentPrescriptionFrom.id=a.loginDetails.id,a.userMedication.currentPrescriptionFrom.value=a.loginDetails.displayName,a.userMedication.currentPrescriptionFrom.code=a.loginDetails.userCode):(a.userMedication.prescribedOriginallyBy="",a.userMedication.currentPrescriptionFrom="");var I=angular.element(document.querySelector("#wizard1")),J=angular.element(document.querySelector("#wizard2")),K=angular.element(document.querySelector("#wizard3"));a.checkMandatory=function(){return document.forms.medicationform.user.validity.valueMissing?(document.forms.medicationform.user.focus(),!0):document.forms.medicationform.medication.validity.valueMissing?(document.forms.medicationform.medication.focus(),!0):!!document.forms.medicationform.dosage.validity.valueMissing&&(document.forms.medicationform.dosage.focus(),!0)},a.checkMandatorySave=function(){
// if (document.forms["medicationform"]["linkageWithFood"].validity.valueMissing) {
//     document.forms["medicationform"]["linkageWithFood"].focus();
//     return true;
// }
/*if(($scope.userMedication.reminder==true) && document.forms["medicationform"]["reminderMode"].validity.valueMissing){
                    document.forms["medicationform"]["reminderMode"].focus();
                    return true;
                }*/
// if (document.forms["medicationform"]["linkageWithFood"].validity.valueMissing) {
//     document.forms["medicationform"]["linkageWithFood"].focus();
//     return true;
// }
/*if(($scope.userMedication.reminder==true) && document.forms["medicationform"]["reminderMode"].validity.valueMissing){
                    document.forms["medicationform"]["reminderMode"].focus();
                    return true;
                }*/
return!(1!=a.userMedication.concernWithReuse||!document.forms.medicationform.concern.validity.valueMissing)&&(document.forms.medicationform.concern.focus(),!0)},a.goToNextStep=function(){return a.userMedication&&a.userMedication.medication&&!a.userMedication.medication.id?void f("error",g.instant("ENTER_VALID_MEDICATION")):a.userMedication&&a.userMedication.disease&&!a.userMedication.disease.id?void f("error",g.instant("ENTER_VALID_DISEASE")):a.userMedication&&a.userMedication.diseaseVariant&&!a.userMedication.diseaseVariant.id?void f("error",g.instant("ENTER_VALID_DISEASE_VARIANT")):a.userMedication.creatingOrganizationId||a.userMedication.creatingOrganizationId.id?a.userMedication&&a.userMedication.stoppedBecause&&!a.userMedication.stoppedBecause.id?void f("error",g.instant("ENTER_VALID_STOPPED_BECAUSE")):!a.userMedication||a.userMedication.beingUsed||a.userMedication.dateStopped?void("view"===c.type||a.checkMandatory()?"view"===c.type&&(a.step1=!1,a.step2=!0,a.step3=!1,I.addClass("btn-default").removeClass("btn-primary"),J.addClass("btn-primary").removeClass("btn-default"),K.addClass("btn-default").removeClass("btn-primary")):(a.step1=!1,a.step2=!0,a.step3=!1,I.addClass("btn-default").removeClass("btn-primary"),J.addClass("btn-primary").removeClass("btn-default"),K.addClass("btn-default").removeClass("btn-primary"))):void f("error",g.instant("SELECT_DATE_STOPPED")):void f("error",g.instant("ENTER_VALID_LOCATION"))},a.goToFirstStep=function(){a.step1=!0,a.step2=!1,a.step3=!1,K.addClass("btn-default").removeClass("btn-primary"),J.addClass("btn-default").removeClass("btn-primary"),I.addClass("btn-primary").removeClass("btn-default")},a.goToThirdStep=function(){a.step1=!1,a.step2=!1,a.step3=!0,I.addClass("btn-default").removeClass("btn-primary"),J.addClass("btn-default").removeClass("btn-primary"),K.addClass("btn-primary").removeClass("btn-default")},a.init=function(){a.manageOrgLocSpinner=!0,a.recordId=!0;var b=w.getDefaultOrgLocation();k.isFieldEmpty(b)||(a.userMedication.creatingOrganizationId=b.orgLoc),a.manageUserSpinner=!0,j.loadContactMode(function(b){a.manageUserSpinner=!1,a.contactModes=b,a.call()},function(b){a.manageUserSpinner=!1})},a.call=function(){if("edit"===c.type&&b.loggedInUserDetails)if(a.editmode=!0,a.hide=!1,a.loginDetails){if(a.userMedication=c.data,a.userMedication.followUpDates=[],a.userMedication&&a.userMedication.whetherDaily)a.userMedication.frequencyPattern="daily";else if(a.userMedication&&a.userMedication.whetherWeekly)a.userMedication.frequencyPattern="weekly";else if(a.userMedication&&a.userMedication.whetherOnSpecificDates){a.userMedication.frequencyPattern="dates";for(var d=0;a.userMedication.userMedicationDates.length>d;d++){var e=new Date(a.userMedication.userMedicationDates[d].medicationDate),h=""+(e.getMonth()+1),j=""+e.getDate(),k=e.getFullYear();h.length<2&&(h="0"+h),j.length<2&&(j="0"+j),a.formattedDate=[k,h,j].join("-")}}
// if($scope.userMedication.dosagePattern){
//     var splitPattern = $scope.userMedication.dosagePattern.split(",")
//     $scope.timePattern = splitPattern;
// }
if(a.userMedication.userMedicationDates&&a.userMedication.userMedicationDates.length>0)for(var d=0;a.userMedication.userMedicationDates.length>d;d++){var l={},m=new Date((new Date).toDateString()+" "+a.userMedication.userMedicationDates[d]),n=m.getHours(),o=m.getMinutes();
//ss = test.getSeconds();
l.medicationTime=(n+":"+o).toString(),a.timePattern.push(l),null!=a.userMedication.id&&(a.userMedication.userMedicationTimes.userMedication={},a.userMedication.userMedicationTimes.userMedication.id=a.userMedication.id)}a.userMedication.medicationVariantName&&(a.userMedication.medicationVariant=a.userMedication.medicationVariantName),a.rmMode=[],
//$scope.userMedication.prescribedOriginallyBy ={};
//$scope.userMedication.currentPrescriptionFrom ={};
a.userMedication.prescribedOriginallyBy=a.loginDetails.displayName,a.userMedication.currentPrescriptionFrom=a.loginDetails.displayName}else a.userMedication.requesterType="Guest";if("view"===c.type&&b.loggedInUserDetails&&(a.userMedication=c.data,a.viewmode=!0,a.isVisible=!1,a.hide=!1),"add"===c.type&&(a.orgLocPermission=p.USER_MEDICATION_ADD),c.data){if(a.user={},a.userMedication=c.data,a.manageOrgLocSpinner=!1,a.orgLoc=a.userMedication.location,a.rmMode=[],a.userMedication.followUpDates=[],a.userMedication&&a.userMedication.whetherDaily)a.userMedication.frequencyPattern="daily";else if(a.userMedication&&a.userMedication.whetherWeekly)a.userMedication.frequencyPattern="weekly";else if(a.userMedication&&a.userMedication.whetherOnSpecificDates){a.userMedication.frequencyPattern="dates";for(var d=0;a.userMedication.userMedicationDates.length>d;d++){var e=new Date(a.userMedication.userMedicationDates[d].medicationDate),h=""+(e.getMonth()+1),j=""+e.getDate(),k=e.getFullYear();h.length<2&&(h="0"+h),j.length<2&&(j="0"+j),a.formattedDate=[k,h,j].join("-")}}
// if($scope.userMedication.dosagePattern){
//     var splitPattern = $scope.userMedication.dosagePattern.split(",")
//     $scope.timePattern = splitPattern;
// }
if(a.userMedication.userMedicationDates&&a.userMedication.userMedicationDates.length>0)for(var d=0;a.userMedication.userMedicationDates.length>d;d++){var l={},m=new Date((new Date).toDateString()+" "+a.userMedication.userMedicationDates[d]),n=m.getHours(),o=m.getMinutes();
//ss = test.getSeconds();
l.medicationTime=(n+":"+o).toString(),a.timePattern.push(l),null!=a.userMedication.id&&(a.userMedication.userMedicationTimes.userMedication={},a.userMedication.userMedicationTimes.userMedication.id=a.userMedication.id)}if(a.userMedication.medicationVariantName&&(a.userMedication.medicationVariant=a.userMedication.medicationVariantName),a.userMedication.reminderMode){for(var d=0;a.userMedication.reminderMode.length>d;d++)a.rmMode.push(a.userMedication.reminderMode[d].contactMode.id);a.userMedication.reminderMode=a.rmMode}a.setData(c.data),a.userMedication.creatingOrganizationId&&a.userMedication.creatingOrganizationId.id||!a.userMedication.locationRecordValue||(a.userMedication.creatingOrganizationId=a.userMedication.locationRecordValue)}c.id&&i.getUserMedicationById(c.id,function(b){
// $scope.setData();
if(a.manageOrgLocSpinner=!1,a.userMedication=b,a.setData(a.userMedication),a.userMedication.creatingOrganizationId&&a.userMedication.creatingOrganizationId.id||!a.userMedication.locationRecordValue||(a.userMedication.creatingOrganizationId=a.userMedication.locationRecordValue),a.userMedication&&a.userMedication.currentPrescriptionFromValue&&(a.userMedication.currentPrescriptionFrom=a.userMedication.currentPrescriptionFromValue),a.userMedication&&a.userMedication.prescribedOriginallyByValue&&(a.userMedication.prescribedOriginallyBy=a.userMedication.prescribedOriginallyByValue),a.userMedication.dosagePattern){var c=a.userMedication.dosagePattern.split(",");a.timePattern=c}if(a.userMedication.medicationVariantName&&(a.userMedication.medicationVariant=a.userMedication.medicationVariantName),a.rmMode=[],a.userMedication.followUpDates=[],a.userMedication&&a.userMedication.whetherDaily)a.userMedication.frequencyPattern="daily";else if(a.userMedication&&a.userMedication.whetherWeekly)a.userMedication.frequencyPattern="weekly";else if(a.userMedication&&a.userMedication.whetherOnSpecificDates){a.userMedication.frequencyPattern="dates";for(var d=0;a.userMedication.userMedicationDates.length>d;d++){var e=new Date(a.userMedication.userMedicationDates[d].medicationDate),f=""+(e.getMonth()+1),g=""+e.getDate(),h=e.getFullYear();f.length<2&&(f="0"+f),g.length<2&&(g="0"+g),a.formattedDate=[h,f,g].join("-"),a.userMedication.followUpDates.push(a.formattedDate)}}if(a.userMedication.reminderMode){for(var d=0;a.userMedication.reminderMode.length>d;d++)a.rmMode.push(a.userMedication.reminderMode[d].contactMode.id);a.userMedication.reminderMode=a.rmMode}},function(b){a.manageOrgLocSpinner=!1,a.error=b,f("error",g.instant("ORG_LOC_FETCH_FAILURE"))}),"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||y()},a.init(),
// $scope.appendDates = function(dateobj){
//             if(!$scope.userMedication.followUpDates.includes(dateobj)){
//                 $scope.userMedication.followUpDates.push(dateobj);
//                 $scope.multipleDates = '';
//             }
//         }
a.appendDates=function(b){
//if(!$scope.userMedication.followUpDates.includes(dateobj)){
var c=new Date(b),d=""+(c.getMonth()+1),e=""+c.getDate(),f=c.getFullYear();d.length<2&&(d="0"+d),e.length<2&&(e="0"+e),a.finalDate=[f,d,e].join("-"),a.userMedication.followUpDates.includes(a.finalDate)||a.userMedication.followUpDates.push(a.finalDate)},a.setData=function(b){a.drugVariantId={},b.medicationVariant&&b.medicationVariant.id&&(a.drugVariantId=b.medicationVariant.id),b.medication&&b.medication.id&&a.getVariant(b.medication.id),b.reminderMode&&b.reminderMode.id&&(a.reminderMode=b.reminderMode.id),a.getFood(),a.getStoppageReason()},a.getDoctor=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){a.queryObj={},a.queryObj.searchString=b;
//var url = urlService.getParameterizedUrl('FIND_ALL_PROFSSIONAL_BY_USER', $scope.queryObj);
var c=l.getParameterizedUrl("GET_ADVISED_BY_SEACRH_KEY",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.doctor=b.data,a.doctor},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}else{a.queryObj={},a.queryObj.searchString=b,a.queryObj.type=a.userMedication.creatingOrganizationId.id;
//$scope.queryObj.searchString = doctorName;
//$scope.queryObj.orgLocationId = $scope.userMedication.creatingOrganizationId.id;
//var professionType = "whetherDoctor";
//$scope.queryObj.professionType = professionType;
//var url = urlService.getParameterizedUrl('FIND_ORG_DOCTORS', $scope.queryObj);
var c=l.getParameterizedUrl("GET_PROFESSIONAlS_BY_ORGLOCID",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.doctor=b.data,a.doctor},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}},
// $scope.getUserNamesForRoleHistory = function(viewValue) {
//     var userData = {};
//     userData.searchString = viewValue;
//     $scope.userNameAutoCmpLoading = true;
//     return httpService.getData(urlService
//             .getParameterizedUrl(
//                     'GET_PATIENTS_LIST_BY_SEACRH_KEY',
//                     userData), null, function(response) {
//         $scope.userNameAutoCmpLoading = false;
//         // return $scope.users =
//         // angular.fromJson(response.data);
//         return $scope.users = response.data;
//     }, function(error) {
//         $scope.userNameAutoCmpLoading = false;
//         if (!utilService.isEmpty(error.data)
//                 && !utilService
//                         .isEmpty(error.data.messages[0])) {
//             notify("Alert", $translate
//                     .instant(error.data.messages[0]));
//         }
//     });
// }
a.getUserNamesForRoleHistory=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)
//return httpService.getData(urlService.getParameterizedUrl('FIND_USER_NAME', $scope.userData), null, function (response) {
return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",g.instant(b.data.messages[0]))})},a.clearDrugVariant=function(){a.userMedication.medicationVariant=""},
// function getStoppageReason(reasonValue) {
//     $scope.stoppageReason = {};
//     $scope.stoppageReason.searchKeyWord = reasonValue;
//     var url = urlService.getParameterizedUrl(
//         'GET_STOPPED_BECAUSE_LIST_BY_KEYWORD',
//         $scope.stoppageReason);
//     if (url) {
//         return httpService.getData(url, null, function (
//             response) {
//             if (response && response.data) {
//                 $scope.stoppageReason = response.data;
//                 return $scope.stoppageReason;
//             }
//         }, function (error) {});
//     }
// };
a.getStoppageReason=function(){var b=l.getUrl("GET_STOPPED_BECAUSE_LIST_DROPDOWN");b&&m.getData(b,null,function(b){b&&b.data&&(a.stoppageReason=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getStoppageReason(),a.getFood=function(){var b=l.getUrl("GET_LINKED_TO_FOOD_LIST_DROPDOWN");b&&m.getData(b,null,function(b){b&&b.data&&(a.linkageWithFood=b.data)},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getFood(),
// function getVariant(id) {
//     $scope.queryObj = {};
//     $scope.queryObj.id = id;
//     var url = urlService.getParameterizedUrl(
//         'GET_MED_VARIANT_LIST_BY_KEYWORD',
//         $scope.queryObj);
//     if (url) {
//         httpService.getData(url,null,function (response) {
//             if (response && response.data) {
//                 $scope.medicationVariant = response.data;
//             }
//         },
//         function (error) {
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                 notify("error",$translate.instant(error.data.messages[0]));
//             }
//         });
//     }
// }
// function getVariant(id) {
//     $scope.queryObj = {};
//     $scope.queryObj.id = id;
//     var url = urlService.getParameterizedUrl(
//         'GET_MED_VARIANT_LIST_BY_KEYWORD',
//         $scope.queryObj);
//     if (url) {
//         httpService.getData(url,null,function (response) {
//             if (response && response.data) {
//                 $scope.medicationVariant = response.data;
//             }
//         },
//         function (error) {
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                 notify("error",$translate.instant(error.data.messages[0]));
//             }
//         });
//     }
// }
a.saveUserMedication=function(){if(!a.checkMandatorySave()){
// if ($scope.userMedication.currentPrescriptionFrom && $scope.loginDetails.userAccountStatusDTO.whetherSubscriber && !$rootScope.loggedInUserDetails.isOrganizationUserMode) {
//     $scope.userMedication.currentPrescriptionFrom = {};
//     //$scope.userMedication.currentPrescriptionFrom.value = $scope.loginDetails.displayName;
//     $scope.userMedication.currentPrescriptionFrom = $scope.doctor[0];
//     //$scope.userMedication.currentPrescriptionFrom.id = $scope.loginDetails.id;
// } else {
//     $scope.userMedication.currentPrescriptionFrom = {};
//     $scope.userMedication.currentPrescriptionFrom.id = $scope.loginDetails.id;
// }
// if ($scope.userMedication.prescribedOriginallyBy && $scope.loginDetails.userAccountStatusDTO.whetherSubscriber && !$rootScope.loggedInUserDetails.isOrganizationUserMode) {
//     $scope.userMedication.prescribedOriginallyBy = {};
//     //$scope.userMedication.prescribedOriginallyBy.value = $scope.loginDetails.displayName;
//     $scope.userMedication.prescribedOriginallyBy = $scope.doctor[0];
// } else {
//     $scope.userMedication.prescribedOriginallyBy = {};
//     $scope.userMedication.prescribedOriginallyBy.id = $scope.loginDetails.id;
// }
if(a.userMedication&&a.userMedication.prescribedOriginallyBy&&!a.userMedication.prescribedOriginallyBy.id&&b.loggedInUserDetails.isOrganizationUserMode)return void f("error",g.instant("ENTER_VALID_ORGINALLY_PRESCRIBED_BY"));if(a.userMedication&&a.userMedication.currentPrescriptionFrom&&!a.userMedication.currentPrescriptionFrom.id&&b.loggedInUserDetails.isOrganizationUserMode)return void f("error",g.instant("ENTER_VALID_CURRENT_PRESCRIPTION_FROM"));if(a.userMedication.currentPrescriptionFrom&&!a.userMedication.currentPrescriptionFrom.id&&(a.userMedication.currentPrescriptionFromValue={},a.userMedication.currentPrescriptionFromValue=a.userMedication.currentPrescriptionFrom,delete a.userMedication.currentPrescriptionFrom),a.userMedication.prescribedOriginallyBy&&!a.userMedication.prescribedOriginallyBy.id&&(a.userMedication.prescribedOriginallyByValue={},a.userMedication.prescribedOriginallyByValue=a.userMedication.prescribedOriginallyBy,delete a.userMedication.prescribedOriginallyBy),a.userMedication.disease&&(delete a.userMedication.disease.organizationLocationId,delete a.userMedication.disease.value,delete a.userMedication.disease.code),a.userMedication.diseaseVariant&&(delete a.userMedication.diseaseVariant.organizationLocationId,delete a.userMedication.diseaseVariant.value,delete a.userMedication.diseaseVariant.code),a.userMedication.linkageWithFood&&(delete a.userMedication.linkageWithFood.organizationLocationId,delete a.userMedication.linkageWithFood.value,delete a.userMedication.linkageWithFood.code),a.userMedication.creatingOrganizationId&&(a.userMedication.creatingOrganizationId=a.userMedication.creatingOrganizationId,delete a.userMedication.creatingOrganizationId.organizationLocationId,delete a.userMedication.creatingOrganizationId.value,delete a.userMedication.creatingOrganizationId.code),null!=a.timePattern){a.userMedication.dosagePattern=a.timePattern.toString(),
//if($scope.userMedication.id != null){
a.userMedication.userMedicationTimes=[];
//}
for(var e=0;a.timePattern.length>e;e++){var h={},i=new Date((new Date).toDateString()+" "+a.timePattern[e]),l=i.getHours(),m=i.getMinutes(),o=i.getSeconds();h.medicationTime=(l+":"+m+":"+o).toString(),
// $scope.userMedication.userMedicationTimes.push(obj);
null!=a.userMedication.id&&(h.userMedication={},h.userMedication.id=a.userMedication.id),a.userMedication.userMedicationTimes.push(h)}}if(a.userMedication.creatingOrganizationId&&!a.userMedication.creatingOrganizationId.id&&(a.userMedication.locationRecordValue=a.userMedication.creatingOrganizationId,delete a.userMedication.creatingOrganizationId),/*if($scope.userMedication.prescribedOriginallyBy){
                        delete $scope.userMedication.prescribedOriginallyBy.value;
                    }*/
a.userMedication.medication&&(delete a.userMedication.medication.organizationLocationId,delete a.userMedication.medication.code,delete a.userMedication.medication.value),a.userMedication.user&&(
// if($scope.loginDetails.whetherSubscriber = true){
//     $scope.userMedication.user.id = $scope.loginDetails.id;
// }
delete a.userMedication.user.organizationLocationId,delete a.userMedication.user.value,delete a.userMedication.user.code),/*if($scope.userMedication.currentPrescriptionFrom){

                        delete $scope.userMedication.currentPrescriptionFrom.value;
                    }*/
a.userMedication.stoppedBecause&&(delete a.userMedication.stoppedBecause.organizationLocationId,delete a.userMedication.stoppedBecause.value,delete a.userMedication.stoppedBecause.code),"daily"==a.userMedication.frequencyPattern)a.userMedication.whetherDaily=!0,a.userMedication.whetherWeekly=!1,a.userMedication.whetherOnSpecificDates=!1,a.userMedication.userMedicationDates=[],a.userMedication.onMonday=!1,a.userMedication.onTuesday=!1,a.userMedication.onWednesday=!1,a.userMedication.onThursday=!1,a.userMedication.onFriday=!1,a.userMedication.onSaturday=!1,a.userMedication.onSunday=!1;else if("weekly"==a.userMedication.frequencyPattern)a.userMedication.whetherWeekly=!0,a.userMedication.whetherDaily=!1,a.userMedication.whetherOnSpecificDates=!1,a.userMedication.userMedicationDates=[];else if("dates"==a.userMedication.frequencyPattern&&(a.userMedication.whetherOnSpecificDates=!0,a.userMedication.whetherDaily=!1,a.userMedication.whetherWeekly=!1,a.userMedication.onMonday=!1,a.userMedication.onTuesday=!1,a.userMedication.onWednesday=!1,a.userMedication.onThursday=!1,a.userMedication.onFriday=!1,a.userMedication.onSaturday=!1,a.userMedication.onSunday=!1,a.userMedication.followUpDates.length>0)){
// if($scope.userMedication.id != null){
a.userMedication.userMedicationDates=[];
//}
for(var e=0;a.userMedication.followUpDates.length>e;e++){var h={};h.medicationDate=a.userMedication.followUpDates[e],
// $scope.userMedication.userMedicationDates.push(obj);
null!=a.userMedication.id&&(h.userMedication={id:a.userMedication.id}),a.userMedication.userMedicationDates.push(h)}}if(delete a.userMedication.organizationLocationId,a.userMedication.prescribedDate=n.convertToServerDate(a.userMedication.prescribedDate),a.userMedication.startDate=n.convertToServerDate(a.userMedication.startDate),a.userMedication.dateStopped=n.convertToServerDate(a.userMedication.dateStopped),
// $scope.userMedication.plannedStoppedDate = dateconvertor
//                    .convertToServerDate($scope.userMedication.plannedStoppedDate);
!k.isEmpty(a.userMedication)&&a.userMedicationFile&&a.userMedicationFile.fileToBeUpload&&(a.userMedication.uploadPrescription=a.userMedicationFile.fileToBeUpload.name),a.userMedication&&a.userMedication.medicationVariant&&a.userMedication.medicationVariant.id){var p=a.userMedication.medicationVariant;a.userMedication.medicationVariant={},a.userMedication.medicationVariant.id=p.id,delete a.userMedication.medicationVariantName}else a.userMedication.medicationVariantName=a.userMedication.medicationVariant,delete a.userMedication.medicationVariant;if(null!=a.userMedication.id&&a.userMedication.reminderMode&&a.getContact(a.userMedication.reminderMode,a.contactModes),!a.userMedication.id&&a.userMedication.reminderMode&&a.getContact(a.userMedication.reminderMode,a.contactModes),a.userMedication.reminderMode){a.reminderMode=[],a.obj={};for(var e=0;a.userMedication.reminderMode.length>e;e++)a.userMedication.reminderMode[e].contactMode={},a.userMedication.reminderMode[e].contactMode.code=a.userMedication.reminderMode[e].value,a.userMedication.reminderMode[e].contactMode.id=a.userMedication.reminderMode[e].id,a.userMedication.id||delete a.userMedication.reminderMode[e].id,null!=a.userMedication.id&&(delete a.userMedication.reminderMode[e].id,a.userMedication.reminderMode[e].userMedication={},a.userMedication.reminderMode[e].userMedication.id=a.userMedication.id),delete a.userMedication.reminderMode[e].code,delete a.userMedication.reminderMode[e].value}if(!k.isEmpty(a.userMedication)&&a.userMedicationFile&&a.userMedicationFile.fileToBeUpload&&(a.userMedicationFile.uploadPrescription=a.userMedicationFile.fileToBeUpload.name),a.userMedicationFile.fileToBeUpload)a.documentUpload.document.fileName=a.userMedicationFile.fileToBeUpload.name,a.documentUpload.document.fileSize=a.userMedicationFile.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.userMedication.creatingOrganizationId.id,a.documentUpload.document.documentType={subType:q.documentSubTypes.userMedication},"add"!=c.type&&a.userMedication.document&&(a.documentUpload.document.id=a.userMedication.document.id),j.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.userMedicationFile.fileToBeUpload&&(
//$scope.uploadFile($scope.documentUploadFile, response);
a.userMedicationFile&&a.userMedicationFile.fileToBeUpload&&a.userMedicationFile.fileToBeUpload.name&&a.uploadFile(a.userMedicationFile,a.userMedication,b),a.userMedication&&a.userMedication.id?f("success",g.instant("RECORD_UPDATED_SUCCESS")):f("success",g.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1});else{if(a.userMedication&&a.userMedication.linkageWithFood&&!a.userMedication.linkageWithFood.id)return void f("error",g.instant("ENTER_VALID_LINKED_TO_FOOD"));j.saveUserMedication(a.userMedication,function(a){k.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),d.go("usermedication"))},function(a){c.type="add",k.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})}}},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},
// clear notification mode
a.resetNotificationMode=function(){delete a.userMedication.reminderMode},a.resetConcern=function(){delete a.userMedication.natureOfConcern},a.resetFiledsBasedOnBeingUsed=function(){a.userMedication.replacedWith&&delete a.userMedication.replacedWith,a.userMedication.stoppedBecause&&delete a.userMedication.stoppedBecause,a.userMedication.dateStopped&&delete a.userMedication.dateStopped},a.getContact=function(b,c){for(var d=[],e=0;b.length>e;e++)for(var f=0;c.length>f;f++)if(b[e]==c[f].id){var g={};g.id=c[f].id,g.code=c[f].code,g.value=c[f].value,d.push(g)}a.userMedication.reminderMode=d}}]),angular.module("paripal.userMedicationModule").controller("viewUserMedicationCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","urlService","viewUserMedicationService","$mdMedia","docMgntService","serverSidePagination","utilService","featurePrivilegeConstants","$mdDialog","$timeout","commonConstants","MakePrescriptionFactory","baseService","$mdpTimePicker","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(b,c){var b={id:b};viewUserMedicationServices.removeUserMedication(b,function(b){b&&(a.userMedication.splice(c,1),f("success",g.instant("RECORD_DELETED_SUCCESSFULLY")))},function(a){f("error",g.instant(a.data.messages[0]))})}function y(){i.getData(j.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){a.accessabelSystemLocation=b.data,a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&(a.whetherAccessbleUser=!0)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function z(b){var c=!1;return a.accessabelSystemLocation&&!o.isEmpty(a.accessabelSystemLocation)&&a.accessabelSystemLocation.forEach(function(a){a&&b&&a.id==b&&(c=!0)}),c}function A(b){a.diseaseId=b}function B(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.diseaseId,a.diseaseVariantLoad=!0,i.getData(j.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}if(a.userMedication={},a.getDiseaseVariant=B,a.disase={},a.minDate=new Date,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.calendarFilter={},a.maxDate=new Date,a.minDate=new Date,a.removeUserMedication=x,a.fromMaxDate=new Date,a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.user="",a.checkOrganizationLocationAccess=z,a.getAccessabelSystemLocation=y,a.orgLocPermission=p.USER_MEDICATION_ADD,a.whetherAccessbleUser=!1,a.getDiseaseId=A,a.diseaseId={},a.disable=!0,a.userMedication.current="all",
//$scope.userMedication.allRecords = 'All';
//$scope.listView = true;
//$scope.cardView = false;
a.status={open:!1},
// $(".pushme").click(function () {
//     $(this).text(function (i, v) {
//         if (v === 'Card view') {
//             $scope.cardView = true;
//             $scope.listView = false;
//         } else {
//             $scope.cardView = false;
//             $scope.listView = true;
//         }
//         return v === 'Card view' ? 'List View' : 'Card view'
//     })
// });
// if(){
// }
$(document).ready(function(){
//$(".cardViewClss").hide();
window.matchMedia("(max-width: 600px)").matches?r(function(){$(".cardViewCls").hide(),$(".listViewClss").hide(),$(".listViewCls").show(),$(".cardViewClss").show()},1e3):r(function(){$(".cardViewCls").show(),$(".listViewCls").hide(),$(".listViewClss").show(),$(".cardViewClss").hide()},1e3),
//$(".cardViewClss").hide();
//$(".listViewClss").show();
$(".listViewCls").click(function(){$(".listViewCls").hide(),$(".cardViewCls").show(),$(".cardViewClss").hide(),$(".listViewClss").show()}),$(".cardViewCls").click(function(){$(".cardViewCls").hide(),$(".listViewCls").show(),$(".cardViewClss").show(),$(".listViewClss").hide()})}),
//$scope.loginDetails = $rootScope.loggedInUserDetails;
u.validateListing("ONGOING_MEDICATION_RECORD_SUB"),a.loginDetails=b.loggedInUserDetails,a.userReadOnly=!1,a.loginDetails.isOrganizationUserMode&&(a.isOrganizationUser=!0),
//for individual sub
a.loginDetails&&1==a.loginDetails.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.userMedication.user={},a.userMedication.user.value=b.loggedInUserDetails.displayName,a.userMedication.user.id=b.loggedInUserDetails.id),c.user)if(b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode){var C=c.user;a.userMedication.user={},a.userMedication.user.id=C.userid,a.userMedication.user.value=C.value}else if(b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode){c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1;var C=c.user;a.userMedication.user={},a.userMedication.user.id=C.userid,a.userMedication.user.value=C.value}a.addNewUserMedication=function(a){q.show({templateUrl:"app/modules/user-medication/views/user-medication-summary-popup.html",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{type:"add",userId:a.user},controller:["$scope","$mdDialog","locals","dateconvertor","manageUserMedicationService","$mdpTimePicker",function(a,e,h,k,l,m){function n(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,i.getData(j.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)
//$scope.userMedication.creatingOrganizationId.value = response.data[0].value;
//$scope.system = response.data[0].id;
return a.userMedication.creatingOrganizationId=b.data[0],a.userMedication.creatingOrganizationId},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function p(b){return a.medication={},""==b?a.medication.searchKeyWord=void 0:a.medication.searchKeyWord=b,a.medication.medicationId=a.userMedication.medication.id,a.medicationLoad=!0,i.getData(j.getParameterizedUrl("GET_MEDICATIONVARIANT_BY_MEDICATIONID",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}function q(b){a.searchKeyWord={},a.searchKeyWord.diseaseVariantId=b;var c=j.getParameterizedUrl("FIND_DISEASE_BY_VARIANT_ID",a.searchKeyWord);if(c)return i.getData(c,null,function(b){b&&b.data&&(a.userMedication.disease=b.data)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function r(b){return a.medication={},a.medication.medication=b,a.medicationLoad=!0,i.getData(j.getParameterizedUrl("SEARCH_MEDICATION",a.medication),null,function(b){return a.medicationLoad=!1,a.medications=angular.fromJson(b.data)},function(b){a.medicationLoad=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}function t(){if(a.userMedication&&a.userMedication.user&&!a.userMedication.user.id&&b.loggedInUserDetails.isOrganizationUserMode)return void f("error",g.instant("INVALID_USER"));if(a.userMedication&&a.userMedication.medication&&!a.userMedication.medication.id&&b.loggedInUserDetails.isOrganizationUserMode)return void f("error",g.instant("ENTER_VALID_MEDICATION"));if(a.userMedication&&a.userMedication.prescribedOriginallyBy&&!a.userMedication.prescribedOriginallyBy.id&&b.loggedInUserDetails.isOrganizationUserMode)return void f("error",g.instant("ENTER_VALID_ORGINALLY_PRESCRIBED_BY"));if(a.userMedication&&a.userMedication.currentPrescriptionFrom&&!a.userMedication.currentPrescriptionFrom.id&&b.loggedInUserDetails.isOrganizationUserMode)return void f("error",g.instant("ENTER_VALID_CURRENT_PRESCRIPTION_FROM"));if(a.userMedication.currentPrescriptionFrom&&!a.userMedication.currentPrescriptionFrom.id&&(a.userMedication.currentPrescriptionFromValue={},a.userMedication.currentPrescriptionFromValue=a.userMedication.currentPrescriptionFrom,delete a.userMedication.currentPrescriptionFrom),null!=a.timePattern){a.userMedication.dosagePattern=a.timePattern.toString();for(var h=0;a.timePattern.length>h;h++){var i={},j=new Date((new Date).toDateString()+" "+a.timePattern[h]),m=j.getHours(),n=j.getMinutes(),p=j.getSeconds();i.medicationTime=(m+":"+n+":"+p).toString(),a.userMedication.userMedicationTimes.push(i),null!=a.userMedication.id&&(a.userMedication.userMedicationTimes.userMedication={},a.userMedication.userMedicationTimes.userMedication.id=a.userMedication.id)}}if(a.userMedication.prescribedOriginallyBy&&!a.userMedication.prescribedOriginallyBy.id&&(a.userMedication.prescribedOriginallyByValue={},a.userMedication.prescribedOriginallyByValue=a.userMedication.prescribedOriginallyBy,delete a.userMedication.prescribedOriginallyBy),a.userMedication.disease&&(delete a.userMedication.disease.organizationLocationId,delete a.userMedication.disease.value,delete a.userMedication.disease.code),a.userMedication.diseaseVariant&&(delete a.userMedication.diseaseVariant.organizationLocationId,delete a.userMedication.diseaseVariant.value,delete a.userMedication.diseaseVariant.code),a.userMedication.linkageWithFood&&(delete a.userMedication.linkageWithFood.organizationLocationId,delete a.userMedication.linkageWithFood.value,delete a.userMedication.linkageWithFood.code),a.userMedication.creatingOrganizationId&&(a.userMedication.creatingOrganizationId=a.userMedication.creatingOrganizationId,delete a.userMedication.creatingOrganizationId.organizationLocationId,delete a.userMedication.creatingOrganizationId.value,delete a.userMedication.creatingOrganizationId.code),a.userMedication.creatingOrganizationId&&!a.userMedication.creatingOrganizationId.id&&(a.userMedication.locationRecordValue=a.userMedication.creatingOrganizationId,delete a.userMedication.creatingOrganizationId),a.userMedication.medication&&delete a.userMedication.medication.organizationLocationId,a.userMedication.user&&(delete a.userMedication.user.organizationLocationId,delete a.userMedication.user.value,delete a.userMedication.user.code),a.userMedication.stoppedBecause&&(delete a.userMedication.stoppedBecause.organizationLocationId,delete a.userMedication.stoppedBecause.value,delete a.userMedication.stoppedBecause.code),"daily"==a.userMedication.frequencyPattern)a.userMedication.whetherDaily=!0;else if("weekly"==a.userMedication.frequencyPattern)a.userMedication.whetherWeekly=!0;else if("dates"==a.userMedication.frequencyPattern&&(a.userMedication.whetherOnSpecificDates=!0,a.userMedication.followUpDates.length>0))for(var h=0;a.userMedication.followUpDates.length>h;h++){var i={};i.medicationDate=a.userMedication.followUpDates[h],a.userMedication.userMedicationDates.push(i),null!=a.userMedication.id&&(
//delete $scope.userMedication.reminderMode[i].id;
a.userMedication.userMedicationDates.userMedication={},a.userMedication.userMedicationDates.userMedication.id=a.userMedication.id)}if(delete a.userMedication.organizationLocationId,a.userMedication.prescribedDate=k.convertToServerDate(a.userMedication.prescribedDate),a.userMedication.plannedStoppedDate=k.convertToServerDate(a.userMedication.plannedStoppedDate),a.userMedication.startDate=k.convertToServerDate(a.userMedication.startDate),a.userMedication.dateStopped=k.convertToServerDate(a.userMedication.dateStopped),a.userMedication.beingUsed=!0,!o.isEmpty(a.userMedication)&&a.userMedicationFile&&a.userMedicationFile.fileToBeUpload&&(a.userMedication.uploadPrescription=a.userMedicationFile.fileToBeUpload.name),a.userMedication&&a.userMedication.medicationVariant&&a.userMedication.medicationVariant.id){var q=a.userMedication.medicationVariant;a.userMedication.medicationVariant={},a.userMedication.medicationVariant.id=q.id}else a.userMedication.medicationVariantName=a.userMedication.medicationVariant,delete a.userMedication.medicationVariant;return a.userMedication&&a.userMedication.linkageWithFood&&!a.userMedication.linkageWithFood.id?void f("error",g.instant("ENTER_VALID_LINKED_TO_FOOD")):void l.saveUserMedication(a.userMedication,function(a){o.isNullOrEmpty(a.successMessage)||(f("success",g.instant(a.successMessage)),e.hide(),d.reload())},function(a){c.type="add",o.isNullOrEmpty(a.data.message[0])||f("alert",g.instant(a.data.message[0]))})}if(a.userMedication={},a.getSystemOrg=n,
//$scope.getFood = getFood;
a.getDisease=q,a.saveUserMedication=t,a.loginDetails=b.loggedInUserDetails,a.getMedications=r,a.getVariant=p,a.userMedication.followUpDates=[],a.userMedication.userMedicationDates=[],a.userMedication.userMedicationTimes=[],a.readonlyDates=!1,a.multipleDates,a.userMedication.frequencyPattern="daily",a.time,a.userMedication.startDate=new Date,a.minVariantLength=s.typeaheadMinLength0,
//$scope.time = new Date();
a.timePattern=[],a.pushTimeObj=function(b){var c=a.time.twentyfour,d=c.getHours()+":"+c.getMinutes();a.timePattern.includes(d)||a.timePattern.push(d)},b.$on("medicationTime",function(b,c){var d=c,e=d.getHours()+":"+d.getMinutes();a.timePattern.includes(e)||a.timePattern.push(e)}),a.time={twentyfour:new Date},a.time.twentyfour.setMinutes(30),a.appendDates=function(b){
//if(!$scope.userMedication.followUpDates.includes(dateobj)){
var c=new Date(b),d=""+(c.getMonth()+1),e=""+c.getDate(),f=c.getFullYear();d.length<2&&(d="0"+d),e.length<2&&(e="0"+e),a.finalDate=[f,d,e].join("-"),a.userMedication.followUpDates.includes(a.finalDate)||a.userMedication.followUpDates.push(a.finalDate)},a.showDatePicker=function(){a.isDatepickerOpen=!a.isDatepickerOpen},a.showDocDetails=function(){a.visibleDocDetails=!a.visibleDocDetails},a.showDiseaseDetails=function(){a.visibleDiseaseDetails=!a.visibleDiseaseDetails},a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)a.whethersub=!0,a.userMedication.user={},a.userMedication.user.value=a.loginDetails.displayName,a.userMedication.user.id=a.loginDetails.id,a.getSystemOrg();else{var v=u.getDefaultOrgLocation();o.isFieldEmpty(v)||(a.userMedication.creatingOrganizationId=v.orgLoc)}h.userId&&(a.userMedication.user=h.userId),a.cancel1=function(){e.cancel()},a.getUserNamesForRoleHistory=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)
//return httpService.getData(urlService.getParameterizedUrl('FIND_USER_NAME', $scope.userData), null, function (response) {
return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,i.getData(j.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,i.getData(j.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||f("Alert",g.instant(b.data.messages[0]))})},a.getDiseaseVariant=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=j.getParameterizedUrl("GET_DISEASE_VARIANTS_BY_SEARCHWORD",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getDoctor=function(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){a.queryObj={},a.queryObj.searchString=b;var c=j.getParameterizedUrl("GET_ADVISED_BY_SEACRH_KEY",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.doctor=b.data,a.doctor},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}else{a.queryObj={},a.queryObj.name=b,a.queryObj.locationId=a.userMedication.creatingOrganizationId.id;var c=j.getParameterizedUrl("GET_DOCTOR_BY_ORGLOCID",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.doctor=b.data,a.doctor},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}},a.getFood=function(){var b=j.getUrl("GET_LINKED_TO_FOOD_LIST_DROPDOWN");b&&i.getData(b,null,function(b){b&&b.data&&(a.linkageWithFood=b.data)},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getFood(),a.callManageMedication=function(b){a.newMedication=b,a.newMedication.beingUsed=!0,e.cancel(),d.go("manageusermedication",{type:"add",data:a.newMedication})}}]})},a.otherActionMedStat=function(){d.go("viewMedicationStatistics",{type:""})},a.otherActionMed=function(){d.go("searchDiseaseMedication",{type:""})},a.otherActionMedSideEffect=function(){d.go("searchDiseaseMedication",{type:""})},a.otherActionMedication=function(){d.go("manageusermedication",{type:""})},a.getUserNamesForRoleHistory=function(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,i.getData(j.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,o.isEmpty(b.data)||o.isEmpty(b.data.messages[0])||f("Alert",g.instant(b.data.messages[0]))})},a.validateRemoveUserMedication=function(b,c,d,e){
// Check the role of the user.. Patient or Organisational User
// 
var f=!1;if(a.indsub)c==a.loginDetails.id&&(f=!0);else if(a.isOrganizationUser)if(c==a.loginDetails.id)f=!0;else{var g=u.getDefaultOrgLocation();o.isFieldEmpty(g)||g.orgLoc.id==d&&(f=!0)}f&&a.inActivate(b,e)},a.fetchRecords=function(b){if(a.userMedication&&a.userMedication.user&&!a.userMedication.user.id)return void f("error",g.instant("INVALID_USER"));if(a.userMedication&&a.userMedication.diseaseId&&!a.userMedication.diseaseId.id)return void f("error",g.instant("INVALID_DISEASE"));if(a.userMedication&&a.userMedication.diseaseVariant&&!a.userMedication.diseaseVariant.id)return void f("error",g.instant("INVALID_DISEASE_VARIANT"));var c=angular.copy(b);c||(c={}),a.userMedication&&a.userMedication.user&&(c.user=a.userMedication.user.id),
// //For Vpr
// if($scope.userMedication.orgLocation){
//   filterVaccine.orgLocation = $scope.userMedication.orgLocation;
// }
a.userMedication.diseaseId&&a.userMedication.diseaseId.id&&(c.diseaseId=a.userMedication.diseaseId.id),a.userMedication&&a.userMedication.diseaseVariant&&(c.diseaseVariant=b.diseaseVariant.id),a.userMedication&&1==a.userMedication.current&&(c.current="current"),a.userMedication&&0==a.userMedication.current&&(c.current="stopped"),c.pageNumber=a.currentPage,c.recordsPerPage=a.itemPerPage,k.fetchRecords(c,function(b){b&&(r(function(){a.userMedicationList=b.data},100),a.totalItems=b.totalRecords,a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems))},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("Alert",g.instant(a.data.messages[0]))})},a.manageUserMedication=function(a,b){k.getUserMedicationById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageusermedication",{id:a,type:e,data:f})},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("Alert",g.instant(a.data.messages[0]))})},a.clear=function(){a.userMedication={},a.disable=!1,a.userMedicationList=[]},a.pageChanged=function(){a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords()};
//data table config
var D=s.gridConfigurations;a.options=h.setOptionProperties(D),a.dtColumnDefs=h.setColumnProperties({}),y(),a.inActivate=function(b,c){k.deleteUserMedicationRecordById(b,function(b){b&&(a.userMedicationList.splice(c,1),f("success",g.instant("RECORD_DELETED_SUCCESSFULLY")))},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])?f("error",g.instant("RECORD_DELETED_FAILURE")):f("Alert",g.instant(a.data.messages[0]))})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=j.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){o.isEmpty(a.data)||o.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.redirectToMedicationSatistics=function(a){a&&a.medication&&a.disease&&a.diseaseVariant?d.go("viewMedicationStatistics",{medicationId:a.medication.id,medicationName:a.medication.value,medicationVariantId:a.medicationVariant.id,medicationVariantName:a.medicationVariant.value,diseaseId:a.disease.id,diseaseName:a.disease.value,diseaseVariantId:a.diseaseVariant.id,diseaseVariantName:a.diseaseVariant.value,from:"searchMedication"}):a&&a.medication&&a.disease&&d.go("viewMedicationStatistics",{medication:a.medication.id,medicationName:a.medication.value,diseaseId:a.disease.id,diseaseName:a.disease.value,from:"searchMedication"})},a.redirectToMedicationSideEffect=function(a){d.go("usersideeffectlist",{medicationId:a.medication.id,variantId:a.medicationVariant.id,medication:a.medication.value,medicationVariant:a.medicationVariant.value})},a.redirectToMedicationEquvalance=function(a){d.go("equlist",{medicationId:a.medication.id,diseaseVariantId:a.diseaseVariant.id,medicationVariantId:a.medicationVariant.id,medication:a.medication.value,medicationVariant:a.medicationVariant.value,diseaseVariant:a.diseaseVariant.value})},a.redirectToDiseaseMedication=function(a){d.go("searchDiseaseMedication",{diseaseVariantId:a.diseaseVariant.id,diseaseVariant:a.diseaseVariant.value,disease:a.disease.value})},a.redirectToMedication=function(b){a.searchKeyword={},a.searchKeyword.diseaseId=b.disease.id,a.searchKeyword.diseaseVariantId=b.diseaseVariant.id,a.searchKeyword.medicationId=b.medication.id,a.searchKeyword.medicationVariantId=b.medicationVariant.id,k.getMedicationByDiseaseIdDiseaseVariantId(a.searchKeyword,function(a){a&&a.length>0?d.go("manageDiseaseMedication",{id:a[0].id,type:"view"}):f("error",g.instant("USER_MEDICATION_DISEASE_REDIRECT_MESSAGE"))},function(b){a.manageOrgLocSpinner=!1,a.error=b,o.isEmpty(b.data)||o.isEmpty(error.data.messages[0])||f("error",g.instant(error.data.messages[0]))})},a.makePrescription1=t.makePrescription,a.makePrescription=function(b,c,d,e){var f={};f.stateName="usermedication",a.makePrescription1(b,c,d,e,f)},a.init=function(){"true"==c.isCurrent?a.userMedication.current=!0:"false"==c.isCurrent?a.userMedication.current=!1:a.userMedication.current="all","true"==localStorage.whetherParipalAsSubdomain?(a.userMedication.current="all",a.hideCardViewMenu=!0,$(".cardLayoutClass").css({"min-height":"100px","overflow-y":"auto"})):$(".cardLayoutClass").css({height:"150px","overflow-y":"auto"}),
//Added this for menu issue for whetherParipalAsSubdomain by krishna dated 4-5-2019
"true"==localStorage.whetherParipalAsSubdomain&&("true"==localStorage.whetherReload||r(function(){localStorage.setItem("whetherReload",!0),console.log("reloaded successfuly"),w.location.reload()},200)),(b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode||a.userMedication.userId&&a.userMedication.userId.id||c.user)&&a.fetchRecords()},a.init()}]),angular.module("paripal.patientRecordModule").factory("AgoraMakePrescriptionFactory",["orbeonFormRunner","$mdMedia","$mdDialog","$state","commonConstants","httpService","urlService","utilService","messaging","docMgntService",function(a,b,c,d,e,f,g,h,i,j){
//.factory('AgoraMakePrescriptionFactory',[ '$mdDialog', '$state', 'commonConstants', 'httpService', 'urlService', 'utilService', 'messaging' , 
//function ($mdDialog, $state, commonConstants, httpService, urlService, utilService, messaging) {
var k={};return k.makePrescription=function(a,b,i,j,k,l,m,n,o,p){c.show({templateUrl:"app/modules/user-medication/views/make-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:e.dialogBox.clickOutsideToClose,controller:["$scope","$rootScope","$mdDialog","orbeonFormRunner","$mdMedia","docMgntService","$cookies","$timeout",function(a,c,e,n,q,r,s,t){
// if(!whetherUploadDocument){
//     $scope.makePrescription1();
// }else{
//    $scope.uplaodDocument();
// }
function u(){var d=a.reference,e={};e.id=b;var n=((q("sm")||q("xs"))&&a.customFullscreen,q("gt-sm"),"PRESCRIPTION_REFERENCE_FORM"),o={};o.prescriptionRef=a.reference;/*var userMedication={};
                        userMedication.id=userMedicationId;
                        prescriptionHistory.userMedication=userMedication;*/
var s={};s.id=i,o.user=s;var t={};if(t.id=j,o.disease=t,o.organizationLocation=e,l){var u={};u.id=l,o.appointment=u}if(p){var w={};w.id=p,o.transaction=w}if(m){var x={};x.id=m,o.userTreatment=x}
// if (requestFulfilmentId) {
//     var requestFulfilment = {};
//     requestFulfilment.id = requestFulfilmentId;
//     prescriptionHistory.serviceRequestFulfilment = requestFulfilment;
// }
f.postData(g.getUrl("SAVE_PRESCRIPTION_HISTORY"),o,function(b){b&&b.data&&b.data.response?(d=b.data.response,
//   docMgntService.getFormInstanceDetails(0, recordId, referenceEntityType, orgLoc.id, $rootScope.userSelectedLanguage.id,0,
r.getFormInstanceDetails(0,d,n,e.id,c.userSelectedLanguage.id,0,function(b){b&&(h.isFieldEmpty(c.userSelectedLanguage.id)||(
// orbeonFormRunner.loadNewFormRunner(recordId, referenceEntityType, orgLoc.id, $rootScope.userSelectedLanguage.id, prevStateParam, sucessResponse,0);
v(d,n,e.id,c.userSelectedLanguage.id,k,b,0,i),a.cancel()))},function(a){console.log(a)})):errorCallback(b)},function(a){errorCallback(a)})}function v(a,b,c,e,f,h,i,j,k,l){if(void 0==j&&(j=0),void 0==k&&(k=0),void 0==l&&(l=""),h){
//this.loadForm(formInstanceDetails,recordId,referenceEntityType,orgLocationId,languageId,prevStateParam,formInstanceDetails);
var m=!1,n=h.formName;s.put("formName",n,{path:"/"}),s.put("referenceEntityType",b,{path:"/"}),s.put("recordId",a,{path:"/"});var o=h.documentId,p=g.getOrbeonUrl("FORM_RUNNER_BASE_URL")+n+"/new?access_token="+localStorage.getItem("paripal_token")+"&recordId="+a+"&createdFor="+j+"&createdBy="+k+"&createdByName="+l+"&orgLocationId="+c+"&docType="+b;o&&(m=!0,p=g.getOrbeonUrl("FORM_RUNNER_BASE_URL")+n+"/edit/"+o+"?access_token="+localStorage.getItem("paripal_token")+"&recordId="+a+"&createdFor="+j+"&createdBy="+k+"&createdByName="+l+"&orgLocationId="+c+"&docType="+b);var q=p;
//                      $sce.trustAsResourceUrl(url);
t(function(){var b=d.href("newformRunner",{type:"iframe",url:q,savedRecordId:a,readonly:m,prevStateParam:"tabClose"});window.open(b,"_blank")},10)}else r.getFormInstanceDetails(0,a,b,c,e,i,function(e){
//this.loadForm(sucessResponse,recordId,referenceEntityType,orgLocationId,languageId,prevStateParam,formInstanceDetails);
var h=!1,i=e.formName;s.put("formName",i,{path:"/"}),s.put("referenceEntityType",b,{path:"/"}),s.put("recordId",a,{path:"/"});var m=e.documentId,n=g.getOrbeonUrl("FORM_RUNNER_BASE_URL")+i+"/new?access_token="+localStorage.getItem("paripal_token")+"&createdFor="+j+"&createdBy="+k+"&createdByName="+l+"&recordId="+a+"&orgLocationId="+c+"&docType="+b;m&&(h=!0,
//                                iframeURL = $sce.trustAsResourceUrl(urlService.getOrbeonUrl('FORM_RUNNER_BASE_URL') + formName + "/edit/" + documentId + "?access_token=" + localStorage.getItem('paripal_token') + "&createdFor=" + createdFor + "&recordId=" + recordId + "&orgLocationId=" + orgLocationId + "&docType=" + referenceEntityType);
n=g.getOrbeonUrl("FORM_RUNNER_BASE_URL")+i+"/edit/"+m+"?access_token="+localStorage.getItem("paripal_token")+"&createdFor="+j+"&createdBy="+k+"&createdByName="+l+"&recordId="+a+"&orgLocationId="+c+"&docType="+b);var o=d.href("formRunner",{type:"iframe",url:n,savedRecordId:a,readonly:h,prevStateParam:f});window.open(o,"_blank")})}a.makePrescription1=u,null!=o&&(a.reference=o),a.cancel=function(){e.cancel()}}]})},k}]),angular.module("paripal.patientRecordModule").factory("MakePrescriptionFactory",["$mdDialog","$state","commonConstants","httpService","urlService","utilService","messaging",function(a,b,c,d,e,f,g){var h={};return h.makePrescription=function(h,i,j,k,l,m,n,o,p){a.show({templateUrl:"app/modules/user-medication/views/make-prescription-popup.html",parent:angular.element(document.body),clickOutsideToClose:c.dialogBox.clickOutsideToClose,controller:["$scope","$rootScope","$mdDialog","orbeonFormRunner","$mdMedia","docMgntService",function(a,c,h,q,r,s){a.reference,a.makePrescription1=function(){var h=a.reference,t={};t.id=i;var u=((r("sm")||r("xs"))&&a.customFullscreen,r("gt-sm"),"PRESCRIPTION_REFERENCE_FORM"),v={};v.prescriptionRef=a.reference;/*var userMedication={};
                        userMedication.id=userMedicationId;
                        prescriptionHistory.userMedication=userMedication;*/
var w={};w.id=j,v.user=w;var x={};if(x.id=k,v.disease=x,v.organizationLocation=t,m){var y={};y.id=m,v.appointment=y}if(n){var z={};z.id=n,v.userTreatment=z}if(o){var A={};A.id=o,v.serviceRequestFulfilment=A}if(p){var B={};B.id=p,v.transaction=B}d.postData(e.getUrl("SAVE_PRESCRIPTION_HISTORY"),v,function(d){d&&d.data&&d.data.response?(h=d.data.response,
//   docMgntService.getFormInstanceDetails(0, recordId, referenceEntityType, orgLoc.id, $rootScope.userSelectedLanguage.id,0,
s.getFormInstanceDetails(0,h,u,t.id,c.userSelectedLanguage.id,0,function(d){d?f.isFieldEmpty(c.userSelectedLanguage.id)||(
// orbeonFormRunner.loadNewFormRunner(recordId, referenceEntityType, orgLoc.id, $rootScope.userSelectedLanguage.id, prevStateParam, sucessResponse,0);
q.loadNewFormRunner(h,u,t.id,c.userSelectedLanguage.id,l,d,0,j),a.cancel()):
// triggerMsgevent only
g.triggerMessageEvent(u,h,t.id,function(a){b.go("usermedication",{type:b.current.name})},function(a){})},function(a){console.log(a),g.triggerMessageEvent(u,h,t.id,function(a){b.go("emergencymanagement",{type:b.current.name})},function(a){})})):errorCallback(d)},function(a){errorCallback(a)})},a.cancel=function(){h.cancel()},a.clear=function(){a.vprTreatment={}}}]})},h}]),angular.module("paripal.userMedicationModule").service("manageUserMedicationService",["httpService","urlService","$timeout","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.saveUserMedication=function(c,d,e){var f="SAVE_USER_MEDICATION";null!=c.id&&(f="UPDATE_USER_MEDICATION"),delete c.frequencyPattern,delete c.followUpDates,a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveUserMedicationAppointment=function(c,d,e){var f="SAVE_USER_MEDICATION_APPOINTMENT";a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveMultipleUserMedicationAppointment=function(c,d,e){var f="UPDATE_MULTIPLE_MEDICATION";a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.saveDocumentDetails=function(c,d,e,f){"edit"===d&&c.id?a.putData(b.getUrl("UPDATE_DOCUMENT_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)}):a.postData(b.getUrl("SAVE_DOCUMENT_DETAILS"),c,function(a){a&&a.data&&e(a.data)},function(a){f(a)})},this.getMedicationRecordId=function(c,d){a.getData(b.getUrl("GET_MEDICATION_RECORD_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.loadContactMode=function(c,d){var e={};e.type="Preferred_contact_Modes",a.getData(b.getParameterizedUrl("GET_PICKLIST_DATA",e),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.userMedicationModule").service("viewUserMedicationService",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){"use strict";this.fetchRecords=function(c,d,e){a.postData(b.getUrl("GET_USER_MEDICATION_BY_CRITERIA"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.fetchRecordsForEdit=function(c,d,e){a.getData(b.getParameterizedUrl("GET_MEDICATION_FOR_EDIT",c),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.removeUserMedication=function(c,d,e){a.deleteData(b.getParameterizedUrl("DELETE_USER_MEDICATION_BY_ID",c),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.deleteUserMedicationById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_USER_MEDICATION_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getUserMedicationById=function(c,d,f){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_USER_MEDICATION_ID",g),null,function(a){a&&a.data?(a.data.prescribedDate=e("timestampToDate")(a.data.prescribedDate,h),a.data.startDate=e("timestampToDate")(a.data.startDate,h),a.data.dateStopped=e("timestampToDate")(a.data.dateStopped,h),d(a.data)):f(a)},function(a){f(a)})};this.deleteUserMedicationRecordById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_USER_MEDICATION_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getMedicationByDiseaseIdDiseaseVariantId=function(c,d,e){var f={};f=c,
//var dateFormat = 'MM/dd/yyyy';
a.getData(b.getParameterizedUrl("GET_UNIQUE_RECORD_BY_DISEASE_DISEAVARIANT",f),null,function(a){a&&a.data?
//response.data.dateFelt = $filter('timestampToDate')(response.data.dateFelt, dateFormat);
d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userOrganizationLinkModule").controller("ManageUserOrganizationCtrl",["$scope","$stateParams","utilService","ManageUserOrgService","$mdDialog","commonConstants","notify","$state","userStatusService",function(a,b,c,d,e,f,g,h,i){a.organization={},a.orgLocation={},a.wsUserServiceOrg={},a.wsUserServiceOrg.registeredWith={},a.WSUserServiceOrganization={},a.WSUserServiceOrganization.healthProfessional={},a.WSUserServiceOrganization.supportServiceType={},a.WSUserServiceOrganization.supportServiceProfessional={},a.WSUserServiceOrganization.whetherDoctorActive="false",a.WSUserServiceOrganization.whetherServiceTypeActive="false",a.WSUserServiceOrganization.whetherSupportServActive="false",a.commonConstants=f;var j="",k=function(){a.pageState=d.checkPageState(b.type),"add"!==a.pageState?(a.WSUserServiceOrganization=d.setUserOrgLinkObject(b.data),a.wsUserServiceOrg.registeredWith={data:{value:b.data.registeredWithName}},c.isEmpty(b.data.user)||(a.wsUserServiceOrg.code=b.data.user.code),c.isFieldEmpty(b.data.registeredWithId)||(a.wsUserServiceOrg.registeredWith.data.id=b.data.registeredWithId),c.isFieldEmpty(b.data.uhIdDoc)||(a.uploadFileObject=a.WSUserServiceOrganization.uhIdDoc)):"add"===a.pageState&&(a.loggedInUser=i.userStatus().userData,a.isOrgUser=i.isOrgUser(),a.isOrgUser||(a.WSUserServiceOrganization.user=a.loggedInUser,a.wsUserServiceOrg.code=a.loggedInUser.code))};a.userAutoCmp={queryUrl:"FIND_ACTIVE_CLIENTS",queryParameter:{orgLocationId:j},jsonParameter:{}},a.currentDoctor={queryUrl:"FIND_ORG_DOCTORS",queryParameter:{orgLocationId:j,professionType:"DOCTOR"},jsonParameter:{}},a.healthProfessional={queryUrl:"FIND_ORG_HEALTH_PROFESSIONAL",queryParameter:{orgLocationId:j,professionType:"OTHER_HEALTH_SERVICE_PROFESSIONAL"},jsonParameter:{}},a.supportServiceProfessional={queryUrl:"FIND_ORG_SUPPORT_SERVICE_PROFESSIONAL",queryParameter:{orgLocationId:j,professionType:"SUPPORT_SERVICE_PROFESSIONAL"},jsonParameter:{}},a.supportService={queryUrl:"GET_SUPPORT_SERVICE_TYPE",queryParameter:{},jsonParameter:{}},a.findUserNameByCode=function(){c.isFieldEmpty(a.wsUserServiceOrg.code)?a.WSUserServiceOrganization.user=null:d.findUserNameByCode(a.wsUserServiceOrg.code,function(b){c.isFieldEmpty(b)?a.wsUserServiceOrg.code="":a.WSUserServiceOrganization.user=b},function(){})},a.whetherUserName=function(a){return!!c.isFieldEmpty(a)},a.populateUserCode=function(b){a.wsUserServiceOrg.code=null,"object"==typeof b&&(a.wsUserServiceOrg.code=b.code)},a.getServiceType=function(b){return a.serviceTypeSpinner=!0,d.getServiceType(b,function(b){return a.serviceTypeSpinner=!1,b},function(){a.serviceTypeSpinner=!1})},a.fileUploadCall=function(b){b.$valid&&(!c.isFieldEmpty(a.uploadFileObject)&&c.isFieldEmpty(a.uploadFileObject.id)?d.fileUploadCall(a.uploadFileObject,a.pageState,function(b,c){b&&d.uploadFile(b,c,function(b){a.createUserServiceOrgLink(b)})},function(){}):a.createUserServiceOrgLink())},a.createUserServiceOrgLink=function(b){d.createUpdate(a.wsUserServiceOrg,a.WSUserServiceOrganization,b,function(b){g("success",b.data.successMessage),a.back()},function(){})},a.fileUploader=function(b){d.fileUpload(b,"TRANSACTION","PRESCRIPTION",function(b){a.uploadFileObject=b})},a.viewPrintFile=function(b,c){d.viewPrintFile(b,c,function(b){a.fileResource=b,a.viewFileContent=!0,a.isHidingPrintButton=!0})},a.changeOrgId=function(){c.isFieldEmpty(a.wsUserServiceOrg.registeredWith.data)?a.currentDoctor.queryParameter.orgLocationId="":c.isFieldEmpty(a.wsUserServiceOrg.registeredWith.data.id)?a.currentDoctor.queryParameter.orgLocationId="":a.currentDoctor.queryParameter.orgLocationId=a.wsUserServiceOrg.registeredWith.data.id},a.back=function(){c.goBackToPrevState()},k()}]),angular.module("paripal.userOrganizationLinkModule").controller("UserOrganizationListCtrl",["$scope","$state","datatableconfig","serverSidePagination","utilService","commonConstants","UserOrgListService","notify","$translate","userStatusService","baseService","$mdDialog","addUserTestService","$mdMedia","docMgntService","orbeonFormRunner","messaging","httpService","urlService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(a,b,c,d,f,g,h){a.searchCriteria={},a.getFormList=function(){var b={};b.transactionType="Client_Records",b.organizationLocationId=g.registeredWithId,b.languageId=a.searchCriteria.language.id,h.getDynamicFormsList(b,function(b){a.formList=b},function(a){})},a.selectForm=function(){var c={};c.selectedForm=a.selectedForm,c.clientObj=g,b.hide(c)},a.$watch("searchCriteria.language",function(b){e.isEmpty(b)||a.getFormList()},!0),/*if (clientObj) {
                $scope.getFormList();
            }*/
a.cancel=function(){b.hide()}}function u(){a.loggedInUser=j.userStatus().userData,a.isOrgUser=j.isOrgUser(),a.isOrgUser||(a.filter.user=a.loggedInUser,a.filter.code=a.loggedInUser.code,a.searchUserServiceOrganizations())}t.$inject=["$scope","$mdDialog","httpService","urlService","parentScope","clientObj","orgLocClientListService"],a.filter={},a.filter.organization={},a.filter.orgLocation={};var v="";a.filter.user="",a.commonConstants=f,/*
     * For Pagination defaults value
     * Default records per page
     */
a.currentPage=f.defaultPageNo,a.itemPerPage=f.itemPerPage,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.userAutoCmp={queryUrl:"FIND_ACTIVE_CLIENTS",queryParameter:{orgLocationId:v},jsonParameter:{}},a.fillForm=function(b){a.dialogBox=l.show({controller:t,templateUrl:"app/modules/document-management/views/fill-form.html",parent:angular.element(document.body),targetEvent:event,multiple:!1,clickOutsideToClose:!1,locals:{parentScope:a,clientObj:b}}).then(function(b){b&&(a.selectedFormObj=b.selectedForm,"MEASUREMENT_1"==a.selectedFormObj.serviceTypeName.value||"MEASUREMENT"==a.selectedFormObj.serviceTypeName.value?a.saveUserTest(a.selectedFormObj,b.clientObj):a.saveClientRecordTemplateData(a.selectedFormObj,b.clientObj))},function(a){})},a.saveClientRecordTemplateData=function(b,c){a.WSClientRecordTemplateData={};var d=k.getLoggedInUser().id;a.WSClientRecordTemplateData.user={id:d},/*$scope.WSClientRecordTemplateData.diagnosticTest = {
                id: 1,
                value: "FormTest"
            };*/
a.WSClientRecordTemplateData.initiator={id:d},a.WSClientRecordTemplateData.organizationLocation={id:b.organizationLocationId},/*$scope.testConductedAt.data = {
                id: formObj.organizationLocationId,
                value: formObj.organizationLocationName
            };*/
r.postData(s.getUrl("CREATE_CLIENT_RECORD_TEMPLATE_DATA"),a.WSClientRecordTemplateData,function(c){var e=c.data.response;a.selectOrbeonForm(null,b.referenceEntityType,e,b.organizationLocationId,b.systemLanguage.id,d)},function(a){})},a.saveUserTest=function(b,c){a.WSDiagnosticTestUser={};var d=k.getLoggedInUser().id;a.WSDiagnosticTestUser.user={id:d},a.WSDiagnosticTestUser.diagnosticTest={id:1,value:"FormTest"},a.WSDiagnosticTestUser.advisedById=k.getLoggedInUser().id,a.WSDiagnosticTestUser.advisedByName=k.getLoggedInUser().displayName,a.WSDiagnosticTestUser.reason="trial",a.labsReferred="ezest labs",a.testConductedAt=null,/*$scope.testConductedAt.data = {
                id: formObj.organizationLocationId,
                value: formObj.organizationLocationName
            };*/
a.WSDiagnosticTestUser.requestedOn=new Date;var e=null;m.saveOrbeonUserTest(a.WSDiagnosticTestUser,a.labsReferred,a.testConductedAt,e,function(c){a.documentId=c.response,/*notify("success", successResponse.successMessage);*/
a.selectOrbeonForm(null,b.referenceEntityType,a.documentId,b.organizationLocationId,b.systemLanguage.id,d)},function(b){a.manageUserTestSpinner=!1})},a.selectOrbeonForm=function(b,c,d,f,g,h){var i=((n("sm")||n("xs"))&&a.customFullscreen,n("gt-sm"),{});i.stateName="userorganizationlist",o.getFormInstanceDetails(0,d,c,f,g,0,function(a){a?e.isFieldEmpty(g)||/*prevStateParam.params= {
                                   type: 'iframe',
                                   url:iframeURL,
                                   savedRecordId:recordId,
                                   readonly: readonly,
                                   prevStateParam:prevStateParam,
                               };*/
p.loadNewFormRunner(d,c,f,g,i,a,0,h,k.getLoggedInUser().id,k.getLoggedInUser().displayName):
// triggerMsgevent only
q.triggerMessageEvent(c,d,f,function(a){},function(a){})},function(a){q.triggerMessageEvent(c,d,f,function(a){},function(a){})})},a.searchUserServiceOrganizations=function(){return e.isEmpty(a.filter.user)&&e.isNullOrEmpty(a.filter.code)?void h("Warning",i.instant("SELECT_EITHER_OF_TWO_OPTIONS")):(a.userOrgListSpinner=!0,void g.searchData(a.filter,a.currentPage,a.itemPerPage,function(b){a.userOrgListSpinner=!1,a.userOrgList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems)},function(){a.userOrgListSpinner=!1}))},a.isRecordEditable=function(b){return!b.whetherAutoCreated&&b.createdById==a.loggedInUser.id},a.getUserOrgDetailsById=function(a,c){g.getUserOrgDetailsById(a,function(a){b.go("manageuserorganization",{type:c,data:a})},function(){})},a.toggleActiveStatus=function(b,c){g.toggleActiveStatus(b,c,"userserviceorganization",null,function(){a.searchUserServiceOrganizations()},function(){})},a.clear=function(){b.reload()},a.addUserOrgLink=function(a,c){b.go("manageuserorganization",{type:c,data:a})},/**
     * Serverside pagination
     */
a.pageChanged=function(){a.pagingInfo=d(a.currentPage,a.itemPerPage,a.totalItems),a.searchUserServiceOrganizations()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchUserServiceOrganizations()},a.$watch("filter.orgLocation",function(b){e.isEmpty(b)?a.userAutoCmp.queryParameter.orgLocationId="":e.isEmpty(b.data)||(a.userAutoCmp.queryParameter.orgLocationId=b.data.id)},!0),/**
    Datatable configurations
    */
u();var w=f.gridConfigurations;a.options=c.setOptionProperties(w)}]),angular.module("paripal.userOrganizationLinkModule").service("ManageUserOrgService",["utilService","httpService","urlService","$mdDialog","manageAttachmentService","notify","fileOperations","$translate","commonConstants",function(a,b,c,d,e,f,g,h,i){this.checkPageState=function(b){return"add"===b||a.isEmpty(b)?"add":b},this.getServiceType=function(a,d,e){var f=c.getUrl("GET_SERVICE_TYPE");return f=f+"?nameCode="+a,b.getData(f,null,function(a){return d(angular.fromJson(a.data))},function(){return e()})},this.findUserNameByCode=function(a,d,e){var f={};f.code=a,f.orgLocationId="",b.getData(c.getParameterizedUrl("FIND_USER_BY_USER_CODE",f),null,function(a){for(var b=angular.fromJson(a).data,c=0;c<b.length;c++){var e=b[c];break}d(e)},function(){e()})},this.fileUploadCall=function(a,b,c,d){var e={};e.fileName=a.fileName,e.fileIdentifier=a.fileIdentifier,e.documentType=a.documentType,this.saveDocumentDetails(e,b,function(b){c(a,b)},function(){d()})},this.uploadFile=function(b,c,d){var e=new Object;e.file=b.fileToBeUpload,e.docType=b.documentType.type,e.docSubType=b.documentType.subType,a.isNullOrEmpty(c.response)||(e.resourceId=c.response),g.uploadFile(e,function(a){var b=c.response;d(b)},function(a){f("Error",h.instant("ERROR_WHILE_UPLOADING"))})},this.saveDocumentDetails=function(a,b,c,d){e.saveDocumentDetails(a,"add",function(a){c(a&&a.data?a.data:a)},function(a){d(a)})},this.createUpdate=function(d,e,f,g,h){var i=angular.copy(e),j=angular.copy(d);i.registeredWithName=j.registeredWith.data.value,a.isFieldEmpty(j.registeredWith.data.id)||(i.registeredWithId=j.registeredWith.data.id),!a.isFieldEmpty(e.doctor)&&a.isFieldEmpty(e.doctor.id)?(i.doctorName=e.doctor.value,delete i.doctor):a.isFieldEmpty(e.doctor)&&delete i.doctor,!a.isFieldEmpty(e.healthProfessional)&&a.isFieldEmpty(e.healthProfessional.id)?(i.healthProffsnlName=e.healthProfessional.value,delete i.healthProfessional):a.isFieldEmpty(e.healthProfessional)&&delete i.healthProfessional,!a.isFieldEmpty(e.supportServiceType)&&a.isFieldEmpty(e.supportServiceType.id)?(i.supportServiceTypeName=e.supportServiceType.value,delete i.supportServiceType):a.isFieldEmpty(e.supportServiceType)&&delete i.supportServiceType,!a.isFieldEmpty(e.supportServiceProfessional)&&a.isFieldEmpty(e.supportServiceProfessional.id)?(i.suppServiceProffsnlName=e.supportServiceProfessional.value,delete i.supportServiceProfessional):a.isFieldEmpty(e.supportServiceProfessional)&&delete i.supportServiceProfessional,!a.isFieldEmpty(e.serviceType)&&a.isFieldEmpty(e.serviceType.id)&&(i.serviceTypeName=e.serviceType.nameValue,delete i.serviceType),f&&(i.uhIdDoc={id:f}),a.isFieldEmpty(i.id)?b.postData(c.getUrl("CREATE_USER_ORG_LINK"),i,function(a){g(a)},function(){h()}):b.putData(c.getParameterizedUrl("FIND_USER_ORG_BY_ID",i),i,function(a){g(a)},function(){h()})},this.fileUpload=function(a,b,c,e){d.show({controller:"PrescriptionFileUploaderCtrl",templateUrl:"app/modules/user-tests/views/prescription-file-uploader.html",parent:angular.element(document.body),targetEvent:a,locals:{docType:"USER_ID_DOCUMENT",docSubType:"HOSPITAL_ID",isMultipleFileUpload:!1},clickOutsideToClose:i.dialogBox.clickOutsideToClose}).then(function(a){e(a)})},this.viewPrintFile=function(b,c,d){if(!a.isEmpty(c)){var e=new Object;e.fileName=c.fileName,e.resourceId=c.id,e.docType=c.documentType.type,e.docSubType=c.documentType.subType,d(e)}},this.setUserOrgLinkObject=function(b){var c={};return angular.copy(b,c),c.whetherSupportServActive=this.booleanToString(b.whetherSupportServActive),c.whetherServiceTypeActive=this.booleanToString(b.whetherServiceTypeActive),c.whetherDoctorActive=this.booleanToString(b.whetherDoctorActive),a.isFieldEmpty(b.serviceType)&&!a.isFieldEmpty(b.serviceTypeName)&&(c.serviceType={},c.serviceType.nameValue=b.serviceTypeName),a.isFieldEmpty(b.healthProfessional)&&!a.isFieldEmpty(b.healthProffsnlName)&&(c.healthProfessional={},c.healthProfessional.value=b.healthProffsnlName),a.isFieldEmpty(b.supportServiceType)&&!a.isFieldEmpty(b.supportServiceTypeName)&&(c.supportServiceType={},c.supportServiceType.value=b.supportServiceTypeName),a.isFieldEmpty(b.supportServiceProfessional)&&!a.isFieldEmpty(b.suppServiceProffsnlName)&&(c.supportServiceProfessional={},c.supportServiceProfessional.value=b.suppServiceProffsnlName),a.isFieldEmpty(b.doctor)&&!a.isFieldEmpty(b.doctorName)&&(c.doctor={},c.doctor.value=b.doctorName),c},this.booleanToString=function(a){var b=a?"true":"false";return b}}]),angular.module("paripal.userOrganizationLinkModule").service("UserOrgListService",["httpService","utilService","urlService","notify",function(a,b,c,d){"use strict";this.searchData=function(d,e,f,g,h){var i={};i.pageNumber=e,i.recordsPerPage=f,b.isNullOrEmpty(d.code)||(i.user={code:d.code}),b.isEmpty(d.user)||(b.isEmpty(i.user)&&(i.user={}),i.user.id=d.user.id,i.user.value=d.user.value),b.isEmpty(d.orgLocation)||(i.orgLocationId=d.orgLocation.data.id),i.whetherActive=d.whetherActive,a.postData(c.getUrl("SEARCH_USER_ORG_LIST_BY_CRITERIA"),i,function(a){g(angular.fromJson(a.data))},function(){h()})},this.toggleActiveStatus=function(b,e,f,g,h,i){var j={};j.id=b,j.pathName=f,j.whetherActive=e,a.putData(c.getParameterizedUrl("TOGGLE_ACTIVE_STATUS",j),g,function(a){d("success",a.data.successMessage),h()},function(){i()})},this.getUserOrgDetailsById=function(b,d,e){var f={};f.id=b.id,a.getData(c.getParameterizedUrl("FIND_USER_ORG_BY_ID",f),null,function(a){d(a.data)},function(){e()})}}]),angular.module("paripal.userStackholderModule").controller("CreateStackholderCtrl",["$scope","userStackholderListService","$filter","httpService","urlService","utilService","notify","$translate","$mdDialog","commonConstants","stackHolderData","type","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=m.getLoggedInUser();a.type=l,a.wsUserStackholder={},a.minDate=new Date,a.minDate.setFullYear(a.minDate.getFullYear()-18),"view"==a.type?a.disableView=!0:"edit"==a.type&&(a.disableEdit=!0),a.hide=function(){i.hide()},a.cancel=function(){i.cancel()},a.$watch("userData.data",function(b){b!==-1?f.isEmpty(a.userData.data)||f.isFieldEmpty(a.userData.data.id)||(a.wsUserStackholder.email=b.email1,a.wsUserStackholder.cell=b.cell1,a.dob=c("timestampToDate")(b.birthDate,"MM/dd/yyyy"),a.disableEdit=!0):(a.wsUserStackholder.email="",a.wsUserStackholder.cell="",a.dob="",a.disableEdit=!1)},!0),a.manageUserStackholder=function(){b.manageUserStackholder(a.wsUserStackholder,a.dob,a.userData,n,function(b){a.cancel()},function(b){a.cancel()})},a.getRelationshipList=function(){b.getRelationshipList(function(b){a.relationshipList=b},function(a){})},a.getRelationshipList(),a.init=function(){a.userData={},f.isEmpty(k)||(f.isEmpty(k.stakeholder)||(k.stakeholder.value=k.stakeholder.displayName,a.userData.data=k.stakeholder,a.dob=c("timestampToDate")(k.stakeholder.birthDate,"MM/dd/yyyy")),f.isEmpty(k.relationship)||(a.relationshipId=k.relationship.id),a.wsUserStackholder=k)},a.init()}]),angular.module("paripal.userStackholderModule").controller("UserStackholderListCtrl",["$scope","$rootScope","$stateParams","$state","userStackholderListService","httpService","urlService","baseService","utilService","notify","$translate","datatableconfig","$mdDialog","serverSidePagination","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.wsStackholderSearchCriteria={},a.userData={},a.searchUserStackholders=function(){e.searchUserStackholders(a.wsStackholderSearchCriteria,a.userData,function(b){a.userStackholderList=b.data,a.totalItems=a.userStackholderList.length,a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems)},function(a){})},a.clear=function(){a.wsStackholderSearchCriteria={},a.userData={},a.$broadcast("clearPicklistData"),a.searchUserStackholders()},a.addUserStackholder=function(b){m.show({controller:"CreateStackholderCtrl",templateUrl:"app/modules/user-stackholder/views/create-user-stackholder.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,locals:{stackHolderData:null,type:"add"}}).then(function(){a.searchUserStackholders()},function(){a.searchUserStackholders()})},a.viewEditUserStackholder=function(b,c,d){m.show({controller:"CreateStackholderCtrl",templateUrl:"app/modules/user-stackholder/views/create-user-stackholder.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,locals:{stackHolderData:c,type:d}}).then(function(){a.searchUserStackholders()},function(){a.searchUserStackholders()})},a.removeUserStackholder=function(b){var c=b.id,d=m.confirm().title(k.instant("REMOVE_STAKEHOLDER_REQUEST")).textContent(k.instant("ARE_YOU_SURE_TO_DELETE_REQUEST")).cancel(k.instant("NO")).ok(k.instant("YES"));m.show(d).then(function(){e.removeStakeholderRequest(c,function(b){a.searchUserStackholders()},function(a){})},function(){})},a.pageChanged=function(){a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),a.searchUserStackholders()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchUserStackholders()};var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=l.setOptionProperties(p),a.dtColumnDefs=l.setColumnProperties({}),a.init=function(){a.searchUserStackholders()},a.init()}]),angular.module("paripal.userStackholderModule").controller("UserStackholderRequestListCtrl",["$scope","$rootScope","$stateParams","$state","userStackholderRequestListService","httpService","urlService","baseService","utilService","notify","$translate","datatableconfig","$mdDialog","serverSidePagination","commonConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.wsStackholderSearchCriteria={},a.userData={},a.searchUserStackholdersRequests=function(){e.searchUserStackholdersRequests(a.wsStackholderSearchCriteria,a.userData,function(b){a.userStackholderRequestList=b.data,a.totalItems=a.userStackholderRequestList.length,a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems)},function(a){})},a.clear=function(){a.wsStackholderSearchCriteria={},a.userData={},a.$broadcast("clearPicklistData"),a.$broadcast("clearReferredData"),a.searchUserStackholdersRequests()},a.acceptStackholderRequest=function(b,c){var d,f={};"ACCEPT_REQUEST"==b?(d="ACCEPT_USER_STACKHOLDER_REQUEST",f.status=!0):(d="REJECT_USER_STACKHOLDER_REQUEST",f.status=!1),f.requestId=c.id;var g=m.confirm().title(k.instant(b)).textContent(k.instant(d)).cancel(k.instant("NO")).ok(k.instant("YES"));m.show(g).then(function(){e.acceptRejectStakeholderRequest(f,function(b){a.searchUserStackholdersRequests()},function(a){})},function(){})},a.pageChanged=function(){a.pagingInfo=n(a.currentPage,a.itemPerPage,a.totalItems),a.searchUserStackholdersRequests()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchUserStackholdersRequests()};var p={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=l.setOptionProperties(p),a.dtColumnDefs=l.setColumnProperties({}),a.init=function(){a.searchUserStackholdersRequests()},a.init()}]),angular.module("paripal.userStackholderModule").service("userStackholderListService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.manageUserStackholder=function(e,f,g,h,i,j){var k={};d.isEmpty(h)||(k.user={id:h.id}),d.isEmpty(g)||d.isEmpty(g.data)?d.isEmpty(g)||d.isEmpty(g.nameValue)||(k.name=g.nameValue,k.email1=e.email,k.cell1=e.cell,k.birthDate=c.convertToServerDate(f)):k.stakeholder={id:g.data.id},d.isEmpty(e.relationship)||(k.relationship=e.relationship),k.whetherEmergency=e.whetherEmergency,k.whetherSharingAllowed=e.whetherSharingAllowed,k.whetherViewHealthRecord=e.whetherViewHealthRecord;var l;if(d.isFieldEmpty(e.id))l=b.getUrl("CREATE_USER_STAKE_HOLDER"),a.postData(l,k,function(a){a&&a.data&&i(a.data)},function(a){errorCallback(a)});else{var m={};m.stakeholderRequestId=e.id,/*updateObject.whetherActive = wsUserStackholder.whetherActive;*/
m.relationshipId=k.relationship.id,m.whetherEmergency=e.whetherEmergency,m.whetherSharingAllowed=e.whetherSharingAllowed,m.whetherViewHealthRecord=e.whetherViewHealthRecord,l=b.getUrl("UPDATE_USER_STAKE_HOLDER"),a.putData(l,m,function(a){a&&a.data&&i(a.data)},function(a){errorCallback(a)})}},this.searchUserStackholders=function(c,e,f,g){var h={};d.isEmpty(c.requestStatus)||d.isEmpty(c.requestStatus.dataValue)||(h.status={id:c.requestStatus.dataValue.id}),d.isEmpty(e)||d.isEmpty(e.data)||(h.stakeholderName=e.data.displayName),h.whetherActive=c.whetherActive,h.whetherEmergency=c.whetherEmergency,h.whetherSharingAllowed=c.whetherSharingAllowed,h.whetherViewHealthRecord=c.whetherViewHealthRecord,a.postData(b.getUrl("GET_STACKHOLDER_LIST"),h,function(a){a.data&&a.data.data?f(a.data):g(a)},function(a){g(a)})},this.removeStakeholderRequest=function(c,d,e){var f={};f.requestId=c,a.deleteData(b.getParameterizedUrl("REMOVE_STAKEHOLDER_REQUEST",f),null,function(a){a&&a.data&&d(a.data)},function(a){errorCallback(a)})},this.getRelationshipList=function(c,d){a.getData(b.getUrl("GET_RELATIONSHIP_LIST"),null,function(a){a&&a.data&&c(a.data)},function(a){errorCallback(a)})}}]),angular.module("paripal.userStackholderModule").service("userStackholderRequestListService",["httpService","urlService","dateconvertor","utilService",function(a,b,c,d){"use strict";this.searchUserStackholdersRequests=function(e,f,g,h){var i={};d.isEmpty(e.requestStatus)||d.isEmpty(e.requestStatus.dataValue)||(i.status={id:e.requestStatus.dataValue.id}),d.isEmpty(f)||d.isEmpty(f.data)||(i.requestBy={value:f.data.displayName}),d.isEmpty(e.dateFrom)||(i.requestDateFrom=c.convertToServerDate(e.dateFrom)),d.isEmpty(e.dateTill)||(i.requestDateTo=c.convertToServerDate(e.dateTill)),i.whetherActive=e.whetherActive,i.whetherEmergency=e.whetherEmergency,i.whetherSharingAllowed=e.whetherSharingAllowed,i.whetherViewHealthRecord=e.whetherViewHealthRecord,a.postData(b.getUrl("GET_STACKHOLDER_REQUEST_LIST"),i,function(a){a.data&&a.data.data?g(a.data):h(a)},function(a){h(a)})},this.acceptRejectStakeholderRequest=function(c,d,e){a.putData(b.getParameterizedUrl("ACCEPT_REJECT_STAKEHOLDER_REQUEST",c),null,function(a){a&&a.data&&d(a.data)},function(a){errorCallback(a)})}}]),angular.module("paripal.userSymptomModule").controller("manageUserSymptomDetailCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserSymptomDetailService","utilService","viewUserSymptomsService","dateconvertor","httpService","urlService","manageUserSymptomsService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(){var b={};a.symptomDetail,"add"===c.type?(b.id=a.symptomDetail.id,a.symptomDetail.userSymptom=b,delete a.symptomDetail.remarks,delete a.symptomDetail.creatingOrgLoc,delete a.symptomDetail.symptom,delete a.symptomDetail.symptomRecordId,delete a.symptomDetail.diseaseId,delete a.symptomDetail.user,delete a.symptomDetail.id,delete a.symptomDetail.dateFirstExperienced,delete a.symptomDetail.dateLastFelt,delete a.symptomDetail.diseaseVariant,delete a.symptomDetail.numberOfOccurrences,delete a.symptomDetail.stillExperiencing,delete a.symptomDetail.disease,delete a.symptomDetail.organizationLocationId):"edit"===c.type&&(a.symptomDetail,/*if($scope.symptomDetail.dateLastFelt !=null){
						 $scope.symptomDetail.dateLastFelt = dateconvertor.convertToServerDate($scope.symptomDetail.dateLastFelt);
						 
					 }
					 if($scope.symptomDetail.dateFirstExperienced !=null){
						 $scope.symptomDetail.dateFirstExperienced = dateconvertor.convertToServerDate($scope.symptomDetail.dateFirstExperienced);
						 
					 }*/
a.symptomDetail.userSymptom={},a.symptomDetail.userSymptom.disease=a.symptomDetail.disease,a.symptomDetail.userSymptom.creatingOrgLoc=a.symptomDetail.creatingOrgLoc,a.symptomDetail.userSymptom.disease=a.symptomDetail.disease,a.symptomDetail.userSymptom.diseaseVariant=a.symptomDetail.diseaseVariant,a.symptomDetail.userSymptom.user=a.symptomDetail.user,a.symptomDetail.userSymptom.symptom=a.symptomDetail.symptom,a.symptomDetail.userSymptom.symptomRecordId=a.symptomDetail.symptomRecordId,a.symptomDetail.userSymptom.remarks=a.symptomDetail.remarks,a.symptomDetail.userSymptom.dateLastFelt=a.symptomDetail.dateLastFelt,a.symptomDetail.userSymptom.numberOfOccurrences=a.symptomDetail.numberOfOccurrences,a.symptomDetail.userSymptom.dateFirstExperienced=a.symptomDetail.dateFirstExperienced,delete a.symptomDetail.creatingOrgLoc,delete a.symptomDetail.user,delete a.symptomDetail.symptom,delete a.symptomDetail.symptomRecordId,delete a.symptomDetail.diseaseId,delete a.symptomDetail.remarks,delete a.symptomDetail.creatingOrgLocId,delete a.symptomDetail.dateFirstExperienced,delete a.symptomDetail.dateLastFelt,delete a.symptomDetail.diseaseVariant,delete a.symptomDetail.numberOfOccurrences,delete a.symptomDetail.stillExperiencing,delete a.symptomDetail.disease,delete a.symptomDetail.organizationLocationId,a.symptomDetail.id=parseInt(c.id),null!=c.parentId&&(a.symptomDetail.userSymptom.id=parseInt(c.parentId))),j.saveUserSymptomDetail(a.symptomDetail,function(b){b&&(
//$state.go('viewUserSymptomDetail',{'id':$stateParams.parentId});
//$state.go('viewUserSymptomDetail');
history.back(),a.symptomDetail&&a.symptomDetail.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function s(b){a.diseaseId=b}function t(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.diseaseId,a.diseaseVariantLoad=!0,n.getData(o.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}function u(b){return a.symptomName={},a.symptomName.searchKeyWord=b,a.symptomLoad=!0,n.getData(o.getParameterizedUrl("GET_SYMPTOMS",a.searchKeyWord),null,function(b){return a.symptomLoad=!1,a.symptomLoad=angular.fromJson(b.data)},function(b){a.symptomLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}a.symptomDetail={},a.saveUserSymptomDetail=r,a.getDiseaseVariant=t,a.getDiseaseId=s,a.getSymptom=u,a.diseaseId={},a.recordId={},a.userId={},a.orgLocPermission=q.USER_SYMPTOM_DETAIL_ADD,a.isVisible=!0,a.field=!1,a.maxDate=new Date,a.cancel=function(){
//$state.go("viewUserSymptomDetail")
k.goBackToPrevState()},a.init=function(){if(a.manageOrgLocSpinner=!0,"edit"===c.type){if(c.id){var b={};b=c.id,j.getSymptomDetailById(c.id,function(b){b&&(a.symptomDetail=c.data,null==b.description&&null==b.dateFelt||(a.symptomDetail.description=b.description,a.symptomDetail.detailRecordId=b.detailRecordId,a.symptomDetail.dateFelt=b.dateFelt))},function(b){a.manageOrgLocSpinner=!1,a.error=b,k.isEmpty(b.data)||k.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}}else if("view"===c.type){if(a.viewmode=!0,a.isVisible=!1,a.pageState="view",c.id){var b={};b=c.id,j.getSymptomDetailById(c.id,function(b){b&&(a.symptomDetail=c.data,null==b.description&&null==b.dateFelt||(a.symptomDetail.description=b.description,a.symptomDetail.detailRecordId=b.detailRecordId,a.symptomDetail.dateFelt=b.dateFelt))},function(b){a.manageOrgLocSpinner=!1,a.error=b,k.isEmpty(b.data)||k.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}}else if("add"===c.type&&(a.field=!0,c.id)){a.orgLocPermission=q.USER_SYMPTOM_DETAIL_ADD;
// This function for used getting auto Id
/*manageUserSymptomDetailService.getDetailRecordId(function (successResponse) {
				    		  if (!utilService.isNullOrEmpty(successResponse)) {
					    		  $scope.symptomDetail.detailRecordId = successResponse;		    		  
					    		  
					    		}
					    	},
					    	function (errorResponse) {
					    	if (!utilService.isEmpty(errorResponse.data) && 
					    	!utilService.isEmpty(errorResponse.data.messages[0])) {
					          notify("Alert", $translate.instant(errorResponse.data.messages[0]));
					    	} else {
					         notify("error", $translate.instant("RECORD_GENERATE_FAILURE"));
					       	}

						});*/
var b={};b=c.id,
// This function used for getting the record by the Id
p.getSymptomById(b,function(b){b&&(a.symptomDetail=b)},function(b){a.manageOrgLocSpinner=!1,a.error=b,k.isEmpty(b.data)||k.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}},a.init(),a.getCreatedBy=function(c){var d={};return d.keyword=c,d.orgId=b.loggedInUserDetails.organizationId,n.getData(o.getParameterizedUrl("GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD",d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getUserNamesForRoleHistory=function(b){return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,n.getData(o.getParameterizedUrl("FIND_USERBYNAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=o.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return n.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}}]),angular.module("paripal.userSymptomModule").controller("manageUserSymptomsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserSymptomsService","httpService","urlService","utilService","dateconvertor","featurePrivilegeConstants","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,k.getData(l.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.manageSymptom.creatingOrgLoc=b.data[0],a.manageSymptom.creatingOrgLoc},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function r(){a.manageSymptom.user&&a.manageSymptom.user.id&&(a.manageSymptom.user.id=a.manageSymptom.user.id,a.manageSymptom.user.value=a.manageSymptom.user.displayName,delete a.manageSymptom.user.displayName),a.manageSymptom&&a.manageSymptom.symptom&&a.manageSymptom.symptom.id&&(a.manageSymptom.symptom.id=a.manageSymptom.symptom.id,a.manageSymptom.symptom.value=a.manageSymptom.symptom.name,delete a.manageSymptom.symptom.name,delete a.manageSymptom.symptom.version,delete a.manageSymptom.symptom.whetherActive,delete a.manageSymptom.symptom.symptomDescription),/*if($scope.manageSymptom.dateFirstExperienced!=null || $scope.manageSymptom.dateLastFelt!=null){            	
            		$scope.manageSymptom.dateFirstExperienced = dateconvertor.convertToServerDate($scope.manageSymptom.dateFirstExperienced);
                	$scope.manageSymptom.dateLastFelt = dateconvertor.convertToServerDate($scope.manageSymptom.dateLastFelt);	
            	}*/
j.saveUserSymptom(a.manageSymptom,function(b){b&&(d.go("viewUserSymptoms"),a.manageSymptom&&a.manageSymptom.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function s(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,k.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&t()},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function t(){a.viewmode=!0,a.isVisible=!1,a.pageState="view",j.getSymptomById(c.id,function(b){b&&(a.manageSymptom=b,a.setData(a.manageSymptom),a.manageSymptom.symptom=b.symptom.value)},function(b){a.manageOrgLocSpinner=!1,a.error=b,m.isEmpty(b.data)||m.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}function u(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function v(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var c={};return c.keyword=b,k.getData(l.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}var c={};
//userObj.searchKeyWord = value;
return c.keyword=b,k.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){
//return httpService.getData(urlService.getParameterizedUrl('GET_ORG_LOC_LIST_BY_KEYWORD', userObj), null, function (response) {
if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function w(b){a.queryObj={},a.queryObj.userId=a.manageSymptom.user.id;var c=l.getParameterizedUrl("FIND_DISEASE_BY_USER",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.diseases=b.data,a.diseases},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function x(b){var c={};c.userId=a.manageSymptom.user.id,c.diseaseId=a.manageSymptom.disease.id;var d=l.getParameterizedUrl("FIND_DISEASE_BY_USER_AND_DISEASE",c);if(d)return k.getData(d,null,function(b){if(b&&b.data)return a.diseaseVariants=b.data,a.diseaseVariants},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function y(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,k.getData(l.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}a.saveUserSymptom=r,a.getDiseaseVariant=x,a.getSymptom=y,a.diseaseId={},a.manageSymptom={},a.maxDate=new Date,a.minDateValidTill=new Date,a.orgLocPermission=o.USER_SYMPTOM_ADD,a.getCreatedBy=v,a.isVisible=!1,a.getUserNamesForRoleHistory=u,a.field=!1,a.loginDetails=b.loggedInUserDetails,a.getSystemOrg=q,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=s,a.allowAccessOTP=t,a.getDisease=w,
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.manageSymptom.user={},a.manageSymptom.user.value=a.loginDetails.displayName,a.manageSymptom.user.id=a.loginDetails.id,w(a.manageSymptom.user.id),q()),a.cancel=function(){/* $state.go("viewUserSymptoms");*/
m.goBackToPrevState()},a.init=function(){if(a.manageOrgLocSpinner=!0,c.id&&j.getSymptomById(c.id,function(b){b&&(a.manageSymptom=b,a.setData(a.manageSymptom),a.manageSymptom.symptom=b.symptom.value)},function(b){a.manageOrgLocSpinner=!1,a.error=b,m.isEmpty(b.data)||m.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))}),"edit"===c.type&&b.loggedInUserDetails&&(a.orgLocPermission=o.USER_SYMPTOM_ADD,a.editmode=!0),"view"===c.type&&b.loggedInUserDetails&&(a.viewmode=!0,a.isVisible=!1,a.pageState="view"),c.symptomId&&j.getSymptomById(c.symptomId,function(b){b&&(a.manageSymptom=b,a.setData(a.manageSymptom),a.manageSymptom.symptom=b.symptom.value)},function(b){a.manageOrgLocSpinner=!1,a.error=b,m.isEmpty(b.data)||m.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))}),"add"===c.type){a.orgLocPermission=o.USER_SYMPTOM_ADD,a.manageSymptom?a.manageSymptom.stillExperiencing=!0:a.manageSymptom={stillExperiencing:!0};var d=p.getDefaultOrgLocation();m.isFieldEmpty(d)||(a.manageSymptom.creatingOrgLoc=d.orgLoc)}"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||s()},a.init(),a.setData=function(b){a.diseaseId=b.disease.id,a.getDisease(b.user.id),a.diseaseVariantId=b.diseaseVariant.id}}]),angular.module("paripal.userSymptomModule").controller("manageUserSymptomsPopupCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserSymptomsService","httpService","urlService","utilService","dateconvertor","featurePrivilegeConstants","baseService","$mdDialog","userSymptom","mode","appointmentRef",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";function u(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,k.getData(l.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.manageSymptom.creatingOrgLoc=b.data[0],a.manageSymptom.creatingOrgLoc},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function v(){a.manageSymptom.user&&a.manageSymptom.user.id&&(a.manageSymptom.user.id=a.manageSymptom.user.id,a.manageSymptom.user.value=a.manageSymptom.user.displayName,delete a.manageSymptom.user.displayName),a.manageSymptom&&a.manageSymptom.symptom&&a.manageSymptom.symptom.id&&(a.manageSymptom.symptom.id=a.manageSymptom.symptom.id,a.manageSymptom.symptom.value=a.manageSymptom.symptom.name,delete a.manageSymptom.symptom.name,delete a.manageSymptom.symptom.version,delete a.manageSymptom.symptom.whetherActive,delete a.manageSymptom.symptom.symptomDescription),j.saveUserSymptom(a.manageSymptom,function(b){b&&(/*$state.go('viewUserSymptoms');*/
a.manageSymptom&&a.manageSymptom.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")),q.cancel("Success"))},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function w(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,k.getData(l.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&x()},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function x(){a.viewmode=!0,a.isVisible=!1,a.pageState="view",j.getSymptomById(c.id,function(b){b&&(a.manageSymptom=b,a.setData(a.manageSymptom),a.manageSymptom.symptom=b.symptom.value)},function(b){a.manageOrgLocSpinner=!1,a.error=b,m.isEmpty(b.data)||m.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})}function y(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.name=b,a.userData.userId=a.loginDetails.id,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("FIND_USER_BY_USERID",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// return $scope.users = angular.fromJson(response.data);
return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function z(b){if(a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode){var c={};return c.keyword=b,k.getData(l.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}var c={};
//userObj.searchKeyWord = value;
return c.keyword=b,k.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){
//return httpService.getData(urlService.getParameterizedUrl('GET_ORG_LOC_LIST_BY_KEYWORD', userObj), null, function (response) {
if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function A(b){a.queryObj={},a.queryObj.userId=a.manageSymptom.user.id;var c=l.getParameterizedUrl("FIND_DISEASE_BY_USER",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.diseases=b.data,a.diseases},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function B(b){var c={};c.userId=a.manageSymptom.user.id,c.diseaseId=a.manageSymptom.disease.id;var d=l.getParameterizedUrl("FIND_DISEASE_BY_USER_AND_DISEASE",c);if(d)return k.getData(d,null,function(b){if(b&&b.data)return a.diseaseVariants=b.data,a.diseaseVariants},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function C(b){return a.symptomName={},a.symptomName.symptomName=b,a.symptomLoad=!0,k.getData(l.getParameterizedUrl("FIND_SYMPTOMNAME",a.symptomName),null,function(b){return a.symptom=!1,a.symptom=b.data},function(b){a.symptomLoad=!1,m.isEmpty(b.data)||m.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}a.saveUserSymptom=v,a.getDiseaseVariant=B,a.getSymptom=C,a.diseaseId={},a.manageSymptom={},a.maxDate=new Date,a.minDateValidTill=new Date,a.orgLocPermission=o.USER_SYMPTOM_ADD,a.getCreatedBy=z,a.isVisible=!1,a.getUserNamesForRoleHistory=y,a.field=!1,a.loginDetails=b.loggedInUserDetails,a.getSystemOrg=u,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=w,a.allowAccessOTP=x,a.getDisease=A,
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.manageSymptom.user={},a.manageSymptom.user.value=a.loginDetails.displayName,a.manageSymptom.user.id=a.loginDetails.id,A(a.manageSymptom.user.id),u()),a.cancel=function(){q.cancel()},a.init=function(){if(a.manageOrgLocSpinner=!0,s&&("view"===s.mode||"edit"===s.mode)&&r&&("view"===s.mode?(a.viewmode=!0,a.pageState="view"):(a.pageState="edit",a.editmode=!0),a.isVisible=!1,a.manageSymptom=r,a.manageSymptom.symptom.name=angular.copy(a.manageSymptom.symptom.value),delete a.manageSymptom.symptom.value,delete a.manageSymptom.symptom.code,a.diseaseId=a.manageSymptom.disease.id,a.diseaseVariantId=a.manageSymptom.diseaseVariant.id,a.getDisease(a.manageSymptom.user.id)),t&&(a.appointmentRef=t),a.appointmentRef&&(a.isFromAppointment=!0,a.manageSymptom||(a.manageSymptom={}),a.manageSymptom.user={id:a.appointmentRef.patientId,value:a.appointmentRef.patientName},a.getDisease(a.appointmentRef.patientId)),s&&"add"===s.mode){a.manageSymptom?a.manageSymptom.stillExperiencing=!0:a.manageSymptom={stillExperiencing:!0},a.orgLocPermission=o.USER_SYMPTOM_ADD;var b=p.getDefaultOrgLocation();m.isFieldEmpty(b)||(a.manageSymptom.creatingOrgLoc=b.orgLoc)}},a.init(),a.setData=function(b){a.diseaseId=b.disease.id,a.getDisease(b.user.id),a.diseaseVariantId=b.diseaseVariant.id}}]),angular.module("paripal.userSymptomModule").controller("viewUserSymptomDetailCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","viewUserSymptomDetailService","utilService","manageUserSymptomsService","commonConstants","urlService","httpService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,b,c){l.getSymptomById(a,function(e){var f,g=e;f=c?"edit":"view",d.go("manageUserSymptomDetail",{parentId:a,id:b,type:f,data:g})},function(a){f("error",h.instant(a.data.messages[0]))})}function q(a,b){var c;"add"==b&&d.go("manageUserSymptomDetail",{id:a,type:c})}function r(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,o.getData(n.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.user=b.data},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function s(b,c){var d={};d.userId=b,d.diseaseId=c;var e=n.getParameterizedUrl("FIND_DISEASE_BY_USER_AND_DISEASE",d);if(e)return o.getData(e,null,function(b){if(b&&b.data)return a.diseaseVariants=b.data,a.diseaseVariants},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function t(b){return a.symptomName={},a.symptomName.searchKeyWord=b,a.symptomLoad=!0,o.getData(n.getParameterizedUrl("GET_SYMPTOMS",a.searchKeyWord),null,function(b){return a.symptomLoad=!1,a.symptomLoad=angular.fromJson(b.data)},function(b){a.symptomLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})}
//check access for managing data	
function u(b){var c=!1;return a.accessibleSubscriberLocation&&!k.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.crudSymptomDetail=p,a.addSymptomDetail=q,a.userId={},a.userSymptom={},a.getSymptom=t,a.diseaseId={},a.checkOrganizationLocationAccess=u,a.getUserNamesForRoleHistory=r,a.getDiseaseVariant=s,a.symptomDetail={},a.hasAccessibleSubscriberLocation=!1,
//$scope.setData =setData; 
a.getSymptomDetailList=function(){var b={};a.symptomDetail,a.symptomDetail.diseaseId&&a.symptomDetail.diseaseId&&(b.diseaseId=a.symptomDetail.diseaseId.id),a.symptomDetail.diseaseVariantId&&a.symptomDetail.diseaseVariantId&&(b.diseaseVariantId=a.symptomDetail.diseaseVariantId.id),a.symptomDetail.symptomId&&a.symptomDetail.symptomId&&(b.symptomId=a.symptomDetail.symptomId.id),a.symptomDetail.userId&&(b.userSymptomId=c.id),a.symptomDetail.userId&&a.symptomDetail.userId?b.userId=a.symptomDetail.userId.id:null!=c.id&&(b.userSymptomId=c.id,a.userId=c.id),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,j.getSymptomDetailList(b,function(b){b&&(a.symptomDetailList=b.data,a.setData(a.symptomDetailList),a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getSymptomDetailList(),a.getDisease=function(b){a.queryObj={},a.queryObj.userId=b;var c=n.getParameterizedUrl("FIND_DISEASE_BY_USER",a.queryObj);if(c)return o.getData(c,null,function(b){if(b&&b.data)return a.diseases=b.data,a.diseases},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})};
//data table config
var v=m.gridConfigurations;a.options=g.setOptionProperties(v),a.dtColumnDefs=g.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getSymptomDetailList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getSymptomDetailList()},
//get subscribed accessible location   
a.getAccessibleSubscriberLocation=function(b){return o.getData(n.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.inActivate=function(b,c){j.deleteUserSymptomDetailRecordById(b,function(b){b&&(a.symptomDetailList.splice(c,1),f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_DELETED_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})},a.clear=function(){a.queryObj={},a.symptomDetail={},c.diseaseId=null,c.diseaseName=null,c.diseaseId=null,c.diseaseVariantName=null,d.go("viewUserSymptomDetail",{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1},{notify:!1}),a.getSymptomDetailList(),a.$scope.user={},a.diseaseVariants={},a.diseases={}},a.getSymptomDetailListFromUserSymptom=function(){r(c.userName),a.user=c.userName,a.queryObj={},a.queryObj.userId=c.userId,a.symptomDetail={},a.getDisease(c.userId),s(c.userId,c.diseaseId),a.symptomDetail.userId=c.userName,a.symptomDetail.diseaseId=c.diseaseName,a.diseaseVariantId=c.diseaseVariantName,a.symptomDetail.symptomId=c.symptomName},a.getSymptomDetailListFromUserSymptom(),a.setData=function(b){for(var c=0;b.length>c;c++){b[c].userSymptom.user.id;a.diseaseId=b[c].userSymptom.disease.id,a.diseaseVariantId=b[c].userSymptom.diseaseVariant.id}}}]),angular.module("paripal.userSymptomModule").controller("viewUserSymptomsCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","viewUserSymptomsService","httpService","utilService","urlService","commonConstants","resourceListService","featurePrivilegeConstants","baseService","$mdDialog","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(b){var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(m.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmpLoading=!1,a.user=b.data},function(b){a.userNameAutoCmpLoading=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function u(b,c){var d={};d.userId=b,d.diseaseId=c;var e=m.getParameterizedUrl("FIND_DISEASE_BY_USER_AND_DISEASE",d);if(e)return k.getData(e,null,function(b){if(b&&b.data)return a.diseaseVariants=b.data,a.diseaseVariants},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function v(a,b){j.getSymptomById(a,function(c){var e,f=c;"edit"==b?(e="edit",d.go("manageUserSymptoms",{id:a,type:e,data:f})):"view"==b?(e="view",d.go("manageUserSymptoms",{id:a,type:e,data:f})):"detail"==b&&d.go("viewUserSymptomDetail",{id:a,type:b,userName:f.user.value,diseaseName:f.disease.value,diseaseVariantName:f.diseaseVariant.value,symptomName:f.symptom.value,userId:f.user.id,diseaseVariantId:f.diseaseVariant.id,diseaseId:f.disease.id})},function(a){f("error",h.instant(a.data.messages[0]))})}
//check access for managing data
function w(b){var c=!1;return a.accessibleSubscriberLocation&&!l.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}function x(b,c){var d={};d.id=b,j.toggleChangeStatus(d,function(b){b&&(a.symptomList[c].stillExperiencing=!a.symptomList[c].stillExperiencing,f("success",h.instant("RECORD_UPDATED_SUCCESS")))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_UPDATE_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}function y(b){var c={};
//userObj.searchKeyWord = value;
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return c.keyword=b,k.getData(m.getParameterizedUrl("GET_ORG_LOC_LIST_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.orgLocList=b.data,a.orgLocList},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}/*User,disease,disease variant from user issue page*/
if(a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.searchSymptom={},a.diseaseId={},a.crudUserSymptom=v,a.hasAccessibleSubscriberLocation=!1,a.accessibleSubscriberLocation={},a.checkOrganizationLocationAccess=w,a.toggleChangeStatus=x,a.getUserNamesForRoleHistory=t,a.getDiseaseVariant=u,a.getCreatedBy=y,a.orgLocPermission=p.USER_SYMPTOM_ADD,a.disable=!1,a.loginDetails=b.loggedInUserDetails,q.validateListing("SYMPTOMS_RECORD_SUB"),a.listView=!0,a.cardView=!1,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1):(a.cardView=!1,a.listView=!0),"Card view"===c?"List View":"Card view"})}),b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(a.searchSymptom.userId={},a.searchSymptom.userId.id=b.loggedInUserDetails.id,a.searchSymptom.userId.value=b.loggedInUserDetails.displayName),
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),a.addNewSymptom=function(){d.go("manageUserSymptoms")},d.params.orgLocId&&(a.searchSymptom.creatingOrgLocId={},a.searchSymptom.creatingOrgLocId.id=d.params.orgLocId),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,c.userId&&c.userName&&(a.searchSymptom.userId={},a.searchSymptom.userId.id=c.userId,a.searchSymptom.userId.value=c.userName),c.userId&&c.diseaseVariantId&&c.diseaseId){a.searchSymptom||(a.searchSymptom={}),a.searchSymptom.userId||(a.searchSymptom.userId={}),a.searchSymptom.diseaseId||(a.searchSymptom.diseaseId={}),a.searchSymptom.diseaseVariant||(a.searchSymptom.diseaseVariant={}),a.searchSymptom.creatingOrgLocId||(a.searchSymptom.creatingOrgLocId={}),a.searchSymptom.userId.id=c.userId,a.searchSymptom.diseaseId.id=c.diseaseId,a.searchSymptom.diseaseVariant.id=c.diseaseVariantId,a.searchSymptom.creatingOrgLocId.id=c.locationId;var z={};z.id=c.diseaseId,z.value=c.diseaseName,a.diseases=[],a.diseases.push(z);var A={};A.id=c.diseaseVariantId,A.value=c.diseaseVariantName,a.diseaseVariants=[],a.diseaseVariants.push(A);var B={};B.diseaseId=[],B.diseaseId.push(z)}a.getUserSymptomList=function(){var b={};return a.searchSymptom&&a.searchSymptom.userId&&!a.searchSymptom.userId.id?void f("error",h.instant("INVALID_USER")):a.searchSymptom&&a.searchSymptom.creatingOrgLoc&&!a.searchSymptom.creatingOrgLoc.id?void f("error",h.instant("INVALID_LOCATION")):(a.searchSymptom.diseaseId&&a.searchSymptom.diseaseId&&(b.diseaseId=a.searchSymptom.diseaseId.id),a.searchSymptom.diseaseVariant&&a.searchSymptom.diseaseVariant&&(b.diseaseVariantId=a.searchSymptom.diseaseVariant.id),a.searchSymptom.userId&&a.searchSymptom.userId&&(b.userId=a.searchSymptom.userId.id),a.searchSymptom.creatingOrgLocId&&a.searchSymptom.creatingOrgLocId&&(b.creatingOrgLocId=a.searchSymptom.creatingOrgLocId.id),c.userName&&(a.searchSymptom.userId=c.userName,a.searchSymptom.diseaseId=c.diseaseName,a.searchSymptom.diseaseVariantId=c.diseaseVariantName,a.searchSymptom.creatingOrgLoc=c.locationName),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,void j.getUserSymptomList(b,function(b){b&&(a.disable=!0,a.symptomList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},(b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode||a.searchSymptom.userId&&a.searchSymptom.userId.id||c.userName)&&a.getUserSymptomList();
//           if($scope.searchSymptom.userId && $scope.searchSymptom.userId.id){
//               $scope.getUserSymptomList();
//            }
//          if($stateParams.userName){
//              if($rootScope.loggedInUserDetails && $rootScope.loggedInUserDetails.isOrganizationUserMode){
//                  $scope.getUserSymptomList();
//              }
// }
//data table config
var C=n.gridConfigurations;a.options=g.setOptionProperties(C),a.dtColumnDefs=g.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getUserSymptomList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getUserSymptomList()},a.clear=function(){a.searchSymptom={},a.diseases={},a.diseaseVariants={},a.symptomList=[],a.disable=!1},a.getDisease=function(b){a.queryObj={},a.queryObj.userId=b;var c=m.getParameterizedUrl("FIND_DISEASE_BY_USER",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.diseases=b.data,a.diseases},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},
//get subscribed accessible location
a.getAccessibleSubscriberLocation=function(b){return k.getData(m.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,/*if($scope.accessibleSubscriberLocation &&  $scope.accessibleSubscriberLocation.length>0){*/
a.accessibleSubscriberLocation&&!l.isEmpty(a.accessibleSubscriberLocation)&&(a.hasAccessibleSubscriberLocation=!0))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.redirectToDiseaseSymptom=function(a){d.go("searchDiseaseSymptoms",{diseaseVariantId:a.diseaseVariant.id,symptomId:a.symptom.id,diseaseVariant:a.diseaseVariant.value,disease:a.disease.value})},a.redirectToChecklist=function(a){o.getCheckListTypeByCode("SYMPTOM",function(b){b&&d.go("resourcelist",{checklistTypeId:b.id,resourceNameContains:a.symptom.value})},function(a){})},a.inActivate=function(b,c){j.deleteUserSymptomRecordById(b,function(b){b&&(a.symptomList.splice(c,1),f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_DELETED_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}}]),angular.module("paripal.userSymptomModule").service("manageUserSymptomDetailService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";this.getSymptomDetailById=function(c,d,e){var f={};f.id=c;a.getData(b.getParameterizedUrl("SYMPTOM_DETAIL_GET_BY_ID",f),null,function(a){a&&a.data?
//response.data.dateFelt = $filter('timestampToDate')(response.data.dateFelt, dateFormat);
d(a.data):e(a)},function(a){e(a)})},this.saveUserSymptomDetail=function(c,d,e){var f="";f=null!=c.id?"UPDATE_USER_SYMPTOM_DETAIL":"SAVE_USER_SYMPTOM_DETAIL",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getDetailRecordId=function(c,d){a.getData(b.getUrl("GET_DETAIL_AUTO_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.userSymptomModule").service("manageUserSymptomsService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";this.saveUserSymptom=function(c,d,e){var f="";f=null!=c.id?"UPDATE_USER_SYMPTOM":"SAVE_USER_SYMPTOM",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getSymptomById=function(c,d,e){var f={};f.id=c,
//var dateFormat = 'MM/dd/yyyy';
a.getData(b.getParameterizedUrl("USER_SYMPTOM_GET_BY_ID",f),null,function(a){a&&a.data?
//response.data.dateFirstExperienced = $filter('timestampToDate')(response.data.dateFirstExperienced, dateFormat);
//response.data.dateLastFelt = $filter('timestampToDate')(response.data.dateLastFelt, dateFormat);
d(a.data):e(a)},function(a){e(a)})},this.getSymptomRecordId=function(c,d){a.getData(b.getUrl("GET_SYMPTOM_AUTO_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.userSymptomModule").service("viewUserSymptomDetailService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getSymptomDetailList=function(b,d,e){a.postData(c.getUrl("SYMPTOM_DETAIL_FINDBY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getSymptomDetailById=function(b,d,e){var f={};f.id=b,a.getData(c.getParameterizedUrl("SYMPTOM_DETAIL_GET_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.deleteUserSymptomDetailRecordById=function(b,d,e){var f={};f.id=b,a.deleteData(c.getParameterizedUrl("DELETE_SYMPTOM_DETAIL_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userSymptomModule").service("viewUserSymptomsService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getUserSymptomList=function(b,d,e){a.postData(c.getUrl("SEARCH_USER_SYMPTOM_FINDBY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getSymptomById=function(d,e,f){var g={};g.id=d;var h="MM/dd/yyyy";a.getData(c.getParameterizedUrl("USER_SYMPTOM_GET_BY_ID",g),null,function(a){a&&a.data?(a.data.dateFirstExperienced=b("timestampToDate")(a.data.dateFirstExperienced,h),a.data.dateLastFelt=b("timestampToDate")(a.data.dateLastFelt,h),e(a.data)):f(a)},function(a){f(a)})},this.toggleChangeStatus=function(b,d,e){a.getData(c.getParameterizedUrl("USER_SYMPTOM_CHANGE_STATUS",b),null,function(a){a?d(a):e(a)},function(a){e(a)})},this.deleteUserSymptomRecordById=function(b,d,e){var f={};f.id=b,a.deleteData(c.getParameterizedUrl("SYMPTOM_RECORD_DELETE_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userTestModule").controller("AddShareUserTestCtrl",["$scope","$rootScope","$stateParams","$state","notify","$translate","utilService","userStatusService","commonConstants","httpService","urlService","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.commonConstants=i,a.minDate=new Date,a.addSharedObj={},a.addSharedObj.sharedEntity="DIAGNOSTIC_TEST",a.addSharedObj.sharedOn=l.convertToServerDate(a.minDate),a.addSharedObj.whetherActive=!0,a.sharedBy={},a.sharedWith={};var m=h.userStatus().isLoggedIn,n=h.userStatus().userData;a.init=function(){a.checkPageState()},a.getUserTestList=function(b,c){var d={};d.userId=b.id,d.userTestTrName="";var e=k.getParameterizedUrl("FIND_USERTESTBYUSERID",d);/*url = url + "&checkReportAttached=true"*/
j.getData(e,null,function(b){if(a.diagnosticTestUserList=angular.fromJson(b.data),!g.isFieldEmpty(c))for(var d=0;d<a.diagnosticTestUserList.length;d++)c.entityInstanceId==a.diagnosticTestUserList[d].id&&(a.diagnosticTestUser=a.diagnosticTestUserList[d])},function(a){})},a.loadEntityId=function(b){console.log(a.diagnosticTestUser),a.addSharedObj.sharedEntityName=b.value,a.addSharedObj.entityInstanceId=b.id},a.checkPageState=function(){a.pageState="add","add"===c.type||g.isNullOrEmpty(c.type)?(m&&(a.addSharedObj.sharedBy=n,a.disableSharedByUser=!0),a.getUserTestList(a.addSharedObj.sharedBy,null)):"linkCalled"===c.type?(a.addSharedObj.sharedBy=c.data.user,a.diagnosticTestUser=c.data.diagnosticTest,a.loadEntityId(a.diagnosticTestUser)):(a.pageState=c.type,a.setSharedDetails(c.data))},a.setSharedDetails=function(b){angular.copy(b,a.addSharedObj),g.isNullOrEmpty(b.shareValidTill)||(a.addSharedObj.shareValidTill=l.convertToViewDate(b.shareValidTill)),m&&(a.addSharedObj.sharedBy.id===n.id?a.isIndividualUser=!0:a.addSharedObj.sharedWith.id===n.id&&(a.isOrgUser=!0)),a.getUserTestList(a.addSharedObj.sharedBy,b)},a.sharedWith={queryUrl:"GET_ADVISED_BY_SEACRH_KEY",queryParameter:{},jsonParameter:{}},/*
                        $scope.sharedBy = {
                            queryUrl: "GET_PATIENTS_BY_SEACRH_KEY",
                            queryParameter: {},
                            jsonParameter: {}
                        };*/
a.shareDetails=function(b,c){if(c.$valid){var d={};angular.copy(b,d),g.isNullOrEmpty(b.shareValidTill)||(d.shareValidTill=l.convertToServerDate(b.shareValidTill)),d.id?j.putData(k.getParameterizedUrl("UPDATE_SHAREDUSERTESTREPORT",d),d,function(b){e("success",b.data.successMessage),a.back()},function(){}):j.postData(k.getUrl("SHARE_USERTEST"),d,function(b){g.isNullOrEmpty(b.data.successMessage)||(e("success",b.data.successMessage),a.back())},function(a){})}},a.back=function(){g.goBackToPrevState()},a.init()}]),angular.module("paripal.userTestModule").controller("PrescriptionFileUploaderCtrl",["$scope","$mdDialog","userIdDocumentService","$rootScope","utilService","urlService","httpService","docType","docSubType","isMultipleFileUpload",function(a,b,c,d,e,f,g,h,i,j){a.documentUploadFile=null,a.uploadDocumentObj=new Object,a.uploadDocumentObj.selectedFileArray=new Array,a.docSubType=i,a.docType=h,j?a.multiFileUpload=!0:a.multiFileUpload=!1,a.loadListOfDocumentTypes=function(){d.showSpinner=!0;var b=f.getUrl("GET_DOCUMENT_TYPES");g.getData(b,null,function(b){a.documentTypeList=b.data,d.showSpinner=!1},function(a){d.showSpinner=!1})},a.uploadForm=function(a,c){c.$valid&&a&&b.hide(a)},a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.init=function(){a.loadListOfDocumentTypes()},a.init()}]),angular.module("paripal.userTestModule").controller("SharedUserTestListCtrl",["$scope","$rootScope","$stateParams","datatableconfig","$state","notify","$translate","serverSidePagination","httpService","urlService","userTestListService","utilService","commonConstants","userStatusService","addUserTestService","dateconvertor",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.commonConstants=m,a.isDisableByMe=!0,a.diagnosticTestList=[];var q=n.userStatus();a.init=function(){a.filterCriteria={},a.filterCriteria.whetherAllStatus="BY_ME",l.isEmpty(q)||(a.loadDiagnosticUserTest(q.userData.id),a.changeSharedRecord(a.filterCriteria.whetherAllStatus)),a.weatherOrgUser=q.isOrgUser,a.searchData()},a.loadDiagnosticUserTest=function(b){var c={};c.userId=b,c.userTestTrName="",i.getData(j.getParameterizedUrl("FIND_USERTESTBYUSERID",c),null,function(b){a.diagnosticTestList=angular.fromJson(b.data)})},a.changeSharedRecord=function(b){"BY_ME"==b&&(a.filterCriteria.sharedWith=null,a.filterCriteria.sharedBy=angular.copy(q.userData),a.isDisableByMe=!0,a.isDisableWithMe=!1),"WITH_ME"==b&&(a.filterCriteria.sharedBy=null,a.filterCriteria.sharedWith=angular.copy(q.userData),a.isDisableWithMe=!0,a.isDisableByMe=!1)},a.getShareWithPerson=function(b){a.sharedWithAutoCmp=!0;var c=j.getUrl("GET_ADVISED_BY");return c+=b,i.getData(c,null,function(b){return a.sharedWithAutoCmp=!1,a.sharedWithUsersList=angular.fromJson(b.data),a.sharedWithUsersList},function(b){a.sharedWithAutoCmp=!1})},a.getShareByPerson=function(b){a.sharedWithAutoCmp=!0;var c={};return c.searchString=b,i.getData(j.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.sharedWithAutoCmp=!1,a.sharedByUsersList=angular.fromJson(b.data),a.sharedByUsersList},function(b){a.sharedWithAutoCmp=!1})},/**
             *search Data functionality
             */
a.searchData=function(){var b={};a.shareUserTestListSpiner=!0,angular.copy(a.filterCriteria,b),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,l.isEmpty(a.filterCriteria.sharedBy)||(b.sharedBy=a.filterCriteria.sharedBy.id),l.isEmpty(a.filterCriteria.sharedWith)||(b.sharedWith=a.filterCriteria.sharedWith.id),l.isNullOrEmpty(a.filterCriteria.dateFrom)||(b.sharedOnStartDate=p.convertToServerDate(a.filterCriteria.dateFrom)),l.isNullOrEmpty(a.filterCriteria.dateTill)||(b.sharedOnTillDate=p.convertToServerDate(a.filterCriteria.dateTill)),delete b.whetherAllStatus,delete b.dateFrom,delete b.dateTill,b.whetherSharedTab=a.isDisableByMe,b.sharedEntity="DIAGNOSTIC_TEST",b=l.checkNullProp(b),i.postData(j.getUrl("GET_USER_SHARED_DETAILS"),b,function(b){a.shareUserTestListSpiner=!1;var c={};c=angular.fromJson(b.data),a.totalItems=c.totalRecords,a.sharelist=c.data,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.shareUserTestListSpiner=!1})},a.checkValidity=function(a){return l.dateComparator(new Date,a,"gt")},a.addSharedUserTests=function(a,b){e.go("shareusertest",{type:b,data:a})},a.viewUserTestRecord=function(b){var c=b.entityInstanceId;k.getUserTestById(c,function(a){var b=a;e.go("addEditUserTests",{type:"view",data:b,userTestId:c})},function(b){a.error=b})},a.viewMeasurementOrUserTestReportList=function(a,b){var c={},d={};c.id=a.entityInstanceId,i.getData(j.getParameterizedUrl("USER_TEST_BY_ID",c),null,function(a){d=a.data,o.viewUserTestMeasurementOrReport(d,b)},function(){})},/*$scope.viewUserTestReport = function (row) {
                console.log(row);
            };*/
a.clear=function(){/*$scope.init();
                $scope.changeSharedRecord("WITH_ME");*/
e.reload()},/**
             *Server side pagination module
             */
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};/**
                 *datatble config json
                 */
var r=m.gridConfigurations;a.options=d.setOptionProperties(r),a.init()}]),angular.module("paripal.userTestModule").controller("TestOrderCtrl",["$scope","$rootScope","$stateParams","datatableconfig","$state","notify","$translate","serverSidePagination","httpService","urlService","utilService","commonConstants","userStatusService","baseService","$mdDialog","featurePrivilegeConstants","addUserTestService","dateconvertor","EmergencyTransactionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.noOfTests=[],a.testOrderId={},a.isIndUser=!1,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WSDiagnosticTestUser={},a.WSDiagnosticTestUserData={},a.testOrder={},a.userTestList=[],a.filterCriteria={},a.filterCriteria.oranizationId={},a.filterCriteria.organizationLocationId={},a.clicked=!1,a.commonConstants=l,b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode&&n.validateListing("DIAGNOSTIC_TEST_SUB"),a.user={},a.WSDiagnosticTestUser.requestedOn=new Date,a.WSDiagnosticTestUser.whetherHomePickupRequest=!1,a.testArray=[],a.testItArray=[{}],a.WSDiagnosticTestUser.diagnosticTests=[],a.minDate=new Date,a.cancel=function(){k.isNullOrEmpty(c)||k.isNullOrEmpty(c.fromState)?k.goBackToPrevState():e.go("appointmentsListCardView",{keepLocalStorage:!0})},a.addTest=function(){a.testItArray.push({})},a.removeTest=function(b){a.testItArray.splice(b,1),a.noOfTests.splice(b,1),a.testArray.splice(b,1),"edit"==a.pageState&&(a.WSDiagnosticTestUser.diagnosticTests=a.noOfTests)},a.fileUploader=function(b){o.show({controller:"PrescriptionFileUploaderCtrl",templateUrl:"app/modules/user-tests/views/prescription-file-uploader.html",parent:angular.element(document.body),targetEvent:b,locals:{docType:"TEST",docSubType:"PRESCRIPTION",isMultipleFileUpload:!1},clickOutsideToClose:l.dialogBox.clickOutsideToClose}).then(function(b){a.uploadFileObject=b})},a.viewPrintFile=function(b,c){if(!k.isEmpty(c)){var d=new Object;d.fileName=c.fileName,d.resourceId=c.id,d.docType=c.documentType.type,d.docSubType=c.documentType.subType,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!0}},a.getAdvisedByData=function(b){a.advisedBySpinner=!0;var c=j.getUrl("GET_ADVISED_BY");return c+=b,i.getData(c,null,function(b){return a.advisedBySpinner=!1,a.countryData=angular.fromJson(b.data),a.countryData},function(b){a.advisedBySpinner=!1})},a.onAdvisedBySelect=function(b){a.WSDiagnosticTestUser.advisedById=null,"object"==typeof b?(a.WSDiagnosticTestUser.advisedByName=b.value,b.id&&(a.WSDiagnosticTestUser.advisedById=b.id)):a.WSDiagnosticTestUser.advisedByName=b},a.getUserData=function(b){a.userNameAutoCmp=!0;var c={},d=[];return c.searchString=b,i.getData(j.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.onUserSelect=function(b){a.WSDiagnosticTestUser.user=angular.copy(b);var c={};c.userId=b.id,i.getData(j.getParameterizedUrl("GET_USER_PROFILE_BY_ID",c),null,function(b){b&&b.data&&(a.WSDiagnosticTestUser.patientPhone=b.data.cell1,a.WSDiagnosticTestUser.patientBirthDate=r.convertToServerDate(b.data.birthDate),a.user.gender=b.data.gender,a.user.gender?a.disableGender=!0:a.disableGender=!1)},function(a){})},a.$watch("WSDiagnosticTestUserData.userId",function(b){k.isNullOrEmpty(b)&&(delete a.WSDiagnosticTestUser.patientPhone,delete a.WSDiagnosticTestUser.patientBirthDate,a.user={})},!0),a.getTestPrescribed=function(b,d){var e=angular.fromJson(localStorage.getItem("defaultOrgLoc")),f="";if("prescription"!=a.pageState){var g=null;k.isNullOrEmpty(e)?c.data&&c.data.testConductedAt&&(g=c.data.testConductedAt.id):g=e.id;var h={locationId:g,testName:b};f=j.getParameterizedUrl("FIND_DIAGNOSTIC_TESTS_BY_LOCATION_FOR_ORDER",h)}else{var h={searchString:b};f=j.getParameterizedUrl("FIND_DIAGNOSTIC_TESTS_BY_LOCATION",h)+"&whetherActive="+d+"&orgLocId="}return i.getData(f,null,function(b){if(a.countryData=angular.fromJson(b.data),!k.isNullOrEmpty(a.countryData))return k.isNullOrEmpty(a.countryData.wsBooleanValue)?a.countryData:a.countryData.wsBooleanValue},function(a){})},a.onTestPrescribedSelect=function(b,c,d,e){var h=!1;angular.forEach(a.noOfTests,function(c,d){if(d==e){h=!0;var i={};i=b,a.testArray[d]=b,a.noOfTests[d]=i}else c.test&&b.id==c.id?(h=!0,angular.forEach(a.testArray,function(c,d){b.id==c.id&&(delete a.testArray[e],delete a.noOfTests[e],a.testItArray.splice(e,1),a.testArray=a.testArray.filter(function(a){return void 0!=a}),a.noOfTests=a.noOfTests.filter(function(a){return void 0!=a}),f("error",g.instant("TEST_ALREADY_SELECTED")))})):c&&b.id==c.id&&(h=!0,angular.forEach(a.testArray,function(c,d){b.id==c.id&&(delete a.testArray[e],delete a.noOfTests[e],a.testItArray.splice(e,1),a.testArray=a.testArray.filter(function(a){return void 0!=a}),a.noOfTests=a.noOfTests.filter(function(a){return void 0!=a}),f("error",g.instant("TEST_ALREADY_SELECTED")))}))}),0==h&&(k.isNullOrEmpty(b)||a.noOfTests.push(b))},a.submitOrder=function(){if(b.showSpinner=!0,k.isNullOrEmpty(a.user)||k.isNullOrEmpty(a.user.gender)||(k.isNullOrEmpty(a.user.gender.dataValue)||(a.WSDiagnosticTestUser.patientGender=a.user.gender.dataValue),k.isNullOrEmpty(a.WSDiagnosticTestUser)||!k.isNullOrEmpty(a.WSDiagnosticTestUser.patientGender)||k.isNullOrEmpty(a.user.gender)||(a.WSDiagnosticTestUser.patientGender=a.user.gender)),k.isNullOrEmpty(a.WSDiagnosticTestUser.user)&&(k.isNullOrEmpty(a.WSDiagnosticTestUserData.userId)||(a.WSDiagnosticTestUser.user=a.WSDiagnosticTestUserData.userId)),"prescription"==a.pageState?a.WSDiagnosticTestUser.orderStatus="PRESCRIBED":a.WSDiagnosticTestUser.orderStatus="CREATED",!k.isNullOrEmpty(a.noOfTests)&&0!=a.noOfTests.length)if("edit"==a.pageState){a.noOfTests=a.noOfTests.filter(function(a){return void 0!=a});for(var c=0;c<a.noOfTests.length;c++)k.isNullOrEmpty(a.noOfTests[c])||k.isNullOrEmpty(a.noOfTests[c].flag)||delete a.noOfTests[c].flag,a.WSDiagnosticTestUser.diagnosticTests=a.noOfTests}else for(var c=0;c<a.noOfTests.length;c++)/*if (utilService.isNullOrEmpty($scope.noOfTests[i].test)) {
    $scope.noOfTests.splice(i, 1);
}*/
k.isNullOrEmpty(a.noOfTests[c])||k.isNullOrEmpty(a.noOfTests[c].flag)||delete a.noOfTests[c].flag,a.WSDiagnosticTestUser.diagnosticTests=a.noOfTests;for(var d=0;d<a.WSDiagnosticTestUser.diagnosticTests.length;d++)a.WSDiagnosticTestUser.diagnosticTests[d].test&&(a.WSDiagnosticTestUser.diagnosticTests.splice(d,1),--d);if(k.isNullOrEmpty(a.testOrder.homePickupTime)||(a.WSDiagnosticTestUser.homePickupTime=a.testOrder.homePickupTime.getHours()+":"+a.testOrder.homePickupTime.getMinutes()+":00"),!k.isEmpty(a.uploadFileObject)&&k.isFieldEmpty(a.uploadFileObject.id)){var e={};e.fileName=a.uploadFileObject.fileName,e.fileIdentifier=a.uploadFileObject.fileIdentifier,e.documentType=a.uploadFileObject.documentType,q.saveDocumentDetails(e,a.pageState,function(b){a.uploadFileObject&&a.uploadFile(a.uploadFileObject,b)},function(){a.manageUserTestSpiner=!1})}else a.saveTestOrder()},a.createTest=function(){a.testInputObj=a.prescriptionObj.response,a.finalDiagnosticObj.userDiagnosticTests=a.testInputObj,c.appointmentId&&(a.finalDiagnosticObj.appointment={id:c.appointmentId}),i.postData(j.getUrl("CREATE_TEST_FROM_PRESCRIPTION"),a.finalDiagnosticObj,function(a){f("success",g.instant(a.data.successMessage)),k.goBackToPrevState()},function(a){})},a.uploadFile=function(b,c){var d=new Object;d.file=b.fileToBeUpload,d.docType=b.documentType.type,d.docSubType=b.documentType.subType,k.isNullOrEmpty(c.response)||(d.resourceId=c.response),k.isFieldEmpty(a.WSDiagnosticTestUser.user)||(d.userId=a.WSDiagnosticTestUser.user.id),q.uploadFile(d,function(b){a.documentId=c.response,a.saveTestOrder()},function(b){a.manageUserTestSpinner=!1,f("Error",g.instant("ERROR_WHILE_UPLOADING"))})},a.saveTestOrder=function(){var d=angular.copy(a.WSDiagnosticTestUser);k.isNullOrEmpty(a.documentId)||(d.prescriptionFile={id:a.documentId}),"edit"==a.pageState?(k.isNullOrEmpty(d.advisedBy)||k.isNullOrEmpty(d.advisedById)&&k.isNullOrEmpty(d.advisedByName)&&(d.advisedById=d.advisedBy.id,d.advisedByName=d.advisedBy.value),delete d.advisedBy,d.labsReferredName=d.testConductedAt.value,0==d.whetherHomePickupRequest&&(d.homePickupDate=null,d.homePickupTime=null),k.isNullOrEmpty(a.testOrderId)||i.putData(j.getParameterizedUrl("UPDATE_DIAGNOSTIC_TEST_ORDER",a.testOrderId),d,function(a){if(a&&a.data){if(f("success",g.instant(a.data.successMessage)),b.showSpinner=!1,!k.isNullOrEmpty(c.data.user)){var d={};d.user=c.data.user}e.go("testorderlist",{data:d})}},function(a){b.showSpinner=!1})):(a.url="CREATE_DIAGNOSTIC_TEST_ORDER",delete d.advisedBy,a.finalDiagnosticObj=d,i.postData(j.getUrl(a.url),d,function(d){if(d&&d.data)if(a.transactionId=d.data.response,f("success",g.instant(d.data.successMessage)),b.showSpinner=!1,1!=c.isPrescription)if("prescription"==a.pageState)e.go("usertestlist",{pageState:"prescription"});else if(a.isIndUser)a.paymentMethod(a.transactionId);else{if(!k.isNullOrEmpty(c.data)&&!k.isNullOrEmpty(c.data.user)){var h={};h.user=c.data.user}e.go("testorderlist",{data:h})}else a.showTestBtn=!0,a.prescriptionObj=d.data,k.goBackToPrevState()},function(a){b.showSpinner=!1}))},a.paymentMethod=function(a){if(a){var b={transactionId:a};localStorage.setItem("BillDetails",angular.toJson({BILL_FOR:"DIAGNOSTIC_TEST"})),s.getWhetherBillDetails(b,function(b){e.go("billsummaryview",{transactionId:a})},function(a){var b="UNABLE_TO_BOOK_TEST",c="UNABLE_TO_BOOK_TEST_MESSAGE",d=o.confirm().title(g.instant(b)).textContent(g.instant(c)).ok(g.instant("OK")).cancel(g.instant("CANCEL"));o.show(d).then(function(){},function(){e.go("testorderlist")})},{handleError:!1})}};var t=function(){var d=n.getLoggedInUser();d.userAccountStatusDTO&&1==d.userAccountStatusDTO.whetherDoctor&&b.loggedInUserDetails.isOrganizationUserMode&&(a.whetherDoctor=!0,a.WSDiagnosticTestUserData.advisedBy={id:d.id,value:d.displayName},a.WSDiagnosticTestUser.advisedByName=d.displayName,a.WSDiagnosticTestUser.advisedById=d.id),c.appointmentId&&(a.WSDiagnosticTestUser.appointment={id:c.appointmentId}),c.patientDetails&&(a.WSDiagnosticTestUserData.userId=c.patientDetails,a.disableUserSelection=!0,a.onUserSelect(a.WSDiagnosticTestUserData.userId));var e=n.getDefaultOrgLocation();if(k.isFieldEmpty(e)?k.isNullOrEmpty(c.data)||k.isNullOrEmpty(c.data.testConductedAt)||(a.WSDiagnosticTestUser.testConductedAt=c.data.testConductedAt,a.WSDiagnosticTestUser.labsReferredName=c.data.testConductedAt.value,a.WSDiagnosticTestUser.labsReferred=c.data.testConductedAt):(a.WSDiagnosticTestUser.testConductedAt=e.orgLoc,a.WSDiagnosticTestUser.labsReferredName=e.orgLoc.value,a.WSDiagnosticTestUser.labsReferred=e.orgLoc),!b.loggedInUserDetails.isOrganizationUserMode){a.isIndUser=!0;var f=n.getLoggedInUser();a.WSDiagnosticTestUserData.userId={id:f.id,value:f.displayName},k.isNullOrEmpty(a.WSDiagnosticTestUserData)||k.isNullOrEmpty(a.WSDiagnosticTestUserData.userId)||a.onUserSelect(a.WSDiagnosticTestUserData.userId)}/*$scope.pageState = 'view';*/
if(!k.isNullOrEmpty(c)){if(k.isNullOrEmpty(c)||k.isNullOrEmpty(c.data)||k.isNullOrEmpty(c.data.user)||a.onUserSelect(c.data.user),a.pageState=c.pageState,"view"==a.pageState||"edit"==a.pageState){var g={};g.id=c.data.id,a.testOrderId=g,i.getData(j.getParameterizedUrl("FIND_TEST_ORDER_BY_ID",g),null,function(c){if(c&&c.data){if(b.showSpinner=!0,a.WSDiagnosticTestUser=c.data,k.isNullOrEmpty(a.WSDiagnosticTestUser.user)||k.isNullOrEmpty(a.WSDiagnosticTestUser.user.id)||a.onUserSelect(a.WSDiagnosticTestUser.user),k.isNullOrEmpty(a.WSDiagnosticTestUser.prescriptionFile)||(a.uploadFileObject=a.WSDiagnosticTestUser.prescriptionFile),!k.isNullOrEmpty(c.data.homePickupTime)){var d=new Date,e=d.getDate(),f=d.getMonth()+1,g=d.getFullYear();e<10&&(e="0"+e),f<10&&(f="0"+f);var d=f+"/"+e+"/"+g;a.testOrder.homePickupTime=new Date(d+" "+c.data.homePickupTime)}k.isNullOrEmpty(c.data.user)||(a.WSDiagnosticTestUserData.userId=c.data.user),k.isNullOrEmpty(c.data.advisedBy)?k.isNullOrEmpty(c.data.advisedByName)||(a.WSDiagnosticTestUserData.advisedBy={value:c.data.advisedByName}):a.WSDiagnosticTestUserData.advisedBy=c.data.advisedBy,k.isNullOrEmpty(c.data.diagnosticTests)||(a.noOfTests=angular.copy(c.data.diagnosticTests),a.testItArray=angular.copy(c.data.diagnosticTests),a.testArray=angular.copy(c.data.diagnosticTests)),b.showSpinner=!1}},function(a){b.showSpinner=!1})}k.isNullOrEmpty(c.data)||k.isNullOrEmpty(c.data.user)||(a.WSDiagnosticTestUserData.userId=c.data.user)}};t()}]),angular.module("paripal.userTestModule").controller("TestOrderListCtrl",["$scope","$rootScope","$stateParams","datatableconfig","$state","notify","$translate","serverSidePagination","httpService","urlService","userTestListService","utilService","commonConstants","userStatusService","statePersistenceService","baseService","$timeout","$mdDialog","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(a,b,c,d,e,f,g,h){a.transactionList=f,a.selectedTransaction=[],a.currentTransaction=h,a.addRemoveTransaction=function(b){var c=!1;angular.forEach(a.selectedTransaction,function(d,e){d.transactionId==b.transactionId&&(a.selectedTransaction.splice(e,1),c=!0)}),0==c&&a.selectedTransaction.push(b)},a.createBill=function(){angular.forEach(a.transactionList,function(b,c){b.transactionId==a.currentTransaction&&a.selectedTransaction.push(b)}),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),b.cancel(),d.go("createbill",{type:"DEBIT",data:g,feeHeadAmnt:"YES",pageState:"CREATE",isCreateReceipt:!0,transactionList:a.selectedTransaction})},a.cancel=function(){b.cancel()}}t.$inject=["$scope","$mdDialog","notify","$state","$rootScope","transactionList","paramData","currentTransaction"],a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WSDiagnosticTestUser={},a.WSDiagnosticTestUserData={},a.userTestList=[],a.filterCriteria={},a.filterCriteria.oranizationId={},a.filterCriteria.organizationLocationId={},a.clicked=!1,a.commonConstants=m,b.loggedInUserDetails&&b.loggedInUserDetails.isOrganizationUserMode&&p.validateListing("DIAGNOSTIC_TEST_SUB"),a.status={open:!0},a.getUserData=function(b){a.userNameAutoCmp=!0;var c={},d=[];return c.searchString=b,i.getData(j.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.onUserSelect=function(b){a.WSDiagnosticTestUser.userId=angular.copy(b.id),a.filterByUserId=angular.copy(b.id)},a.getAdvisedByData=function(b){a.advisedBySpinner=!0;var c=j.getUrl("GET_ADVISED_BY");return c+=b,i.getData(c,null,function(b){return a.advisedBySpinner=!1,a.countryData=angular.fromJson(b.data),a.countryData},function(b){a.advisedBySpinner=!1})},a.onAdvisedBySelect=function(b){a.WSDiagnosticTestUser.advisedById=b.id},a.getTestPrescribed=function(b,c){var d={searchString:b},e=angular.fromJson(localStorage.getItem("defaultOrgLoc")),f="";return f=e?j.getParameterizedUrl("FIND_DIAGNOSTIC_TESTS_BY_LOCATION",d)+"&whetherActive="+c+"&orgLocId="+e.id:j.getParameterizedUrl("FIND_DIAGNOSTIC_TESTS_BY_LOCATION",d)+"&whetherActive="+c+"&orgLocId=",i.getData(f,null,function(b){return a.countryData=angular.fromJson(b.data),a.countryData.wsBooleanValue},function(a){})},a.onTestPrescribedSelect=function(b){a.WSDiagnosticTestUser.diagnosticTestId=b.id},a.userTestOrderDetails=function(a,b){var c={};c.id=b.id,e.go("testorder",{pageState:a,data:c})};var u=function(){l.isNullOrEmpty(c.data)||l.isNullOrEmpty(c.data.user)||(a.WSDiagnosticTestUserData.userId=c.data.user),a.searchUserTestOrder(),a.addPermission=s.LAB_CRM_DIAG_TEST_ORDER_ADD,a.editPermission=s.LAB_CRM_DIAG_TEST_ORDER_EDIT,a.viewPermission=s.LAB_CRM_DIAG_TEST_ORDER_VIEW,a.showTestPermission=s.LAB_CRM_DIAG_TEST_USER_VIEW};a.searchUserTestOrder=function(){b.showSpinner=!0,l.isNullOrEmpty(a.WSDiagnosticTestUser.user)&&(l.isNullOrEmpty(a.filterByUserId)?l.isNullOrEmpty(a.WSDiagnosticTestUserData.userId)||(a.WSDiagnosticTestUser.userId=a.WSDiagnosticTestUserData.userId.id):l.isNullOrEmpty(a.WSDiagnosticTestUserData.userId)?delete a.WSDiagnosticTestUser.userId:a.WSDiagnosticTestUser.userId=a.filterByUserId),a.WSDiagnosticTestUser.pageNumber=a.currentPage,a.WSDiagnosticTestUser.recordsPerPage=a.itemPerPage,l.isNullOrEmpty(a.WSDiagnosticTestUser.whetherHomePickupRequest)||0==a.WSDiagnosticTestUser.whetherHomePickupRequest&&delete a.WSDiagnosticTestUser.whetherHomePickupRequest,k.searchUserTestOrders(a.WSDiagnosticTestUser,a.filterCriteria,function(c){b.showSpinner=!1,angular.copy(c.data,a.userTestList),a.totalItems=c.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(c){b.showSpinner=!1,a.error=c})},a.clear=function(){e.reload()},a.fetchRecords=function(){a.searchUserTestOrder()},a.addUserTestOrder=function(){if(!l.isNullOrEmpty(c.data)&&!l.isNullOrEmpty(c.data.user)){var a={};a.user=c.data.user}e.go("testorder",{pageState:"add",data:a})},a.showTests=function(a){var b={orderId:a.id};b.user={id:a.userId,value:a.userName},e.go("usertestlist",{orderId:b.orderId,user:b.user})},a.goToBill=function(b){if("NEW"==b.transactionStatus){var c={};c.raisedOn="INDIVIDUAL",c.whetherRefundAllowed=!0,c.fromCheckIn=!0;var d={};l.isNullOrEmpty(b.transactionId)?f("error",g.instant("TRANSACTION_NOT_FOUND")):(d.transactionId=b.transactionId,i.postData(j.getUrl("GET_ADHOC_BILL_SETUP"),d,function(c){if(!l.isFieldEmpty(c.data)){/* SERVER params to be sent */
var d=angular.copy(c.data);/*UI params to be sent*/
d.fromCheckIn=!0,d.raisedOn="INDIVIDUAL",d.whetherRefundAllowed=!0,d.transaction={id:b.transactionId},l.isNullOrEmpty(b.orgLocId)||l.isNullOrEmpty(b.orgLocName)||(d.ownerLocationId={id:b.orgLocId,value:b.orgLocName}),l.isNullOrEmpty(b.userId)||l.isNullOrEmpty(b.userName)||(d.raisedOnDetails={raisedOnUserId:b.userId,raisedOnName:b.userName},d.raisedOnUserId={id:b.userId,value:b.userName});var f={};f.onBehalfofUser={id:b.userId,value:b.userName},f.organizationLocation={id:b.orgLocId},i.postData(j.getUrl("GET_ALL_UNBUILD_TRANSACTIONS"),f,function(c){if(c.data&&c.data.length>1)r.show({controller:t,templateUrl:"app/modules/billing/views/unbilled-transaction-list.html",parent:angular.element(document.body),clickOutsideToClose:!1,
// fullscreen: useFullScreen,
locals:{transactionList:c.data,paramData:d,currentTransaction:b.transactionId}});else if(c.data&&1==c.data.length){var f=c.data[0];a.selectedTransaction=[],a.selectedTransaction.push(f),angular.forEach(a.selectedTransaction,function(a,b){a.serviceTypes&&null!=a.serviceTypes&&(a.serviceTypeIds=[],angular.forEach(a.serviceTypes,function(b,c){a.serviceTypeIds.push(b.id)})),(a.serviceTypes||null==a.serviceTypes)&&delete a.serviceTypes,(a.transactionType||null==a.transactionType)&&delete a.transactionType,(a.serviceType||null==a.serviceType)&&delete a.serviceType,(a.transactionDate||null==a.transactionDate)&&delete a.transactionDate}),e.go("createbill",{type:"DEBIT",data:d,feeHeadAmnt:"YES",pageState:"CREATE",serviceTypeList:b.serviceTypes,transactionList:a.selectedTransaction})}},function(a){})}},function(a){}))}else{var h={};/* raisedOn OR PARTY_TYPE value */
h.raisedOn="INDIVIDUAL",/* partyNameId.id OR RAISED_ON object */
h.partyNameId={id:b.userId,value:b.userName},/* type OR SELECT_BILL_TYPE value */
h.type="DEBIT",/* locationId OR SELECT_ORG_LOCATION object */
h.inFavorOfOrgList={id:b.orgLocId,value:b.orgLocName},/* dateFromString OR DATE_FROM */
h.dateFromString=b.requestedOn,h.dateTillString=new Date,h.fromApptList=!0,h.transactionId=b.transactionId,e.go("searchbill",{data:h})}},/*Server side pagination module*/
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchUserTestOrder()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchUserTestOrder()},$("#data-table").on("click",".clickCls",function(b){b.preventDefault();var c=$(this).attr("criteria").valueOf(),d=$(this).attr("data").valueOf();l.isNullOrEmpty(c)||l.isNullOrEmpty(d)||a.goUserTestDocList(JSON.parse(d),JSON.parse(c))}),/*datatble config json*/
a.options=d.setOptionProperties(m.gridConfigurations),a.dtColumnDefs=d.setColumnProperties({}),u()}]),angular.module("paripal.userTestModule").controller("addEditUserTestCtrl",["$scope","$rootScope","$stateParams","$state","notify","$translate","utilService","baseService","httpService","urlService","addUserTestService","userTestListService","commonConstants","$mdDialog","userStatusService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";a.WSDiagnosticTestUser={},a.WSDiagnosticTestUserData={},a.labsReferred=null,a.testConductedAt={},a.organization={},a.commonConstants=m,a.uploadFileObject={},a.getUserData=function(b){a.userNameAutoCmp=!0;var c={},d=[];return c.searchString=b,i.getData(j.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},a.onUserSelect=function(b){a.WSDiagnosticTestUser.user=angular.copy(b)},a.getLabRefferedData=function(){var b={};
//requestObject.testId = viewValue;
g.isEmpty(a.WSDiagnosticTestUser)||g.isEmpty(a.WSDiagnosticTestUser.diagnosticTest)||(b.testId=a.WSDiagnosticTestUser.diagnosticTest.id),i.getData(j.getParameterizedUrl("FIND_BY_TEST_ID",b),null,function(b){a.labsReferredList=b.data},function(a){})},a.onLabRefferedSelect=function(b){a.labsReferred=angular.copy(b)},a.getAdvisedByData=function(b){a.advisedBySpinner=!0;var c=j.getUrl("GET_ADVISED_BY");return c+=b,i.getData(c,null,function(b){return a.advisedBySpinner=!1,a.countryData=angular.fromJson(b.data),a.countryData},function(b){a.advisedBySpinner=!1})},a.onAdvisedBySelect=function(b){a.WSDiagnosticTestUser.advisedById=null,"object"==typeof b?(a.WSDiagnosticTestUser.advisedByName=b.value,b.id&&(a.WSDiagnosticTestUser.advisedById=b.id)):a.WSDiagnosticTestUser.advisedByName=b},a.getTestPrescribed=function(b,c){var d={searchString:b},e=angular.fromJson(localStorage.getItem("defaultOrgLoc")),f="";return f=e?j.getParameterizedUrl("FIND_DIAGNOSTIC_TESTS_BY_LOCATION",d)+"&whetherActive="+c+"&orgLocId="+e.id:j.getParameterizedUrl("FIND_DIAGNOSTIC_TESTS_BY_LOCATION",d)+"&whetherActive="+c+"&orgLocId=",i.getData(f,null,function(b){return a.countryData=angular.fromJson(b.data),a.countryData.wsBooleanValue},function(a){})},a.onTestPrescribedSelect=function(b){a.WSDiagnosticTestUser.diagnosticTest=b,a.testPrescribedId=b.id,a.getDiseases(a.testPrescribedId),a.getLabRefferedData();var c=angular.fromJson(localStorage.getItem("defaultOrg")),d=angular.fromJson(localStorage.getItem("defaultOrgLoc"));1==a.countryData.whetherLocationSubscribed?(a.orgLocRequired=!0,a.organization={data:c},a.testConductedAt={data:d}):(a.testConductedAt={},a.organization={})},a.getDiseases=function(b){var c=j.getUrl("GET_DISEASES_BY_TEST");c+=b,i.getData(c,null,function(b){a.diseases=angular.fromJson(b.data)},function(a){})},a.getSymptom=function(b){var c=j.getUrl("GET_SYMPTOMS");return c+=b,i.getData(c,null,function(b){return a.countryData=angular.fromJson(b.data),a.countryData},function(a){})},a.onSymptomSelect=function(b){a.WSDiagnosticTestUser.symptom=b},a.fileUploadCall=function(b){if(b.$valid)if(a.manageUserTestSpiner=!0,!g.isEmpty(a.uploadFileObject)&&g.isFieldEmpty(a.uploadFileObject.id)){var c={};c.fileName=a.uploadFileObject.fileName,c.fileIdentifier=a.uploadFileObject.fileIdentifier,c.documentType=a.uploadFileObject.documentType,k.saveDocumentDetails(c,a.pageState,function(b){a.uploadFileObject&&a.uploadFile(a.uploadFileObject,b)},function(){a.manageUserTestSpiner=!1})}else a.saveUserTest()},a.uploadFile=function(b,c){var d=new Object;d.file=b.fileToBeUpload,d.docType=b.documentType.type,d.docSubType=b.documentType.subType,g.isNullOrEmpty(c.response)||(d.resourceId=c.response),g.isFieldEmpty(a.WSDiagnosticTestUser.user)||(d.userId=a.WSDiagnosticTestUser.user.id),k.uploadFile(d,function(b){var d=c.response;a.saveUserTest(d)},function(b){a.manageUserTestSpinner=!1,e("Error",f.instant("ERROR_WHILE_UPLOADING"))})},a.saveUserTest=function(b){k.saveUserTest(a.WSDiagnosticTestUser,a.labsReferred,a.testConductedAt,b,function(b){if(!g.isNullOrEmpty(a.fromClientsPage))if(1==a.fromClientsPage)var f=a.fromClientsPage;else var f=null;if(!g.isNullOrEmpty(a.countryData)&&!g.isNullOrEmpty(a.countryData.whetherLocationSubscribed)&&0==a.countryData.whetherLocationSubscribed)var h=!1;e("success",b.successMessage),c.previousState?g.goBackToPrevState():d.go("usertestlist",{type:"",user:a.WSDiagnosticTestUser.user,fromClientsPage:f,whetherLocationSubscribed:h})},function(b){a.manageUserTestSpinner=!1})},a.viewUserTestReportsOrMeasurements=function(b){k.viewUserTestMeasurementOrReport(a.WSDiagnosticTestUser,b)},a.setData=function(b){if(a.WSDiagnosticTestUserData=k.setTestUser(b),g.isEmpty(a.WSDiagnosticTestUser.testConductedAtOrg)){if(!g.isNullOrEmpty(c.data.fromUserTestListEdit)){var d=angular.fromJson(localStorage.getItem("defaultOrg"));a.organization={data:d}}}else a.organization={data:b.testConductedAtOrg};if(g.isEmpty(a.WSDiagnosticTestUser.testConductedAt)){if(!g.isNullOrEmpty(c.data.fromUserTestListEdit)){var e=angular.fromJson(localStorage.getItem("defaultOrgLoc"));a.testConductedAt={data:e}}}else a.testConductedAt=a.WSDiagnosticTestUser.testConductedAt;a.labsReferred={},g.isEmpty(b.labsReferred)||(a.labsReferred.data=b.labsReferred),a.labsReferred.value=b.labsReferredName,g.isEmpty(a.WSDiagnosticTestUser.testPrescribed)||a.getDiseases(a.WSDiagnosticTestUser.testPrescribed.id),g.isNullOrEmpty(a.WSDiagnosticTestUser.disease)||(a.diseaseFieldId=a.WSDiagnosticTestUser.disease.id),g.isEmpty(a.WSDiagnosticTestUser.prescriptionFileLoc)||(a.uploadFileObject=a.WSDiagnosticTestUser.prescriptionFileLoc),g.isNullOrEmpty(a.WSDiagnosticTestUser.transactionId)&&(a.WSDiagnosticTestUser.transactionId="")},a.fileUploader=function(b){n.show({controller:"PrescriptionFileUploaderCtrl",templateUrl:"app/modules/user-tests/views/prescription-file-uploader.html",parent:angular.element(document.body),targetEvent:b,locals:{docType:"TEST",docSubType:"PRESCRIPTION",isMultipleFileUpload:!1},clickOutsideToClose:m.dialogBox.clickOutsideToClose}).then(function(b){a.uploadFileObject=b})},a.cancel=function(){g.goBackToPrevState()},a.viewPrintFile=function(b,c){if(!g.isEmpty(c)){var d=new Object;d.fileName=c.fileName,d.resourceId=c.id,d.docType=c.documentType.type,d.docSubType=c.documentType.subType,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!0}},a.init=function(){if(g.isNullOrEmpty(c.user)||(a.WSDiagnosticTestUserData.userId=c.user,a.WSDiagnosticTestUser.user=c.user,a.WSDiagnosticTestUser.requestedOn=new Date,g.isNullOrEmpty(c.fromClientsPage)||(a.fromClientsPage=!0),a.labsReferred=b.defaultOrgLoc),a.currentDate=new Date,"edit"===c.type||"view"===c.type)a.pageState=c.type,a.fileClass="width-80";else{a.pageState="add",a.fileClass="fullWidth",a.disabled=!0,a.WSDiagnosticTestUser.status="PRESCRIBED";var d=o.userStatus();d.isOrgUser?(a.WSDiagnosticTestUserData.advisedBy=d.userData,a.onAdvisedBySelect(d.userData)):(a.WSDiagnosticTestUserData.userId=d.userData,a.isUserDisable=!d.isOrgUser,a.onUserSelect(d.userData))}c.data?(a.WSDiagnosticTestUser=angular.copy(c.data),g.isNullOrEmpty(a.WSDiagnosticTestUser.fromUserTestListEdit)||delete a.WSDiagnosticTestUser.fromUserTestListEdit,a.setData(a.WSDiagnosticTestUser)):c.userTestId&&l.getUserTestById(c.userTestId,function(b){a.explressionFollowupSpinner=!1,a.WSDiagnosticTestUser=b,a.setData(a.WSDiagnosticTestUser),"view"!==c.type&&"edit"!==c.type||(a.pageState=c.type)},function(b){a.error=b}),i.getData(j.getUrl("GET_ALL_TRANSACTION_IDS"),null,function(b){a.transactionIds=angular.fromJson(b.data)},function(a){}),a.statuses=["PRESCRIBED","APPOINTMENT_FIXED","TEST_CONDUCTED","REPORT_AVAILABLE","COMMENTED"]},a.changeStatus=function(){a.WSDiagnosticTestUser.status;g.isFieldEmpty(a.WSDiagnosticTestUser.testConductedOn)?g.isFieldEmpty(a.WSDiagnosticTestUser.fixedOn)?a.WSDiagnosticTestUser.status="PRESCRIBED":a.WSDiagnosticTestUser.status="APPOINTMENT_FIXED":a.WSDiagnosticTestUser.status="TEST_CONDUCTED"},a.init()}]),angular.module("paripal.userTestModule").controller("UserTestListCtrl",["$scope","$rootScope","$stateParams","datatableconfig","$state","notify","$translate","serverSidePagination","httpService","urlService","userTestListService","utilService","commonConstants","userStatusService","statePersistenceService","baseService","$timeout","$mdDialog","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";a.currentPage=1,1==a.listView?a.itemPerPage=10:a.itemPerPage=8,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.WSDiagnosticTestUser={},a.userTestList=[],a.filterCriteria={},a.filterCriteria.oranizationId={},a.filterCriteria.organizationLocationId={},a.clicked=!1,a.commonConstants=m,p.validateListing("DIAGNOSTIC_TEST_SUB"),a.whetherDoctor=!1,a.status={open:!0},/* CARD VIEW CHANGES START */
a.listView=!1,a.cardView=!0,a.btnText=g.instant("LIST_VIEW"),a.toggleView=function(){1==a.listView?(a.cardView=!0,a.listView=!1,a.btnText=g.instant("LIST_VIEW"),a.itemPerPage=12,a.searchUserTest()):(a.cardView=!1,a.listView=!0,a.btnText=g.instant("CARD_VIEW"),a.itemPerPage=10,a.searchUserTest())};/* CARD VIEW CHANGES END */
var t=function(){var d=p.getLoggedInUser();d.userAccountStatusDTO&&1==d.userAccountStatusDTO.whetherDoctor&&(a.whetherDoctor=!0),l.isNullOrEmpty(localStorage.getItem("whetherLocationIsLab"))||(a.whetherLocLab=angular.fromJson(localStorage.getItem("whetherLocationIsLab"))),b.loggedInUserDetails.isOrganizationUser&&b.loggedInUserDetails.isOrganizationUserMode?l.isNullOrEmpty(c.fromClientsPage)?(a.addPermission=s.LAB_CRM_DIAG_TEST_USER_ADD,a.editPermission=s.LAB_CRM_DIAG_TEST_USER_EDIT,a.viewPermission=s.LAB_CRM_DIAG_TEST_USER_VIEW):(a.addPermission=s.CLIENT_DIAG_TEST_USER_ADD,a.editPermission=s.CLIENT_DIAG_TEST_USER_EDIT,a.viewPermission=s.CLIENT_DIAG_TEST_USER_VIEW):(a.addPermission=s.LAB_CRM_DIAG_TEST_USER_ADD,a.editPermission=s.LAB_CRM_DIAG_TEST_USER_EDIT,a.viewPermission=s.LAB_CRM_DIAG_TEST_USER_VIEW),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1;var e=n.userStatus();n.isUserLoggedIn()&&(a.loggedInUserId=e.userData.id,e.isOrgUser||(a.filterCriteria.userId=e.userData),a.isUserDisable=!e.isOrgUser,a.onUserSelect(e.userData)),c&&c.userName&&(a.skypeObj={},a.skypeObj.id=c.userId,a.skypeObj.value=c.userName,a.onUserSelect(a.skypeObj),a.filterCriteria.userId={},a.filterCriteria.userId.value=c.userName,a.filterCriteria.userId.id=c.userId),l.isNullOrEmpty(c.user)||(a.filterCriteria.userId=c.user,a.WSDiagnosticTestUser.userId=c.user.id,l.isNullOrEmpty(c.whetherLocationSubscribed)&&(a.filterCriteria.oranizationId.data=angular.fromJson(localStorage.getItem("defaultOrg")),a.filterCriteria.organizationLocationId.data=angular.fromJson(localStorage.getItem("defaultOrgLoc")))),a.searchUserTest()};a.setClickedRow=function(b,c){c&&c.id&&(a.rowData=c,a.clicked=!0)},a.showBenchmarkChart=function(b){if(a.filterCriteria.userId)var c=a.filterCriteria.userId.id;e.go("benchmarkchartdatalist",{recordId:b.diagnosticTestId,fromPage:"userTest",clientId:c})},a.$on("test",function(){a.clicked=!1}),e.params.orgLocId&&(a.WSDiagnosticTestUser.organizationLocationId=e.params.orgLocId),a.searchUserTest=function(){l.isEmpty(a.filterCriteria.userId)||(b.showSpinner=!0,/*$scope.userTestListSpinner = true;*/
l.isNullOrEmpty(c)||l.isNullOrEmpty(c.orderId)||(a.WSDiagnosticTestUser.orderId=c.orderId),a.WSDiagnosticTestUser.pageNumber=a.currentPage,a.WSDiagnosticTestUser.recordsPerPage=a.itemPerPage,k.searchUserTests(a.WSDiagnosticTestUser,a.filterCriteria,function(c){b.showSpinner=!1,
//$scope.userTestList = sucessResponse.data;
angular.copy(c.data,a.userTestList),a.totalItems=c.totalRecords,a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems)},function(c){b.showSpinner=!1,a.error=c}))},a.clear=function(){e.reload()},/*
              From Skype Page -- this code is moved to init method

              if ($stateParams) {
                  $scope.filterCriteria.userId=$stateParams.userName;
                  $scope.searchUserTest();
              }*/
a.fetchRecords=function(){a.searchUserTest()},/**
             *Get User name on autocomplete
             */
a.getUserData=function(b){a.userNameAutoCmp=!0;var c={},d=[];return c.searchString=b,i.getData(j.getParameterizedUrl("GET_PATIENTS_USER_BY_SEACRH_KEY",c),null,function(b){return a.userNameAutoCmp=!1,d=angular.fromJson(b.data)},function(b){a.userNameAutoCmp=!1})},/* $scope.getUserData = function (value) {
                var url = urlService.getUrl('GET_ACTIVE_CLIENT');
                url = url + value;
                return httpService.getData(url, null, function (response) {
                    $scope.countryData = angular.fromJson(response.data);
                    return $scope.countryData;
                }, function (error) {});
            };*/
a.onUserSelect=function(b){a.WSDiagnosticTestUser.userId=b.id},a.getTestPrescribed=function(b){a.testNameAutoCmp=!0;var c={searchString:b};return i.getData(j.getParameterizedUrl("GET_DIAGNOSTIC_TEST_LIST",c),null,function(b){return a.testNameAutoCmp=!1,a.countryData=angular.fromJson(b.data),a.countryData},function(b){a.testNameAutoCmp=!1})},a.onTestPrescribedSelect=function(b){a.WSDiagnosticTestUser.diagnosticTestId=b.id},a.getIndicator=function(b){a.indicatorAutoCmp=!0;var c=j.getUrl("GET_INDICATOR");return c+=b,i.getData(c,null,function(b){return a.indicatorAutoCmp=!1,a.countryData=angular.fromJson(b.data),a.countryData},function(b){a.indicatorAutoCmp=!1})},a.onIndicatorSelect=function(b){a.WSDiagnosticTestUser.indicatorId=b.id},a.getMeasurementGroup=function(b){a.groupNameAutoCmp=!0;var c=j.getUrl("GET_MEASUREMENT_GROUP");return c+=b,i.getData(c,null,function(b){return a.groupNameAutoCmp=!1,a.countryData=angular.fromJson(b.data)},function(b){a.groupNameAutoCmp=!1})},a.onMeasurementGroupSelect=function(b){a.WSDiagnosticTestUser.measurementGroupId=b.id},a.addUserTests=function(){if(!l.isNullOrEmpty(a.filterCriteria.userId))var b=a.filterCriteria.userId;/*if (!utilService.isNullOrEmpty($scope.userTestList) && !utilService.isNullOrEmpty($scope.filterCriteria.userId)) {
                    if (typeof $scope.filterCriteria.userId != 'object') {
                        var user = {};
                        if (!utilService.isNullOrEmpty($scope.userTestList[0].userId) && !utilService.isNullOrEmpty($scope.userTestList[0].userName)) {
                            user = {
                                id: $scope.userTestList[0].userId,
                                value: $scope.userTestList[0].userName
                            }
                        }
                    }

                }*/
if(l.isNullOrEmpty(c.fromClientsPage))var d=null;else var d=!0;e.go("addUserTests",{type:"",previousState:e.current.name,user:b,fromClientsPage:d})},a.addTestOrder=function(a){var b={};l.isNullOrEmpty(c.user)?l.isNullOrEmpty(c.userId)||l.isNullOrEmpty(c.userName)?b=null:b.user={id:c.userId,value:c.userName}:b.user=c.user,"prescription"==a?e.go("testorder",{pageState:"prescription",data:b}):e.go("testorder",{pageState:"add",data:b})},a.goToBill=function(a){var b={};b.raisedOn="INDIVIDUAL",b.whetherRefundAllowed=!0,b.fromCheckIn=!0;var c={};l.isNullOrEmpty(a.transactionId)?f("error",g.instant("TRANSACTION_NOT_FOUND")):(c.transactionId=a.transactionId,i.postData(j.getUrl("GET_ADHOC_BILL_SETUP"),c,function(b){if(l.isFieldEmpty(b.data))r.cancel();else{r.cancel();/* SERVER params to be sent */
var c=angular.copy(b.data);/*UI params to be sent*/
c.fromCheckIn=!0,c.raisedOn="INDIVIDUAL",c.whetherRefundAllowed=!0,c.transaction={id:a.transactionId},l.isNullOrEmpty(a.orgLocId)||l.isNullOrEmpty(a.orgLocName)||(c.ownerLocationId={id:a.orgLocId,value:a.orgLocName}),l.isNullOrEmpty(a.userId)||l.isNullOrEmpty(a.userName)||(c.raisedOnDetails={raisedOnUserId:a.userId,raisedOnName:a.userName},c.raisedOnUserId={id:a.userId,value:a.userName}),e.go("createbill",{type:"DEBIT",data:c,feeHeadAmnt:"YES",pageState:"CREATE"})}},function(a){}))},a.goUserMeasurementList=function(b,c){e.go("usermeasurementlist",{type:"",data:{diagnosticTest:a.setDiagnosticTest(b),user:c}})},a.goAddUserMeasurement=function(b,c){e.go("addusermeasurement",{type:"",data:{diagnosticTest:a.setDiagnosticTest(b),user:{id:c.id,value:c.displayName}}})},a.goUserTestDocList=function(b,d){var f=null;l.isNullOrEmpty(c)||l.isNullOrEmpty(c.orderId)||(f=c.orderId),e.go("usertestdocumentlist",{type:"",data:{diagnosticTest:a.setDiagnosticTest(b),user:d,orderId:f}})},a.shareTest=function(b,c){e.go("shareusertest",{type:"linkCalled",data:{diagnosticTest:a.setDiagnosticTest(b),user:c}})},a.setDiagnosticTest=function(a){var b={};return b={id:a.id,value:a.diagnosticTestName,code:a.userTestCode}},a.userTestDetails=function(b){var c=a.rowData.id;k.viewUserTestDetails(c,b)},/*Server side pagination module*/
a.pageChanged=function(){a.pagingInfo=h(a.currentPage,a.itemPerPage,a.totalItems),a.searchUserTest()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.searchUserTest()},$("#data-table").on("click",".clickCls",function(b){b.preventDefault();var c=$(this).attr("criteria").valueOf(),d=$(this).attr("data").valueOf();l.isNullOrEmpty(c)||l.isNullOrEmpty(d)||a.goUserTestDocList(JSON.parse(d),JSON.parse(c))}),/*datatble config json*/
a.options=d.setOptionProperties(m.gridConfigurations),a.dtColumnDefs=d.setColumnProperties({}),t()}]),angular.module("paripal.userTestModule").service("addUserTestService",["httpService","urlService","dateconvertor","utilService","userIdDocumentService","fileOperations","manageAttachmentService","$state",function(a,b,c,d,e,f,g,h){"use strict";this.saveDocumentDetails=function(a,b,c,d){g.saveDocumentDetails(a,"add",function(a){c(a&&a.data?a.data:a)},function(a){d(a)})},this.uploadFile=function(a,b,c){f.uploadFile(a,function(a){b(a&&a.data?a.data:a)},function(a){c(a)})},this.saveUserTest=function(e,f,g,h,i,j){var k={};if(angular.copy(e,k),delete k.diagnosticTest.flag,d.isEmpty(f)||("string"==typeof f?k.labsReferredName=f:(f.id&&(k.labsReferred=f),k.labsReferredName=f.value)),d.isEmpty(g)||(k.testConductedAt=g.data),k.requestedOn&&(k.requestedOn=c.convertToServerDate(k.requestedOn)),k.fixedOn&&(k.fixedOn=c.convertToServerDate(k.fixedOn)),k.testConductedOn&&(k.testConductedOn=c.convertToServerDate(k.testConductedOn)),k.resultUploadedOn&&(k.resultUploadedOn=c.convertToServerDate(k.resultUploadedOn)),k.disease&&(k.disease=angular.fromJson(k.disease)),k.symptom&&(k.symptom={value:k.symptom.name,id:k.symptom.id}),h&&(k.prescriptionFileLoc={id:h}),k.id){var l={};l.id=k.id,delete k.advisedBy,delete k.testPrescribed,delete k.userId,a.putData(b.getParameterizedUrl("UPDATE_USER_TEST",l),k,function(a){a&&a.data?i(a.data):j(a)},function(a){j(a)})}else a.postData(b.getUrl("CREATE_DIAGNOSTIC_USER_TEST"),k,function(a){a&&a.data&&i(a.data)},function(a){j(a)})},this.saveOrbeonUserTest=function(e,f,g,h,i,j){var k={};if(angular.copy(e,k),delete k.diagnosticTest.flag,d.isEmpty(f)||("string"==typeof f?k.labsReferredName=f:(f.id&&(k.labsReferred=f),k.labsReferredName=f.value)),d.isEmpty(g)||(k.testConductedAt=g.data),k.requestedOn&&(k.requestedOn=c.convertToServerDate(k.requestedOn)),k.fixedOn&&(k.fixedOn=c.convertToServerDate(k.fixedOn)),k.testConductedOn&&(k.testConductedOn=c.convertToServerDate(k.testConductedOn)),k.resultUploadedOn&&(k.resultUploadedOn=c.convertToServerDate(k.resultUploadedOn)),k.disease&&(k.disease=angular.fromJson(k.disease)),k.symptom&&(k.symptom={value:k.symptom.name,id:k.symptom.id}),h&&(k.prescriptionFileLoc={id:h}),k.id){var l={};l.id=k.id,delete k.advisedBy,delete k.testPrescribed,delete k.userId,a.putData(b.getParameterizedUrl("UPDATE_USER_TEST",l),k,function(a){a&&a.data?i(a.data):j(a)},function(a){j(a)})}else a.postData(b.getUrl("CREATE_DIAGNOSTIC_USER_TEST_FOR_ORBEON"),k,function(a){a&&a.data&&i(a.data)},function(a){j(a)})},this.setTestUser=function(a){/*WSDiagnosticTestUser.labsReferred = {};
WSDiagnosticTestUser.labsReferred.data = {}
if (!utilService.isNullOrEmpty(WSDiagnosticTestUser.labsReferred)) {
    WSDiagnosticTestUser.labsReferred.data = WSDiagnosticTestUser.labsReferred;
}
WSDiagnosticTestUser.labsReferred.data.value = WSDiagnosticTestUser.labsReferredName;*/
return a.advisedById?a.advisedBy={id:a.advisedById,value:a.advisedByName}:a.advisedBy={value:a.advisedByName},d.isEmpty(a.diagnosticTest)||(a.testPrescribed=a.diagnosticTest),d.isEmpty(a.user)||(a.userId=a.user),d.isEmpty(a.testConductedAt)||(a.testConductedAt={data:a.testConductedAt}),d.isNullOrEmpty(a.testConductedAtName)||(a.testConductedAt={data:a.testConductedAt}),d.isNullOrEmpty(a.symptom)||(a.symptom={name:a.symptom.value,id:a.symptom.id}),a},this.viewUserTestMeasurementOrReport=function(a,b){if(!d.isEmpty(a)){var c={id:a.id,value:a.diagnosticTest.value},e={id:a.user.id,value:a.user.value},f={user:e,diagnosticTest:c};"measurements"===b?h.go("usermeasurementlist",{data:f,type:"linkCalled"}):"report"===b&&h.go("usertestdocumentlist",{data:f,type:"linkCalled"})}}}]),angular.module("paripal.userTestModule").service("userTestListService",["httpService","urlService","dateconvertor","utilService","$filter","$state",function(a,b,c,d,e,f){"use strict";this.searchUserTests=function(e,f,g,h){e.oranizationId=null,d.isEmpty(f.oranizationId)||d.isEmpty(f.oranizationId.data)||(e.oranizationId=f.oranizationId.data.id),e.organizationLocationId=null,d.isEmpty(f.organizationLocationId)||d.isEmpty(f.organizationLocationId.data)||(e.organizationLocationId=f.organizationLocationId.data.id),d.isEmpty(f)||(f.dateFrom&&(e.dateFrom=c.convertToServerDate(f.dateFrom)),f.dateTill&&(e.dateTill=c.convertToServerDate(f.dateTill)),d.isFieldEmpty(f.indicatorId)&&(e.indicatorId=null),d.isFieldEmpty(f.diagnosticTestId)&&(e.diagnosticTestId=null),d.isFieldEmpty(f.measurementGroupId)&&(e.measurementGroupId=null),d.isFieldEmpty(f.userId)&&(e.userId=null)),a.postData(b.getUrl("SEARCH_USER_TESTS"),e,function(a){g(a.data)},function(a){h(a)})},this.searchAllUserTests=function(c,d,e){a.postData(b.getUrl("SEARCH_USER_TESTS"),c,function(a){d(a.data)},function(a){e(a)})},this.searchUserTestOrders=function(c,e,f,g){d.isEmpty(e.oranizationId)||d.isEmpty(e.oranizationId.data)||(c.oranizationId=null,c.oranizationId=e.oranizationId.data.id),d.isEmpty(e.organizationLocationId)||d.isEmpty(e.organizationLocationId.data)||(c.organizationLocationId=null,c.organizationLocationId=e.organizationLocationId.data.id),a.postData(b.getUrl("SEARCH_USER_TEST_ORDERS"),c,function(a){f(a.data)},function(a){g(a)})},this.getUserTestById=function(c,d,f){var g={};g.userTestId=c,a.getData(b.getParameterizedUrl("FIND_DIAGNOSTICTESTUSERBYID",g),null,function(a){a&&a.data?(a.data.requestedOn&&(a.data.requestedOn=e("timestampToDate")(a.data.requestedOn,"MM/dd/yyyy")),a.data.fixedOn&&(a.data.fixedOn=e("timestampToDate")(a.data.fixedOn,"MM/dd/yyyy")),a.data.testConductedOn&&(a.data.testConductedOn=e("timestampToDate")(a.data.testConductedOn,"MM/dd/yyyy")),a.data.resultUploadedOn&&(a.data.resultUploadedOn=e("timestampToDate")(a.data.resultUploadedOn,"MM/dd/yyyy")),d(a.data)):f(a)},function(a){f(a)})},this.viewUserTestDetails=function(a,b){d.isFieldEmpty(b)&&(b="view"),this.getUserTestById(a,function(c){var d=c;d.fromUserTestListEdit=!0,f.go("addEditUserTests",{type:b,data:d,userTestId:a})},function(a){})},this.viewDiagnosticTestById=function(c,d,e){if(c){var f={userTestId:c};a.getData(b.getParameterizedUrl("FIND_DIAGNOSTICTESTUSERBYID",f),null,function(a){d(a.data)},function(a){e(a)})}}}]),angular.module("paripal.treatmentQueriesModule").controller("manageUserTreatmentQueriesCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","manageUserTreatmentQueriesService","utilService","dateconvertor","httpService","urlService","featurePrivilegeConstants","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(){/*if($scope.queries.linkedToQuerySequence){        		   
        		   $scope.queries.linkedToQuerySequence.id=$scope.queries.linkedToQuerySequence.value;
        	   }*/
a.queries.queryUserId&&a.queries.queryUserId.id&&(a.queries.queryUserId.value=a.queries.queryUserId.displayName,a.queries.queryUserId.id=a.queries.queryUserId.id,delete a.queries.queryUserId.displayName),
//	    			  if($scope.queries.treatmentRecordId  && $scope.queries.treatmentRecordId.id){
//	    				  $scope.queries.treatmentRecordId.id = $scope.queries.treatmentRecordId.id;
//	    				 $scope.queries.treatmentRecordId.value = $scope.queries.treatmentRecordId.value;
//	    			  }
//if($scope.queries.diseaseVariant && $scope.queries.diseaseVariant.id)
a.queries.replyBy&&a.queries.replyBy.id&&(delete a.queries.replyBy.version,delete a.queries.replyBy.professionalId,delete a.queries.replyBy.displayName),
//$scope.queries.dateStart = dateconvertor.convertToServerDate($scope.queries.dateStart);
//$scope.queries.dateEnd = dateconvertor.convertToServerDate($scope.queries.dateEnd);
//$scope.queries.currentDate = dateconvertor.convertToServerDate($scope.queries.currentDate);
j.saveTreatmentQueries(a.queries,function(b){b&&(d.go("viewUserTreatmentQueries"),a.queries&&a.queries.id?f("success",h.instant("RECORD_UPDATED_SUCCESS")):f("success",h.instant("RECORD_SAVED_SUCCESS")))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}
//check access for managing data	
function r(b){var c=!1;return a.accessibleSubscriberLocation&&!k.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}function s(b){a.queryObj={},a.queryObj.recordId=b;var c=n.getParameterizedUrl("GET_RECORD_ID",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data){a.treatmentRecd=b.data;
//$scope.treatmentRecd.dateStart = $filter('timestampToDate')( $scope.treatmentRecd.dateStart, dateFormat);
//$scope.treatmentRecd.dateEnd = $filter('timestampToDate')( $scope.treatmentRecd.dateEnd, dateFormat);
a.queries.dateStart=a.treatmentRecd.dateStart,a.queries.dateEnd=a.treatmentRecd.dateEnd,a.queries.treatmentType=a.treatmentRecd.treatmentType}},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function t(b,c,d){var e={};e.userId=b,e.diseaseId=c,e.locationId=d;var g=n.getParameterizedUrl("GET_REC_ID_FOR_QUERY",e);if(g)return m.getData(g,null,function(b){if(b&&b.data)return a.treatmentRecordId=b.data,0==a.treatmentRecordId.length&&f("alert",h.instant("FOR_THIS_USER_DISEASE_LOCATION_NO_RECORD")),a.treatmentRecordId},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}function u(b){var c={};c.userId=b;var d=n.getParameterizedUrl("FIND_QUERY_SEQUENCE_BY_USER",c);if(d)return m.getData(d,null,function(b){if(b&&b.data)return a.linkedToQuerySequence=b.data,a.linkedToQuerySequence},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})}
//				var userObj = {};
//				userObj.keyword = value;
//				userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
//				return httpService.getData(urlService.getParameterizedUrl('GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD', userObj), null, function (response) {
//					if (response && response.data) {
//						$scope.createdBy = response.data;
//						return $scope.createdBy;
//					}
//				}, function (error) {
//					if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//						notify("error", $translate.instant(error.data.messages[0]));
//					}
//				});
function v(b){return a.name={},a.name.name=b,a.sideEffectLoad=!0,m.getData(n.getParameterizedUrl("TREATMENT_TYPE",a.name),null,function(b){return a.sideEffectLoad=!1,a.treatmentType=angular.fromJson(b.data)},function(b){a.sideEffectLoad=!1,f("error",h.instant(b.data.messages[0]))})}function w(b,c){var d={};
//return httpService.getData(urlService.getParameterizedUrl('GET_ADVISED_BY_SEACRH_KEY', userData),
return d.searchKeyword=b,d.orgLocationId=c,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("FIND_HEALTHPROFESSION_BY_ORGLOCATION",d),null,function(b){return a.userNameAutoCmpLoading=!1,a.mainProfessionalAssociated=b.data,a.mainProfessionalAssociated},function(b){a.userNameAutoCmpLoading=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])||f("Alert",h.instant(b.data.messages[0]))})}function x(b){a.diseaseId=b}function y(b){return a.searchKeyWord={},a.searchKeyWord.searchKeyWord=b,a.queries&&a.queries.disease?(a.searchKeyWord.diseaseId=a.queries.disease.id,a.diseaseVariantLoad=!0,m.getData(n.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",a.searchKeyWord),null,function(b){return a.diseaseVariantLoad=!1,a.diseaseVariantLoad=angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,k.isEmpty(b.data)||k.isEmpty(b.data.messages[0])?f("error",h.instant("RECORD_SEARCH_FAILURE")):f("Alert",h.instant(b.data.messages[0]))})):void f("error",h.instant("Select Disease"))}a.saveTreatmentQueries=q,a.getTreatmenttype=v,a.getDiseaseVariant=y,a.getDiseaseId=x,a.orgLocPermission=o.USER_TREATMENT_QUERY_ADD,a.diseaseId={},a.getIssue={},a.queries={},a.queries.queryUserId={},a.minOrderDate=new Date,a.maxDate=new Date,a.minDateValidTill=new Date,a.getRecId=t,a.getDetails=s,a.getMainProfessionalAssociated=w,a.disabled=!1,a.field=!1,a.hideField=!0,a.getQueryId=u,a.checkOrganizationLocationAccess=r,a.cancel=function(){k.goBackToPrevState()},a.init=function(){a.manageOrgLocSpinner=!0,"edit"===c.type?(a.queries=c.data,a.orgLocPermission=o.USER_TREATMENT_QUERY_ADD,a.queries.queryUserId=c.data.queryUserId.value,
//var Obj = {};	
//Obj.userId=$scope.queries.queryUserId.id;
//$scope.getRecId($scope.queries.queryUserId.id);					
a.disabled=!0,a.editmode=!0):"view"===c.type?(a.queries=c.data,a.queries.queryUserId=c.data.queryUserId.value,
//$scope.queries.treatmentRecordId=$stateParams.data.treatmentRecordId.value;
a.pageState="view",a.viewmode=!0,a.disabled=!0):"add"===c.type&&(a.field=!0,a.orgLocPermission=o.USER_TREATMENT_QUERY_ADD,b.loggedInUserDetails.isOrganizationUserMode?a.queries.queryUserId="":(a.queries.queryUserId={},a.queries.queryUserId.value=b.loggedInUserDetails.displayName,a.queries.queryUserId.id=b.loggedInUserDetails.id)),c.data&&(a.sideeffect=c.data,a.manageOrgLocSpinner=!1),c&&c.id&&("view"===c.type||"edit"===c.type)&&j.getTreatmentQueriesById(c.id,function(c){a.queries=c,
//$scope.hideField=false;
a.queries.queryUserId.id==b.loggedInUserDetails.id||b.loggedInUserDetails.isOrganizationUserMode||(a.hideField=!1),/*if(!$scope.checkOrganizationLocationAccess($scope.queries.creatingOrganizationId.id) &&
								$scope.queries.allowAccessHidingNames==true){
							          $scope.hideField=false;
						}*/
a.disabled=!0,a.getQueryId(a.queries.queryUserId.id),a.getRecId(a.queries.queryUserId.id,a.queries.disease.id,a.queries.creatingOrganizationId.id)},function(b){a.manageOrgLocSpinner=!1,a.error=b,k.isEmpty(b.data)||k.isEmpty(error.data.messages[0])||f("error",h.instant(error.data.messages[0]))})},a.init(),a.setData=function(b){a.linkedToQuerySequenceId=b.linkedToQuerySequence.id,a.getQueryId(b.queryUserId.id)},
//get subscribed accessible location  
a.getAccessibleSubscriberLocation=function(b){return m.getData(n.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.getCreatedBy=function(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,m.getData(n.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.creatingOrganizationId=b.data,a.creatingOrganizationId},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getUserNamesForRoleHistory=function(b){return a.userData={},a.userData.searchString=b,a.userNameAutoCmpLoading=!0,m.getData(n.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=n.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.getIssue=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=n.getParameterizedUrl("ISSUE_SERACHKEYWORD",a.queryObj);if(c)return m.getData(c,null,function(b){if(b&&b.data)return a.issueList=b.data,a.issueList},function(a){k.isEmpty(a.data)||k.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.setData=function(b){a.linkedToQuerySequenceId=b.linkedToQuerySequence.id,a.queryStatus=b.queryStatus.value}}]),angular.module("paripal.treatmentQueriesModule").controller("viewUserTreatmentQueriesCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","datatableconfig","$translate","serverSidePagination","viewUserTreatmentQueriesService","httpService","urlService","commonConstants","utilService","featurePrivilegeConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";
//check access for managing data	
function p(b){var c=!1;return a.accessibleSubscriberLocation&&!n.isEmpty(a.accessibleSubscriberLocation)&&a.accessibleSubscriberLocation.forEach(function(a){if(a&&b&&a.id==b.id)return c=!0}),c}function q(a,b){j.getTreatmentQueryById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageUserTreatmentQueries",{id:a,type:e,data:f})},function(a){f("error",h.instant(a.data.messages[0]))})}function r(b){a.diseaseId=b}function s(b){var c={};return c.searchKeyWord=b,c.diseaseId=a.diseaseId,a.diseaseVariantLoad=!0,k.getData(l.getParameterizedUrl("GET_VARIANT_LIST_BY_ID",c),null,function(b){return a.diseaseVariantLoad=!1,angular.fromJson(b.data)},function(b){a.diseaseVariantLoad=!1,n.isEmpty(b.data)||n.isEmpty(b.data.messages[0])||f("error",h.instant(b.data.messages[0]))})}a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.disable=!0,a.treatMentQuery={},a.treatMentQueryList={},a.queries={},a.crudTreatmentQuery=q,a.getDiseaseId=r,a.getDiseaseVariant=s,a.diseaseId={},a.checkOrganizationLocationAccess=p,a.orgLocPermission=o.USER_TREATMENT_QUERY_ADD,a.hasAccessibleSubscriberLocation=!1,a.loginDetails=b.loggedInUserDetails,
//for individual sub
(a.loginDetails.whetherSubscriber=!0)&&(a.indsub=!0),a.addNew=function(){d.go("manageUserTreatmentQueries")},
//get subscribed accessible location   
a.getAccessibleSubscriberLocation=function(b){return k.getData(l.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.getTreatMentQueryList=function(){var b=(a.queries,{});/*if(!$rootScope.loggedInUserDetails.isOrganizationUserMode){
 					treatMentQuery.queryUserId = $rootScope.loggedInUserDetails.id;
 					$scope.queries.queryUserId=$rootScope.loggedInUserDetails.displayName;
         		}*/
return a.queries&&a.queries.queryUserId&&!a.queries.queryUserId.id?void f("error",h.instant("INVALID_USER")):a.queries&&a.queries.diseaseId&&!a.queries.diseaseId.id?void f("error",h.instant("INVALID_DISEASE")):a.queries&&a.queries.diseaseVariantId&&!a.queries.diseaseVariantId.id?void f("error",h.instant("INVALID_DISEASE_VARIANT")):(a.queries.diseaseId&&a.queries.diseaseId&&(b.diseaseId=a.queries.diseaseId.id,b.diseaseId=parseInt(b.diseaseId)),a.queries.queryUserId&&a.queries.queryUserId&&(b.queryUserId=a.queries.queryUserId.id),a.queries.contains&&(b.contains=a.queries.contains),c.treatmentRecId&&(b.treatmentRecordId=c.treatmentRecId),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,void j.getTreatMentQueryList(b,function(b){b&&(
// $scope.treatMentQueryList.disease = sucessResponse.data.disease.value;
a.treatMentQueryList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))}))},b.loggedInUserDetails.isOrganizationUserMode||a.getTreatMentQueryList(),c.treatmentRecId&&a.getTreatMentQueryList(),a.queries.queryUserId&&a.queries.queryUserId.id&&a.getTreatMentQueryList(),a.getUserNamesForRoleHistory=function(b){return a.userData={},a.userData.searchString=b,a.userNameAutoCmpLoading=!0,k.getData(l.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1})},a.getDisease=function(b){a.queryObj={},a.queryObj.searchKeyWord=b;var c=l.getParameterizedUrl("GET_DISEASE_BY_KEYWORD",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.diseaseList=b.data,a.diseaseList},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",h.instant(a.data.messages[0]))})},a.clear=function(){a.queries={},a.disable=!1,a.treatMentQueryList=[]};
//data table config
var t=m.gridConfigurations;a.options=g.setOptionProperties(t),a.dtColumnDefs=g.setColumnProperties({}),a.pageChanged=function(){a.pagingInfo=i(a.currentPage,a.itemPerPage,a.totalItems),a.getTreatMentQueryList()},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.getTreatMentQueryList()},a.inActivate=function(b,c){j.inActivate(b,function(b){b&&(a.treatMentQueryList.splice(c,1),d.go("viewUserTreatmentQueries"),f("success",h.instant("RECORD_DELETED_SUCCESSFULLY")),a.fetchRecords())},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",h.instant("RECORD_DELETED_FAILURE")):f("Alert",h.instant(a.data.messages[0]))})}}]),angular.module("paripal.treatmentQueriesModule").service("manageUserTreatmentQueriesService",["httpService","urlService","$timeout","dateconvertor","utilService","$filter",function(a,b,c,d,e,f){"use strict";this.saveTreatmentQueries=function(c,d,e){/*if(queries.dateStart && queries.dateStart!=""){
        		queries.dateStart = dateconvertor.convertToServerDate(queries.dateStart);
        	} if(queries.dateEnd && queries.dateEnd!=""){
        		queries.dateEnd = dateconvertor.convertToServerDate(queries.dateEnd);
        	} if(queries.currentDate && queries.currentDate!=""){
        		queries.currentDate = dateconvertor.convertToServerDate(queries.currentDate);
        	}*/
var f="";f=null!=c.id?"UPDATE_TREATMENT_QUERIES":"SAVE_TREATMENT_QUERIES",a.postData(b.getUrl(f),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getTreatmentQueriesById=function(c,d,e){var g={};g.id=c,a.getData(b.getParameterizedUrl("TREATMENT_QUERIES_GET_BY_ID",g),null,function(a){var b="MM/dd/yyyy";a&&a.data?(a.data.dateStart&&""!=a.data.dateStart&&(a.data.dateStart=f("timestampToDate")(a.data.dateStart,b)),a.data.dateEnd&&""!=a.data.dateEnd&&(a.data.dateEnd=f("timestampToDate")(a.data.dateEnd,b)),a.data.currentDate&&""!=a.data.currentDate&&(a.data.currentDate=f("timestampToDate")(a.data.currentDate,b)),d(a.data)):e(a)},function(a){e(a)})},this.getQueryRecordId=function(c,d){a.getData(b.getUrl("GET_QUERY_SEQUENCE_AUTO_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})},this.getTreatmentQueryById=function(c,d,e){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("TREATMENT_QUERIES_GET_BY_ID",g),null,function(a){a&&a.data?(a.data.dateStart=f("timestampToDate")(a.data.dateStart,h),a.data.dateEnd=f("timestampToDate")(a.data.dateEnd,h),a.data.currentDate=f("timestampToDate")(a.data.currentDate,h),d(a.data)):e(a)},function(a){e(a)})}}]),angular.module("paripal.treatmentQueriesModule").service("viewUserTreatmentQueriesService",["httpService","$filter","urlService","dateconvertor","utilService",function(a,b,c,d,e){"use strict";this.getTreatMentQueryList=function(b,d,e){a.postData(c.getUrl("SEARCH_TREATMENT_QUERIES_FINDBY_CRITERIA"),b,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getTreatmentQueryById=function(d,e,f){var g={};g.id=d;var h="MM/dd/yyyy";a.getData(c.getParameterizedUrl("TREATMENT_QUERIES_GET_BY_ID",g),null,function(a){a&&a.data?(a.data.dateStart=b("timestampToDate")(a.data.dateStart,h),a.data.dateEnd=b("timestampToDate")(a.data.dateEnd,h),a.data.currentDate=b("timestampToDate")(a.data.currentDate,h),e(a.data)):f(a)},function(a){f(a)})},this.inActivate=function(b,d,e){var f={};f.id=b,a.deleteData(c.getParameterizedUrl("DELETE_USER_TREATMENT_QUERY",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userVaccinationsModule").controller("manageUserVaccinationCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","$q","$timeout","httpService","urlService","utilService","manageUserVaccinationServices","viewUserVaccinationServices","fileOperations","featurePrivilegeConstants","manageAttachmentService","commonConstants","baseService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){var b={};
//return httpService.getData(urlService.getParameterizedUrl('FIND_SUBSCRIBED_LOCATION_BY_KEYWORD', userObj), null, function (response) {
return b.organizationId=parseInt(a.loginDetails.organizationId),b.userId=a.loginDetails.id,j.getData(k.getParameterizedUrl("FIND_ORGLOC_BY_ORGID",b),null,function(b){if(b&&b.data)return a.userVaccination.orgLocationCode=b.data[0],a.userVaccination.orgLocationCode},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})}function u(b){var c={};return c.searchKeyword=b,j.getData(k.getParameterizedUrl("GET_ORG_LOC_BY_ALL",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})}function v(){var a={},b=angular.fromJson(localStorage.getItem("stateParamsData"));return a.accessKeyId=b.patientRecord.accessKeyId,a.currentOTP=b.patientRecord.otp,j.getData(k.getQueryParameterizedUrl("SHOW_SHARED_DOCUMENT",a),null,function(a){a&&1==a.data&&w()},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error","OTP Has Expired Or Invalid Access")})}function w(){a.pageState="view",a.viewmode=!0,a.IsVisible=!0,n.getUserVaccinationById(c.id,function(b){a.manageOrgLocSpinner=!1,a.userVaccination=b},function(a){})}function x(){var a="Pune, Chennai, Mumbai, Delhi";return a.split(/, +/g).map(function(a){return a})}function y(b){if(a.loginDetails.userAccountStatusDTO.whetherSubscriber=!a.loginDetails.isOrganizationUserMode)return a.userData={},a.userData.userName=b,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("FIND_USER_NAME",a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.valid=!1,a.users=angular.fromJson(b.data)},function(b){a.userNameAutoCmpLoading=!1});var c={};return c.searchString=b,a.userNameAutoCmpLoading=!0,j.getData(k.getParameterizedUrl("GET_PATIENTS_LIST_BY_SEACRH_KEY",c),null,function(b){
// $scope.users.forEach(function(element) {
// 	element.value=element.displayName;
// 	delete element.displayName;
// });
return a.userNameAutoCmpLoading=!1,a.users=b.data,a.users},function(b){a.userNameAutoCmpLoading=!1,l.isEmpty(b.data)||l.isEmpty(b.data.messages[0])||f("error",g.instant(b.data.messages[0]))})}a.step1=!0,a.minDate=new Date,a.location=[],a.creatingOrgn={},a.reqName={},a.userVaccination={},a.vaccinationFileDetail={},a.vaccinationFileDetail.fileToBeUpload=null,a.documentUpload={},a.documentUpload.document={},a.vaccine={},a.route={},a.IsVisible=!1,a.bodySite={},a.loginDetails=b.loggedInUserDetails,a.creatingOrgn={},a.documentUploadFile=null,a.getUserNamesForRoleHistory=y,
//$scope.getVaccines = getVaccines;
a.orgLocPermission=p.USER_VACINATION_ADD,a.getSystemOrg=t,a.localCheck=angular.fromJson(localStorage.getItem("stateParamsData")),a.authenticateOTP=v,a.allowAccessOTP=w,a.getCreatingOrgTreatLoc=u,
//for mandatory show hide based on planned on and date taken
a.notRequired=!1,a.mandatoryrequired=!1,a.removeMandatory=function(b){
// if(data.vaccinePlannedOn && !data.vaccinationDate){
// 	$scope.notRequired = false;
// }
b.vaccinePlannedOn&&!b.vaccinationDate?
//$scope.mandatoryrequired = true;
a.notRequired=!1:b.vaccinePlannedOn&&b.vaccinationDate?a.notRequired=!0:a.notRequired=!1},a.cancel=function(){l.goBackToPrevState()},
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.whethersub=!0,a.userVaccination.user={},a.userVaccination.user.value=a.loginDetails.displayName,a.userVaccination.user.id=a.loginDetails.id,t()),a.getVaccinationBodySite=function(){var b=k.getUrl("GET_VACCINE_BODY_SITE");b&&j.getData(b,null,function(b){b&&b.data&&(a.bodySiteList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getVaccinationBodySite(),
// $scope.getVaccinationBodySite = function (value) {
//     $scope.queryObj = {};
//     $scope.queryObj.keyword = value;
//     var url = urlService.getParameterizedUrl('GET_BODY_SITE_LIST_BY_KEYWORD', $scope.queryObj);
//     if (url) {
//         return httpService.getData(url, null, function (response) {
//             if (response && response.data && response.data) {
//                 $scope.bodySiteList = response.data;
//                 return $scope.bodySiteList;
//             }
//         }, function (error) {
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                 notify("error", $translate.instant(error.data.messages[0]));
//             }
//         });
//     }
// };
// $scope.getVaccinationRoute = function (value) {
//     $scope.queryObj = {};
//     $scope.queryObj.keyword = value;
//     var url = urlService.getParameterizedUrl('GET_ROUTE_LIST_BY_KEYWORD', $scope.queryObj);
//     if (url) {
//         return httpService.getData(url, null, function (response) {
//             if (response && response.data) {
//                 $scope.medicationList = response.data;
//                 return $scope.medicationList;
//             }
//         }, function (error) {
//             if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//                 notify("error", $translate.instant(error.data.messages[0]));
//             }
//         });
//     }
// };
a.getVaccinationRoute=function(){var b=k.getUrl("GET_VACCINE_ROUTE_LIST");b&&j.getData(b,null,function(b){b&&b.data&&(a.vaccineRouteList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getVaccinationRoute(),a.getVaccine=function(b){a.queryObj={},a.queryObj.keyword=b;var c=k.getParameterizedUrl("GET_VACCINATION",a.queryObj);if(c)return j.getData(c,null,function(b){if(b&&b.data)return a.vaccineList=b.data,a.vaccineList},function(a){})},a.getCreatedBy=function(b){var c={};
// userObj.orgId = $rootScope.loggedInUserDetails.organizationId;
return c.keyword=b,j.getData(k.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",c),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.init=function(){if(a.manageOrgLocSpinner=!0,a.recordId=!0,"add"===c.type){a.orgLocPermission=p.USER_VACINATION_ADD;var d=s.getDefaultOrgLocation();l.isFieldEmpty(d)||(a.userVaccination.orgLocationCode=d.orgLoc)}"view"===c.type&&b.loggedInUserDetails&&(a.pageState="view",a.viewmode=!0,a.IsVisible=!0),"edit"===c.type&&b.loggedInUserDetails&&(a.orgLocPermission=p.USER_VACINATION_EDIT,a.IsVisible=!0),c.data?(a.user={},a.userVaccination=c.data,c.data&&c.data.doneAtLocation&&(a.userVaccination.doneAt=c.data.doneAtLocation),a.manageOrgLocSpinner=!1,a.orgLoc=a.userVaccination.location):c.id&&b.loggedInUserDetails&&n.getUserVaccinationById(c.id,function(b){a.manageOrgLocSpinner=!1,a.userVaccination=b,b&&b.doneAtLocation&&(a.userVaccination.doneAt=b.doneAtLocation)}),"view"!==c.type||b.loggedInUserDetails||null==a.localCheck.patientRecord.otp||v()},a.init(),a.saveUserVaccination=function(){return a.attachmentFormSpinner=!0,!a.userVaccination||a.userVaccination.vaccinePlannedOn||a.userVaccination.vaccinationDate?a.userVaccination&&a.userVaccination.vaccinationDate&&!a.userVaccination.vaccineValidity?(f("error",g.instant("VACCINATION_DATE_VALIDATION_ERROR_2")),void(a.attachmentFormSpinner=!1)):a.userVaccination&&a.userVaccination.vaccinationDate&&a.userVaccination.vaccinationDate>a.userVaccination.vaccineValidity?(f("error",g.instant("VACCINATION_DATE_VALIDATION_ERROR_3")),void(a.attachmentFormSpinner=!1)):a.userVaccination&&a.userVaccination.vaccine&&!a.userVaccination.vaccine.id?(f("error",g.instant("ENTER_VALID_VACCINE")),void(a.attachmentFormSpinner=!1)):a.userVaccination&&a.userVaccination.vaccinationRoute&&!a.userVaccination.vaccinationRoute.id?(f("error",g.instant("ENTER_VALID_ROUTE")),void(a.attachmentFormSpinner=!1)):a.userVaccination&&a.userVaccination.vaccinationBodySite&&!a.userVaccination.vaccinationBodySite.id?(f("error",g.instant("ENTER_VALID_BODY_SITE")),void(a.attachmentFormSpinner=!1)):(!l.isEmpty(a.userVaccination)&&a.vaccinationFileDetail&&a.vaccinationFileDetail.fileToBeUpload&&(a.userVaccination.fileName=a.vaccinationFileDetail.fileToBeUpload.name),a.userVaccination&&a.userVaccination.doneAt&&a.userVaccination.doneAt.id&&(a.userVaccination.doneAtLocation=a.userVaccination.doneAt,delete a.userVaccination.doneAt),void(a.vaccinationFileDetail.fileToBeUpload?(a.documentUpload.document.fileName=a.vaccinationFileDetail.fileToBeUpload.name,a.documentUpload.document.fileSize=a.vaccinationFileDetail.fileToBeUpload.size,a.documentUpload.document.organizationLocationId=a.userVaccination.orgLocationCode.id,a.documentUpload.document.documentType={subType:r.documentSubTypes.userVaccination},"add"!=c.type&&(a.documentUpload.document.id=a.userVaccination.documentId),q.saveDocumentDetails(a.documentUpload.document,c.type,function(b){a.attachmentFormSpinner=!1,a.vaccinationFileDetail.fileToBeUpload&&(
//$scope.uploadFile($scope.documentUploadFile, response);
a.vaccinationFileDetail&&a.vaccinationFileDetail.fileToBeUpload&&a.vaccinationFileDetail.fileToBeUpload.name&&a.uploadFile(a.userVaccination,a.vaccinationFileDetail,b),a.userVaccination&&a.userVaccination.id?f("success",g.instant("RECORD_UPDATED_SUCCESS")):f("success",g.instant("RECORD_SAVED_SUCCESS")))},function(b){a.attachmentFormSpinner=!1})):m.saveUserVaccination(a.userVaccination,function(a){a&&(f("success",a.successMessage),d.go("uservaccinations"))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))}))):(f("error",g.instant("VACCINATION_DATE_VALIDATION_ERROR_1")),void(a.attachmentFormSpinner=!1))},a.uploadFile=function(b,c,e){var h=new Object;h.file=c.fileToBeUpload,h.orgLocId=a.userVaccination.orgLocationCode.id,h.docType=r.documentTypes.vaccination,h.docSubType=r.documentSubTypes.userVaccination,h.isThumbnailRequired=!1,l.isNullOrEmpty(e.response)||(
//paramObject.recordId = successParentResponse.response;
h.resourceId=e.response),o.uploadFile(h,function(b){l.isNullOrEmpty(b)||(a.userVaccination.documentId=e.response,m.saveUserVaccination(a.userVaccination,function(a){a&&(f("success",a.successMessage),d.go("uservaccinations"))},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))}))},function(a){l.isNullOrEmpty(a.response)||n.deleteUserVaccinationById(a.response,function(a){f("Error",g.instant("ERROR_WHILE_UPLOADING"))},function(a){f("Error",g.instant("ERROR_WHILE_UPLOADING"))})})},a.viewPrintFile=function(b,c){if(!l.isEmpty(c)){var d=new Object;d.fileName=c.fileName,d.orgLocId=c.orgLocationCode.id,d.resourceId=c.documentId,d.docType=r.documentTypes.vaccination,d.docSubType=r.documentSubTypes.userVaccination,a.fileResource=d,a.viewFileContent=!0,a.isHidingPrintButton=!c.whetherDownloadable}},a.generateBill=function(b,c){m.generateBill(b,c,function(b){b&&(a.userVaccination.billId=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.locationLoadAll=x;var z=x();a.querySearchByLocation=function(b){var c=b?z.filter(a.createFilterFor(b)):z,d=h.defer();return i(function(){d.resolve(c)},1e3*Math.random(),!1),d.promise},/**
             * Create filter function for a query string
             */
a.createFilterFor=function(a){var b=angular.lowercase(a);return function(a){return 0===a.indexOf(b)}},
// function getVaccines(viewValue) {
//     $scope.keyword = {};
//     $scope.keyword.keyword = viewValue;
//     $scope.vaccineAutoCmpLoading = true;
//     return httpService.getData(urlService.getParameterizedUrl('GET_VACCINATION', $scope.keyword), null, function (response) {
//         $scope.vaccineAutoCmpLoading = false;
//         return $scope.vaccine = angular.fromJson(response.data);
//     }, function (error) {
//         $scope.vaccineAutoCmpLoading = false;
//         if (!utilService.isEmpty(error.data) && !utilService.isEmpty(error.data.messages[0])) {
//             notify("error", $translate.instant(error.data.messages[0]));
//         }
//     });
// }
a.getVaccines=function(){var b=k.getUrl("GET_VACCINE_LIST");b&&j.getData(b,null,function(b){b&&b.data&&(a.vaccineList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},a.getVaccines(),a.getRecommendedBy=function(){var b=k.getUrl("GET_RECOMMEND_BY_LIST_BY_KEYWORD");b&&j.getData(b,null,function(b){b&&b.data&&(a.recommendByList=b.data)},function(a){l.isEmpty(a.data)||l.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))})},
// initialy set done at as created by
a.updateDoneAt=function(b){a.userVaccination&&!a.userVaccination.doneAt&&b&&(a.userVaccination.doneAt=b.value)},a.getRecommendedBy()}]),angular.module("paripal.userVaccinationsModule").controller("vaccinationStatisticsCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","fileReader","notify","$translate","vaccinationStatisticsServices","urlService","httpService","dateconvertor","utilService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b,c){var d={};return a.chartType=b.chartType,b.chartType?(b.dateFrom&&(d.dateFrom=l.convertToServerDate(b.dateFrom)),b.till&&(d.till=l.convertToServerDate(b.till)),b.vaccine&&(d.vaccine=b.vaccine.id),b.location&&(d.location=b.location.id),b.recommendBy&&(d.recommendedById=b.recommendBy.id),c&&c.city&&(d.cityId=c.city.id),c&&c.state&&(d.stateId=c.state.id),c&&c.district&&(d.districtId=c.district.id),d.brand=b.brand,d.callingFrom="Statistics",void i.getvaccinationStatistics(d,function(b){b&&(0==b.data.length?a.norecordfound=!0:"Bar-Chart"==a.chartType.value?(a.norecordfound=!1,a.getBarChart(b,a.chartType)):(a.norecordfound=!1,a.getPieChart(b,a.chartType)),a.chart=!0)})):void g("error","Please choose chart type")}function o(b,c){a.data=[],a.labels=[];angular.copy(b.data);"Chart-1"==c.key&&"Bar-Chart"==c.value&&(a.chartData=s(b.data),a.barChartCreateFunction()),"Chart-2"==c.key&&"Bar-Chart"==c.value&&(a.chartData=t(b.data),a.barChartCreateFunction())}function p(b,c){"Chart-3"==c.key&&"Pie-Chart"==c.value&&(a.chartData=q(b.data),a.pieChartCreateFunction()),"Chart-4"==c.key&&"Pie-Chart"==c.value&&(a.chartData=r(b.data),a.pieChartCreateFunction())}function q(b){a.datas=[],a.labelss=[];var c=[];return b.forEach(function(a){if(0==c.length){var b={};b.attribute=a.recommendedBy.value,b.count=1,c.push(b)}else{var d=!1;if(c.forEach(function(b){b.attribute==a.recommendedBy.value&&(b.count++,d=!0)}),!d){var b={};b.attribute=a.recommendedBy.value,b.count=1,c.push(b)}}}),c.forEach(function(b){a.datas.push(b.count),a.labelss.push(b.recommended)}),c}function r(b){a.datas=[],a.labelss=[];var c=[];return b.forEach(function(a){if(0==c.length){var b={};b.attribute=a.brand,b.count=1,c.push(b)}else{var d=!1;if(c.forEach(function(b){b.attribute==a.brand&&(b.count++,d=!0)}),!d){var b={};b.attribute=a.brand,b.count=1,c.push(b)}}}),c.forEach(function(b){a.datas.push(b.count),a.labelss.push(b.brand)}),c}function s(a){var b=[],c={};c.count=0;var d=[];return a.forEach(function(a){d.indexOf(a.user.id)<0&&(c.attribute="Subscribers",c.count=c.count+1)}),b.push(c),b}function t(a){var b=[],c={};return c.count=0,a.forEach(function(a){a.sideEffects&&(c.attribute="Side Effects",c.count=c.count+1)}),b.push(c),b}function u(b){a.queryObj={},a.queryObj.keyword=b;var c=j.getParameterizedUrl("GET_VACCINATION",a.queryObj);if(c)return k.getData(c,null,function(b){if(b&&b.data)return a.vaccineList=b.data,a.vaccineList},function(a){})}function v(){var b=j.getUrl("GET_RECOMMEND_BY_LIST_BY_KEYWORD");b&&k.getData(b,null,function(b){b&&b.data&&(a.recommendByList=b.data)},function(a){})}a.chartType="",a.chart=!1,a.incidentTypes=["Bar-Chart","Pie-Chart"],a.addressData={},a.userVaccination={},a.recommendByList={},
// $scope.userVaccination.location = {};
//$scope.incidentTypes={};
a.maxDate=new Date,a.minDateValidTill=new Date,a.getStatistics=n,a.getBarChart=o,a.getPieChart=p,a.getVaccine=u,a.getRecommendedBy=v,a.getSubscriberByVaccine=s,a.getStatisticsBySideEffect=t,a.getStatisticsByRecommended=q,a.getStatisticsByBrand=r,a.data=[],a.labels=[],a.datas=[],a.labelss=[],a.getChartType=function(){a.incidentTypes=[{Name:"Number Of Subscriber By Vaccine",key:"Chart-1",value:"Bar-Chart"},{Name:"Number of Side Effect in this year",key:"Chart-2",value:"Bar-Chart"},{Name:"Break down of vaccine By Recommended By",key:"Chart-3",value:"Pie-Chart"},{Name:"Break down by Brand",key:"Chart-4",value:"Pie-Chart"}]},a.getChartType(),a.getDate=function(b){a.minDateValidTill=b},a.status={open:!0},a.setDirectiveFn=function(b){console.log("in setDirectiveFn"),a.barChartCreateFunction=b},a.setDirectiveFnForPie=function(b){a.pieChartCreateFunction=b};v(),a.clear=function(){a.recommendByList={},a.incidentTypes={},a.userVaccination={},a.chartData={},a.addressData={},a.addressData.country={},a.addressData.state={},a.addressData.district={},a.addressData.city={},a.chart={},a.vaccination={},a.getChartType(),a.chartType="",a.getRecommendedBy()},/***************   Getting subscribed location list  **************/
a.getLocations=function(c){var d={};return d.keyword=c,d.orgId=b.loggedInUserDetails.organizationId,k.getData(j.getParameterizedUrl("GET_ORG_LOC_LIST_BY_ORG_ID_KEYWORD",d),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){m.isEmpty(a.data)||m.isEmpty(a.data.messages[0])||g("error",h.instant(a.data.messages[0]))})}}]),angular.module("paripal.userVaccinationsModule").controller("uservaccinationCtrl",["$scope","$rootScope","$stateParams","$state","fileReader","notify","$translate","datatableconfig","httpService","commonConstants","urlService","viewUserVaccinationServices","serverSidePagination","utilService","featurePrivilegeConstants","baseService","$mdDialog","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";a.userVaccination={},a.minDate=new Date,a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage;var s;a.pagingInfo={},a.calendarFilter={},a.maxDate=new Date,a.minDate=new Date,a.fromMaxDate=new Date,a.orgloclistSpinner=!1,a.orgLocListPageSpinner=!1,a.user="",a.plans=["Plan","Actual"],a.loginDetails=b.loggedInUserDetails,a.userReadOnly=!1,a.isVisble=!1,a.inVisble=!0,a.orgLocPermission=o.USER_VACINATION_ADD,a.listView=!0,a.cardView=!1,a.overdue=!1,$(".pushme").click(function(){$(this).text(function(b,c){return"Card view"===c?(a.cardView=!0,a.listView=!1):(a.cardView=!1,a.listView=!0),"Card view"===c?"List View":"Card view"})}),a.loginDetails&&!a.loginDetails.isOrganizationUser&&(a.userReadOnly=!0,a.userVaccination.user={id:a.loginDetails.id,value:a.loginDetails.displayName}),p.validateListing("VACCINATION_RECORD_SUB"),
//for individual sub
a.loginDetails&&1==a.loginDetails.userAccountStatusDTO.whetherSubscriber&&!a.loginDetails.isOrganizationUserMode&&(a.indsub=!0),c.fromState&&"stakeHolderUserDPR"==c.fromState?a.restrictAdd=!0:a.restrictAdd=!1,d.params.user&&(a.loginDetails&&a.loginDetails.isOrganizationUser?a.userVaccination.user=d.params.user:a.loginDetails&&!a.loginDetails.isOrganizationUser&&(a.userVaccination.user=d.params.user)),c.orgLocId&&(a.userVaccination.location=c.orgLocId),
//get subscribed accessible location
a.getAccessibleSubscriberLocation=function(b){return i.getData(k.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION"),null,function(b){
//httpService.getData(urlService.getParameterizedUrl('FIND_ACCESSIBLE_SYSTEM_LOCATION'), null, function (response) {
b&&b.data&&(a.accessibleSubscriberLocation=b.data,a.accessibleSubscriberLocation&&a.accessibleSubscriberLocation.length>0&&(a.hasAccessibleSubscriberLocation=!0))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})},a.getAccessibleSubscriberLocation(),a.addNewUserVaccination=function(){d.go("manageuservaccinations",{type:""})},a.clear=function(){a.plans=[],a.plan="",a.fetchRecords(),a.reArrange(),a.userVaccination={}},a.reArrange=function(){a.plans=["Plan","Actual"]},a.getUserNamesForRoleHistory=function(c){a.userData={},a.userData.searchString=c,a.userNameAutoCmpLoading=!0;var d="GET_PATIENTS_LIST_BY_SEACRH_KEY";return b.loggedInUserDetails&&!b.loggedInUserDetails.isOrganizationUserMode&&(d="FIND_WARD_USER_BY_SEARCH_STRING"),i.getData(k.getParameterizedUrl(d,a.userData),null,function(b){return a.userNameAutoCmpLoading=!1,a.users=b.data},function(b){a.userNameAutoCmpLoading=!1,f("error",g.instant(b.data.messages[0]))})},a.getVaccine=function(b){a.queryObj={},a.queryObj.keyword=b;var c=k.getParameterizedUrl("GET_VACCINATION",a.queryObj);if(c)return i.getData(c,null,function(b){if(b&&b.data)return a.vaccineList=b.data,a.vaccineList},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("Alert",g.instant(a.data.messages[0]))})},a.fetchRecords=function(b){if(s=angular.copy(b),s||(s={}),d.params.orgLocId&&(s.location={},d.params.orgLocId&&!d.params.orgLocId.id?s.location.id=d.params.orgLocId:d.params.orgLocId&&d.params.orgLocId.id&&(s.location=d.params.orgLocId)),s.location){var c=s.location;
//delete filterVaccine.vaccine;
s.location=c.id}if(s.vaccine){var e=s.vaccine;
//delete filterVaccine.vaccine;
s.vaccine=e.id}if(s.user){var h=s.user;
//filterVaccine.user = user.displayName;
delete s.user,s.userId=h.id}s.pageNumber=a.currentPage,s.recordsPerPage=a.itemPerPage,l.fetchRecords(s,function(b){b&&(a.userVaccinationList=b.data,a.totalItems=b.totalRecords,a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("Alert",g.instant(a.data.messages[0]))})},a.fetchRecords(a.userVaccination),a.manageUserVaccination=function(a,b){l.getUserVaccinationById(a,function(c){var e,f=c;e=b?"edit":"view",d.go("manageuservaccinations",{id:a,type:e,data:f})},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("Alert",g.instant(a.data.messages[0]))})},a.inActivate=function(b,c){l.deleteUserVaccinationById(b,function(b){b&&(a.userVaccinationList.splice(c,1),f("success",g.instant("RECORD_DELETED_SUCCESSFULLY")))},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])?f("error",g.instant("RECORD_DELETED_FAILURE")):f("Alert",g.instant(a.data.messages[0]))})},/***************   Getting subscribed location list  **************/
a.getLocations=function(c,d){var e={};return e.keyword=c,b.loggedInUserDetails.isOrganizationUserMode?i.getData(k.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_KEYWORD",e),null,function(b){if(b&&b.data)return a.createdBy=b.data,a.createdBy},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission}):d&&d.id?(e.userId=d.id,i.getData(k.getParameterizedUrl("FIND_SUBSCRIBED_LOCATION_BY_CLIENT_AND_KEYWORD",e),null,function(a){if(a&&a.data)return a.data},function(a){n.isEmpty(a.data)||n.isEmpty(a.data.messages[0])||f("error",g.instant(a.data.messages[0]))},{orgLocPermission:a.orgLocPermission})):void 0},a.pageChanged=function(){a.pagingInfo=m(a.currentPage,a.itemPerPage,a.totalItems),a.fetchRecords(a.userVaccination)},a.setMaxRecords=function(b){a.pageNumber=1,a.itemPerPage=b,a.fetchRecords(a.userVaccination)};
//data table config
var t=j.gridConfigurations;a.options=h.setOptionProperties(t),a.dtColumnDefs=h.setColumnProperties({}),a.changedValue=function(b){"Plan"==b?(a.isVisble=!0,a.inVisble=!1):"Actual"==b&&(a.isVisble=!1,a.inVisble=!0)}}]),angular.module("paripal.userVaccinationsModule").service("manageUserVaccinationServices",["httpService","urlService","$timeout","dateconvertor",function(a,b,c,d){"use strict";this.saveUserVaccination=function(c,e,f){
//userVaccination.dateRequestCreated = dateconvertor.convertToServerDate(userVaccination.dateRequestCreated);
c.vaccinePlannedOn=d.convertToServerDate(c.vaccinePlannedOn),c.vaccinationDate=d.convertToServerDate(c.vaccinationDate),c.vaccineValidity=d.convertToServerDate(c.vaccineValidity);var g="SAVE_USER_VACCINATION";null!=c.id&&(g="UPDATE_USER_VACCINATION"),a.postData(b.getUrl(g),c,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.generateBill=function(c){a.postData(b.getUrl("SAVE_BILL_SETTLEMENT"),c,function(a){a&&a.data?successCallback(a.data):errorCallback(a)},function(a){errorCallback(a)})},this.getVaccinationRecordId=function(c,d){a.getData(b.getUrl("GET_VACCINATION_RECORD_ID"),null,function(a){a&&a.data?c(a.data):d(a)},function(a){d(a)})}}]),angular.module("paripal.userVaccinationsModule").service("vaccinationStatisticsServices",["httpService","urlService","$timeout","dateconvertor",function(a,b,c,d){this.getvaccinationStatistics=function(c,d,e){a.postData(b.getUrl("GET_USER_VACCINATION_LIST"),c,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})}}]),angular.module("paripal.userVaccinationsModule").service("viewUserVaccinationServices",["httpService","urlService","dateconvertor","$timeout","$filter",function(a,b,c,d,e){"use strict";/* this.getUserVaccinationList = function (userVaccinationData,successCallback, errorCallback) {
    	   httpService.postData(urlService.getUrl('GET_USER_VACCINATION_LIST'),userVaccinationData, function (response) {
                if (response && response.data)
                {
                	successCallback(response.data);
                }
                 else
                    errorCallback(response);

            }, function (error) {
                errorCallback(error);
            });

        };*/
this.fetchRecords=function(d,e,f){
//user.vaccine = null;
d.dateFrom=c.convertToServerDate(d.dateFrom),d.till=c.convertToServerDate(d.till),a.postData(b.getUrl("GET_USER_VACCINATION_LIST"),d,function(a){a&&a.data?e(a.data):f(a)},function(a){f(a)})},this.deleteUserVaccinationById=function(c,d,e){var f={};f.id=c,a.deleteData(b.getParameterizedUrl("DELETE_USER_VACCINATION_BY_ID",f),null,function(a){a&&a.data?d(a.data):e(a)},function(a){e(a)})},this.getUserVaccinationById=function(c,d,f){var g={};g.id=c;var h="MM/dd/yyyy";a.getData(b.getParameterizedUrl("GET_USER_VACCINATION_ID",g),null,function(a){a&&a.data?(a.data.vaccinePlannedOn=e("timestampToDate")(a.data.vaccinePlannedOn,h),a.data.vaccinationDate=e("timestampToDate")(a.data.vaccinationDate,h),a.data.vaccineValidity=e("timestampToDate")(a.data.vaccineValidity,h),d(a.data)):f(a)},function(a){f(a)})}}]),angular.module("paripal.users_list").controller("UsersListCtrl",["$scope","$rootScope","$filter","$stateParams","$state","$location","datatableconfig","$uibModal","httpService","urlService","service","dateconvertor","notify","$translate","serverSidePagination","UsersListService","commonConstants","$mdDialog","utilService","$sce","$cookieStore","$cookies","orbeonFormRunner",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){a.currentPage=1,a.itemPerPage=10,a.startRecord=(a.currentPage-1)*a.itemPerPage+1,a.endRecord=a.itemPerPage,a.pagingInfo={},a.filterObject={},a.pageChanged=function(){a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems),a.searchData()},a.setMaxRecords=function(b){a.currentPage=1,a.itemPerPage=b,a.searchData()};var x={searching:!1,lengthChange:!1,info:!1,responsive:!0,setDeafultSortColNo:1,setDeafultColSortingOrder:"desc"};a.options=g.setOptionProperties(x),a.dtColumnDefs=g.setColumnProperties({}),a.usersList=[],a.rowObj={},a.rowObj.inactiveReason={},a.options={searching:!1},a.toggleActiveStatus=function(b,c,d){a.usersListSpinner=!0,a.requestObject={},a.requestObject.id=b,a.requestObject.whetherActive=c,a.requestObject.inactiveReasonId=s.isFieldEmpty(d)?"":d,i.putData(j.getParameterizedUrl("TOGGLE_ACTIVE_USER_STATUS",a.requestObject),null,function(b){b.data.successMessage&&(m("success",b.data.successMessage),
//$scope.searchData();
a.usersListSpinner=!1),a.clear()})},/**
         *Clear function
         */
a.clear=function(){e.reload()},/**
         *Pop-up function
         */
a.hide=function(){r.hide()},a.save=function(c,d){b.showSpinner=!0,r.hide(),a.toggleActiveStatus(c.id,!1,d.id),a.rowObj={},a.rowObj.inactiveReason={},b.showSpinner=!1},a.cancel=function(){r.cancel()},a.fetchInactiveReasons=function(){a.requestObject={entity:"user"},i.getData(j.getParameterizedUrl("INACTIVE_REASONS",a.requestObject),null,function(b){a.inactiveReasonsList=angular.fromJson(b.data),b.data.successMessage&&m("success",b.data.successMessage)})},a.toggleLockStatus=function(c,d){b.showSpinner=!0,a.requestObject={},a.requestObject.id=c,a.requestObject.whetherLocked=d,i.getData(j.getParameterizedUrl("TOGGLE_LOCK_USER_STATUS",a.requestObject),null,function(c){c.data.successMessage&&m("success",c.data.successMessage),b.showSpinner=!1,a.clear()})},/*Add link group - indicator*/
a.addinputpopup=function(b,d){a.currentUserRowObject=angular.copy(d);var e=function(){
//    $scope.inactiveReasonId = userObject.inactiveReasonId;
a.temp={},a.temp=d,r.show({scope:a,preserveScope:!0,targetEvent:b,templateUrl:"app/modules/users-list/views/popup-select-inactive-user-reason.html",parent:angular.element(document.body),clickOutsideToClose:q.dialogBox.clickOutsideToClose})};d.whetherActive?e():m("warning",c("translate")("INACTIVE_REASON_ERROR"))},/**
         *search Data functionality
         */
a.searchData=function(){var b={};a.usersListSpinner=!0,angular.copy(a.filterObject,b),b.pageNumber=a.currentPage,b.recordsPerPage=a.itemPerPage,i.postData(j.getUrl("GET_LIST_OF_USERS"),b,function(b){a.usersListSpinner=!1,a.userListInfo=angular.fromJson(b.data),a.usersList=angular.fromJson(b.data.data),a.totalItems=a.userListInfo.totalRecords,a.pagingInfo=o(a.currentPage,a.itemPerPage,a.totalItems)},function(b){a.usersListSpinner=!1})},a.init=function(){a.searchData(),a.fetchInactiveReasons()},a.init();/**
         *datatble config json
         */
var x=q.gridConfigurations;a.options=g.setOptionProperties(x)}]),angular.module("paripal.users_list").service("UsersListService",["httpService","urlService","dateconvertor","$filter",function(a,b,c,d){"use strict"}]),/**
 * Creating utility service for handling common functions
 *
 */
angular.module("utilityModule").factory("utilService",["notify","$translate","$window",function(notify,$translate,$window){var utilService={};/**
     *
     * This function is used to  check string value is null or empty or undefined.
     * @param: stringValue is string to test
     *
     */
/**
     *
     *This function is used to  check object is null or empty or undefined.
     *@param: obj is object to test
     *
     */
/*@param1 array array to be sort.
      @param2 criteria on we sort the aaray.
    */
/*
     * @param date1 : date obj first date for compare
     * @param date2 : date obj send date for compare
     * @param oprStr : String Condition to be checked
     */
/**
     * This function is used to  check given password string with password policy.
     * Password Policy - :
     * 1.Password should contain at least one digit
     * 2.Password should contain at least one special character
     * 3.Password should contain alpha characters
     * 4.Password has minimum of length 8 characters
     *
     * @param: password is string
     *
     */
/**
     * This function is used to check if an object contains null property.
     * @param   {object} obj Object for which null property is to be checked.
     * @returns {object} Object with filtered properties(null properties removed)
     */
/**
     * This function is used to check if an object contains null property.
     * @param   {object} obj Object for which null property is to be checked.
     * @returns {object} true if it contains null property
     */
/**
     * This function is used to check if an object contains null property.
     * @param   {object} obj Object for which null property is to be checked.
     * @returns {object} true if it contains null property
     */
/**
     * This function is used to check whether passed string contains in string array.
     *
     * @param   {array} an array which contains string values.
     * @param   {string} string that is to be present or not present in string array.
     * @returns {boolean} check whether passed string present in passed string array.
     */
/**
     * This function converts string in camel case
     * @param {string} stringValue [[Description]]
     */
/**
     *
     * This function is used to  check string value is null or empty or undefined
     * OR
     * object is null or empty or undefined
     * @param: stringValue is string to test OR obj is object to test
     *
     */
/**
     *
     * This function is used to returns message form messages array of error
     * @param: error response of serve
     *
     */
return utilService.fromState=null,utilService.isNullOrEmpty=function(a){return void 0==a||null==a||""===a},utilService.isEmpty=function(a){if(void 0===a)return!0;if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;if("function"==typeof a.getMonth&&"[object Date]"===Object.prototype.toString.call(a))return!1;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0},utilService.sortArray=function(a,b){var a=a;for(var c in a)for(var d=1;d<a.length;d++)if("number"==typeof a[c][b]){if(a[c][b]>a[d][b]&&d>c){var e=a[c];a[c]=a[d],a[d]=e}}else console.log("applicable on number's only");return a},utilService.dateComparator=function(a,b,c){var d=new Date(a);d.setHours(0,0,0,0);var e=new Date(b);switch(e.setHours(0,0,0,0),c){case"lt":return d<e;case"eq":return d===e;case"gt":return d>e;case"let":return d<=e;case"get":return d>=e}},utilService.checkPasswordPolicy=function(a){if(utilService.isNullOrEmpty(a))/*notify("Error", $translate.instant("INVALID_PASSWORD"));*/
return!0;var b=/^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{8,100}$/;return!a.match(b)},utilService.checkNullProp=function(a){for(var b in a)null===a[b]||void 0===a[b]||""===a[b]?delete a[b]:"object"==typeof a[b]&&0===Object.keys(a[b]).length?delete a[b]:"object"==typeof a[b]&&utilService.checkNullProp(a[b]);return a},utilService.checkforNullProperty=function(a){var b=!1;0==a.length&&(b=!0);for(var c in a)if(null===a[c]||void 0===a[c]||""===a[c]?b=!0:"object"==typeof a[c]&&0===Object.keys(a[c]).length?b=!0:"object"==typeof a[c]&&(b=utilService.checkforNullProperty(a[c])),b)return b;return b},utilService.conditionBuilderNullCheck=function(a){var b,c=!1;for(var d in a)if("entityField"===d&&(b=a[d].fieldType),"operand1"!==d&&"operand2"!==d||"Picklist"!=b?null===a[d]||void 0===a[d]||""===a[d]?c=!0:"object"==typeof a[d]&&0===Object.keys(a[d]).length?c=!0:"object"==typeof a[d]&&(c=utilService.conditionBuilderNullCheck(a[d])):null!=a[d]&&null!==a[d].id&&void 0!==a[d].id&&""!==a[d].id&&null!==a[d].code&&void 0!==a[d].code&&""!==a[d].code||(c=!0),c)return c;return c},utilService.checkStringInArray=function(a,b){var c=!1;return angular.forEach(a,function(a){if(a.toLowerCase()==b.toLowerCase())return c=!0}),c},utilService.nameConvertor=function(a){return a.toLowerCase().charAt(0).toUpperCase()+a.toLowerCase().slice(1)},utilService.isFieldEmpty=function(a){return"object"==typeof a?utilService.isEmpty(a):"number"==typeof a?!a&&0!=a:utilService.isNullOrEmpty(a)},utilService.goBackToPrevState=function(){$window.goBackToPrevState()},utilService.generateErrorMessage=function(a){var b="";if(!utilService.isEmpty(a.messages)){var c=a.messages;if(c.constructor===Array){for(var d in c)b+=c[d]+"<br>";return b}}},utilService.getRoundOffValue=function(a,b){var c=b;if(b.indexOf(".")==-1)return Number(b);switch(a){case"ROUND_LOW_0":case"ROUND_LOW_1":b="ROUND_LOW_0"==a?b.substring(0,b.indexOf(".")):b.substring(0,b.indexOf(".")+2),c=Number(b);break;case"ROUND_LOW_MINUS1":b=b.substring(0,b.indexOf(".")-1),c=10*Number(b);break;case"ROUND_HIGH_0":b=b.substring(0,b.indexOf(".")+3),c=parseInt(Number(b))+1;break;case"ROUND_HIGH_1":b=b.substring(0,b.indexOf(".")+2),c=(10*Number(b)+1)/10;break;case"ROUND_HIGH_MINUS1":b=b.substring(0,b.indexOf(".")),c=10*(parseInt(Number(b)/10)+1);break;case"ROUND_BASED_ON_GAP_1":if(b=b.substring(0,b.indexOf(".")+3),parseInt(b.substring(b.indexOf(".")+2,b.indexOf(".")+3))>5){b=b.substring(0,b.indexOf(".")+2);var d=10*Number(b);c=(10*d+10)/100}else b=b.substring(0,b.indexOf(".")+2),c=Number(b);break;case"ROUND_BASED_ON_GAP_0":b=b.substring(0,b.indexOf(".")+2),parseInt(b.substring(b.indexOf(".")+1,b.indexOf(".")+2))>5?(b=b.substring(0,b.indexOf(".")),c=Number(b)+1):(b=b.substring(0,b.indexOf(".")),c=Number(b));break;case"ROUND_BASED_ON_GAP_MINUS1":b=b.substring(0,b.indexOf(".")),c=parseInt(b.substring(b.length-1,b.length))>5?10*(parseInt(Number(b)/10)+1):10*parseInt(Number(b)/10)}return c},utilService.setFromState=function(a){utilService.fromState=a},utilService.getFromState=function(){return utilService.fromState},utilService.mobilecheck=function(){var a=!1;return function(b){(/(android|ipad|playbook|silk|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a},utilService.idGeneratorMethod=function(selectedValueOrgLoc){function filterArr(a){if(a.tableName===obj[formName][formName]&&(a.organizationLocationId===locId||"PRODUCT"===a.category))return a}function filterDisable(a){if(a.tableName===obj[formName][formName])return a}if(null!==selectedValueOrgLoc){var formObj=document.getElementsByTagName("form")[0].elements,formName=document.getElementsByTagName("form")[0].name,locId=selectedValueOrgLoc.id,json=angular.fromJson(localStorage.getItem("idGeneratorJson")),obj=eval("formFieldTableColumnMap"),mapArray=json.filter(filterArr);if(mapArray.length>0)for(var i in formObj)mapArray[0].columns.indexOf(obj[formName][formObj[i].name])!==-1&&(document.getElementsByName(formObj[i].name)[0].setAttribute("disabled",!0),document.getElementsByName(formObj[i].name)[0].required=!1,
//  document.getElementsByName(formObj[i].name)[0].setAttribute("placeholder", $filter("translate")("AUTO_GENERATE"));
document.getElementsByName(formObj[i].name)[0].value="");else{var mapArray=json.filter(filterDisable);if(mapArray.length>0)for(var i in formObj)mapArray[0].columns.indexOf(obj[formName][formObj[i].name])!==-1&&(document.getElementsByName(formObj[i].name)[0].removeAttribute("disabled"),document.getElementsByName(formObj[i].name)[0].required=!0,document.getElementsByName(formObj[i].name)[0].value="")}}},utilService}]);